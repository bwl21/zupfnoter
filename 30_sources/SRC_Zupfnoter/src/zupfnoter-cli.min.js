!function e(t,r,n){function a(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[o]={exports:{}};t[o][0].call(u.exports,function(e){var r=t[o][1][e];return a(r||e)},u,u.exports,e,t,r,n)}return r[o].exports}for(var i="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,r){!function(e){function t(e,t){function r(e,r){if(null===e||void 0===e)return r+"null";if("number"==typeof e){return r+(e===+e&&e!==(0|e)&&"decimals"in t?e.toFixed(t.decimals):e+"")}if(e instanceof Array){if(!e.length)return r+"[]";var $=e.map(function(e){return u(e,"")}),f=r+"["+i+$.join(s)+i+"]";if(!1===t.wrap||f.length<=t.wrap)return f;if(t.short){var p=r+" "+i;return $=e.map(function(e){return u(e,p)}),$[0]=$[0].replace(p,r+"["+i),$[$.length-1]=$[$.length-1]+i+"]",$.join(",\n")}var p=r+t.indent;return r+"[\n"+e.map(function(e){return u(e,p)}).join(",\n")+"\n"+(t.indentLast?p:r)+"]"}if(e instanceof Object){var d=[],h=0,_=t.sort||t.sorted;for(var g in e){var m=d[h++]=[g,e[g]];!0===_?m[2]=g:"function"==typeof _&&(m[2]=_(g,e[g],e))}if(!d.length)return r+"{}";_&&(d=d.sort(function(e,t){return e=e[2],t=t[2],e<t?-1:e>t?1:0}));var y=d.map(function(e){return[JSON.stringify(e[0]),u(e[1],"")]});t.sorted&&(y=y.sort(function(e,t){return e=e[0],t=t[0],e<t?-1:e>t?1:0})),y=y.map(function(e){return e.join(l)}).join(s);var f=r+"{"+o+y+o+"}";if(!1===t.wrap||f.length<t.wrap)return f;if(t.short){if(y=d.map(function(e){return[r+" "+o+JSON.stringify(e[0]),e[1]]}),y[0][0]=y[0][0].replace(r+" ",r+"{"),t.aligned){for(var v=0,h=y.length;h--;)y[h][0].length>v&&(v=y[h][0].length);for(var b=n(" ",v),h=y.length;h--;)y[h][0]=a(b,y[h][0])}for(var h=y.length;h--;){var g=y[h][0],x=y[h][1],p=n(" ",(g+c).length),f=g+c+u(x,"");y[h]=!1===t.wrap||f.length<=t.wrap||!x||"object"!=typeof x?f:g+c+u(x,p).replace(/^\s+/,"")}return y.join(",\n")+o+"}"}var y=[],h=0;for(var g in e){var m=y[h++]=[r+t.indent+JSON.stringify(g),e[g]];!0===_?m[2]=g:"function"==typeof _&&(m[2]=_(g,e[g],e))}if(_&&(y=y.sort(function(e,t){return e=e[2],t=t[2],e<t?-1:e>t?1:0})),t.aligned){for(var v=0,h=y.length;h--;)y[h][0].length>v&&(v=y[h][0].length);for(var b=n(" ",v),h=y.length;h--;)y[h][0]=a(b,y[h][0])}for(var p=r+t.indent,h=y.length;h--;){var g=y[h][0],x=y[h][1],f=g+c+u(x,"");y[h]=!1===t.wrap||f.length<=t.wrap||!x||"object"!=typeof x?f:g+c+u(x,p).replace(/^\s+/,"")}return r+"{\n"+y.join(",\n")+"\n"+(t.indentLast?p:r)+"}"}return r+JSON.stringify(e)}function n(e,t){for(var r="";;){if(1&t&&(r+=e),!(t>>=1))break;e+=e}return r}function a(e,t){return(t+e).substring(0,e.length)}t=t||{},"wrap"in t||(t.wrap=80),1==t.wrap&&(t.wrap=-1),"indent"in t||(t.indent="  "),"arrayPadding"in t||(t.arrayPadding="padding"in t?t.padding:0),"objectPadding"in t||(t.objectPadding="padding"in t?t.padding:0),"beforeComma"in t||(t.beforeComma="aroundComma"in t?t.aroundComma:0),"afterComma"in t||(t.afterComma="aroundComma"in t?t.aroundComma:0),"beforeColon"in t||(t.beforeColon="aroundColon"in t?t.aroundColon:0),"afterColon"in t||(t.afterColon="aroundColon"in t?t.aroundColon:0),"beforeColon1"in t||(t.beforeColon1="aroundColon1"in t?t.aroundColon1:"beforeColon"in t?t.beforeColon:0),"afterColon1"in t||(t.afterColon1="aroundColon1"in t?t.aroundColon1:"afterColon"in t?t.afterColon:0),"beforeColonN"in t||(t.beforeColonN="aroundColonN"in t?t.aroundColonN:"beforeColon"in t?t.beforeColon:0),"afterColonN"in t||(t.afterColonN="aroundColonN"in t?t.aroundColonN:"afterColon"in t?t.afterColon:0);var i=n(" ",t.arrayPadding),o=n(" ",t.objectPadding),s=n(" ",t.beforeComma)+","+n(" ",t.afterComma),l=n(" ",t.beforeColon1)+":"+n(" ",t.afterColon1),c=n(" ",t.beforeColonN)+":"+n(" ",t.afterColonN),u=function(){var e=new Map;return function(t,n){var a=e.get(t);return a||e.set(t,a={}),a[n]||(a[n]=r(t,n)),a[n]}}();return u(e,"")}e.neatJSON=t,t.version="0.8.3"}(void 0===r?this:r)},{}],2:[function(e,t,r){"use strict";function n(e){return m.test(e)}function a(t){function r(e,t){var r;if("string"==typeof e){if(!(r=A(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var n=I(e);r=n.validate||O(n)}var a=r(t);return!0===r.$async?"*"==N._opts.async?h(a):a:(N.errors=r.errors,a)}function _(e,t){var r=I(e,void 0,t);return r.validate||O(r)}function v(e,t,r,n){if(Array.isArray(e))for(var a=0;a<e.length;a++)v(e[a],void 0,r,n);else t=o.normalizeId(t||e.id),M(t),N._schemas[t]=I(e,r,n,!0)}function b(e,t,r){v(e,t,r,!0)}function x(e,t){var a=e.$schema||N._opts.defaultMeta||w(),i=N._formats.uri;N._formats.uri="function"==typeof i?n:m;var o;try{o=r(a,e)}finally{N._formats.uri=i}if(!o&&t){var s="schema is invalid: "+T();if("log"!=N._opts.validateSchema)throw new Error(s);console.error(s)}return o}function w(){var e=N._opts.meta;return N._opts.defaultMeta="object"==typeof e?e.id||e:N._opts.v5?f.META_SCHEMA_ID:g,N._opts.defaultMeta}function A(e){var t=E(e);switch(typeof t){case"object":return t.validate||O(t);case"string":return A(t);case"undefined":return k(e)}}function k(e){var t=o.schema.call(N,{schema:{}},e);if(t){var r=t.schema,n=t.root,a=t.baseId,s=i.call(N,r,n,void 0,a);return N._fragments[e]=new l({ref:e,fragment:!0,schema:r,root:n,baseId:a,validate:s}),s}}function E(e){return e=o.normalizeId(e),N._schemas[e]||N._refs[e]||N._fragments[e]}function C(e){if(e instanceof RegExp)return S(N._schemas,e),void S(N._refs,e);switch(typeof e){case"undefined":return S(N._schemas),S(N._refs),void N._cache.clear();case"string":var t=E(e);return t&&N._cache.del(t.jsonStr),delete N._schemas[e],void delete N._refs[e];case"object":var r=c(e);N._cache.del(r);var n=e.id;n&&(n=o.normalizeId(n),delete N._schemas[n],delete N._refs[n])}}function S(e,t){for(var r in e){var n=e[r];n.meta||t&&!t.test(r)||(N._cache.del(n.jsonStr),delete e[r])}}function I(e,t,r,n){if("object"!=typeof e)throw new Error("schema should be object");var a=c(e),i=N._cache.get(a);if(i)return i;n=n||!1!==N._opts.addUsedSchema;var s=o.normalizeId(e.id);s&&n&&M(s);var u,$=!1!==N._opts.validateSchema&&!t;$&&!(u=e.id&&e.id==e.$schema)&&x(e,!0);var f=o.ids.call(N,e),p=new l({id:s,schema:e,localRefs:f,jsonStr:a,meta:r});return"#"!=s[0]&&n&&(N._refs[s]=p),N._cache.put(a,p),$&&u&&x(e,!0),p}function O(e,t){function r(){var t=e.validate,n=t.apply(null,arguments);return r.errors=t.errors,n}if(e.compiling)return e.validate=r,r.schema=e.schema,r.errors=null,r.root=t||r,!0===e.schema.$async&&(r.$async=!0),r;e.compiling=!0;var n;e.meta&&(n=N._opts,N._opts=N._metaOpts);var a;try{a=i.call(N,e.schema,t,e.localRefs)}finally{e.compiling=!1,e.meta&&(N._opts=n)}return e.validate=a,e.refs=a.refs,e.refVal=a.refVal,e.root=a.root,a}function T(e,t){if(!(e=e||N.errors))return"No errors";t=t||{};for(var r=void 0===t.separator?", ":t.separator,n=void 0===t.dataVar?"data":t.dataVar,a="",i=0;i<e.length;i++){var o=e[i];o&&(a+=n+o.dataPath+" "+o.message+r)}return a.slice(0,-r.length)}function P(e,t){"string"==typeof t&&(t=new RegExp(t)),N._formats[e]=t}function M(e){if(N._schemas[e]||N._refs[e])throw new Error('schema with key or id "'+e+'" already exists')}if(!(this instanceof a))return new a(t);var N=this;t=this._opts=p.copy(t)||{},this._schemas={},this._refs={},this._fragments={},this._formats=u(t.format),this._cache=t.cache||new s,this._loadingSchemas={},this._compilations=[],this.RULES=$(),this.validate=r,this.compile=_,this.addSchema=v,this.addMetaSchema=b,this.validateSchema=x,this.getSchema=A,this.removeSchema=C,this.addFormat=P,this.errorsText=T,this._addSchema=I,this._compile=O,t.loopRequired=t.loopRequired||1/0,(t.async||t.transpile)&&d.setup(t),!0===t.beautify&&(t.beautify={indent_size:2}),"property"==t.errorDataPath&&(t._errorDataPathProperty=!0),this._metaOpts=function(){for(var e=p.copy(N._opts),t=0;t<y.length;t++)delete e[y[t]];return e}(),t.formats&&function(){for(var e in N._opts.formats)P(e,N._opts.formats[e])}(),function(){!1!==N._opts.meta&&(b(e("./refs/json-schema-draft-04.json"),g,!0),N._refs["http://json-schema.org/schema"]=g)}(),t.v5&&f.enable(this),"object"==typeof t.meta&&b(t.meta),function(){var e=N._opts.schemas;if(e)if(Array.isArray(e))v(e);else for(var t in e)v(e[t],t)}()}var i=e("./compile"),o=e("./compile/resolve"),s=e("./cache"),l=e("./compile/schema_obj"),c=e("json-stable-stringify"),u=e("./compile/formats"),$=e("./compile/rules"),f=e("./v5"),p=e("./compile/util"),d=e("./async"),h=e("co");t.exports=a,a.prototype.compileAsync=d.compile;var _=e("./keyword");a.prototype.addKeyword=_.add,a.prototype.getKeyword=_.get,a.prototype.removeKeyword=_.remove,a.ValidationError=e("./compile/validation_error");var g="http://json-schema.org/draft-04/schema",m=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/\/)?[^\s]*$/i,y=["removeAdditional","useDefaults","coerceTypes"]},{"./async":3,"./cache":4,"./compile":8,"./compile/formats":7,"./compile/resolve":9,"./compile/rules":10,"./compile/schema_obj":11,"./compile/util":13,"./compile/validation_error":14,"./keyword":39,"./refs/json-schema-draft-04.json":40,"./v5":42,co:45,"json-stable-stringify":78}],3:[function(e,t,r){"use strict";function n(e,t){!1!==t&&(t=!0);var r,a=e.async,i=e.transpile;switch(typeof i){case"string":var o=h[i];if(!o)throw new Error("bad transpiler: "+i);return e._transpileFunc=o(e,t);case"undefined":case"boolean":if("string"==typeof a){if(!(r=d[a]))throw new Error("bad async mode: "+a);return e.transpile=r(e,t)}for(var s=0;s<_.length;s++){var l=_[s];if(n(l,!1))return p.copy(l,e),e.transpile}throw new Error("generators, nodent and regenerator are not available");case"function":return e._transpileFunc=e.transpile;default:throw new Error("bad transpiler: "+i)}}function a(e,t){try{return new Function("(function*(){})()")(),!0}catch(e){if(t)throw new Error("generators not supported")}}function i(e,t){try{return new Function("(async function(){})()")(),!0}catch(e){if(t)throw new Error("es7 async functions not supported")}}function o(t,r){try{if(!$){$=e("regenerator"),$.runtime()}return t.async&&!0!==t.async||(t.async="es7"),s}catch(e){if(r)throw new Error("regenerator not available")}}function s(e){return $.compile(e).code}function l(t,r){try{if(!f){f=e("nodent")({log:!1,dontInstallRequireHook:!0})}return"es7"!=t.async&&(t.async&&!0!==t.async&&console.warn("nodent transpiles only es7 async functions"),t.async="es7"),c}catch(e){if(r)throw new Error("nodent not available")}}function c(e){return f.compile(e,"",{promises:!0,sourcemap:!1}).code}function u(e,t){function r(e,t,n){function i(e,r){if(!n)return t(e,r);setTimeout(function(){t(e,r)})}var o;try{o=a.compile(e)}catch(n){return void(n.missingSchema?function(n){function i(n,i){if(n)return t(n);if(!a._refs[o]&&!a._schemas[o])try{a.addSchema(i,o)}catch(e){return void t(e)}r(e,t)}var o=n.missingSchema;if(a._refs[o]||a._schemas[o])return t(new Error("Schema "+o+" is loaded but "+n.missingRef+" cannot be resolved"));var s=a._loadingSchemas[o];s?"function"==typeof s?a._loadingSchemas[o]=[s,i]:s[s.length]=i:(a._loadingSchemas[o]=i,a._opts.loadSchema(o,function(e,t){var r=a._loadingSchemas[o];if(delete a._loadingSchemas[o],"function"==typeof r)r(e,t);else for(var n=0;n<r.length;n++)r[n](e,t)}))}(n):i(n))}i(null,o)}var n,a=this;try{n=this._addSchema(e)}catch(e){return void setTimeout(function(){t(e)})}if(n.validate)setTimeout(function(){t(null,n.validate)});else{if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");r(e,t,!0)}}t.exports={setup:n,compile:u};var $,f,p=e("./compile/util"),d={"*":a,"co*":a,es7:i},h={nodent:l,regenerator:o},_=[{async:"co*"},{async:"es7",transpile:"nodent"},{async:"co*",transpile:"regenerator"}]},{"./compile/util":13}],4:[function(e,t,r){"use strict";var n=t.exports=function(){this._cache={}};n.prototype.put=function(e,t){this._cache[e]=t},n.prototype.get=function(e){return this._cache[e]},n.prototype.del=function(e){delete this._cache[e]},n.prototype.clear=function(){this._cache={}}},{}],5:[function(e,t,r){"use strict";t.exports={$ref:e("../dotjs/ref"),allOf:e("../dotjs/allOf"),anyOf:e("../dotjs/anyOf"),dependencies:e("../dotjs/dependencies"),enum:e("../dotjs/enum"),format:e("../dotjs/format"),items:e("../dotjs/items"),maximum:e("../dotjs/_limit"),minimum:e("../dotjs/_limit"),maxItems:e("../dotjs/_limitItems"),minItems:e("../dotjs/_limitItems"),maxLength:e("../dotjs/_limitLength"),minLength:e("../dotjs/_limitLength"),maxProperties:e("../dotjs/_limitProperties"),minProperties:e("../dotjs/_limitProperties"),multipleOf:e("../dotjs/multipleOf"),not:e("../dotjs/not"),oneOf:e("../dotjs/oneOf"),pattern:e("../dotjs/pattern"),properties:e("../dotjs/properties"),required:e("../dotjs/required"),uniqueItems:e("../dotjs/uniqueItems"),validate:e("../dotjs/validate")}},{"../dotjs/_limit":16,"../dotjs/_limitItems":17,"../dotjs/_limitLength":18,"../dotjs/_limitProperties":19,"../dotjs/allOf":20,"../dotjs/anyOf":21,"../dotjs/dependencies":24,"../dotjs/enum":25,"../dotjs/format":26,"../dotjs/items":27,"../dotjs/multipleOf":28,"../dotjs/not":29,"../dotjs/oneOf":30,"../dotjs/pattern":31,"../dotjs/properties":33,"../dotjs/ref":34,"../dotjs/required":35,"../dotjs/uniqueItems":37,"../dotjs/validate":38}],6:[function(e,t,r){"use strict";t.exports=function e(t,r){if(t===r)return!0;var n,a=Array.isArray(t),i=Array.isArray(r);if(a&&i){if(t.length!=r.length)return!1;for(n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}if(a!=i)return!1;if(t&&r&&"object"==typeof t&&"object"==typeof r){var o=Object.keys(t);if(o.length!==Object.keys(r).length)return!1;var s=t instanceof Date,l=r instanceof Date;if(s&&l)return t.getTime()==r.getTime();if(s!=l)return!1;var c=t instanceof RegExp,u=r instanceof RegExp;if(c&&u)return t.toString()==r.toString();if(c!=u)return!1;for(n=0;n<o.length;n++)if(!Object.prototype.hasOwnProperty.call(r,o[n]))return!1;for(n=0;n<o.length;n++)if(!e(t[o[n]],r[o[n]]))return!1;return!0}return!1}},{}],7:[function(e,t,r){"use strict";function n(e){e="full"==e?"full":"fast";var t=p.copy(n[e]);for(var r in n.compare)t[r]={validate:t[r],compare:n.compare[r]};return t}function a(e){var t=e.match(d);if(!t)return!1;var r=+t[1],n=+t[2];return r>=1&&r<=12&&n>=1&&n<=h[r]}function i(e,t){var r=e.match(_);if(!r)return!1;var n=r[1],a=r[2],i=r[3],o=r[5];return n<=23&&a<=59&&i<=59&&(!t||o)}function o(e){var t=e.split(x);return 2==t.length&&a(t[0])&&i(t[1],!0)}function s(e){return e.length<=255&&g.test(e)}function l(e){return w.test(e)&&m.test(e)}function c(e){try{return new RegExp(e),!0}catch(e){return!1}}function u(e,t){if(e&&t)return e>t?1:e<t?-1:e===t?0:void 0}function $(e,t){if(e&&t&&(e=e.match(_),t=t.match(_),e&&t))return e=e[1]+e[2]+e[3]+(e[4]||""),t=t[1]+t[2]+t[3]+(t[4]||""),e>t?1:e<t?-1:e===t?0:void 0}function f(e,t){if(e&&t){e=e.split(x),t=t.split(x);var r=u(e[0],t[0]);if(void 0!==r)return r||$(e[1],t[1])}}var p=e("./util"),d=/^\d\d\d\d-(\d\d)-(\d\d)$/,h=[0,31,29,31,30,31,30,31,31,30,31,30,31],_=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,g=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,m=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:\#(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,y=/^(?:urn\:uuid\:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,v=/^(?:\/(?:[^~\/]|~0|~1)*)*$|^\#(?:\/(?:[a-z0-9_\-\.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,b=/^(?:0|[1-9][0-9]*)(?:\#|(?:\/(?:[^~\/]|~0|~1)*)*)$/;t.exports=n,n.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^[0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s][0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,uri:/^(?:[a-z][a-z0-9+-.]*)?(?:\:|\/)\/?[^\s]*$/i,email:/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:g,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:c,uuid:y,"json-pointer":v,"relative-json-pointer":b},n.full={date:a,time:i,"date-time":o,uri:l,email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&''*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:s,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:c,uuid:y,"json-pointer":v,"relative-json-pointer":b},n.compare={date:u,time:$,"date-time":f};var x=/t|\s/i,w=/\/|\:/},{"./util":13}],8:[function(e,t,r){"use strict";function n(){if(void 0===p){try{p=e("js-beautify").js_beautify}catch(e){p=!1}}}function a(e,t,r,s){function w(){var e=U.validate,t=e.apply(null,arguments);return w.errors=e.errors,t}function A(e,r,i,o){var s=!r||r&&r.schema==e;if(r.schema!=t.schema)return a.call(P,e,r,i,o);var _=!0===e.$async;_&&!M.transpile&&g.setup(M);var w=m({isTop:!0,schema:e,isRoot:s,baseId:o,root:r,schemaPath:"",errSchemaPath:"#",errorPath:'""',RULES:G,validate:m,util:h,resolve:d,resolveRef:k,usePattern:I,useDefault:O,useCustomRule:T,opts:M,formats:H,self:P});w=f(N,u)+f(R,l)+f(F,c)+f(L,$)+w,M.beautify&&(n(),p?w=p(w,M.beautify):console.error('"npm install js-beautify" to use beautify option'));var A,E,C=M._transpileFunc;try{E=_&&C?C(w):w;A=new Function("self","RULES","formats","root","refVal","defaults","customRules","co","equal","ucs2length","ValidationError",E)(P,G,H,t,N,F,L,y,b,v,x),N[0]=A}catch(e){throw console.error("Error compiling schema, function code:",E),e}return A.schema=e,A.errors=null,A.refs=B,A.refVal=N,A.root=s?A:r,_&&(A.$async=!0),z&&(A.sourceCode=w),!0===M.sourceCode&&(A.source={patterns:R,defaults:F}),A}function k(e,n,i){n=d.url(e,n);var o,s,l=B[n];if(void 0!==l)return o=N[l],s="refVal["+l+"]",S(o,s);if(!i&&t.refs){var c=t.refs[n];if(void 0!==c)return o=t.refVal[c],s=E(n,o),S(o,s)}s=E(n);var u=d.call(P,A,t,n);if(!u){var $=r&&r[n];$&&(u=d.inlineRef($,M.inlineRefs)?$:a.call(P,$,t,r,e))}return u?(C(n,u),S(u,s)):void 0}function E(e,t){var r=N.length;return N[r]=t,B[e]=r,"refVal"+r}function C(e,t){var r=B[e];N[r]=t}function S(e,t){return"object"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&e.$async}}function I(e){var t=j[e];return void 0===t&&(t=j[e]=R.length,R[t]=e),"pattern"+t}function O(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return h.toQuotedString(e);case"object":if(null===e)return"null";var t=_(e),r=D[t];return void 0===r&&(r=D[t]=F.length,F[r]=e),"default"+r}}function T(e,t,r,n){var a=e.definition.validateSchema;if(a&&!1!==P._opts.validateSchema){if(!a(t)){var i="keyword schema is invalid: "+P.errorsText(a.errors);if("log"!=P._opts.validateSchema)throw new Error(i);console.error(i)}}var o,s=e.definition.compile,l=e.definition.inline,c=e.definition.macro;s?o=s.call(P,t,r,n):c?(o=c.call(P,t,r,n),!1!==M.validateSchema&&P.validateSchema(o,!0)):o=l?l.call(P,n,e.keyword,t,r):e.definition.validate;var u=L.length;return L[u]=o,{code:"customRule"+u,validate:o}}var P=this,M=this._opts,N=[void 0],B={},R=[],j={},F=[],D={},L=[],z=!1!==M.sourceCode;t=t||{schema:e,refVal:N,refs:B};var q=i.call(this,e,t,s),U=this._compilations[q.index];if(q.compiling)return U.callValidate=w;var H=this._formats,G=this.RULES;try{var Y=A(e,t,r,s);U.validate=Y;var Q=U.callValidate;return Q&&(Q.schema=Y.schema,Q.errors=null,Q.refs=Y.refs,Q.refVal=Y.refVal,Q.root=Y.root,Q.$async=Y.$async,z&&(Q.sourceCode=Y.sourceCode)),Y}finally{o.call(this,e,t,s)}}function i(e,t,r){var n=s.call(this,e,t,r);return n>=0?{index:n,compiling:!0}:(n=this._compilations.length,this._compilations[n]={schema:e,root:t,baseId:r},{index:n,compiling:!1})}function o(e,t,r){var n=s.call(this,e,t,r);n>=0&&this._compilations.splice(n,1)}function s(e,t,r){for(var n=0;n<this._compilations.length;n++){var a=this._compilations[n];if(a.schema==e&&a.root==t&&a.baseId==r)return n}return-1}function l(e,t){return"var pattern"+e+" = new RegExp("+h.toQuotedString(t[e])+");"}function c(e){return"var default"+e+" = defaults["+e+"];"}function u(e,t){return t[e]?"var refVal"+e+" = refVal["+e+"];":""}function $(e){return"var customRule"+e+" = customRules["+e+"];"}function f(e,t){if(!e.length)return"";for(var r="",n=0;n<e.length;n++)r+=t(n,e);return r}var p,d=e("./resolve"),h=e("./util"),_=e("json-stable-stringify"),g=e("../async"),m=e("../dotjs/validate"),y=e("co"),v=h.ucs2length,b=e("./equal"),x=e("./validation_error");t.exports=a},{"../async":3,"../dotjs/validate":38,"./equal":6,"./resolve":9,"./util":13,"./validation_error":14,co:45,"json-stable-stringify":78}],9:[function(e,t,r){"use strict";function n(e,t,r){var i=this._refs[r];if("string"==typeof i){if(!this._refs[i])return n.call(this,e,t,i);i=this._refs[i]}if((i=i||this._schemas[r])instanceof m)return s(i.schema,this._opts.inlineRefs)?i.schema:i.validate||this._compile(i);var o,l,c,u=a.call(this,t,r);return u&&(o=u.schema,t=u.root,c=u.baseId),o instanceof m?l=o.validate||e.call(this,o.schema,t,void 0,c):o&&(l=s(o,this._opts.inlineRefs)?o:e.call(this,o,t,void 0,c)),l}function a(e,t){var r=h.parse(t,!1,!0),n=$(r),a=u(e.schema.id);if(n!==a){var s=f(n),l=this._refs[s];if("string"==typeof l)return i.call(this,e,l,r);if(l instanceof m)l.validate||this._compile(l),e=l;else{if(!((l=this._schemas[s])instanceof m))return;if(l.validate||this._compile(l),s==f(t))return{schema:l,root:e,baseId:a};e=l}if(!e.schema)return;a=u(e.schema.id)}return o.call(this,r,a,e.schema,e)}function i(e,t,r){var n=a.call(this,e,t);if(n){var i=n.schema,s=n.baseId;return e=n.root,i.id&&(s=p(s,i.id)),o.call(this,r,s,i,e)}}function o(e,t,r,n){if(e.hash=e.hash||"","#/"==e.hash.slice(0,2)){for(var i=e.hash.split("/"),o=1;o<i.length;o++){var s=i[o];if(s){if(s=g.unescapeFragment(s),!(r=r[s]))break;if(r.id&&!y[s]&&(t=p(t,r.id)),r.$ref){var l=p(t,r.$ref),c=a.call(this,n,l);c&&(r=c.schema,n=c.root,t=c.baseId)}}}return r&&r!=n.schema?{schema:r,root:n,baseId:t}:void 0}}function s(e,t){return!1!==t&&(void 0===t||!0===t?l(e):t?c(e)<=t:void 0)}function l(e){var t;if(Array.isArray(e)){for(var r=0;r<e.length;r++)if("object"==typeof(t=e[r])&&!l(t))return!1}else for(var n in e){if("$ref"==n)return!1;if("object"==typeof(t=e[n])&&!l(t))return!1}return!0}function c(e){var t,r=0;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(t=e[n],"object"==typeof t&&(r+=c(t)),r==1/0)return 1/0}else for(var a in e){if("$ref"==a)return 1/0;if(v[a])r++;else if(t=e[a],"object"==typeof t&&(r+=c(t)+1),r==1/0)return 1/0}return r}function u(e,t){return!1!==t&&(e=f(e)),$(h.parse(e,!1,!0))}function $(e){var t=e.protocol||"//"==e.href.slice(0,2)?"//":"";return(e.protocol||"")+t+(e.host||"")+(e.path||"")+"#"}function f(e){return e?e.replace(b,""):""}function p(e,t){return t=f(t),h.resolve(e,t)}function d(e){function t(e,r,a){if(Array.isArray(e))for(var i=0;i<e.length;i++)t.call(this,e[i],r+"/"+i,a);else if(e&&"object"==typeof e){if("string"==typeof e.id){var o=a=a?h.resolve(a,e.id):e.id;o=f(o);var s=this._refs[o];if("string"==typeof s&&(s=this._refs[s]),s&&s.schema){if(!_(e,s.schema))throw new Error('id "'+o+'" resolves to more than one schema')}else if(o!=f(r))if("#"==o[0]){if(n[o]&&!_(e,n[o]))throw new Error('id "'+o+'" resolves to more than one schema');n[o]=e}else this._refs[o]=r}for(var l in e)t.call(this,e[l],r+"/"+g.escapeFragment(l),a)}}var r=f(e.id),n={};return t.call(this,e,u(r,!1),r),n}var h=e("url"),_=e("./equal"),g=e("./util"),m=e("./schema_obj");t.exports=n,n.normalizeId=f,n.fullPath=u,n.url=p,n.ids=d,n.inlineRef=s,n.schema=a;var y=g.toHash(["properties","patternProperties","enum","dependencies","definitions"]),v=g.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]),b=/#\/?$/},{"./equal":6,"./schema_obj":11,"./util":13,url:void 0}],10:[function(e,t,r){"use strict";var n=e("./_rules"),a=e("./util").toHash;t.exports=function(){var e=[{type:"number",rules:["maximum","minimum","multipleOf"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","uniqueItems","items"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","properties"]},{rules:["$ref","enum","not","anyOf","oneOf","allOf"]}],t=["type","additionalProperties","patternProperties"],r=["additionalItems","$schema","id","title","description","default"],i=["number","integer","string","array","object","boolean","null"];return e.all=a(t),e.forEach(function(r){r.rules=r.rules.map(function(r){return t.push(r),e.all[r]={keyword:r,code:n[r]}})}),e.keywords=a(t.concat(r)),e.types=a(i),e.custom={},e}},{"./_rules":5,"./util":13}],11:[function(e,t,r){"use strict";function n(e){a.copy(e,this)}var a=e("./util");t.exports=n},{"./util":13}],12:[function(e,t,r){"use strict";t.exports=function(e){for(var t,r=0,n=e.length,a=0;a<n;)r++,(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<n&&56320==(64512&(t=e.charCodeAt(a)))&&a++;return r}},{}],13:[function(e,t,r){"use strict";function n(e,t){t=t||{};for(var r in e)t[r]=e[r];return t}function a(e,t,r){var n=r?" !== ":" === ",a=r?" || ":" && ",i=r?"!":"",o=r?"":"!";switch(e){case"null":return t+n+"null";case"array":return i+"Array.isArray("+t+")";case"object":return"("+i+t+a+"typeof "+t+n+'"object"'+a+o+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+n+'"number"'+a+o+"("+t+" % 1)"+a+t+n+t+")";default:return"typeof "+t+n+'"'+e+'"'}}function i(e,t){switch(e.length){case 1:return a(e[0],t,!0);default:var r="",n=s(e);n.array&&n.object&&(r=n.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete n.null,delete n.array,delete n.object),n.number&&delete n.integer;for(var i in n)r+=(r?" && ":"")+a(i,t,!0);return r}}function o(e,t){if(Array.isArray(t)){for(var r=[],n=0;n<t.length;n++){var a=t[n];k[a]?r[r.length]=a:"array"===e&&"array"===a&&(r[r.length]=a)}if(r.length)return r}else{if(k[t])return[t];if("array"===e&&"array"===t)return["array"]}}function s(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}function l(e){return"number"==typeof e?"["+e+"]":E.test(e)?"."+e:"['"+c(e)+"']"}function c(e){return e.replace(C,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function u(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0}function $(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")}function f(e){return e.replace(S,"").replace(I,"").replace(O,"if (!($1))")}function p(e,t){var r=e.match(T);return r&&2===r.length?t?e.replace(M,"").replace(R,j):e.replace(P,"").replace(N,B):e}function d(e,t){for(var r in e)if(t[r])return!0}function h(e,t,r){for(var n in e)if(n!=r&&t[n])return!0}function _(e){return"'"+c(e)+"'"}function g(e,t,r,n){return v(e,r?"'/' + "+t+(n?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):n?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")}function m(e,t,r){return v(e,_(r?"/"+w(t):l(t)))}function y(e,t,r){var n,a,i,o;if(""===e)return"rootData";if("/"==e[0]){if(!F.test(e))throw new Error("Invalid JSON-pointer: "+e);a=e,i="rootData"}else{if(!(o=e.match(D)))throw new Error("Invalid JSON-pointer: "+e);if(n=+o[1],"#"==(a=o[2])){if(n>=t)throw new Error("Cannot access property/index "+n+" levels up, current level is "+t);return r[t-n]}if(n>t)throw new Error("Cannot access data "+n+" levels up, current level is "+t);if(i="data"+(t-n||""),!a)return i}for(var s=i,c=a.split("/"),u=0;u<c.length;u++){var $=c[u];$&&(i+=l(A($)),s+=" && "+i)}return s}function v(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function b(e){return A(decodeURIComponent(e))}function x(e){return encodeURIComponent(w(e))}function w(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function A(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}t.exports={copy:n,checkDataType:a,checkDataTypes:i,coerceToTypes:o,toHash:s,getProperty:l,escapeQuotes:c,ucs2length:e("./ucs2length"),varOccurences:u,varReplace:$,cleanUpCode:f,cleanUpVarErrors:p,schemaHasRules:d,schemaHasRulesExcept:h,stableStringify:e("json-stable-stringify"),toQuotedString:_,getPathExpr:g,getPath:m,getData:y,unescapeFragment:b,escapeFragment:x,escapeJsonPointer:w};var k=s(["string","number","integer","boolean","null"]),E=/^[a-z$_][a-z$_0-9]*$/i,C=/'|\\/g,S=/else\s*{\s*}/g,I=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,O=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g,T=/[^v\.]errors/g,P=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,M=/var errors = 0;|var vErrors = null;/g,N="return errors === 0;",B="validate.errors = null; return true;",R=/if \(errors === 0\) return true;\s*else throw new ValidationError\(vErrors\);/,j="return true;",F=/^\/(?:[^~]|~0|~1)*$/,D=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/},{"./ucs2length":12,"json-stable-stringify":78}],14:[function(e,t,r){"use strict";function n(e){this.message="validation failed",this.errors=e,
this.ajv=this.validation=!0}t.exports=n,n.prototype=Object.create(Error.prototype),n.prototype.constructor=n},{}],15:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n=" ",a=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(i||""),$="valid"+a;if(n+="var "+$+" = undefined;",!1===e.opts.format)return n+=" "+$+" = true; ";var f=e.schema.format,p=e.opts.v5&&f.$data,d="";if(p){var h=e.util.getData(f.$data,i,e.dataPathArr),_="format"+a,g="compare"+a;n+=" var "+_+" = formats["+h+"] , "+g+" = "+_+" && "+_+".compare;"}else{var _=e.formats[f];if(!_||!_.compare)return n+="  "+$+" = true; ";var g="formats"+e.util.getProperty(f)+".compare"}var m,y="formatMaximum"==t,v="formatExclusive"+(y?"Maximum":"Minimum"),b=e.schema[v],x=e.opts.v5&&b&&b.$data,w=y?"<":">",A="result"+a,k=e.opts.v5&&o&&o.$data;if(k?(n+=" var schema"+a+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",m="schema"+a):m=o,x){var E=e.util.getData(b.$data,i,e.dataPathArr),C="exclusive"+a,S="op"+a,I="' + "+S+" + '";n+=" var schemaExcl"+a+" = "+E+"; ",E="schemaExcl"+a,n+=" if (typeof "+E+" != 'boolean' && "+E+" !== undefined) { "+$+" = false; ";var r=v,O=O||[];O.push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(r||"_formatExclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: '"+v+" should be boolean' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),n+=" } "):n+=" {} ";var T=n;n=O.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+T+"]); ":n+=" validate.errors = ["+T+"]; return false; ":n+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }  ",c&&(d+="}",n+=" else { "),k&&(n+=" if ("+m+" === undefined) "+$+" = true; else if (typeof "+m+" != 'string') "+$+" = false; else { ",d+="}"),p&&(n+=" if (!"+g+") "+$+" = true; else { ",d+="}"),n+=" var "+A+" = "+g+"("+u+",  ",n+=k?""+m:""+e.util.toQuotedString(o),n+=" ); if ("+A+" === undefined) "+$+" = false; var "+C+" = "+E+" === true; if ("+$+" === undefined) { "+$+" = "+C+" ? "+A+" "+w+" 0 : "+A+" "+w+"= 0; } if (!"+$+") var op"+a+" = "+C+" ? '"+w+"' : '"+w+"=';"}else{var C=!0===b,I=w;C||(I+="=");var S="'"+I+"'";k&&(n+=" if ("+m+" === undefined) "+$+" = true; else if (typeof "+m+" != 'string') "+$+" = false; else { ",d+="}"),p&&(n+=" if (!"+g+") "+$+" = true; else { ",d+="}"),n+=" var "+A+" = "+g+"("+u+",  ",n+=k?""+m:""+e.util.toQuotedString(o),n+=" ); if ("+A+" === undefined) "+$+" = false; if ("+$+" === undefined) "+$+" = "+A+" "+w,C||(n+="="),n+=" 0;"}n+=d+"if (!"+$+") { ";var r=t,O=O||[];O.push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(r||"_formatLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { comparison: "+S+", limit:  ",n+=k?""+m:""+e.util.toQuotedString(o),n+=" , exclusive: "+C+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be "+I+' "',n+=k?"' + "+m+" + '":""+e.util.escapeQuotes(o),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=k?"validate.schema"+s:""+e.util.toQuotedString(o),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),n+=" } "):n+=" {} ";var T=n;return n=O.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+T+"]); ":n+=" validate.errors = ["+T+"]; return false; ":n+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+="}"}},{}],16:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,a=" ",i=e.level,o=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,$="data"+(o||""),f=e.opts.v5&&s&&s.$data;f?(a+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maximum"==t,d=p?"exclusiveMaximum":"exclusiveMinimum",h=e.schema[d],_=e.opts.v5&&h&&h.$data,g=p?"<":">",m=p?">":"<";if(_){var y=e.util.getData(h.$data,o,e.dataPathArr),v="exclusive"+i,b="op"+i,x="' + "+b+" + '";a+=" var schemaExcl"+i+" = "+y+"; ",y="schemaExcl"+i,a+=" var exclusive"+i+"; if (typeof "+y+" != 'boolean' && typeof "+y+" != 'undefined') { ";var r=d,w=w||[];w.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(r||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",!1!==e.opts.messages&&(a+=" , message: '"+d+" should be boolean' "),e.opts.verbose&&(a+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+$+" "),a+=" } "):a+=" {} ";var A=a;a=w.pop(),!e.compositeRule&&u?e.async?a+=" throw new ValidationError(["+A+"]); ":a+=" validate.errors = ["+A+"]; return false; ":a+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } else if( ",f&&(a+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),a+=" ((exclusive"+i+" = "+y+" === true) ? "+$+" "+m+"= "+n+" : "+$+" "+m+" "+n+") || "+$+" !== "+$+") { var op"+i+" = exclusive"+i+" ? '"+g+"' : '"+g+"=';"}else{var v=!0===h,x=g;v||(x+="=");var b="'"+x+"'";a+=" if ( ",f&&(a+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),a+=" "+$+" "+m,v&&(a+="="),a+=" "+n+" || "+$+" !== "+$+") {"}var r=t,w=w||[];w.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(r||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { comparison: "+b+", limit: "+n+", exclusive: "+v+" } ",!1!==e.opts.messages&&(a+=" , message: 'should be "+x+" ",a+=f?"' + "+n:s+"'"),e.opts.verbose&&(a+=" , schema:  ",a+=f?"validate.schema"+l:""+s,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+$+" "),a+=" } "):a+=" {} ";var A=a;return a=w.pop(),!e.compositeRule&&u?e.async?a+=" throw new ValidationError(["+A+"]); ":a+=" validate.errors = ["+A+"]; return false; ":a+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } ",u&&(a+=" else { "),a}},{}],17:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,a=" ",i=e.level,o=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,$="data"+(o||""),f=e.opts.v5&&s&&s.$data;f?(a+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maxItems"==t?">":"<";a+="if ( ",f&&(a+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),a+=" "+$+".length "+p+" "+n+") { ";var r=t,d=d||[];d.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(r||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(a+=" , message: 'should NOT have ",a+="maxItems"==t?"more":"less",a+=" than ",a+=f?"' + "+n+" + '":""+s,a+=" items' "),e.opts.verbose&&(a+=" , schema:  ",a+=f?"validate.schema"+l:""+s,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+$+" "),a+=" } "):a+=" {} ";var h=a;return a=d.pop(),!e.compositeRule&&u?e.async?a+=" throw new ValidationError(["+h+"]); ":a+=" validate.errors = ["+h+"]; return false; ":a+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",u&&(a+=" else { "),a}},{}],18:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,a=" ",i=e.level,o=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,$="data"+(o||""),f=e.opts.v5&&s&&s.$data;f?(a+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maxLength"==t?">":"<";a+="if ( ",f&&(a+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),!1===e.opts.unicode?a+=" "+$+".length ":a+=" ucs2length("+$+") ",a+=" "+p+" "+n+") { ";var r=t,d=d||[];d.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(r||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(a+=" , message: 'should NOT be ",a+="maxLength"==t?"longer":"shorter",a+=" than ",a+=f?"' + "+n+" + '":""+s,a+=" characters' "),e.opts.verbose&&(a+=" , schema:  ",a+=f?"validate.schema"+l:""+s,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+$+" "),a+=" } "):a+=" {} ";var h=a;return a=d.pop(),!e.compositeRule&&u?e.async?a+=" throw new ValidationError(["+h+"]); ":a+=" validate.errors = ["+h+"]; return false; ":a+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",u&&(a+=" else { "),a}},{}],19:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,a=" ",i=e.level,o=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,$="data"+(o||""),f=e.opts.v5&&s&&s.$data;f?(a+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",n="schema"+i):n=s;var p="maxProperties"==t?">":"<";a+="if ( ",f&&(a+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),a+=" Object.keys("+$+").length "+p+" "+n+") { ";var r=t,d=d||[];d.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(r||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(a+=" , message: 'should NOT have ",a+="maxProperties"==t?"more":"less",a+=" than ",a+=f?"' + "+n+" + '":""+s,a+=" properties' "),e.opts.verbose&&(a+=" , schema:  ",a+=f?"validate.schema"+l:""+s,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+$+" "),a+=" } "):a+=" {} ";var h=a;return a=d.pop(),!e.compositeRule&&u?e.async?a+=" throw new ValidationError(["+h+"]); ":a+=" validate.errors = ["+h+"]; return false; ":a+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",u&&(a+=" else { "),a}},{}],20:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.schema[t],a=e.schemaPath+e.util.getProperty(t),i=e.errSchemaPath+"/"+t,o=!e.opts.allErrors,s=e.util.copy(e),l="";s.level++;var c="valid"+s.level,u=s.baseId,$=!0,f=n;if(f)for(var p,d=-1,h=f.length-1;d<h;)p=f[d+=1],e.util.schemaHasRules(p,e.RULES.all)&&($=!1,s.schema=p,s.schemaPath=a+"["+d+"]",s.errSchemaPath=i+"/"+d,r+="  "+e.validate(s)+" ",s.baseId=u,o&&(r+=" if ("+c+") { ",l+="}"));return o&&(r+=$?" if (true) { ":" "+l.slice(0,-1)+" "),r=e.util.cleanUpCode(r)}},{}],21:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$="errs__"+n,f=e.util.copy(e),p="";f.level++;var d="valid"+f.level;if(i.every(function(t){return e.util.schemaHasRules(t,e.RULES.all)})){var h=f.baseId;r+=" var "+$+" = errors; var "+u+" = false;  ";var _=e.compositeRule;e.compositeRule=f.compositeRule=!0;var g=i;if(g)for(var m,y=-1,v=g.length-1;y<v;)m=g[y+=1],f.schema=m,f.schemaPath=o+"["+y+"]",f.errSchemaPath=s+"/"+y,r+="  "+e.validate(f)+" ",f.baseId=h,r+=" "+u+" = "+u+" || "+d+"; if (!"+u+") { ",p+="}";e.compositeRule=f.compositeRule=_,r+=" "+p+" if (!"+u+") {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else {  errors = "+$+"; if (vErrors !== null) { if ("+$+") vErrors.length = "+$+"; else vErrors = null; } ",e.opts.allErrors&&(r+=" } "),r=e.util.cleanUpCode(r)}else l&&(r+=" if (true) { ");return r}},{}],22:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$=e.opts.v5&&i&&i.$data;$&&(r+=" var schema"+n+" = "+e.util.getData(i.$data,a,e.dataPathArr)+"; "),$||(r+=" var schema"+n+" = validate.schema"+o+";"),r+="var "+u+" = equal("+c+", schema"+n+"); if (!"+u+") {   ";var f=f||[];f.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'constant' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should be equal to constant' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var p=r;return r=f.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+p+"]); ":r+=" validate.errors = ["+p+"]; return false; ":r+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" }"}},{}],23:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,a=" ",i=e.level,o=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,$="data"+(o||""),f="valid"+i,p="errs__"+i,d=e.opts.v5&&s&&s.$data;d?(a+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",n="schema"+i):n=s;var h,_,g,m,y,v=this,b="definition"+i,x=v.definition;if(d&&x.$data){y="keywordValidate"+i;var w=x.validateSchema;a+=" var "+b+" = RULES.custom['"+t+"'].definition; var "+y+" = "+b+".validate;"}else m=e.useCustomRule(v,s,e.schema,e),n="validate.schema"+l,y=m.code,h=x.compile,_=x.inline,g=x.macro;var A=y+".errors",k="i"+i,E="ruleErr"+i,C=x.async;if(C&&!e.async)throw new Error("async keyword in sync schema");if(_||g||(a+=A+" = null;"),a+="var "+p+" = errors;var "+f+";",w&&(a+=" "+f+" = "+b+".validateSchema("+n+"); if ("+f+") {"),_)x.statements?a+=" "+m.validate+" ":a+=" "+f+" = "+m.validate+"; ";else if(g){var S=e.util.copy(e);S.level++;var I="valid"+S.level;S.schema=m.validate,S.schemaPath="";var O=e.compositeRule;e.compositeRule=S.compositeRule=!0;var T=e.validate(S).replace(/validate\.schema/g,y);e.compositeRule=S.compositeRule=O,a+=" "+T}else{var P=P||[];P.push(a),a="",a+="  "+y+".call( ",e.opts.passContext?a+="this":a+="self",h||!1===x.schema?a+=" , "+$+" ":a+=" , "+n+" , "+$+" , validate.schema"+e.schemaPath+" ",a+=" , (dataPath || '')",'""'!=e.errorPath&&(a+=" + "+e.errorPath);var M=o?"data"+(o-1||""):"parentData",N=o?e.dataPathArr[o]:"parentDataProperty";a+=" , "+M+" , "+N+" , rootData )  ";var B=a;a=P.pop(),!1===x.errors?(a+=" "+f+" = ",C&&(a+=""+e.yieldAwait),a+=B+"; "):C?(A="customErrors"+i,a+=" var "+A+" = null; try { "+f+" = "+e.yieldAwait+B+"; } catch (e) { "+f+" = false; if (e instanceof ValidationError) "+A+" = e.errors; else throw e; } "):a+=" "+A+" = null; "+f+" = "+B+"; "}if(x.modifying&&(a+=" "+$+" = "+M+"["+N+"];"),w&&(a+=" }"),x.valid)u&&(a+=" if (true) { ");else{a+=" if ( ",void 0===x.valid?(a+=" !",a+=g?""+I:""+f):a+=" "+!x.valid+" ",a+=") { ",r=v.keyword;var P=P||[];P.push(a),a="";var P=P||[];P.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(r||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+v.keyword+"' } ",!1!==e.opts.messages&&(a+=" , message: 'should pass \""+v.keyword+"\" keyword validation' "),e.opts.verbose&&(a+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+$+" "),a+=" } "):a+=" {} ";var R=a;a=P.pop(),!e.compositeRule&&u?e.async?a+=" throw new ValidationError(["+R+"]); ":a+=" validate.errors = ["+R+"]; return false; ":a+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var j=a;a=P.pop(),_?x.errors?"full"!=x.errors&&(a+="  for (var "+k+"="+p+"; "+k+"<errors; "+k+"++) { var "+E+" = vErrors["+k+"]; if ("+E+".dataPath === undefined) "+E+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+E+".schemaPath === undefined) { "+E+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(a+=" "+E+".schema = "+n+"; "+E+".data = "+$+"; "),a+=" } "):!1===x.errors?a+=" "+j+" ":(a+=" if ("+p+" == errors) { "+j+" } else {  for (var "+k+"="+p+"; "+k+"<errors; "+k+"++) { var "+E+" = vErrors["+k+"]; if ("+E+".dataPath === undefined) "+E+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+E+".schemaPath === undefined) { "+E+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(a+=" "+E+".schema = "+n+"; "+E+".data = "+$+"; "),a+=" } } "):g?(a+="   var err =   ",!1!==e.createErrors?(a+=" { keyword: '"+(r||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+v.keyword+"' } ",!1!==e.opts.messages&&(a+=" , message: 'should pass \""+v.keyword+"\" keyword validation' "),e.opts.verbose&&(a+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+$+" "),a+=" } "):a+=" {} ",a+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?a+=" throw new ValidationError(vErrors); ":a+=" validate.errors = vErrors; return false; ")):!1===x.errors?a+=" "+j+" ":(a+=" if (Array.isArray("+A+")) { if (vErrors === null) vErrors = "+A+"; else vErrors = vErrors.concat("+A+"); errors = vErrors.length;  for (var "+k+"="+p+"; "+k+"<errors; "+k+"++) { var "+E+" = vErrors["+k+"]; if ("+E+".dataPath === undefined) "+E+".dataPath = (dataPath || '') + "+e.errorPath+";  "+E+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(a+=" "+E+".schema = "+n+"; "+E+".data = "+$+"; "),a+=" } } else { "+j+" } "),a+=" } ",u&&(a+=" else { ")}return a}},{}],24:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="errs__"+n,$=e.util.copy(e),f="";$.level++;var p="valid"+$.level,d={},h={};for(y in i){var _=i[y],g=Array.isArray(_)?h:d;g[y]=_}r+="var "+u+" = errors;";var m=e.errorPath;r+="var missing"+n+";";for(var y in h){if(g=h[y],r+=" if ("+c+e.util.getProperty(y)+" !== undefined ",l){r+=" && ( ";var v=g;if(v)for(var b,x=-1,w=v.length-1;x<w;){b=v[x+=1],x&&(r+=" || ");var A=e.util.getProperty(b);r+=" ( "+c+A+" === undefined && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?b:A)+") ) "}r+=")) {  ";var k="missing"+n,E="' + "+k+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(m,k,!0):m+" + "+k);var C=C||[];C.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { property: '"+e.util.escapeQuotes(y)+"', missingProperty: '"+E+"', depsCount: "+g.length+", deps: '"+e.util.escapeQuotes(1==g.length?g[0]:g.join(", "))+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should have ",1==g.length?r+="property "+e.util.escapeQuotes(g[0]):r+="properties "+e.util.escapeQuotes(g.join(", ")),r+=" when property "+e.util.escapeQuotes(y)+" is present' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var S=r;r=C.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+S+"]); ":r+=" validate.errors = ["+S+"]; return false; ":r+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{r+=" ) { ";var I=g;if(I)for(var O,T=-1,P=I.length-1;T<P;){O=I[T+=1];var A=e.util.getProperty(O),E=e.util.escapeQuotes(O);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(m,O,e.opts.jsonPointers)),r+=" if ("+c+A+" === undefined) {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { property: '"+e.util.escapeQuotes(y)+"', missingProperty: '"+E+"', depsCount: "+g.length+", deps: '"+e.util.escapeQuotes(1==g.length?g[0]:g.join(", "))+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should have ",1==g.length?r+="property "+e.util.escapeQuotes(g[0]):r+="properties "+e.util.escapeQuotes(g.join(", ")),r+=" when property "+e.util.escapeQuotes(y)+" is present' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}r+=" }   ",l&&(f+="}",r+=" else { ")}e.errorPath=m;var M=$.baseId;for(var y in d){var _=d[y];e.util.schemaHasRules(_,e.RULES.all)&&(r+=" "+p+" = true; if ("+c+e.util.getProperty(y)+" !== undefined) { ",$.schema=_,$.schemaPath=o+e.util.getProperty(y),$.errSchemaPath=s+"/"+e.util.escapeFragment(y),r+="  "+e.validate($)+" ",$.baseId=M,r+=" }  ",l&&(r+=" if ("+p+") { ",f+="}"))}return l&&(r+="   "+f+" if ("+u+" == errors) {"),r=e.util.cleanUpCode(r)}},{}],25:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$=e.opts.v5&&i&&i.$data;$&&(r+=" var schema"+n+" = "+e.util.getData(i.$data,a,e.dataPathArr)+"; ");var f="i"+n,p="schema"+n;$||(r+=" var "+p+" = validate.schema"+o+";"),r+="var "+u+";",$&&(r+=" if (schema"+n+" === undefined) "+u+" = true; else if (!Array.isArray(schema"+n+")) "+u+" = false; else {"),r+=u+" = false;for (var "+f+"=0; "+f+"<"+p+".length; "+f+"++) if (equal("+c+", "+p+"["+f+"])) { "+u+" = true; break; }",$&&(r+="  }  "),r+=" if (!"+u+") {   ";var d=d||[];d.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { allowedValues: schema"+n+" } ",!1!==e.opts.messages&&(r+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var h=r;return r=d.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+h+"]); ":r+=" validate.errors = ["+h+"]; return false; ":r+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" }",l&&(r+=" else { "),r}},{}],26:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||"");if(!1===e.opts.format)return l&&(r+=" if (true) { "),r;var u,$=e.opts.v5&&i&&i.$data;$?(r+=" var schema"+n+" = "+e.util.getData(i.$data,a,e.dataPathArr)+"; ",u="schema"+n):u=i;var f=e.opts.unknownFormats,p=Array.isArray(f);if($){var d="format"+n;r+=" var "+d+" = formats["+u+"]; var isObject"+n+" = typeof "+d+" == 'object' && !("+d+" instanceof RegExp) && "+d+".validate; if (isObject"+n+") { ",e.async&&(r+=" var async"+n+" = "+d+".async; "),r+=" "+d+" = "+d+".validate; } if (  ",$&&(r+=" ("+u+" !== undefined && typeof "+u+" != 'string') || "),r+=" (",(!0===f||p)&&(r+=" ("+u+" && !"+d+" ",p&&(r+=" && self._opts.unknownFormats.indexOf("+u+") == -1 "),r+=") || "),r+=" ("+d+" && !(typeof "+d+" == 'function' ? ",e.async?r+=" (async"+n+" ? "+e.yieldAwait+" "+d+"("+c+") : "+d+"("+c+")) ":r+=" "+d+"("+c+") ",r+=" : "+d+".test("+c+"))))) {"}else{var d=e.formats[i];if(!d){if(!0===f||p&&-1==f.indexOf(i))throw new Error('unknown format "'+i+'" is used in schema at path "'+e.errSchemaPath+'"');return p||(console.warn('unknown format "'+i+'" ignored in schema at path "'+e.errSchemaPath+'"'),"ignore"!==f&&console.warn("In the next major version it will throw exception. See option unknownFormats for more information")),l&&(r+=" if (true) { "),r}var h="object"==typeof d&&!(d instanceof RegExp)&&d.validate;if(h){var _=!0===d.async;d=d.validate}if(_){if(!e.async)throw new Error("async format in sync schema");var g="formats"+e.util.getProperty(i)+".validate";r+=" if (!("+e.yieldAwait+" "+g+"("+c+"))) { "}else{r+=" if (! ";var g="formats"+e.util.getProperty(i);h&&(g+=".validate"),r+="function"==typeof d?" "+g+"("+c+") ":" "+g+".test("+c+") ",r+=") { "}}var m=m||[];m.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { format:  ",r+=$?""+u:""+e.util.toQuotedString(i),r+="  } ",!1!==e.opts.messages&&(r+=" , message: 'should match format \"",r+=$?"' + "+u+" + '":""+e.util.escapeQuotes(i),r+="\"' "),e.opts.verbose&&(r+=" , schema:  ",r+=$?"validate.schema"+o:""+e.util.toQuotedString(i),r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var y=r;return r=m.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",l&&(r+=" else { "),r}},{}],27:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$="errs__"+n,f=e.util.copy(e),p="";f.level++;var d="valid"+f.level,h="i"+n,_=f.dataLevel=e.dataLevel+1,g="data"+_,m=e.baseId;if(r+="var "+$+" = errors;var "+u+";",Array.isArray(i)){var y=e.schema.additionalItems;if(!1===y){r+=" "+u+" = "+c+".length <= "+i.length+"; ";var v=s;s=e.errSchemaPath+"/additionalItems",r+="  if (!"+u+") {   ";var b=b||[];b.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { limit: "+i.length+" } ",!1!==e.opts.messages&&(r+=" , message: 'should NOT have more than "+i.length+" items' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var x=r;r=b.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+x+"]); ":r+=" validate.errors = ["+x+"]; return false; ":r+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",s=v,l&&(p+="}",r+=" else { ")}var w=i;if(w)for(var A,k=-1,E=w.length-1;k<E;)if(A=w[k+=1],e.util.schemaHasRules(A,e.RULES.all)){r+=" "+d+" = true; if ("+c+".length > "+k+") { ";var C=c+"["+k+"]";f.schema=A,f.schemaPath=o+"["+k+"]",f.errSchemaPath=s+"/"+k,f.errorPath=e.util.getPathExpr(e.errorPath,k,e.opts.jsonPointers,!0),f.dataPathArr[_]=k;var S=e.validate(f);f.baseId=m,e.util.varOccurences(S,g)<2?r+=" "+e.util.varReplace(S,g,C)+" ":r+=" var "+g+" = "+C+"; "+S+" ",r+=" }  ",l&&(r+=" if ("+d+") { ",p+="}")}if("object"==typeof y&&e.util.schemaHasRules(y,e.RULES.all)){f.schema=y,f.schemaPath=e.schemaPath+".additionalItems",f.errSchemaPath=e.errSchemaPath+"/additionalItems",r+=" "+d+" = true; if ("+c+".length > "+i.length+") {  for (var "+h+" = "+i.length+"; "+h+" < "+c+".length; "+h+"++) { ",f.errorPath=e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers,!0);var C=c+"["+h+"]";f.dataPathArr[_]=h;var S=e.validate(f);f.baseId=m,e.util.varOccurences(S,g)<2?r+=" "+e.util.varReplace(S,g,C)+" ":r+=" var "+g+" = "+C+"; "+S+" ",l&&(r+=" if (!"+d+") break; "),r+=" } }  ",l&&(r+=" if ("+d+") { ",p+="}")}}else if(e.util.schemaHasRules(i,e.RULES.all)){f.schema=i,f.schemaPath=o,f.errSchemaPath=s,r+="  for (var "+h+" = 0; "+h+" < "+c+".length; "+h+"++) { ",f.errorPath=e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers,!0);var C=c+"["+h+"]";f.dataPathArr[_]=h;var S=e.validate(f);f.baseId=m,e.util.varOccurences(S,g)<2?r+=" "+e.util.varReplace(S,g,C)+" ":r+=" var "+g+" = "+C+"; "+S+" ",l&&(r+=" if (!"+d+") break; "),r+=" }  ",l&&(r+=" if ("+d+") { ",p+="}")}return l&&(r+=" "+p+" if ("+$+" == errors) {"),r=e.util.cleanUpCode(r)}},{}],28:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n=" ",a=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(i||""),$=e.opts.v5&&o&&o.$data;$?(n+=" var schema"+a+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",r="schema"+a):r=o,n+="var division"+a+";if (",$&&(n+=" "+r+" !== undefined && ( typeof "+r+" != 'number' || "),n+=" (division"+a+" = "+u+" / "+r+", ",e.opts.multipleOfPrecision?n+=" Math.abs(Math.round(division"+a+") - division"+a+") > 1e-"+e.opts.multipleOfPrecision+" ":n+=" division"+a+" !== parseInt(division"+a+") ",n+=" ) ",$&&(n+="  )  "),n+=" ) {   ";var f=f||[];f.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { multipleOf: "+r+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be multiple of ",n+=$?"' + "+r:o+"'"),e.opts.verbose&&(n+=" , schema:  ",n+=$?"validate.schema"+s:""+o,n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),n+=" } "):n+=" {} ";var p=n;return n=f.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+p+"]); ":n+=" validate.errors = ["+p+"]; return false; ":n+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+="} ",c&&(n+=" else { "),n}},{}],29:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="errs__"+n,$=e.util.copy(e);$.level++;var f="valid"+$.level;if(e.util.schemaHasRules(i,e.RULES.all)){$.schema=i,$.schemaPath=o,$.errSchemaPath=s,r+=" var "+u+" = errors;  ";var p=e.compositeRule;e.compositeRule=$.compositeRule=!0,$.createErrors=!1;var d;$.opts.allErrors&&(d=$.opts.allErrors,$.opts.allErrors=!1),r+=" "+e.validate($)+" ",$.createErrors=!0,d&&($.opts.allErrors=d),e.compositeRule=$.compositeRule=p,r+=" if ("+f+") {   ";var h=h||[];h.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should NOT be valid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var _=r;r=h.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+_+"]); ":r+=" validate.errors = ["+_+"]; return false; ":r+=" var err = "+_+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else {  errors = "+u+"; if (vErrors !== null) { if ("+u+") vErrors.length = "+u+"; else vErrors = null; } ",e.opts.allErrors&&(r+=" } ")}else r+="  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should NOT be valid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(r+=" if (false) { ");return r}},{}],30:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$="errs__"+n,f=e.util.copy(e),p="";f.level++;var d="valid"+f.level;r+="var "+$+" = errors;var prevValid"+n+" = false;var "+u+" = false;";var h=f.baseId,_=e.compositeRule;e.compositeRule=f.compositeRule=!0;var g=i;if(g)for(var m,y=-1,v=g.length-1;y<v;)m=g[y+=1],e.util.schemaHasRules(m,e.RULES.all)?(f.schema=m,f.schemaPath=o+"["+y+"]",f.errSchemaPath=s+"/"+y,r+="  "+e.validate(f)+" ",f.baseId=h):r+=" var "+d+" = true; ",y&&(r+=" if ("+d+" && prevValid"+n+") "+u+" = false; else { ",p+="}"),r+=" if ("+d+") "+u+" = prevValid"+n+" = true;";e.compositeRule=f.compositeRule=_,r+=p+"if (!"+u+") {   ";var b=b||[];b.push(r),r="",
!1!==e.createErrors?(r+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var x=r;return r=b.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+x+"]); ":r+=" validate.errors = ["+x+"]; return false; ":r+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+="} else {  errors = "+$+"; if (vErrors !== null) { if ("+$+") vErrors.length = "+$+"; else vErrors = null; }",e.opts.allErrors&&(r+=" } "),r}},{}],31:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n=" ",a=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(i||""),$=e.opts.v5&&o&&o.$data;$?(n+=" var schema"+a+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",r="schema"+a):r=o;var f=$?"(new RegExp("+r+"))":e.usePattern(o);n+="if ( ",$&&(n+=" ("+r+" !== undefined && typeof "+r+" != 'string') || "),n+=" !"+f+".test("+u+") ) {   ";var p=p||[];p.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { pattern:  ",n+=$?""+r:""+e.util.toQuotedString(o),n+="  } ",!1!==e.opts.messages&&(n+=" , message: 'should match pattern \"",n+=$?"' + "+r+" + '":""+e.util.escapeQuotes(o),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=$?"validate.schema"+s:""+e.util.toQuotedString(o),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),n+=" } "):n+=" {} ";var d=n;return n=p.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+d+"]); ":n+=" validate.errors = ["+d+"]; return false; ":n+=" var err = "+d+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+="} ",c&&(n+=" else { "),n}},{}],32:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$="key"+n,f="patternMatched"+n,p="",d=e.opts.ownProperties;r+="var "+u+" = true;";var h=i;if(h)for(var _,g=-1,m=h.length-1;g<m;){_=h[g+=1],r+=" var "+f+" = false; for (var "+$+" in "+c+") {  ",d&&(r+=" if (!Object.prototype.hasOwnProperty.call("+c+", "+$+")) continue; "),r+=" "+f+" = "+e.usePattern(_)+".test("+$+"); if ("+f+") break; } ";var y=e.util.escapeQuotes(_);r+=" if (!"+f+") { "+u+" = false;  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'patternRequired' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { missingPattern: '"+y+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should have property matching pattern \\'"+y+"\\'' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; }   ",l&&(p+="}",r+=" else { ")}return r+=""+p}},{}],33:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$="errs__"+n,f=e.util.copy(e),p="";f.level++;var d="valid"+f.level,h="key"+n,_=f.dataLevel=e.dataLevel+1,g="data"+_,m=Object.keys(i||{}),y=e.schema.patternProperties||{},v=Object.keys(y),b=e.schema.additionalProperties,x=m.length||v.length,w=!1===b,A="object"==typeof b&&Object.keys(b).length,k=e.opts.removeAdditional,E=w||A||k,C=e.opts.ownProperties,S=e.baseId,I=e.schema.required;if(I&&(!e.opts.v5||!I.$data)&&I.length<e.opts.loopRequired)var O=e.util.toHash(I);if(e.opts.v5)var T=e.schema.patternGroups||{},P=Object.keys(T);if(r+="var "+$+" = errors;var "+d+" = true;",E){if(r+=" for (var "+h+" in "+c+") {  ",C&&(r+=" if (!Object.prototype.hasOwnProperty.call("+c+", "+h+")) continue; "),x){if(r+=" var isAdditional"+n+" = !(false ",m.length)if(m.length>5)r+=" || validate.schema"+o+"["+h+"] ";else{var M=m;if(M)for(var N,B=-1,R=M.length-1;B<R;)N=M[B+=1],r+=" || "+h+" == "+e.util.toQuotedString(N)+" "}if(v.length){var j=v;if(j)for(var F,D=-1,L=j.length-1;D<L;)F=j[D+=1],r+=" || "+e.usePattern(F)+".test("+h+") "}if(e.opts.v5&&P&&P.length){var z=P;if(z)for(var q,D=-1,U=z.length-1;D<U;)q=z[D+=1],r+=" || "+e.usePattern(q)+".test("+h+") "}r+=" ); if (isAdditional"+n+") { "}if("all"==k)r+=" delete "+c+"["+h+"]; ";else{var H=e.errorPath,G="' + "+h+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers)),w)if(k)r+=" delete "+c+"["+h+"]; ";else{r+=" "+d+" = false; ";var Y=s;s=e.errSchemaPath+"/additionalProperties";var Q=Q||[];Q.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { additionalProperty: '"+G+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should NOT have additional properties' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var V=r;r=Q.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+V+"]); ":r+=" validate.errors = ["+V+"]; return false; ":r+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s=Y,l&&(r+=" break; ")}else if(A)if("failing"==k){r+=" var "+$+" = errors;  ";var X=e.compositeRule;e.compositeRule=f.compositeRule=!0,f.schema=b,f.schemaPath=e.schemaPath+".additionalProperties",f.errSchemaPath=e.errSchemaPath+"/additionalProperties",f.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers);var W=c+"["+h+"]";f.dataPathArr[_]=h;var J=e.validate(f);f.baseId=S,e.util.varOccurences(J,g)<2?r+=" "+e.util.varReplace(J,g,W)+" ":r+=" var "+g+" = "+W+"; "+J+" ",r+=" if (!"+d+") { errors = "+$+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+c+"["+h+"]; }  ",e.compositeRule=f.compositeRule=X}else{f.schema=b,f.schemaPath=e.schemaPath+".additionalProperties",f.errSchemaPath=e.errSchemaPath+"/additionalProperties",f.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers);var W=c+"["+h+"]";f.dataPathArr[_]=h;var J=e.validate(f);f.baseId=S,e.util.varOccurences(J,g)<2?r+=" "+e.util.varReplace(J,g,W)+" ":r+=" var "+g+" = "+W+"; "+J+" ",l&&(r+=" if (!"+d+") break; ")}e.errorPath=H}x&&(r+=" } "),r+=" }  ",l&&(r+=" if ("+d+") { ",p+="}")}var K=e.opts.useDefaults&&!e.compositeRule;if(m.length){var Z=m;if(Z)for(var N,ee=-1,te=Z.length-1;ee<te;){N=Z[ee+=1];var re=i[N];if(e.util.schemaHasRules(re,e.RULES.all)){var ne=e.util.getProperty(N),W=c+ne,ae=K&&void 0!==re.default;f.schema=re,f.schemaPath=o+ne,f.errSchemaPath=s+"/"+e.util.escapeFragment(N),f.errorPath=e.util.getPath(e.errorPath,N,e.opts.jsonPointers),f.dataPathArr[_]=e.util.toQuotedString(N);var J=e.validate(f);if(f.baseId=S,e.util.varOccurences(J,g)<2){J=e.util.varReplace(J,g,W);var ie=W}else{var ie=g;r+=" var "+g+" = "+W+"; "}if(ae)r+=" "+J+" ";else{if(O&&O[N]){r+=" if ("+ie+" === undefined) { "+d+" = false; ";var H=e.errorPath,Y=s,oe=e.util.escapeQuotes(N);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(H,N,e.opts.jsonPointers)),s=e.errSchemaPath+"/required";var Q=Q||[];Q.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { missingProperty: '"+oe+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+oe+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var V=r;r=Q.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+V+"]); ":r+=" validate.errors = ["+V+"]; return false; ":r+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s=Y,e.errorPath=H,r+=" } else { "}else r+=l?" if ("+ie+" === undefined) { "+d+" = true; } else { ":" if ("+ie+" !== undefined) { ";r+=" "+J+" } "}}l&&(r+=" if ("+d+") { ",p+="}")}}var se=v;if(se)for(var F,le=-1,ce=se.length-1;le<ce;){F=se[le+=1];var re=y[F];if(e.util.schemaHasRules(re,e.RULES.all)){f.schema=re,f.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(F),f.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(F),r+=" for (var "+h+" in "+c+") {  ",C&&(r+=" if (!Object.prototype.hasOwnProperty.call("+c+", "+h+")) continue; "),r+=" if ("+e.usePattern(F)+".test("+h+")) { ",f.errorPath=e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers);var W=c+"["+h+"]";f.dataPathArr[_]=h;var J=e.validate(f);f.baseId=S,e.util.varOccurences(J,g)<2?r+=" "+e.util.varReplace(J,g,W)+" ":r+=" var "+g+" = "+W+"; "+J+" ",l&&(r+=" if (!"+d+") break; "),r+=" } ",l&&(r+=" else "+d+" = true; "),r+=" }  ",l&&(r+=" if ("+d+") { ",p+="}")}}if(e.opts.v5){var ue=P;if(ue)for(var q,$e=-1,fe=ue.length-1;$e<fe;){q=ue[$e+=1];var pe=T[q],re=pe.schema;if(e.util.schemaHasRules(re,e.RULES.all)){f.schema=re,f.schemaPath=e.schemaPath+".patternGroups"+e.util.getProperty(q)+".schema",f.errSchemaPath=e.errSchemaPath+"/patternGroups/"+e.util.escapeFragment(q)+"/schema",r+=" var pgPropCount"+n+" = 0; for (var "+h+" in "+c+") {  ",C&&(r+=" if (!Object.prototype.hasOwnProperty.call("+c+", "+h+")) continue; "),r+=" if ("+e.usePattern(q)+".test("+h+")) { pgPropCount"+n+"++; ",f.errorPath=e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers);var W=c+"["+h+"]";f.dataPathArr[_]=h;var J=e.validate(f);f.baseId=S,e.util.varOccurences(J,g)<2?r+=" "+e.util.varReplace(J,g,W)+" ":r+=" var "+g+" = "+W+"; "+J+" ",l&&(r+=" if (!"+d+") break; "),r+=" } ",l&&(r+=" else "+d+" = true; "),r+=" }  ",l&&(r+=" if ("+d+") { ",p+="}");var de=pe.minimum,he=pe.maximum;if(void 0!==de||void 0!==he){r+=" var "+u+" = true; ";var Y=s;if(void 0!==de){var _e=de,ge="minimum",me="less";r+=" "+u+" = pgPropCount"+n+" >= "+de+"; ",s=e.errSchemaPath+"/patternGroups/minimum",r+="  if (!"+u+") {   ";var Q=Q||[];Q.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'patternGroups' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { reason: '"+ge+"', limit: "+_e+", pattern: '"+e.util.escapeQuotes(q)+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should NOT have "+me+" than "+_e+' properties matching pattern "'+e.util.escapeQuotes(q)+"\"' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var V=r;r=Q.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+V+"]); ":r+=" validate.errors = ["+V+"]; return false; ":r+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",void 0!==he&&(r+=" else ")}if(void 0!==he){var _e=he,ge="maximum",me="more";r+=" "+u+" = pgPropCount"+n+" <= "+he+"; ",s=e.errSchemaPath+"/patternGroups/maximum",r+="  if (!"+u+") {   ";var Q=Q||[];Q.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'patternGroups' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { reason: '"+ge+"', limit: "+_e+", pattern: '"+e.util.escapeQuotes(q)+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should NOT have "+me+" than "+_e+' properties matching pattern "'+e.util.escapeQuotes(q)+"\"' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var V=r;r=Q.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+V+"]); ":r+=" validate.errors = ["+V+"]; return false; ":r+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } "}s=Y,l&&(r+=" if ("+u+") { ",p+="}")}}}}return l&&(r+=" "+p+" if ("+$+" == errors) {"),r=e.util.cleanUpCode(r)}},{}],34:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,a=" ",i=e.level,o=e.dataLevel,s=e.schema[t],l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(o||""),$="valid"+i;if("#"==s||"#/"==s)e.isRoot?(r=e.async,n="validate"):(r=!0===e.root.schema.$async,n="root.refVal[0]");else{var f=e.resolveRef(e.baseId,s,e.isRoot);if(void 0===f){var p="can't resolve reference "+s+" from id "+e.baseId;if("fail"==e.opts.missingRefs){console.log(p);var d=d||[];d.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { ref: '"+e.util.escapeQuotes(s)+"' } ",!1!==e.opts.messages&&(a+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(s)+"' "),e.opts.verbose&&(a+=" , schema: "+e.util.toQuotedString(s)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ";var h=a;a=d.pop(),!e.compositeRule&&c?e.async?a+=" throw new ValidationError(["+h+"]); ":a+=" validate.errors = ["+h+"]; return false; ":a+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(a+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs){var _=new Error(p);throw _.missingRef=e.resolve.url(e.baseId,s),_.missingSchema=e.resolve.normalizeId(e.resolve.fullPath(_.missingRef)),_}console.log(p),c&&(a+=" if (true) { ")}}else if(f.inline){var g=e.util.copy(e);g.level++;var m="valid"+g.level;g.schema=f.schema,g.schemaPath="",g.errSchemaPath=s;var y=e.validate(g).replace(/validate\.schema/g,f.code);a+=" "+y+" ",c&&(a+=" if ("+m+") { ")}else r=!0===f.$async,n=f.code}if(n){var d=d||[];d.push(a),a="",e.opts.passContext?a+=" "+n+".call(this, ":a+=" "+n+"( ",a+=" "+u+", (dataPath || '')",'""'!=e.errorPath&&(a+=" + "+e.errorPath);a+=" , "+(o?"data"+(o-1||""):"parentData")+" , "+(o?e.dataPathArr[o]:"parentDataProperty")+", rootData)  ";var v=a;if(a=d.pop(),r){if(!e.async)throw new Error("async schema referenced by sync schema");a+=" try { ",c&&(a+="var "+$+" ="),a+=" "+e.yieldAwait+" "+v+"; } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; } ",c&&(a+=" if ("+$+") { ")}else a+=" if (!"+v+") { if (vErrors === null) vErrors = "+n+".errors; else vErrors = vErrors.concat("+n+".errors); errors = vErrors.length; } ",c&&(a+=" else { ")}return a}},{}],35:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$=e.opts.v5&&i&&i.$data;$&&(r+=" var schema"+n+" = "+e.util.getData(i.$data,a,e.dataPathArr)+"; ");var f="schema"+n;if(!$)if(i.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var p=[],d=i;if(d)for(var h,_=-1,g=d.length-1;_<g;){h=d[_+=1];var m=e.schema.properties[h];m&&e.util.schemaHasRules(m,e.RULES.all)||(p[p.length]=h)}}else var p=i;if($||p.length){var y=e.errorPath,v=$||p.length>=e.opts.loopRequired;if(l)if(r+=" var missing"+n+"; ",v){$||(r+=" var "+f+" = validate.schema"+o+"; ");var b="i"+n,x="schema"+n+"["+b+"]",w="' + "+x+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(y,x,e.opts.jsonPointers)),r+=" var "+u+" = true; ",$&&(r+=" if (schema"+n+" === undefined) "+u+" = true; else if (!Array.isArray(schema"+n+")) "+u+" = false; else {"),r+=" for (var "+b+" = 0; "+b+" < "+f+".length; "+b+"++) { "+u+" = "+c+"["+f+"["+b+"]] !== undefined; if (!"+u+") break; } ",$&&(r+="  }  "),r+="  if (!"+u+") {   ";var A=A||[];A.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+w+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var k=r;r=A.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+k+"]); ":r+=" validate.errors = ["+k+"]; return false; ":r+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { "}else{r+=" if ( ";var E=p;if(E)for(var C,b=-1,S=E.length-1;b<S;){C=E[b+=1],b&&(r+=" || ");var I=e.util.getProperty(C);r+=" ( "+c+I+" === undefined && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?C:I)+") ) "}r+=") {  ";var x="missing"+n,w="' + "+x+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(y,x,!0):y+" + "+x);var A=A||[];A.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+w+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var k=r;r=A.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+k+"]); ":r+=" validate.errors = ["+k+"]; return false; ":r+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { "}else if(v){$||(r+=" var "+f+" = validate.schema"+o+"; ");var b="i"+n,x="schema"+n+"["+b+"]",w="' + "+x+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(y,x,e.opts.jsonPointers)),$&&(r+=" if ("+f+" && !Array.isArray("+f+")) {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+w+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+f+" !== undefined) { "),r+=" for (var "+b+" = 0; "+b+" < "+f+".length; "+b+"++) { if ("+c+"["+f+"["+b+"]] === undefined) {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+w+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",$&&(r+="  }  ")}else{var O=p;if(O)for(var T,P=-1,M=O.length-1;P<M;){T=O[P+=1];var I=e.util.getProperty(T),w=e.util.escapeQuotes(T);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(y,T,e.opts.jsonPointers)),r+=" if ("+c+I+" === undefined) {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { missingProperty: '"+w+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+w+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=y}else l&&(r+=" if (true) {");return r}},{}],36:[function(e,t,r){"use strict";t.exports=function(e,t){var r=" ",n=e.level,a=e.dataLevel,i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(a||""),u="valid"+n,$="errs__"+n,f=e.util.copy(e),p="";f.level++;var d,h="valid"+f.level,_="ifPassed"+e.level,g=f.baseId;r+="var "+_+";";var m=i;if(m)for(var y,v=-1,b=m.length-1;v<b;){if(y=m[v+=1],v&&!d&&(r+=" if (!"+_+") { ",p+="}"),y.if&&e.util.schemaHasRules(y.if,e.RULES.all)){r+=" var "+$+" = errors;   ";var x=e.compositeRule;if(e.compositeRule=f.compositeRule=!0,f.createErrors=!1,f.schema=y.if,f.schemaPath=o+"["+v+"].if",f.errSchemaPath=s+"/"+v+"/if",r+="  "+e.validate(f)+" ",f.baseId=g,f.createErrors=!0,e.compositeRule=f.compositeRule=x,r+=" "+_+" = "+h+"; if ("+_+") {  ","boolean"==typeof y.then){if(!1===y.then){var w=w||[];w.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'switch' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { caseIndex: "+v+" } ",!1!==e.opts.messages&&(r+=" , message: 'should pass \"switch\" keyword validation' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var A=r;r=w.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+A+"]); ":r+=" validate.errors = ["+A+"]; return false; ":r+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}r+=" var "+h+" = "+y.then+"; "}else f.schema=y.then,f.schemaPath=o+"["+v+"].then",f.errSchemaPath=s+"/"+v+"/then",r+="  "+e.validate(f)+" ",f.baseId=g;r+="  } else {  errors = "+$+"; if (vErrors !== null) { if ("+$+") vErrors.length = "+$+"; else vErrors = null; } } "}else if(r+=" "+_+" = true;  ","boolean"==typeof y.then){if(!1===y.then){var w=w||[];w.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'switch' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(s)+" , params: { caseIndex: "+v+" } ",!1!==e.opts.messages&&(r+=" , message: 'should pass \"switch\" keyword validation' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var A=r;r=w.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+A+"]); ":r+=" validate.errors = ["+A+"]; return false; ":r+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}r+=" var "+h+" = "+y.then+"; "}else f.schema=y.then,f.schemaPath=o+"["+v+"].then",f.errSchemaPath=s+"/"+v+"/then",r+="  "+e.validate(f)+" ",f.baseId=g;d=y.continue}return r+=p+"var "+u+" = "+h+"; ",r=e.util.cleanUpCode(r)}},{}],37:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n=" ",a=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(i||""),$="valid"+a,f=e.opts.v5&&o&&o.$data;if(f?(n+=" var schema"+a+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",r="schema"+a):r=o,(o||f)&&!1!==e.opts.uniqueItems){f&&(n+=" var "+$+"; if ("+r+" === false || "+r+" === undefined) "+$+" = true; else if (typeof "+r+" != 'boolean') "+$+" = false; else { "),n+=" var "+$+" = true; if ("+u+".length > 1) { var i = "+u+".length, j; outer: for (;i--;) { for (j = i; j--;) { if (equal("+u+"[i], "+u+"[j])) { "+$+" = false; break outer; } } } } ",f&&(n+="  }  "),n+=" if (!"+$+") {   ";var p=p||[];p.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(n+=" , schema:  ",n+=f?"validate.schema"+s:""+o,n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),n+=" } "):n+=" {} ";var d=n;n=p.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+d+"]); ":n+=" validate.errors = ["+d+"]; return false; ":n+=" var err = "+d+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",c&&(n+=" else { ")}else c&&(n+=" if (true) { ");return n}},{}],38:[function(e,t,r){"use strict";t.exports=function(e,t){function r(t){return void 0!==e.schema[t.keyword]||"properties"==t.keyword&&(!1===e.schema.additionalProperties||"object"==typeof e.schema.additionalProperties||e.schema.patternProperties&&Object.keys(e.schema.patternProperties).length||e.opts.v5&&e.schema.patternGroups&&Object.keys(e.schema.patternGroups).length)}var n="",a=!0===e.schema.$async;if(e.isTop){var i=e.isTop,o=e.level=0,s=e.dataLevel=0,l="data";if(e.rootId=e.resolve.fullPath(e.root.schema.id),e.baseId=e.baseId||e.rootId,a){e.async=!0;var c="es7"==e.opts.async;e.yieldAwait=c?"await":"yield"}delete e.isTop,e.dataPathArr=[void 0],n+=" var validate = ",a?c?n+=" (async function ":("co*"==e.opts.async&&(n+="co.wrap"),n+="(function* "):n+=" (function ",n+=" (data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; var vErrors = null; ",n+=" var errors = 0;     ",n+=" if (rootData === undefined) rootData = data;"}else{var o=e.level,s=e.dataLevel,l="data"+(s||"");if(e.schema.id&&(e.baseId=e.resolve.url(e.baseId,e.schema.id)),a&&!e.async)throw new Error("async schema in sync schema");n+=" var errs_"+o+" = errors;"}var u="valid"+o,$=!e.opts.allErrors,f="",p="",d=e.schema.type,h=Array.isArray(d);if(d&&e.opts.coerceTypes){var _=e.util.coerceToTypes(e.opts.coerceTypes,d);if(_){var g=e.schemaPath+".type",m=e.errSchemaPath+"/type",y=h?"checkDataTypes":"checkDataType";n+=" if ("+e.util[y](d,l,!0)+") {  ";var v="dataType"+o,b="coerced"+o;n+=" var "+v+" = typeof "+l+"; ","array"==e.opts.coerceTypes&&(n+=" if ("+v+" == 'object' && Array.isArray("+l+")) "+v+" = 'array'; "),n+=" var "+b+" = undefined; ";var x="",w=_;if(w)for(var A,k=-1,E=w.length-1;k<E;)A=w[k+=1],k&&(n+=" if ("+b+" === undefined) { ",x+="}"),"array"==e.opts.coerceTypes&&"array"!=A&&(n+=" if ("+v+" == 'array' && "+l+".length == 1) { "+b+" = "+l+" = "+l+"[0]; "+v+" = typeof "+l+";  } "),"string"==A?n+=" if ("+v+" == 'number' || "+v+" == 'boolean') "+b+" = '' + "+l+"; else if ("+l+" === null) "+b+" = ''; ":"number"==A||"integer"==A?(n+=" if ("+v+" == 'boolean' || "+l+" === null || ("+v+" == 'string' && "+l+" && "+l+" == +"+l+" ","integer"==A&&(n+=" && !("+l+" % 1)"),n+=")) "+b+" = +"+l+"; "):"boolean"==A?n+=" if ("+l+" === 'false' || "+l+" === 0 || "+l+" === null) "+b+" = false; else if ("+l+" === 'true' || "+l+" === 1) "+b+" = true; ":"null"==A?n+=" if ("+l+" === '' || "+l+" === 0 || "+l+" === false) "+b+" = null; ":"array"==e.opts.coerceTypes&&"array"==A&&(n+=" if ("+v+" == 'string' || "+v+" == 'number' || "+v+" == 'boolean' || "+l+" == null) "+b+" = ["+l+"]; ");n+=" "+x+" if ("+b+" === undefined) {   ";var C=C||[];C.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",n+=h?""+d.join(","):""+d,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=h?""+d.join(","):""+d,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var S=n;n=C.pop(),!e.compositeRule&&$?e.async?n+=" throw new ValidationError(["+S+"]); ":n+=" validate.errors = ["+S+"]; return false; ":n+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else {  ";var I=s?"data"+(s-1||""):"parentData",O=s?e.dataPathArr[s]:"parentDataProperty";n+=" "+l+" = "+b+"; ",s||(n+="if ("+I+" !== undefined)"),n+=" "+I+"["+O+"] = "+b+"; } } "}}var T;if(e.schema.$ref&&(T=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"))){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'"');"ignore"==e.opts.extendRefs?(T=!1,console.log('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"')):!0!==e.opts.extendRefs&&console.log('$ref: all keywords used in schema at path "'+e.errSchemaPath+'". It will change in the next major version, see issue #260. Use option { extendRefs: true } to keep current behaviour')}if(e.schema.$ref&&!T)n+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",$&&(n+=" } if (errors === ",n+=i?"0":"errs_"+o,n+=") { ",p+="}");else{var P=e.RULES;if(P)for(var M,N=-1,B=P.length-1;N<B;)if(M=P[N+=1],function(e){for(var t=0;t<e.rules.length;t++)if(r(e.rules[t]))return!0}(M)){if(M.type&&(n+=" if ("+e.util.checkDataType(M.type,l)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==M.type&&e.schema.properties){var R=e.schema.properties,j=Object.keys(R),F=j;if(F)for(var D,L=-1,z=F.length-1;L<z;){D=F[L+=1];var q=R[D];if(void 0!==q.default){var U=l+e.util.getProperty(D);n+="  if ("+U+" === undefined) "+U+" = ","shared"==e.opts.useDefaults?n+=" "+e.useDefault(q.default)+" ":n+=" "+JSON.stringify(q.default)+" ",n+="; "}}}else if("array"==M.type&&Array.isArray(e.schema.items)){var H=e.schema.items;if(H)for(var q,k=-1,G=H.length-1;k<G;)if(q=H[k+=1],void 0!==q.default){var U=l+"["+k+"]";n+="  if ("+U+" === undefined) "+U+" = ","shared"==e.opts.useDefaults?n+=" "+e.useDefault(q.default)+" ":n+=" "+JSON.stringify(q.default)+" ",n+="; "}}var Y=M.rules;if(Y)for(var Q,V=-1,X=Y.length-1;V<X;)Q=Y[V+=1],r(Q)&&(n+=" "+Q.code(e,Q.keyword)+" ",$&&(f+="}"));if($&&(n+=" "+f+" ",f=""),M.type&&(n+=" } ",d&&d===M.type&&!_)){var W=!0;n+=" else { ";var g=e.schemaPath+".type",m=e.errSchemaPath+"/type",C=C||[];C.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",n+=h?""+d.join(","):""+d,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=h?""+d.join(","):""+d,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var S=n;n=C.pop(),!e.compositeRule&&$?e.async?n+=" throw new ValidationError(["+S+"]); ":n+=" validate.errors = ["+S+"]; return false; ":n+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } "}$&&(n+=" if (errors === ",n+=i?"0":"errs_"+o,n+=") { ",p+="}")}}if(d&&!W&&!_){var g=e.schemaPath+".type",m=e.errSchemaPath+"/type",y=h?"checkDataTypes":"checkDataType";n+=" if ("+e.util[y](d,l,!0)+") {   ";var C=C||[];C.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",n+=h?""+d.join(","):""+d,n+="' } ",!1!==e.opts.messages&&(n+=" , message: 'should be ",n+=h?""+d.join(","):""+d,n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),n+=" } "):n+=" {} ";var S=n;n=C.pop(),!e.compositeRule&&$?e.async?n+=" throw new ValidationError(["+S+"]); ":n+=" validate.errors = ["+S+"]; return false; ":n+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }"}return $&&(n+=" "+p+" "),i?(a?(n+=" if (errors === 0) return true;           ",n+=" else throw new ValidationError(vErrors); "):(n+=" validate.errors = vErrors; ",n+=" return errors === 0;       "),n+=" }); return validate;"):n+=" var "+u+" = errors === errs_"+o+";",n=e.util.cleanUpCode(n),i&&$&&(n=e.util.cleanUpVarErrors(n,a)),n}},{}],39:[function(e,t,r){"use strict";function n(e,t){function r(e,t,r){for(var n,i=0;i<a.length;i++){var o=a[i];if(o.type==t){n=o;break}}n||(n={type:t,rules:[]},a.push(n));var l={keyword:e,definition:r,custom:!0,code:s};n.rules.push(l),a.custom[e]=l}function n(e){if(!a.types[e])throw new Error("Unknown type "+e)}var a=this.RULES
;if(a.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!o.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){if(t.macro&&void 0!==t.valid)throw new Error('"valid" option cannot be used with macro keywords');var i=t.type;if(Array.isArray(i)){var l,c=i.length;for(l=0;l<c;l++)n(i[l]);for(l=0;l<c;l++)r(e,i[l],t)}else i&&n(i),r(e,i,t);var u=!0===t.$data&&this._opts.v5;if(u&&!t.validate)throw new Error('$data support: "validate" function is not defined');var $=t.metaSchema;$&&(u&&($={anyOf:[$,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/json-schema-v5.json#/definitions/$data"}]}),t.validateSchema=this.compile($,!0))}a.keywords[e]=a.all[e]=!0}function a(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1}function i(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var n=t[r].rules,a=0;a<n.length;a++)if(n[a].keyword==e){n.splice(a,1);break}}var o=/^[a-z_$][a-z0-9_$\-]*$/i,s=e("./dotjs/custom");t.exports={add:n,get:a,remove:i}},{"./dotjs/custom":23}],40:[function(e,t,r){t.exports={id:"http://json-schema.org/draft-04/schema#",$schema:"http://json-schema.org/draft-04/schema#",description:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},positiveInteger:{type:"integer",minimum:0},positiveIntegerDefault0:{allOf:[{$ref:"#/definitions/positiveInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},minItems:1,uniqueItems:!0}},type:"object",properties:{id:{type:"string",format:"uri"},$schema:{type:"string",format:"uri"},title:{type:"string"},description:{type:"string"},default:{},multipleOf:{type:"number",minimum:0,exclusiveMinimum:!0},maximum:{type:"number"},exclusiveMaximum:{type:"boolean",default:!1},minimum:{type:"number"},exclusiveMinimum:{type:"boolean",default:!1},maxLength:{$ref:"#/definitions/positiveInteger"},minLength:{$ref:"#/definitions/positiveIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{anyOf:[{type:"boolean"},{$ref:"#"}],default:{}},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:{}},maxItems:{$ref:"#/definitions/positiveInteger"},minItems:{$ref:"#/definitions/positiveIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},maxProperties:{$ref:"#/definitions/positiveInteger"},minProperties:{$ref:"#/definitions/positiveIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{anyOf:[{type:"boolean"},{$ref:"#"}],default:{}},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},enum:{type:"array",minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},dependencies:{exclusiveMaximum:["maximum"],exclusiveMinimum:["minimum"]},default:{}}},{}],41:[function(e,t,r){t.exports={id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/json-schema-v5.json#",$schema:"http://json-schema.org/draft-04/schema#",description:"Core schema meta-schema (v5 proposals)",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},positiveInteger:{type:"integer",minimum:0},positiveIntegerDefault0:{allOf:[{$ref:"#/definitions/positiveInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},minItems:1,uniqueItems:!0},$data:{type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},type:"object",properties:{id:{type:"string",format:"uri"},$schema:{type:"string",format:"uri"},title:{type:"string"},description:{type:"string"},default:{},multipleOf:{anyOf:[{type:"number",minimum:0,exclusiveMinimum:!0},{$ref:"#/definitions/$data"}]},maximum:{anyOf:[{type:"number"},{$ref:"#/definitions/$data"}]},exclusiveMaximum:{anyOf:[{type:"boolean",default:!1},{$ref:"#/definitions/$data"}]},minimum:{anyOf:[{type:"number"},{$ref:"#/definitions/$data"}]},exclusiveMinimum:{anyOf:[{type:"boolean",default:!1},{$ref:"#/definitions/$data"}]},maxLength:{anyOf:[{$ref:"#/definitions/positiveInteger"},{$ref:"#/definitions/$data"}]},minLength:{anyOf:[{$ref:"#/definitions/positiveIntegerDefault0"},{$ref:"#/definitions/$data"}]},pattern:{anyOf:[{type:"string",format:"regex"},{$ref:"#/definitions/$data"}]},additionalItems:{anyOf:[{type:"boolean"},{$ref:"#"},{$ref:"#/definitions/$data"}],default:{}},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:{}},maxItems:{anyOf:[{$ref:"#/definitions/positiveInteger"},{$ref:"#/definitions/$data"}]},minItems:{anyOf:[{$ref:"#/definitions/positiveIntegerDefault0"},{$ref:"#/definitions/$data"}]},uniqueItems:{anyOf:[{type:"boolean",default:!1},{$ref:"#/definitions/$data"}]},maxProperties:{anyOf:[{$ref:"#/definitions/positiveInteger"},{$ref:"#/definitions/$data"}]},minProperties:{anyOf:[{$ref:"#/definitions/positiveIntegerDefault0"},{$ref:"#/definitions/$data"}]},required:{anyOf:[{$ref:"#/definitions/stringArray"},{$ref:"#/definitions/$data"}]},additionalProperties:{anyOf:[{type:"boolean"},{$ref:"#"},{$ref:"#/definitions/$data"}],default:{}},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},enum:{anyOf:[{type:"array",minItems:1,uniqueItems:!0},{$ref:"#/definitions/$data"}]},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"},format:{anyOf:[{type:"string"},{$ref:"#/definitions/$data"}]},formatMaximum:{anyOf:[{type:"string"},{$ref:"#/definitions/$data"}]},formatMinimum:{anyOf:[{type:"string"},{$ref:"#/definitions/$data"}]},formatExclusiveMaximum:{anyOf:[{type:"boolean",default:!1},{$ref:"#/definitions/$data"}]},formatExclusiveMinimum:{anyOf:[{type:"boolean",default:!1},{$ref:"#/definitions/$data"}]},constant:{anyOf:[{},{$ref:"#/definitions/$data"}]},contains:{$ref:"#"},patternGroups:{type:"object",additionalProperties:{type:"object",required:["schema"],properties:{maximum:{anyOf:[{$ref:"#/definitions/positiveInteger"},{$ref:"#/definitions/$data"}]},minimum:{anyOf:[{$ref:"#/definitions/positiveIntegerDefault0"},{$ref:"#/definitions/$data"}]},schema:{$ref:"#"}},additionalProperties:!1},default:{}},switch:{type:"array",items:{required:["then"],properties:{if:{$ref:"#"},then:{anyOf:[{type:"boolean"},{$ref:"#"}]},continue:{type:"boolean"}},additionalProperties:!1,dependencies:{continue:["if"]}}}},dependencies:{exclusiveMaximum:["maximum"],exclusiveMinimum:["minimum"],formatMaximum:["format"],formatMinimum:["format"],formatExclusiveMaximum:["formatMaximum"],formatExclusiveMinimum:["formatMinimum"]},default:{}}},{}],42:[function(e,t,r){"use strict";function n(t){function r(e,r,a){var i={inline:a||n[e],statements:!0,errors:"full"};r&&(i.type=r),t.addKeyword(e,i)}var n={switch:e("./dotjs/switch"),constant:e("./dotjs/constant"),_formatLimit:e("./dotjs/_formatLimit"),patternRequired:e("./dotjs/patternRequired")};if(!1!==t._opts.meta){var o=e("./refs/json-schema-v5.json");t.addMetaSchema(o,i)}r("constant"),t.addKeyword("contains",{type:"array",macro:a}),r("formatMaximum","string",n._formatLimit),r("formatMinimum","string",n._formatLimit),t.addKeyword("formatExclusiveMaximum"),t.addKeyword("formatExclusiveMinimum"),t.addKeyword("patternGroups"),r("patternRequired","object"),r("switch")}function a(e){return{not:{items:{not:e}}}}var i="https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/json-schema-v5.json";t.exports={enable:n,META_SCHEMA_ID:i}},{"./dotjs/_formatLimit":15,"./dotjs/constant":22,"./dotjs/patternRequired":32,"./dotjs/switch":36,"./refs/json-schema-v5.json":41}],43:[function(e,t,r){"use strict";function n(e,t,r){e instanceof RegExp&&(e=a(e,r)),t instanceof RegExp&&(t=a(t,r));var n=i(e,t,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+e.length,n[1]),post:r.slice(n[1]+t.length)}}function a(e,t){var r=t.match(e);return r?r[0]:null}function i(e,t,r){var n,a,i,o,s,l=r.indexOf(e),c=r.indexOf(t,l+1),u=l;if(l>=0&&c>0){for(n=[],i=r.length;u>=0&&!s;)u==l?(n.push(u),l=r.indexOf(e,u+1)):1==n.length?s=[n.pop(),c]:(a=n.pop(),a<i&&(i=a,o=c),c=r.indexOf(t,u+1)),u=l<c&&l>=0?l:c;n.length&&(s=[i,o])}return s}t.exports=n,n.range=i},{}],44:[function(e,t,r){function n(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function a(e){return e.split("\\\\").join(h).split("\\{").join(_).split("\\}").join(g).split("\\,").join(m).split("\\.").join(y)}function i(e){return e.split(h).join("\\").split(_).join("{").split(g).join("}").split(m).join(",").split(y).join(".")}function o(e){if(!e)return[""];var t=[],r=d("{","}",e);if(!r)return e.split(",");var n=r.pre,a=r.body,i=r.post,s=n.split(",");s[s.length-1]+="{"+a+"}";var l=o(i);return i.length&&(s[s.length-1]+=l.shift(),s.push.apply(s,l)),t.push.apply(t,s),t}function s(e){return e?("{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2)),f(a(e),!0).map(i)):[]}function l(e){return"{"+e+"}"}function c(e){return/^-?0\d/.test(e)}function u(e,t){return e<=t}function $(e,t){return e>=t}function f(e,t){var r=[],a=d("{","}",e);if(!a||/\$$/.test(a.pre))return[e];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(a.body),s=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(a.body),h=i||s,_=a.body.indexOf(",")>=0;if(!h&&!_)return a.post.match(/,.*\}/)?(e=a.pre+"{"+a.body+g+a.post,f(e)):[e];var m;if(h)m=a.body.split(/\.\./);else if(m=o(a.body),1===m.length&&(m=f(m[0],!1).map(l),1===m.length)){var y=a.post.length?f(a.post,!1):[""];return y.map(function(e){return a.pre+m[0]+e})}var v,b=a.pre,y=a.post.length?f(a.post,!1):[""];if(h){var x=n(m[0]),w=n(m[1]),A=Math.max(m[0].length,m[1].length),k=3==m.length?Math.abs(n(m[2])):1,E=u;w<x&&(k*=-1,E=$);var C=m.some(c);v=[];for(var S=x;E(S,w);S+=k){var I;if(s)"\\"===(I=String.fromCharCode(S))&&(I="");else if(I=String(S),C){var O=A-I.length;if(O>0){var T=new Array(O+1).join("0");I=S<0?"-"+T+I.slice(1):T+I}}v.push(I)}}else v=p(m,function(e){return f(e,!1)});for(var P=0;P<v.length;P++)for(var M=0;M<y.length;M++){var N=b+v[P]+y[M];(!t||h||N)&&r.push(N)}return r}var p=e("concat-map"),d=e("balanced-match");t.exports=s;var h="\0SLASH"+Math.random()+"\0",_="\0OPEN"+Math.random()+"\0",g="\0CLOSE"+Math.random()+"\0",m="\0COMMA"+Math.random()+"\0",y="\0PERIOD"+Math.random()+"\0"},{"balanced-match":43,"concat-map":46}],45:[function(e,t,r){function n(e){var t=this,r=f.call(arguments,1);return new Promise(function(n,i){function o(t){var r;try{r=e.next(t)}catch(e){return i(e)}c(r)}function s(t){var r;try{r=e.throw(t)}catch(e){return i(e)}c(r)}function c(e){if(e.done)return n(e.value);var r=a.call(t,e.value);return r&&l(r)?r.then(o,s):s(new TypeError('You may only yield a function, promise, generator, array, or object, but the following object was passed: "'+String(e.value)+'"'))}if("function"==typeof e&&(e=e.apply(t,r)),!e||"function"!=typeof e.next)return n(e);o()})}function a(e){return e?l(e)?e:u(e)||c(e)?n.call(this,e):"function"==typeof e?i.call(this,e):Array.isArray(e)?o.call(this,e):$(e)?s.call(this,e):e:e}function i(e){var t=this;return new Promise(function(r,n){e.call(t,function(e,t){if(e)return n(e);arguments.length>2&&(t=f.call(arguments,1)),r(t)})})}function o(e){return Promise.all(e.map(a,this))}function s(e){for(var t=new e.constructor,r=Object.keys(e),n=[],i=0;i<r.length;i++){var o=r[i],s=a.call(this,e[o]);s&&l(s)?function(e,r){t[r]=void 0,n.push(e.then(function(e){t[r]=e}))}(s,o):t[o]=e[o]}return Promise.all(n).then(function(){return t})}function l(e){return"function"==typeof e.then}function c(e){return"function"==typeof e.next&&"function"==typeof e.throw}function u(e){var t=e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName||c(t.prototype))}function $(e){return Object==e.constructor}var f=Array.prototype.slice;t.exports=n.default=n.co=n,n.wrap=function(e){function t(){return n.call(this,e.apply(this,arguments))}return t.__generatorFunction__=e,t}},{}],46:[function(e,t,r){t.exports=function(e,t){for(var r=[],a=0;a<e.length;a++){var i=t(e[a],a);n(i)?r.push.apply(r,i):r.push(i)}return r};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],47:[function(e,t,r){"use strict";function n(e,t,r,n){r=o(r||"UTF-8"),t=o(t||"UTF-8"),e=e||"";var s;if("UTF-8"!==r&&"string"==typeof e&&(e=new Buffer(e,"binary")),r===t)s="string"==typeof e?new Buffer(e):e;else if(l&&!n)try{s=a(e,t,r)}catch(n){console.error(n);try{s=i(e,t,r)}catch(t){console.error(t),s=e}}else try{s=i(e,t,r)}catch(t){console.error(t),s=e}return"string"==typeof s&&(s=new Buffer(s,"utf-8")),s}function a(e,t,r){var n,a;return a=new l(r,t+"//TRANSLIT//IGNORE"),n=a.convert(e),n.slice(0,n.length)}function i(e,t,r){return"UTF-8"===t?s.decode(e,r):"UTF-8"===r?s.encode(e,t):s.encode(s.decode(e,r),t)}function o(e){return(e||"").toString().trim().replace(/^latin[\-_]?(\d+)$/i,"ISO-8859-$1").replace(/^win(?:dows)?[\-_]?(\d+)$/i,"WINDOWS-$1").replace(/^utf[\-_]?(\d+)$/i,"UTF-$1").replace(/^ks_c_5601\-1987$/i,"CP949").replace(/^us[\-_]?ascii$/i,"ASCII").toUpperCase()}var s=e("iconv-lite"),l=e("./iconv-loader");t.exports.convert=n},{"./iconv-loader":48,"iconv-lite":73}],48:[function(e,t,r){"use strict";var n,a;try{n="iconv",a=e(n).Iconv}catch(e){}t.exports=a},{}],49:[function(e,t,r){function n(e){return e&&"realpath"===e.syscall&&("ELOOP"===e.code||"ENOMEM"===e.code||"ENAMETOOLONG"===e.code)}function a(e,t,r){if(f)return c(e,t,r);"function"==typeof t&&(r=t,t=null),c(e,t,function(a,i){n(a)?p.realpath(e,t,r):r(a,i)})}function i(e,t){if(f)return u(e,t);try{return u(e,t)}catch(r){if(n(r))return p.realpathSync(e,t);throw r}}function o(){l.realpath=a,l.realpathSync=i}function s(){l.realpath=c,l.realpathSync=u}t.exports=a,a.realpath=a,a.sync=i,a.realpathSync=i,a.monkeypatch=o,a.unmonkeypatch=s;var l=e("fs"),c=l.realpath,u=l.realpathSync,$=process.version,f=/^v[0-5]\./.test($),p=e("./old.js")},{"./old.js":50,fs:void 0}],50:[function(e,t,r){function n(){function e(e){e&&(n.message=e.message,e=n,t(e))}function t(e){if(e){if(process.throwDeprecation)throw e;if(!process.noDeprecation){var t="fs: missing callback "+(e.stack||e.message);process.traceDeprecation?console.trace(t):console.error(t)}}}var r;if(l){var n=new Error;r=e}else r=t;return r}function a(e){return"function"==typeof e?e:n()}var i=e("path"),o="win32"===process.platform,s=e("fs"),l=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);i.normalize;if(o)var c=/(.*?)(?:[\/\\]+|$)/g;else var c=/(.*?)(?:[\/]+|$)/g;if(o)var u=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/;else var u=/^[\/]*/;r.realpathSync=function(e,t){function r(){var t=u.exec(e);n=t[0].length,a=t[0],l=t[0],$="",o&&!d[l]&&(s.lstatSync(l),d[l]=!0)}if(e=i.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var n,a,l,$,f=e,p={},d={};for(r();n<e.length;){c.lastIndex=n;var h=c.exec(e);if($=a,a+=h[0],l=$+h[1],n=c.lastIndex,!(d[l]||t&&t[l]===l)){var _;if(t&&Object.prototype.hasOwnProperty.call(t,l))_=t[l];else{var g=s.lstatSync(l);if(!g.isSymbolicLink()){d[l]=!0,t&&(t[l]=l);continue}var m=null;if(!o){var y=g.dev.toString(32)+":"+g.ino.toString(32);p.hasOwnProperty(y)&&(m=p[y])}null===m&&(s.statSync(l),m=s.readlinkSync(l)),_=i.resolve($,m),t&&(t[l]=_),o||(p[y]=m)}e=i.resolve(_,e.slice(n)),r()}}return t&&(t[f]=e),e},r.realpath=function(e,t,r){function n(){var t=u.exec(e);d=t[0].length,h=t[0],_=t[0],g="",o&&!v[_]?s.lstat(_,function(e){if(e)return r(e);v[_]=!0,l()}):process.nextTick(l)}function l(){if(d>=e.length)return t&&(t[m]=e),r(null,e);c.lastIndex=d;var n=c.exec(e);return g=h,h+=n[0],_=g+n[1],d=c.lastIndex,v[_]||t&&t[_]===_?process.nextTick(l):t&&Object.prototype.hasOwnProperty.call(t,_)?p(t[_]):s.lstat(_,$)}function $(e,n){if(e)return r(e);if(!n.isSymbolicLink())return v[_]=!0,t&&(t[_]=_),process.nextTick(l);if(!o){var a=n.dev.toString(32)+":"+n.ino.toString(32);if(y.hasOwnProperty(a))return f(null,y[a],_)}s.stat(_,function(e){if(e)return r(e);s.readlink(_,function(e,t){o||(y[a]=t),f(e,t)})})}function f(e,n,a){if(e)return r(e);var o=i.resolve(g,n);t&&(t[a]=o),p(o)}function p(t){e=i.resolve(t,e.slice(d)),n()}if("function"!=typeof r&&(r=a(t),t=null),e=i.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(r.bind(null,null,t[e]));var d,h,_,g,m=e,y={},v={};n()}},{fs:void 0,path:void 0}],51:[function(e,t,r){function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function a(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}function i(e,t){return e.localeCompare(t)}function o(e,t){e.ignore=t.ignore||[],Array.isArray(e.ignore)||(e.ignore=[e.ignore]),e.ignore.length&&(e.ignore=e.ignore.map(s))}function s(e){var t=null;if("/**"===e.slice(-3)){var r=e.replace(/(\/\*\*)+$/,"");t=new g(r,{dot:!0})}return{matcher:new g(e,{dot:!0}),gmatcher:t}}function l(e,t,r){if(r||(r={}),r.matchBase&&-1===t.indexOf("/")){if(r.noglobstar)throw new Error("base matching requires globstar");t="**/"+t}e.silent=!!r.silent,e.pattern=t,e.strict=!1!==r.strict,e.realpath=!!r.realpath,e.realpathCache=r.realpathCache||Object.create(null),e.follow=!!r.follow,e.dot=!!r.dot,e.mark=!!r.mark,e.nodir=!!r.nodir,e.nodir&&(e.mark=!0),e.sync=!!r.sync,e.nounique=!!r.nounique,e.nonull=!!r.nonull,e.nosort=!!r.nosort,e.nocase=!!r.nocase,e.stat=!!r.stat,e.noprocess=!!r.noprocess,e.absolute=!!r.absolute,e.maxLength=r.maxLength||1/0,e.cache=r.cache||Object.create(null),e.statCache=r.statCache||Object.create(null),e.symlinks=r.symlinks||Object.create(null),o(e,r),e.changedCwd=!1;var a=process.cwd();n(r,"cwd")?(e.cwd=d.resolve(r.cwd),e.changedCwd=e.cwd!==a):e.cwd=a,e.root=r.root||d.resolve(e.cwd,"/"),e.root=d.resolve(e.root),"win32"===process.platform&&(e.root=e.root.replace(/\\/g,"/")),e.cwdAbs=_(e.cwd)?e.cwd:$(e,e.cwd),"win32"===process.platform&&(e.cwdAbs=e.cwdAbs.replace(/\\/g,"/")),e.nomount=!!r.nomount,r.nonegate=!0,r.nocomment=!0,e.minimatch=new g(t,r),e.options=e.minimatch.options}function c(e){for(var t=e.nounique,r=t?[]:Object.create(null),n=0,o=e.matches.length;n<o;n++){var s=e.matches[n];if(s&&0!==Object.keys(s).length){var l=Object.keys(s);t?r.push.apply(r,l):l.forEach(function(e){r[e]=!0})}else if(e.nonull){var c=e.minimatch.globSet[n];t?r.push(c):r[c]=!0}}if(t||(r=Object.keys(r)),e.nosort||(r=r.sort(e.nocase?a:i)),e.mark){for(var n=0;n<r.length;n++)r[n]=e._mark(r[n]);e.nodir&&(r=r.filter(function(t){var r=!/\/$/.test(t),n=e.cache[t]||e.cache[$(e,t)];return r&&n&&(r="DIR"!==n&&!Array.isArray(n)),r}))}e.ignore.length&&(r=r.filter(function(t){return!f(e,t)})),e.found=r}function u(e,t){var r=$(e,t),n=e.cache[r],a=t;if(n){var i="DIR"===n||Array.isArray(n),o="/"===t.slice(-1);if(i&&!o?a+="/":!i&&o&&(a=a.slice(0,-1)),a!==t){var s=$(e,a);e.statCache[s]=e.statCache[r],e.cache[s]=e.cache[r]}}return a}function $(e,t){var r=t;return r="/"===t.charAt(0)?d.join(e.root,t):_(t)||""===t?t:e.changedCwd?d.resolve(e.cwd,t):d.resolve(t),"win32"===process.platform&&(r=r.replace(/\\/g,"/")),r}function f(e,t){return!!e.ignore.length&&e.ignore.some(function(e){return e.matcher.match(t)||!(!e.gmatcher||!e.gmatcher.match(t))})}function p(e,t){return!!e.ignore.length&&e.ignore.some(function(e){return!(!e.gmatcher||!e.gmatcher.match(t))})}r.alphasort=i,r.alphasorti=a,r.setopts=l,r.ownProp=n,r.makeAbs=$,r.finish=c,r.mark=u,r.isIgnored=f,r.childrenIgnored=p;var d=e("path"),h=e("minimatch"),_=e("path-is-absolute"),g=h.Minimatch},{minimatch:83,path:void 0,"path-is-absolute":85}],52:[function(e,t,r){function n(e,t,r){if("function"==typeof t&&(r=t,t={}),t||(t={}),t.sync){if(r)throw new TypeError("callback provided to sync glob");return h(e,t)}return new i(e,t,r)}function a(e,t){if(null===t||"object"!=typeof t)return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function i(e,t,r){function n(){--o._processing<=0&&(s?process.nextTick(function(){o._finish()}):o._finish())}if("function"==typeof t&&(r=t,t=null),t&&t.sync){if(r)throw new TypeError("callback provided to sync glob");return new w(e,t)}if(!(this instanceof i))return new i(e,t,r);g(this,e,t),this._didRealPath=!1;var a=this.minimatch.set.length;this.matches=new Array(a),"function"==typeof r&&(r=x(r),this.on("error",r),this.on("end",function(e){r(null,e)}));var o=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(0===a)return n();for(var s=!0,l=0;l<a;l++)this._process(this.minimatch.set[l],l,!1,n);s=!1}function o(e,t,r){return function(n,a){n?e._readdirError(t,n,r):e._readdirEntries(t,a,r)}}t.exports=n;var s=e("fs"),l=e("fs.realpath"),c=e("minimatch"),u=(c.Minimatch,e("inherits")),$=e("events").EventEmitter,f=e("path"),p=e("assert"),d=e("path-is-absolute"),h=e("./sync.js"),_=e("./common.js"),g=(_.alphasort,_.alphasorti,_.setopts),m=_.ownProp,y=e("inflight"),v=(e("util"),_.childrenIgnored),b=_.isIgnored,x=e("once");n.sync=h;var w=n.GlobSync=h.GlobSync;n.glob=n,n.hasMagic=function(e,t){var r=a({},t);r.noprocess=!0;var n=new i(e,r),o=n.minimatch.set;if(!e)return!1;if(o.length>1)return!0;for(var s=0;s<o[0].length;s++)if("string"!=typeof o[0][s])return!0;return!1},n.Glob=i,u(i,$),i.prototype._finish=function(){if(p(this instanceof i),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();_.finish(this),this.emit("end",this.found)}},i.prototype._realpath=function(){function e(){0==--t&&r._finish()}if(!this._didRealpath){this._didRealpath=!0;var t=this.matches.length;if(0===t)return this._finish();for(var r=this,n=0;n<this.matches.length;n++)this._realpathSet(n,e)}},i.prototype._realpathSet=function(e,t){var r=this.matches[e];if(!r)return t();var n=Object.keys(r),a=this,i=n.length;if(0===i)return t();var o=this.matches[e]=Object.create(null);n.forEach(function(r,n){r=a._makeAbs(r),l.realpath(r,a.realpathCache,function(n,s){n?"stat"===n.syscall?o[r]=!0:a.emit("error",n):o[s]=!0,0==--i&&(a.matches[e]=o,t())})})},i.prototype._mark=function(e){return _.mark(this,e)},i.prototype._makeAbs=function(e){return _.makeAbs(this,e)},i.prototype.abort=function(){this.aborted=!0,this.emit("abort")},i.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},i.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var e=this._emitQueue.slice(0);this._emitQueue.length=0;for(var t=0;t<e.length;t++){var r=e[t];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var t=0;t<n.length;t++){var a=n[t];this._processing--,this._process(a[0],a[1],a[2],a[3])}}}},i.prototype._process=function(e,t,r,n){if(p(this instanceof i),p("function"==typeof n),!this.aborted){if(this._processing++,this.paused)return void this._processQueue.push([e,t,r,n]);for(var a=0;"string"==typeof e[a];)a++;var o;switch(a){case e.length:return void this._processSimple(e.join("/"),t,n);case 0:o=null;break;default:o=e.slice(0,a).join("/")}var s,l=e.slice(a);null===o?s=".":d(o)||d(e.join("/"))?(o&&d(o)||(o="/"+o),s=o):s=o;var u=this._makeAbs(s);if(v(this,s))return n();l[0]===c.GLOBSTAR?this._processGlobStar(o,s,u,l,t,r,n):this._processReaddir(o,s,u,l,t,r,n)}},i.prototype._processReaddir=function(e,t,r,n,a,i,o){var s=this;this._readdir(r,i,function(l,c){return s._processReaddir2(e,t,r,n,a,i,c,o)})},i.prototype._processReaddir2=function(e,t,r,n,a,i,o,s){if(!o)return s();for(var l=n[0],c=!!this.minimatch.negate,u=l._glob,$=this.dot||"."===u.charAt(0),p=[],d=0;d<o.length;d++){var h=o[d];if("."!==h.charAt(0)||$){var _;_=c&&!e?!h.match(l):h.match(l),_&&p.push(h)}}var g=p.length;if(0===g)return s();if(1===n.length&&!this.mark&&!this.stat){this.matches[a]||(this.matches[a]=Object.create(null));for(var d=0;d<g;d++){var h=p[d];e&&(h="/"!==e?e+"/"+h:e+h),"/"!==h.charAt(0)||this.nomount||(h=f.join(this.root,h)),this._emitMatch(a,h)}return s()}n.shift();for(var d=0;d<g;d++){var h=p[d];e&&(h="/"!==e?e+"/"+h:e+h),this._process([h].concat(n),a,i,s)}s()},i.prototype._emitMatch=function(e,t){if(!this.aborted&&!b(this,t)){if(this.paused)return void this._emitQueue.push([e,t]);var r=d(t)?t:this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var n=this.cache[r];if("DIR"===n||Array.isArray(n))return}this.matches[e][t]=!0;var a=this.statCache[r];a&&this.emit("stat",t,a),this.emit("match",t)}}},i.prototype._readdirInGlobStar=function(e,t){function r(r,n){if(r&&"ENOENT"===r.code)return t();var i=n&&n.isSymbolicLink();a.symlinks[e]=i,i||!n||n.isDirectory()?a._readdir(e,!1,t):(a.cache[e]="FILE",t())}if(!this.aborted){if(this.follow)return this._readdir(e,!1,t);var n="lstat\0"+e,a=this,i=y(n,r);i&&s.lstat(e,i)}},i.prototype._readdir=function(e,t,r){if(!this.aborted&&(r=y("readdir\0"+e+"\0"+t,r))){if(t&&!m(this.symlinks,e))return this._readdirInGlobStar(e,r);if(m(this.cache,e)){var n=this.cache[e];if(!n||"FILE"===n)return r();if(Array.isArray(n))return r(null,n)}s.readdir(e,o(this,e,r))}},i.prototype._readdirEntries=function(e,t,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var n=0;n<t.length;n++){var a=t[n];a="/"===e?e+a:e+"/"+a,this.cache[a]=!0}return this.cache[e]=t,r(null,t)}},i.prototype._readdirError=function(e,t,r){if(!this.aborted){switch(t.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(e);if(this.cache[n]="FILE",n===this.cwdAbs){var a=new Error(t.code+" invalid cwd "+this.cwd);a.path=this.cwd,a.code=t.code,this.emit("error",a),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:this.cache[this._makeAbs(e)]=!1,this.strict&&(this.emit("error",t),this.abort()),this.silent||console.error("glob error",t)}return r()}},i.prototype._processGlobStar=function(e,t,r,n,a,i,o){var s=this;this._readdir(r,i,function(l,c){s._processGlobStar2(e,t,r,n,a,i,c,o)})},i.prototype._processGlobStar2=function(e,t,r,n,a,i,o,s){if(!o)return s();var l=n.slice(1),c=e?[e]:[],u=c.concat(l);this._process(u,a,!1,s);var $=this.symlinks[r],f=o.length;if($&&i)return s();for(var p=0;p<f;p++){if("."!==o[p].charAt(0)||this.dot){var d=c.concat(o[p],l);this._process(d,a,!0,s);var h=c.concat(o[p],n);this._process(h,a,!0,s)}}s()},i.prototype._processSimple=function(e,t,r){var n=this;this._stat(e,function(a,i){n._processSimple2(e,t,a,i,r)})},i.prototype._processSimple2=function(e,t,r,n,a){if(this.matches[t]||(this.matches[t]=Object.create(null)),!n)return a();if(e&&d(e)&&!this.nomount){var i=/[\/\\]$/.test(e);"/"===e.charAt(0)?e=f.join(this.root,e):(e=f.resolve(this.root,e),i&&(e+="/"))}"win32"===process.platform&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e),a()},i.prototype._stat=function(e,t){function r(r,a){if(a&&a.isSymbolicLink())return s.stat(n,function(r,i){r?c._stat2(e,n,null,a,t):c._stat2(e,n,r,i,t)});c._stat2(e,n,r,a,t)}var n=this._makeAbs(e),a="/"===e.slice(-1);if(e.length>this.maxLength)return t();if(!this.stat&&m(this.cache,n)){var i=this.cache[n];if(Array.isArray(i)&&(i="DIR"),!a||"DIR"===i)return t(null,i);if(a&&"FILE"===i)return t()}var o=this.statCache[n];if(void 0!==o){if(!1===o)return t(null,o);var l=o.isDirectory()?"DIR":"FILE";return a&&"FILE"===l?t():t(null,l,o)}var c=this,u=y("stat\0"+n,r);u&&s.lstat(n,u)},i.prototype._stat2=function(e,t,r,n,a){if(r&&("ENOENT"===r.code||"ENOTDIR"===r.code))return this.statCache[t]=!1,a();var i="/"===e.slice(-1);if(this.statCache[t]=n,"/"===t.slice(-1)&&n&&!n.isDirectory())return a(null,!1,n);var o=!0;return n&&(o=n.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||o,i&&"FILE"===o?a():a(null,o,n)}},{"./common.js":51,"./sync.js":53,assert:void 0,events:void 0,fs:void 0,"fs.realpath":49,inflight:75,inherits:76,minimatch:83,once:84,path:void 0,"path-is-absolute":85,util:void 0}],53:[function(e,t,r){function n(e,t){if("function"==typeof t||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new a(e,t).found}function a(e,t){if(!e)throw new Error("must provide pattern");if("function"==typeof t||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof a))return new a(e,t);if(f(this,e,t),this.noprocess)return this;var r=this.minimatch.set.length;this.matches=new Array(r);for(var n=0;n<r;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}t.exports=n,n.GlobSync=a;var i=e("fs"),o=e("fs.realpath"),s=e("minimatch"),l=(s.Minimatch,e("./glob.js").Glob,e("util"),e("path")),c=e("assert"),u=e("path-is-absolute"),$=e("./common.js"),f=($.alphasort,$.alphasorti,$.setopts),p=$.ownProp,d=$.childrenIgnored,h=$.isIgnored;a.prototype._finish=function(){if(c(this instanceof a),this.realpath){var e=this;this.matches.forEach(function(t,r){var n=e.matches[r]=Object.create(null);for(var a in t)try{a=e._makeAbs(a);var i=o.realpathSync(a,e.realpathCache);n[i]=!0}catch(t){if("stat"!==t.syscall)throw t;n[e._makeAbs(a)]=!0}})}$.finish(this)},a.prototype._process=function(e,t,r){c(this instanceof a);for(var n=0;"string"==typeof e[n];)n++;var i;switch(n){case e.length:return void this._processSimple(e.join("/"),t);case 0:i=null;break;default:i=e.slice(0,n).join("/")}var o,l=e.slice(n);null===i?o=".":u(i)||u(e.join("/"))?(i&&u(i)||(i="/"+i),o=i):o=i;var $=this._makeAbs(o);if(!d(this,o)){l[0]===s.GLOBSTAR?this._processGlobStar(i,o,$,l,t,r):this._processReaddir(i,o,$,l,t,r)}},a.prototype._processReaddir=function(e,t,r,n,a,i){var o=this._readdir(r,i);if(o){for(var s=n[0],c=!!this.minimatch.negate,u=s._glob,$=this.dot||"."===u.charAt(0),f=[],p=0;p<o.length;p++){var d=o[p];if("."!==d.charAt(0)||$){var h;h=c&&!e?!d.match(s):d.match(s),h&&f.push(d)}}var _=f.length;if(0!==_)if(1!==n.length||this.mark||this.stat){n.shift();for(var p=0;p<_;p++){var g,d=f[p];g=e?[e,d]:[d],this._process(g.concat(n),a,i)}}else{this.matches[a]||(this.matches[a]=Object.create(null));for(var p=0;p<_;p++){var d=f[p];e&&(d="/"!==e.slice(-1)?e+"/"+d:e+d),"/"!==d.charAt(0)||this.nomount||(d=l.join(this.root,d)),this._emitMatch(a,d)}}}},a.prototype._emitMatch=function(e,t){if(!h(this,t)){var r=this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var n=this.cache[r];if("DIR"===n||Array.isArray(n))return}this.matches[e][t]=!0,this.stat&&this._stat(t)}}},a.prototype._readdirInGlobStar=function(e){if(this.follow)return this._readdir(e,!1);var t,r;try{r=i.lstatSync(e)}catch(e){if("ENOENT"===e.code)return null}var n=r&&r.isSymbolicLink();return this.symlinks[e]=n,n||!r||r.isDirectory()?t=this._readdir(e,!1):this.cache[e]="FILE",t},a.prototype._readdir=function(e,t){if(t&&!p(this.symlinks,e))return this._readdirInGlobStar(e);if(p(this.cache,e)){var r=this.cache[e];if(!r||"FILE"===r)return null;if(Array.isArray(r))return r}try{return this._readdirEntries(e,i.readdirSync(e))}catch(t){return this._readdirError(e,t),null}},a.prototype._readdirEntries=function(e,t){if(!this.mark&&!this.stat)for(var r=0;r<t.length;r++){var n=t[r];n="/"===e?e+n:e+"/"+n,this.cache[n]=!0}return this.cache[e]=t,t},a.prototype._readdirError=function(e,t){switch(t.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(e);if(this.cache[r]="FILE",
r===this.cwdAbs){var n=new Error(t.code+" invalid cwd "+this.cwd);throw n.path=this.cwd,n.code=t.code,n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:if(this.cache[this._makeAbs(e)]=!1,this.strict)throw t;this.silent||console.error("glob error",t)}},a.prototype._processGlobStar=function(e,t,r,n,a,i){var o=this._readdir(r,i);if(o){var s=n.slice(1),l=e?[e]:[],c=l.concat(s);this._process(c,a,!1);var u=o.length;if(!this.symlinks[r]||!i)for(var $=0;$<u;$++){var f=o[$];if("."!==f.charAt(0)||this.dot){var p=l.concat(o[$],s);this._process(p,a,!0);var d=l.concat(o[$],n);this._process(d,a,!0)}}}},a.prototype._processSimple=function(e,t){var r=this._stat(e);if(this.matches[t]||(this.matches[t]=Object.create(null)),r){if(e&&u(e)&&!this.nomount){var n=/[\/\\]$/.test(e);"/"===e.charAt(0)?e=l.join(this.root,e):(e=l.resolve(this.root,e),n&&(e+="/"))}"win32"===process.platform&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e)}},a.prototype._stat=function(e){var t=this._makeAbs(e),r="/"===e.slice(-1);if(e.length>this.maxLength)return!1;if(!this.stat&&p(this.cache,t)){var n=this.cache[t];if(Array.isArray(n)&&(n="DIR"),!r||"DIR"===n)return n;if(r&&"FILE"===n)return!1}var a=this.statCache[t];if(!a){var o;try{o=i.lstatSync(t)}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return this.statCache[t]=!1,!1}if(o&&o.isSymbolicLink())try{a=i.statSync(t)}catch(e){a=o}else a=o}this.statCache[t]=a;var n=!0;return a&&(n=a.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||n,(!r||"FILE"!==n)&&n},a.prototype._mark=function(e){return $.mark(this,e)},a.prototype._makeAbs=function(e){return $.makeAbs(this,e)}},{"./common.js":51,"./glob.js":52,assert:void 0,fs:void 0,"fs.realpath":49,minimatch:83,path:void 0,"path-is-absolute":85,util:void 0}],54:[function(e,t,r){"use strict";function n(e,t){if(this.encodingName=e.encodingName,!e)throw new Error("DBCS codec is called without the data.");if(!e.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var r=e.table();this.decodeTables=[],this.decodeTables[0]=$.slice(0),this.decodeTableSeq=[];for(var n=0;n<r.length;n++)this._addDecodeChunk(r[n]);this.defaultCharUnicode=t.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var a={};if(e.encodeSkipVals)for(var n=0;n<e.encodeSkipVals.length;n++){var i=e.encodeSkipVals[n];if("number"==typeof i)a[i]=!0;else for(var o=i.from;o<=i.to;o++)a[o]=!0}if(this._fillEncodeTable(0,0,a),e.encodeAdd)for(var s in e.encodeAdd)Object.prototype.hasOwnProperty.call(e.encodeAdd,s)&&this._setEncodeChar(s.charCodeAt(0),e.encodeAdd[s]);if(this.defCharSB=this.encodeTable[0][t.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===l&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===l&&(this.defCharSB="?".charCodeAt(0)),"function"==typeof e.gb18030){this.gb18030=e.gb18030();for(var f=this.decodeTables.length,p=this.decodeTables[f]=$.slice(0),d=this.decodeTables.length,h=this.decodeTables[d]=$.slice(0),n=129;n<=254;n++)for(var _=u-this.decodeTables[0][n],g=this.decodeTables[_],o=48;o<=57;o++)g[o]=u-f;for(var n=129;n<=254;n++)p[n]=u-d;for(var n=48;n<=57;n++)h[n]=c}}function a(e,t){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=t.encodeTable,this.encodeTableSeq=t.encodeTableSeq,this.defaultCharSingleByte=t.defCharSB,this.gb18030=t.gb18030}function i(e,t){this.nodeIdx=0,this.prevBuf=new s(0),this.decodeTables=t.decodeTables,this.decodeTableSeq=t.decodeTableSeq,this.defaultCharUnicode=t.defaultCharUnicode,this.gb18030=t.gb18030}function o(e,t){if(e[0]>t)return-1;for(var r=0,n=e.length;r<n-1;){var a=r+Math.floor((n-r+1)/2);e[a]<=t?r=a:n=a}return r}var s=e("buffer").Buffer;r._dbcs=n;for(var l=-1,c=-2,u=-1e3,$=new Array(256),f=0;f<256;f++)$[f]=l;n.prototype.encoder=a,n.prototype.decoder=i,n.prototype._getDecodeTrieNode=function(e){for(var t=[];e>0;e>>=8)t.push(255&e);0==t.length&&t.push(0);for(var r=this.decodeTables[0],n=t.length-1;n>0;n--){var a=r[t[n]];if(a==l)r[t[n]]=u-this.decodeTables.length,this.decodeTables.push(r=$.slice(0));else{if(!(a<=u))throw new Error("Overwrite byte in "+this.encodingName+", addr: "+e.toString(16));r=this.decodeTables[u-a]}}return r},n.prototype._addDecodeChunk=function(e){var t=parseInt(e[0],16),r=this._getDecodeTrieNode(t);t&=255;for(var n=1;n<e.length;n++){var a=e[n];if("string"==typeof a)for(var i=0;i<a.length;){var o=a.charCodeAt(i++);if(55296<=o&&o<56320){var s=a.charCodeAt(i++);if(!(56320<=s&&s<57344))throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+e[0]);r[t++]=65536+1024*(o-55296)+(s-56320)}else if(4080<o&&o<=4095){for(var l=4095-o+2,c=[],u=0;u<l;u++)c.push(a.charCodeAt(i++));r[t++]=-10-this.decodeTableSeq.length,this.decodeTableSeq.push(c)}else r[t++]=o}else{if("number"!=typeof a)throw new Error("Incorrect type '"+typeof a+"' given in "+this.encodingName+" at chunk "+e[0]);for(var $=r[t-1]+1,i=0;i<a;i++)r[t++]=$++}}if(t>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+e[0]+": too long"+t)},n.prototype._getEncodeBucket=function(e){var t=e>>8;return void 0===this.encodeTable[t]&&(this.encodeTable[t]=$.slice(0)),this.encodeTable[t]},n.prototype._setEncodeChar=function(e,t){var r=this._getEncodeBucket(e),n=255&e;r[n]<=-10?this.encodeTableSeq[-10-r[n]][-1]=t:r[n]==l&&(r[n]=t)},n.prototype._setEncodeSequence=function(e,t){var r,n=e[0],a=this._getEncodeBucket(n),i=255&n;a[i]<=-10?r=this.encodeTableSeq[-10-a[i]]:(r={},a[i]!==l&&(r[-1]=a[i]),a[i]=-10-this.encodeTableSeq.length,this.encodeTableSeq.push(r));for(var o=1;o<e.length-1;o++){var s=r[n];"object"==typeof s?r=s:(r=r[n]={},void 0!==s&&(r[-1]=s))}n=e[e.length-1],r[n]=t},n.prototype._fillEncodeTable=function(e,t,r){for(var n=this.decodeTables[e],a=0;a<256;a++){var i=n[a],o=t+a;r[o]||(i>=0?this._setEncodeChar(i,o):i<=u?this._fillEncodeTable(u-i,o<<8,r):i<=-10&&this._setEncodeSequence(this.decodeTableSeq[-10-i],o))}},a.prototype.write=function(e){for(var t=new s(e.length*(this.gb18030?4:3)),r=this.leadSurrogate,n=this.seqObj,a=-1,i=0,c=0;;){if(-1===a){if(i==e.length)break;var u=e.charCodeAt(i++)}else{var u=a;a=-1}if(55296<=u&&u<57344)if(u<56320){if(-1===r){r=u;continue}r=u,u=l}else-1!==r?(u=65536+1024*(r-55296)+(u-56320),r=-1):u=l;else-1!==r&&(a=u,u=l,r=-1);var $=l;if(void 0!==n&&u!=l){var f=n[u];if("object"==typeof f){n=f;continue}"number"==typeof f?$=f:void 0==f&&void 0!==(f=n[-1])&&($=f,a=u),n=void 0}else if(u>=0){var p=this.encodeTable[u>>8];if(void 0!==p&&($=p[255&u]),$<=-10){n=this.encodeTableSeq[-10-$];continue}if($==l&&this.gb18030){var d=o(this.gb18030.uChars,u);if(-1!=d){var $=this.gb18030.gbChars[d]+(u-this.gb18030.uChars[d]);t[c++]=129+Math.floor($/12600),$%=12600,t[c++]=48+Math.floor($/1260),$%=1260,t[c++]=129+Math.floor($/10),$%=10,t[c++]=48+$;continue}}}$===l&&($=this.defaultCharSingleByte),$<256?t[c++]=$:$<65536?(t[c++]=$>>8,t[c++]=255&$):(t[c++]=$>>16,t[c++]=$>>8&255,t[c++]=255&$)}return this.seqObj=n,this.leadSurrogate=r,t.slice(0,c)},a.prototype.end=function(){if(-1!==this.leadSurrogate||void 0!==this.seqObj){var e=new s(10),t=0;if(this.seqObj){var r=this.seqObj[-1];void 0!==r&&(r<256?e[t++]=r:(e[t++]=r>>8,e[t++]=255&r)),this.seqObj=void 0}return-1!==this.leadSurrogate&&(e[t++]=this.defaultCharSingleByte,this.leadSurrogate=-1),e.slice(0,t)}},a.prototype.findIdx=o,i.prototype.write=function(e){var t,r=new s(2*e.length),n=this.nodeIdx,a=this.prevBuf,i=this.prevBuf.length,$=-this.prevBuf.length;i>0&&(a=s.concat([a,e.slice(0,10)]));for(var f=0,p=0;f<e.length;f++){var d=f>=0?e[f]:a[f+i],t=this.decodeTables[n][d];if(t>=0);else if(t===l)f=$,t=this.defaultCharUnicode.charCodeAt(0);else if(t===c){var h=$>=0?e.slice($,f+1):a.slice($+i,f+1+i),_=12600*(h[0]-129)+1260*(h[1]-48)+10*(h[2]-129)+(h[3]-48),g=o(this.gb18030.gbChars,_);t=this.gb18030.uChars[g]+_-this.gb18030.gbChars[g]}else{if(t<=u){n=u-t;continue}if(!(t<=-10))throw new Error("iconv-lite internal error: invalid decoding table value "+t+" at "+n+"/"+d);for(var m=this.decodeTableSeq[-10-t],y=0;y<m.length-1;y++)t=m[y],r[p++]=255&t,r[p++]=t>>8;t=m[m.length-1]}if(t>65535){t-=65536;var v=55296+Math.floor(t/1024);r[p++]=255&v,r[p++]=v>>8,t=56320+t%1024}r[p++]=255&t,r[p++]=t>>8,n=0,$=f+1}return this.nodeIdx=n,this.prevBuf=$>=0?e.slice($):a.slice($+i),r.slice(0,p).toString("ucs2")},i.prototype.end=function(){for(var e="";this.prevBuf.length>0;){e+=this.defaultCharUnicode;var t=this.prevBuf.slice(1);this.prevBuf=new s(0),this.nodeIdx=0,t.length>0&&(e+=this.write(t))}return this.nodeIdx=0,e}},{buffer:void 0}],55:[function(e,t,r){"use strict";t.exports={shiftjis:{type:"_dbcs",table:function(){return e("./tables/shiftjis.json")},encodeAdd:{"":92,"":126},encodeSkipVals:[{from:60736,to:63808}]},csshiftjis:"shiftjis",mskanji:"shiftjis",sjis:"shiftjis",windows31j:"shiftjis",ms31j:"shiftjis",xsjis:"shiftjis",windows932:"shiftjis",ms932:"shiftjis",932:"shiftjis",cp932:"shiftjis",eucjp:{type:"_dbcs",table:function(){return e("./tables/eucjp.json")},encodeAdd:{"":92,"":126}},gb2312:"cp936",gb231280:"cp936",gb23121980:"cp936",csgb2312:"cp936",csiso58gb231280:"cp936",euccn:"cp936",windows936:"cp936",ms936:"cp936",936:"cp936",cp936:{type:"_dbcs",table:function(){return e("./tables/cp936.json")}},gbk:{type:"_dbcs",table:function(){return e("./tables/cp936.json").concat(e("./tables/gbk-added.json"))}},xgbk:"gbk",isoir58:"gbk",gb18030:{type:"_dbcs",table:function(){return e("./tables/cp936.json").concat(e("./tables/gbk-added.json"))},gb18030:function(){return e("./tables/gb18030-ranges.json")},encodeSkipVals:[128],encodeAdd:{"":41699}},chinese:"gb18030",windows949:"cp949",ms949:"cp949",949:"cp949",cp949:{type:"_dbcs",table:function(){return e("./tables/cp949.json")}},cseuckr:"cp949",csksc56011987:"cp949",euckr:"cp949",isoir149:"cp949",korean:"cp949",ksc56011987:"cp949",ksc56011989:"cp949",ksc5601:"cp949",windows950:"cp950",ms950:"cp950",950:"cp950",cp950:{type:"_dbcs",table:function(){return e("./tables/cp950.json")}},big5:"big5hkscs",big5hkscs:{type:"_dbcs",table:function(){return e("./tables/cp950.json").concat(e("./tables/big5-added.json"))},encodeSkipVals:[41676]},cnbig5:"big5hkscs",csbig5:"big5hkscs",xxbig5:"big5hkscs"}},{"./tables/big5-added.json":61,"./tables/cp936.json":62,"./tables/cp949.json":63,"./tables/cp950.json":64,"./tables/eucjp.json":65,"./tables/gb18030-ranges.json":66,"./tables/gbk-added.json":67,"./tables/shiftjis.json":68}],56:[function(e,t,r){"use strict";for(var n=[e("./internal"),e("./utf16"),e("./utf7"),e("./sbcs-codec"),e("./sbcs-data"),e("./sbcs-data-generated"),e("./dbcs-codec"),e("./dbcs-data")],a=0;a<n.length;a++){var t=n[a];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}},{"./dbcs-codec":54,"./dbcs-data":55,"./internal":57,"./sbcs-codec":58,"./sbcs-data":60,"./sbcs-data-generated":59,"./utf16":69,"./utf7":70}],57:[function(e,t,r){"use strict";function n(e,t){this.enc=e.encodingName,this.bomAware=e.bomAware,"base64"===this.enc?this.encoder=o:"cesu8"===this.enc&&(this.enc="utf8",this.encoder=s,""!==new c("eda0bdedb2a9","hex").toString()&&(this.decoder=l,this.defaultCharUnicode=t.defaultCharUnicode))}function a(e,t){u.call(this,t.enc)}function i(e,t){this.enc=t.enc}function o(e,t){this.prevStr=""}function s(e,t){}function l(e,t){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=t.defaultCharUnicode}var c=e("buffer").Buffer;t.exports={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:n},n.prototype.encoder=i,n.prototype.decoder=a;var u=e("string_decoder").StringDecoder;u.prototype.end||(u.prototype.end=function(){}),a.prototype=u.prototype,i.prototype.write=function(e){return new c(e,this.enc)},i.prototype.end=function(){},o.prototype.write=function(e){e=this.prevStr+e;var t=e.length-e.length%4;return this.prevStr=e.slice(t),e=e.slice(0,t),new c(e,"base64")},o.prototype.end=function(){return new c(this.prevStr,"base64")},s.prototype.write=function(e){for(var t=new c(3*e.length),r=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);a<128?t[r++]=a:a<2048?(t[r++]=192+(a>>>6),t[r++]=128+(63&a)):(t[r++]=224+(a>>>12),t[r++]=128+(a>>>6&63),t[r++]=128+(63&a))}return t.slice(0,r)},s.prototype.end=function(){},l.prototype.write=function(e){for(var t=this.acc,r=this.contBytes,n=this.accBytes,a="",i=0;i<e.length;i++){var o=e[i];128!=(192&o)?(r>0&&(a+=this.defaultCharUnicode,r=0),o<128?a+=String.fromCharCode(o):o<224?(t=31&o,r=1,n=1):o<240?(t=15&o,r=2,n=1):a+=this.defaultCharUnicode):r>0?(t=t<<6|63&o,r--,n++,0===r&&(a+=2===n&&t<128&&t>0?this.defaultCharUnicode:3===n&&t<2048?this.defaultCharUnicode:String.fromCharCode(t))):a+=this.defaultCharUnicode}return this.acc=t,this.contBytes=r,this.accBytes=n,a},l.prototype.end=function(){var e=0;return this.contBytes>0&&(e+=this.defaultCharUnicode),e}},{buffer:void 0,string_decoder:void 0}],58:[function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error("SBCS codec is called without the data.");if(!e.chars||128!==e.chars.length&&256!==e.chars.length)throw new Error("Encoding '"+e.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(128===e.chars.length){for(var r="",n=0;n<128;n++)r+=String.fromCharCode(n);e.chars=r+e.chars}this.decodeBuf=new o(e.chars,"ucs2");var a=new o(65536);a.fill(t.defaultCharSingleByte.charCodeAt(0));for(var n=0;n<e.chars.length;n++)a[e.chars.charCodeAt(n)]=n;this.encodeBuf=a}function a(e,t){this.encodeBuf=t.encodeBuf}function i(e,t){this.decodeBuf=t.decodeBuf}var o=e("buffer").Buffer;r._sbcs=n,n.prototype.encoder=a,n.prototype.decoder=i,a.prototype.write=function(e){for(var t=new o(e.length),r=0;r<e.length;r++)t[r]=this.encodeBuf[e.charCodeAt(r)];return t},a.prototype.end=function(){},i.prototype.write=function(e){for(var t=this.decodeBuf,r=new o(2*e.length),n=0,a=0,i=0;i<e.length;i++)n=2*e[i],a=2*i,r[a]=t[n],r[a+1]=t[n+1];return r.toString("ucs2")},i.prototype.end=function(){}},{buffer:void 0}],59:[function(e,t,r){"use strict";t.exports={437:"cp437",737:"cp737",775:"cp775",850:"cp850",852:"cp852",855:"cp855",856:"cp856",857:"cp857",858:"cp858",860:"cp860",861:"cp861",862:"cp862",863:"cp863",864:"cp864",865:"cp865",866:"cp866",869:"cp869",874:"windows874",922:"cp922",1046:"cp1046",1124:"cp1124",1125:"cp1125",1129:"cp1129",1133:"cp1133",1161:"cp1161",1162:"cp1162",1163:"cp1163",1250:"windows1250",1251:"windows1251",1252:"windows1252",1253:"windows1253",1254:"windows1254",1255:"windows1255",1256:"windows1256",1257:"windows1257",1258:"windows1258",28591:"iso88591",28592:"iso88592",28593:"iso88593",28594:"iso88594",28595:"iso88595",28596:"iso88596",28597:"iso88597",28598:"iso88598",28599:"iso88599",28600:"iso885910",28601:"iso885911",28603:"iso885913",28604:"iso885914",28605:"iso885915",28606:"iso885916",windows874:{type:"_sbcs",chars:""},win874:"windows874",cp874:"windows874",windows1250:{type:"_sbcs",chars:""},win1250:"windows1250",cp1250:"windows1250",windows1251:{type:"_sbcs",chars:""},win1251:"windows1251",cp1251:"windows1251",windows1252:{type:"_sbcs",chars:""},win1252:"windows1252",cp1252:"windows1252",windows1253:{type:"_sbcs",chars:""},win1253:"windows1253",cp1253:"windows1253",windows1254:{type:"_sbcs",chars:""},win1254:"windows1254",cp1254:"windows1254",windows1255:{type:"_sbcs",chars:""},win1255:"windows1255",cp1255:"windows1255",windows1256:{type:"_sbcs",chars:""},win1256:"windows1256",cp1256:"windows1256",windows1257:{type:"_sbcs",chars:""},win1257:"windows1257",cp1257:"windows1257",windows1258:{type:"_sbcs",chars:""},win1258:"windows1258",cp1258:"windows1258",iso88591:{type:"_sbcs",chars:""},cp28591:"iso88591",iso88592:{type:"_sbcs",chars:""},cp28592:"iso88592",iso88593:{type:"_sbcs",chars:""},cp28593:"iso88593",iso88594:{type:"_sbcs",chars:""},cp28594:"iso88594",iso88595:{type:"_sbcs",chars:""},cp28595:"iso88595",iso88596:{type:"_sbcs",chars:""},cp28596:"iso88596",iso88597:{type:"_sbcs",chars:""},cp28597:"iso88597",iso88598:{type:"_sbcs",chars:""},cp28598:"iso88598",iso88599:{type:"_sbcs",chars:""},cp28599:"iso88599",iso885910:{type:"_sbcs",chars:""},cp28600:"iso885910",iso885911:{type:"_sbcs",chars:""},cp28601:"iso885911",iso885913:{type:"_sbcs",chars:""},cp28603:"iso885913",iso885914:{type:"_sbcs",chars:""},cp28604:"iso885914",iso885915:{type:"_sbcs",chars:""},cp28605:"iso885915",iso885916:{type:"_sbcs",chars:""},cp28606:"iso885916",cp437:{type:"_sbcs",chars:""},ibm437:"cp437",csibm437:"cp437",cp737:{type:"_sbcs",chars:""},ibm737:"cp737",csibm737:"cp737",cp775:{type:"_sbcs",chars:""},ibm775:"cp775",csibm775:"cp775",cp850:{type:"_sbcs",chars:""},ibm850:"cp850",csibm850:"cp850",cp852:{type:"_sbcs",chars:""},ibm852:"cp852",csibm852:"cp852",cp855:{type:"_sbcs",chars:""},ibm855:"cp855",csibm855:"cp855",cp856:{type:"_sbcs",chars:""},ibm856:"cp856",csibm856:"cp856",cp857:{type:"_sbcs",chars:""},ibm857:"cp857",csibm857:"cp857",cp858:{type:"_sbcs",chars:""},ibm858:"cp858",csibm858:"cp858",cp860:{type:"_sbcs",chars:""},ibm860:"cp860",csibm860:"cp860",cp861:{type:"_sbcs",chars:""},ibm861:"cp861",csibm861:"cp861",cp862:{type:"_sbcs",chars:""},ibm862:"cp862",csibm862:"cp862",cp863:{type:"_sbcs",chars:""},ibm863:"cp863",csibm863:"cp863",cp864:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},ibm864:"cp864",csibm864:"cp864",cp865:{type:"_sbcs",chars:""},ibm865:"cp865",csibm865:"cp865",cp866:{type:"_sbcs",chars:""},ibm866:"cp866",csibm866:"cp866",cp869:{type:"_sbcs",chars:""},ibm869:"cp869",csibm869:"cp869",cp922:{type:"_sbcs",chars:""},ibm922:"cp922",csibm922:"cp922",cp1046:{type:"_sbcs",chars:""},ibm1046:"cp1046",csibm1046:"cp1046",cp1124:{type:"_sbcs",chars:""},ibm1124:"cp1124",csibm1124:"cp1124",cp1125:{type:"_sbcs",chars:""},ibm1125:"cp1125",csibm1125:"cp1125",cp1129:{type:"_sbcs",chars:""},ibm1129:"cp1129",csibm1129:"cp1129",cp1133:{type:"_sbcs",chars:""},ibm1133:"cp1133",csibm1133:"cp1133",cp1161:{type:"_sbcs",chars:""},ibm1161:"cp1161",csibm1161:"cp1161",cp1162:{type:"_sbcs",chars:""},ibm1162:"cp1162",csibm1162:"cp1162",cp1163:{type:"_sbcs",chars:""},ibm1163:"cp1163",csibm1163:"cp1163",maccroatian:{type:"_sbcs",chars:""},maccyrillic:{type:"_sbcs",chars:""},macgreek:{type:"_sbcs",chars:""},maciceland:{type:"_sbcs",chars:""},macroman:{type:"_sbcs",chars:""},macromania:{type:"_sbcs",chars:""},macthai:{type:"_sbcs",chars:"\ufeff"},macturkish:{type:"_sbcs",chars:""},macukraine:{type:"_sbcs",chars:""},koi8r:{type:"_sbcs",chars:""},koi8u:{type:"_sbcs",chars:""},koi8ru:{type:"_sbcs",chars:""},koi8t:{type:"_sbcs",chars:""},armscii8:{type:"_sbcs",chars:")(.,-"},rk1048:{type:"_sbcs",chars:""},tcvn:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},georgianacademy:{type:"_sbcs",chars:""},georgianps:{type:"_sbcs",chars:""},pt154:{type:"_sbcs",chars:""},viscii:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},iso646cn:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}"},iso646jp:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}"},hproman8:{type:"_sbcs",chars:""},macintosh:{type:"_sbcs",chars:""},ascii:{type:"_sbcs",chars:""},tis620:{type:"_sbcs",chars:""}}},{}],60:[function(e,t,r){"use strict";t.exports={10029:"maccenteuro",maccenteuro:{type:"_sbcs",chars:""},808:"cp808",ibm808:"cp808",cp808:{type:"_sbcs",chars:""},ascii8bit:"ascii",usascii:"ascii",ansix34:"ascii",ansix341968:"ascii",ansix341986:"ascii",csascii:"ascii",cp367:"ascii",ibm367:"ascii",isoir6:"ascii",iso646us:"ascii",iso646irv:"ascii",us:"ascii",latin1:"iso88591",latin2:"iso88592",latin3:"iso88593",latin4:"iso88594",latin5:"iso88599",latin6:"iso885910",latin7:"iso885913",latin8:"iso885914",latin9:"iso885915",latin10:"iso885916",csisolatin1:"iso88591",csisolatin2:"iso88592",csisolatin3:"iso88593",csisolatin4:"iso88594",csisolatincyrillic:"iso88595",csisolatinarabic:"iso88596",csisolatingreek:"iso88597",csisolatinhebrew:"iso88598",csisolatin5:"iso88599",csisolatin6:"iso885910",l1:"iso88591",l2:"iso88592",l3:"iso88593",l4:"iso88594",l5:"iso88599",l6:"iso885910",l7:"iso885913",l8:"iso885914",l9:"iso885915",l10:"iso885916",isoir14:"iso646jp",isoir57:"iso646cn",isoir100:"iso88591",isoir101:"iso88592",isoir109:"iso88593",isoir110:"iso88594",isoir144:"iso88595",isoir127:"iso88596",isoir126:"iso88597",isoir138:"iso88598",isoir148:"iso88599",isoir157:"iso885910",isoir166:"tis620",isoir179:"iso885913",isoir199:"iso885914",isoir203:"iso885915",isoir226:"iso885916",cp819:"iso88591",ibm819:"iso88591",cyrillic:"iso88595",arabic:"iso88596",arabic8:"iso88596",ecma114:"iso88596",asmo708:"iso88596",greek:"iso88597",greek8:"iso88597",ecma118:"iso88597",elot928:"iso88597",hebrew:"iso88598",hebrew8:"iso88598",turkish:"iso88599",turkish8:"iso88599",thai:"iso885911",thai8:"iso885911",celtic:"iso885914",celtic8:"iso885914",isoceltic:"iso885914",tis6200:"tis620",tis62025291:"tis620",tis62025330:"tis620",10000:"macroman",10006:"macgreek",10007:"maccyrillic",10079:"maciceland",10081:"macturkish",cspc8codepage437:"cp437",cspc775baltic:"cp775",cspc850multilingual:"cp850",cspcp852:"cp852",cspc862latinhebrew:"cp862",cpgr:"cp869",msee:"cp1250",mscyrl:"cp1251",msansi:"cp1252",msgreek:"cp1253",msturk:"cp1254",mshebr:"cp1255",msarab:"cp1256",winbaltrim:"cp1257",cp20866:"koi8r",20866:"koi8r",ibm878:"koi8r",cskoi8r:"koi8r",cp21866:"koi8u",21866:"koi8u",ibm1168:"koi8u",strk10482002:"rk1048",tcvn5712:"tcvn",tcvn57121:"tcvn",gb198880:"iso646cn",cn:"iso646cn",csiso14jisc6220ro:"iso646jp",
jisc62201969ro:"iso646jp",jp:"iso646jp",cshproman8:"hproman8",r8:"hproman8",roman8:"hproman8",xroman8:"hproman8",ibm1051:"hproman8",mac:"macintosh",csmacintosh:"macintosh"}},{}],61:[function(e,t,r){t.exports=[["8740",""],["8767",""],["87a1",""],["8840","",4,""],["88a1",""],["8940",""],["8943",""],["8946",""],["894c",""],["89a1",""],["89ab",""],["89b0",""],["89b5",""],["89c1",""],["89c5",""],["8a40",""],["8a43",""],["8a64",""],["8a76",""],["8aa1",""],["8aac",""],["8ab2",""],["8abb",""],["8ac9",""],["8ace",""],["8adf",""],["8af6",""],["8b40",""],["8b55",""],["8ba1",""],["8bde",""],["8c40",""],["8ca1",""],["8ca7",""],["8cc9",""],["8cce",""],["8ce6",""],["8d40",""],["8d42",""],["8da1",""],["8e40",""],["8ea1",""],["8f40",""],["8fa1",""],["9040",""],["90a1",""],["9140",""],["91a1",""],["9240",""],["92a1",""],["9340",""],["93a1",""],["9440",""],["94a1",""],["9540",""],["95a1",""],["9640",""],["96a1",""],["9740",""],["97a1",""],["9840",""],["98a1",""],["9940",""],["99a1",""],["9a40",""],["9aa1",""],["9b40",""],["9b62",""],["9ba1",""],["9c40",""],["9ca1",""],["9d40",""],["9da1",""],["9e40",""],["9ea1",""],["9ead",""],["9ec5",""],["9ef5",""],["9f40",""],["9f4f",""],["9fa1",""],["9fae",""],["9fb2",""],["9fc1",""],["9fc9",""],["9fdb",""],["9fe7",""],["9feb",""],["9ff0",""],["a040",""],["a055",""],["a058",""],["a05b",""],["a063",""],["a073",""],["a0a1",""],["a0a6",""],["a0ae",""],["a0b0",""],["a0d4",""],["a0e2",""],["a3c0","",31,""],["c6a1","",9,"",9,"",9,"",23],["c740","",58,""],["c7a1","",81,"",5,"",4],["c840","",26,"",25,""],["c8a1",""],["c8cd",""],["c8f5",""],["f9fe",""],["fa40",""],["faa1",""],["fb40",""],["fba1",""],["fc40",""],["fca1",""],["fd40",""],["fda1",""],["fe40",""],["fea1",""]]},{}],62:[function(e,t,r){t.exports=[["0","\0",127,""],["8140","",5,"",9,"",6,""],["8180","",6,"",4,"",4,"",5,""],["8240","",4,"",8,"",4,"",11],["8280","",10,"",4,"",7,"",5,"",8,"",20,"",4,"",6,""],["8340","",17,"",5,"",10,"",4,"",9,""],["8380","",5,"",13,"",28,"",4,"",4,"",5],["8440","",5,"",5,""],["8480","",9,"",4,"",6,"",6,"",9,"",5,"",10,"",7,""],["8540","",9,""],["8580","",4,"",6,"",4,"",4,"",7,""],["8640","",4,"",5,"",4,"",5,""],["8680","",4,"",4,"",5,"",6,"",8,"",4,"",4,"",4,""],["8740","",7,"",11,"",4,"",4],["8780","",7,"",6,"",14,"",10,"",6,"",12,"",8,"",5,"",6],["8840","",9,"",4,"",4,""],["8880","",4,"",6,"",8,"",6,"",7,"",4,"",4,"",7],["8940","",5,"",6,"",4,"",5,"",4,"",16,""],["8980","",4,"",4,"",7,"",17,"",10,"",13,"",5,"",7,"",4,""],["8a40","",4,"",12,""],["8a80","",5,"",6,"",4,"",11,"",6,"",4,"",4,"",9,"",5],["8b40","",8,"",17,"",6,"",13,""],["8b80","",4,"",4,"",5,"",4,"",4,"",22,"",11,"",25,"",7,"",6],["8c40","",7,""],["8c80","",8,"",4,"",6,"",6,"",6,"",4,"",4,"",4],["8d40","",5,"",5,"",5,"",6,"",9,"",4],["8d80","",5,"",4,"",4,"",4,"",7,"",7,"",10,"",10,"",12,"",21,""],["8e40","",21,"",12,"",6,"",12,""],["8e80","",4,"",7,"",4,"",4,"",5,"",6,"",4,"",14,"",4,"",4,"",6],["8f40","",5,"",11,"",8,""],["8f80","",6,"",14,"",5,"",5,"",4,""],["9040","",4,"",4,"",6,""],["9080","",7,"",4,"",4,"",4,"",4,"",18,"",6],["9140","",6,"",6,"",18,"",4,""],["9180","",6,"",8,"",9,"",5,"",4,"",4,"",16,"",13,"",8,"",5,"",4,""],["9240","",6,"",5,""],["9280","",5,"",7,"",6,""],["9340","",6,"",4,"",4,"",5,""],["9380","",5,"",4,"",6,"",4,"",7,"",9,"",6,"",8,"",4,"",6,""],["9440","",24,"",7,"",7,"",4,"",8],["9480","",4,"",4,"",14,"",7,"",7,""],["9540","",4,"",4,"",6,""],["9580","",4,"",4,"",8,"",4,"",4,"",25,"",7,"",5,""],["9640","",5,"",4,""],["9680","",7,"",9,"",7,"",4,"",6,"",6,"",5],["9740","",7,"",8,"",7,"",9,""],["9780","",6,"",5,"",4,"",9,"",4,"",11,"",7,"",16,""],["9840","",4,"",5,"",9,""],["9880","",7,"",5,"",11,"",9,"",9,"",11,"",5,"",5,"",6,"",4,"",7,"",6,""],["9940","",4,"",10,"",6,"",8,"",4,"",7,"",5],["9980","",114,"",6],["9a40","",11,"",7,"",13,""],["9a80","",4,"",7,"",7,"",6,"",4,"",4,"",7,"",6,"",4,"",4,""],["9b40","",4,""],["9b80","",5,"",4,"",4,"",5,""],["9c40","",7,""],["9c80","",7,"",7,"",10,"",14,"",4,"",6,"",5],["9d40","",7,"",4,"",9,"",6,""],["9d80","",9,"",5,"",6,"",12,"",4,"",10,"",5,"",5,"",6,"",10,""],["9e40","",7,"",32,"",7,"",6,"",6],["9e80","",9,"",17,"",13,"",11,"",12,"",12,""],["9f40","",6,"",10,"",4,"",10,"",7,""],["9f80","",13,"",12,"",4,"",4,"",5,"",4,"",4,"",6,"",5,"",8,"",9,"",4],["a040","",9,"",5,"",9,"",11,"",19],["a080","",9,"",6,"",4,"",11,"",11,"",6,""],["a1a1","",7,""],["a2a1","",9],["a2b1","",19,"",19,"",9],["a2e5","",9],["a2f1","",11],["a3a1","",88,""],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a6e0",""],["a6ee",""],["a6f4",""],["a7a1","",5,"",25],["a7d1","",5,"",25],["a840","",35,"",6],["a880","",7,""],["a8a1",""],["a8bd",""],["a8c0",""],["a8c5","",36],["a940","",8,""],["a959",""],["a95c",""],["a960","",9,"",8],["a980","",4,""],["a996",""],["a9a4","",75],["aa40","",5,"",5,"",8],["aa80","",7,"",10,""],["ab40","",11,"",4,"",5,"",4],["ab80","",6,"",4],["ac40","",10,"",8,"",5,"",4,"",11],["ac80","",6,"",12,"",4,""],["ad40","",10,"",7,"",15,"",12],["ad80","",9,"",8,"",6,""],["ae40","",6,"",7,"",4,""],["ae80","",7,"",6,"",4,""],["af40","",4,""],["af80",""],["b040","",6,"",5,"",4,"",6,"",7,""],["b080","",7,"",8,"",9,""],["b140","",4,"",7,"",10,""],["b180","",4,"",7,"",7,""],["b240","",11,"",5,"",11,"",4],["b280","",12,"",8,"",4,""],["b340","",5,""],["b380","",11,"",7,"",6,""],["b440","",7,"",9],["b480","",4,"",5,"",6,""],["b540","",5,"",9,"",4,"",14,"",4,"",8,""],["b580","",6,"",4,""],["b640","",6,"",11,"",10,"",4,"",5,""],["b680","",6,"",4,""],["b740","",14,"",5,"",9,"",4,"",16],["b780","",6,""],["b840","",4,"",10,"",10,"",9,"",5,""],["b880","",4,""],["b940","",5,"",10,"",6,""],["b980","",7,""],["ba40","",4,"",4,"",7,"",5,""],["ba80","",4,"",5,"",12,"",5,""],["bb40","",9,"",36,"",5,"",9],["bb80","",6,"",4,""],["bc40","",6,"",6,"",5,"",7,"",13,"",5],["bc80","",14,"",6,""],["bd40","",54,"",7],["bd80","",32,""],["be40","",12,"",6,"",42],["be80","",32,""],["bf40","",62],["bf80","",4,"",4,"",21,""],["c040","",35,"",23,""],["c080","",6,"",9,""],["c140","",4,"",7,"",4,"",4,"",6,""],["c180","",4,"",4,"",5,""],["c240","",6,"",5,""],["c280","",13,"",5,"",11,""],["c340","",5,"",4,"",6,""],["c380","",12,"",4,""],["c440","",5,"",4,"",4,"",5,"",4,""],["c480","",7,"",5,"",6,""],["c540","",14,"",4,"",5,"",4,"",5,""],["c580","",7,"",7,""],["c640",""],["c680","",4,"",9,""],["c740","",4,"",4,"",6,"",6,"",6,""],["c780",""],["c840","",4,"",5,"",5,"",7,"",5,"",7,""],["c880","",6,"",4,"",4,""],["c940","",4,"",7,"",12,""],["c980","",4,"",4,"",10,""],["ca40","",8,"",8,"",9,"",4,"",10],["ca80","",4,"",8,""],["cb40","",6,"",10,"",6,"",5,"",6,"",6,"",4,""],["cb80","",5,"",6,"",14,""],["cc40","",4,"",10,"",15,"",13,""],["cc80","",11,"",4,"",7,""],["cd40","",6,"",6,"",4,"",5,"",4,"",4,""],["cd80",""],["ce40","",6,"",5,"",7,""],["ce80","",4,"",6,"",4,""],["cf40","",4,"",4,"",6,"",9],["cf80","",5,"",7,"",4,""],["d040","",13,"",5,"",5,"",5,"",6,""],["d080","",4,"",4,"",5,""],["d140","",4,"",4,"",6,"",5],["d180","",4,"",4,"",4,""],["d240","",8,"",24,"",5,"",19,""],["d280","",26,""],["d340","",30,"",6],["d380","",4,"",5,"",21,""],["d440","",31,"",8,"",21],["d480","",25,"",6,""],["d540","",7,"",7,"",46],["d580","",32,""],["d640","",34,"",27],["d680","",30,""],["d740","",31,"",4,"",25],["d780","",24,""],["d840","",8,"",7,"",5,"",6,"",6,"",6,""],["d880","",6,"",20,""],["d940","",62],["d980","",32,""],["da40","",14,"",8,"",4,"",9,""],["da80","",12,""],["db40","",6,"",7,"",4,""],["db80","",4,"",5,"",11,""],["dc40","",4,"",6,"",6,"",11,"",6,"",7],["dc80","",10,"",21,""],["dd40","",62],["dd80","",32,""],["de40","",32,""],["de80","",4,""],["df40","",5,"",4,"",4,"",5,"",4,"",6,""],["df80","",4,""],["e040","",19,""],["e080","",10,"",6,"",8,""],["e140","",4,"",6,"",5,"",5,""],["e180","",10,"",9,"",8,""],["e240","",62],["e280","",32,"",5,""],["e340","",45,"",16],["e380","",7,"",24,""],["e440","",5,"",24,"",31],["e480","",32,""],["e540","",51,"",10],["e580","",31,""],["e640","",34,"",27],["e680","",29,""],["e740","",7,"",54],["e780","",32,"",6,"",4,""],["e840","",14,"",43,""],["e880","",20,""],["e940","",7,"",42],["e980","",32,""],["ea40","",27,"",6,""],["ea80","",4,"",12,""],["eb40","",9,"",7,"",9,"",6,""],["eb80","",4,""],["ec40","",8,"",4,"",18,"",7],["ec80","",4,"",7,"",4,"",4,""],["ed40","",6,"",46],["ed80","",4,"",23,""],["ee40","",62],["ee80","",32,"",4,"",6,""],["ef40","",5,"",37,"",4],["ef80","",30,"",4,"",8,""],["f040","",4,"",28,"",26],["f080","",9,"",12,"",4,"",6,""],["f140","",10,"",47],["f180","",32,""],["f240","",62],["f280","",32,""],["f340","",17,"",6,"",4,""],["f380","",8,"",6,""],["f440","",5,"",10,"",10,"",7,"",5],["f480","",32,""],["f540","",62],["f580","",32,""],["f640","",62],["f680","",32,"",5,"",5,"",4,"",7,""],["f740","",62],["f780","",4,"",4,""],["f840","",62],["f880","",32],["f940","",62],["f980","",32],["fa40","",62],["fa80","",32],["fb40","",27,"",9,""],["fb80","",5,"",8,"",5,""],["fc40","",8,"",4,"",8,"",6],["fc80","",4,"",5,"",8,""],["fd40","",4,"",4,"",10,"",38],["fd80","",5,"",11,"",4,""],["fe40",""]]},{}],63:[function(e,t,r){
t.exports=[["0","\0",127],["8141","",4,"",6,""],["8161","",9,"",5,""],["8181","",18,"",4,"",6,"",5,"",6,"",7,"",7,"",4,"",4,""],["8241","",7,"",5],["8261","",6,"",5,""],["8281","",7,"",7,"",4,"",10,"",5,"",17,"",7,"",6,"",7,"",18],["8341","",5,"",5,"",7],["8361","",18,""],["8381","",4,"",6,"",5,"",5,"",46,"",6,"",5,"",8],["8441","",5,"",8],["8461","",18],["8481","",7,"",6,"",5,"",10,"",5,"",18,"",5,"",6,"",5,"",26,""],["8541","",5,"",4,"",6,"",4],["8561","",5,"",5,"",6,""],["8581","",6,"",6,"",9,"",26,"",29,"",6,"",5,""],["8641","",6,"",5,""],["8661","",6,"",10],["8681","",22,"",4,"",6,"",5,"",6,"",22,"",4,""],["8741","",9,"",15],["8761","",18,""],["8781","",5,"",7,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",4],["8841","",4,"",5,"",6,"",4],["8861","",4,""],["8881","",15,"",4,"",6,"",5,"",54,""],["8941","",6,"",5,""],["8961","",10,"",5,""],["8981","",21,"",18,"",18,"",6,"",6,"",7,"",15],["8a41","",10,"",6,""],["8a61","",4,"",18,""],["8a81","",4,"",19,"",5,"",7,"",5,"",6,"",5,"",4,"",5,"",26,""],["8b41","",5,"",4,"",6,""],["8b61","",6,"",8],["8b81","",52,"",4,"",6,"",5,"",18,"",18],["8c41","",15,"",4],["8c61","",6,"",5,"",6,"",5],["8c81","",12,"",26,"",50,"",5,"",16],["8d41","",16,"",8],["8d61","",17,""],["8d81","",4,"",33,"",6,"",7,"",6,"",9,"",6,"",5,"",6,""],["8e41","",6,"",5,"",8],["8e61","",4,"",19],["8e81","",13,"",6,"",4,"",6,"",5,"",6,"",5,"",11,"",7,"",6,"",5,"",7],["8f41","",7,"",17],["8f61","",7,"",6,"",4],["8f81","",5,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",5],["9041","",6,"",5,""],["9061","",5,"",15],["9081","",12,"",6,"",5,"",4,"",6,"",4,"",5,"",11,"",33,""],["9141","",6,"",5],["9161","",9,"",5],["9181","",20,"",4,"",5,"",14,"",33,"",7,"",5,"",6],["9241","",7,"",4,""],["9261","",7,"",7,"",4],["9281","",21,"",18,"",6,"",7,"",6,"",35,""],["9341","",4,""],["9361","",6,"",8],["9381","",37,"",4,"",4,"",6,"",5,"",7,"",22,""],["9441","",5,"",5,"",8],["9461","",5,"",6,"",12],["9481","",5,"",6,"",6,"",9,"",22,"",4,"",6,"",10,"",6,"",24],["9541","",11,"",5,""],["9561","",6,"",5,""],["9581","",6,"",35,"",4,"",4,"",4,"",6,"",5,"",13,"",14],["9641","",23,""],["9661","",6,"",5,"",8],["9681","",10,"",5,"",13,"",33,"",6,"",44],["9741","",16,"",8],["9761","",17,"",7],["9781","",11,"",5,"",6,"",89,""],["9841","",16,"",5,""],["9861","",6,"",15],["9881","",21,"",6,"",5,"",4,"",6,"",5,"",6,"",5,"",6,"",5,""],["9941","",6,"",5,""],["9961","",6,"",5,""],["9981","",8,"",5,"",4,"",11,"",5,"",6,"",6,"",6,"",7,"",6,"",5,""],["9a41","",16],["9a61","",6,"",6,""],["9a81","",4,"",6,"",5,"",5,"",6,"",5,"",5,"",33,"",5,"",6,""],["9b41","",6,"",8],["9b61","",17,"",7],["9b81","",25,"",4,"",5,"",50,"",22,""],["9c41","",4,"",5,"",5],["9c61","",8,"",6,"",9],["9c81","",8,"",6,"",6,"",9,"",26,"",6,"",5,"",18,"",6,"",12],["9d41","",13,"",8],["9d61","",25],["9d81","",8,"",5,"",9,"",6,"",10,"",6,"",5,"",6,"",5,""],["9e41","",7,"",9,""],["9e61","",4,"",6,""],["9e81","",6,"",6,"",6,"",5,"",10,"",5,"",6,"",5,"",6,""],["9f41","",5,"",4,"",5,""],["9f61","",6,"",5,""],["9f81","",4,"",5,"",6,"",5,"",6,"",4,"",6,"",7,"",4,"",4,""],["a041","",5,"",6,""],["a061","",5,"",13],["a081","",4,"",4,"",4,"",6,"",5,"",6,"",5,"",26,"",4,"",5,"",7,""],["a141","",18,""],["a161","",6,"",5,""],["a181","",14,"",5,"",4,"",9,""],["a241","",5,"",18],["a261","",6,"",18],["a281","",7,"",6,"",7,""],["a341","",6,"",10,""],["a361","",6,"",16],["a381","",16,"",4,"",58,"",32,""],["a441","",5,""],["a461","",5,"",12],["a481","",28,"",93],["a541","",4,"",6,"",5,""],["a561","",17,"",5,""],["a581","",16,"",14,"",9],["a5b0","",9],["a5c1","",16,"",6],["a5e1","",16,"",6],["a641","",19,""],["a661","",5,"",5,"",6],["a681","",6,"",18,"",7],["a741","",4,"",6,"",7],["a761","",22,""],["a781","",6,"",5,"",7,"",9,"",9,"",4,"",5,"",4,""],["a841","",10,"",14],["a861","",18,"",6],["a881","",19,"",11,""],["a8a6",""],["a8a8",""],["a8b1","",27,"",25,"",14,""],["a941","",14,"",10],["a961","",18],["a981","",14,"",6,"",27,"",25,"",14,""],["aa41","",6,"",4,""],["aa61","",4,"",5,"",6,""],["aa81","",29,"",82],["ab41","",6,"",5,""],["ab61","",6,"",5,"",5],["ab81","",8,"",6,"",12,"",85],["ac41","",5,"",6,""],["ac61","",11,"",4],["ac81","",28,"",5,"",25],["acd1","",5,"",25],["ad41","",6,"",5,"",7],["ad61","",6,"",10,""],["ad81","",5,"",18,""],["ae41","",5,"",16],["ae61","",5,"",6,"",4],["ae81","",6,"",5,""],["af41","",19],["af61","",13,"",5,""],["af81","",5,"",6,"",5,""],["b041","",5,"",5,"",12],["b061","",5,"",19],["b081","",13,"",6,"",5,"",7,"",4,""],["b141","",6,"",5,""],["b161","",6,"",5,"",11],["b181","",14,"",6,""],["b241","",6,"",5,""],["b261","",18,"",5,""],["b281","",5,"",18,"",6,""],["b341","",19,""],["b361","",5,"",5,"",5],["b381","",5,"",5,"",19,"",4,""],["b441","",5,"",6,"",5],["b461","",6,"",10,""],["b481","",6,"",18,"",4,"",4,""],["b541","",14,"",5],["b561","",5,"",5,"",4],["b581","",6,"",5,"",11,""],["b641","",7,"",17],["b661","",15,""],["b681","",5,"",6,"",5,""],["b741","",13,"",6,""],["b761","",20,""],["b781","",6,"",14,""],["b841","",7,"",17],["b861","",8,"",13],["b881","",5,"",24,"",4,""],["b941","",6,"",5,""],["b961","",14,"",6,""],["b981","",22,"",4,"",4,""],["ba41","",5,"",6,""],["ba61","",5,"",4,"",5],["ba81","",6,"",9,""],["bb41","",4,"",5,"",4,""],["bb61","",6,"",5,""],["bb81","",31,""],["bc41","",17,""],["bc61","",5,"",6,""],["bc81","",4,"",6,"",5,"",5,"",4,""],["bd41","",7,"",7,""],["bd61","",5,"",13],["bd81","",5,"",25,""],["be41","",7,"",14],["be61","",7,"",7,""],["be81","",4,"",4,"",5,"",8,"",6,""],["bf41","",10,"",14],["bf61","",18,""],["bf81","",5,"",7,"",6,"",5,""],["c041","",5,"",6,"",5],["c061","",25],["c081","",6,"",5,"",7,""],["c141","",5,"",6,""],["c161","",19,""],["c181","",31,""],["c241","",4,"",5,""],["c261","",4,"",5,"",6,""],["c281","",5,"",7,"",9,""],["c341","",4],["c361","",4,"",5,"",11],["c381","",5,"",7,"",5,""],["c441","",7,"",7,""],["c461","",5,"",4],["c481","",5,"",11,""],["c541","",6,"",5,""],["c561","",6,"",5,"",4],["c581","",6,"",5,""],["c641","",6,"",5],["c6a1",""],["c7a1",""],["c8a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1","",5,"",4,""],["d2a1","",4,"",5,"",10,"",7,"",5,""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f5a1",""],["f6a1",""],["f7a1",""],["f8a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fda1",""]]},{}],64:[function(e,t,r){
t.exports=[["0","\0",127],["a140",""],["a1a1","",4,""],["a240","",7,""],["a2a1","",9,"",9,"",8,"",25,"",21],["a340","",16,"",6,"",16,"",6,"",10],["a3a1","",25,""],["a3e1",""],["a440",""],["a4a1",""],["a540",""],["a5a1",""],["a640",""],["a6a1",""],["a740",""],["a7a1",""],["a840",""],["a8a1",""],["a940",""],["a9a1",""],["aa40",""],["aaa1",""],["ab40",""],["aba1",""],["ac40",""],["aca1",""],["ad40",""],["ada1",""],["ae40",""],["aea1",""],["af40",""],["afa1",""],["b040",""],["b0a1",""],["b140",""],["b1a1",""],["b240",""],["b2a1",""],["b340",""],["b3a1",""],["b440",""],["b4a1",""],["b540",""],["b5a1",""],["b640",""],["b6a1",""],["b740",""],["b7a1",""],["b840",""],["b8a1",""],["b940",""],["b9a1",""],["ba40",""],["baa1",""],["bb40",""],["bba1",""],["bc40",""],["bca1",""],["bd40",""],["bda1",""],["be40",""],["bea1",""],["bf40",""],["bfa1",""],["c040",""],["c0a1",""],["c140",""],["c1a1",""],["c240",""],["c2a1",""],["c340",""],["c3a1",""],["c440",""],["c4a1",""],["c540",""],["c5a1",""],["c640",""],["c940",""],["c9a1",""],["ca40",""],["caa1",""],["cb40",""],["cba1",""],["cc40",""],["cca1",""],["cd40",""],["cda1",""],["ce40",""],["cea1",""],["cf40",""],["cfa1",""],["d040",""],["d0a1",""],["d140",""],["d1a1",""],["d240",""],["d2a1",""],["d340",""],["d3a1",""],["d440",""],["d4a1",""],["d540",""],["d5a1",""],["d640",""],["d6a1",""],["d740",""],["d7a1",""],["d840",""],["d8a1",""],["d940",""],["d9a1",""],["da40",""],["daa1",""],["db40",""],["dba1",""],["dc40",""],["dca1",""],["dd40",""],["dda1",""],["de40",""],["dea1",""],["df40",""],["dfa1",""],["e040",""],["e0a1",""],["e140",""],["e1a1",""],["e240",""],["e2a1",""],["e340",""],["e3a1",""],["e440",""],["e4a1",""],["e540",""],["e5a1",""],["e640",""],["e6a1",""],["e740",""],["e7a1",""],["e840",""],["e8a1",""],["e940",""],["e9a1",""],["ea40",""],["eaa1",""],["eb40",""],["eba1",""],["ec40",""],["eca1",""],["ed40",""],["eda1",""],["ee40",""],["eea1",""],["ef40",""],["efa1",""],["f040",""],["f0a1",""],["f140",""],["f1a1",""],["f240",""],["f2a1",""],["f340",""],["f3a1",""],["f440",""],["f4a1",""],["f540",""],["f5a1",""],["f640",""],["f6a1",""],["f740",""],["f7a1",""],["f840",""],["f8a1",""],["f940",""],["f9a1",""]]},{}],65:[function(e,t,r){t.exports=[["0","\0",127],["8ea1","",62],["a1a1","",9,""],["a2a1",""],["a2ba",""],["a2ca",""],["a2dc",""],["a2f2",""],["a2fe",""],["a3b0","",9],["a3c1","",25],["a3e1","",25],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a7a1","",5,"",25],["a7d1","",5,"",25],["a8a1",""],["ada1","",19,"",9],["adc0",""],["addf","",4,""],["b0a1",""],["b1a1",""],["b2a1",""],["b3a1",""],["b4a1",""],["b5a1",""],["b6a1",""],["b7a1",""],["b8a1",""],["b9a1",""],["baa1",""],["bba1",""],["bca1",""],["bda1",""],["bea1",""],["bfa1",""],["c0a1",""],["c1a1",""],["c2a1",""],["c3a1",""],["c4a1",""],["c5a1",""],["c6a1",""],["c7a1",""],["c8a1",""],["c9a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1",""],["d2a1",""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fcf1","",9,""],["8fa2af",""],["8fa2c2",""],["8fa2eb",""],["8fa6e1",""],["8fa6e7",""],["8fa6e9",""],["8fa6ec",""],["8fa6f1",""],["8fa7c2","",10,""],["8fa7f2","",10,""],["8fa9a1",""],["8fa9a4",""],["8fa9a6",""],["8fa9a8",""],["8fa9ab",""],["8fa9af",""],["8fa9c1",""],["8faaa1",""],["8faaba",""],["8faba1",""],["8fabbd",""],["8fabc5",""],["8fb0a1",""],["8fb1a1",""],["8fb2a1","",4,""],["8fb3a1",""],["8fb4a1",""],["8fb5a1",""],["8fb6a1","",5,"",4,""],["8fb7a1","",4,""],["8fb8a1",""],["8fb9a1",""],["8fbaa1","",4,""],["8fbba1",""],["8fbca1","",4,""],["8fbda1","",4,""],["8fbea1","",4,""],["8fbfa1",""],["8fc0a1",""],["8fc1a1",""],["8fc2a1",""],["8fc3a1","",4,""],["8fc4a1",""],["8fc5a1",""],["8fc6a1",""],["8fc7a1",""],["8fc8a1",""],["8fc9a1","",4,"",4,""],["8fcaa1",""],["8fcba1",""],["8fcca1","",9,""],["8fcda1","",5,""],["8fcea1","",6,""],["8fcfa1",""],["8fd0a1",""],["8fd1a1",""],["8fd2a1","",5],["8fd3a1",""],["8fd4a1","",4,""],["8fd5a1",""],["8fd6a1",""],["8fd7a1",""],["8fd8a1",""],["8fd9a1","",4,"",6,""],["8fdaa1","",4,""],["8fdba1","",6,""],["8fdca1","",4,""],["8fdda1","",4,""],["8fdea1","",4,""],["8fdfa1",""],["8fe0a1",""],["8fe1a1","",4,""],["8fe2a1",""],["8fe3a1","",5,"",4,""],["8fe4a1","",4,""],["8fe5a1","",4,""],["8fe6a1",""],["8fe7a1",""],["8fe8a1","",4,""],["8fe9a1","",4],["8feaa1","",4,""],["8feba1","",4,""],["8feca1",""],["8feda1","",4,"",4,""]]},{}],66:[function(e,t,r){t.exports={
uChars:[128,165,169,178,184,216,226,235,238,244,248,251,253,258,276,284,300,325,329,334,364,463,465,467,469,471,473,475,477,506,594,610,712,716,730,930,938,962,970,1026,1104,1106,8209,8215,8218,8222,8231,8241,8244,8246,8252,8365,8452,8454,8458,8471,8482,8556,8570,8596,8602,8713,8720,8722,8726,8731,8737,8740,8742,8748,8751,8760,8766,8777,8781,8787,8802,8808,8816,8854,8858,8870,8896,8979,9322,9372,9548,9588,9616,9622,9634,9652,9662,9672,9676,9680,9702,9735,9738,9793,9795,11906,11909,11913,11917,11928,11944,11947,11951,11956,11960,11964,11979,12284,12292,12312,12319,12330,12351,12436,12447,12535,12543,12586,12842,12850,12964,13200,13215,13218,13253,13263,13267,13270,13384,13428,13727,13839,13851,14617,14703,14801,14816,14964,15183,15471,15585,16471,16736,17208,17325,17330,17374,17623,17997,18018,18212,18218,18301,18318,18760,18811,18814,18820,18823,18844,18848,18872,19576,19620,19738,19887,40870,59244,59336,59367,59413,59417,59423,59431,59437,59443,59452,59460,59478,59493,63789,63866,63894,63976,63986,64016,64018,64021,64025,64034,64037,64042,65074,65093,65107,65112,65127,65132,65375,65510,65536],gbChars:[0,36,38,45,50,81,89,95,96,100,103,104,105,109,126,133,148,172,175,179,208,306,307,308,309,310,311,312,313,341,428,443,544,545,558,741,742,749,750,805,819,820,7922,7924,7925,7927,7934,7943,7944,7945,7950,8062,8148,8149,8152,8164,8174,8236,8240,8262,8264,8374,8380,8381,8384,8388,8390,8392,8393,8394,8396,8401,8406,8416,8419,8424,8437,8439,8445,8482,8485,8496,8521,8603,8936,8946,9046,9050,9063,9066,9076,9092,9100,9108,9111,9113,9131,9162,9164,9218,9219,11329,11331,11334,11336,11346,11361,11363,11366,11370,11372,11375,11389,11682,11686,11687,11692,11694,11714,11716,11723,11725,11730,11736,11982,11989,12102,12336,12348,12350,12384,12393,12395,12397,12510,12553,12851,12962,12973,13738,13823,13919,13933,14080,14298,14585,14698,15583,15847,16318,16434,16438,16481,16729,17102,17122,17315,17320,17402,17418,17859,17909,17911,17915,17916,17936,17939,17961,18664,18703,18814,18962,19043,33469,33470,33471,33484,33485,33490,33497,33501,33505,33513,33520,33536,33550,37845,37921,37948,38029,38038,38064,38065,38066,38069,38075,38076,38078,39108,39109,39113,39114,39115,39116,39265,39394,189e3]}},{}],67:[function(e,t,r){t.exports=[["a140","",62],["a180","",32],["a240","",62],["a280","",32],["a2ab","",5],["a2e3",""],["a2ef",""],["a2fd",""],["a340","",62],["a380","",31,""],["a440","",62],["a480","",32],["a4f4","",10],["a540","",62],["a580","",32],["a5f7","",7],["a640","",62],["a680","",32],["a6b9","",7],["a6d9","",6],["a6ec",""],["a6f3",""],["a6f6","",8],["a740","",62],["a780","",32],["a7c2","",14],["a7f2","",12],["a896","",10],["a8bc",""],["a8bf",""],["a8c1",""],["a8ea","",20],["a958",""],["a95b",""],["a95d",""],["a989","",11],["a997","",12],["a9f0","",14],["aaa1","",93],["aba1","",93],["aca1","",93],["ada1","",93],["aea1","",93],["afa1","",93],["d7fa","",4],["f8a1","",93],["f9a1","",93],["faa1","",93],["fba1","",93],["fca1","",93],["fda1","",93],["fe50",""],["fe80","",6,"",93]]},{}],68:[function(e,t,r){t.exports=[["0","\0",128],["a1","",62],["8140","",9,""],["8180",""],["81b8",""],["81c8",""],["81da",""],["81f0",""],["81fc",""],["824f","",9],["8260","",25],["8281","",25],["829f","",82],["8340","",62],["8380","",22],["839f","",16,"",6],["83bf","",16,"",6],["8440","",5,"",25],["8470","",5,"",7],["8480","",17],["849f",""],["8740","",19,"",9],["875f",""],["877e",""],["8780","",4,""],["889f",""],["8940",""],["8980",""],["8a40",""],["8a80",""],["8b40",""],["8b80",""],["8c40",""],["8c80",""],["8d40",""],["8d80",""],["8e40",""],["8e80",""],["8f40",""],["8f80",""],["9040",""],["9080",""],["9140",""],["9180",""],["9240",""],["9280",""],["9340",""],["9380",""],["9440",""],["9480",""],["9540",""],["9580",""],["9640",""],["9680",""],["9740",""],["9780",""],["9840",""],["989f",""],["9940",""],["9980",""],["9a40",""],["9a80",""],["9b40",""],["9b80",""],["9c40",""],["9c80",""],["9d40",""],["9d80",""],["9e40",""],["9e80",""],["9f40",""],["9f80",""],["e040",""],["e080",""],["e140",""],["e180",""],["e240",""],["e280",""],["e340",""],["e380",""],["e440",""],["e480",""],["e540",""],["e580",""],["e640",""],["e680",""],["e740",""],["e780",""],["e840",""],["e880",""],["e940",""],["e980",""],["ea40",""],["ea80",""],["ed40",""],["ed80",""],["ee40",""],["ee80",""],["eeef","",9,""],["f040","",62],["f080","",124],["f140","",62],["f180","",124],["f240","",62],["f280","",124],["f340","",62],["f380","",124],["f440","",62],["f480","",124],["f540","",62],["f580","",124],["f640","",62],["f680","",124],["f740","",62],["f780","",124],["f840","",62],["f880","",124],["f940",""],["fa40","",9,"",9,""],["fa80",""],["fb40",""],["fb80",""],["fc40",""]]},{}],69:[function(e,t,r){"use strict";function n(){}function a(){}function i(){this.overflowByte=-1}function o(e,t){this.iconv=t}function s(e,t){e=e||{},void 0===e.addBOM&&(e.addBOM=!0),this.encoder=t.iconv.getEncoder("utf-16le",e)}function l(e,t){this.decoder=null,this.initialBytes=[],this.initialBytesLen=0,this.options=e||{},this.iconv=t.iconv}function c(e,t){var r=t||"utf-16le";if(e.length>=2)if(254==e[0]&&255==e[1])r="utf-16be";else if(255==e[0]&&254==e[1])r="utf-16le";else{for(var n=0,a=0,i=Math.min(e.length-e.length%2,64),o=0;o<i;o+=2)0===e[o]&&0!==e[o+1]&&a++,0!==e[o]&&0===e[o+1]&&n++;a>n?r="utf-16be":a<n&&(r="utf-16le")}return r}var u=e("buffer").Buffer;r.utf16be=n,n.prototype.encoder=a,n.prototype.decoder=i,n.prototype.bomAware=!0,a.prototype.write=function(e){for(var t=new u(e,"ucs2"),r=0;r<t.length;r+=2){var n=t[r];t[r]=t[r+1],t[r+1]=n}return t},a.prototype.end=function(){},i.prototype.write=function(e){if(0==e.length)return"";var t=new u(e.length+1),r=0,n=0;for(-1!==this.overflowByte&&(t[0]=e[0],t[1]=this.overflowByte,r=1,n=2);r<e.length-1;r+=2,n+=2)t[n]=e[r+1],t[n+1]=e[r];return this.overflowByte=r==e.length-1?e[e.length-1]:-1,t.slice(0,n).toString("ucs2")},i.prototype.end=function(){},r.utf16=o,o.prototype.encoder=s,o.prototype.decoder=l,s.prototype.write=function(e){return this.encoder.write(e)},s.prototype.end=function(){return this.encoder.end()},l.prototype.write=function(e){if(!this.decoder){if(this.initialBytes.push(e),this.initialBytesLen+=e.length,this.initialBytesLen<16)return"";var e=u.concat(this.initialBytes),t=c(e,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(t,this.options),this.initialBytes.length=this.initialBytesLen=0}return this.decoder.write(e)},l.prototype.end=function(){if(!this.decoder){var e=u.concat(this.initialBytes),t=c(e,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(t,this.options);var r=this.decoder.write(e),n=this.decoder.end();return n?r+n:r}return this.decoder.end()}},{buffer:void 0}],70:[function(e,t,r){"use strict";function n(e,t){this.iconv=t}function a(e,t){this.iconv=t.iconv}function i(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=""}function o(e,t){this.iconv=t}function s(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=new c(6),this.base64AccumIdx=0}function l(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=""}var c=e("buffer").Buffer;r.utf7=n,r.unicode11utf7="utf7",n.prototype.encoder=a,n.prototype.decoder=i,n.prototype.bomAware=!0;var u=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;a.prototype.write=function(e){return new c(e.replace(u,function(e){return"+"+("+"===e?"":this.iconv.encode(e,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))},a.prototype.end=function(){};for(var $=/[A-Za-z0-9\/+]/,f=[],p=0;p<256;p++)f[p]=$.test(String.fromCharCode(p));var d="+".charCodeAt(0),h="-".charCodeAt(0),_="&".charCodeAt(0);i.prototype.write=function(e){for(var t="",r=0,n=this.inBase64,a=this.base64Accum,i=0;i<e.length;i++)if(n){if(!f[e[i]]){if(i==r&&e[i]==h)t+="+";else{var o=a+e.slice(r,i).toString();t+=this.iconv.decode(new c(o,"base64"),"utf16-be")}e[i]!=h&&i--,r=i+1,n=!1,a=""}}else e[i]==d&&(t+=this.iconv.decode(e.slice(r,i),"ascii"),r=i+1,n=!0);if(n){var o=a+e.slice(r).toString(),s=o.length-o.length%8;a=o.slice(s),o=o.slice(0,s),t+=this.iconv.decode(new c(o,"base64"),"utf16-be")}else t+=this.iconv.decode(e.slice(r),"ascii");return this.inBase64=n,this.base64Accum=a,t},i.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new c(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e},r.utf7imap=o,o.prototype.encoder=s,o.prototype.decoder=l,o.prototype.bomAware=!0,s.prototype.write=function(e){for(var t=this.inBase64,r=this.base64Accum,n=this.base64AccumIdx,a=new c(5*e.length+10),i=0,o=0;o<e.length;o++){var s=e.charCodeAt(o);32<=s&&s<=126?(t&&(n>0&&(i+=a.write(r.slice(0,n).toString("base64").replace(/\//g,",").replace(/=+$/,""),i),n=0),a[i++]=h,t=!1),t||(a[i++]=s,s===_&&(a[i++]=h))):(t||(a[i++]=_,t=!0),t&&(r[n++]=s>>8,r[n++]=255&s,n==r.length&&(i+=a.write(r.toString("base64").replace(/\//g,","),i),n=0)))}return this.inBase64=t,this.base64AccumIdx=n,a.slice(0,i)},s.prototype.end=function(){var e=new c(10),t=0;return this.inBase64&&(this.base64AccumIdx>0&&(t+=e.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),t),this.base64AccumIdx=0),e[t++]=h,this.inBase64=!1),e.slice(0,t)};var g=f.slice();g[",".charCodeAt(0)]=!0,l.prototype.write=function(e){for(var t="",r=0,n=this.inBase64,a=this.base64Accum,i=0;i<e.length;i++)if(n){if(!g[e[i]]){if(i==r&&e[i]==h)t+="&";else{var o=a+e.slice(r,i).toString().replace(/,/g,"/");t+=this.iconv.decode(new c(o,"base64"),"utf16-be")}e[i]!=h&&i--,r=i+1,n=!1,a=""}}else e[i]==_&&(t+=this.iconv.decode(e.slice(r,i),"ascii"),r=i+1,n=!0);if(n){var o=a+e.slice(r).toString().replace(/,/g,"/"),s=o.length-o.length%8;a=o.slice(s),o=o.slice(0,s),t+=this.iconv.decode(new c(o,"base64"),"utf16-be")}else t+=this.iconv.decode(e.slice(r),"ascii");return this.inBase64=n,this.base64Accum=a,t},l.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new c(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e}},{buffer:void 0}],71:[function(e,t,r){"use strict";function n(e,t){this.encoder=e,this.addBOM=!0}function a(e,t){this.decoder=e,this.pass=!1,this.options=t||{}}r.PrependBOM=n,n.prototype.write=function(e){return this.addBOM&&(e="\ufeff"+e,this.addBOM=!1),this.encoder.write(e)},n.prototype.end=function(){return this.encoder.end()},r.StripBOM=a,a.prototype.write=function(e){var t=this.decoder.write(e);return this.pass||!t?t:("\ufeff"===t[0]&&(t=t.slice(1),"function"==typeof this.options.stripBOM&&this.options.stripBOM()),this.pass=!0,t)},a.prototype.end=function(){return this.decoder.end()}},{}],72:[function(e,t,r){"use strict";var n=e("buffer").Buffer;t.exports=function(t){var r=void 0;t.supportsNodeEncodingsExtension=!(new n(0)instanceof Uint8Array),t.extendNodeEncodings=function(){if(!r){if(r={},!t.supportsNodeEncodingsExtension)return console.error("ACTION NEEDED: require('iconv-lite').extendNodeEncodings() is not supported in your version of Node"),void console.error("See more info at https://github.com/ashtuchkin/iconv-lite/wiki/Node-v4-compatibility");var a={hex:!0,utf8:!0,"utf-8":!0,ascii:!0,binary:!0,base64:!0,ucs2:!0,"ucs-2":!0,utf16le:!0,"utf-16le":!0};n.isNativeEncoding=function(e){return e&&a[e.toLowerCase()]};var i=e("buffer").SlowBuffer;if(r.SlowBufferToString=i.prototype.toString,i.prototype.toString=function(e,a,i){return e=String(e||"utf8").toLowerCase(),n.isNativeEncoding(e)?r.SlowBufferToString.call(this,e,a,i):(void 0===a&&(a=0),void 0===i&&(i=this.length),t.decode(this.slice(a,i),e))},r.SlowBufferWrite=i.prototype.write,i.prototype.write=function(e,a,i,o){if(isFinite(a))isFinite(i)||(o=i,i=void 0);else{var s=o;o=a,a=i,i=s}a=+a||0;var l=this.length-a;if(i?(i=+i)>l&&(i=l):i=l,o=String(o||"utf8").toLowerCase(),n.isNativeEncoding(o))return r.SlowBufferWrite.call(this,e,a,i,o);if(e.length>0&&(i<0||a<0))throw new RangeError("attempt to write beyond buffer bounds");var c=t.encode(e,o);return c.length<i&&(i=c.length),c.copy(this,a,0,i),i},r.BufferIsEncoding=n.isEncoding,n.isEncoding=function(e){return n.isNativeEncoding(e)||t.encodingExists(e)},r.BufferByteLength=n.byteLength,n.byteLength=i.byteLength=function(e,a){return a=String(a||"utf8").toLowerCase(),n.isNativeEncoding(a)?r.BufferByteLength.call(this,e,a):t.encode(e,a).length},r.BufferToString=n.prototype.toString,n.prototype.toString=function(e,a,i){return e=String(e||"utf8").toLowerCase(),n.isNativeEncoding(e)?r.BufferToString.call(this,e,a,i):(void 0===a&&(a=0),void 0===i&&(i=this.length),t.decode(this.slice(a,i),e))},r.BufferWrite=n.prototype.write,n.prototype.write=function(e,a,i,o){var s=a,l=i,c=o;if(isFinite(a))isFinite(i)||(o=i,i=void 0);else{var u=o;o=a,a=i,i=u}if(o=String(o||"utf8").toLowerCase(),n.isNativeEncoding(o))return r.BufferWrite.call(this,e,s,l,c);a=+a||0;var $=this.length-a;if(i?(i=+i)>$&&(i=$):i=$,e.length>0&&(i<0||a<0))throw new RangeError("attempt to write beyond buffer bounds");var f=t.encode(e,o);return f.length<i&&(i=f.length),f.copy(this,a,0,i),i},t.supportsStreams){var o=e("stream").Readable;r.ReadableSetEncoding=o.prototype.setEncoding,o.prototype.setEncoding=function(e,r){this._readableState.decoder=t.getDecoder(e,r),this._readableState.encoding=e},o.prototype.collect=t._collect}}},t.undoExtendNodeEncodings=function(){if(t.supportsNodeEncodingsExtension){if(!r)throw new Error("require('iconv-lite').undoExtendNodeEncodings(): Nothing to undo; extendNodeEncodings() is not called.");delete n.isNativeEncoding;var a=e("buffer").SlowBuffer;if(a.prototype.toString=r.SlowBufferToString,a.prototype.write=r.SlowBufferWrite,n.isEncoding=r.BufferIsEncoding,n.byteLength=r.BufferByteLength,n.prototype.toString=r.BufferToString,n.prototype.write=r.BufferWrite,t.supportsStreams){var i=e("stream").Readable;i.prototype.setEncoding=r.ReadableSetEncoding,delete i.prototype.collect}r=void 0}}}},{buffer:void 0,stream:void 0}],73:[function(e,t,r){"use strict";var n=e("buffer").Buffer,a=e("./bom-handling"),i=t.exports;i.encodings=null,i.defaultCharUnicode="",i.defaultCharSingleByte="?",i.encode=function(e,t,r){e=""+(e||"");var a=i.getEncoder(t,r),o=a.write(e),s=a.end();return s&&s.length>0?n.concat([o,s]):o},i.decode=function(e,t,r){"string"==typeof e&&(i.skipDecodeWarning||(console.error("Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding"),i.skipDecodeWarning=!0),e=new n(""+(e||""),"binary"));var a=i.getDecoder(t,r),o=a.write(e),s=a.end();return s?o+s:o},i.encodingExists=function(e){try{return i.getCodec(e),!0}catch(e){return!1}},i.toEncoding=i.encode,i.fromEncoding=i.decode,i._codecDataCache={},i.getCodec=function(t){i.encodings||(i.encodings=e("../encodings"));for(var r=(""+t).toLowerCase().replace(/[^0-9a-z]|:\d{4}$/g,""),n={};;){var a=i._codecDataCache[r];if(a)return a;var o=i.encodings[r];switch(typeof o){case"string":r=o;break;case"object":for(var s in o)n[s]=o[s];n.encodingName||(n.encodingName=r),r=o.type;break;case"function":return n.encodingName||(n.encodingName=r),a=new o(n,i),i._codecDataCache[n.encodingName]=a,a;default:throw new Error("Encoding not recognized: '"+t+"' (searched as: '"+r+"')")}}},i.getEncoder=function(e,t){var r=i.getCodec(e),n=new r.encoder(t,r);return r.bomAware&&t&&t.addBOM&&(n=new a.PrependBOM(n,t)),n},i.getDecoder=function(e,t){var r=i.getCodec(e),n=new r.decoder(t,r);return!r.bomAware||t&&!1===t.stripBOM||(n=new a.StripBOM(n,t)),n};var o="undefined"!=typeof process&&process.versions&&process.versions.node;if(o){var s=o.split(".").map(Number);(s[0]>0||s[1]>=10)&&e("./streams")(i),e("./extend-node")(i)}},{"../encodings":56,"./bom-handling":71,"./extend-node":72,"./streams":74,buffer:void 0}],74:[function(e,t,r){"use strict";function n(e,t){this.conv=e,t=t||{},t.decodeStrings=!1,o.call(this,t)}function a(e,t){this.conv=e,t=t||{},t.encoding=this.encoding="utf8",o.call(this,t)}var i=e("buffer").Buffer,o=e("stream").Transform;t.exports=function(e){e.encodeStream=function(t,r){return new n(e.getEncoder(t,r),r)},e.decodeStream=function(t,r){return new a(e.getDecoder(t,r),r)},e.supportsStreams=!0,e.IconvLiteEncoderStream=n,e.IconvLiteDecoderStream=a,e._collect=a.prototype.collect},n.prototype=Object.create(o.prototype,{constructor:{value:n}}),n.prototype._transform=function(e,t,r){if("string"!=typeof e)return r(new Error("Iconv encoding stream needs strings as its input."));try{var n=this.conv.write(e);n&&n.length&&this.push(n),r()}catch(e){r(e)}},n.prototype._flush=function(e){try{var t=this.conv.end();t&&t.length&&this.push(t),e()}catch(t){e(t)}},n.prototype.collect=function(e){var t=[];return this.on("error",e),this.on("data",function(e){t.push(e)}),this.on("end",function(){e(null,i.concat(t))}),this},a.prototype=Object.create(o.prototype,{constructor:{value:a}}),a.prototype._transform=function(e,t,r){if(!i.isBuffer(e))return r(new Error("Iconv decoding stream needs buffers as its input."));try{var n=this.conv.write(e);n&&n.length&&this.push(n,this.encoding),r()}catch(e){r(e)}},a.prototype._flush=function(e){try{var t=this.conv.end();t&&t.length&&this.push(t,this.encoding),e()}catch(t){e(t)}},a.prototype.collect=function(e){var t="";return this.on("error",e),this.on("data",function(e){t+=e}),this.on("end",function(){e(null,t)}),this}},{buffer:void 0,stream:void 0}],75:[function(e,t,r){function n(e,t){return s[e]?(s[e].push(t),null):(s[e]=[t],a(e))}function a(e){return l(function t(){var r=s[e],n=r.length,a=i(arguments);try{for(var o=0;o<n;o++)r[o].apply(null,a)}finally{r.length>n?(r.splice(0,n),process.nextTick(function(){t.apply(null,a)})):delete s[e]}})}function i(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n]=e[n];return r}var o=e("wrappy"),s=Object.create(null),l=e("once");t.exports=o(n)},{once:84,wrappy:86}],76:[function(e,t,r){try{var n=e("util");if("function"!=typeof n.inherits)throw"";t.exports=n.inherits}catch(r){t.exports=e("./inherits_browser.js")}},{"./inherits_browser.js":77,util:void 0}],77:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],78:[function(e,t,r){var n="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r=t.space||"";"number"==typeof r&&(r=Array(r+1).join(" "));var o="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},l=t.cmp&&function(e){return function(t){return function(r,n){var a={key:r,value:t[r]},i={key:n,value:t[n]};return e(a,i)}}}(t.cmp),c=[];return function e(t,u,$,f){var p=r?"\n"+new Array(f+1).join(r):"",d=r?": ":":";if($&&$.toJSON&&"function"==typeof $.toJSON&&($=$.toJSON()),void 0!==($=s.call(t,u,$))){if("object"!=typeof $||null===$)return n.stringify($);if(a($)){for(var h=[],_=0;_<$.length;_++){var g=e($,_,$[_],f+1)||n.stringify(null);h.push(p+r+g)}return"["+h.join(",")+p+"]"}if(-1!==c.indexOf($)){if(o)return n.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}c.push($);for(var m=i($).sort(l&&l($)),h=[],_=0;_<m.length;_++){var u=m[_],y=e($,u,$[u],f+1);if(y){var v=n.stringify(u)+d+y;h.push(p+r+v)}}return c.splice(c.indexOf($),1),"{"+h.join(",")+p+"}"}}({"":e},"",e,0)};var a=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},i=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in e)t.call(e,n)&&r.push(n);return r}},{jsonify:79}],79:[function(e,t,r){r.parse=e("./lib/parse"),r.stringify=e("./lib/stringify")},{"./lib/parse":80,"./lib/stringify":81}],80:[function(e,t,r){var n,a,i,o,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},l=function(e){throw{name:"SyntaxError",message:e,at:n,text:i}},c=function(e){return e&&e!==a&&l("Expected '"+e+"' instead of '"+a+"'"),a=i.charAt(n),n+=1,a},u=function(){var e,t="";for("-"===a&&(t="-",c("-"));a>="0"&&a<="9";)t+=a,c();if("."===a)for(t+=".";c()&&a>="0"&&a<="9";)t+=a;if("e"===a||"E"===a)for(t+=a,c(),"-"!==a&&"+"!==a||(t+=a,c());a>="0"&&a<="9";)t+=a,c();if(e=+t,isFinite(e))return e;l("Bad number")},$=function(){var e,t,r,n="";if('"'===a)for(;c();){if('"'===a)return c(),n;if("\\"===a)if(c(),"u"===a){for(r=0,t=0;t<4&&(e=parseInt(c(),16),isFinite(e));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else{if("string"!=typeof s[a])break;n+=s[a]}else n+=a}l("Bad string")},f=function(){for(;a&&a<=" ";)c()},p=function(){switch(a){case"t":return c("t"),c("r"),c("u"),c("e"),!0;case"f":return c("f"),c("a"),c("l"),c("s"),c("e"),!1;case"n":return c("n"),c("u"),c("l"),c("l"),null}l("Unexpected '"+a+"'")},d=function(){var e=[];if("["===a){if(c("["),f(),"]"===a)return c("]"),e;for(;a;){if(e.push(o()),f(),"]"===a)return c("]"),e;c(","),f()}}l("Bad array")},h=function(){var e,t={};if("{"===a){if(c("{"),f(),"}"===a)return c("}"),t;for(;a;){if(e=$(),f(),c(":"),Object.hasOwnProperty.call(t,e)&&l('Duplicate key "'+e+'"'),t[e]=o(),f(),"}"===a)return c("}"),t;c(","),f()}}l("Bad object")};o=function(){switch(f(),a){case"{":return h();case"[":return d();case'"':return $();case"-":return u();default:return a>="0"&&a<="9"?u():p()}},t.exports=function(e,t){var r;return i=e,n=0,a=" ",r=o(),f(),a&&l("Syntax error"),"function"==typeof t?function e(r,n){var a,i,o=r[n];if(o&&"object"==typeof o)for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(i=e(o,a),void 0!==i?o[a]=i:delete o[a]);return t.call(r,n,o)}({"":r},""):r}},{}],81:[function(e,t,r){function n(e){return l.lastIndex=0,l.test(e)?'"'+e.replace(l,function(e){var t=c[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function a(e,t){var r,l,c,u,$,f=i,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof s&&(p=s.call(t,e,p)),typeof p){case"string":return n(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(i+=o,$=[],"[object Array]"===Object.prototype.toString.apply(p)){for(u=p.length,r=0;r<u;r+=1)$[r]=a(r,p)||"null";return c=0===$.length?"[]":i?"[\n"+i+$.join(",\n"+i)+"\n"+f+"]":"["+$.join(",")+"]",i=f,c}if(s&&"object"==typeof s)for(u=s.length,r=0;r<u;r+=1)"string"==typeof(l=s[r])&&(c=a(l,p))&&$.push(n(l)+(i?": ":":")+c);else for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(c=a(l,p))&&$.push(n(l)+(i?": ":":")+c);return c=0===$.length?"{}":i?"{\n"+i+$.join(",\n"+i)+"\n"+f+"}":"{"+$.join(",")+"}",i=f,c}}var i,o,s,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,r){var n;if(i="",o="","number"==typeof r)for(n=0;n<r;n+=1)o+=" ";else"string"==typeof r&&(o=r);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return a("",{"":e})}},{}],82:[function(e,t,r){!function(e,n){"object"==typeof r&&void 0!==t?t.exports=n():"function"==typeof define&&define.amd?define(n):e.jspdf=n()}(this,function(){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=(function(){function e(e){this.value=e}function t(t){function r(a,i){try{var o=t[a](i),s=o.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):n(o.done?"return":"normal",o.value)}catch(e){n("throw",e)}}function n(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}(a=a.next)?r(a.key,a.arg):i=null}var a,i;this._invoke=function(e,t){return new Promise(function(n,o){var s={key:e,arg:t,resolve:n,reject:o,next:null};i?i=i.next=s:(a=i=s,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e){function r(t){var r={};this.subscribe=function(e,t,n){if("function"!=typeof t)return!1;r.hasOwnProperty(e)||(r[e]={});var a=Math.random().toString(35)
;return r[e][a]=[t,!!n],a},this.unsubscribe=function(e){for(var t in r)if(r[t][e])return delete r[t][e],!0;return!1},this.publish=function(n){if(r.hasOwnProperty(n)){var a=Array.prototype.slice.call(arguments,1),i=[];for(var o in r[n]){var s=r[n][o];try{s[0].apply(t,a)}catch(t){e.console&&console.error("jsPDF PubSub Error",t.message,t)}s[1]&&i.push(o)}i.length&&i.forEach(this.unsubscribe)}}}function a(t,c,u,$){var f={};"object"===(void 0===t?"undefined":n(t))&&(t=(f=t).orientation,c=f.unit||c,u=f.format||u,$=f.compress||f.compressPdf||$),c=c||"mm",u=u||"a4",t=(""+(t||"P")).toLowerCase(),(""+u).toLowerCase();var p,d,h,_,g,m,y,v,b,x=!!$&&"function"==typeof Uint8Array,w=f.textColor||"0 g",A=f.drawColor||"0 G",k=f.fontSize||16,E=f.lineHeight||1.15,C=f.lineWidth||.200025,S=2,I=!1,O=[],T={},P={},M=0,N=[],B=[],R=[],j=[],F=[],D=0,L=0,z=0,q={title:"",subject:"",author:"",keywords:"",creator:""},U={},H=new r(U),G=f.hotfixes||[],Y=function(e){return e.toFixed(2)},Q=function(e){return e.toFixed(3)},V=function(e){return("0"+parseInt(e)).slice(-2)},X=function(e){I?N[_].push(e):(z+=e.length+1,j.push(e))},W=function(){return S++,O[S]=z,X(S+" 0 obj"),S},J=function(e){X("stream"),X(e),X("endstream")},K=function(){var t,r,n,i,o,s,c,u,$,f=[];for(c=e.adler32cs||a.adler32cs,x&&void 0===c&&(x=!1),t=1;t<=M;t++){if(f.push(W()),u=(g=R[t].width)*d,$=(m=R[t].height)*d,X("<</Type /Page"),X("/Parent 1 0 R"),X("/Resources 2 0 R"),X("/MediaBox [0 0 "+Y(u)+" "+Y($)+"]"),H.publish("putPage",{pageNumber:t,page:N[t]}),X("/Contents "+(S+1)+" 0 R"),X(">>"),X("endobj"),r=N[t].join("\n"),W(),x){for(n=[],i=r.length;i--;)n[i]=r.charCodeAt(i);s=c.from(r),(o=new l(6)).append(new Uint8Array(n)),r=o.flush(),(n=new Uint8Array(r.length+6)).set(new Uint8Array([120,156])),n.set(r,2),n.set(new Uint8Array([255&s,s>>8&255,s>>16&255,s>>24&255]),r.length+2),r=String.fromCharCode.apply(null,n),X("<</Length "+r.length+" /Filter [/FlateDecode]>>")}else X("<</Length "+r.length+">>");J(r),X("endobj")}O[1]=z,X("1 0 obj"),X("<</Type /Pages");var p="/Kids [";for(i=0;i<M;i++)p+=f[i]+" 0 R ";X(p+"]"),X("/Count "+M),X(">>"),X("endobj"),H.publish("postPutPages")},Z=function(e){e.objectNumber=W(),X("<</BaseFont/"+e.PostScriptName+"/Type/Font"),"string"==typeof e.encoding&&X("/Encoding/"+e.encoding),X("/Subtype/Type1>>"),X("endobj")},ee=function(){for(var e in T)T.hasOwnProperty(e)&&Z(T[e])},te=function(){H.publish("putXobjectDict")},re=function(){X("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),X("/Font <<");for(var e in T)T.hasOwnProperty(e)&&X("/"+e+" "+T[e].objectNumber+" 0 R");X(">>"),X("/XObject <<"),te(),X(">>")},ne=function(){ee(),H.publish("putResources"),O[2]=z,X("2 0 obj"),X("<<"),re(),X(">>"),X("endobj"),H.publish("postPutResources")},ae=function(){H.publish("putAdditionalObjects");for(var e=0;e<F.length;e++){var t=F[e];O[t.objId]=z,X(t.objId+" 0 obj"),X(t.content),X("endobj")}S+=F.length,H.publish("postPutAdditionalObjects")},ie=function(e,t,r){P.hasOwnProperty(t)||(P[t]={}),P[t][r]=e},oe=function(e,t,r,n){var a="F"+(Object.keys(T).length+1).toString(10),i=T[a]={id:a,PostScriptName:e,fontName:t,fontStyle:r,encoding:n,metadata:{}};return ie(a,t,r),H.publish("addFont",i),a},se=function(e,t){var r,n,a,i,o,s,l,c,u;if(t=t||{},a=t.sourceEncoding||"Unicode",o=t.outputEncoding,(t.autoencode||o)&&T[p].metadata&&T[p].metadata[a]&&T[p].metadata[a].encoding&&(i=T[p].metadata[a].encoding,!o&&T[p].encoding&&(o=T[p].encoding),!o&&i.codePages&&(o=i.codePages[0]),"string"==typeof o&&(o=i[o]),o)){for(l=!1,s=[],r=0,n=e.length;r<n;r++)(c=o[e.charCodeAt(r)])?s.push(String.fromCharCode(c)):s.push(e[r]),s[r].charCodeAt(0)>>8&&(l=!0);e=s.join("")}for(r=e.length;void 0===l&&0!==r;)e.charCodeAt(r-1)>>8&&(l=!0),r--;if(!l)return e;for(s=t.noBOM?[]:[254,255],r=0,n=e.length;r<n;r++){if(c=e.charCodeAt(r),(u=c>>8)>>8)throw new Error("Character at position "+r+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");s.push(u),s.push(c-(u<<8))}return String.fromCharCode.apply(void 0,s)},le=function(e,t){return se(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ce=function(){X("/Producer (jsPDF "+a.version+")");for(var e in q)q.hasOwnProperty(e)&&q[e]&&X("/"+e.substr(0,1).toUpperCase()+e.substr(1)+" ("+le(q[e])+")");var t=new Date,r=t.getTimezoneOffset(),n=r<0?"+":"-",i=Math.floor(Math.abs(r/60)),o=Math.abs(r%60),s=[n,V(i),"'",V(o),"'"].join("");X(["/CreationDate (D:",t.getFullYear(),V(t.getMonth()+1),V(t.getDate()),V(t.getHours()),V(t.getMinutes()),V(t.getSeconds()),s,")"].join(""))},ue=function(){switch(X("/Type /Catalog"),X("/Pages 1 0 R"),v||(v="fullwidth"),v){case"fullwidth":X("/OpenAction [3 0 R /FitH null]");break;case"fullheight":X("/OpenAction [3 0 R /FitV null]");break;case"fullpage":X("/OpenAction [3 0 R /Fit]");break;case"original":X("/OpenAction [3 0 R /XYZ null null 1]");break;default:var e=""+v;"%"===e.substr(e.length-1)&&(v=parseInt(v)/100),"number"==typeof v&&X("/OpenAction [3 0 R /XYZ null null "+Y(v)+"]")}switch(b||(b="continuous"),b){case"continuous":X("/PageLayout /OneColumn");break;case"single":X("/PageLayout /SinglePage");break;case"two":case"twoleft":X("/PageLayout /TwoColumnLeft");break;case"tworight":X("/PageLayout /TwoColumnRight")}y&&X("/PageMode /"+y),H.publish("putCatalog")},$e=function(){X("/Size "+(S+1)),X("/Root "+S+" 0 R"),X("/Info "+(S-1)+" 0 R")},fe=function(e,t){var r="string"==typeof t&&t.toLowerCase();if("string"==typeof e){var n=e.toLowerCase();s.hasOwnProperty(n)&&(e=s[n][0]/d,t=s[n][1]/d)}if(Array.isArray(e)&&(t=e[1],e=e[0]),r){switch(r.substr(0,1)){case"l":t>e&&(r="s");break;case"p":e>t&&(r="s")}"s"===r&&(h=e,e=t,t=h)}I=!0,N[++M]=[],R[M]={width:Number(e)||g,height:Number(t)||m},B[M]={},he(M)},pe=function(){fe.apply(this,arguments),X(Y(C*d)+" w"),X(A),0!==D&&X(D+" J"),0!==L&&X(L+" j"),H.publish("addPage",{pageNumber:M})},de=function(e){e>0&&e<=M&&(N.splice(e,1),R.splice(e,1),_>--M&&(_=M),this.setPage(_))},he=function(e){e>0&&e<=M&&(_=e,g=R[e].width,m=R[e].height)},_e=function(e,t){var r;switch(e=void 0!==e?e:T[p].fontName,t=void 0!==t?t:T[p].fontStyle,void 0!==e&&(e=e.toLowerCase()),e){case"sans-serif":case"verdana":case"arial":case"helvetica":e="helvetica";break;case"fixed":case"monospace":case"terminal":case"courier":e="courier";break;case"serif":case"cursive":case"fantasy":default:e="times"}try{r=P[e][t]}catch(e){}return r||null==(r=P.times[t])&&(r=P.times.normal),r},ge=function(){I=!1,S=2,z=0,j=[],O=[],F=[],H.publish("buildDocument"),X("%PDF-"+i),K(),ae(),ne(),W(),X("<<"),ce(),X(">>"),X("endobj"),W(),X("<<"),ue(),X(">>"),X("endobj");var e,t=z,r="0000000000";for(X("xref"),X("0 "+(S+1)),X(r+" 65535 f "),e=1;e<=S;e++){var n=O[e];X("function"==typeof n?(r+O[e]()).slice(-10)+" 00000 n ":(r+O[e]).slice(-10)+" 00000 n ")}return X("trailer"),X("<<"),$e(),X(">>"),X("startxref"),X(""+t),X("%%EOF"),I=!0,j.join("\n")},me=function(e){var t="S";return"F"===e?t="f":"FD"===e||"DF"===e?t="B":"f"!==e&&"f*"!==e&&"B"!==e&&"B*"!==e||(t=e),t},ye=function(){for(var e=ge(),t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r);t--;)n[t]=e.charCodeAt(t);return r},ve=function(){return new Blob([ye()],{type:"application/pdf"})},be=function(t){return t.foo=function(){try{return t.apply(this,arguments)}catch(t){var r=t.stack||"";~r.indexOf(" at ")&&(r=r.split(" at ")[1]);var n="Error in function "+r.split("\n")[0].split("<")[0]+": "+t.message;if(!e.console)throw new Error(n);e.console.error(n,t),e.alert&&alert(n)}},t.foo.bar=t,t.foo}(function(t,r){var n="dataur"===(""+t).substr(0,6)?"data:application/pdf;base64,"+btoa(ge()):0;switch(t){case void 0:return ge();case"save":if(navigator.getUserMedia&&(void 0===e.URL||void 0===e.URL.createObjectURL))return U.output("dataurlnewwindow");o(ve(),r),"function"==typeof o.unload&&e.setTimeout&&setTimeout(o.unload,911);break;case"arraybuffer":return ye();case"blob":return ve();case"bloburi":case"bloburl":return e.URL&&e.URL.createObjectURL(ve())||void 0;case"datauristring":case"dataurlstring":return n;case"dataurlnewwindow":var a=e.open(n);if(a||"undefined"==typeof safari)return a;case"datauri":case"dataurl":return e.document.location.href=n;default:throw new Error('Output type "'+t+'" is not supported.')}}),xe=function(e){return!0===Array.isArray(G)&&G.indexOf(e)>-1};switch(c){case"pt":d=1;break;case"mm":d=72/25.4000508;break;case"cm":d=72/2.54000508;break;case"in":d=72;break;case"px":d=1==xe("px_scaling")?.75:96/72;break;case"pc":case"em":d=12;break;case"ex":d=6;break;default:throw"Invalid unit: "+c}U.internal={pdfEscape:le,getStyle:me,getFont:function(){return T[_e.apply(U,arguments)]},getFontSize:function(){return k},getLineHeight:function(){return k*E},write:function(e){X(1===arguments.length?e:Array.prototype.join.call(arguments," "))},getCoordinateString:function(e){return Y(e*d)},getVerticalCoordinateString:function(e){return Y((m-e)*d)},collections:{},newObject:W,newAdditionalObject:function(){var e=2*N.length+1,t={objId:e+=F.length,content:""};return F.push(t),t},newObjectDeferred:function(){return S++,O[S]=function(){return z},S},newObjectDeferredBegin:function(e){O[e]=z},putStream:J,events:H,scaleFactor:d,pageSize:{get width(){return g},get height(){return m}},output:function(e,t){return be(e,t)},getNumberOfPages:function(){return N.length-1},pages:N,out:X,f2:Y,getPageInfo:function(e){return{objId:2*(e-1)+3,pageNumber:e,pageContext:B[e]}},getCurrentPageInfo:function(){return{objId:2*(_-1)+3,pageNumber:_,pageContext:B[_]}},getPDFVersion:function(){return i},hasHotfix:xe},U.addPage=function(){return pe.apply(this,arguments),this},U.setPage=function(){return he.apply(this,arguments),this},U.insertPage=function(e){return this.addPage(),this.movePage(_,e),this},U.movePage=function(e,t){if(e>t){for(var r=N[e],n=R[e],a=B[e],i=e;i>t;i--)N[i]=N[i-1],R[i]=R[i-1],B[i]=B[i-1];N[t]=r,R[t]=n,B[t]=a,this.setPage(t)}else if(e<t){for(var r=N[e],n=R[e],a=B[e],i=e;i<t;i++)N[i]=N[i+1],R[i]=R[i+1],B[i]=B[i+1];N[t]=r,R[t]=n,B[t]=a,this.setPage(t)}return this},U.deletePage=function(){return de.apply(this,arguments),this},U.setDisplayMode=function(e,t,r){if(v=e,b=t,y=r,-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(r))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+r+'" is not recognized.');return this},U.text=function(e,t,r,n,a,i){function o(e){return e=e.split("\t").join(Array(f.TabLen||9).join(" ")),le(e,n)}"number"==typeof e&&(h=r,r=t,t=e,e=h),"string"==typeof e&&(e=e.match(/[\n\r]/)?e.split(/\r\n|\r|\n/g):[e]),"string"==typeof a&&(i=a,a=null),"string"==typeof n&&(i=n,n=null),"number"==typeof n&&(a=n,n=null);var s="",l="Td";if(a){a*=Math.PI/180;var c=Math.cos(a),u=Math.sin(a);s=[Y(c),Y(u),Y(-1*u),Y(c),""].join(" "),l="Tm"}"noBOM"in(n=n||{})||(n.noBOM=!0),"autoencode"in n||(n.autoencode=!0);var $="",_=this.internal.getCurrentPageInfo().pageContext;if(!0===n.stroke?!0!==_.lastTextWasStroke&&($="1 Tr\n",_.lastTextWasStroke=!0):(_.lastTextWasStroke&&($="0 Tr\n"),_.lastTextWasStroke=!1),void 0===this._runningPageHeight&&(this._runningPageHeight=0),"string"==typeof e)e=o(e);else{if("[object Array]"!==Object.prototype.toString.call(e))throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');for(var g=e.concat(),y=[],v=g.length;v--;)y.push(o(g.shift()));if(i){var b,x,A,C=k*E,S=e.map(function(e){return this.getStringUnitWidth(e)*k/d},this);if(A=Math.max.apply(Math,S),"center"===i)b=t-A/2,t-=S[0]/2;else{if("right"!==i)throw new Error('Unrecognized alignment option, use "center" or "right".');b=t-A,t-=S[0]}x=t,e=y[0];for(var I=1,v=y.length;I<v;I++){var O=A-S[I];"center"===i&&(O/=2),e+=") Tj\n"+(b-x+O)+" -"+C+" Td ("+y[I],x=b+O}}else e=y.join(") Tj\nT* (")}var T;return T=Y((m-r)*d),X("BT\n/"+p+" "+k+" Tf\n"+k*E+" TL\n"+$+w+"\n"+s+Y(t*d)+" "+T+" "+l+"\n("+e+") Tj\nET"),this},U.lstext=function(e,t,r,n){console.warn("jsPDF.lstext is deprecated");for(var a=0,i=e.length;a<i;a++,t+=n)this.text(e[a],t,r);return this},U.line=function(e,t,r,n){return this.lines([[r-e,n-t]],e,t)},U.clip=function(){X("W"),X("S")},U.clip_fixed=function(e){X("evenodd"===e?"W*":"W"),X("n")},U.lines=function(e,t,r,n,a,i){var o,s,l,c,u,$,f,p,_,g,y;for("number"==typeof e&&(h=r,r=t,t=e,e=h),n=n||[1,1],X(Q(t*d)+" "+Q((m-r)*d)+" m "),o=n[0],s=n[1],c=e.length,g=t,y=r,l=0;l<c;l++)2===(u=e[l]).length?(g=u[0]*o+g,y=u[1]*s+y,X(Q(g*d)+" "+Q((m-y)*d)+" l")):($=u[0]*o+g,f=u[1]*s+y,p=u[2]*o+g,_=u[3]*s+y,g=u[4]*o+g,y=u[5]*s+y,X(Q($*d)+" "+Q((m-f)*d)+" "+Q(p*d)+" "+Q((m-_)*d)+" "+Q(g*d)+" "+Q((m-y)*d)+" c"));return i&&X(" h"),null!==a&&X(me(a)),this},U.rect=function(e,t,r,n,a){return me(a),X([Y(e*d),Y((m-t)*d),Y(r*d),Y(-n*d),"re"].join(" ")),null!==a&&X(me(a)),this},U.triangle=function(e,t,r,n,a,i,o){return this.lines([[r-e,n-t],[a-r,i-n],[e-a,t-i]],e,t,[1,1],o,!0),this},U.roundedRect=function(e,t,r,n,a,i,o){var s=4/3*(Math.SQRT2-1);return this.lines([[r-2*a,0],[a*s,0,a,i-i*s,a,i],[0,n-2*i],[0,i*s,-a*s,i,-a,i],[2*a-r,0],[-a*s,0,-a,-i*s,-a,-i],[0,2*i-n],[0,-i*s,a*s,-i,a,-i]],e+a,t,[1,1],o),this},U.ellipse=function(e,t,r,n,a){var i=4/3*(Math.SQRT2-1)*r,o=4/3*(Math.SQRT2-1)*n;return X([Y((e+r)*d),Y((m-t)*d),"m",Y((e+r)*d),Y((m-(t-o))*d),Y((e+i)*d),Y((m-(t-n))*d),Y(e*d),Y((m-(t-n))*d),"c"].join(" ")),X([Y((e-i)*d),Y((m-(t-n))*d),Y((e-r)*d),Y((m-(t-o))*d),Y((e-r)*d),Y((m-t)*d),"c"].join(" ")),X([Y((e-r)*d),Y((m-(t+o))*d),Y((e-i)*d),Y((m-(t+n))*d),Y(e*d),Y((m-(t+n))*d),"c"].join(" ")),X([Y((e+i)*d),Y((m-(t+n))*d),Y((e+r)*d),Y((m-(t+o))*d),Y((e+r)*d),Y((m-t)*d),"c"].join(" ")),null!==a&&X(me(a)),this},U.circle=function(e,t,r,n){return this.ellipse(e,t,r,r,n)},U.setProperties=function(e){for(var t in q)q.hasOwnProperty(t)&&e[t]&&(q[t]=e[t]);return this},U.setFontSize=function(e){return k=e,this},U.setFont=function(e,t){return p=_e(e,t),this},U.setFontStyle=U.setFontType=function(e){return p=_e(void 0,e),this},U.getFontList=function(){var e,t,r,n={};for(e in P)if(P.hasOwnProperty(e)){n[e]=r=[];for(t in P[e])P[e].hasOwnProperty(t)&&r.push(t)}return n},U.addFont=function(e,t,r){oe(e,t,r,"StandardEncoding")},U.setLineWidth=function(e){return X((e*d).toFixed(2)+" w"),this},U.setDrawColor=function(e,t,r,n){var a;return a=void 0===t||void 0===n&&e===t===r?"string"==typeof e?e+" G":Y(e/255)+" G":void 0===n?"string"==typeof e?[e,t,r,"RG"].join(" "):[Y(e/255),Y(t/255),Y(r/255),"RG"].join(" "):"string"==typeof e?[e,t,r,n,"K"].join(" "):[Y(e),Y(t),Y(r),Y(n),"K"].join(" "),X(a),this},U.setFillColor=function(e,t,r,a){var i;return void 0===t||void 0===a&&e===t===r?i="string"==typeof e?e+" g":Y(e/255)+" g":void 0===a||"object"===(void 0===a?"undefined":n(a))?(i="string"==typeof e?[e,t,r,"rg"].join(" "):[Y(e/255),Y(t/255),Y(r/255),"rg"].join(" "),a&&0===a.a&&(i=["255","255","255","rg"].join(" "))):i="string"==typeof e?[e,t,r,a,"k"].join(" "):[Y(e),Y(t),Y(r),Y(a),"k"].join(" "),X(i),this},U.setTextColor=function(e,t,r){if("string"==typeof e&&/^#[0-9A-Fa-f]{6}$/.test(e)){var n=parseInt(e.substr(1),16);e=n>>16&255,t=n>>8&255,r=255&n}return w=0===e&&0===t&&0===r||void 0===t?Q(e/255)+" g":[Q(e/255),Q(t/255),Q(r/255),"rg"].join(" "),this},U.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},U.setLineCap=function(e){var t=this.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return D=t,X(t+" J"),this},U.setLineJoin=function(e){var t=this.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return L=t,X(t+" j"),this},U.output=be,U.save=function(e){U.output("save",e)};for(var we in a.API)a.API.hasOwnProperty(we)&&("events"===we&&a.API.events.length?function(e,t){var r,n,a;for(a=t.length-1;-1!==a;a--)r=t[a][0],n=t[a][1],e.subscribe.apply(e,[r].concat("function"==typeof n?[n]:n))}(H,a.API.events):U[we]=a.API[we]);return function(){for(var e=[["Helvetica","helvetica","normal"],["Helvetica-Bold","helvetica","bold"],["Helvetica-Oblique","helvetica","italic"],["Helvetica-BoldOblique","helvetica","bolditalic"],["Courier","courier","normal"],["Courier-Bold","courier","bold"],["Courier-Oblique","courier","italic"],["Courier-BoldOblique","courier","bolditalic"],["Times-Roman","times","normal"],["Times-Bold","times","bold"],["Times-Italic","times","italic"],["Times-BoldItalic","times","bolditalic"],["ZapfDingbats","zapfdingbats"]],t=0,r=e.length;t<r;t++){var n=oe(e[t][0],e[t][1],e[t][2],"StandardEncoding"),a=e[t][0].split("-");ie(n,a[0],a[1]||"")}H.publish("addFonts",{fonts:T,dictionary:P})}(),p="F1",pe(u,t),H.publish("initialized"),U}var i="1.3",s={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};return a.API={events:[]},a.version="1.x-master","function"==typeof define&&define.amd?define("jsPDF",function(){return a}):void 0!==t&&t.exports?t.exports=a:e.jsPDF=a,a}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||void 0));(window.AcroForm=function(e){var t=window.AcroForm;t.scale=function(e){return e*(r.internal.scaleFactor/1)},t.antiScale=function(e){return 1/r.internal.scaleFactor*e};var r={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null};a.API.acroformPlugin=r;var n=function(){for(var e in this.acroformPlugin.acroFormDictionaryRoot.Fields){var t=this.acroformPlugin.acroFormDictionaryRoot.Fields[e];t.hasAnnotation&&o.call(this,t)}},i=function(){if(this.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");this.acroformPlugin.acroFormDictionaryRoot=new t.AcroFormDictionary,this.acroformPlugin.internal=this.internal,this.acroformPlugin.acroFormDictionaryRoot._eventID=this.internal.events.subscribe("postPutResources",c),this.internal.events.subscribe("buildDocument",n),this.internal.events.subscribe("putCatalog",l),this.internal.events.subscribe("postPutPages",u)},o=function(e){var t={type:"reference",object:e};a.API.annotationPlugin.annotations[this.internal.getPageInfo(e.page).pageNumber].push(t)},s=function(e){this.acroformPlugin.printedOut&&(this.acroformPlugin.printedOut=!1,this.acroformPlugin.acroFormDictionaryRoot=null),this.acroformPlugin.acroFormDictionaryRoot||i.call(this),this.acroformPlugin.acroFormDictionaryRoot.Fields.push(e)},l=function(){void 0!==this.acroformPlugin.acroFormDictionaryRoot?this.internal.write("/AcroForm "+this.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R"):console.log("Root missing...")},c=function(){this.internal.events.unsubscribe(this.acroformPlugin.acroFormDictionaryRoot._eventID),delete this.acroformPlugin.acroFormDictionaryRoot._eventID,this.acroformPlugin.printedOut=!0},u=function(e){var r=!e;e||(this.internal.newObjectDeferredBegin(this.acroformPlugin.acroFormDictionaryRoot.objId),this.internal.out(this.acroformPlugin.acroFormDictionaryRoot.getString()));var e=e||this.acroformPlugin.acroFormDictionaryRoot.Kids;for(var n in e){var a=e[n],i=a.Rect;a.Rect&&(a.Rect=t.internal.calculateCoordinates.call(this,a.Rect)),this.internal.newObjectDeferredBegin(a.objId);var o="";if(o+=a.objId+" 0 obj\n",o+="<<\n"+a.getContent(),a.Rect=i,a.hasAppearanceStream&&!a.appearanceStreamContent){var s=t.internal.calculateAppearanceStream.call(this,a);o+="/AP << /N "+s+" >>\n",this.acroformPlugin.xForms.push(s)}if(a.appearanceStreamContent){o+="/AP << ";for(var l in a.appearanceStreamContent){var c=a.appearanceStreamContent[l];if(o+="/"+l+" ",o+="<< ",Object.keys(c).length>=1||Array.isArray(c))for(var n in c)"function"==typeof(u=c[n])&&(u=u.call(this,a)),o+="/"+n+" "+u+" ",this.acroformPlugin.xForms.indexOf(u)>=0||this.acroformPlugin.xForms.push(u);else{var u=c;"function"==typeof u&&(u=u.call(this,a)),o+="/"+n+" "+u+" \n",this.acroformPlugin.xForms.indexOf(u)>=0||this.acroformPlugin.xForms.push(u)}o+=" >>\n"}o+=">>\n"}o+=">>\nendobj\n",this.internal.out(o)}r&&$.call(this,this.acroformPlugin.xForms)},$=function(e){for(var t in e){var r=t,n=e[t];this.internal.newObjectDeferredBegin(n&&n.objId);var a="";a+=n?n.getString():"",this.internal.out(a),delete e[r]}};e.addField=function(e){return e instanceof t.TextField?p.call(this,e):e instanceof t.ChoiceField?d.call(this,e):e instanceof t.Button?f.call(this,e):e instanceof t.ChildClass?s.call(this,e):e&&s.call(this,e),e.page=this.acroformPlugin.internal.getCurrentPageInfo().pageNumber,this};var f=function(e){(e=e||new t.Field).FT="/Btn";var r=e.Ff||0;e.pushbutton&&(r=t.internal.setBitPosition(r,17),delete e.pushbutton),e.radio&&(r=t.internal.setBitPosition(r,16),delete e.radio),e.noToggleToOff&&(r=t.internal.setBitPosition(r,15)),e.Ff=r,s.call(this,e)},p=function(e){(e=e||new t.Field).FT="/Tx";var r=e.Ff||0;e.multiline&&(r|=4096),e.password&&(r|=8192),e.fileSelect&&(r|=1<<20),e.doNotSpellCheck&&(r|=1<<22),e.doNotScroll&&(r|=1<<23),e.Ff=e.Ff||r,s.call(this,e)},d=function(e){var r=e||new t.Field;r.FT="/Ch";var n=r.Ff||0;r.combo&&(n=t.internal.setBitPosition(n,18),delete r.combo),r.edit&&(n=t.internal.setBitPosition(n,19),delete r.edit),r.sort&&(n=t.internal.setBitPosition(n,20),delete r.sort),r.multiSelect&&this.internal.getPDFVersion()>=1.4&&(n=t.internal.setBitPosition(n,22),delete r.multiSelect),r.doNotSpellCheck&&this.internal.getPDFVersion()>=1.4&&(n=t.internal.setBitPosition(n,23),delete r.doNotSpellCheck),r.Ff=n,s.call(this,r)}})(a.API);var i=window.AcroForm;i.internal={},i.createFormXObject=function(e){var t=new i.FormXObject,r=i.Appearance.internal.getHeight(e)||0,n=i.Appearance.internal.getWidth(e)||0;return t.BBox=[0,0,n,r],t},i.Appearance={CheckBox:{createAppearanceStream:function(){return{N:{On:i.Appearance.CheckBox.YesNormal},D:{On:i.Appearance.CheckBox.YesPushDown,Off:i.Appearance.CheckBox.OffPushDown}}},createMK:function(){return"<< /CA (3)>>"},YesPushDown:function(e){var t=i.createFormXObject(e),r="";e.Q=1;var n=i.internal.calculateX(e,"3","ZapfDingbats",50);return r+="0.749023 g\n             0 0 "+i.Appearance.internal.getWidth(e)+" "+i.Appearance.internal.getHeight(e)+" re\n             f\n             BMC\n             q\n             0 0 1 rg\n             /F13 "+n.fontSize+" Tf 0 g\n             BT\n",r+=n.text,r+="ET\n             Q\n             EMC\n",t.stream=r,t},YesNormal:function(e){var t=i.createFormXObject(e),r="";e.Q=1;var n=i.internal.calculateX(e,"3","ZapfDingbats",.9*i.Appearance.internal.getHeight(e));return r+="1 g\n0 0 "+i.Appearance.internal.getWidth(e)+" "+i.Appearance.internal.getHeight(e)+" re\nf\nq\n0 0 1 rg\n0 0 "+(i.Appearance.internal.getWidth(e)-1)+" "+(i.Appearance.internal.getHeight(e)-1)+" re\nW\nn\n0 g\nBT\n/F13 "+n.fontSize+" Tf 0 g\n",r+=n.text,r+="ET\n             Q\n",t.stream=r,t},OffPushDown:function(e){var t=i.createFormXObject(e),r="";return r+="0.749023 g\n            0 0 "+i.Appearance.internal.getWidth(e)+" "+i.Appearance.internal.getHeight(e)+" re\n            f\n",t.stream=r,t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:i.Appearance.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=i.Appearance.RadioButton.Circle.YesNormal,t.D[e]=i.Appearance.RadioButton.Circle.YesPushDown,t},createMK:function(){return"<< /CA (l)>>"},YesNormal:function(e){var t=i.createFormXObject(e),r="",n=i.Appearance.internal.getWidth(e)<=i.Appearance.internal.getHeight(e)?i.Appearance.internal.getWidth(e)/4:i.Appearance.internal.getHeight(e)/4;n*=.9;var a=i.Appearance.internal.Bezier_C;return r+="q\n1 0 0 1 "+i.Appearance.internal.getWidth(e)/2+" "+i.Appearance.internal.getHeight(e)/2+" cm\n"+n+" 0 m\n"+n+" "+n*a+" "+n*a+" "+n+" 0 "+n+" c\n-"+n*a+" "+n+" -"+n+" "+n*a+" -"+n+" 0 c\n-"+n+" -"+n*a+" -"+n*a+" -"+n+" 0 -"+n+" c\n"+n*a+" -"+n+" "+n+" -"+n*a+" "+n+" 0 c\nf\nQ\n",t.stream=r,t},YesPushDown:function(e){var t=i.createFormXObject(e),r="",n=i.Appearance.internal.getWidth(e)<=i.Appearance.internal.getHeight(e)?i.Appearance.internal.getWidth(e)/4:i.Appearance.internal.getHeight(e)/4,a=2*(n*=.9),o=a*i.Appearance.internal.Bezier_C,s=n*i.Appearance.internal.Bezier_C;return r+="0.749023 g\n            q\n           1 0 0 1 "+i.Appearance.internal.getWidth(e)/2+" "+i.Appearance.internal.getHeight(e)/2+" cm\n"+a+" 0 m\n"+a+" "+o+" "+o+" "+a+" 0 "+a+" c\n-"+o+" "+a+" -"+a+" "+o+" -"+a+" 0 c\n-"+a+" -"+o+" -"+o+" -"+a+" 0 -"+a+" c\n"+o+" -"+a+" "+a+" -"+o+" "+a+" 0 c\n            f\n            Q\n            0 g\n            q\n            1 0 0 1 "+i.Appearance.internal.getWidth(e)/2+" "+i.Appearance.internal.getHeight(e)/2+" cm\n"+n+" 0 m\n"+n+" "+s+" "+s+" "+n+" 0 "+n+" c\n-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c\n-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c\n"+s+" -"+n+" "+n+" -"+s+" "+n+" 0 c\n            f\n            Q\n",t.stream=r,t},OffPushDown:function(e){var t=i.createFormXObject(e),r="",n=i.Appearance.internal.getWidth(e)<=i.Appearance.internal.getHeight(e)?i.Appearance.internal.getWidth(e)/4:i.Appearance.internal.getHeight(e)/4,a=2*(n*=.9),o=a*i.Appearance.internal.Bezier_C;return r+="0.749023 g\n            q\n 1 0 0 1 "+i.Appearance.internal.getWidth(e)/2+" "+i.Appearance.internal.getHeight(e)/2+" cm\n"+a+" 0 m\n"+a+" "+o+" "+o+" "+a+" 0 "+a+" c\n-"+o+" "+a+" -"+a+" "+o+" -"+a+" 0 c\n-"+a+" -"+o+" -"+o+" -"+a+" 0 -"+a+" c\n"+o+" -"+a+" "+a+" -"+o+" "+a+" 0 c\n            f\n            Q\n",t.stream=r,t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:i.Appearance.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=i.Appearance.RadioButton.Cross.YesNormal,t.D[e]=i.Appearance.RadioButton.Cross.YesPushDown,t},createMK:function(){return"<< /CA (8)>>"},YesNormal:function(e){var t=i.createFormXObject(e),r="",n=i.Appearance.internal.calculateCross(e);return r+="q\n            1 1 "+(i.Appearance.internal.getWidth(e)-2)+" "+(i.Appearance.internal.getHeight(e)-2)+" re\n            W\n            n\n            "+n.x1.x+" "+n.x1.y+" m\n            "+n.x2.x+" "+n.x2.y+" l\n            "+n.x4.x+" "+n.x4.y+" m\n            "+n.x3.x+" "+n.x3.y+" l\n            s\n            Q\n",t.stream=r,t},YesPushDown:function(e){var t=i.createFormXObject(e),r=i.Appearance.internal.calculateCross(e),n="";return n+="0.749023 g\n            0 0 "+i.Appearance.internal.getWidth(e)+" "+i.Appearance.internal.getHeight(e)+" re\n            f\n            q\n            1 1 "+(i.Appearance.internal.getWidth(e)-2)+" "+(i.Appearance.internal.getHeight(e)-2)+" re\n            W\n            n\n            "+r.x1.x+" "+r.x1.y+" m\n            "+r.x2.x+" "+r.x2.y+" l\n            "+r.x4.x+" "+r.x4.y+" m\n            "+r.x3.x+" "+r.x3.y+" l\n            s\n            Q\n",t.stream=n,t},OffPushDown:function(e){var t=i.createFormXObject(e),r="";return r+="0.749023 g\n            0 0 "+i.Appearance.internal.getWidth(e)+" "+i.Appearance.internal.getHeight(e)+" re\n            f\n",t.stream=r,t}}},createDefaultAppearanceStream:function(e){var t="";return t+="/Helv 0 Tf 0 g"}},i.Appearance.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=i.Appearance.internal.getWidth(e),r=i.Appearance.internal.getHeight(e),n=function(e,t){return e>t?t:e}(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},i.Appearance.internal.getWidth=function(e){return e.Rect[2]},i.Appearance.internal.getHeight=function(e){return e.Rect[3]},i.internal.inherit=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},i.internal.arrayToPdfArray=function(e){if(Array.isArray(e)){var t=" [";for(var r in e)t+=e[r].toString(),t+=r<e.length-1?" ":"";return t+="]"}},i.internal.toPdfString=function(e){return 0!==(e=e||"").indexOf("(")&&(e="("+e),")"!=e.substring(e.length-1)&&(e+="("),e},i.PDFObject=function(){var e;Object.defineProperty(this,"objId",{get:function(){return e||(this.internal?e=this.internal.newObjectDeferred():a.API.acroformPlugin.internal&&(e=a.API.acroformPlugin.internal.newObjectDeferred())),e||console.log("Couldn't create Object ID"),e},configurable:!1})},i.PDFObject.prototype.toString=function(){return this.objId+" 0 R"},i.PDFObject.prototype.getString=function(){var e=this.objId+" 0 obj\n<<";return e+=this.getContent()+">>\n",this.stream&&(e+="stream\n",e+=this.stream,e+="endstream\n"),e+="endobj\n"},i.PDFObject.prototype.getContent=function(){var e="";return e+=function(e){var t="",r=Object.keys(e).filter(function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"_"!=e.substring(0,1)});for(var n in r){var a=r[n],o=e[a];o&&(Array.isArray(o)?t+="/"+a+" "+i.internal.arrayToPdfArray(o)+"\n":o instanceof i.PDFObject?t+="/"+a+" "+o.objId+" 0 R\n":t+="/"+a+" "+o+"\n")}return t}(this)},i.FormXObject=function(){i.PDFObject.call(this),this.Type="/XObject",this.Subtype="/Form",this.FormType=1,this.BBox,this.Matrix,this.Resources="2 0 R",this.PieceInfo;var e;Object.defineProperty(this,"Length",{enumerable:!0,get:function(){return void 0!==e?e.length:0}}),Object.defineProperty(this,"stream",{enumerable:!1,set:function(t){e=t},get:function(){return e||null}})},i.internal.inherit(i.FormXObject,i.PDFObject),i.AcroFormDictionary=function(){i.PDFObject.call(this);var e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!0,configurable:!0,get:function(){return e}}),this.DA},i.internal.inherit(i.AcroFormDictionary,i.PDFObject),i.Field=function(){i.PDFObject.call(this);var e;Object.defineProperty(this,"Rect",{enumerable:!0,configurable:!1,get:function(){if(e)return e},set:function(t){e=t}});var t="";Object.defineProperty(this,"FT",{enumerable:!0,set:function(e){t=e},get:function(){return t}});var r;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,set:function(e){r=e},get:function(){if(!r||r.length<1){if(this instanceof i.ChildClass)return;return"(FieldObject"+i.Field.FieldNum+++")"}return"("==r.substring(0,1)&&r.substring(r.length-1)?r:"("+r+")"}});var n;Object.defineProperty(this,"DA",{enumerable:!0,get:function(){if(n)return"("+n+")"},set:function(e){n=e}});var a;Object.defineProperty(this,"DV",{enumerable:!0,configurable:!0,get:function(){if(a)return a},set:function(e){a=e}}),Object.defineProperty(this,"Type",{enumerable:!0,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,get:function(){return this.hasAnnotation?"/Widget":null}}),this.BG,Object.defineProperty(this,"hasAnnotation",{enumerable:!1,get:function(){return!!(this.Rect||this.BC||this.BG)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(this,"page",{enumerable:!1,configurable:!0,writable:!0})},i.Field.FieldNum=0,i.internal.inherit(i.Field,i.PDFObject),i.ChoiceField=function(){i.Field.call(this),this.FT="/Ch",this.Opt=[],this.V="()",this.TI=0,this.combo=!1,Object.defineProperty(this,"edit",{enumerable:!0,set:function(e){1==e?(this._edit=!0,this.combo=!0):this._edit=!1},get:function(){return!!this._edit&&this._edit},configurable:!1}),this.hasAppearanceStream=!0,Object.defineProperty(this,"V",{get:function(){i.internal.toPdfString()}})},i.internal.inherit(i.ChoiceField,i.Field),window.ChoiceField=i.ChoiceField,i.ListBox=function(){i.ChoiceField.call(this)},i.internal.inherit(i.ListBox,i.ChoiceField),window.ListBox=i.ListBox,i.ComboBox=function(){i.ListBox.call(this),this.combo=!0},i.internal.inherit(i.ComboBox,i.ListBox),
window.ComboBox=i.ComboBox,i.EditBox=function(){i.ComboBox.call(this),this.edit=!0},i.internal.inherit(i.EditBox,i.ComboBox),window.EditBox=i.EditBox,i.Button=function(){i.Field.call(this),this.FT="/Btn"},i.internal.inherit(i.Button,i.Field),window.Button=i.Button,i.PushButton=function(){i.Button.call(this),this.pushbutton=!0},i.internal.inherit(i.PushButton,i.Button),window.PushButton=i.PushButton,i.RadioButton=function(){i.Button.call(this),this.radio=!0;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,get:function(){if(e.length>0)return e}}),Object.defineProperty(this,"__Kids",{get:function(){return e}});var t;Object.defineProperty(this,"noToggleToOff",{enumerable:!1,get:function(){return t},set:function(e){t=e}})},i.internal.inherit(i.RadioButton,i.Button),window.RadioButton=i.RadioButton,i.ChildClass=function(e,t){i.Field.call(this),this.Parent=e,this._AppearanceType=i.Appearance.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(t),this.F=i.internal.setBitPosition(this.F,3,1),this.MK=this._AppearanceType.createMK(),this.AS="/Off",this._Name=t},i.internal.inherit(i.ChildClass,i.Field),i.RadioButton.prototype.setAppearance=function(e){if("createAppearanceStream"in e&&"createMK"in e)for(var t in this.__Kids){var r=this.__Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r._Name),r.MK=e.createMK()}else console.log("Couldn't assign Appearance to RadioButton. Appearance was Invalid!")},i.RadioButton.prototype.createOption=function(e){var t=this,r=new i.ChildClass(t,e);return this.__Kids.push(r),a.API.addField(r),r},i.CheckBox=function(){Button.call(this),this.appearanceStreamContent=i.Appearance.CheckBox.createAppearanceStream(),this.MK=i.Appearance.CheckBox.createMK(),this.AS="/On",this.V="/On"},i.internal.inherit(i.CheckBox,i.Button),window.CheckBox=i.CheckBox,i.TextField=function(){i.Field.call(this),this.DA=i.Appearance.createDefaultAppearanceStream(),this.F=4;var e;Object.defineProperty(this,"V",{get:function(){return e?"("+e+")":e},enumerable:!0,set:function(t){e=t}});var t;Object.defineProperty(this,"DV",{get:function(){return t?"("+t+")":t},enumerable:!0,set:function(e){t=e}});var r=!1;Object.defineProperty(this,"multiline",{enumerable:!1,get:function(){return r},set:function(e){r=e}});var n=!1;Object.defineProperty(this,"MaxLen",{enumerable:!0,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!1,get:function(){return this.V||this.DV}})},i.internal.inherit(i.TextField,i.Field),window.TextField=i.TextField,i.PasswordField=function(){TextField.call(this),Object.defineProperty(this,"password",{value:!0,enumerable:!1,configurable:!1,writable:!1})},i.internal.inherit(i.PasswordField,i.TextField),window.PasswordField=i.PasswordField,i.internal.calculateFontSpace=function(e,t,r){var r=r||"helvetica",n=i.internal.calculateFontSpace.canvas||(i.internal.calculateFontSpace.canvas=document.createElement("canvas"));(s=n.getContext("2d")).save();var a=t+" "+r;s.font=a;var o=s.measureText(e);s.fontcolor="black";var s=n.getContext("2d");return o.height=1.5*s.measureText("3").width,s.restore(),o},i.internal.calculateX=function(e,t,r,n){var n=n||12,r=r||"helvetica",a={text:"",fontSize:""},o=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" "),s=n,l=i.Appearance.internal.getHeight(e)||0;l=l<0?-l:l;var c=i.Appearance.internal.getWidth(e)||0;c=c<0?-c:c,s++;e:for(;;){var t="";s--;var u=i.internal.calculateFontSpace("3",s+"px",r).height,$=e.multiline?l-s:(l-u)/2,f=-2,p=$+=2,d=0,h=0,_=0;if(0==s){s=12,t="(...) Tj\n",t+="% Width of Text: "+i.internal.calculateFontSpace(t,"1px").width+", FieldWidth:"+c+"\n";break}_=i.internal.calculateFontSpace(o[0]+" ",s+"px",r).width;var g="",m=0;for(var y in o){g=" "==(g+=o[y]+" ").substr(g.length-1)?g.substr(0,g.length-1):g;var v=parseInt(y);_=i.internal.calculateFontSpace(g+" ",s+"px",r).width;var b=function(e,t,n){if(e+1<o.length){var a=t+" "+o[e+1];return i.internal.calculateFontSpace(a,n+"px",r).width<=c-4}return!1}(v,g,s),x=y>=o.length-1;if(!b||x){if(b||x){if(x)h=v;else if(e.multiline&&(u+2)*(m+2)+2>l)continue e}else{if(!e.multiline)continue e;if((u+2)*(m+2)+2>l)continue e;h=v}for(var w="",A=d;A<=h;A++)w+=o[A]+" ";switch(w=" "==w.substr(w.length-1)?w.substr(0,w.length-1):w,_=i.internal.calculateFontSpace(w,s+"px",r).width,e.Q){case 2:f=c-_-2;break;case 1:f=(c-_)/2;break;case 0:default:f=2}t+=f+" "+p+" Td\n",t+="("+w+") Tj\n",t+=-f+" 0 Td\n",p=-(s+2),_=0,d=h+1,m++,g=""}else g+=" "}break}return a.text=t,a.fontSize=s,a},i.internal.calculateAppearanceStream=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t="",r=e.V||e.DV,n=i.internal.calculateX(e,r);t+="/Tx BMC\nq\n/F1 "+n.fontSize+" Tf\n1 0 0 1 0 0 Tm\n",t+="BT\n",t+=n.text,t+="ET\n",t+="Q\nEMC\n";var a=new i.createFormXObject(e);return a.stream=t,a}},i.internal.calculateCoordinates=function(e,t,r,n){var a={};if(this.internal){var o=function(e){return e*this.internal.scaleFactor};Array.isArray(e)?(e[0]=i.scale(e[0]),e[1]=i.scale(e[1]),e[2]=i.scale(e[2]),e[3]=i.scale(e[3]),a.lowerLeft_X=e[0]||0,a.lowerLeft_Y=o.call(this,this.internal.pageSize.height)-e[3]-e[1]||0,a.upperRight_X=e[0]+e[2]||0,a.upperRight_Y=o.call(this,this.internal.pageSize.height)-e[1]||0):(e=i.scale(e),t=i.scale(t),r=i.scale(r),n=i.scale(n),a.lowerLeft_X=e||0,a.lowerLeft_Y=this.internal.pageSize.height-t||0,a.upperRight_X=e+r||0,a.upperRight_Y=this.internal.pageSize.height-t+n||0)}else Array.isArray(e)?(a.lowerLeft_X=e[0]||0,a.lowerLeft_Y=e[1]||0,a.upperRight_X=e[0]+e[2]||0,a.upperRight_Y=e[1]+e[3]||0):(a.lowerLeft_X=e||0,a.lowerLeft_Y=t||0,a.upperRight_X=e+r||0,a.upperRight_Y=t+n||0);return[a.lowerLeft_X,a.lowerLeft_Y,a.upperRight_X,a.upperRight_Y]},i.internal.calculateColor=function(e,t,r){var n=new Array(3);return n.r=0|e,n.g=0|t,n.b=0|r,n},i.internal.getBitPosition=function(e,t){var r=1;return r<<=t-1,(e=e||0)|r},i.internal.setBitPosition=function(e,t,r){e=e||0;var n=1;if(n<<=t-1,1==(r=r||1))e|=n;else var e=e&~n;return e},a.API.addHTML=function(e,t,r,n,a){if("undefined"==typeof html2canvas&&"undefined"==typeof rasterizeHTML)throw new Error("You need either https://github.com/niklasvh/html2canvas or https://github.com/cburgmer/rasterizeHTML.js");"number"!=typeof t&&(n=t,a=r),"function"==typeof n&&(a=n,n=null);var i=this.internal,o=i.scaleFactor,s=i.pageSize.width,l=i.pageSize.height;if(n=n||{},n.onrendered=function(e){t=parseInt(t)||0,r=parseInt(r)||0;var i=n.dim||{},c=i.h||0,u=i.w||Math.min(s,e.width/o)-t,$="JPEG";if(n.format&&($=n.format),e.height>l&&n.pagesplit){var f=function(){for(var n=0;;){var i=document.createElement("canvas");i.width=Math.min(s*o,e.width),i.height=Math.min(l*o,e.height-n),i.getContext("2d").drawImage(e,0,n,e.width,i.height,0,0,i.width,i.height);var c=[i,t,n?0:r,i.width/o,i.height/o,$,null,"SLOW"];if(this.addImage.apply(this,c),(n+=i.height)>=e.height)break;this.addPage()}a(u,n,null,c)}.bind(this);if("CANVAS"===e.nodeName){var p=new Image;p.onload=f,p.src=e.toDataURL("image/png"),e=p}else f()}else{var d=Math.random().toString(35),h=[e,t,r,u,c,$,d,"SLOW"];this.addImage.apply(this,h),a(u,c,d,h)}}.bind(this),"undefined"!=typeof html2canvas&&!n.rstz)return html2canvas(e,n);if("undefined"!=typeof rasterizeHTML){var c="drawDocument";return"string"==typeof e&&(c=/^http/.test(e)?"drawURL":"drawHTML"),n.width=n.width||s*o,rasterizeHTML[c](e,void 0,n).then(function(e){n.onrendered(e.image)},function(e){a(null,e)})}return null},function(e){var t=["jpeg","jpg","png"],r=function e(t){var r=this.internal.newObject(),n=this.internal.write,a=this.internal.putStream;if(t.n=r,n("<</Type /XObject"),n("/Subtype /Image"),n("/Width "+t.w),n("/Height "+t.h),t.cs===this.color_spaces.INDEXED?n("/ColorSpace [/Indexed /DeviceRGB "+(t.pal.length/3-1)+" "+("smask"in t?r+2:r+1)+" 0 R]"):(n("/ColorSpace /"+t.cs),t.cs===this.color_spaces.DEVICE_CMYK&&n("/Decode [1 0 1 0 1 0 1 0]")),n("/BitsPerComponent "+t.bpc),"f"in t&&n("/Filter /"+t.f),"dp"in t&&n("/DecodeParms <<"+t.dp+">>"),"trns"in t&&t.trns.constructor==Array){for(var i="",o=0,s=t.trns.length;o<s;o++)i+=t.trns[o]+" "+t.trns[o]+" ";n("/Mask ["+i+"]")}if("smask"in t&&n("/SMask "+(r+1)+" 0 R"),n("/Length "+t.data.length+">>"),a(t.data),n("endobj"),"smask"in t){var l="/Predictor "+t.p+" /Colors 1 /BitsPerComponent "+t.bpc+" /Columns "+t.w,c={w:t.w,h:t.h,cs:"DeviceGray",bpc:t.bpc,dp:l,data:t.smask};"f"in t&&(c.f=t.f),e.call(this,c)}t.cs===this.color_spaces.INDEXED&&(this.internal.newObject(),n("<< /Length "+t.pal.length+">>"),a(this.arrayBufferToBinaryString(new Uint8Array(t.pal))),n("endobj"))},a=function(){var e=this.internal.collections.addImage_images;for(var t in e)r.call(this,e[t])},i=function(){var e,t=this.internal.collections.addImage_images,r=this.internal.write;for(var n in t)r("/I"+(e=t[n]).i,e.n,"0","R")},o=function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:e.image_compression.NONE},s=function(){var e=this.internal.collections.addImage_images;return e||(this.internal.collections.addImage_images=e={},this.internal.events.subscribe("putResources",a),this.internal.events.subscribe("putXobjectDict",i)),e},l=function(e){var t=0;return e&&(t=Object.keys?Object.keys(e).length:function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&t++;return t}(e)),t},c=function(e){return void 0===e||null===e},u=function(t){return"string"==typeof t&&e.sHashCode(t)},$=function(e){return-1===t.indexOf(e)},f=function(t){return"function"!=typeof e["process"+t.toUpperCase()]},p=function(e){return"object"===(void 0===e?"undefined":n(e))&&1===e.nodeType},d=function(e,t,r){if("IMG"===e.nodeName&&e.hasAttribute("src")){var a=""+e.getAttribute("src");if(!r&&0===a.indexOf("data:image/"))return a;!t&&/\.png(?:[?#].*)?$/i.test(a)&&(t="png")}if("CANVAS"===e.nodeName)var i=e;else{(i=document.createElement("canvas")).width=e.clientWidth||e.width,i.height=e.clientHeight||e.height;var o=i.getContext("2d");if(!o)throw"addImage requires canvas to be supported by browser.";if(r){var s,l,c,u,$,f,p,d,h=Math.PI/180;"object"===(void 0===r?"undefined":n(r))&&(s=r.x,l=r.y,c=r.bg,r=r.angle),d=r*h,u=Math.abs(Math.cos(d)),$=Math.abs(Math.sin(d)),f=i.width,p=i.height,i.width=p*$+f*u,i.height=p*u+f*$,isNaN(s)&&(s=i.width/2),isNaN(l)&&(l=i.height/2),o.clearRect(0,0,i.width,i.height),o.fillStyle=c||"white",o.fillRect(0,0,i.width,i.height),o.save(),o.translate(s,l),o.rotate(d),o.drawImage(e,-f/2,-p/2),o.rotate(-d),o.translate(-s,-l),o.restore()}else o.drawImage(e,0,0,i.width,i.height)}return i.toDataURL("png"==(""+t).toLowerCase()?"image/png":"image/jpeg")},h=function(e,t){var r;if(t)for(var n in t)if(e===t[n].alias){r=t[n];break}return r},_=function(e,t,r){return e||t||(e=-96,t=-96),e<0&&(e=-1*r.w*72/e/this.internal.scaleFactor),t<0&&(t=-1*r.h*72/t/this.internal.scaleFactor),0===e&&(e=t*r.w/r.h),0===t&&(t=e*r.h/r.w),[e,t]},g=function(e,t,r,n,a,i,o){var s=_.call(this,r,n,a),l=this.internal.getCoordinateString,c=this.internal.getVerticalCoordinateString;r=s[0],n=s[1],o[i]=a,this.internal.write("q",l(r),"0 0",l(n),l(e),c(t+n),"cm /I"+a.i,"Do Q")};e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"},e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"},e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},e.sHashCode=function(e){return Array.prototype.reduce&&e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0)},e.isString=function(e){return"string"==typeof e},e.extractInfoFromBase64DataURI=function(e){return/^data:([\w]+?\/([\w]+?));base64,(.+?)$/g.exec(e)},e.supportsArrayBuffer=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array},e.isArrayBuffer=function(e){return!!this.supportsArrayBuffer()&&e instanceof ArrayBuffer},e.isArrayBufferView=function(e){return!!this.supportsArrayBuffer()&&"undefined"!=typeof Uint32Array&&(e instanceof Int8Array||e instanceof Uint8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)},e.binaryStringToUint8Array=function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r},e.arrayBufferToBinaryString=function(e){if("function"==typeof window.atob)return atob(this.arrayBufferToBase64(e));for(var t=this.isArrayBuffer(e)?e:new Uint8Array(e),r="",n=Math.round(t.byteLength/20480),a=0;a<n;a++)r+=String.fromCharCode.apply(null,t.slice(20480*a,20480*a+20480));return r},e.arrayBufferToBase64=function(e){for(var t,r,n,a,i="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=new Uint8Array(e),l=s.byteLength,c=l%3,u=l-c,$=0;$<u;$+=3)t=(258048&(a=s[$]<<16|s[$+1]<<8|s[$+2]))>>12,r=(4032&a)>>6,n=63&a,i+=o[(16515072&a)>>18]+o[t]+o[r]+o[n];return 1==c?(t=(3&(a=s[u]))<<4,i+=o[(252&a)>>2]+o[t]+"=="):2==c&&(t=(1008&(a=s[u]<<8|s[u+1]))>>4,r=(15&a)<<2,i+=o[(64512&a)>>10]+o[t]+o[r]+"="),i},e.createImageInfo=function(e,t,r,n,a,i,o,s,l,c,u,$,f){var p={alias:s,w:t,h:r,cs:n,bpc:a,i:o,data:e};return i&&(p.f=i),l&&(p.dp=l),c&&(p.trns=c),u&&(p.pal=u),$&&(p.smask=$),f&&(p.p=f),p},e.addImage=function(e,r,a,i,_,m,y,v,b){if("string"!=typeof r){var x=m;m=_,_=i,i=a,a=r,r=x}if("object"===(void 0===e?"undefined":n(e))&&!p(e)&&"imageData"in e){var w=e;e=w.imageData,r=w.format||r,a=w.x||a||0,i=w.y||i||0,_=w.w||_,m=w.h||m,y=w.alias||y,v=w.compression||v,b=w.rotation||w.angle||b}if(isNaN(a)||isNaN(i))throw console.error("jsPDF.addImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addImage");var A,k=s.call(this);if(!(A=h(e,k))){var E;if(p(e)&&(e=d(e,r,b)),c(y)&&(y=u(e)),!(A=h(y,k))){if(this.isString(e)){var C=this.extractInfoFromBase64DataURI(e);C?(r=C[2],e=atob(C[3])):137===e.charCodeAt(0)&&80===e.charCodeAt(1)&&78===e.charCodeAt(2)&&71===e.charCodeAt(3)&&(r="png")}if(r=(r||"JPEG").toLowerCase(),$(r))throw new Error("addImage currently only supports formats "+t+", not '"+r+"'");if(f(r))throw new Error("please ensure that the plugin for '"+r+"' support is added");if(this.supportsArrayBuffer()&&(e instanceof Uint8Array||(E=e,e=this.binaryStringToUint8Array(e))),!(A=this["process"+r.toUpperCase()](e,l(k),y,o(v),E)))throw new Error("An unkwown error occurred whilst processing the image")}}return g.call(this,a,i,_,m,A,A.i,k),this};var m=function(e){var t,r,n;if(255===!e.charCodeAt(0)||216===!e.charCodeAt(1)||255===!e.charCodeAt(2)||224===!e.charCodeAt(3)||!e.charCodeAt(6)==="J".charCodeAt(0)||!e.charCodeAt(7)==="F".charCodeAt(0)||!e.charCodeAt(8)==="I".charCodeAt(0)||!e.charCodeAt(9)==="F".charCodeAt(0)||0===!e.charCodeAt(10))throw new Error("getJpegSize requires a binary string jpeg file");for(var a=256*e.charCodeAt(4)+e.charCodeAt(5),i=4,o=e.length;i<o;){if(i+=a,255!==e.charCodeAt(i))throw new Error("getJpegSize could not find the size of the image");if(192===e.charCodeAt(i+1)||193===e.charCodeAt(i+1)||194===e.charCodeAt(i+1)||195===e.charCodeAt(i+1)||196===e.charCodeAt(i+1)||197===e.charCodeAt(i+1)||198===e.charCodeAt(i+1)||199===e.charCodeAt(i+1))return r=256*e.charCodeAt(i+5)+e.charCodeAt(i+6),t=256*e.charCodeAt(i+7)+e.charCodeAt(i+8),n=e.charCodeAt(i+9),[t,r,n];i+=2,a=256*e.charCodeAt(i)+e.charCodeAt(i+1)}},y=function(e){if(65496!=(e[0]<<8|e[1]))throw new Error("Supplied data is not a JPEG");for(var t,r,n,a,i=e.length,o=(e[4]<<8)+e[5],s=4;s<i;){if(s+=o,t=v(e,s),o=(t[2]<<8)+t[3],(192===t[1]||194===t[1])&&255===t[0]&&o>7)return t=v(e,s+5),r=(t[2]<<8)+t[3],n=(t[0]<<8)+t[1],a=t[4],{width:r,height:n,numcomponents:a};s+=2}throw new Error("getJpegSizeFromBytes could not find the size of the image")},v=function(e,t){return e.subarray(t,t+5)};e.processJPEG=function(e,t,r,n,a){var i,o=this.color_spaces.DEVICE_RGB,s=this.decode.DCT_DECODE;return this.isString(e)?(i=m(e),this.createImageInfo(e,i[0],i[1],1==i[3]?this.color_spaces.DEVICE_GRAY:o,8,s,t,r)):(this.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.isArrayBufferView(e)?(i=y(e),e=a||this.arrayBufferToBinaryString(e),this.createImageInfo(e,i.width,i.height,1==i.numcomponents?this.color_spaces.DEVICE_GRAY:o,8,s,t,r)):null)},e.processJPG=function(){return this.processJPEG.apply(this,arguments)}}(a.API),function(e){var t={annotations:[],f2:function(e){return e.toFixed(2)},notEmpty:function(e){if(void 0!==e&&""!=e)return!0}};a.API.annotationPlugin=t,a.API.events.push(["addPage",function(e){this.annotationPlugin.annotations[e.pageNumber]=[]}]),e.events.push(["putPage",function(e){for(var r=this.annotationPlugin.annotations[e.pageNumber],n=!1,a=0;a<r.length&&!n;a++)switch((c=r[a]).type){case"link":if(t.notEmpty(c.options.url)||t.notEmpty(c.options.pageNumber)){n=!0;break}case"reference":case"text":case"freetext":n=!0}if(0!=n){this.internal.write("/Annots [");for(var i=this.annotationPlugin.f2,o=this.internal.scaleFactor,s=this.internal.pageSize.height,l=this.internal.getPageInfo(e.pageNumber),a=0;a<r.length;a++){var c=r[a];switch(c.type){case"reference":this.internal.write(" "+c.object.objId+" 0 R ");break;case"text":var u=this.internal.newAdditionalObject(),$=this.internal.newAdditionalObject(),f=c.title||"Note";g="<</Type /Annot /Subtype /Text "+(d="/Rect ["+i(c.bounds.x*o)+" "+i(s-(c.bounds.y+c.bounds.h)*o)+" "+i((c.bounds.x+c.bounds.w)*o)+" "+i((s-c.bounds.y)*o)+"] ")+"/Contents ("+c.contents+")",g+=" /Popup "+$.objId+" 0 R",g+=" /P "+l.objId+" 0 R",g+=" /T ("+f+") >>",u.content=g;var p=u.objId+" 0 R";g="<</Type /Annot /Subtype /Popup "+(d="/Rect ["+i((c.bounds.x+30)*o)+" "+i(s-(c.bounds.y+c.bounds.h)*o)+" "+i((c.bounds.x+c.bounds.w+30)*o)+" "+i((s-c.bounds.y)*o)+"] ")+" /Parent "+p,c.open&&(g+=" /Open true"),g+=" >>",$.content=g,this.internal.write(u.objId,"0 R",$.objId,"0 R");break;case"freetext":var d="/Rect ["+i(c.bounds.x*o)+" "+i((s-c.bounds.y)*o)+" "+i(c.bounds.x+c.bounds.w*o)+" "+i(s-(c.bounds.y+c.bounds.h)*o)+"] ",h=c.color||"#000000";g="<</Type /Annot /Subtype /FreeText "+d+"/Contents ("+c.contents+")",g+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+h+")",g+=" /Border [0 0 0]",g+=" >>",this.internal.write(g);break;case"link":if(c.options.name){var _=this.annotations._nameMap[c.options.name];c.options.pageNumber=_.page,c.options.top=_.y}else c.options.top||(c.options.top=0);var d="/Rect ["+i(c.x*o)+" "+i((s-c.y)*o)+" "+i((c.x+c.w)*o)+" "+i((s-(c.y+c.h))*o)+"] ",g="";if(c.options.url)g="<</Type /Annot /Subtype /Link "+d+"/Border [0 0 0] /A <</S /URI /URI ("+c.options.url+") >>";else if(c.options.pageNumber)switch(g="<</Type /Annot /Subtype /Link "+d+"/Border [0 0 0] /Dest ["+(e=this.internal.getPageInfo(c.options.pageNumber)).objId+" 0 R",c.options.magFactor=c.options.magFactor||"XYZ",c.options.magFactor){case"Fit":g+=" /Fit]";break;case"FitH":g+=" /FitH "+c.options.top+"]";break;case"FitV":c.options.left=c.options.left||0,g+=" /FitV "+c.options.left+"]";break;case"XYZ":default:var m=i((s-c.options.top)*o);c.options.left=c.options.left||0,void 0===c.options.zoom&&(c.options.zoom=0),g+=" /XYZ "+c.options.left+" "+m+" "+c.options.zoom+"]"}""!=g&&(g+=" >>",this.internal.write(g))}}this.internal.write("]")}}]),e.createAnnotation=function(e){switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":this.annotationPlugin.annotations[this.internal.getCurrentPageInfo().pageNumber].push(e)}},e.link=function(e,t,r,n,a){this.annotationPlugin.annotations[this.internal.getCurrentPageInfo().pageNumber].push({x:e,y:t,w:r,h:n,options:a,type:"link"})},e.textWithLink=function(e,t,r,n){var a=this.getTextWidth(e),i=this.internal.getLineHeight()/this.internal.scaleFactor;return this.text(e,t,r),r+=.2*i,this.link(t,r-i,a,i,n),a},e.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor},e.getLineHeight=function(){return this.internal.getLineHeight()}}(a.API),a.API.autoPrint=function(){var e;return this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.write("<< /S/Named /Type/Action /N/Print >>","endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.write("/OpenAction "+e+" 0 R")}),this},function(e){e.events.push(["initialized",function(){this.canvas.pdf=this}]),e.canvas={getContext:function(e){return this.pdf.context2d._canvas=this,this.pdf.context2d},style:{}},Object.defineProperty(e.canvas,"width",{get:function(){return this._width},set:function(e){this._width=e,this.getContext("2d").pageWrapX=e+1}}),Object.defineProperty(e.canvas,"height",{get:function(){return this._height},set:function(e){this._height=e,this.getContext("2d").pageWrapY=e+1}})}(a.API),function(e){var t,r,n,a,i={x:void 0,y:void 0,w:void 0,h:void 0,ln:void 0},o=1,s=function(e,t,r,n,a){i={x:e,y:t,w:r,h:n,ln:a}},l=function(){return i},c={left:0,top:0,bottom:0};e.setHeaderFunction=function(e){a=e},e.getTextDimensions=function(e){t=this.internal.getFont().fontName,r=this.table_font_size||this.internal.getFontSize(),n=this.internal.getFont().fontStyle;var a,i;(i=document.createElement("font")).id="jsPDFCell";try{i.style.fontStyle=n}catch(e){i.style.fontWeight=n}i.style.fontName=t,i.style.fontSize=r+"pt";try{i.textContent=e}catch(t){i.innerText=e}return document.body.appendChild(i),a={w:(i.offsetWidth+1)*(19.049976/25.4),h:(i.offsetHeight+1)*(19.049976/25.4)},document.body.removeChild(i),a},e.cellAddPage=function(){var e=this.margins||c;this.addPage(),s(e.left,e.top,void 0,void 0),o+=1},e.cellInitialize=function(){i={x:void 0,y:void 0,w:void 0,h:void 0,ln:void 0},o=1},e.cell=function(e,t,r,n,a,i,o){var u=l(),$=!1;if(void 0!==u.ln)if(u.ln===i)e=u.x+u.w,t=u.y;else{var f=this.margins||c;u.y+u.h+n+13>=this.internal.pageSize.height-f.bottom&&(this.cellAddPage(),$=!0,this.printHeaders&&this.tableHeaderRow&&this.printHeaderRow(i,!0)),t=l().y+l().h,$&&(t=23)}if(void 0!==a[0])if(this.printingHeaderRow?this.rect(e,t,r,n,"FD"):this.rect(e,t,r,n),"right"===o){a instanceof Array||(a=[a]);for(var p=0;p<a.length;p++){var d=a[p],h=this.getStringUnitWidth(d)*this.internal.getFontSize();this.text(d,e+r-h-3,t+this.internal.getLineHeight()*(p+1))}}else this.text(a,e+3,t+this.internal.getLineHeight());return s(e,t,r,n,i),this},e.arrayMax=function(e,t){var r,n,a,i=e[0];for(r=0,n=e.length;r<n;r+=1)a=e[r],t?-1===t(i,a)&&(i=a):a>i&&(i=a);return i},e.table=function(t,r,n,a,s){if(!n)throw"No data for PDF table";var l,u,$,f,p,d,h,_,g,m,y=[],v=[],b={},x={},w=[],A=[],k=!1,E=!0,C=12,S=c;if(S.width=this.internal.pageSize.width,s&&(!0===s.autoSize&&(k=!0),!1===s.printHeaders&&(E=!1),s.fontSize&&(C=s.fontSize),s.css&&void 0!==s.css["font-size"]&&(C=16*s.css["font-size"]),s.margins&&(S=s.margins)),this.lnMod=0,i={x:void 0,y:void 0,w:void 0,h:void 0,ln:void 0},o=1,this.printHeaders=E,this.margins=S,this.setFontSize(C),this.table_font_size=C,void 0===a||null===a)y=Object.keys(n[0]);else if(a[0]&&"string"!=typeof a[0])for(u=0,$=a.length;u<$;u+=1)l=a[u],y.push(l.name),v.push(l.prompt),x[l.name]=l.width*(19.049976/25.4);else y=a;if(k)for(m=function(e){return e[l]},u=0,$=y.length;u<$;u+=1){for(b[l=y[u]]=n.map(m),w.push(this.getTextDimensions(v[u]||l).w),h=0,f=(d=b[l]).length;h<f;h+=1)p=d[h],w.push(this.getTextDimensions(p).w);x[l]=e.arrayMax(w),w=[]}if(E){for(I=this.calculateLineHeight(y,x,v.length?v:y),u=0,$=y.length;u<$;u+=1)l=y[u],A.push([t,r,x[l],I,String(v.length?v[u]:l)]);this.setTableHeaderRow(A),this.printHeaderRow(1,!1)}for(u=0,$=n.length;u<$;u+=1){var I;for(_=n[u],I=this.calculateLineHeight(y,x,_),h=0,g=y.length;h<g;h+=1)l=y[h],this.cell(t,r,x[l],I,_[l],u+2,l.align)}return this.lastCellPos=i,this.table_x=t,this.table_y=r,this},e.calculateLineHeight=function(e,t,r){for(var n,a=0,i=0;i<e.length;i++){r[n=e[i]]=this.splitTextToSize(String(r[n]),t[n]-3);var o=this.internal.getLineHeight()*r[n].length+3;o>a&&(a=o)}return a},e.setTableHeaderRow=function(e){this.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(!this.tableHeaderRow)throw"Property tableHeaderRow does not exist.";var r,n,i,l;if(this.printingHeaderRow=!0,void 0!==a){var c=a(this,o);s(c[0],c[1],c[2],c[3],-1)}this.setFontStyle("bold");var u=[];for(i=0,l=this.tableHeaderRow.length;i<l;i+=1)this.setFillColor(200,200,200),r=this.tableHeaderRow[i],t&&(this.margins.top=13,r[1]=this.margins&&this.margins.top||0,u.push(r)),n=[].concat(r),this.cell.apply(this,n.concat(e));u.length>0&&this.setTableHeaderRow(u),this.setFontStyle("normal"),this.printingHeaderRow=!1}}(a.API),function(e){function t(){this._isStrokeTransparent=!1,this._strokeOpacity=1,this.strokeStyle="#000000",this.fillStyle="#000000",this._isFillTransparent=!1,this._fillOpacity=1,this.font="12pt times",this.textBaseline="alphabetic",this.textAlign="start",this.lineWidth=1,this.lineJoin="miter",this.lineCap="butt",this._transform=[1,0,0,1,0,0],this.globalCompositeOperation="normal",this.globalAlpha=1,this._clip_path=[],this.ignoreClearRect=!1,this.copy=function(e){this._isStrokeTransparent=e._isStrokeTransparent,this._strokeOpacity=e._strokeOpacity,this.strokeStyle=e.strokeStyle,this._isFillTransparent=e._isFillTransparent,this._fillOpacity=e._fillOpacity,this.fillStyle=e.fillStyle,this.font=e.font,this.lineWidth=e.lineWidth,this.lineJoin=e.lineJoin,this.lineCap=e.lineCap,this.textBaseline=e.textBaseline,this.textAlign=e.textAlign,this._fontSize=e._fontSize,this._transform=e._transform.slice(0),this.globalCompositeOperation=e.globalCompositeOperation,this.globalAlpha=e.globalAlpha,this._clip_path=e._clip_path.slice(0),this.ignoreClearRect=e.ignoreClearRect}}e.events.push(["initialized",function(){this.context2d.pdf=this,this.context2d.internal.pdf=this,this.context2d.ctx=new t,this.context2d.ctxStack=[],this.context2d.path=[]}]),e.context2d={pageWrapXEnabled:!1,pageWrapYEnabled:!1,pageWrapX:9999999,pageWrapY:9999999,ctx:new t,f2:function(e){return e.toFixed(2)},fillRect:function(e,t,r,n){if(!this._isFillTransparent()){e=this._wrapX(e),t=this._wrapY(t);var a=this._matrix_map_rect(this.ctx._transform,{x:e,y:t,w:r,h:n});this.pdf.rect(a.x,a.y,a.w,a.h,"f")}},strokeRect:function(e,t,r,n){if(!this._isStrokeTransparent()){e=this._wrapX(e),t=this._wrapY(t);var a=this._matrix_map_rect(this.ctx._transform,{x:e,y:t,w:r,h:n});this.pdf.rect(a.x,a.y,a.w,a.h,"s")}},clearRect:function(e,t,r,n){if(!this.ctx.ignoreClearRect){e=this._wrapX(e),t=this._wrapY(t);var a=this._matrix_map_rect(this.ctx._transform,{x:e,y:t,w:r,h:n});this.save(),this.setFillStyle("#ffffff"),this.pdf.rect(a.x,a.y,a.w,a.h,"f"),this.restore()}},save:function(){this.ctx._fontSize=this.pdf.internal.getFontSize();var e=new t;e.copy(this.ctx),this.ctxStack.push(this.ctx),this.ctx=e},restore:function(){this.ctx=this.ctxStack.pop(),this.setFillStyle(this.ctx.fillStyle),this.setStrokeStyle(this.ctx.strokeStyle),this.setFont(this.ctx.font),this.pdf.setFontSize(this.ctx._fontSize),this.setLineCap(this.ctx.lineCap),this.setLineWidth(this.ctx.lineWidth),this.setLineJoin(this.ctx.lineJoin)},rect:function(e,t,r,n){this.moveTo(e,t),this.lineTo(e+r,t),this.lineTo(e+r,t+n),this.lineTo(e,t+n),this.lineTo(e,t),this.closePath()},beginPath:function(){this.path=[]},closePath:function(){this.path.push({type:"close"})},_getRGBA:function(e){var t,r,n,a;if(!e)return{r:0,g:0,b:0,a:0,style:e};if(this.internal.rxTransparent.test(e))t=0,r=0,n=0,a=0;else{var i=this.internal.rxRgb.exec(e);null!=i?(t=parseInt(i[1]),r=parseInt(i[2]),n=parseInt(i[3]),a=1):null!=(i=this.internal.rxRgba.exec(e))?(t=parseInt(i[1]),r=parseInt(i[2]),n=parseInt(i[3]),a=parseFloat(i[4])):(a=1,"#"!=e.charAt(0)&&((e=s.colorNameToHex(e))||(e="#000000")),4===e.length?(t=e.substring(1,2),t+=t,r=e.substring(2,3),r+=r,n=e.substring(3,4),n+=n):(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7)),t=parseInt(t,16),r=parseInt(r,16),n=parseInt(n,16))}return{r:t,g:r,b:n,a:a,style:e}},setFillStyle:function(e){var t=this._getRGBA(e);this.ctx.fillStyle=e,this.ctx._isFillTransparent=0===t.a,this.ctx._fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})},setStrokeStyle:function(e){var t=this._getRGBA(e);this.ctx.strokeStyle=t.style,this.ctx._isStrokeTransparent=0===t.a,this.ctx._strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))},fillText:function(e,t,r,n){if(!this._isFillTransparent()){t=this._wrapX(t),r=this._wrapY(r);var a=this._matrix_map_point(this.ctx._transform,[t,r]);t=a[0],r=a[1];var i=57.2958*this._matrix_rotation(this.ctx._transform);if(this.ctx._clip_path.length>0){var o;(o=window.outIntercept?"group"===window.outIntercept.type?window.outIntercept.stream:window.outIntercept:this.internal.getCurrentPage()).push("q");var s=this.path;this.path=this.ctx._clip_path,this.ctx._clip_path=[],this._fill(null,!0),this.ctx._clip_path=this.path,this.path=s}var l=1;try{l=this._matrix_decompose(this._getTransform()).scale[0]}catch(e){console.warn(e)}if(l<.01)this.pdf.text(e,t,this._getBaseline(r),null,i);else{var c=this.pdf.internal.getFontSize();this.pdf.setFontSize(c*l),this.pdf.text(e,t,this._getBaseline(r),null,i),this.pdf.setFontSize(c)}this.ctx._clip_path.length>0&&o.push("Q")}},strokeText:function(e,t,r,n){if(!this._isStrokeTransparent()){t=this._wrapX(t),r=this._wrapY(r);var a=this._matrix_map_point(this.ctx._transform,[t,r]);t=a[0],r=a[1];var i=57.2958*this._matrix_rotation(this.ctx._transform);if(this.ctx._clip_path.length>0){var o;(o=window.outIntercept?"group"===window.outIntercept.type?window.outIntercept.stream:window.outIntercept:this.internal.getCurrentPage()).push("q");var s=this.path;this.path=this.ctx._clip_path,this.ctx._clip_path=[],this._fill(null,!0),this.ctx._clip_path=this.path,this.path=s}var l=1;try{l=this._matrix_decompose(this._getTransform()).scale[0]}catch(e){console.warn(e)}if(1===l)this.pdf.text(e,t,this._getBaseline(r),{stroke:!0},i);else{var c=this.pdf.internal.getFontSize();this.pdf.setFontSize(c*l),this.pdf.text(e,t,this._getBaseline(r),{stroke:!0},i),this.pdf.setFontSize(c)}this.ctx._clip_path.length>0&&o.push("Q")}},setFont:function(e){this.ctx.font=e;var t=/\s*(\w+)\s+(\w+)\s+(\w+)\s+([\d\.]+)(px|pt|em)\s+(.*)?/;if(null!=(u=t.exec(e))){var r=u[1],n=u[3],a=u[4],i=u[5],o=u[6];a="px"===i?Math.floor(parseFloat(a)):"em"===i?Math.floor(parseFloat(a)*this.pdf.getFontSize()):Math.floor(parseFloat(a)),this.pdf.setFontSize(a),"bold"===n||"700"===n?this.pdf.setFontStyle("bold"):"italic"===r?this.pdf.setFontStyle("italic"):this.pdf.setFontStyle("normal");var s,l=(f=o).toLowerCase().split(/\s*,\s*/);s=-1!=l.indexOf("arial")?"Arial":-1!=l.indexOf("verdana")?"Verdana":-1!=l.indexOf("helvetica")?"Helvetica":-1!=l.indexOf("sans-serif")?"sans-serif":-1!=l.indexOf("fixed")?"Fixed":-1!=l.indexOf("monospace")?"Monospace":-1!=l.indexOf("terminal")?"Terminal":-1!=l.indexOf("courier")?"Courier":-1!=l.indexOf("times")?"Times":-1!=l.indexOf("cursive")?"Cursive":-1!=l.indexOf("fantasy")?"Fantasy":(l.indexOf("serif"),"Serif");var c;c="bold"===n?"bold":"normal",this.pdf.setFont(s,c)}else{var u=(t=/\s*(\d+)(pt|px|em)\s+([\w "]+)\s*([\w "]+)?/).exec(e);if(null!=u){var $=u[1],f=u[3];(c=u[4])||(c="normal"),$="em"===i?Math.floor(parseFloat(a)*this.pdf.getFontSize()):Math.floor(parseFloat($)),this.pdf.setFontSize($),this.pdf.setFont(f,c)}}},setTextBaseline:function(e){this.ctx.textBaseline=e},getTextBaseline:function(){return this.ctx.textBaseline},setTextAlign:function(e){this.ctx.textAlign=e},getTextAlign:function(){return this.ctx.textAlign},setLineWidth:function(e){this.ctx.lineWidth=e,this.pdf.setLineWidth(e)},setLineCap:function(e){this.ctx.lineCap=e,this.pdf.setLineCap(e)},setLineJoin:function(e){this.ctx.lineJoin=e,
this.pdf.setLineJoin(e)},moveTo:function(e,t){e=this._wrapX(e),t=this._wrapY(t);var r=this._matrix_map_point(this.ctx._transform,[e,t]),n={type:"mt",x:e=r[0],y:t=r[1]};this.path.push(n)},_wrapX:function(e){return this.pageWrapXEnabled?e%this.pageWrapX:e},_wrapY:function(e){return this.pageWrapYEnabled?(this._gotoPage(this._page(e)),(e-this.lastBreak)%this.pageWrapY):e},transform:function(e,t,r,n,a,i){this.ctx._transform=[e,t,r,n,a,i]},setTransform:function(e,t,r,n,a,i){this.ctx._transform=[e,t,r,n,a,i]},_getTransform:function(){return this.ctx._transform},lastBreak:0,pageBreaks:[],_page:function(e){if(this.pageWrapYEnabled){this.lastBreak=0;for(var t=0,r=0,n=0;n<this.pageBreaks.length;n++)if(e>=this.pageBreaks[n]){t++,0===this.lastBreak&&r++;var a=this.pageBreaks[n]-this.lastBreak;this.lastBreak=this.pageBreaks[n],r+=i=Math.floor(a/this.pageWrapY)}if(0===this.lastBreak){var i=Math.floor(e/this.pageWrapY)+1;r+=i}return r+t}return this.pdf.internal.getCurrentPageInfo().pageNumber},_gotoPage:function(e){},lineTo:function(e,t){e=this._wrapX(e),t=this._wrapY(t);var r=this._matrix_map_point(this.ctx._transform,[e,t]),n={type:"lt",x:e=r[0],y:t=r[1]};this.path.push(n)},bezierCurveTo:function(e,t,r,n,a,i){e=this._wrapX(e),t=this._wrapY(t),r=this._wrapX(r),n=this._wrapY(n),a=this._wrapX(a),i=this._wrapY(i);var o;a=(o=this._matrix_map_point(this.ctx._transform,[a,i]))[0],i=o[1];var s={type:"bct",x1:e=(o=this._matrix_map_point(this.ctx._transform,[e,t]))[0],y1:t=o[1],x2:r=(o=this._matrix_map_point(this.ctx._transform,[r,n]))[0],y2:n=o[1],x:a,y:i};this.path.push(s)},quadraticCurveTo:function(e,t,r,n){e=this._wrapX(e),t=this._wrapY(t),r=this._wrapX(r),n=this._wrapY(n);var a;r=(a=this._matrix_map_point(this.ctx._transform,[r,n]))[0],n=a[1];var i={type:"qct",x1:e=(a=this._matrix_map_point(this.ctx._transform,[e,t]))[0],y1:t=a[1],x:r,y:n};this.path.push(i)},arc:function(e,t,r,n,a,i){if(e=this._wrapX(e),t=this._wrapY(t),!this._matrix_is_identity(this.ctx._transform)){var o=this._matrix_map_point(this.ctx._transform,[e,t]);e=o[0],t=o[1];var s=this._matrix_map_point(this.ctx._transform,[0,0]),l=this._matrix_map_point(this.ctx._transform,[0,r]);r=Math.sqrt(Math.pow(l[0]-s[0],2)+Math.pow(l[1]-s[1],2))}var c={type:"arc",x:e,y:t,radius:r,startAngle:n,endAngle:a,anticlockwise:i};this.path.push(c)},drawImage:function(e,t,r,n,a,i,o,s,l){void 0!==i&&(t=i,r=o,n=s,a=l),t=this._wrapX(t),r=this._wrapY(r);var c,u=this._matrix_map_rect(this.ctx._transform,{x:t,y:r,w:n,h:a}),$=(this._matrix_map_rect(this.ctx._transform,{x:i,y:o,w:s,h:l}),/data:image\/(\w+).*/i.exec(e));c=null!=$?$[1]:"png",this.pdf.addImage(e,c,u.x,u.y,u.w,u.h)},_matrix_multiply:function(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],l=r*e[0]+n*e[2],c=a*e[0]+i*e[2],u=o*e[0]+s*e[2]+e[4];return n=r*e[1]+n*e[3],i=a*e[1]+i*e[3],s=o*e[1]+s*e[3]+e[5],r=l,a=c,o=u,[r,n,a,i,o,s]},_matrix_rotation:function(e){return Math.atan2(e[2],e[0])},_matrix_decompose:function(e){var t=e[0],r=e[1],n=e[2],a=e[3],i=Math.sqrt(t*t+r*r),o=(t/=i)*n+(r/=i)*a;n-=t*o,a-=r*o;var s=Math.sqrt(n*n+a*a);return n/=s,a/=s,o/=s,t*a<r*n&&(t=-t,r=-r,o=-o,i=-i),{scale:[i,0,0,s,0,0],translate:[1,0,0,1,e[4],e[5]],rotate:[t,r,-r,t,0,0],skew:[1,0,o,1,0,0]}},_matrix_map_point:function(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=t[0],c=t[1];return[l*r+c*a+o,l*n+c*i+s]},_matrix_map_point_obj:function(e,t){var r=this._matrix_map_point(e,[t.x,t.y]);return{x:r[0],y:r[1]}},_matrix_map_rect:function(e,t){var r=this._matrix_map_point(e,[t.x,t.y]),n=this._matrix_map_point(e,[t.x+t.w,t.y+t.h]);return{x:r[0],y:r[1],w:n[0]-r[0],h:n[1]-r[1]}},_matrix_is_identity:function(e){return 1==e[0]&&0==e[1]&&0==e[2]&&1==e[3]&&0==e[4]&&0==e[5]},rotate:function(e){var t=[Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0];this.ctx._transform=this._matrix_multiply(this.ctx._transform,t)},scale:function(e,t){var r=[e,0,0,t,0,0];this.ctx._transform=this._matrix_multiply(this.ctx._transform,r)},translate:function(e,t){var r=[1,0,0,1,e,t];this.ctx._transform=this._matrix_multiply(this.ctx._transform,r)},stroke:function(){if(this.ctx._clip_path.length>0){var e;(e=window.outIntercept?"group"===window.outIntercept.type?window.outIntercept.stream:window.outIntercept:this.internal.getCurrentPage()).push("q");var t=this.path;this.path=this.ctx._clip_path,this.ctx._clip_path=[],this._stroke(!0),this.ctx._clip_path=this.path,this.path=t,this._stroke(!1),e.push("Q")}else this._stroke(!1)},_stroke:function(e){if(e||!this._isStrokeTransparent()){for(var t=[],r=this.path,n=0;n<r.length;n++){var a=r[n];switch(a.type){case"mt":t.push({start:a,deltas:[],abs:[]});break;case"lt":$=[a.x-r[n-1].x,a.y-r[n-1].y],t[t.length-1].deltas.push($),t[t.length-1].abs.push(a);break;case"bct":$=[a.x1-r[n-1].x,a.y1-r[n-1].y,a.x2-r[n-1].x,a.y2-r[n-1].y,a.x-r[n-1].x,a.y-r[n-1].y],t[t.length-1].deltas.push($);break;case"qct":var i=r[n-1].x+2/3*(a.x1-r[n-1].x),o=r[n-1].y+2/3*(a.y1-r[n-1].y),s=a.x+2/3*(a.x1-a.x),l=a.y+2/3*(a.y1-a.y),c=a.x,u=a.y,$=[i-r[n-1].x,o-r[n-1].y,s-r[n-1].x,l-r[n-1].y,c-r[n-1].x,u-r[n-1].y];t[t.length-1].deltas.push($);break;case"arc":0==t.length&&t.push({start:{x:0,y:0},deltas:[],abs:[]}),t[t.length-1].arc=!0,t[t.length-1].abs.push(a)}}for(n=0;n<t.length;n++){var f;if(f=n==t.length-1?"s":null,t[n].arc)for(var p=t[n].abs,d=0;d<p.length;d++){var h=p[d],_=360*h.startAngle/(2*Math.PI),g=360*h.endAngle/(2*Math.PI),m=h.x,y=h.y;this.internal.arc2(this,m,y,h.radius,_,g,h.anticlockwise,f,e)}else{var m=t[n].start.x,y=t[n].start.y;e?(this.pdf.lines(t[n].deltas,m,y,null,null),this.pdf.clip_fixed()):this.pdf.lines(t[n].deltas,m,y,null,f)}}}},_isFillTransparent:function(){return this.ctx._isFillTransparent||0==this.globalAlpha},_isStrokeTransparent:function(){return this.ctx._isStrokeTransparent||0==this.globalAlpha},fill:function(e){if(this.ctx._clip_path.length>0){var t;(t=window.outIntercept?"group"===window.outIntercept.type?window.outIntercept.stream:window.outIntercept:this.internal.getCurrentPage()).push("q");var r=this.path;this.path=this.ctx._clip_path,this.ctx._clip_path=[],this._fill(e,!0),this.ctx._clip_path=this.path,this.path=r,this._fill(e,!1),t.push("Q")}else this._fill(e,!1)},_fill:function(e,t){if(!this._isFillTransparent()){var n,a="function"==typeof this.pdf.internal.newObject2;n=window.outIntercept?"group"===window.outIntercept.type?window.outIntercept.stream:window.outIntercept:this.internal.getCurrentPage();var i=[],o=window.outIntercept;if(a)switch(this.ctx.globalCompositeOperation){case"normal":case"source-over":break;case"destination-in":case"destination-out":var s=this.pdf.internal.newStreamObject(),l=this.pdf.internal.newObject2();l.push("<</Type /ExtGState"),l.push("/SMask <</S /Alpha /G "+s.objId+" 0 R>>"),l.push(">>"),p="MASK"+l.objId,this.pdf.internal.addGraphicsState(p,l.objId);var c="/"+p+" gs";n.splice(0,0,"q"),n.splice(1,0,c),n.push("Q"),window.outIntercept=s;break;default:var u="/"+this.pdf.internal.blendModeMap[this.ctx.globalCompositeOperation.toUpperCase()];u&&this.pdf.internal.out(u+" gs")}var $=this.ctx.globalAlpha;if(this.ctx._fillOpacity<1&&($=this.ctx._fillOpacity),a){var f=this.pdf.internal.newObject2();f.push("<</Type /ExtGState"),f.push("/CA "+$),f.push("/ca "+$),f.push(">>");var p="GS_O_"+f.objId;this.pdf.internal.addGraphicsState(p,f.objId),this.pdf.internal.out("/"+p+" gs")}for(var d=this.path,h=0;h<d.length;h++){var _=d[h];switch(_.type){case"mt":i.push({start:_,deltas:[],abs:[]});break;case"lt":w=[_.x-d[h-1].x,_.y-d[h-1].y],i[i.length-1].deltas.push(w),i[i.length-1].abs.push(_);break;case"bct":w=[_.x1-d[h-1].x,_.y1-d[h-1].y,_.x2-d[h-1].x,_.y2-d[h-1].y,_.x-d[h-1].x,_.y-d[h-1].y],i[i.length-1].deltas.push(w);break;case"qct":var g=d[h-1].x+2/3*(_.x1-d[h-1].x),m=d[h-1].y+2/3*(_.y1-d[h-1].y),y=_.x+2/3*(_.x1-_.x),v=_.y+2/3*(_.y1-_.y),b=_.x,x=_.y,w=[g-d[h-1].x,m-d[h-1].y,y-d[h-1].x,v-d[h-1].y,b-d[h-1].x,x-d[h-1].y];i[i.length-1].deltas.push(w);break;case"arc":0===i.length&&i.push({deltas:[],abs:[]}),i[i.length-1].arc=!0,i[i.length-1].abs.push(_);break;case"close":i.push({close:!0})}}for(h=0;h<i.length;h++){var A;if(h==i.length-1?(A="f","evenodd"===e&&(A+="*")):A=null,i[h].close)this.pdf.internal.out("h"),this.pdf.internal.out("f");else if(i[h].arc){i[h].start&&this.internal.move2(this,i[h].start.x,i[h].start.y);for(var k=i[h].abs,E=0;E<k.length;E++){var C=k[E];if(void 0!==C.startAngle){var S=360*C.startAngle/(2*Math.PI),I=360*C.endAngle/(2*Math.PI),O=C.x,T=C.y;if(0===E&&this.internal.move2(this,O,T),this.internal.arc2(this,O,T,C.radius,S,I,C.anticlockwise,null,t),E===k.length-1&&i[h].start){var O=i[h].start.x,T=i[h].start.y;this.internal.line2(r,O,T)}}else this.internal.line2(r,C.x,C.y)}}else{var O=i[h].start.x,T=i[h].start.y;t?(this.pdf.lines(i[h].deltas,O,T,null,null),this.pdf.clip_fixed()):this.pdf.lines(i[h].deltas,O,T,null,A)}}window.outIntercept=o}},pushMask:function(){if("function"==typeof this.pdf.internal.newObject2){var e=this.pdf.internal.newStreamObject(),t=this.pdf.internal.newObject2();t.push("<</Type /ExtGState"),t.push("/SMask <</S /Alpha /G "+e.objId+" 0 R>>"),t.push(">>");var r="MASK"+t.objId;this.pdf.internal.addGraphicsState(r,t.objId);var n="/"+r+" gs";this.pdf.internal.out(n)}else console.log("jsPDF v2 not enabled")},clip:function(){if(this.ctx._clip_path.length>0)for(var e=0;e<this.path.length;e++)this.ctx._clip_path.push(this.path[e]);else this.ctx._clip_path=this.path;this.path=[]},measureText:function(e){var t=this.pdf;return{getWidth:function(){var r=t.internal.getFontSize(),n=t.getStringUnitWidth(e)*r/t.internal.scaleFactor;return n*=1.3333},get width(){return this.getWidth(e)}}},_getBaseline:function(e){var t=parseInt(this.pdf.internal.getFontSize()),r=.25*t;switch(this.ctx.textBaseline){case"bottom":return e-r;case"top":return e+t;case"hanging":return e+t-r;case"middle":return e+t/2-r;case"ideographic":return e;case"alphabetic":default:return e}}};var r=e.context2d;Object.defineProperty(r,"fillStyle",{set:function(e){this.setFillStyle(e)},get:function(){return this.ctx.fillStyle}}),Object.defineProperty(r,"strokeStyle",{set:function(e){this.setStrokeStyle(e)},get:function(){return this.ctx.strokeStyle}}),Object.defineProperty(r,"lineWidth",{set:function(e){this.setLineWidth(e)},get:function(){return this.ctx.lineWidth}}),Object.defineProperty(r,"lineCap",{set:function(e){this.setLineCap(e)},get:function(){return this.ctx.lineCap}}),Object.defineProperty(r,"lineJoin",{set:function(e){this.setLineJoin(e)},get:function(){return this.ctx.lineJoin}}),Object.defineProperty(r,"miterLimit",{set:function(e){this.ctx.miterLimit=e},get:function(){return this.ctx.miterLimit}}),Object.defineProperty(r,"textBaseline",{set:function(e){this.setTextBaseline(e)},get:function(){return this.getTextBaseline()}}),Object.defineProperty(r,"textAlign",{set:function(e){this.setTextAlign(e)},get:function(){return this.getTextAlign()}}),Object.defineProperty(r,"font",{set:function(e){this.setFont(e)},get:function(){return this.ctx.font}}),Object.defineProperty(r,"globalCompositeOperation",{set:function(e){this.ctx.globalCompositeOperation=e},get:function(){return this.ctx.globalCompositeOperation}}),Object.defineProperty(r,"globalAlpha",{set:function(e){this.ctx.globalAlpha=e},get:function(){return this.ctx.globalAlpha}}),Object.defineProperty(r,"ignoreClearRect",{set:function(e){this.ctx.ignoreClearRect=e},get:function(){return this.ctx.ignoreClearRect}}),r.internal={},r.internal.rxRgb=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r.internal.rxRgba=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d\.]+)\s*\)/,r.internal.rxTransparent=/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/,r.internal.arc=function(e,t,r,n,a,i,o,s){for(var l=this.pdf.internal.scaleFactor,c=this.pdf.internal.pageSize.height,u=this.pdf.internal.f2,$=a*(Math.PI/180),f=i*(Math.PI/180),p=this.createArc(n,$,f,o),d=0;d<p.length;d++){var h=p[d];0===d?this.pdf.internal.out([u((h.x1+t)*l),u((c-(h.y1+r))*l),"m",u((h.x2+t)*l),u((c-(h.y2+r))*l),u((h.x3+t)*l),u((c-(h.y3+r))*l),u((h.x4+t)*l),u((c-(h.y4+r))*l),"c"].join(" ")):this.pdf.internal.out([u((h.x2+t)*l),u((c-(h.y2+r))*l),u((h.x3+t)*l),u((c-(h.y3+r))*l),u((h.x4+t)*l),u((c-(h.y4+r))*l),"c"].join(" ")),e._lastPoint={x:t,y:r}}null!==s&&this.pdf.internal.out(this.pdf.internal.getStyle(s))},r.internal.arc2=function(e,t,r,n,a,i,o,s,l){var c=t,u=r;l?(this.arc(e,c,u,n,a,i,o,null),this.pdf.clip_fixed()):this.arc(e,c,u,n,a,i,o,s)},r.internal.move2=function(e,t,r){var n=this.pdf.internal.scaleFactor,a=this.pdf.internal.pageSize.height,i=this.pdf.internal.f2;this.pdf.internal.out([i(t*n),i((a-r)*n),"m"].join(" ")),e._lastPoint={x:t,y:r}},r.internal.line2=function(e,t,r){var n=this.pdf.internal.scaleFactor,a=this.pdf.internal.pageSize.height,i=this.pdf.internal.f2,o={x:t,y:r};this.pdf.internal.out([i(o.x*n),i((a-o.y)*n),"l"].join(" ")),e._lastPoint=o},r.internal.createArc=function(e,t,r,n){var a=2*Math.PI,i=Math.PI/2,o=t;for((o<a||o>a)&&(o%=a),o<0&&(o=a+o);t>r;)t-=a;var s=Math.abs(r-t);s<a&&n&&(s=a-s);for(var l=[],c=n?-1:1,u=o;s>1e-5;){var $=u+c*Math.min(s,i);l.push(this.createSmallArc(e,u,$)),s-=Math.abs($-u),u=$}return l},r.internal.getCurrentPage=function(){return this.pdf.internal.pages[this.pdf.internal.getCurrentPageInfo().pageNumber]},r.internal.createSmallArc=function(e,t,r){var n=(r-t)/2,a=e*Math.cos(n),i=e*Math.sin(n),o=a,s=-i,l=o*o+s*s,c=l+o*a+s*i,u=4/3*(Math.sqrt(2*l*c)-c)/(o*i-s*a),$=o-u*s,f=s+u*o,p=$,d=-f,h=n+t,_=Math.cos(h),g=Math.sin(h);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:$*_-f*g,y2:$*g+f*_,x3:p*_-d*g,y3:p*g+d*_,x4:e*Math.cos(r),y4:e*Math.sin(r)}}}(a.API),function(e){var t,r,a,i,o,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x;t=function(){function e(){}return function(t){return e.prototype=t,new e}}(),f=function(e){var t,r,n,a,i,o,s;for(r=0,n=e.length,t=void 0,a=!1,o=!1;!a&&r!==n;)(t=e[r]=e[r].trimLeft())&&(a=!0),r++;for(r=n-1;n&&!o&&-1!==r;)(t=e[r]=e[r].trimRight())&&(o=!0),r--;for(i=/\s+$/g,s=!0,r=0;r!==n;)"\u2028"!=e[r]&&(t=e[r].replace(/\s+/g," "),s&&(t=t.trimLeft()),t&&(s=i.test(t)),e[r]=t),r++;return e},d=function(e){var t,r,n;for(t=void 0,r=(n=e.split(",")).shift();!t&&r;)t=a[r.trim().toLowerCase()],r=n.shift();return t},h=function(e){(e="auto"===e?"0px":e).indexOf("em")>-1&&!isNaN(Number(e.replace("em","")))&&(e=18.719*Number(e.replace("em",""))+"px"),e.indexOf("pt")>-1&&!isNaN(Number(e.replace("pt","")))&&(e=1.333*Number(e.replace("pt",""))+"px");var t;return(t=_[e])?t:void 0!==(t={"xx-small":9,"x-small":11,small:13,medium:16,large:19,"x-large":23,"xx-large":28,auto:0}[{css_line_height_string:e}])?_[e]=t/16:(t=parseFloat(e))?_[e]=t/16:3===(t=e.match(/([\d\.]+)(px)/)).length?_[e]=parseFloat(t[1])/16:_[e]=1},$=function(e){var t,r,n;return n=function(t){var r;return r=function(e){return document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle?e.currentStyle:e.style}(e),function(e){return e=e.replace(/-\D/g,function(e){return e.charAt(1).toUpperCase()}),r[e]}}(),t={},r=void 0,t["font-family"]=d(n("font-family"))||"times",t["font-style"]=i[n("font-style")]||"normal",t["text-align"]=o[n("text-align")]||"left","bold"===(r=l[n("font-weight")]||"normal")&&("normal"===t["font-style"]?t["font-style"]=r:t["font-style"]=r+t["font-style"]),t["font-size"]=h(n("font-size"))||1,t["line-height"]=h(n("line-height"))||1,t.display="inline"===n("display")?"inline":"block",r="block"===t.display,t["margin-top"]=r&&h(n("margin-top"))||0,t["margin-bottom"]=r&&h(n("margin-bottom"))||0,t["padding-top"]=r&&h(n("padding-top"))||0,t["padding-bottom"]=r&&h(n("padding-bottom"))||0,t["margin-left"]=r&&h(n("margin-left"))||0,t["margin-right"]=r&&h(n("margin-right"))||0,t["padding-left"]=r&&h(n("padding-left"))||0,t["padding-right"]=r&&h(n("padding-right"))||0,t["page-break-before"]=n("page-break-before")||"auto",t.float=c[n("cssFloat")]||"none",t.clear=u[n("clear")]||"none",t.color=n("color"),t},g=function(e,t,r){var n,a,i,o,s;if(i=!1,a=void 0,o=void 0,n=r["#"+e.id])if("function"==typeof n)i=n(e,t);else for(a=0,o=n.length;!i&&a!==o;)i=n[a](e,t),a++;if(n=r[e.nodeName],!i&&n)if("function"==typeof n)i=n(e,t);else for(a=0,o=n.length;!i&&a!==o;)i=n[a](e,t),a++;for(s=e.className?e.className.split(" "):[],a=0;a<s.length;a++)if(n=r["."+s[a]],!i&&n)if("function"==typeof n)i=n(e,t);else for(a=0,o=n.length;!i&&a!==o;)i=n[a](e,t),a++;return i},x=function(e,t){var r,n,a,i,o,s,l,c,u;for(r=[],n=[],a=0,u=e.rows[0].cells.length,l=e.clientWidth;a<u;)c=e.rows[0].cells[a],n[a]={name:c.textContent.toLowerCase().replace(/\s+/g,""),prompt:c.textContent.replace(/\r?\n/g,""),width:c.clientWidth/l*t.pdf.internal.pageSize.width},a++;for(a=1;a<e.rows.length;){for(s=e.rows[a],o={},i=0;i<s.cells.length;)o[n[i].name]=s.cells[i].textContent.replace(/\r?\n/g,""),i++;r.push(o),a++}return{rows:r,headers:n}};var w={SCRIPT:1,STYLE:1,NOSCRIPT:1,OBJECT:1,EMBED:1,SELECT:1},A=1;r=function(e,a,i){var o,s,l,c,u,f,p,d;for(s=e.childNodes,o=void 0,(u="block"===(l=$(e)).display)&&(a.setBlockBoundary(),a.setBlockStyle(l)),c=0,f=s.length;c<f;){if("object"===(void 0===(o=s[c])?"undefined":n(o))){if(a.executeWatchFunctions(o),1===o.nodeType&&"HEADER"===o.nodeName){var h=o,_=a.pdf.margins_doc.top;a.pdf.internal.events.subscribe("addPage",function(e){a.y=_,r(h,a,i),a.pdf.margins_doc.top=a.y+10,a.y+=10},!1)}if(8===o.nodeType&&"#comment"===o.nodeName)~o.textContent.indexOf("ADD_PAGE")&&(a.pdf.addPage(),a.y=a.pdf.margins_doc.top);else if(1!==o.nodeType||w[o.nodeName])if(3===o.nodeType){var y=o.nodeValue;if(o.nodeValue&&"LI"===o.parentNode.nodeName)if("OL"===o.parentNode.parentNode.nodeName)y=A+++". "+y;else{var v=l["font-size"],b=(3-.75*v)*a.pdf.internal.scaleFactor,k=.75*v*a.pdf.internal.scaleFactor,E=1.74*v/a.pdf.internal.scaleFactor;d=function(e,t){this.pdf.circle(e+b,t+k,E,"FD")}}16&o.ownerDocument.body.compareDocumentPosition(o)&&a.addText(y,l)}else"string"==typeof o&&a.addText(o,l);else{var C;if("IMG"===o.nodeName){var S=o.getAttribute("src");C=m[a.pdf.sHashCode(S)||S]}if(C){a.pdf.internal.pageSize.height-a.pdf.margins_doc.bottom<a.y+o.height&&a.y>a.pdf.margins_doc.top&&(a.pdf.addPage(),a.y=a.pdf.margins_doc.top,a.executeWatchFunctions(o));var I=$(o),O=a.x,T=12/a.pdf.internal.scaleFactor,P=(I["margin-left"]+I["padding-left"])*T,M=(I["margin-right"]+I["padding-right"])*T,N=(I["margin-top"]+I["padding-top"])*T,B=(I["margin-bottom"]+I["padding-bottom"])*T;void 0!==I.float&&"right"===I.float?O+=a.settings.width-o.width-M:O+=P,a.pdf.addImage(C,O,a.y+N,o.width,o.height),C=void 0,"right"===I.float||"left"===I.float?(a.watchFunctions.push(function(e,t,r,n){return a.y>=t?(a.x+=e,a.settings.width+=r,!0):!!(n&&1===n.nodeType&&!w[n.nodeName]&&a.x+n.width>a.pdf.margins_doc.left+a.pdf.margins_doc.width)&&(a.x+=e,a.y=t,a.settings.width+=r,!0)}.bind(this,"left"===I.float?-o.width-P-M:0,a.y+o.height+N+B,o.width)),a.watchFunctions.push(function(e,t,r){return!(a.y<e&&t===a.pdf.internal.getNumberOfPages())||1===r.nodeType&&"both"===$(r).clear&&(a.y=e,!0)}.bind(this,a.y+o.height,a.pdf.internal.getNumberOfPages())),a.settings.width-=o.width+P+M,"left"===I.float&&(a.x+=o.width+P+M)):a.y+=o.height+N+B}else if("TABLE"===o.nodeName)p=x(o,a),a.y+=10,a.pdf.table(a.x,a.y,p.rows,p.headers,{autoSize:!1,printHeaders:i.printHeaders,margins:a.pdf.margins_doc,css:$(o)}),a.y=a.pdf.lastCellPos.y+a.pdf.lastCellPos.h+20;else if("OL"===o.nodeName||"UL"===o.nodeName)A=1,g(o,a,i)||r(o,a,i),a.y+=10;else if("LI"===o.nodeName){var R=a.x;a.x+=20/a.pdf.internal.scaleFactor,a.y+=3,g(o,a,i)||r(o,a,i),a.x=R}else"BR"===o.nodeName?(a.y+=l["font-size"]*a.pdf.internal.scaleFactor,a.addText("\u2028",t(l))):g(o,a,i)||r(o,a,i)}}c++}if(i.outY=a.y,u)return a.setBlockBoundary(d)},m={},y=function(e,t,r,n){function a(){t.pdf.internal.events.publish("imagesLoaded"),n(i)}for(var i,o=e.getElementsByTagName("img"),s=o.length,l=0;s--;)!function(e,r,n){if(e){var o=new Image;i=++l,o.crossOrigin="",o.onerror=o.onload=function(){if(o.complete&&(0===o.src.indexOf("data:image/")&&(o.width=r||o.width||0,o.height=n||o.height||0),o.width+o.height)){var i=t.pdf.sHashCode(e)||e;m[i]=m[i]||o}--l||a()},o.src=e}}(o[s].getAttribute("src"),o[s].width,o[s].height);return l||a()},v=function(e,t,n){var a=e.getElementsByTagName("footer");if(a.length>0){a=a[0];var i=t.pdf.internal.write,o=t.y;t.pdf.internal.write=function(){},r(a,t,n);var s=Math.ceil(t.y-o)+5;t.y=o,t.pdf.internal.write=i,t.pdf.margins_doc.bottom+=s;for(var l=function(e){var i=void 0!==e?e.pageNumber:1,o=t.y;t.y=t.pdf.internal.pageSize.height-t.pdf.margins_doc.bottom,t.pdf.margins_doc.bottom-=s;for(var l=a.getElementsByTagName("span"),c=0;c<l.length;++c)(" "+l[c].className+" ").replace(/[\n\t]/g," ").indexOf(" pageCounter ")>-1&&(l[c].innerHTML=i),(" "+l[c].className+" ").replace(/[\n\t]/g," ").indexOf(" totalPages ")>-1&&(l[c].innerHTML="###jsPDFVarTotalPages###");r(a,t,n),t.pdf.margins_doc.bottom+=s,t.y=o},c=a.getElementsByTagName("span"),u=0;u<c.length;++u)(" "+c[u].className+" ").replace(/[\n\t]/g," ").indexOf(" totalPages ")>-1&&t.pdf.internal.events.subscribe("htmlRenderingFinished",t.pdf.putTotalPages.bind(t.pdf,"###jsPDFVarTotalPages###"),!0);t.pdf.internal.events.subscribe("addPage",l,!1),l(),w.FOOTER=1}},b=function(e,t,n,a,i,o){if(!t)return!1;"string"==typeof t||t.parentNode||(t=""+t.innerHTML),"string"==typeof t&&(t=function(e){var t,r,n,a;return n="jsPDFhtmlText"+Date.now().toString()+(1e3*Math.random()).toFixed(0),a="position: absolute !important;clip: rect(1px 1px 1px 1px); /* IE6, IE7 */clip: rect(1px, 1px, 1px, 1px);padding:0 !important;border:0 !important;height: 1px !important;width: 1px !important; top:auto;left:-100px;overflow: hidden;",r=document.createElement("div"),r.style.cssText=a,r.innerHTML='<iframe style="height:1px;width:1px" name="'+n+'" />',document.body.appendChild(r),(t=window.frames[n]).document.open(),t.document.writeln(e),t.document.close(),t.document.body}(t.replace(/<\/?script[^>]*?>/gi,"")));var s,l=new p(e,n,a,i);return y.call(this,t,l,i.elementHandlers,function(e){v(t,l,i.elementHandlers),r(t,l,i.elementHandlers),l.pdf.internal.events.publish("htmlRenderingFinished"),s=l.dispose(),"function"==typeof o?o(s):e&&console.error("jsPDF Warning: rendering issues? provide a callback to fromHTML!")}),s||{x:l.x,y:l.y}},(p=function(e,t,r,n){return this.pdf=e,this.x=t,this.y=r,this.settings=n,this.watchFunctions=[],this.init(),this}).prototype.init=function(){return this.paragraph={text:[],style:[]},this.pdf.internal.write("q")},p.prototype.dispose=function(){return this.pdf.internal.write("Q"),{x:this.x,y:this.y,ready:!0}},p.prototype.executeWatchFunctions=function(e){var t=!1,r=[];if(this.watchFunctions.length>0){for(var n=0;n<this.watchFunctions.length;++n)!0===this.watchFunctions[n](e)?t=!0:r.push(this.watchFunctions[n]);this.watchFunctions=r}return t},p.prototype.splitFragmentsIntoLines=function(e,r){var n,a,i,o,s,l,c,u,$,f,p,d,h,_;for(f=this.pdf.internal.scaleFactor,o={},a=void 0,$=void 0,i=void 0,s=void 0,_=void 0,u=void 0,c=void 0,l=void 0,d=[p=[]],n=0,h=this.settings.width;e.length;)if(s=e.shift(),_=r.shift(),s)if(a=_["font-family"],$=_["font-style"],(i=o[a+$])||(i=this.pdf.internal.getFont(a,$).metadata.Unicode,o[a+$]=i),u={widths:i.widths,kerning:i.kerning,fontSize:12*_["font-size"],textIndent:n},c=this.pdf.getStringUnitWidth(s,u)*u.fontSize/f,"\u2028"==s)p=[],d.push(p);else if(n+c>h){for(l=this.pdf.splitTextToSize(s,h,u),p.push([l.shift(),_]);l.length;)p=[[l.shift(),_]],d.push(p);n=this.pdf.getStringUnitWidth(p[0][0],u)*u.fontSize/f}else p.push([s,_]),n+=c;if(void 0!==_["text-align"]&&("center"===_["text-align"]||"right"===_["text-align"]||"justify"===_["text-align"]))for(var g=0;g<d.length;++g){var m=this.pdf.getStringUnitWidth(d[g][0][0],u)*u.fontSize/f;g>0&&(d[g][0][1]=t(d[g][0][1]));var y=h-m;if("right"===_["text-align"])d[g][0][1]["margin-left"]=y;else if("center"===_["text-align"])d[g][0][1]["margin-left"]=y/2;else if("justify"===_["text-align"]){var v=d[g][0][0].split(" ").length-1;d[g][0][1]["word-spacing"]=y/v,g===d.length-1&&(d[g][0][1]["word-spacing"]=0)}}return d},p.prototype.RenderTextFragment=function(e,t){var r,n;n=0,this.pdf.internal.pageSize.height-this.pdf.margins_doc.bottom<this.y+this.pdf.internal.getFontSize()&&(this.pdf.internal.write("ET","Q"),this.pdf.addPage(),this.y=this.pdf.margins_doc.top,this.pdf.internal.write("q","BT 0 g",this.pdf.internal.getCoordinateString(this.x),this.pdf.internal.getVerticalCoordinateString(this.y),t.color,"Td"),n=Math.max(n,t["line-height"],t["font-size"]),this.pdf.internal.write(0,(-12*n).toFixed(2),"Td")),r=this.pdf.internal.getFont(t["font-family"],t["font-style"]);var a=this.getPdfColor(t.color);a!==this.lastTextColor&&(this.pdf.internal.write(a),this.lastTextColor=a),void 0!==t["word-spacing"]&&t["word-spacing"]>0&&this.pdf.internal.write(t["word-spacing"].toFixed(2),"Tw"),this.pdf.internal.write("/"+r.id,(12*t["font-size"]).toFixed(2),"Tf","("+this.pdf.internal.pdfEscape(e)+") Tj"),void 0!==t["word-spacing"]&&this.pdf.internal.write(0,"Tw")},p.prototype.getPdfColor=function(e){var t,r,n,a=/rgb\s*\(\s*(\d+),\s*(\d+),\s*(\d+\s*)\)/.exec(e);if(null!=a?(t=parseInt(a[1]),r=parseInt(a[2]),n=parseInt(a[3])):("#"!=e.charAt(0)&&((e=s.colorNameToHex(e))||(e="#000000")),t=e.substring(1,3),t=parseInt(t,16),r=e.substring(3,5),r=parseInt(r,16),n=e.substring(5,7),n=parseInt(n,16)),"string"==typeof t&&/^#[0-9A-Fa-f]{6}$/.test(t)){var i=parseInt(t.substr(1),16);t=i>>16&255,r=i>>8&255,n=255&i}var o=this.f3;return 0===t&&0===r&&0===n||void 0===r?o(t/255)+" g":[o(t/255),o(r/255),o(n/255),"rg"].join(" ")},p.prototype.f3=function(e){return e.toFixed(3)},p.prototype.renderParagraph=function(e){var t,r,n,a,i,o,s,l,c,u,$,p,d;if(n=f(this.paragraph.text),p=this.paragraph.style,t=this.paragraph.blockstyle,this.paragraph={text:[],style:[],blockstyle:{},priorblockstyle:t},n.join("").trim()){s=this.splitFragmentsIntoLines(n,p),o=void 0,l=void 0,r=12/this.pdf.internal.scaleFactor,this.priorMarginBottom=this.priorMarginBottom||0,$=(Math.max((t["margin-top"]||0)-this.priorMarginBottom,0)+(t["padding-top"]||0))*r,u=((t["margin-bottom"]||0)+(t["padding-bottom"]||0))*r,this.priorMarginBottom=t["margin-bottom"]||0,"always"===t["page-break-before"]&&(this.pdf.addPage(),this.y=0,$=((t["margin-top"]||0)+(t["padding-top"]||0))*r),c=this.pdf.internal.write,a=void 0,i=void 0,this.y+=$,c("q","BT 0 g",this.pdf.internal.getCoordinateString(this.x),this.pdf.internal.getVerticalCoordinateString(this.y),"Td");for(var h=0;s.length;){for(l=0,a=0,i=(o=s.shift()).length;a!==i;)o[a][0].trim()&&(l=Math.max(l,o[a][1]["line-height"],o[a][1]["font-size"]),d=7*o[a][1]["font-size"]),a++;var _=0,g=0;for(void 0!==o[0][1]["margin-left"]&&o[0][1]["margin-left"]>0&&(_=(g=this.pdf.internal.getCoordinateString(o[0][1]["margin-left"]))-h,h=g),c(_+Math.max(t["margin-left"]||0,0)*r,(-12*l).toFixed(2),"Td"),a=0,i=o.length;a!==i;)o[a][0]&&this.RenderTextFragment(o[a][0],o[a][1]),a++;if(this.y+=l*r,this.executeWatchFunctions(o[0][1])&&s.length>0){var m=[],y=[];s.forEach(function(e){for(var t=0,r=e.length;t!==r;)e[t][0]&&(m.push(e[t][0]+" "),y.push(e[t][1])),++t}),s=this.splitFragmentsIntoLines(f(m),y),c("ET","Q"),c("q","BT 0 g",this.pdf.internal.getCoordinateString(this.x),this.pdf.internal.getVerticalCoordinateString(this.y),"Td")}}return e&&"function"==typeof e&&e.call(this,this.x-9,this.y-d/2),c("ET","Q"),this.y+=u}},p.prototype.setBlockBoundary=function(e){return this.renderParagraph(e)},p.prototype.setBlockStyle=function(e){return this.paragraph.blockstyle=e},p.prototype.addText=function(e,t){return this.paragraph.text.push(e),this.paragraph.style.push(t)},a={helvetica:"helvetica","sans-serif":"helvetica","times new roman":"times",serif:"times",times:"times",monospace:"courier",courier:"courier"},l={100:"normal",200:"normal",300:"normal",400:"normal",500:"bold",600:"bold",700:"bold",800:"bold",900:"bold",normal:"normal",bold:"bold",bolder:"bold",lighter:"normal"},i={normal:"normal",italic:"italic",oblique:"italic"},o={left:"left",right:"right",center:"center",justify:"justify"},c={none:"none",right:"right",left:"left"},u={none:"none",both:"both"},_={normal:1},e.fromHTML=function(e,t,r,n,a,i){return this.margins_doc=i||{top:0,bottom:0},n||(n={}),n.elementHandlers||(n.elementHandlers={}),b(this,e,isNaN(t)?4:t,isNaN(r)?4:r,n,a)}}(a.API),function(e){var t,r,n;a.API.addJS=function(e){return n=e,this.internal.events.subscribe("postPutResources",function(e){t=this.internal.newObject(),this.internal.write("<< /Names [(EmbeddedJS) "+(t+1)+" 0 R] >>","endobj"),r=this.internal.newObject(),this.internal.write("<< /S /JavaScript /JS (",n,") >>","endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==t&&void 0!==r&&this.internal.write("/Names <</JavaScript "+t+" 0 R>>")}),this}}(),function(e){e.events.push(["postPutResources",function(){var e=this,t=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=e.outline.render().split(/\r\n/),n=0;n<r.length;n++){var a=r[n],i=t.exec(a);if(null!=i){var o=i[1];e.internal.newObjectDeferredBegin(o)}e.internal.write(a)}if(this.outline.createNamedDestinations){for(var s=this.internal.pages.length,l=[],n=0;n<s;n++){var c=e.internal.newObject();l.push(c);var u=e.internal.getPageInfo(n+1);e.internal.write("<< /D["+u.objId+" 0 R /XYZ null null null]>> endobj")}var $=e.internal.newObject();for(e.internal.write("<< /Names [ "),n=0;n<l.length;n++)e.internal.write("(page_"+(n+1)+")"+l[n]+" 0 R");e.internal.write(" ] >>","endobj"),e.internal.newObject(),e.internal.write("<< /Dests "+$+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+namesOid+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,r){var n={title:t,options:r,children:[]};return null==e&&(e=this.root),e.children.push(n),n},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var r=0;r<t.children.length;r++)this.genIds_r(t.children[r])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(a=0;a<t.children.length;a++){i=t.children[a],this.objStart(i),this.line("/Title "+this.makeString(i.title)),this.line("/Parent "+this.makeRef(t)),a>0&&this.line("/Prev "+this.makeRef(t.children[a-1])),a<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[a+1])),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1])));var r=this.count=this.count_r({count:0},i);if(r>0&&this.line("/Count "+r),i.options&&i.options.pageNumber){var n=e.internal.getPageInfo(i.options.pageNumber);this.line("/Dest ["+n.objId+" 0 R /XYZ 0 "+this.ctx.pdf.internal.pageSize.height+" 0]")}this.objEnd()}for(var a=0;a<t.children.length;a++){var i=t.children[a];this.renderItems(i)}},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(e){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var r=0;r<t.children.length;r++)e.count++,this.count_r(e,t.children[r]);return e.count}}])}(a.API),function(e){var t=function(){return"function"!=typeof PNG||"function"!=typeof u},r=function(t){return t!==e.image_compression.NONE&&n()},n=function(){var e="function"==typeof l
;if(!e)throw new Error("requires deflate.js for compression");return e},a=function(t,r,n,a){var c=5,u=f;switch(a){case e.image_compression.FAST:c=3,u=$;break;case e.image_compression.MEDIUM:c=6,u=p;break;case e.image_compression.SLOW:c=9,u=d}t=s(t,r,n,u);var h=new Uint8Array(i(c)),_=o(t),g=new l(c),m=g.append(t),y=g.flush(),v=h.length+m.length+y.length,b=new Uint8Array(v+4);return b.set(h),b.set(m,h.length),b.set(y,h.length+m.length),b[v++]=_>>>24&255,b[v++]=_>>>16&255,b[v++]=_>>>8&255,b[v++]=255&_,e.arrayBufferToBinaryString(b)},i=function(e,t){var r=Math.LOG2E*Math.log(32768)-8<<4|8,n=r<<8;return n|=Math.min(3,(t-1&255)>>1)<<6,n|=0,n+=31-n%31,[r,255&n]},o=function(e,t){for(var r,n=1,a=0,i=e.length,o=0;i>0;){i-=r=i>t?t:i;do{a+=n+=e[o++]}while(--r);n%=65521,a%=65521}return(a<<16|n)>>>0},s=function(e,t,r,n){for(var a,i,o,s=e.length/t,l=new Uint8Array(e.length+s),c=_(),u=0;u<s;u++){if(o=u*t,a=e.subarray(o,o+t),n)l.set(n(a,r,i),o+u);else{for(var $=0,f=c.length,p=[];$<f;$++)p[$]=c[$](a,r,i);var d=g(p.concat());l.set(p[d],o+u)}i=a}return l},c=function(e,t,r){var n=Array.apply([],e);return n.unshift(0),n},$=function(e,t,r){var n,a=[],i=0,o=e.length;for(a[0]=1;i<o;i++)n=e[i-t]||0,a[i+1]=e[i]-n+256&255;return a},f=function(e,t,r){var n,a=[],i=0,o=e.length;for(a[0]=2;i<o;i++)n=r&&r[i]||0,a[i+1]=e[i]-n+256&255;return a},p=function(e,t,r){var n,a,i=[],o=0,s=e.length;for(i[0]=3;o<s;o++)n=e[o-t]||0,a=r&&r[o]||0,i[o+1]=e[o]+256-(n+a>>>1)&255;return i},d=function(e,t,r){var n,a,i,o,s=[],l=0,c=e.length;for(s[0]=4;l<c;l++)n=e[l-t]||0,a=r&&r[l]||0,i=r&&r[l-t]||0,o=h(n,a,i),s[l+1]=e[l]-o+256&255;return s},h=function(e,t,r){var n=e+t-r,a=Math.abs(n-e),i=Math.abs(n-t),o=Math.abs(n-r);return a<=i&&a<=o?e:i<=o?t:r},_=function(){return[c,$,f,p,d]},g=function(e){for(var t,r,n,a=0,i=e.length;a<i;)((t=m(e[a].slice(1)))<r||!r)&&(r=t,n=a),a++;return n},m=function(e){for(var t=0,r=e.length,n=0;t<r;)n+=Math.abs(e[t++]);return n},y=function(t){var r;switch(t){case e.image_compression.FAST:r=11;break;case e.image_compression.MEDIUM:r=13;break;case e.image_compression.SLOW:r=14;break;default:r=12}return r};e.processPNG=function(e,n,i,o,s){var l,c,u,$,f,p,d=this.color_spaces.DEVICE_RGB,h=this.decode.FLATE_DECODE,_=8;if(this.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.isArrayBufferView(e)){if(t())throw new Error("PNG support requires png.js and zlib.js");if(l=new PNG(e),e=l.imgData,_=l.bits,d=l.colorSpace,$=l.colors,-1!==[4,6].indexOf(l.colorType)){if(8===l.bits)for(var g,m=(O=32==l.pixelBitlength?new Uint32Array(l.decodePixels().buffer):16==l.pixelBitlength?new Uint16Array(l.decodePixels().buffer):new Uint8Array(l.decodePixels().buffer)).length,v=new Uint8Array(m*l.colors),b=new Uint8Array(m),x=l.pixelBitlength-l.bits,w=0,A=0;w<m;w++){for(k=O[w],g=0;g<x;)v[A++]=k>>>g&255,g+=l.bits;b[w]=k>>>g&255}if(16===l.bits){for(var k,m=(O=new Uint32Array(l.decodePixels().buffer)).length,v=new Uint8Array(m*(32/l.pixelBitlength)*l.colors),b=new Uint8Array(m*(32/l.pixelBitlength)),E=l.colors>1,w=0,A=0,C=0;w<m;)k=O[w++],v[A++]=k>>>0&255,E&&(v[A++]=k>>>16&255,k=O[w++],v[A++]=k>>>0&255),b[C++]=k>>>16&255;_=8}r(o)?(e=a(v,l.width*l.colors,l.colors,o),p=a(b,l.width,1,o)):(e=v,p=b,h=null)}if(3===l.colorType&&(d=this.color_spaces.INDEXED,f=l.palette,l.transparency.indexed)){for(var S=l.transparency.indexed,I=0,w=0,m=S.length;w<m;++w)I+=S[w];if((I/=255)==m-1&&-1!==S.indexOf(0))u=[S.indexOf(0)];else if(I!==m){for(var O=l.decodePixels(),b=new Uint8Array(O.length),w=0,m=O.length;w<m;w++)b[w]=S[O[w]];p=a(b,l.width,1)}}var T=y(o);return c=h===this.decode.FLATE_DECODE?"/Predictor "+T+" /Colors "+$+" /BitsPerComponent "+_+" /Columns "+l.width:"/Colors "+$+" /BitsPerComponent "+_+" /Columns "+l.width,(this.isArrayBuffer(e)||this.isArrayBufferView(e))&&(e=this.arrayBufferToBinaryString(e)),(p&&this.isArrayBuffer(p)||this.isArrayBufferView(p))&&(p=this.arrayBufferToBinaryString(p)),this.createImageInfo(e,l.width,l.height,d,_,h,n,i,c,u,f,p,T)}throw new Error("Unsupported PNG image data, try using JPEG instead.")}}(a.API),a.API.autoPrint=function(){var e;return this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.write("<< /S/Named /Type/Action /N/Print >>","endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.write("/OpenAction "+e+" 0 R")}),this},function(e){var t=e.getCharWidthsArray=function(e,t){t||(t={});var r,n,a,i=t.widths?t.widths:this.internal.getFont().metadata.Unicode.widths,o=i.fof?i.fof:1,s=t.kerning?t.kerning:this.internal.getFont().metadata.Unicode.kerning,l=s.fof?s.fof:1,c=0,u=i[0]||o,$=[];for(r=0,n=e.length;r<n;r++)a=e.charCodeAt(r),$.push((i[a]||u)/o+(s[a]&&s[a][c]||0)/l),c=a;return $},r=function(e){for(var t=e.length,r=0;t;)r+=e[--t];return r},n=e.getStringUnitWidth=function(e,n){return r(t.call(this,e,n))},a=function(e,t,r,n){for(var a=[],i=0,o=e.length,s=0;i!==o&&s+t[i]<r;)s+=t[i],i++;a.push(e.slice(0,i));var l=i;for(s=0;i!==o;)s+t[i]>n&&(a.push(e.slice(l,i)),s=0,l=i),s+=t[i],i++;return l!==i&&a.push(e.slice(l,i)),a},i=function(e,i,o){o||(o={});var s,l,c,u,$,f,p=[],d=[p],h=o.textIndent||0,_=0,g=0,m=e.split(" "),y=t(" ",o)[0];if(f=-1===o.lineIndent?m[0].length+2:o.lineIndent||0){var v=Array(f).join(" "),b=[];m.map(function(e){(e=e.split(/\s*\n/)).length>1?b=b.concat(e.map(function(e,t){return(t&&e.length?"\n":"")+e})):b.push(e[0])}),m=b,f=n(v,o)}for(c=0,u=m.length;c<u;c++){var x=0;if(s=m[c],f&&"\n"==s[0]&&(s=s.substr(1),x=1),l=t(s,o),g=r(l),h+_+g>i||x){if(g>i){for($=a(s,l,i-(h+_),i),p.push($.shift()),p=[$.pop()];$.length;)d.push([$.shift()]);g=r(l.slice(s.length-p[0].length))}else p=[s];d.push(p),h=g+f,_=y}else p.push(s),h+=_+g,_=y}if(f)w=function(e,t){return(t?v:"")+e.join(" ")};else var w=function(e){return e.join(" ")};return d.map(w)};e.splitTextToSize=function(e,t,r){r||(r={});var n,a=r.fontSize||this.internal.getFontSize(),o=function(e){var t={0:1},r={};if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var n=this.internal.getFont(e.fontName,e.fontStyle);return n.metadata.Unicode?{widths:n.metadata.Unicode.widths||t,kerning:n.metadata.Unicode.kerning||r}:{widths:t,kerning:r}}.call(this,r);n=Array.isArray(e)?e:e.split(/\r?\n/);var s=1*this.internal.scaleFactor*t/a;o.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/a:0,o.lineIndent=r.lineIndent;var l,c,u=[];for(l=0,c=n.length;l<c;l++)u=u.concat(i(n[l],s,o));return u}}(a.API),function(e){var t=function(e){for(var t={},r=0;r<"klmnopqrstuvwxyz".length;r++)t["klmnopqrstuvwxyz"[r]]="0123456789abcdef"[r];var n,a,i,o,s={},l=1,c=s,u=[],$="",f="",p=e.length-1;for(r=1;r!=p;)o=e[r],r+=1,"'"==o?n?(i=n.join(""),n=void 0):n=[]:n?n.push(o):"{"==o?(u.push([c,i]),c={},i=void 0):"}"==o?((a=u.pop())[0][a[1]]=c,i=void 0,c=a[0]):"-"==o?l=-1:void 0===i?t.hasOwnProperty(o)?($+=t[o],i=parseInt($,16)*l,l=1,$=""):$+=o:t.hasOwnProperty(o)?(f+=t[o],c[i]=parseInt(f,16)*l,l=1,i=void 0,f=""):f+=o;return s},r={codePages:["WinAnsiEncoding"],WinAnsiEncoding:t("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},n={Unicode:{Courier:r,"Courier-Bold":r,"Courier-BoldOblique":r,"Courier-Oblique":r,Helvetica:r,"Helvetica-Bold":r,"Helvetica-BoldOblique":r,"Helvetica-Oblique":r,"Times-Roman":r,"Times-Bold":r,"Times-BoldItalic":r,"Times-Italic":r}},a={Unicode:{"Courier-Oblique":t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":t("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":t("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":t("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Helvetica:t("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":t("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),"Courier-Bold":t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":t("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":t("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":t("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t,r,i;(t=a.Unicode[e.PostScriptName])&&((r=e.metadata.Unicode?e.metadata.Unicode:e.metadata.Unicode={}).widths=t.widths,r.kerning=t.kerning),(i=n.Unicode[e.PostScriptName])&&((r=e.metadata.Unicode?e.metadata.Unicode:e.metadata.Unicode={}).encoding=i,i.codePages&&i.codePages.length&&(e.encoding=i.codePages[0]))}])}(a.API),a.API.addSVG=function(e,t,r,n,a){function i(e,t){var r=t.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(t.createTextNode(e)),t.getElementsByTagName("head")[0].appendChild(r)}if(void 0===t||void 0===r)throw new Error("addSVG needs values for 'x' and 'y'");var o=function(e,t){var r=(t.contentWindow||t.contentDocument).document;return r.write(e),r.close(),r.getElementsByTagName("svg")[0]}(e,function(e){var t=e.createElement("iframe");return i(".jsPDF_sillysvg_iframe {display:none;position:absolute;}",e),t.name="childframe",t.setAttribute("width",0),t.setAttribute("height",0),t.setAttribute("frameborder","0"),t.setAttribute("scrolling","no"),t.setAttribute("seamless","seamless"),t.setAttribute("class","jsPDF_sillysvg_iframe"),e.body.appendChild(t),t}(document)),s=[1,1],l=parseFloat(o.getAttribute("width")),c=parseFloat(o.getAttribute("height"));l&&c&&(n&&a?s=[n/l,a/c]:n?s=[n/l,n/l]:a&&(s=[a/c,a/c]));var u,$,f,p,d=o.childNodes;for(u=0,$=d.length;u<$;u++)(f=d[u]).tagName&&"PATH"===f.tagName.toUpperCase()&&((p=function(e){for(var t=parseFloat(e[1]),r=parseFloat(e[2]),n=[],a=3,i=e.length;a<i;)"c"===e[a]?(n.push([parseFloat(e[a+1]),parseFloat(e[a+2]),parseFloat(e[a+3]),parseFloat(e[a+4]),parseFloat(e[a+5]),parseFloat(e[a+6])]),a+=7):"l"===e[a]?(n.push([parseFloat(e[a+1]),parseFloat(e[a+2])]),a+=3):a+=1;return[t,r,n]}(f.getAttribute("d").split(" ")))[0]=p[0]*s[0]+t,p[1]=p[1]*s[1]+r,this.lines.call(this,p[2],p[0],p[1],s));return this},a.API.putTotalPages=function(e){for(var t=new RegExp(e,"g"),r=1;r<=this.internal.getNumberOfPages();r++)for(var n=0;n<this.internal.pages[r].length;n++)this.internal.pages[r][n]=this.internal.pages[r][n].replace(t,this.internal.getNumberOfPages());return this},function(e){var t="",r="",n="";a.API.addMetadata=function(e,a){return r=a||"http://jspdf.default.namespaceuri/",t=e,this.internal.events.subscribe("postPutResources",function(){if(t){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+r+'"><jspdf:metadata>',a=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),i=unescape(encodeURIComponent(e)),o=unescape(encodeURIComponent(t)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),l=unescape(encodeURIComponent("</x:xmpmeta>")),c=i.length+o.length+s.length+a.length+l.length;n=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+c+" >>"),this.internal.write("stream"),this.internal.write(a+i+o+s+l),this.internal.write("endstream"),this.internal.write("endobj")}else n=""}),this.internal.events.subscribe("putCatalog",function(){n&&this.internal.write("/Metadata "+n+" 0 R")}),this}}(),function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(e){}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},r=function(){this.data=[]},n=function(e,t,r){this.data=e,this.size=e.length,this.type=t,this.encoding=r},a=r.prototype,i=n.prototype,o=e.FileReaderSync,s=function(e){this.code=this[this.name=e]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,u=e.URL||e.webkitURL||e,$=u.createObjectURL,f=u.revokeObjectURL,p=u,d=e.btoa,h=e.atob,_=e.ArrayBuffer,g=e.Uint8Array,m=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(n.fake=i.fake=!0;c--;)s.prototype[l[c]]=c+1;return u.createObjectURL||(p=e.URL=function(e){var t,r=document.createElementNS("http://www.w3.org/1999/xhtml","a");return r.href=e,"origin"in r||("data:"===r.protocol.toLowerCase()?r.origin=null:(t=e.match(m),r.origin=t&&t[1])),r}),p.createObjectURL=function(e){var t,r=e.type;return null===r&&(r="application/octet-stream"),e instanceof n?(t="data:"+r,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):d?t+";base64,"+d(e.data):t+","+encodeURIComponent(e.data)):$?$.call(u,e):void 0},p.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&f&&f.call(u,e)},a.append=function(e){var r=this.data;if(g&&(e instanceof _||e instanceof g)){for(var a="",i=new g(e),l=0,c=i.length;l<c;l++)a+=String.fromCharCode(i[l]);r.push(a)}else if("Blob"===t(e)||"File"===t(e)){if(!o)throw new s("NOT_READABLE_ERR");var u=new o;r.push(u.readAsBinaryString(e))}else e instanceof n?"base64"===e.encoding&&h?r.push(h(e.data)):"URI"===e.encoding?r.push(decodeURIComponent(e.data)):"raw"===e.encoding&&r.push(e.data):("string"!=typeof e&&(e+=""),r.push(unescape(encodeURIComponent(e))))},a.getBlob=function(e){return arguments.length||(e=null),new n(this.data.join(""),e,"raw")},a.toString=function(){return"[object BlobBuilder]"},i.slice=function(e,t,r){var a=arguments.length;return a<3&&(r=null),new n(this.data.slice(e,a>1?t:this.data.length),r,this.encoding)},i.toString=function(){return"[object Blob]"},i.close=function(){this.size=0,delete this.data},r}(e);e.Blob=function(e,r){var n=r?r.type||"":"",a=new t;if(e)for(var i=0,o=e.length;i<o;i++)Uint8Array&&e[i]instanceof Uint8Array?a.append(e[i].buffer):a.append(e[i]);var s=a.getBlob(n);return!s.slice&&s.webkitSlice&&(s.slice=s.webkitSlice),s};var r=Object.getPrototypeOf||function(e){return e.__proto__};e.Blob.prototype=r(new e.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content||void 0);var o=o||function(e){if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},r=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in r,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/constructor/i.test(e.HTMLElement)||e.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},c=function(e,t,r){for(var n=(t=[].concat(t)).length;n--;){var a=e["on"+t[n]];if("function"==typeof a)try{a.call(e,r||e)}catch(e){s(e)}}},u=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},$=function(s,$,f){f||(s=u(s));var p,d=this,h="application/octet-stream"===s.type,_=function(){c(d,"writestart progress write writeend".split(" "))};if(d.readyState=d.INIT,n)return p=t().createObjectURL(s),void setTimeout(function(){r.href=p,r.download=$,a(r),_(),l(p),d.readyState=d.DONE});!function(){if((o||h&&i)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=o?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,d.readyState=d.DONE,_()},r.readAsDataURL(s),void(d.readyState=d.INIT)}p||(p=t().createObjectURL(s)),h?e.location.href=p:e.open(p,"_blank")||(e.location.href=p),d.readyState=d.DONE,_(),l(p)}()},f=$.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,r){return t=t||e.name||"download",r||(e=u(e)),navigator.msSaveOrOpenBlob(e,t)}:(f.abort=function(){},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,function(e,t,r){return new $(e,t||e.name||"download",r)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);void 0!==t&&t.exports?t.exports.saveAs=o:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return o}),function(e,r){"object"==typeof t?t.exports=r():"function"==typeof define?define(r):e.adler32cs=r()}(a,function(){var e="function"==typeof ArrayBuffer&&"function"==typeof Uint8Array,t=null,r=function(){if(!e)return function(){return!1};try{var r={};"function"==typeof r.Buffer&&(t=r.Buffer)}catch(e){}return function(e){return e instanceof ArrayBuffer||null!==t&&e instanceof t}}(),n=null!==t?function(e){return new t(e,"utf8").toString("binary")}:function(e){return unescape(encodeURIComponent(e))},a=function(e,t){for(var r=65535&e,n=e>>>16,a=0,i=t.length;a<i;a++)n=(n+(r=(r+(255&t.charCodeAt(a)))%65521))%65521;return(n<<16|r)>>>0},i=function(e,t){for(var r=65535&e,n=e>>>16,a=0,i=t.length;a<i;a++)n=(n+(r=(r+t[a])%65521))%65521;return(n<<16|r)>>>0},o={},s=o.Adler32=function(){var t=function(e){if(!(this instanceof t))throw new TypeError("Constructor cannot called be as a function.");if(!isFinite(e=null==e?1:+e))throw new Error("First arguments needs to be a finite number.");this.checksum=e>>>0},o=t.prototype={};return o.constructor=t,t.from=function(e){return e.prototype=o,e}(function(e){if(!(this instanceof t))throw new TypeError("Constructor cannot called be as a function.");if(null==e)throw new Error("First argument needs to be a string.");this.checksum=a(1,e.toString())}),t.fromUtf8=function(e){return e.prototype=o,e}(function(e){if(!(this instanceof t))throw new TypeError("Constructor cannot called be as a function.");if(null==e)throw new Error("First argument needs to be a string.");var r=n(e.toString());this.checksum=a(1,r)}),e&&(t.fromBuffer=function(e){return e.prototype=o,e}(function(e){if(!(this instanceof t))throw new TypeError("Constructor cannot called be as a function.");if(!r(e))throw new Error("First argument needs to be ArrayBuffer.");var n=new Uint8Array(e);return this.checksum=i(1,n)})),o.update=function(e){if(null==e)throw new Error("First argument needs to be a string.");return e=e.toString(),this.checksum=a(this.checksum,e)},o.updateUtf8=function(e){if(null==e)throw new Error("First argument needs to be a string.");var t=n(e.toString());return this.checksum=a(this.checksum,t)},e&&(o.updateBuffer=function(e){if(!r(e))throw new Error("First argument needs to be ArrayBuffer.")
;var t=new Uint8Array(e);return this.checksum=i(this.checksum,t)}),o.clone=function(){return new s(this.checksum)},t}();return o.from=function(e){if(null==e)throw new Error("First argument needs to be a string.");return a(1,e.toString())},o.fromUtf8=function(e){if(null==e)throw new Error("First argument needs to be a string.");var t=n(e.toString());return a(1,t)},e&&(o.fromBuffer=function(e){if(!r(e))throw new Error("First argument need to be ArrayBuffer.");var t=new Uint8Array(e);return i(1,t)}),o});var s={};s._colorsTable={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},s.colorNameToHex=function(e){return e=e.toLowerCase(),void 0!==this._colorsTable[e]&&this._colorsTable[e]};var l=function(e){function t(){function e(e){var t,r,a,i,o,l,c=n.dyn_tree,u=n.stat_desc.static_tree,$=n.stat_desc.extra_bits,p=n.stat_desc.extra_base,d=n.stat_desc.max_length,h=0;for(i=0;i<=s;i++)e.bl_count[i]=0;for(c[2*e.heap[e.heap_max]+1]=0,t=e.heap_max+1;t<f;t++)(i=c[2*c[2*(r=e.heap[t])+1]+1]+1)>d&&(i=d,h++),c[2*r+1]=i,r>n.max_code||(e.bl_count[i]++,o=0,r>=p&&(o=$[r-p]),l=c[2*r],e.opt_len+=l*(i+o),u&&(e.static_len+=l*(u[2*r+1]+o)));if(0!==h){do{for(i=d-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[d]--,h-=2}while(h>0);for(i=d;0!==i;i--)for(r=e.bl_count[i];0!==r;)(a=e.heap[--t])>n.max_code||(c[2*a+1]!=i&&(e.opt_len+=(i-c[2*a+1])*c[2*a],c[2*a+1]=i),r--)}}function t(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function r(e,r,n){var a,i,o,l=[],c=0;for(a=1;a<=s;a++)l[a]=c=c+n[a-1]<<1;for(i=0;i<=r;i++)0!==(o=e[2*i+1])&&(e[2*i]=t(l[o]++,o))}var n=this;n.build_tree=function(t){var a,i,o,s=n.dyn_tree,l=n.stat_desc.static_tree,c=n.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=f,a=0;a<c;a++)0!==s[2*a]?(t.heap[++t.heap_len]=u=a,t.depth[a]=0):s[2*a+1]=0;for(;t.heap_len<2;)s[2*(o=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[o]=0,t.opt_len--,l&&(t.static_len-=l[2*o+1]);for(n.max_code=u,a=Math.floor(t.heap_len/2);a>=1;a--)t.pqdownheap(s,a);o=c;do{a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],t.pqdownheap(s,1),i=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=i,s[2*o]=s[2*a]+s[2*i],t.depth[o]=Math.max(t.depth[a],t.depth[i])+1,s[2*a+1]=s[2*i+1]=o,t.heap[1]=o++,t.pqdownheap(s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],e(t),r(s,n.max_code,t.bl_count)}}function r(e,t,r,n,a){var i=this;i.static_tree=e,i.extra_bits=t,i.extra_base=r,i.elems=n,i.max_length=a}function n(e,t,r,n,a){var i=this;i.good_length=e,i.max_lazy=t,i.nice_length=r,i.max_chain=n,i.func=a}function a(e,t,r,n){var a=e[2*t],i=e[2*r];return a<i||a==i&&n[t]<=n[r]}function i(){function e(){var e;for(Ie=2*ke,Te[Me-1]=0,e=0;e<Me-1;e++)Te[e]=0;Ye=F[Qe].max_lazy,Xe=F[Qe].good_length,We=F[Qe].nice_length,Ge=F[Qe].max_chain,ze=0,je=0,Ue=0,Fe=He=K-1,Le=0,Pe=0}function n(){var e;for(e=0;e<$;e++)Je[2*e]=0;for(e=0;e<l;e++)Ke[2*e]=0;for(e=0;e<c;e++)Ze[2*e]=0;Je[2*p]=1,et.opt_len=et.static_len=0,ot=lt=0}function i(){tt.dyn_tree=Je,tt.stat_desc=r.static_l_desc,rt.dyn_tree=Ke,rt.stat_desc=r.static_d_desc,nt.dyn_tree=Ze,nt.stat_desc=r.static_bl_desc,ut=0,$t=0,ct=8,n()}function o(e,t){var r,n,a=-1,i=e[1],o=0,s=7,l=4;for(0===i&&(s=138,l=3),e[2*(t+1)+1]=65535,r=0;r<=t;r++)n=i,i=e[2*(r+1)+1],++o<s&&n==i||(o<l?Ze[2*n]+=o:0!==n?(n!=a&&Ze[2*n]++,Ze[2*d]++):o<=10?Ze[2*h]++:Ze[2*_]++,o=0,a=n,0===i?(s=138,l=3):n==i?(s=6,l=3):(s=7,l=4))}function s(){var e;for(o(Je,tt.max_code),o(Ke,rt.max_code),nt.build_tree(et),e=c-1;e>=3&&0===Ze[2*t.bl_order[e]+1];e--);return et.opt_len+=3*(e+1)+5+5+4,e}function f(e){et.pending_buf[et.pending++]=e}function P(e){f(255&e),f(e>>>8&255)}function te(e){f(e>>8&255),f(255&e)}function re(e,t){var r,n=t;$t>g-n?(P(ut|=(r=e)<<$t&65535),ut=r>>>g-$t,$t+=n-g):(ut|=e<<$t&65535,$t+=n)}function ne(e,t){var r=2*e;re(65535&t[r],65535&t[r+1])}function ae(e,t){var r,n,a=-1,i=e[1],o=0,s=7,l=4;for(0===i&&(s=138,l=3),r=0;r<=t;r++)if(n=i,i=e[2*(r+1)+1],!(++o<s&&n==i)){if(o<l)do{ne(n,Ze)}while(0!=--o);else 0!==n?(n!=a&&(ne(n,Ze),o--),ne(d,Ze),re(o-3,2)):o<=10?(ne(h,Ze),re(o-3,3)):(ne(_,Ze),re(o-11,7));o=0,a=n,0===i?(s=138,l=3):n==i?(s=6,l=3):(s=7,l=4)}}function ie(e,r,n){var a;for(re(e-257,5),re(r-1,5),re(n-4,4),a=0;a<n;a++)re(Ze[2*t.bl_order[a]+1],3);ae(Je,e-1),ae(Ke,r-1)}function oe(){16==$t?(P(ut),ut=0,$t=0):$t>=8&&(f(255&ut),ut>>>=8,$t-=8)}function se(){re(W<<1,3),ne(p,r.static_ltree),oe(),1+ct+10-$t<9&&(re(W<<1,3),ne(p,r.static_ltree),oe()),ct=7}function le(e,r){var n,a,i;if(et.pending_buf[st+2*ot]=e>>>8&255,et.pending_buf[st+2*ot+1]=255&e,et.pending_buf[at+ot]=255&r,ot++,0===e?Je[2*r]++:(lt++,e--,Je[2*(t._length_code[r]+u+1)]++,Ke[2*t.d_code(e)]++),0==(8191&ot)&&Qe>2){for(n=8*ot,a=ze-je,i=0;i<l;i++)n+=Ke[2*i]*(5+t.extra_dbits[i]);if(n>>>=3,lt<Math.floor(ot/2)&&n<Math.floor(a/2))return!0}return ot==it-1}function ce(e,r){var n,a,i,o,s=0;if(0!==ot)do{n=et.pending_buf[st+2*s]<<8&65280|255&et.pending_buf[st+2*s+1],a=255&et.pending_buf[at+s],s++,0===n?ne(a,e):(ne((i=t._length_code[a])+u+1,e),0!==(o=t.extra_lbits[i])&&re(a-=t.base_length[i],o),n--,ne(i=t.d_code(n),r),0!==(o=t.extra_dbits[i])&&re(n-=t.base_dist[i],o))}while(s<ot);ne(p,e),ct=e[2*p+1]}function ue(){$t>8?P(ut):$t>0&&f(255&ut),ut=0,$t=0}function $e(e,t,r){ue(),ct=8,r&&(P(t),P(~t)),et.pending_buf.set(Se.subarray(e,e+t),et.pending),et.pending+=t}function fe(e,t,r){re((X<<1)+(r?1:0),3),$e(e,t,!0)}function pe(e,t,a){var i,o,l=0;Qe>0?(tt.build_tree(et),rt.build_tree(et),l=s(),i=et.opt_len+3+7>>>3,(o=et.static_len+3+7>>>3)<=i&&(i=o)):i=o=t+5,t+4<=i&&-1!=e?fe(e,t,a):o==i?(re((W<<1)+(a?1:0),3),ce(r.static_ltree,r.static_dtree)):(re((J<<1)+(a?1:0),3),ie(tt.max_code+1,rt.max_code+1,l+1),ce(Je,Ke)),n(),a&&ue()}function de(e){pe(je>=0?je:-1,ze-je,e),je=ze,be.flush_pending()}function he(){var e,t,r,n;do{if(0==(n=Ie-Ue-ze)&&0===ze&&0===Ue)n=ke;else if(-1==n)n--;else if(ze>=ke+ke-ee){Se.set(Se.subarray(ke,ke+ke),0),qe-=ke,ze-=ke,je-=ke,r=e=Me;do{t=65535&Te[--r],Te[r]=t>=ke?t-ke:0}while(0!=--e);r=e=ke;do{t=65535&Oe[--r],Oe[r]=t>=ke?t-ke:0}while(0!=--e);n+=ke}if(0===be.avail_in)return;e=be.read_buf(Se,ze+Ue,n),(Ue+=e)>=K&&(Pe=255&Se[ze],Pe=(Pe<<Re^255&Se[ze+1])&Be)}while(Ue<ee&&0!==be.avail_in)}function _e(e){var t,r=65535;for(r>we-5&&(r=we-5);;){if(Ue<=1){if(he(),0===Ue&&e==x)return L;if(0===Ue)break}if(ze+=Ue,Ue=0,t=je+r,(0===ze||ze>=t)&&(Ue=ze-t,ze=t,de(!1),0===be.avail_out))return L;if(ze-je>=ke-ee&&(de(!1),0===be.avail_out))return L}return de(e==k),0===be.avail_out?e==k?q:L:e==k?U:z}function ge(e){var t,r,n=Ge,a=ze,i=He,o=ze>ke-ee?ze-(ke-ee):0,s=We,l=Ce,c=ze+Z,u=Se[a+i-1],$=Se[a+i];He>=Xe&&(n>>=2),s>Ue&&(s=Ue);do{if(t=e,Se[t+i]==$&&Se[t+i-1]==u&&Se[t]==Se[a]&&Se[++t]==Se[a+1]){a+=2,t++;do{}while(Se[++a]==Se[++t]&&Se[++a]==Se[++t]&&Se[++a]==Se[++t]&&Se[++a]==Se[++t]&&Se[++a]==Se[++t]&&Se[++a]==Se[++t]&&Se[++a]==Se[++t]&&Se[++a]==Se[++t]&&a<c);if(r=Z-(c-a),a=c-Z,r>i){if(qe=e,i=r,r>=s)break;u=Se[a+i-1],$=Se[a+i]}}}while((e=65535&Oe[e&l])>o&&0!=--n);return i<=Ue?i:Ue}function me(e){for(var t,r=0;;){if(Ue<ee){if(he(),Ue<ee&&e==x)return L;if(0===Ue)break}if(Ue>=K&&(Pe=(Pe<<Re^255&Se[ze+(K-1)])&Be,r=65535&Te[Pe],Oe[ze&Ce]=Te[Pe],Te[Pe]=ze),0!==r&&(ze-r&65535)<=ke-ee&&Ve!=v&&(Fe=ge(r)),Fe>=K)if(t=le(ze-qe,Fe-K),Ue-=Fe,Fe<=Ye&&Ue>=K){Fe--;do{Pe=(Pe<<Re^255&Se[++ze+(K-1)])&Be,r=65535&Te[Pe],Oe[ze&Ce]=Te[Pe],Te[Pe]=ze}while(0!=--Fe);ze++}else ze+=Fe,Fe=0,Pe=255&Se[ze],Pe=(Pe<<Re^255&Se[ze+1])&Be;else t=le(0,255&Se[ze]),Ue--,ze++;if(t&&(de(!1),0===be.avail_out))return L}return de(e==k),0===be.avail_out?e==k?q:L:e==k?U:z}function ye(e){for(var t,r,n=0;;){if(Ue<ee){if(he(),Ue<ee&&e==x)return L;if(0===Ue)break}if(Ue>=K&&(Pe=(Pe<<Re^255&Se[ze+(K-1)])&Be,n=65535&Te[Pe],Oe[ze&Ce]=Te[Pe],Te[Pe]=ze),He=Fe,De=qe,Fe=K-1,0!==n&&He<Ye&&(ze-n&65535)<=ke-ee&&(Ve!=v&&(Fe=ge(n)),Fe<=5&&(Ve==y||Fe==K&&ze-qe>4096)&&(Fe=K-1)),He>=K&&Fe<=He){r=ze+Ue-K,t=le(ze-1-De,He-K),Ue-=He-1,He-=2;do{++ze<=r&&(Pe=(Pe<<Re^255&Se[ze+(K-1)])&Be,n=65535&Te[Pe],Oe[ze&Ce]=Te[Pe],Te[Pe]=ze)}while(0!=--He);if(Le=0,Fe=K-1,ze++,t&&(de(!1),0===be.avail_out))return L}else if(0!==Le){if((t=le(0,255&Se[ze-1]))&&de(!1),ze++,Ue--,0===be.avail_out)return L}else Le=1,ze++,Ue--}return 0!==Le&&(t=le(0,255&Se[ze-1]),Le=0),de(e==k),0===be.avail_out?e==k?q:L:e==k?U:z}function ve(t){return t.total_in=t.total_out=0,t.msg=null,et.pending=0,et.pending_out=0,xe=Y,Ae=x,i(),e(),E}var be,xe,we,Ae,ke,Ee,Ce,Se,Ie,Oe,Te,Pe,Me,Ne,Be,Re,je,Fe,De,Le,ze,qe,Ue,He,Ge,Ye,Qe,Ve,Xe,We,Je,Ke,Ze,et=this,tt=new t,rt=new t,nt=new t;et.depth=[];var at,it,ot,st,lt,ct,ut,$t;et.bl_count=[],et.heap=[],Je=[],Ke=[],Ze=[],et.pqdownheap=function(e,t){for(var r=et.heap,n=r[t],i=t<<1;i<=et.heap_len&&(i<et.heap_len&&a(e,r[i+1],r[i],et.depth)&&i++,!a(e,n,r[i],et.depth));)r[t]=r[i],t=i,i<<=1;r[t]=n},et.deflateInit=function(e,t,r,n,a,i){return n||(n=V),a||(a=N),i||(i=b),e.msg=null,t==m&&(t=6),a<1||a>M||n!=V||r<9||r>15||t<0||t>9||i<0||i>v?I:(e.dstate=et,Ee=r,ke=1<<Ee,Ce=ke-1,Ne=a+7,Me=1<<Ne,Be=Me-1,Re=Math.floor((Ne+K-1)/K),Se=new Uint8Array(2*ke),Oe=[],Te=[],it=1<<a+6,et.pending_buf=new Uint8Array(4*it),we=4*it,st=Math.floor(it/2),at=3*it,Qe=t,Ve=i,ve(e))},et.deflateEnd=function(){return xe!=G&&xe!=Y&&xe!=Q?I:(et.pending_buf=null,Te=null,Oe=null,Se=null,et.dstate=null,xe==Y?O:E)},et.deflateParams=function(e,t,r){var n=E;return t==m&&(t=6),t<0||t>9||r<0||r>v?I:(F[Qe].func!=F[t].func&&0!==e.total_in&&(n=e.deflate(w)),Qe!=t&&(Ye=F[Qe=t].max_lazy,Xe=F[Qe].good_length,We=F[Qe].nice_length,Ge=F[Qe].max_chain),Ve=r,n)},et.deflateSetDictionary=function(e,t,r){var n,a=r,i=0;if(!t||xe!=G)return I;if(a<K)return E;for(a>ke-ee&&(i=r-(a=ke-ee)),Se.set(t.subarray(i,i+a),0),ze=a,je=a,Pe=255&Se[0],Pe=(Pe<<Re^255&Se[1])&Be,n=0;n<=a-K;n++)Pe=(Pe<<Re^255&Se[n+(K-1)])&Be,Oe[n&Ce]=Te[Pe],Te[Pe]=n;return E},et.deflate=function(e,t){var r,n,a,i,o;if(t>k||t<0)return I;if(!e.next_out||!e.next_in&&0!==e.avail_in||xe==Q&&t!=k)return e.msg=D[S-I],I;if(0===e.avail_out)return e.msg=D[S-T],T;if(be=e,i=Ae,Ae=t,xe==G&&(n=V+(Ee-8<<4)<<8,(a=(Qe-1&255)>>1)>3&&(a=3),n|=a<<6,0!==ze&&(n|=H),xe=Y,te(n+=31-n%31)),0!==et.pending){if(be.flush_pending(),0===be.avail_out)return Ae=-1,E}else if(0===be.avail_in&&t<=i&&t!=k)return be.msg=D[S-T],T;if(xe==Q&&0!==be.avail_in)return e.msg=D[S-T],T;if(0!==be.avail_in||0!==Ue||t!=x&&xe!=Q){switch(o=-1,F[Qe].func){case B:o=_e(t);break;case R:o=me(t);break;case j:o=ye(t)}if(o!=q&&o!=U||(xe=Q),o==L||o==q)return 0===be.avail_out&&(Ae=-1),E;if(o==z){if(t==w)se();else if(fe(0,0,!1),t==A)for(r=0;r<Me;r++)Te[r]=0;if(be.flush_pending(),0===be.avail_out)return Ae=-1,E}}return t!=k?E:C}}function o(){var e=this;e.next_in_index=0,e.next_out_index=0,e.avail_in=0,e.total_in=0,e.avail_out=0,e.total_out=0}var s=15,l=30,c=19,u=256,$=u+1+29,f=2*$+1,p=256,d=16,h=17,_=18,g=16,m=-1,y=1,v=2,b=0,x=0,w=1,A=3,k=4,E=0,C=1,S=2,I=-2,O=-3,T=-5,P=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29];t._length_code=[0,1,2,3,4,5,6,7,8,8,9,9,10,10,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28],t.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],t.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],t.d_code=function(e){return e<256?P[e]:P[256+(e>>>7)]},t.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],t.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],t.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],t.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],r.static_ltree=[12,8,140,8,76,8,204,8,44,8,172,8,108,8,236,8,28,8,156,8,92,8,220,8,60,8,188,8,124,8,252,8,2,8,130,8,66,8,194,8,34,8,162,8,98,8,226,8,18,8,146,8,82,8,210,8,50,8,178,8,114,8,242,8,10,8,138,8,74,8,202,8,42,8,170,8,106,8,234,8,26,8,154,8,90,8,218,8,58,8,186,8,122,8,250,8,6,8,134,8,70,8,198,8,38,8,166,8,102,8,230,8,22,8,150,8,86,8,214,8,54,8,182,8,118,8,246,8,14,8,142,8,78,8,206,8,46,8,174,8,110,8,238,8,30,8,158,8,94,8,222,8,62,8,190,8,126,8,254,8,1,8,129,8,65,8,193,8,33,8,161,8,97,8,225,8,17,8,145,8,81,8,209,8,49,8,177,8,113,8,241,8,9,8,137,8,73,8,201,8,41,8,169,8,105,8,233,8,25,8,153,8,89,8,217,8,57,8,185,8,121,8,249,8,5,8,133,8,69,8,197,8,37,8,165,8,101,8,229,8,21,8,149,8,85,8,213,8,53,8,181,8,117,8,245,8,13,8,141,8,77,8,205,8,45,8,173,8,109,8,237,8,29,8,157,8,93,8,221,8,61,8,189,8,125,8,253,8,19,9,275,9,147,9,403,9,83,9,339,9,211,9,467,9,51,9,307,9,179,9,435,9,115,9,371,9,243,9,499,9,11,9,267,9,139,9,395,9,75,9,331,9,203,9,459,9,43,9,299,9,171,9,427,9,107,9,363,9,235,9,491,9,27,9,283,9,155,9,411,9,91,9,347,9,219,9,475,9,59,9,315,9,187,9,443,9,123,9,379,9,251,9,507,9,7,9,263,9,135,9,391,9,71,9,327,9,199,9,455,9,39,9,295,9,167,9,423,9,103,9,359,9,231,9,487,9,23,9,279,9,151,9,407,9,87,9,343,9,215,9,471,9,55,9,311,9,183,9,439,9,119,9,375,9,247,9,503,9,15,9,271,9,143,9,399,9,79,9,335,9,207,9,463,9,47,9,303,9,175,9,431,9,111,9,367,9,239,9,495,9,31,9,287,9,159,9,415,9,95,9,351,9,223,9,479,9,63,9,319,9,191,9,447,9,127,9,383,9,255,9,511,9,0,7,64,7,32,7,96,7,16,7,80,7,48,7,112,7,8,7,72,7,40,7,104,7,24,7,88,7,56,7,120,7,4,7,68,7,36,7,100,7,20,7,84,7,52,7,116,7,3,8,131,8,67,8,195,8,35,8,163,8,99,8,227,8],r.static_dtree=[0,5,16,5,8,5,24,5,4,5,20,5,12,5,28,5,2,5,18,5,10,5,26,5,6,5,22,5,14,5,30,5,1,5,17,5,9,5,25,5,5,5,21,5,13,5,29,5,3,5,19,5,11,5,27,5,7,5,23,5],r.static_l_desc=new r(r.static_ltree,t.extra_lbits,u+1,$,s),r.static_d_desc=new r(r.static_dtree,t.extra_dbits,0,l,s),r.static_bl_desc=new r(null,t.extra_blbits,0,c,7);var M=9,N=8,B=0,R=1,j=2,F=[new n(0,0,0,0,B),new n(4,4,8,4,R),new n(4,5,16,8,R),new n(4,6,32,32,R),new n(4,4,16,16,j),new n(8,16,32,32,j),new n(8,16,128,128,j),new n(8,32,128,256,j),new n(32,128,258,1024,j),new n(32,258,258,4096,j)],D=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],L=0,z=1,q=2,U=3,H=32,G=42,Y=113,Q=666,V=8,X=0,W=1,J=2,K=3,Z=258,ee=Z+K+1;return o.prototype={deflateInit:function(e,t){var r=this;return r.dstate=new i,t||(t=s),r.dstate.deflateInit(r,e,t)},deflate:function(e){var t=this;return t.dstate?t.dstate.deflate(t,e):I},deflateEnd:function(){var e=this;if(!e.dstate)return I;var t=e.dstate.deflateEnd();return e.dstate=null,t},deflateParams:function(e,t){var r=this;return r.dstate?r.dstate.deflateParams(r,e,t):I},deflateSetDictionary:function(e,t){var r=this;return r.dstate?r.dstate.deflateSetDictionary(r,e,t):I},read_buf:function(e,t,r){var n=this,a=n.avail_in;return a>r&&(a=r),0===a?0:(n.avail_in-=a,e.set(n.next_in.subarray(n.next_in_index,n.next_in_index+a),t),n.next_in_index+=a,n.total_in+=a,a)},flush_pending:function(){var e=this,t=e.dstate.pending;t>e.avail_out&&(t=e.avail_out),0!==t&&(e.next_out.set(e.dstate.pending_buf.subarray(e.dstate.pending_out,e.dstate.pending_out+t),e.next_out_index),e.next_out_index+=t,e.dstate.pending_out+=t,e.total_out+=t,e.avail_out-=t,e.dstate.pending-=t,0===e.dstate.pending&&(e.dstate.pending_out=0))}},function(e){var t=this,r=new o,n=x,a=new Uint8Array(512);void 0===e&&(e=m),r.deflateInit(e),r.next_out=a,t.append=function(e,t){var i,o=[],s=0,l=0,c=0;if(e.length){r.next_in_index=0,r.next_in=e,r.avail_in=e.length;do{if(r.next_out_index=0,r.avail_out=512,r.deflate(n)!=E)throw"deflating: "+r.msg;r.next_out_index&&(512==r.next_out_index?o.push(new Uint8Array(a)):o.push(new Uint8Array(a.subarray(0,r.next_out_index)))),c+=r.next_out_index,t&&r.next_in_index>0&&r.next_in_index!=s&&(t(r.next_in_index),s=r.next_in_index)}while(r.avail_in>0||0===r.avail_out);return i=new Uint8Array(c),o.forEach(function(e){i.set(e,l),l+=e.length}),i}},t.flush=function(){var e,t,n=[],i=0,o=0;do{if(r.next_out_index=0,r.avail_out=512,(e=r.deflate(k))!=C&&e!=E)throw"deflating: "+r.msg;512-r.avail_out>0&&n.push(new Uint8Array(a.subarray(0,r.next_out_index))),o+=r.next_out_index}while(r.avail_in>0||0===r.avail_out);return r.deflateEnd(),t=new Uint8Array(o),n.forEach(function(e){t.set(e,i),i+=e.length}),t}}}();!function(e){if("object"==typeof r&&void 0!==t)t.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.html2canvas=e()}}(function(){return function t(r,n,a){function i(s,l){if(!n[s]){if(!r[s]){var c="function"==typeof e&&e;if(!l&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var $=n[s]={exports:{}};r[s][0].call($.exports,function(e){return i(r[s][1][e]||e)},$,$.exports,t,r,n,a)}return n[s].exports}for(var o="function"==typeof e&&e,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(e,t,r){(function(e){!function(n){function a(e){throw RangeError(T[e])}function i(e,t){for(var r=e.length;r--;)e[r]=t(e[r]);return e}function o(e,t){return i(e.split(O),t).join(".")}function s(e){for(var t,r,n=[],a=0,i=e.length;a<i;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<i?56320==(64512&(r=e.charCodeAt(a++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),a--):n.push(t);return n}function l(e){return i(e,function(e){var t="";return e>65535&&(t+=N((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=N(e)}).join("")}function c(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:v}function u(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function $(e,t,r){var n=0;for(e=r?M(e/A):e>>1,e+=M(e/t);e>P*x>>1;n+=v)e=M(e/P);return M(n+(P+1)*e/(e+w))}function f(e){var t,r,n,i,o,s,u,f,p,d,h=[],_=e.length,g=0,m=E,w=k;for((r=e.lastIndexOf(C))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&a("not-basic"),h.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<_;){for(o=g,s=1,u=v;i>=_&&a("invalid-input"),((f=c(e.charCodeAt(i++)))>=v||f>M((y-g)/s))&&a("overflow"),g+=f*s,p=u<=w?b:u>=w+x?x:u-w,!(f<p);u+=v)s>M(y/(d=v-p))&&a("overflow"),s*=d;w=$(g-o,t=h.length+1,0==o),M(g/t)>y-m&&a("overflow"),m+=M(g/t),g%=t,h.splice(g++,0,m)}return l(h)}function p(e){var t,r,n,i,o,l,c,f,p,d,h,_,g,m,w,A=[];for(_=(e=s(e)).length,t=E,r=0,o=k,l=0;l<_;++l)(h=e[l])<128&&A.push(N(h));for(n=i=A.length,i&&A.push(C);n<_;){for(c=y,l=0;l<_;++l)(h=e[l])>=t&&h<c&&(c=h);for(c-t>M((y-r)/(g=n+1))&&a("overflow"),r+=(c-t)*g,t=c,l=0;l<_;++l)if((h=e[l])<t&&++r>y&&a("overflow"),h==t){for(f=r,p=v;d=p<=o?b:p>=o+x?x:p-o,!(f<d);p+=v)w=f-d,m=v-d,A.push(N(u(d+w%m,0))),f=M(w/m);A.push(N(u(f,0))),o=$(r,g,n==i),r=0,++n}++r,++t}return A.join("")}var d="object"==typeof r&&r,h="object"==typeof t&&t&&t.exports==d&&t,_="object"==typeof e&&e;_.global!==_&&_.window!==_||(n=_);var g,m,y=2147483647,v=36,b=1,x=26,w=38,A=700,k=72,E=128,C="-",S=/^xn--/,I=/[^ -~]/,O=/\x2E|\u3002|\uFF0E|\uFF61/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},P=v-b,M=Math.floor,N=String.fromCharCode;if(g={version:"1.2.4",ucs2:{decode:s,encode:l},decode:f,encode:p,toASCII:function(e){return o(e,function(e){return I.test(e)?"xn--"+p(e):e})},toUnicode:function(e){return o(e,function(e){return S.test(e)?f(e.slice(4).toLowerCase()):e})}},d&&!d.nodeType)if(h)h.exports=g;else for(m in g)g.hasOwnProperty(m)&&(d[m]=g[m]);else n.punycode=g}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){function n(e,t,r){!e.defaultView||t===e.defaultView.pageXOffset&&r===e.defaultView.pageYOffset||e.defaultView.scrollTo(t,r)}function a(e,t){try{t&&(t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e.getContext("2d").getImageData(0,0,e.width,e.height),0,0))}catch(t){s("Unable to copy canvas content from",e,t)}}function i(e,t){for(var r=3===e.nodeType?document.createTextNode(e.nodeValue):e.cloneNode(!1),n=e.firstChild;n;)!0!==t&&1===n.nodeType&&"SCRIPT"===n.nodeName||r.appendChild(i(n,t)),n=n.nextSibling;return 1===e.nodeType&&(r._scrollTop=e.scrollTop,r._scrollLeft=e.scrollLeft,"CANVAS"===e.nodeName?a(e,r):"TEXTAREA"!==e.nodeName&&"SELECT"!==e.nodeName||(r.value=e.value)),r}function o(e){if(1===e.nodeType){e.scrollTop=e._scrollTop,e.scrollLeft=e._scrollLeft;for(var t=e.firstChild;t;)o(t),t=t.nextSibling}}var s=e("./log");t.exports=function(e,t,r,a,s,l,c){var u=i(e.documentElement,s.javascriptEnabled),$=t.createElement("iframe");return $.className="html2canvas-container",$.style.visibility="hidden",$.style.position="fixed",$.style.left="-10000px",$.style.top="0px",$.style.border="0",$.width=r,$.height=a,$.scrolling="no",t.body.appendChild($),new Promise(function(t){var r=$.contentWindow.document;$.contentWindow.onload=$.onload=function(){var e=setInterval(function(){r.body.childNodes.length>0&&(o(r.documentElement),clearInterval(e),"view"===s.type&&($.contentWindow.scrollTo(l,c),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||$.contentWindow.scrollY===c&&$.contentWindow.scrollX===l||(r.documentElement.style.top=-c+"px",r.documentElement.style.left=-l+"px",r.documentElement.style.position="absolute")),t($))},50)},r.open(),r.write("<!DOCTYPE html><html></html>"),n(e,l,c),r.replaceChild(r.adoptNode(u),r.documentElement),r.close()})}},{"./log":13}],3:[function(e,t,r){function n(e){this.r=0,this.g=0,this.b=0,this.a=null,this.fromArray(e)||this.namedColor(e)||this.rgb(e)||this.rgba(e)||this.hex6(e)||this.hex3(e)}n.prototype.darken=function(e){var t=1-e;return new n([Math.round(this.r*t),Math.round(this.g*t),Math.round(this.b*t),this.a])},n.prototype.isTransparent=function(){return 0===this.a},n.prototype.isBlack=function(){return 0===this.r&&0===this.g&&0===this.b},n.prototype.fromArray=function(e){return Array.isArray(e)&&(this.r=Math.min(e[0],255),this.g=Math.min(e[1],255),this.b=Math.min(e[2],255),e.length>3&&(this.a=e[3])),Array.isArray(e)};var a=/^#([a-f0-9]{3})$/i;n.prototype.hex3=function(e){var t=null;return null!==(t=e.match(a))&&(this.r=parseInt(t[1][0]+t[1][0],16),this.g=parseInt(t[1][1]+t[1][1],16),this.b=parseInt(t[1][2]+t[1][2],16)),null!==t};var i=/^#([a-f0-9]{6})$/i;n.prototype.hex6=function(e){var t=null;return null!==(t=e.match(i))&&(this.r=parseInt(t[1].substring(0,2),16),this.g=parseInt(t[1].substring(2,4),16),this.b=parseInt(t[1].substring(4,6),16)),null!==t};var o=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/;n.prototype.rgb=function(e){var t=null;return null!==(t=e.match(o))&&(this.r=Number(t[1]),this.g=Number(t[2]),this.b=Number(t[3])),null!==t};var s=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?\.?\d+)\s*\)$/;n.prototype.rgba=function(e){var t=null;return null!==(t=e.match(s))&&(this.r=Number(t[1]),this.g=Number(t[2]),this.b=Number(t[3]),this.a=Number(t[4])),null!==t},n.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join(",")+")":"rgb("+[this.r,this.g,this.b].join(",")+")"},n.prototype.namedColor=function(e){e=e.toLowerCase();var t=l[e];if(t)this.r=t[0],this.g=t[1],this.b=t[2];else if("transparent"===e)return this.r=this.g=this.b=this.a=0,!0;return!!t},n.prototype.isColor=!0;var l={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};t.exports=n},{}],4:[function(e,t,r){function n(e,t){var r=x++;if((t=t||{}).logging&&(_.options.logging=!0,_.options.start=Date.now()),t.async=void 0===t.async||t.async,t.allowTaint=void 0!==t.allowTaint&&t.allowTaint,t.removeContainer=void 0===t.removeContainer||t.removeContainer,t.javascriptEnabled=void 0!==t.javascriptEnabled&&t.javascriptEnabled,t.imageTimeout=void 0===t.imageTimeout?1e4:t.imageTimeout,t.renderer="function"==typeof t.renderer?t.renderer:f,t.strict=!!t.strict,"string"==typeof e){if("string"!=typeof t.proxy)return Promise.reject("Proxy must be used when rendering url");var n=null!=t.width?t.width:window.innerWidth,o=null!=t.height?t.height:window.innerHeight;return y(u(e),t.proxy,document,n,o,t).then(function(e){return i(e.contentWindow.document.documentElement,e,t,n,o)})}var s=(void 0===e?[document.documentElement]:e.length?e:[e])[0];return s.setAttribute(b+r,r),
a(s.ownerDocument,t,s.ownerDocument.defaultView.innerWidth,s.ownerDocument.defaultView.innerHeight,r).then(function(e){return"function"==typeof t.onrendered&&(_("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),t.onrendered(e)),e})}function a(e,t,r,n,a){return m(e,e,r,n,t,e.defaultView.pageXOffset,e.defaultView.pageYOffset).then(function(o){_("Document cloned");var s=b+a,l="["+s+"='"+a+"']";e.querySelector(l).removeAttribute(s);var c=o.contentWindow,u=c.document.querySelector(l);return("function"==typeof t.onclone?Promise.resolve(t.onclone(c.document)):Promise.resolve(!0)).then(function(){return i(u,o,t,r,n)})})}function i(e,t,r,n,a){var i=t.contentWindow,u=new $(i.document),f=new p(r,u),h=v(e),g="view"===r.type?n:l(i.document),m="view"===r.type?a:c(i.document),y=new r.renderer(g,m,f,r,document);return new d(e,y,u,f,r).ready.then(function(){_("Finished rendering");var n;return n="view"===r.type?s(y.canvas,{width:y.canvas.width,height:y.canvas.height,top:0,left:0,x:0,y:0}):e===i.document.body||e===i.document.documentElement||null!=r.canvas?y.canvas:s(y.canvas,{width:null!=r.width?r.width:h.width,height:null!=r.height?r.height:h.height,top:h.top,left:h.left,x:0,y:0}),o(t,r),n})}function o(e,t){t.removeContainer&&(e.parentNode.removeChild(e),_("Cleaned up container"))}function s(e,t){var r=document.createElement("canvas"),n=Math.min(e.width-1,Math.max(0,t.left)),a=Math.min(e.width,Math.max(1,t.left+t.width)),i=Math.min(e.height-1,Math.max(0,t.top)),o=Math.min(e.height,Math.max(1,t.top+t.height));r.width=t.width,r.height=t.height;var s=a-n,l=o-i;return _("Cropping canvas at:","left:",t.left,"top:",t.top,"width:",s,"height:",l),_("Resulting crop with width",t.width,"and height",t.height,"with x",n,"and y",i),r.getContext("2d").drawImage(e,n,i,s,l,t.x,t.y,s,l),r}function l(e){return Math.max(Math.max(e.body.scrollWidth,e.documentElement.scrollWidth),Math.max(e.body.offsetWidth,e.documentElement.offsetWidth),Math.max(e.body.clientWidth,e.documentElement.clientWidth))}function c(e){return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}function u(e){var t=document.createElement("a");return t.href=e,t.href=t.href,t}var $=e("./support"),f=e("./renderers/canvas"),p=e("./imageloader"),d=e("./nodeparser"),h=e("./nodecontainer"),_=e("./log"),g=e("./utils"),m=e("./clone"),y=e("./proxy").loadUrlDocument,v=g.getBounds,b="data-html2canvas-node",x=0;n.CanvasRenderer=f,n.NodeContainer=h,n.log=_,n.utils=g;var w="undefined"==typeof document||"function"!=typeof Object.create||"function"!=typeof document.createElement("canvas").getContext?function(){return Promise.reject("No canvas support")}:n;t.exports=w},{"./clone":2,"./imageloader":11,"./log":13,"./nodecontainer":14,"./nodeparser":15,"./proxy":16,"./renderers/canvas":20,"./support":22,"./utils":26}],5:[function(e,t,r){function n(e){if(this.src=e,a("DummyImageContainer for",e),!this.promise||!this.image){a("Initiating DummyImageContainer"),n.prototype.image=new Image;var t=this.image;n.prototype.promise=new Promise(function(e,r){t.onload=e,t.onerror=r,t.src=i(),!0===t.complete&&e(t)})}}var a=e("./log"),i=e("./utils").smallImage;t.exports=n},{"./log":13,"./utils":26}],6:[function(e,t,r){var n=e("./utils").smallImage;t.exports=function(e,t){var r,a,i=document.createElement("div"),o=document.createElement("img"),s=document.createElement("span");i.style.visibility="hidden",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin=0,i.style.padding=0,document.body.appendChild(i),o.src=n(),o.width=1,o.height=1,o.style.margin=0,o.style.padding=0,o.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin=0,s.style.padding=0,s.appendChild(document.createTextNode("Hidden Text")),i.appendChild(s),i.appendChild(o),r=o.offsetTop-s.offsetTop+1,i.removeChild(s),i.appendChild(document.createTextNode("Hidden Text")),i.style.lineHeight="normal",o.style.verticalAlign="super",a=o.offsetTop-i.offsetTop+1,document.body.removeChild(i),this.baseline=r,this.lineWidth=1,this.middle=a}},{"./utils":26}],7:[function(e,t,r){function n(){this.data={}}var a=e("./font");n.prototype.getMetrics=function(e,t){return void 0===this.data[e+"-"+t]&&(this.data[e+"-"+t]=new a(e,t)),this.data[e+"-"+t]},t.exports=n},{"./font":6}],8:[function(e,t,r){function n(t,r,n){this.image=null,this.src=t;var i=this,o=a(t);this.promise=(r?new Promise(function(e){"about:blank"===t.contentWindow.document.URL||null==t.contentWindow.document.documentElement?t.contentWindow.onload=t.onload=function(){e(t)}:e(t)}):this.proxyLoad(n.proxy,o,n)).then(function(t){return e("./core")(t.contentWindow.document.documentElement,{type:"view",width:t.width,height:t.height,proxy:n.proxy,javascriptEnabled:n.javascriptEnabled,removeContainer:n.removeContainer,allowTaint:n.allowTaint,imageTimeout:n.imageTimeout/2})}).then(function(e){return i.image=e})}var a=e("./utils").getBounds,i=e("./proxy").loadUrlDocument;n.prototype.proxyLoad=function(e,t,r){var n=this.src;return i(n.src,e,n.ownerDocument,t.width,t.height,r)},t.exports=n},{"./core":4,"./proxy":16,"./utils":26}],9:[function(e,t,r){function n(e){this.src=e.value,this.colorStops=[],this.type=null,this.x0=.5,this.y0=.5,this.x1=.5,this.y1=.5,this.promise=Promise.resolve(!0)}n.TYPES={LINEAR:1,RADIAL:2},n.REGEXP_COLORSTOP=/^\s*(rgba?\(\s*\d{1,3},\s*\d{1,3},\s*\d{1,3}(?:,\s*[0-9\.]+)?\s*\)|[a-z]{3,20}|#[a-f0-9]{3,6})(?:\s+(\d{1,3}(?:\.\d+)?)(%|px)?)?(?:\s|$)/i,t.exports=n},{}],10:[function(e,t,r){t.exports=function(e,t){this.src=e,this.image=new Image;var r=this;this.tainted=null,this.promise=new Promise(function(n,a){r.image.onload=n,r.image.onerror=a,t&&(r.image.crossOrigin="anonymous"),r.image.src=e,!0===r.image.complete&&n(r.image)})}},{}],11:[function(e,t,r){function n(e,t){this.link=null,this.options=e,this.support=t,this.origin=this.getOrigin(window.location.href)}var a=e("./log"),i=e("./imagecontainer"),o=e("./dummyimagecontainer"),s=e("./proxyimagecontainer"),l=e("./framecontainer"),c=e("./svgcontainer"),u=e("./svgnodecontainer"),$=e("./lineargradientcontainer"),f=e("./webkitgradientcontainer"),p=e("./utils").bind;n.prototype.findImages=function(e){var t=[];return e.reduce(function(e,t){switch(t.node.nodeName){case"IMG":return e.concat([{args:[t.node.src],method:"url"}]);case"svg":case"IFRAME":return e.concat([{args:[t.node],method:t.node.nodeName}])}return e},[]).forEach(this.addImage(t,this.loadImage),this),t},n.prototype.findBackgroundImage=function(e,t){return t.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(e,this.loadImage),this),e},n.prototype.addImage=function(e,t){return function(r){r.args.forEach(function(n){this.imageExists(e,n)||(e.splice(0,0,t.call(this,r)),a("Added image #"+e.length,"string"==typeof n?n.substring(0,100):n))},this)}},n.prototype.hasImageBackground=function(e){return"none"!==e.method},n.prototype.loadImage=function(e){if("url"===e.method){var t=e.args[0];return!this.isSVG(t)||this.support.svg||this.options.allowTaint?t.match(/data:image\/.*;base64,/i)?new i(t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),!1):this.isSameOrigin(t)||!0===this.options.allowTaint||this.isSVG(t)?new i(t,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new i(t,!0):this.options.proxy?new s(t,this.options.proxy):new o(t):new c(t)}return"linear-gradient"===e.method?new $(e):"gradient"===e.method?new f(e):"svg"===e.method?new u(e.args[0],this.support.svg):"IFRAME"===e.method?new l(e.args[0],this.isSameOrigin(e.args[0].src),this.options):new o(e)},n.prototype.isSVG=function(e){return"svg"===e.substring(e.length-3).toLowerCase()||c.prototype.isInline(e)},n.prototype.imageExists=function(e,t){return e.some(function(e){return e.src===t})},n.prototype.isSameOrigin=function(e){return this.getOrigin(e)===this.origin},n.prototype.getOrigin=function(e){var t=this.link||(this.link=document.createElement("a"));return t.href=e,t.href=t.href,t.protocol+t.hostname+t.port},n.prototype.getPromise=function(e){return this.timeout(e,this.options.imageTimeout).catch(function(){return new o(e.src).promise.then(function(t){e.image=t})})},n.prototype.get=function(e){var t=null;return this.images.some(function(r){return(t=r).src===e})?t:null},n.prototype.fetch=function(e){return this.images=e.reduce(p(this.findBackgroundImage,this),this.findImages(e)),this.images.forEach(function(e,t){e.promise.then(function(){a("Succesfully loaded image #"+(t+1),e)},function(r){a("Failed loading image #"+(t+1),e,r)})}),this.ready=Promise.all(this.images.map(this.getPromise,this)),a("Finished searching images"),this},n.prototype.timeout=function(e,t){var r,n=Promise.race([e.promise,new Promise(function(n,i){r=setTimeout(function(){a("Timed out loading image",e),i(e)},t)})]).then(function(e){return clearTimeout(r),e});return n.catch(function(){clearTimeout(r)}),n},t.exports=n},{"./dummyimagecontainer":5,"./framecontainer":8,"./imagecontainer":10,"./lineargradientcontainer":12,"./log":13,"./proxyimagecontainer":17,"./svgcontainer":23,"./svgnodecontainer":24,"./utils":26,"./webkitgradientcontainer":27}],12:[function(e,t,r){function n(e){a.apply(this,arguments),this.type=a.TYPES.LINEAR;var t=n.REGEXP_DIRECTION.test(e.args[0])||!a.REGEXP_COLORSTOP.test(e.args[0]);t?e.args[0].split(/\s+/).reverse().forEach(function(e,t){switch(e){case"left":this.x0=0,this.x1=1;break;case"top":this.y0=0,this.y1=1;break;case"right":this.x0=1,this.x1=0;break;case"bottom":this.y0=1,this.y1=0;break;case"to":var r=this.y0,n=this.x0;this.y0=this.y1,this.x0=this.x1,this.x1=n,this.y1=r;break;case"center":break;default:var a=.01*parseFloat(e,10);if(isNaN(a))break;0===t?(this.y0=a,this.y1=1-this.y0):(this.x0=a,this.x1=1-this.x0)}},this):(this.y0=0,this.y1=1),this.colorStops=e.args.slice(t?1:0).map(function(e){var t=e.match(a.REGEXP_COLORSTOP),r=+t[2],n=0===r?"%":t[3];return{color:new i(t[1]),stop:"%"===n?r/100:null}}),null===this.colorStops[0].stop&&(this.colorStops[0].stop=0),null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1),this.colorStops.forEach(function(e,t){null===e.stop&&this.colorStops.slice(t).some(function(r,n){return null!==r.stop&&(e.stop=(r.stop-this.colorStops[t-1].stop)/(n+1)+this.colorStops[t-1].stop,!0)},this)},this)}var a=e("./gradientcontainer"),i=e("./color");n.prototype=Object.create(a.prototype),n.REGEXP_DIRECTION=/^\s*(?:to|left|right|top|bottom|center|\d{1,3}(?:\.\d+)?%?)(?:\s|$)/i,t.exports=n},{"./color":3,"./gradientcontainer":9}],13:[function(e,t,r){var n=function(){n.options.logging&&window.console&&window.console.log&&Function.prototype.bind.call(window.console.log,window.console).apply(window.console,[Date.now()-n.options.start+"ms","html2canvas:"].concat([].slice.call(arguments,0)))};n.options={logging:!1},t.exports=n},{}],14:[function(e,t,r){function n(e,t){this.node=e,this.parent=t,this.stack=null,this.bounds=null,this.borders=null,this.clip=[],this.backgroundClip=[],this.offsetBounds=null,this.visible=null,this.computedStyles=null,this.colors={},this.styles={},this.backgroundImages=null,this.transformData=null,this.transformMatrix=null,this.isPseudoElement=!1,this.opacity=null}function a(e){var t=e.options[e.selectedIndex||0];return t?t.text||"":""}function i(e){if(e&&"matrix"===e[1])return e[2].split(",").map(function(e){return parseFloat(e.trim())});if(e&&"matrix3d"===e[1]){var t=e[2].split(",").map(function(e){return parseFloat(e.trim())});return[t[0],t[1],t[4],t[5],t[12],t[13]]}}function o(e){return-1!==e.toString().indexOf("%")}function s(e){return e.replace("px","")}function l(e){return parseFloat(e)}var c=e("./color"),u=e("./utils"),$=u.getBounds,f=u.parseBackgrounds,p=u.offsetBounds;n.prototype.cloneTo=function(e){e.visible=this.visible,e.borders=this.borders,e.bounds=this.bounds,e.clip=this.clip,e.backgroundClip=this.backgroundClip,e.computedStyles=this.computedStyles,e.styles=this.styles,e.backgroundImages=this.backgroundImages,e.opacity=this.opacity},n.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity},n.prototype.assignStack=function(e){this.stack=e,e.children.push(this)},n.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))},n.prototype.css=function(e){return this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null)),this.styles[e]||(this.styles[e]=this.computedStyles[e])},n.prototype.prefixedCss=function(e){var t=["webkit","moz","ms","o"],r=this.css(e);return void 0===r&&t.some(function(t){return void 0!==(r=this.css(t+e.substr(0,1).toUpperCase()+e.substr(1)))},this),void 0===r?null:r},n.prototype.computedStyle=function(e){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,e)},n.prototype.cssInt=function(e){var t=parseInt(this.css(e),10);return isNaN(t)?0:t},n.prototype.color=function(e){return this.colors[e]||(this.colors[e]=new c(this.css(e)))},n.prototype.cssFloat=function(e){var t=parseFloat(this.css(e));return isNaN(t)?0:t},n.prototype.fontWeight=function(){var e=this.css("fontWeight");switch(parseInt(e,10)){case 401:e="bold";break;case 400:e="normal"}return e},n.prototype.parseClip=function(){var e=this.css("clip").match(this.CLIP);return e?{top:parseInt(e[1],10),right:parseInt(e[2],10),bottom:parseInt(e[3],10),left:parseInt(e[4],10)}:null},n.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=f(this.css("backgroundImage")))},n.prototype.cssList=function(e,t){var r=(this.css(e)||"").split(",");return r=r[t||0]||r[0]||"auto",1===(r=r.trim().split(" ")).length&&(r=[r[0],o(r[0])?"auto":r[0]]),r},n.prototype.parseBackgroundSize=function(e,t,r){var n,a,i=this.cssList("backgroundSize",r);if(o(i[0]))n=e.width*parseFloat(i[0])/100;else{if(/contain|cover/.test(i[0])){var s=e.width/e.height,l=t.width/t.height;return s<l^"contain"===i[0]?{width:e.height*l,height:e.height}:{width:e.width,height:e.width/l}}n=parseInt(i[0],10)}return a="auto"===i[0]&&"auto"===i[1]?t.height:"auto"===i[1]?n/t.width*t.height:o(i[1])?e.height*parseFloat(i[1])/100:parseInt(i[1],10),"auto"===i[0]&&(n=a/t.height*t.width),{width:n,height:a}},n.prototype.parseBackgroundPosition=function(e,t,r,n){var a,i,s=this.cssList("backgroundPosition",r);return a=o(s[0])?(e.width-(n||t).width)*(parseFloat(s[0])/100):parseInt(s[0],10),i="auto"===s[1]?a/t.width*t.height:o(s[1])?(e.height-(n||t).height)*parseFloat(s[1])/100:parseInt(s[1],10),"auto"===s[0]&&(a=i/t.height*t.width),{left:a,top:i}},n.prototype.parseBackgroundRepeat=function(e){return this.cssList("backgroundRepeat",e)[0]},n.prototype.parseTextShadows=function(){var e=this.css("textShadow"),t=[];if(e&&"none"!==e)for(var r=e.match(this.TEXT_SHADOW_PROPERTY),n=0;r&&n<r.length;n++){var a=r[n].match(this.TEXT_SHADOW_VALUES);t.push({color:new c(a[0]),offsetX:a[1]?parseFloat(a[1].replace("px","")):0,offsetY:a[2]?parseFloat(a[2].replace("px","")):0,blur:a[3]?a[3].replace("px",""):0})}return t},n.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var e=this.parseBounds(),t=this.prefixedCss("transformOrigin").split(" ").map(s).map(l);t[0]+=e.left,t[1]+=e.top,this.transformData={origin:t,matrix:this.parseTransformMatrix()}}else this.transformData={origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData},n.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var e=this.prefixedCss("transform"),t=e?i(e.match(this.MATRIX_PROPERTY)):null;this.transformMatrix=t||[1,0,0,1,0,0]}return this.transformMatrix},n.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?p(this.node):$(this.node))},n.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&this.parent.hasTransform()},n.prototype.getValue=function(){var e=this.node.value||"";return"SELECT"===this.node.tagName?e=a(this.node):"password"===this.node.type&&(e=Array(e.length+1).join("")),0===e.length?this.node.placeholder||"":e},n.prototype.MATRIX_PROPERTY=/(matrix|matrix3d)\((.+)\)/,n.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,n.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,n.prototype.CLIP=/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/,t.exports=n},{"./color":3,"./utils":26}],15:[function(e,t,r){function n(e,t,r,n,a){L("Starting NodeParser"),this.renderer=t,this.options=a,this.range=null,this.support=r,this.renderQueue=[],this.stack=new Q(!0,1,e.ownerDocument,null);var i=new q(e,null);if(a.background&&t.rectangle(0,0,t.width,t.height,new Y(a.background)),e===e.ownerDocument.documentElement){var o=new q(i.color("backgroundColor").isTransparent()?e.ownerDocument.body:e.ownerDocument.documentElement,null);t.rectangle(0,0,t.width,t.height,o.color("backgroundColor"))}i.visibile=i.isElementVisible(),this.createPseudoHideStyles(e.ownerDocument),this.disableAnimations(e.ownerDocument),this.nodes=B([i].concat(this.getChildren(i)).filter(function(e){return e.visible=e.isElementVisible()}).map(this.getPseudoElements,this)),this.fontMetrics=new G,L("Fetched nodes, total:",this.nodes.length),L("Calculate overflow clips"),this.calculateOverflowClips(),L("Start fetching images"),this.images=n.fetch(this.nodes.filter(C)),this.ready=this.images.ready.then(X(function(){return L("Images loaded, starting parsing"),L("Creating stacking contexts"),this.createStackingContexts(),L("Sorting stacking contexts"),this.sortStackingContexts(this.stack),this.parse(this.stack),L("Render queue created with "+this.renderQueue.length+" items"),new Promise(X(function(e){a.async?"function"==typeof a.async?a.async.call(this,this.renderQueue,e):this.renderQueue.length>0?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,e)):e():(this.renderQueue.forEach(this.paint,this),e())},this))},this))}function a(e){return e.parent&&e.parent.clip.length}function i(e){return e.replace(/(\-[a-z])/g,function(e){return e.toUpperCase().replace("-","")})}function o(){}function s(e,t,r,n){return e.map(function(a,i){if(a.width>0){var o=t.left,s=t.top,l=t.width,c=t.height-e[2].width;switch(i){case 0:c=e[0].width,a.args=$({c1:[o,s],c2:[o+l,s],c3:[o+l-e[1].width,s+c],c4:[o+e[3].width,s+c]},n[0],n[1],r.topLeftOuter,r.topLeftInner,r.topRightOuter,r.topRightInner);break;case 1:o=t.left+t.width-e[1].width,l=e[1].width,a.args=$({c1:[o+l,s],c2:[o+l,s+c+e[2].width],c3:[o,s+c],c4:[o,s+e[0].width]},n[1],n[2],r.topRightOuter,r.topRightInner,r.bottomRightOuter,r.bottomRightInner);break;case 2:s=s+t.height-e[2].width,c=e[2].width,a.args=$({c1:[o+l,s+c],c2:[o,s+c],c3:[o+e[3].width,s],c4:[o+l-e[3].width,s]},n[2],n[3],r.bottomRightOuter,r.bottomRightInner,r.bottomLeftOuter,r.bottomLeftInner);break;case 3:l=e[3].width,a.args=$({c1:[o,s+c+e[2].width],c2:[o,s],c3:[o+l,s+e[0].width],c4:[o+l,s+c]},n[3],n[0],r.bottomLeftOuter,r.bottomLeftInner,r.topLeftOuter,r.topLeftInner)}}return a})}function l(e,t,r,n){var a=(Math.sqrt(2)-1)/3*4,i=r*a,o=n*a,s=e+r,l=t+n;return{topLeft:u({x:e,y:l},{x:e,y:l-o},{x:s-i,y:t},{x:s,y:t}),topRight:u({x:e,y:t},{x:e+i,y:t},{x:s,y:l-o},{x:s,y:l}),bottomRight:u({x:s,y:t},{x:s,y:t+o},{x:e+i,y:l},{x:e,y:l}),bottomLeft:u({x:s,y:l},{x:s-i,y:l},{x:e,y:t+o},{x:e,y:t})}}function c(e,t,r){var n=e.left,a=e.top,i=e.width,o=e.height,s=t[0][0]<i/2?t[0][0]:i/2,c=t[0][1]<o/2?t[0][1]:o/2,u=t[1][0]<i/2?t[1][0]:i/2,$=t[1][1]<o/2?t[1][1]:o/2,f=t[2][0]<i/2?t[2][0]:i/2,p=t[2][1]<o/2?t[2][1]:o/2,d=t[3][0]<i/2?t[3][0]:i/2,h=t[3][1]<o/2?t[3][1]:o/2,_=i-u,g=o-p,m=i-f,y=o-h;return{topLeftOuter:l(n,a,s,c).topLeft.subdivide(.5),topLeftInner:l(n+r[3].width,a+r[0].width,Math.max(0,s-r[3].width),Math.max(0,c-r[0].width)).topLeft.subdivide(.5),topRightOuter:l(n+_,a,u,$).topRight.subdivide(.5),topRightInner:l(n+Math.min(_,i+r[3].width),a+r[0].width,_>i+r[3].width?0:u-r[3].width,$-r[0].width).topRight.subdivide(.5),bottomRightOuter:l(n+m,a+g,f,p).bottomRight.subdivide(.5),bottomRightInner:l(n+Math.min(m,i-r[3].width),a+Math.min(g,o+r[0].width),Math.max(0,f-r[1].width),p-r[2].width).bottomRight.subdivide(.5),bottomLeftOuter:l(n,a+y,d,h).bottomLeft.subdivide(.5),bottomLeftInner:l(n+r[3].width,a+y,Math.max(0,d-r[3].width),h-r[2].width).bottomLeft.subdivide(.5)}}function u(e,t,r,n){var a=function(e,t,r){return{x:e.x+(t.x-e.x)*r,y:e.y+(t.y-e.y)*r}};return{start:e,startControl:t,endControl:r,end:n,subdivide:function(i){var o=a(e,t,i),s=a(t,r,i),l=a(r,n,i),c=a(o,s,i),$=a(s,l,i),f=a(c,$,i);return[u(e,o,c,f),u(f,$,l,n)]},curveTo:function(e){e.push(["bezierCurve",t.x,t.y,r.x,r.y,n.x,n.y])},curveToReversed:function(n){n.push(["bezierCurve",r.x,r.y,t.x,t.y,e.x,e.y])}}}function $(e,t,r,n,a,i,o){var s=[];return t[0]>0||t[1]>0?(s.push(["line",n[1].start.x,n[1].start.y]),n[1].curveTo(s)):s.push(["line",e.c1[0],e.c1[1]]),r[0]>0||r[1]>0?(s.push(["line",i[0].start.x,i[0].start.y]),i[0].curveTo(s),s.push(["line",o[0].end.x,o[0].end.y]),o[0].curveToReversed(s)):(s.push(["line",e.c2[0],e.c2[1]]),s.push(["line",e.c3[0],e.c3[1]])),t[0]>0||t[1]>0?(s.push(["line",a[1].end.x,a[1].end.y]),a[1].curveToReversed(s)):s.push(["line",e.c4[0],e.c4[1]]),s}function f(e,t,r,n,a,i,o){t[0]>0||t[1]>0?(e.push(["line",n[0].start.x,n[0].start.y]),n[0].curveTo(e),n[1].curveTo(e)):e.push(["line",i,o]),(r[0]>0||r[1]>0)&&e.push(["line",a[0].start.x,a[0].start.y])}function p(e){return e.cssInt("zIndex")<0}function d(e){return e.cssInt("zIndex")>0}function h(e){return 0===e.cssInt("zIndex")}function _(e){return-1!==["inline","inline-block","inline-table"].indexOf(e.css("display"))}function g(e){return e instanceof Q}function m(e){return e.node.data.trim().length>0}function y(e){return/^(normal|none|0px)$/.test(e.parent.css("letterSpacing"))}function v(e){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(t){var r=e.css("border"+t+"Radius").split(" ");return r.length<=1&&(r[1]=r[0]),r.map(P)})}function b(e){return e.nodeType===Node.TEXT_NODE||e.nodeType===Node.ELEMENT_NODE}function x(e){return"auto"!==(-1!==["absolute","relative","fixed"].indexOf(e.css("position"))?e.css("zIndex"):"auto")}function w(e){return"static"!==e.css("position")}function A(e){return"none"!==e.css("float")}function k(e){return-1!==["inline-block","inline-table"].indexOf(e.css("display"))}function E(e){var t=this;return function(){return!e.apply(t,arguments)}}function C(e){return e.node.nodeType===Node.ELEMENT_NODE}function S(e){return!0===e.isPseudoElement}function I(e){return e.node.nodeType===Node.TEXT_NODE}function O(e){return function(t,r){return t.cssInt("zIndex")+e.indexOf(t)/e.length-(r.cssInt("zIndex")+e.indexOf(r)/e.length)}}function T(e){return e.getOpacity()<1}function P(e){return parseInt(e,10)}function M(e){return e.width}function N(e){return e.node.nodeType!==Node.ELEMENT_NODE||-1===["SCRIPT","HEAD","TITLE","OBJECT","BR","OPTION"].indexOf(e.node.nodeName)}function B(e){return[].concat.apply([],e)}function R(e){var t=e.substr(0,1);return t===e.substr(e.length-1)&&t.match(/'|"/)?e.substr(1,e.length-2):e}function j(e){for(var t,r=[],n=0,a=!1;e.length;)F(e[n])===a?((t=e.splice(0,n)).length&&r.push(z.ucs2.encode(t)),a=!a,n=0):n++,n>=e.length&&(t=e.splice(0,n)).length&&r.push(z.ucs2.encode(t));return r}function F(e){return-1!==[32,13,10,9,45].indexOf(e)}function D(e){return/[^\u0000-\u00ff]/.test(e)}var L=e("./log"),z=e("punycode"),q=e("./nodecontainer"),U=e("./textcontainer"),H=e("./pseudoelementcontainer"),G=e("./fontmetrics"),Y=e("./color"),Q=e("./stackingcontext"),V=e("./utils"),X=V.bind,W=V.getBounds,J=V.parseBackgrounds,K=V.offsetBounds;n.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(e){if(C(e)){S(e)&&e.appendToDOM(),e.borders=this.parseBorders(e);var t="hidden"===e.css("overflow")?[e.borders.clip]:[],r=e.parseClip();r&&-1!==["absolute","fixed"].indexOf(e.css("position"))&&t.push([["rect",e.bounds.left+r.left,e.bounds.top+r.top,r.right-r.left,r.bottom-r.top]]),e.clip=a(e)?e.parent.clip.concat(t):t,e.backgroundClip="hidden"!==e.css("overflow")?e.clip.concat([e.borders.clip]):e.clip,S(e)&&e.cleanDOM()}else I(e)&&(e.clip=a(e)?e.parent.clip:[]);S(e)||(e.bounds=null)},this)},n.prototype.asyncRenderer=function(e,t,r){r=r||Date.now(),this.paint(e[this.renderIndex++]),e.length===this.renderIndex?t():r+20>Date.now()?this.asyncRenderer(e,t,r):setTimeout(X(function(){this.asyncRenderer(e,t)},this),0)},n.prototype.createPseudoHideStyles=function(e){this.createStyles(e,"."+H.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+H.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')},n.prototype.disableAnimations=function(e){this.createStyles(e,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")},n.prototype.createStyles=function(e,t){var r=e.createElement("style");r.innerHTML=t,e.body.appendChild(r)},n.prototype.getPseudoElements=function(e){var t=[[e]];if(e.node.nodeType===Node.ELEMENT_NODE){var r=this.getPseudoElement(e,":before"),n=this.getPseudoElement(e,":after");r&&t.push(r),n&&t.push(n)}return B(t)},n.prototype.getPseudoElement=function(e,t){var r=e.computedStyle(t);if(!r||!r.content||"none"===r.content||"-moz-alt-content"===r.content||"none"===r.display)return null;for(var n=R(r.content),a="url"===n.substr(0,3),o=document.createElement(a?"img":"html2canvaspseudoelement"),s=new H(o,e,t),l=r.length-1;l>=0;l--){var c=i(r.item(l));o.style[c]=r[c]}if(o.className=H.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+H.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER,a)return o.src=J(n)[0].args[0],[s];var u=document.createTextNode(n);return o.appendChild(u),[s,new U(u,s)]},n.prototype.getChildren=function(e){return B([].filter.call(e.node.childNodes,b).map(function(t){var r=[t.nodeType===Node.TEXT_NODE?new U(t,e):new q(t,e)].filter(N);return t.nodeType===Node.ELEMENT_NODE&&r.length&&"TEXTAREA"!==t.tagName?r[0].isElementVisible()?r.concat(this.getChildren(r[0])):[]:r},this))},n.prototype.newStackingContext=function(e,t){var r=new Q(t,e.getOpacity(),e.node,e.parent);e.cloneTo(r),(t?r.getParentStack(this):r.parent.stack).contexts.push(r),e.stack=r},n.prototype.createStackingContexts=function(){this.nodes.forEach(function(e){C(e)&&(this.isRootElement(e)||T(e)||x(e)||this.isBodyWithTransparentRoot(e)||e.hasTransform())?this.newStackingContext(e,!0):C(e)&&(w(e)&&h(e)||k(e)||A(e))?this.newStackingContext(e,!1):e.assignStack(e.parent.stack)},this)},n.prototype.isBodyWithTransparentRoot=function(e){return"BODY"===e.node.nodeName&&e.parent.color("backgroundColor").isTransparent()},n.prototype.isRootElement=function(e){return null===e.parent},n.prototype.sortStackingContexts=function(e){e.contexts.sort(O(e.contexts.slice(0))),e.contexts.forEach(this.sortStackingContexts,this)},n.prototype.parseTextBounds=function(e){return function(t,r,n){if("none"!==e.parent.css("textDecoration").substr(0,4)||0!==t.trim().length){if(this.support.rangeBounds&&!e.parent.hasTransform()){var a=n.slice(0,r).join("").length;return this.getRangeBounds(e.node,a,t.length)}if(e.node&&"string"==typeof e.node.data){var i=e.node.splitText(t.length),o=this.getWrapperBounds(e.node,e.parent.hasTransform());return e.node=i,o}}else this.support.rangeBounds&&!e.parent.hasTransform()||(e.node=e.node.splitText(t.length));return{}}},n.prototype.getWrapperBounds=function(e,t){var r=e.ownerDocument.createElement("html2canvaswrapper"),n=e.parentNode,a=e.cloneNode(!0);r.appendChild(e.cloneNode(!0)),n.replaceChild(r,e);var i=t?K(r):W(r);return n.replaceChild(a,r),i},n.prototype.getRangeBounds=function(e,t,r){var n=this.range||(this.range=e.ownerDocument.createRange());return n.setStart(e,t),n.setEnd(e,t+r),n.getBoundingClientRect()},n.prototype.parse=function(e){var t=e.contexts.filter(p),r=e.children.filter(C),n=r.filter(E(A)),a=n.filter(E(w)).filter(E(_)),i=r.filter(E(w)).filter(A),s=n.filter(E(w)).filter(_),l=e.contexts.concat(n.filter(w)).filter(h),c=e.children.filter(I).filter(m),u=e.contexts.filter(d);t.concat(a).concat(i).concat(s).concat(l).concat(c).concat(u).forEach(function(e){this.renderQueue.push(e),g(e)&&(this.parse(e),this.renderQueue.push(new o))},this)},n.prototype.paint=function(e){try{e instanceof o?this.renderer.ctx.restore():I(e)?(S(e.parent)&&e.parent.appendToDOM(),this.paintText(e),S(e.parent)&&e.parent.cleanDOM()):this.paintNode(e)}catch(e){if(L(e),this.options.strict)throw e}},n.prototype.paintNode=function(e){g(e)&&(this.renderer.setOpacity(e.opacity),this.renderer.ctx.save(),e.hasTransform()&&this.renderer.setTransform(e.parseTransform())),"INPUT"===e.node.nodeName&&"checkbox"===e.node.type?this.paintCheckbox(e):"INPUT"===e.node.nodeName&&"radio"===e.node.type?this.paintRadio(e):this.paintElement(e)},n.prototype.paintElement=function(e){var t=e.parseBounds();this.renderer.clip(e.backgroundClip,function(){this.renderer.renderBackground(e,t,e.borders.borders.map(M))},this),this.renderer.clip(e.clip,function(){this.renderer.renderBorders(e.borders.borders)},this),this.renderer.clip(e.backgroundClip,function(){switch(e.node.nodeName){case"svg":case"IFRAME":var r=this.images.get(e.node);r?this.renderer.renderImage(e,t,e.borders,r):L("Error loading <"+e.node.nodeName+">",e.node);break;case"IMG":var n=this.images.get(e.node.src);n?this.renderer.renderImage(e,t,e.borders,n):L("Error loading <img>",e.node.src);break;case"CANVAS":this.renderer.renderImage(e,t,e.borders,{image:e.node});break;case"SELECT":case"INPUT":case"TEXTAREA":this.paintFormValue(e)}},this)},n.prototype.paintCheckbox=function(e){var t=e.parseBounds(),r=Math.min(t.width,t.height),n={width:r-1,height:r-1,top:t.top,left:t.left},a=[3,3],i=[a,a,a,a],o=[1,1,1,1].map(function(e){return{color:new Y("#A5A5A5"),width:e}}),l=c(n,i,o);this.renderer.clip(e.backgroundClip,function(){this.renderer.rectangle(n.left+1,n.top+1,n.width-2,n.height-2,new Y("#DEDEDE")),this.renderer.renderBorders(s(o,n,l,i)),e.node.checked&&(this.renderer.font(new Y("#424242"),"normal","normal","bold",r-3+"px","arial"),this.renderer.text("",n.left+r/6,n.top+r-1))},this)},n.prototype.paintRadio=function(e){var t=e.parseBounds(),r=Math.min(t.width,t.height)-2;this.renderer.clip(e.backgroundClip,function(){this.renderer.circleStroke(t.left+1,t.top+1,r,new Y("#DEDEDE"),1,new Y("#A5A5A5")),e.node.checked&&this.renderer.circle(Math.ceil(t.left+r/4)+1,Math.ceil(t.top+r/4)+1,Math.floor(r/2),new Y("#424242"))},this)},n.prototype.paintFormValue=function(e){var t=e.getValue();if(t.length>0){var r=e.node.ownerDocument,n=r.createElement("html2canvaswrapper");["lineHeight","textAlign","fontFamily","fontWeight","fontSize","color","paddingLeft","paddingTop","paddingRight","paddingBottom","width","height","borderLeftStyle","borderTopStyle","borderLeftWidth","borderTopWidth","boxSizing","whiteSpace","wordWrap"].forEach(function(t){try{n.style[t]=e.css(t)}catch(e){L("html2canvas: Parse: Exception caught in renderFormValue: "+e.message)}});var a=e.parseBounds();n.style.position="fixed",n.style.left=a.left+"px",n.style.top=a.top+"px",n.textContent=t,r.body.appendChild(n),this.paintText(new U(n.firstChild,e)),r.body.removeChild(n)}},n.prototype.paintText=function(e){e.applyTextTransform();var t=z.ucs2.decode(e.node.data),r=this.options.letterRendering&&!y(e)||D(e.node.data)?t.map(function(e){return z.ucs2.encode([e])}):j(t),n=e.parent.fontWeight(),a=e.parent.css("fontSize"),i=e.parent.css("fontFamily"),o=e.parent.parseTextShadows();this.renderer.font(e.parent.color("color"),e.parent.css("fontStyle"),e.parent.css("fontVariant"),n,a,i),
o.length?this.renderer.fontShadow(o[0].color,o[0].offsetX,o[0].offsetY,o[0].blur):this.renderer.clearShadow(),this.renderer.clip(e.parent.clip,function(){r.map(this.parseTextBounds(e),this).forEach(function(t,n){t&&(this.renderer.text(r[n],t.left,t.bottom),this.renderTextDecoration(e.parent,t,this.fontMetrics.getMetrics(i,a)))},this)},this)},n.prototype.renderTextDecoration=function(e,t,r){switch(e.css("textDecoration").split(" ")[0]){case"underline":this.renderer.rectangle(t.left,Math.round(t.top+r.baseline+r.lineWidth),t.width,1,e.color("color"));break;case"overline":this.renderer.rectangle(t.left,Math.round(t.top),t.width,1,e.color("color"));break;case"line-through":this.renderer.rectangle(t.left,Math.ceil(t.top+r.middle+r.lineWidth),t.width,1,e.color("color"))}};var Z={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};n.prototype.parseBorders=function(e){var t=e.parseBounds(),r=v(e),n=["Top","Right","Bottom","Left"].map(function(t,r){var n=e.css("border"+t+"Style"),a=e.color("border"+t+"Color");"inset"===n&&a.isBlack()&&(a=new Y([255,255,255,a.a]));var i=Z[n]?Z[n][r]:null;return{width:e.cssInt("border"+t+"Width"),color:i?a[i[0]](i[1]):a,args:null}}),a=c(t,r,n);return{clip:this.parseBackgroundClip(e,a,n,r,t),borders:s(n,t,a,r)}},n.prototype.parseBackgroundClip=function(e,t,r,n,a){var i=[];switch(e.css("backgroundClip")){case"content-box":case"padding-box":f(i,n[0],n[1],t.topLeftInner,t.topRightInner,a.left+r[3].width,a.top+r[0].width),f(i,n[1],n[2],t.topRightInner,t.bottomRightInner,a.left+a.width-r[1].width,a.top+r[0].width),f(i,n[2],n[3],t.bottomRightInner,t.bottomLeftInner,a.left+a.width-r[1].width,a.top+a.height-r[2].width),f(i,n[3],n[0],t.bottomLeftInner,t.topLeftInner,a.left+r[3].width,a.top+a.height-r[2].width);break;default:f(i,n[0],n[1],t.topLeftOuter,t.topRightOuter,a.left,a.top),f(i,n[1],n[2],t.topRightOuter,t.bottomRightOuter,a.left+a.width,a.top),f(i,n[2],n[3],t.bottomRightOuter,t.bottomLeftOuter,a.left+a.width,a.top+a.height),f(i,n[3],n[0],t.bottomLeftOuter,t.topLeftOuter,a.left,a.top+a.height)}return i},t.exports=n},{"./color":3,"./fontmetrics":7,"./log":13,"./nodecontainer":14,"./pseudoelementcontainer":18,"./stackingcontext":21,"./textcontainer":25,"./utils":26,punycode:1}],16:[function(e,t,r){function n(e,t,r){var n="withCredentials"in new XMLHttpRequest;if(!t)return Promise.reject("No proxy configured");var s=i(n),c=o(t,e,s);return n?l(c):a(r,c,s).then(function(e){return f(e.content)})}function a(e,t,r){return new Promise(function(n,a){var i=e.createElement("script"),o=function(){delete window.html2canvas.proxy[r],e.body.removeChild(i)};window.html2canvas.proxy[r]=function(e){o(),n(e)},i.src=t,i.onerror=function(e){o(),a(e)},e.body.appendChild(i)})}function i(e){return e?"":"html2canvas_"+Date.now()+"_"+ ++p+"_"+Math.round(1e5*Math.random())}function o(e,t,r){return e+"?url="+encodeURIComponent(t)+(r.length?"&callback=html2canvas.proxy."+r:"")}function s(e){return function(t){var r,n=new DOMParser;try{r=n.parseFromString(t,"text/html")}catch(e){u("DOMParser not supported, falling back to createHTMLDocument"),r=document.implementation.createHTMLDocument("");try{r.open(),r.write(t),r.close()}catch(e){u("createHTMLDocument write not supported, falling back to document.body.innerHTML"),r.body.innerHTML=t}}var a=r.querySelector("base");if(!a||!a.href.host){var i=r.createElement("base");i.href=e,r.head.insertBefore(i,r.head.firstChild)}return r}}var l=e("./xhr"),c=e("./utils"),u=e("./log"),$=e("./clone"),f=c.decode64,p=0;r.Proxy=n,r.ProxyURL=function(e,t,r){var n="crossOrigin"in new Image,s=i(n),l=o(t,e,s);return n?Promise.resolve(l):a(r,l,s).then(function(e){return"data:"+e.type+";base64,"+e.content})},r.loadUrlDocument=function(e,t,r,a,i,o){return new n(e,t,window.document).then(s(e)).then(function(e){return $(e,r,a,i,o,0,0)})}},{"./clone":2,"./log":13,"./utils":26,"./xhr":28}],17:[function(e,t,r){var n=e("./proxy").ProxyURL;t.exports=function(e,t){var r=document.createElement("a");r.href=e,e=r.href,this.src=e,this.image=new Image;var a=this;this.promise=new Promise(function(r,i){a.image.crossOrigin="Anonymous",a.image.onload=r,a.image.onerror=i,new n(e,t,document).then(function(e){a.image.src=e}).catch(i)})}},{"./proxy":16}],18:[function(e,t,r){function n(e,t,r){a.call(this,e,t),this.isPseudoElement=!0,this.before=":before"===r}var a=e("./nodecontainer");n.prototype.cloneTo=function(e){n.prototype.cloneTo.call(this,e),e.isPseudoElement=!0,e.before=this.before},(n.prototype=Object.create(a.prototype)).appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node),this.parent.node.className+=" "+this.getHideClass()},n.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node),this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")},n.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+(this.before?"BEFORE":"AFTER")]},n.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before",n.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after",t.exports=n},{"./nodecontainer":14}],19:[function(e,t,r){function n(e,t,r,n,a){this.width=e,this.height=t,this.images=r,this.options=n,this.document=a}var a=e("./log");n.prototype.renderImage=function(e,t,r,n){var a=e.cssInt("paddingLeft"),i=e.cssInt("paddingTop"),o=e.cssInt("paddingRight"),s=e.cssInt("paddingBottom"),l=r.borders,c=t.width-(l[1].width+l[3].width+a+o),u=t.height-(l[0].width+l[2].width+i+s);this.drawImage(n,0,0,n.image.width||c,n.image.height||u,t.left+a+l[3].width,t.top+i+l[0].width,c,u)},n.prototype.renderBackground=function(e,t,r){t.height>0&&t.width>0&&(this.renderBackgroundColor(e,t),this.renderBackgroundImage(e,t,r))},n.prototype.renderBackgroundColor=function(e,t){var r=e.color("backgroundColor");r.isTransparent()||this.rectangle(t.left,t.top,t.width,t.height,r)},n.prototype.renderBorders=function(e){e.forEach(this.renderBorder,this)},n.prototype.renderBorder=function(e){e.color.isTransparent()||null===e.args||this.drawShape(e.args,e.color)},n.prototype.renderBackgroundImage=function(e,t,r){e.parseBackgroundImages().reverse().forEach(function(n,i,o){switch(n.method){case"url":var s=this.images.get(n.args[0]);s?this.renderBackgroundRepeating(e,t,s,o.length-(i+1),r):a("Error loading background-image",n.args[0]);break;case"linear-gradient":case"gradient":var l=this.images.get(n.value);l?this.renderBackgroundGradient(l,t,r):a("Error loading background-image",n.args[0]);break;case"none":break;default:a("Unknown background-image type",n.args[0])}},this)},n.prototype.renderBackgroundRepeating=function(e,t,r,n,a){var i=e.parseBackgroundSize(t,r.image,n),o=e.parseBackgroundPosition(t,r.image,n,i);switch(e.parseBackgroundRepeat(n)){case"repeat-x":case"repeat no-repeat":this.backgroundRepeatShape(r,o,i,t,t.left+a[3],t.top+o.top+a[0],99999,i.height,a);break;case"repeat-y":case"no-repeat repeat":this.backgroundRepeatShape(r,o,i,t,t.left+o.left+a[3],t.top+a[0],i.width,99999,a);break;case"no-repeat":this.backgroundRepeatShape(r,o,i,t,t.left+o.left+a[3],t.top+o.top+a[0],i.width,i.height,a);break;default:this.renderBackgroundRepeat(r,o,i,{top:t.top,left:t.left},a[3],a[0])}},t.exports=n},{"./log":13}],20:[function(e,t,r){function n(e,t){i.apply(this,arguments),this.canvas=this.options.canvas||this.document.createElement("canvas"),this.options.canvas||(this.canvas.width=e,this.canvas.height=t),this.ctx=this.canvas.getContext("2d"),this.taintCtx=this.document.createElement("canvas").getContext("2d"),this.ctx.textBaseline="bottom",this.variables={},s("Initialized CanvasRenderer with size",e,"x",t)}function a(e){return e.length>0}var i=e("../renderer"),o=e("../lineargradientcontainer"),s=e("../log");(n.prototype=Object.create(i.prototype)).setFillStyle=function(e){return this.ctx.fillStyle="object"==typeof e&&e.isColor?e.toString():e,this.ctx},n.prototype.rectangle=function(e,t,r,n,a){this.setFillStyle(a).fillRect(e,t,r,n)},n.prototype.circle=function(e,t,r,n){this.setFillStyle(n),this.ctx.beginPath(),this.ctx.arc(e+r/2,t+r/2,r/2,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill()},n.prototype.circleStroke=function(e,t,r,n,a,i){this.circle(e,t,r,n),this.ctx.strokeStyle=i.toString(),this.ctx.stroke()},n.prototype.drawShape=function(e,t){this.shape(e),this.setFillStyle(t).fill()},n.prototype.taints=function(e){if(null===e.tainted){this.taintCtx.drawImage(e.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),e.tainted=!1}catch(t){this.taintCtx=document.createElement("canvas").getContext("2d"),e.tainted=!0}}return e.tainted},n.prototype.drawImage=function(e,t,r,n,a,i,o,s,l){this.taints(e)&&!this.options.allowTaint||this.ctx.drawImage(e.image,t,r,n,a,i,o,s,l)},n.prototype.clip=function(e,t,r){this.ctx.save(),e.filter(a).forEach(function(e){this.shape(e).clip()},this),t.call(r),this.ctx.restore()},n.prototype.shape=function(e){return this.ctx.beginPath(),e.forEach(function(e,t){"rect"===e[0]?this.ctx.rect.apply(this.ctx,e.slice(1)):this.ctx[0===t?"moveTo":e[0]+"To"].apply(this.ctx,e.slice(1))},this),this.ctx.closePath(),this.ctx},n.prototype.font=function(e,t,r,n,a,i){this.setFillStyle(e).font=[t,r,n,a,i].join(" ").split(",")[0]},n.prototype.fontShadow=function(e,t,r,n){this.setVariable("shadowColor",e.toString()).setVariable("shadowOffsetY",t).setVariable("shadowOffsetX",r).setVariable("shadowBlur",n)},n.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")},n.prototype.setOpacity=function(e){this.ctx.globalAlpha=e},n.prototype.setTransform=function(e){this.ctx.translate(e.origin[0],e.origin[1]),this.ctx.transform.apply(this.ctx,e.matrix),this.ctx.translate(-e.origin[0],-e.origin[1])},n.prototype.setVariable=function(e,t){return this.variables[e]!==t&&(this.variables[e]=this.ctx[e]=t),this},n.prototype.text=function(e,t,r){this.ctx.fillText(e,t,r)},n.prototype.backgroundRepeatShape=function(e,t,r,n,a,i,o,s,l){var c=[["line",Math.round(a),Math.round(i)],["line",Math.round(a+o),Math.round(i)],["line",Math.round(a+o),Math.round(s+i)],["line",Math.round(a),Math.round(s+i)]];this.clip([c],function(){this.renderBackgroundRepeat(e,t,r,n,l[3],l[0])},this)},n.prototype.renderBackgroundRepeat=function(e,t,r,n,a,i){var o=Math.round(n.left+t.left+a),s=Math.round(n.top+t.top+i);this.setFillStyle(this.ctx.createPattern(this.resizeImage(e,r),"repeat")),this.ctx.translate(o,s),this.ctx.fill(),this.ctx.translate(-o,-s)},n.prototype.renderBackgroundGradient=function(e,t){if(e instanceof o){var r=this.ctx.createLinearGradient(t.left+t.width*e.x0,t.top+t.height*e.y0,t.left+t.width*e.x1,t.top+t.height*e.y1);e.colorStops.forEach(function(e){r.addColorStop(e.stop,e.color.toString())}),this.rectangle(t.left,t.top,t.width,t.height,r)}},n.prototype.resizeImage=function(e,t){var r=e.image;if(r.width===t.width&&r.height===t.height)return r;var n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(r,0,0,r.width,r.height,0,0,t.width,t.height),n},t.exports=n},{"../lineargradientcontainer":12,"../log":13,"../renderer":19}],21:[function(e,t,r){function n(e,t,r,n){a.call(this,r,n),this.ownStacking=e,this.contexts=[],this.children=[],this.opacity=(this.parent?this.parent.stack.opacity:1)*t}var a=e("./nodecontainer");(n.prototype=Object.create(a.prototype)).getParentStack=function(e){var t=this.parent?this.parent.stack:null;return t?t.ownStacking?t:t.getParentStack(e):e.stack},t.exports=n},{"./nodecontainer":14}],22:[function(e,t,r){function n(e){this.rangeBounds=this.testRangeBounds(e),this.cors=this.testCORS(),this.svg=this.testSVG()}n.prototype.testRangeBounds=function(e){var t,r,n=!1;return e.createRange&&(t=e.createRange()).getBoundingClientRect&&((r=e.createElement("boundtest")).style.height="123px",r.style.display="block",e.body.appendChild(r),t.selectNode(r),123===t.getBoundingClientRect().height&&(n=!0),e.body.removeChild(r)),n},n.prototype.testCORS=function(){return void 0!==(new Image).crossOrigin},n.prototype.testSVG=function(){var e=new Image,t=document.createElement("canvas"),r=t.getContext("2d");e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),t.toDataURL()}catch(e){return!1}return!0},t.exports=n},{}],23:[function(e,t,r){function n(e){this.src=e,this.image=null;var t=this;this.promise=this.hasFabric().then(function(){return t.isInline(e)?Promise.resolve(t.inlineFormatting(e)):a(e)}).then(function(e){return new Promise(function(r){window.html2canvas.svg.fabric.loadSVGFromString(e,t.createCanvas.call(t,r))})})}var a=e("./xhr"),i=e("./utils").decode64;n.prototype.hasFabric=function(){return window.html2canvas.svg&&window.html2canvas.svg.fabric?Promise.resolve():Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg"))},n.prototype.inlineFormatting=function(e){return/^data:image\/svg\+xml;base64,/.test(e)?this.decode64(this.removeContentType(e)):this.removeContentType(e)},n.prototype.removeContentType=function(e){return e.replace(/^data:image\/svg\+xml(;base64)?,/,"")},n.prototype.isInline=function(e){return/^data:image\/svg\+xml/i.test(e)},n.prototype.createCanvas=function(e){var t=this;return function(r,n){var a=new window.html2canvas.svg.fabric.StaticCanvas("c");t.image=a.lowerCanvasEl,a.setWidth(n.width).setHeight(n.height).add(window.html2canvas.svg.fabric.util.groupSVGElements(r,n)).renderAll(),e(a.lowerCanvasEl)}},n.prototype.decode64=function(e){return"function"==typeof window.atob?window.atob(e):i(e)},t.exports=n},{"./utils":26,"./xhr":28}],24:[function(e,t,r){function n(e,t){this.src=e,this.image=null;var r=this;this.promise=t?new Promise(function(t,n){r.image=new Image,r.image.onload=t,r.image.onerror=n,r.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(e),!0===r.image.complete&&t(r.image)}):this.hasFabric().then(function(){return new Promise(function(t){window.html2canvas.svg.fabric.parseSVGDocument(e,r.createCanvas.call(r,t))})})}var a=e("./svgcontainer");n.prototype=Object.create(a.prototype),t.exports=n},{"./svgcontainer":23}],25:[function(e,t,r){function n(e,t){i.call(this,e,t)}function a(e,t,r){if(e.length>0)return t+r.toUpperCase()}var i=e("./nodecontainer");(n.prototype=Object.create(i.prototype)).applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))},n.prototype.transform=function(e){var t=this.node.data;switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,a);case"uppercase":return t.toUpperCase();default:return t}},t.exports=n},{"./nodecontainer":14}],26:[function(e,t,r){r.smallImage=function(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},r.bind=function(e,t){return function(){return e.apply(t,arguments)}},r.decode64=function(e){var t,r,n,a,i,o,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=e.length,u="";for(t=0;t<c;t+=4)i=l.indexOf(e[t])<<2|(r=l.indexOf(e[t+1]))>>4,o=(15&r)<<4|(n=l.indexOf(e[t+2]))>>2,s=(3&n)<<6|(a=l.indexOf(e[t+3])),u+=64===n?String.fromCharCode(i):64===a||-1===a?String.fromCharCode(i,o):String.fromCharCode(i,o,s);return u},r.getBounds=function(e){if(e.getBoundingClientRect){var t=e.getBoundingClientRect(),r=null==e.offsetWidth?t.width:e.offsetWidth;return{top:t.top,bottom:t.bottom||t.top+t.height,right:t.left+r,left:t.left,width:r,height:null==e.offsetHeight?t.height:e.offsetHeight}}return{}},r.offsetBounds=function(e){var t=e.offsetParent?r.offsetBounds(e.offsetParent):{top:0,left:0};return{top:e.offsetTop+t.top,bottom:e.offsetTop+e.offsetHeight+t.top,right:e.offsetLeft+t.left+e.offsetWidth,left:e.offsetLeft+t.left,width:e.offsetWidth,height:e.offsetHeight}},r.parseBackgrounds=function(e){var t,r,n,a,i,o,s,l=[],c=0,u=0,$=function(){t&&('"'===r.substr(0,1)&&(r=r.substr(1,r.length-2)),r&&s.push(r),"-"===t.substr(0,1)&&(a=t.indexOf("-",1)+1)>0&&(n=t.substr(0,a),t=t.substr(a)),l.push({prefix:n,method:t.toLowerCase(),value:i,args:s,image:null})),s=[],t=n=r=i=""};return s=[],t=n=r=i="",e.split("").forEach(function(e){if(!(0===c&&" \r\n\t".indexOf(e)>-1)){switch(e){case'"':o?o===e&&(o=null):o=e;break;case"(":if(o)break;if(0===c)return c=1,void(i+=e);u++;break;case")":if(o)break;if(1===c){if(0===u)return c=0,i+=e,void $();u--}break;case",":if(o)break;if(0===c)return void $();if(1===c&&0===u&&!t.match(/^url$/i))return s.push(r),r="",void(i+=e)}i+=e,0===c?t+=e:r+=e}}),$(),l}},{}],27:[function(e,t,r){function n(e){a.apply(this,arguments),this.type="linear"===e.args[0]?a.TYPES.LINEAR:a.TYPES.RADIAL}var a=e("./gradientcontainer");n.prototype=Object.create(a.prototype),t.exports=n},{"./gradientcontainer":9}],28:[function(e,t,r){t.exports=function(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200===n.status?t(n.responseText):r(new Error(n.statusText))},n.onerror=function(){r(new Error("Network Error"))},n.send()})}},{}]},{},[4])(4)}),function(e){var t;t=function(){function t(e){var t,r,n,a,i,o,s,l,c,u,$,f,p,d,h;for(this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},o=null;;){switch(t=this.readUInt32(),u=function(){var e,t;for(t=[],s=e=0;e<4;s=++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":o&&this.animation.frames.push(o),this.pos+=4,o={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},i=this.readUInt16(),a=this.readUInt16()||100,o.delay=1e3*i/a,o.disposeOp=this.data[this.pos++],o.blendOp=this.data[this.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===u&&(this.pos+=4,t-=4),e=(null!=o?o.data:void 0)||this.imgData,s=p=0;0<=t?p<t:p>t;s=0<=t?++p:--p)e.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(n=this.palette.length/3,this.transparency.indexed=this.read(t),this.transparency.indexed.length>n)throw new Error("More transparent colors than palette size");if(($=n-this.transparency.indexed.length)>0)for(s=d=0;0<=$?d<$:d>$;s=0<=$?++d:--d)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":l=(f=this.read(t)).indexOf(0),c=String.fromCharCode.apply(String,f.slice(0,l)),this.text[c]=String.fromCharCode.apply(String,f.slice(l+1));break;case"IEND":return o&&this.animation.frames.push(o),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(h=this.colorType)||6===h,r=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*r,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}var r,n,a;t.load=function(e,r,n){var a;return"function"==typeof r&&(n=r),(a=new XMLHttpRequest).open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){var e,i;return e=new Uint8Array(a.response||a.mozResponseArrayBuffer),i=new t(e),"function"==typeof(null!=r?r.getContext:void 0)&&i.render(r),"function"==typeof n?n(i):void 0},a.send(null)},t.prototype.read=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;0<=e?++t:--t)r.push(this.data[this.pos++]);return r},t.prototype.readUInt32=function(){var e,t,r,n;return e=this.data[this.pos++]<<24,t=this.data[this.pos++]<<16,r=this.data[this.pos++]<<8,n=this.data[this.pos++],e|t|r|n},t.prototype.readUInt16=function(){var e,t;return e=this.data[this.pos++]<<8,t=this.data[this.pos++],e|t},t.prototype.decodePixels=function(e){var t,r,n,a,i,o,s,l,c,$,f,p,d,h,_,g,m,y,v,b,x,w,A;if(null==e&&(e=this.imgData),0===e.length)return new Uint8Array(0);for(e=(e=new u(e)).getBytes(),g=(p=this.pixelBitlength/8)*this.width,d=new Uint8Array(g*this.height),o=e.length,_=0,h=0,r=0;h<o;){switch(e[h++]){case 0:for(a=v=0;v<g;a=v+=1)d[r++]=e[h++];break;case 1:for(a=b=0;b<g;a=b+=1)t=e[h++],i=a<p?0:d[r-p],d[r++]=(t+i)%256;break;case 2:for(a=x=0;x<g;a=x+=1)t=e[h++],n=(a-a%p)/p,m=_&&d[(_-1)*g+n*p+a%p],d[r++]=(m+t)%256;break;case 3:for(a=w=0;w<g;a=w+=1)t=e[h++],n=(a-a%p)/p,i=a<p?0:d[r-p],m=_&&d[(_-1)*g+n*p+a%p],d[r++]=(t+Math.floor((i+m)/2))%256;break;case 4:for(a=A=0;A<g;a=A+=1)t=e[h++],n=(a-a%p)/p,i=a<p?0:d[r-p],0===_?m=y=0:(m=d[(_-1)*g+n*p+a%p],y=n&&d[(_-1)*g+(n-1)*p+a%p]),s=i+m-y,l=Math.abs(s-i),$=Math.abs(s-m),f=Math.abs(s-y),c=l<=$&&l<=f?i:$<=f?m:y,d[r++]=(t+c)%256;break;default:throw new Error("Invalid filter algorithm: "+e[h-1])}_++}return d},t.prototype.decodePalette=function(){var e,t,r,n,a,i,o,s,l;for(r=this.palette,i=this.transparency.indexed||[],a=new Uint8Array((i.length||0)+r.length),n=0,e=0,t=o=0,s=r.length;o<s;t=o+=3)a[n++]=r[t],a[n++]=r[t+1],a[n++]=r[t+2],a[n++]=null!=(l=i[e++])?l:255;return a},t.prototype.copyToImageData=function(e,t){var r,n,a,i,o,s,l,c,u,$,f;if(n=this.colors,u=null,r=this.hasAlphaChannel,this.palette.length&&(u=null!=(f=this._decodedPalette)?f:this._decodedPalette=this.decodePalette(),n=4,r=!0),a=e.data||e,c=a.length,o=u||t,i=s=0,1===n)for(;i<c;)l=u?4*t[i/4]:s,$=o[l++],a[i++]=$,a[i++]=$,a[i++]=$,a[i++]=r?o[l++]:255,s=l;else for(;i<c;)l=u?4*t[i/4]:s,a[i++]=o[l++],a[i++]=o[l++],a[i++]=o[l++],a[i++]=r?o[l++]:255,s=l},t.prototype.decode=function(){var e;return e=new Uint8Array(this.width*this.height*4),this.copyToImageData(e,this.decodePixels()),e};try{n=e.document.createElement("canvas"),a=n.getContext("2d")}catch(e){return-1}return r=function(e){var t;return a.width=e.width,a.height=e.height,a.clearRect(0,0,e.width,e.height),a.putImageData(e,0,0),t=new Image,t.src=n.toDataURL(),t},t.prototype.decodeFrames=function(e){var t,n,a,i,o,s,l,c;if(this.animation){for(c=[],n=o=0,s=(l=this.animation.frames).length;o<s;n=++o)t=l[n],a=e.createImageData(t.width,t.height),i=this.decodePixels(new Uint8Array(t.data)),this.copyToImageData(a,i),t.imageData=a,c.push(t.image=r(a));return c}},t.prototype.renderFrame=function(e,t){var r,n,a;return n=this.animation.frames,r=n[t],a=n[t-1],0===t&&e.clearRect(0,0,this.width,this.height),1===(null!=a?a.disposeOp:void 0)?e.clearRect(a.xOffset,a.yOffset,a.width,a.height):2===(null!=a?a.disposeOp:void 0)&&e.putImageData(a.imageData,a.xOffset,a.yOffset),0===r.blendOp&&e.clearRect(r.xOffset,r.yOffset,r.width,r.height),e.drawImage(r.image,r.xOffset,r.yOffset)},t.prototype.animate=function(e){var t,r,n,a,i,o,s=this;return r=0,o=this.animation,a=o.numFrames,n=o.frames,i=o.numPlays,(t=function(){var o,l;if(o=r++%a,l=n[o],s.renderFrame(e,o),a>1&&r/a<i)return s.animation._timeout=setTimeout(t,l.delay)})()},t.prototype.stopAnimation=function(){var e;return clearTimeout(null!=(e=this.animation)?e._timeout:void 0)},t.prototype.render=function(e){var t,r;return e._png&&e._png.stopAnimation(),e._png=this,e.width=this.width,e.height=this.height,t=e.getContext("2d"),this.animation?(this.decodeFrames(t),this.animate(t)):(r=t.createImageData(this.width,this.height),this.copyToImageData(r,this.decodePixels()),t.putImageData(r,0,0))},t}(),e.PNG=t}("undefined"!=typeof window&&window||void 0);var c=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var t=this.buffer,r=t?t.byteLength:0;if(e<r)return t;for(var n=512;n<e;)n<<=1;for(var a=new Uint8Array(n),i=0;i<r;++i)a[i]=t[i];return this.buffer=a},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var t=this.pos;if(e){for(this.ensureBuffer(t+e),n=t+e;!this.eof&&this.bufferLength<n;)this.readBlock();var r=this.bufferLength;n>r&&(n=r)}else{for(;!this.eof;)this.readBlock();var n=this.bufferLength}return this.pos=n,this.buffer.subarray(t,n)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,t,r){for(var n=e+t;this.bufferLength<=n&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,t,r)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),u=function(){function e(e){throw new Error(e)}function t(t){var r=0,n=t[r++],a=t[r++];-1!=n&&-1!=a||e("Invalid header in flate stream"),8!=(15&n)&&e("Unknown compression method in flate stream"),((n<<8)+a)%31!=0&&e("Bad FCHECK in flate stream"),32&a&&e("FDICT bit set in flate stream"),this.bytes=t,this.bytesPos=r,this.codeSize=0,this.codeBuf=0,c.call(this)}if("undefined"!=typeof Uint32Array){var r=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),a=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),i=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],o=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];return t.prototype=Object.create(c.prototype),t.prototype.getBits=function(t){for(var r,n=this.codeSize,a=this.codeBuf,i=this.bytes,o=this.bytesPos;n<t;)void 0===(r=i[o++])&&e("Bad encoding in flate stream"),a|=r<<n,n+=8;return r=a&(1<<t)-1,this.codeBuf=a>>t,this.codeSize=n-=t,this.bytesPos=o,r},t.prototype.getCode=function(t){for(var r=t[0],n=t[1],a=this.codeSize,i=this.codeBuf,o=this.bytes,s=this.bytesPos;a<n;){var l;void 0===(l=o[s++])&&e("Bad encoding in flate stream"),i|=l<<a,a+=8}var c=r[i&(1<<n)-1],u=c>>16,$=65535&c;return(0==a||a<u||0==u)&&e("Bad encoding in flate stream"),this.codeBuf=i>>u,this.codeSize=a-u,this.bytesPos=s,$},t.prototype.generateHuffmanTable=function(e){for(var t=e.length,r=0,n=0;n<t;++n)e[n]>r&&(r=e[n]);for(var a=1<<r,i=new Uint32Array(a),o=1,s=0,l=2;o<=r;++o,s<<=1,l<<=1)for(var c=0;c<t;++c)if(e[c]==o){for(var u=0,$=s,n=0;n<o;++n)u=u<<1|1&$,$>>=1;for(n=u;n<a;n+=l)i[n]=o<<16|c;++s}return[i,r]},t.prototype.readBlock=function(){function t(e,t,r,n,a){for(var i=e.getBits(r)+n;i-- >0;)t[d++]=a}var s=this.getBits(3);if(1&s&&(this.eof=!0),0!=(s>>=1)){var l,c;if(1==s)l=i,c=o;else if(2==s){for(var u=this.getBits(5)+257,$=this.getBits(5)+1,f=this.getBits(4)+4,p=Array(r.length),d=0;d<f;)p[r[d++]]=this.getBits(3);for(var h=this.generateHuffmanTable(p),_=0,d=0,g=u+$,m=new Array(g);d<g;){var y=this.getCode(h);16==y?t(this,m,2,3,_):17==y?t(this,m,3,3,_=0):18==y?t(this,m,7,11,_=0):m[d++]=_=y}l=this.generateHuffmanTable(m.slice(0,u)),c=this.generateHuffmanTable(m.slice(u,g))}else e("Unknown block type in flate stream");for(var v=(P=this.buffer)?P.length:0,b=this.bufferLength;;){var x=this.getCode(l);if(x<256)b+1>=v&&(v=(P=this.ensureBuffer(b+1)).length),P[b++]=x;else{if(256==x)return void(this.bufferLength=b);var w=(x=n[x-=257])>>16;w>0&&(w=this.getBits(w)),_=(65535&x)+w,x=this.getCode(c),(w=(x=a[x])>>16)>0&&(w=this.getBits(w));var A=(65535&x)+w;b+_>=v&&(v=(P=this.ensureBuffer(b+_)).length);for(var k=0;k<_;++k,++b)P[b]=P[b-A]}}}else{var E,C=this.bytes,S=this.bytesPos;void 0===(E=C[S++])&&e("Bad block header in flate stream");var I=E;void 0===(E=C[S++])&&e("Bad block header in flate stream"),I|=E<<8,void 0===(E=C[S++])&&e("Bad block header in flate stream");var O=E;void 0===(E=C[S++])&&e("Bad block header in flate stream"),(O|=E<<8)!=(65535&~I)&&e("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var T=this.bufferLength,P=this.ensureBuffer(T+I),M=T+I;this.bufferLength=M
;for(var N=T;N<M;++N){if(void 0===(E=C[S++])){this.eof=!0;break}P[N]=E}this.bytesPos=S}},t}}();return function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";void 0===e.btoa&&(e.btoa=function(e){var r,n,a,i,o,s=0,l=0,c="",u=[];if(!e)return e;do{r=(o=e.charCodeAt(s++)<<16|e.charCodeAt(s++)<<8|e.charCodeAt(s++))>>18&63,n=o>>12&63,a=o>>6&63,i=63&o,u[l++]=t.charAt(r)+t.charAt(n)+t.charAt(a)+t.charAt(i)}while(s<e.length);c=u.join("");var $=e.length%3;return($?c.slice(0,$-3):c)+"===".slice($||3)}),void 0===e.atob&&(e.atob=function(e){var r,n,a,i,o,s,l=0,c=0,u=[];if(!e)return e;e+="";do{r=(s=t.indexOf(e.charAt(l++))<<18|t.indexOf(e.charAt(l++))<<12|(i=t.indexOf(e.charAt(l++)))<<6|(o=t.indexOf(e.charAt(l++))))>>16&255,n=s>>8&255,a=255&s,u[c++]=64==i?String.fromCharCode(r):64==o?String.fromCharCode(r,n):String.fromCharCode(r,n,a)}while(l<e.length);return u.join("")}),Array.prototype.map||(Array.prototype.map=function(e){if(void 0===this||null===this||"function"!=typeof e)throw new TypeError;for(var t=Object(this),r=t.length>>>0,n=new Array(r),a=arguments.length>1?arguments[1]:void 0,i=0;i<r;i++)i in t&&(n[i]=e.call(a,t[i],i,t));return n}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if(void 0===this||null===this||"function"!=typeof e)throw new TypeError;for(var r=Object(this),n=r.length>>>0,a=0;a<n;a++)a in r&&e.call(t,r[a],a,r)}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(a){if("object"!=typeof a&&("function"!=typeof a||null===a))throw new TypeError;var i,o,s=[];for(i in a)e.call(a,i)&&s.push(i);if(t)for(o=0;o<n;o++)e.call(a,r[o])&&s.push(r[o]);return s}}()),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")}),String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")})}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||void 0),a})},{}],83:[function(e,t,r){function n(e,t){return t=t||{},function(r,n,a){return i(r,e,t)}}function a(e,t){e=e||{},t=t||{};var r={};return Object.keys(t).forEach(function(e){r[e]=t[e]}),Object.keys(e).forEach(function(t){r[t]=e[t]}),r}function i(e,t,r){if("string"!=typeof t)throw new TypeError("glob pattern string required");return r||(r={}),!(!r.nocomment&&"#"===t.charAt(0))&&(""===t.trim()?""===e:new o(t,r).match(e))}function o(e,t){if(!(this instanceof o))return new o(e,t);if("string"!=typeof e)throw new TypeError("glob pattern string required");t||(t={}),e=e.trim(),"/"!==h.sep&&(e=e.split(h.sep).join("/")),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}function s(){if(!this._made){var e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();var r=this.globSet=this.braceExpand();t.debug&&(this.debug=console.error),this.debug(this.pattern,r),r=this.globParts=r.map(function(e){return e.split(A)}),this.debug(this.pattern,r),r=r.map(function(e,t,r){return e.map(this.parse,this)},this),this.debug(this.pattern,r),r=r.filter(function(e){return-1===e.indexOf(!1)}),this.debug(this.pattern,r),this.set=r}}function l(){var e=this.pattern,t=!1,r=this.options,n=0;if(!r.nonegate){for(var a=0,i=e.length;a<i&&"!"===e.charAt(a);a++)t=!t,n++;n&&(this.pattern=e.substr(n)),this.negate=t}}function c(e,t){if(t||(t=this instanceof o?this.options:{}),void 0===(e=void 0===e?this.pattern:e))throw new TypeError("undefined pattern");return t.nobrace||!e.match(/\{.*\}/)?[e]:g(e)}function u(e,t){function r(){if(a){switch(a){case"*":o+=v,s=!0;break;case"?":o+=y,s=!0;break;default:o+="\\"+a}g.debug("clearStateChar %j %j",a,o),a=!1}}if(e.length>65536)throw new TypeError("pattern is too long");var n=this.options;if(!n.noglobstar&&"**"===e)return _;if(""===e)return"";for(var a,i,o="",s=!!n.nocase,l=!1,c=[],u=[],$=!1,f=-1,d=-1,h="."===e.charAt(0)?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=this,b=0,x=e.length;b<x&&(i=e.charAt(b));b++)if(this.debug("%s\t%s %s %j",e,b,o,i),l&&w[i])o+="\\"+i,l=!1;else switch(i){case"/":return!1;case"\\":r(),l=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,b,o,i),$){this.debug("  in class"),"!"===i&&b===d+1&&(i="^"),o+=i;continue}g.debug("call clearStateChar %j",a),r(),a=i,n.noext&&r();continue;case"(":if($){o+="(";continue}if(!a){o+="\\(";continue}c.push({type:a,start:b-1,reStart:o.length,open:m[a].open,close:m[a].close}),o+="!"===a?"(?:(?!(?:":"(?:",this.debug("plType %j %j",a,o),a=!1;continue;case")":if($||!c.length){o+="\\)";continue}r(),s=!0;var A=c.pop();o+=A.close,"!"===A.type&&u.push(A),A.reEnd=o.length;continue;case"|":if($||!c.length||l){o+="\\|",l=!1;continue}r(),o+="|";continue;case"[":if(r(),$){o+="\\"+i;continue}$=!0,d=b,f=o.length,o+=i;continue;case"]":if(b===d+1||!$){o+="\\"+i,l=!1;continue}if($){var E=e.substring(d+1,b);try{RegExp("["+E+"]")}catch(e){var C=this.parse(E,k);o=o.substr(0,f)+"\\["+C[0]+"\\]",s=s||C[1],$=!1;continue}}s=!0,$=!1,o+=i;continue;default:r(),l?l=!1:!w[i]||"^"===i&&$||(o+="\\"),o+=i}for($&&(E=e.substr(d+1),C=this.parse(E,k),o=o.substr(0,f)+"\\["+C[0],s=s||C[1]),A=c.pop();A;A=c.pop()){var S=o.slice(A.reStart+A.open.length);this.debug("setting tail",o,A),S=S.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(e,t,r){return r||(r="\\"),t+t+r+"|"}),this.debug("tail=%j\n   %s",S,S,A,o);var I="*"===A.type?v:"?"===A.type?y:"\\"+A.type;s=!0,o=o.slice(0,A.reStart)+I+"\\("+S}r(),l&&(o+="\\\\");var O=!1;switch(o.charAt(0)){case".":case"[":case"(":O=!0}for(var T=u.length-1;T>-1;T--){var P=u[T],M=o.slice(0,P.reStart),N=o.slice(P.reStart,P.reEnd-8),B=o.slice(P.reEnd-8,P.reEnd),R=o.slice(P.reEnd);B+=R;var j=M.split("(").length-1,F=R;for(b=0;b<j;b++)F=F.replace(/\)[+*?]?/,"");R=F;var D="";""===R&&t!==k&&(D="$");o=M+N+R+D+B}if(""!==o&&s&&(o="(?=.)"+o),O&&(o=h+o),t===k)return[o,s];if(!s)return p(e);var L=n.nocase?"i":"";try{var z=new RegExp("^"+o+"$",L)}catch(e){return new RegExp("$.")}return z._glob=e,z._src=o,z}function $(){if(this.regexp||!1===this.regexp)return this.regexp;var e=this.set;if(!e.length)return this.regexp=!1,this.regexp;var t=this.options,r=t.noglobstar?v:t.dot?b:x,n=t.nocase?"i":"",a=e.map(function(e){return e.map(function(e){return e===_?r:"string"==typeof e?d(e):e._src}).join("\\/")}).join("|");a="^(?:"+a+")$",this.negate&&(a="^(?!"+a+").*$");try{this.regexp=new RegExp(a,n)}catch(e){this.regexp=!1}return this.regexp}function f(e,t){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;var r=this.options;"/"!==h.sep&&(e=e.split(h.sep).join("/")),e=e.split(A),this.debug(this.pattern,"split",e);var n=this.set;this.debug(this.pattern,"set",n);var a,i;for(i=e.length-1;i>=0&&!(a=e[i]);i--);for(i=0;i<n.length;i++){var o=n[i],s=e;r.matchBase&&1===o.length&&(s=[a]);if(this.matchOne(s,o,t))return!!r.flipNegate||!this.negate}return!r.flipNegate&&this.negate}function p(e){return e.replace(/\\(.)/g,"$1")}function d(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}t.exports=i,i.Minimatch=o;var h={sep:"/"};try{h=e("path")}catch(e){}var _=i.GLOBSTAR=o.GLOBSTAR={},g=e("brace-expansion"),m={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},y="[^/]",v=y+"*?",b="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",x="(?:(?!(?:\\/|^)\\.).)*?",w=function(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}("().*{}+?[]^$\\!"),A=/\/+/;i.filter=n,i.defaults=function(e){if(!e||!Object.keys(e).length)return i;var t=i,r=function(r,n,i){return t.minimatch(r,n,a(e,i))};return r.Minimatch=function(r,n){return new t.Minimatch(r,a(e,n))},r},o.defaults=function(e){return e&&Object.keys(e).length?i.defaults(e).Minimatch:o},o.prototype.debug=function(){},o.prototype.make=s,o.prototype.parseNegate=l,i.braceExpand=function(e,t){return c(e,t)},o.prototype.braceExpand=c,o.prototype.parse=u;var k={};i.makeRe=function(e,t){return new o(e,t||{}).makeRe()},o.prototype.makeRe=$,i.match=function(e,t,r){r=r||{};var n=new o(t,r);return e=e.filter(function(e){return n.match(e)}),n.options.nonull&&!e.length&&e.push(t),e},o.prototype.match=f,o.prototype.matchOne=function(e,t,r){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var a=0,i=0,o=e.length,s=t.length;a<o&&i<s;a++,i++){this.debug("matchOne loop");var l=t[i],c=e[a];if(this.debug(t,l,c),!1===l)return!1;if(l===_){this.debug("GLOBSTAR",[t,l,c]);var u=a,$=i+1;if($===s){for(this.debug("** at the end");a<o;a++)if("."===e[a]||".."===e[a]||!n.dot&&"."===e[a].charAt(0))return!1;return!0}for(;u<o;){var f=e[u];if(this.debug("\nglobstar while",e,u,t,$,f),this.matchOne(e.slice(u),t.slice($),r))return this.debug("globstar found match!",u,o,f),!0;if("."===f||".."===f||!n.dot&&"."===f.charAt(0)){this.debug("dot detected!",e,u,t,$);break}this.debug("globstar swallow a segment, and continue"),u++}return!(!r||(this.debug("\n>>> no match, partial?",e,u,t,$),u!==o))}var p;if("string"==typeof l?(p=n.nocase?c.toLowerCase()===l.toLowerCase():c===l,this.debug("string match",l,c,p)):(p=c.match(l),this.debug("pattern match",l,c,p)),!p)return!1}if(a===o&&i===s)return!0;if(a===o)return r;if(i===s){return a===o-1&&""===e[a]}throw new Error("wtf?")}},{"brace-expansion":44,path:void 0}],84:[function(e,t,r){function n(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function a(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}var i=e("wrappy");t.exports=i(n),t.exports.strict=i(a),n.proto=n(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return n(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return a(this)},configurable:!0})})},{wrappy:86}],85:[function(e,t,r){"use strict";function n(e){return"/"===e.charAt(0)}function a(e){var t=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,r=t.exec(e),n=r[1]||"",a=Boolean(n&&":"!==n.charAt(1));return Boolean(r[2]||a)}t.exports="win32"===process.platform?a:n,t.exports.posix=n,t.exports.win32=a},{}],86:[function(e,t,r){function n(e,t){function r(){for(var t=new Array(arguments.length),r=0;r<t.length;r++)t[r]=arguments[r];var n=e.apply(this,t),a=t[t.length-1];return"function"==typeof n&&n!==a&&Object.keys(a).forEach(function(e){n[e]=a[e]}),n}if(e&&t)return n(e)(t);if("function"!=typeof e)throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(t){r[t]=e[t]}),r}t.exports=n},{}],87:[function(require,module,exports){function AbcJSON(e){var t=Array((e||2)+1).join(" ");AbcJSON.prototype.gen_json=function(e,r,n,a){function i(e,r,n){var a,s,c=e+t;if(h[r]){if("extra"==r){for(o+=$+e+'"extra": [',$="\n",s=n;s;s=s.next)i(c,null,s);o+="\n"+e+"]"}}else{switch(o+=$+e,r&&(o+='"'+r.toString()+'": '),typeof n){case"undefined":o+="null";break;case"object":if(!n){o+="null";break}if(Array.isArray(n)){if(0==n.length){o+="[]";break}for($="[\n",l=n.length,a=0;a<l;a++)i(c,null,n[a]);o+="\n"+e+"]"}else{$="{\n";for(a in n)n.hasOwnProperty(a)&&i(c,a,n[a]);o+="\n"+e+"}"}break;default:o+=JSON.stringify(n)}$=",\n"}}var o,s,l,c,u,$,f=t+t,p=f+t,d=p+t,h={next:!0,prev:!0,ts_next:!0,ts_prev:!0,extra:!0,p_v:!0,dd_st:!0};for(o="",$="{\n",i(t,"music_types",n),$=",\n"+t+'"music_type_ids": {\n',l=n.length,s=0;s<l;s++)n[s]&&(o+=$+f+'"'+n[s]+'": '+s,$=",\n");for($="\n"+t+"},\n",i(t,"info",a),o+=",\n"+t+'"voices": [',c=0,$="\n";;){$+=f+"{\n"+p+'"voice_properties": {\n';for(s in r[c])r[c].hasOwnProperty(s)&&i(d,s,r[c][s]);if(o+="\n"+p+"},\n"+p+'"symbols": [',u=r[c].sym){for($="\n";u;u=u.next)i(d,null,u);o+="\n"+p+"]\n"+f+"}"}else o+="]\n"+p+"}";if($=",\n",!r[++c])break}return o+"\n"+t+"]\n}\n"}}function AbcMIDI(){var e=abc2svg.C;AbcMIDI.prototype.add=function(t,r){function n(){for(var e=0;e<10;e++)for(var t=0;t<7;t++)$[7*e+t]=u[t]}function a(e){for(var t=0;t<7;t++)u[t]=0;switch(e.k_sf){case 7:u[6]=1;case 6:u[2]=1;case 5:u[5]=1;case 4:u[1]=1;case 3:u[4]=1;case 2:u[0]=1;case 1:u[3]=1;break;case-7:u[3]=-1;case-6:u[0]=-1;case-5:u[4]=-1;case-4:u[1]=-1;case-3:u[5]=-1;case-2:u[2]=-1;case-1:u[6]=-1}n()}function i(e,t){return t&&($[e]=3==t?0:t),12*(e/7|0)+c[e%7]+(o[e]||$[e])}var o,s,l,c=new Int8Array([0,2,4,5,7,9,11]),u=new Int8Array(7),$=new Int8Array(70);for(s=0;s<r.length;s++)r[s].sym&&(t=r[s].clef,l=!t.clef_octave||t.clef_oct_transp?0:t.clef_octave,a(r[s].key),function(t){var s,c,u,f,p=r[t].sym,d=p.time,h=[],_=[];for(o=[];p;){switch(p.time>d&&(n(),d=p.time),p.dur&&(d=p.time+p.dur),p.type){case e.BAR:if(p.text)if("1"==p.text[0])for(_=[],rep_tie_time=[],s=0;s<o.length;s++)_[s]=o[s];else if(0!=_.length)for(o=[],h=[],s=0;s<_.length;s++)o[s]=_[s],h[s]=p.time;p.invis||n();break;case e.CLEF:l=!p.clef_octave||p.clef_oct_transp?0:p.clef_octave;break;case e.GRACE:for(c=p.extra;c;c=c.next)if(!c.type==e.NOTE)for(s=0;s<=c.nhd;s++)f=c.notes[s],u=f.apit+19+l,f.midi=i(u,f.acc);break;case e.KEY:a(p);break;case e.NOTE:for(s=0;s<=p.nhd;s++)f=p.notes[s],u=f.apit+19+l,o[u]&&p.time>h[u]&&(delete o[u],delete h[u]),f.midi=i(u,f.acc),f.ti1&&(o[u]=$[u],h[u]=p.time+p.dur)}p=p.next}}(s))}}function AbcPlay(e){function t(){}function r(e,t,r){var a,i=c.get_outputs();if(1==i.length)a=0;else{a=-1;var o=window.prompt("Use \n0: "+i[0]+"\n1: "+i[1]+"?","0");if(o&&(a=Number(o),(isNaN(a)||a<0||a>=i.length)&&(a=-1)),!o||a<0)return void(s.onend&&s.onend())}n(i[a]),c.play(e,t,r)}function n(e){(o="sf2"==e?a:i)&&(c.play=o.play,c.stop=o.stop,o.set_output&&o.set_output(e))}var a,i,o,s=e,l=ToAudio(),c={get_outputs:function(){var e,t=[];return i&&(e=i.get_outputs())&&(t=e),a&&(e=a.get_outputs())&&(t=t.concat(e)),t},set_output:n,clear:l.clear,add:l.add,set_sft:t,set_sfu:function(e){if(void 0==e)return s.sfu;s.sfu=e},set_speed:function(e){if(void 0==e)return s.speed;s.new_speed=e},set_vol:function(e){if(void 0==e)return s.gain;s.gain=e,o&&o.set_vol&&o.set_vol(e)},play:r,stop:t};return s.gain=.7,s.speed=1,function(){try{if(!localStorage)return}catch(e){return}var e=localStorage.getItem("sfu");e&&(s.sfu=e),(e=localStorage.getItem("volume"))&&(s.gain=Number(e))}(),"function"==typeof Midi5&&(i=Midi5(s)),"function"==typeof Audio5&&(a=Audio5(s)),c}function ToAudio(){var e,t,r,n,a=abc2svg.C,i=new Uint8Array([0,2,4,5,7,9,11]);return{clear:function(){var t=e;return e=null,t},add:function(o,s){function l(){var e,t,r,n;for(d=s[0].temper,C=new Int8Array(s.length),e=0;e<s.length;e++)t=s[e],n=t.instr||0,t.midictl&&(t.midictl[32]&&(n+=128*t.midictl[32]),t.midictl[0]&&(n+=128*t.midictl[0]*128)),O[e]=n,r=t.clef,C[e]=!r.clef_octave||r.clef_oct_transp?0:r.clef_octave,S[e]=new Float32Array(70),I[e]=new Float32Array(70),t.key.v=e,c(t.key)}function c(e){var t,r;if(e.k_bagpipe)r=new Float32Array([2.37,1.49,1.53,2.35,1.19,1.51,1.55]);else switch(r=new Float32Array(7),e.k_sf){case 7:r[6]=1;case 6:r[2]=1;case 5:r[5]=1;case 4:r[1]=1;case 3:r[4]=1;case 2:r[0]=1;case 1:r[3]=1;break;case-7:r[3]=-1;case-6:r[0]=-1;case-5:r[4]=-1;case-4:r[1]=-1;case-3:r[5]=-1;case-2:r[2]=-1;case-1:r[6]=-1}for(t=0;t<10;t++)S[e.v].set(r,7*t);I[e.v].set(S[e.v])}function u(e,t){var r=e.notes[t],n=r.apit+19,a=r.acc;return C[e.v]&&(n+=C[e.v]),a?(3==a?a=0:r.micro_n&&(a=(a<0?-r.micro_n:r.micro_n)/r.micro_d*2),p[n]=a):a=p[n],n=12*(n/7|0)+i[n%7]+a,!d||a|0!=a?n:n+d[n%12]}function $(e,t,r){var i,o=e.time+e.dur,s=t.apit,l=s+19;t.acc;for(C[e.v]&&(l+=C[e.v]),e=e.next;;e=e.next){if(!e)return r;if(e==x){var c=e.v;for(e=w.ts_next;e&&e.v!=c;)e=e.ts_next;if(!e)return r;o=e.time}if(e.time!=o)return r;if(e.type==a.NOTE)break}for(i=e.notes.length,h=0;h<i;h++)if(t=e.notes[h],t.apit==s)return r+=e.dur/n,t.ti2=!0,t.ti1?$(e,t,r):r;return r}function f(t,r,n){for(var a=0;a<=t.nhd;a++){var i=t.notes[a];i.ti2||e.push(new Float32Array([t.istart,r,O[t.v],u(t,a),i.ti1?$(t,i,n):n,1,t.v]))}}var p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S=[],I=[],O=[],T=o;for(l(),e?T.time<r&&(r=rep_st_t=T.time):(e=[],r=rep_st_t=t=0,n=a.BLEN/4*120/60);T;){if(T.tempo){for(m=0,_=T.tempo_notes.length,h=0;h<_;h++)m+=T.tempo_notes[h];n=m*T.tempo/60}switch(g=T.time-r,g>0&&(t+=g/n,r=T.time),T==x&&(T=w,r=T.time),p=I[T.v],T.type){case a.BAR:if(T.v!=v)break;if(":"==T.bar_type[0]){if(T.bar_type="|"+T.bar_type.slice(1),w=T,x||(x=T),b){for(T=b,y=0;y<s.length;y++)I[y].set(k[y]),C[y]=A[y];n=E}else T=o,l();r=T.time;break}if(!T.invis)for(y=0;y<s.length;y++)I[y].set(S[y]);if(":"==T.bar_type[T.bar_type.length-1]){for(b=T,x=null,y=0;y<s.length;y++)k||(k=[]),k[y]||(k[y]=new Float32Array(70)),k[y].set(I[y]),A||(A=[]),A[y]=C[y];E=n;break}T.text&&"1"==T.text[0]&&(x=T);break;case a.CLEF:C[T.v]=!T.clef_octave||T.clef_oct_transp?0:T.clef_octave;break;case a.GRACE:0==T.time&&0==r&&(g=0,T.sappo?g=a.BLEN/16:T.next&&T.next.type==a.NOTE||(g=m/2),r-=g),function(e){var r,i,o,s,l,c=e.next;if(e.sappo)s=a.BLEN/16;else if(c&&c.type==a.NOTE||!e.prev||e.prev.type!=a.NOTE){for(c.ts_prev.ts_next=c.ts_next,c.ts_next.ts_prev=c.ts_prev,l=c.ts_next;l;l=l.ts_next)if(l.time!=c.time){c.ts_next=l,c.ts_prev=l.ts_prev,c.ts_prev.ts_next=c,l.ts_prev=c;break}s=c.dots?1==c.dots?c.dur/3:2*c.dur/7:c.dur/2,c.time+=s,c.dur-=s}else s=e.prev.dur/2;for(i=0,r=e.extra;r;r=r.next)r.type==a.NOTE&&i++;for(s/=i*n,o=t,r=e.extra;r;r=r.next)r.type==a.NOTE&&(f(r,o,s),o+=s)}(T);break;case a.KEY:c(T);break;case a.REST:case a.NOTE:m=T.dur,T.next&&T.next.type==a.GRACE&&(g=0,T.next.sappo?g=a.BLEN/16:T.next.next&&T.next.next.type==a.NOTE||(g=m/2),T.next.time-=g,m-=g),m/=n,T.type==a.NOTE?f(T,t,m):e.push(new Float32Array([T.istart,t,0,0,m,0,T.v]));break;case a.STAVES:v=T.sy.top_voice}T=T.ts_next}}}}function Audio5(e){function t(e){var t,r,n,a,i=e.length,o=0;for(n=3*i/4,"="==e[i-1]&&("="==e[i-2]&&n--,n--,i-=4),a=new Uint8Array(n),t=0;t<i;t+=4)r=(b[e[t]]<<18)+(b[e[t+1]]<<12)+(b[e[t+2]]<<6)+b[e[t+3]],a[o++]=r>>16&255,a[o++]=r>>8&255,a[o++]=255&r;return i!=e.length&&(r=(b[e[t]]<<18)+(b[e[t+1]]<<12)+(b[e[t+2]]<<6)+b[e[t+3]],a[o++]=r>>16&255,o<n&&(a[o++]=r>>8&255)),a}function r(e,t){var r,n=e.getChannelData(0);for(r=0;r<t.length;r++)n[r]=t[r]/196608}function n(e,t){var n,a,i,o,s,l,u=e.getInstruments()[0].info;for(y[t]=[],n=0;n<u.length;n++)if(i=u[n].generator,i.sampleID){a=i.sampleID.amount,s=e.sampleHeader[a].sampleRate,l=e.sample[a],o={attack:Math.pow(2,(i.attackVolEnv?i.attackVolEnv.amount:-12e3)/1200),hold:Math.pow(2,(i.holdVolEnv?i.holdVolEnv.amount:-12e3)/1200),decay:Math.pow(2,(i.decayVolEnv?i.decayVolEnv.amount:-12e3)/1200)/3,sustain:i.sustainVolEnv?i.sustainVolEnv.amount/1e3:0,buffer:c.createBuffer(1,l.length,s)},o.hold+=o.attack,o.decay+=o.hold,o.sustain>=.4?o.sustain=.01:o.sustain=1-o.sustain/.4,r(o.buffer,l),i.sampleModes&&1&i.sampleModes.amount&&(o.loopStart=e.sampleHeader[a].startLoop/s,o.loopEnd=e.sampleHeader[a].endLoop/s);var $=(i.scaleTuning?i.scaleTuning.amount:100)/100,f=(i.coarseTune?i.coarseTune.amount:0)+(i.fineTune?i.fineTune.amount:0)/100+e.sampleHeader[a].pitchCorrection/100-(i.overridingRootKey?i.overridingRootKey.amount:e.sampleHeader[a].originalPitch);for(j=i.keyRange.lo;j<=i.keyRange.hi;j++)y[t][j]=Math.pow(Math.pow(2,1/12),(j+f)*$),m[t][j]=o}}function a(e){v++,abc2svg.loadjs(d.sfu+"/"+e+".js",function(){var r=new sf2.Parser(t(abcsf2[e]));r.parse(),n(r,e),v--},function(){g("could not find the instrument "+(e/128|0).toString()+"-"+(e%128).toString()),v--})}function i(e){var t,r,n;for(t=$;(r=e[t])&&!($>=f);t++)n=r[2],m[n]||(m[n]=[],a(n))}function o(e,t,r){var n,a=e[2],i=0|e[3],o=m[a][i],s=c.createBufferSource();if(o){if(s.buffer=o.buffer,o.loopStart&&(s.loop=!0,s.loopStart=o.loopStart,s.loopEnd=o.loopEnd),s.detune){var l=100*e[3]%100;l&&(s.detune.value=l)}s.playbackRate.value=y[a][i],n=c.createGain(),o.hold<.002?n.gain.setValueAtTime(1,t):(o.attack<.002?n.gain.setValueAtTime(1,t):(n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(1,t+o.attack)),n.gain.setValueAtTime(1,t+o.hold)),n.gain.exponentialRampToValueAtTime(o.sustain,t+o.decay),s.connect(n),n.connect(u),s.start(t),s.stop(t+r)}}function s(e){var t,r,n,a,i;if(!(r=e[$])||$>=f)return void h();for(d.new_speed&&(p=c.currentTime-(c.currentTime-p)*d.speed/d.new_speed,d.speed=d.new_speed,d.new_speed=0),t=r[1]/d.speed,n=t+3;;){i=r[4]/d.speed,0!=r[5]&&o(r,t+p,i);var l=r[0];if(a=1e3*(t+p-c.currentTime),setTimeout(_,a,l,!0),setTimeout(_,a+1e3*i,l,!1),!(r=e[++$])||$>=f)return void setTimeout(h,1e3*(t+p-c.currentTime+i));if((t=r[1]/d.speed)>n)break}setTimeout(s,1e3*(t+p-c.currentTime)-300,e)}function l(e){return 0==f?void h():0!=v?void setTimeout(l,300,e):(u.connect(c.destination),p=c.currentTime+.2-e[$][1]*d.speed,void s(e))}var c,u,$,f,p,d=e,h=d.onend||function(){},_=d.onnote||function(){},g=d.errmsg||alert,m=[],y=[],v=0,b=[];return function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=e.length,r=0;r<t;r++)b[e[r]]=r;b["="]=0}(),d.sfu||(d.sfu="Scc1t2"),{get_outputs:function(){return window.AudioContext||window.webkitAudioContext?["sf2"]:null},play:function(e,t,r){if(!r||e>=r.length)return void h();u||(c=d.ac,c||(d.ac=c=new(window.AudioContext||window.webkitAudioContext)),u=c.createGain(),u.gain.value=d.gain),f=t,$=e,i(r),l(r)},stop:function(){f=0,u&&(u.disconnect(),u=null)},set_vol:function(e){u&&(u.gain.value=e)}}}function Midi5(e){function t(e,t,r){var a=0|e[3],i=e[2],o=15&e[6],r=100*e[3]%100;i!=u[o]&&(u[o]=i,n.send(new Uint8Array([176+o,0,i>>14&127,176+o,32,i>>7&127,192+o,127&i]))),r&&Midi5.ma.sysexEnabled&&n.send(new Uint8Array([240,127,127,8,2,127&i,1,a,a,r/.78125,0,247]),t),n.send(new Uint8Array([144+o,a,127]),t),n.send(new Uint8Array([128+o,a,64]),t+r-20)}function r(e){var u,$,f,p,d;if($=e[a],!n||a>=i||!$)return void l();for(s.new_speed&&(o=window-performance.now()-(window.performance.now()-o)*s.speed/s.new_speed,s.speed=s.new_speed,s.new_speed=0),u=$[1]/s.speed*1e3,f=u+3e3;;){if(d=$[4]/s.speed*1e3,0!=$[5]&&t($,u+o,d),p=u+o-window.performance.now(),setTimeout(c,p,$[0],!0),setTimeout(c,p+d,$[0],!1),!($=e[++a])||a>=i)return void setTimeout(l,u+o-window.performance.now()+d);if((u=$[1]/s.speed*1e3)>f)break}setTimeout(r,u+o-window.performance.now()-300,e)}var n,a,i,o,s=e,l=s.onend||function(){},c=s.onnote||function(){},u=[];return{get_outputs:function(){if(Midi5.ma&&(n=Midi5.ma.outputs.values().next().value),n)return[n.name]},set_output:function(e){},play:function(e,t,n){if(!n||e>=n.length)return void l();i=t,a=e,o=window.performance.now()+200-n[a][1]*s.speed*1e3,r(n)},stop:function(){i=0,n&&n.clear&&n.clear()}}}function onMIDISuccess(e){Midi5.ma=e}function onMIDIFailure1(e){navigator.requestMIDIAccess().then(onMIDISuccess,onMIDIFailure2)}function onMIDIFailure2(e){}function isQuoted(e){return e.q}function quote(e){return e.q=!0,e}function unquote(e){return delete e.q,e}function Symbol(e){return this.nm=e,this}function isSymbol(e){return e&&e.constructor===Symbol}function symbolName(e){return e.nm}function isArray(e){return e&&e.constructor===Array}function inDs(e,t){for(var r=e.length-1;0<=r;--r)if(void 0!==e[r][t])return e[r];return!1}function member(e,t){return 0<=t.indexOf(e)}function PsParser(){function e(e){l.L=e,l.N=e.length,l.I=0,l.D=0}function t(){return l.I<l.N&&l.L[l.I]}function r(){return l.I<l.N&&l.L[l.I++]}function n(){for(;l.I<l.N&&member(l.L[l.I]," \t\n");)l.I++}function a(){for(;"%"==t();){for(;t()&&"\n"!=t();)r();n()}}function i(){r();for(var e=[],n=1;0<n&&t();){var a=r();switch(a){case"(":n++;break;case")":n--,n<=0&&(a=!1);break;case"\\":switch(a=r()){case"(":case")":case"\\":break;case"n":a="\n";break;case"r":a="\r";break;case"t":a="\t";break;default:a=!1}}!1!==a&&e.push(a)}return e.join("")}function o(){var e=r();if(member(e,"()<>/% \t\n"))throw new Error("Symbol expected, got "+e);for(var n=member(e,"+-0123456789."),a="."==e,i=[e];t()&&!member(t(),"()<>[]{}/% \t\n");)e=r(),i.push(e),n&&!member(e,"0123456789")&&(a||"."!=e?n=!1:a=!0);return i=i.join(""),1==i.length&&member(i,"+-.")&&(n=!1),n?a?parseFloat(i):parseInt(i,10):new Symbol(i)}function s(){switch(n(),t()){case!1:return;case"%":return a();case"[":case"]":return new Symbol(r());case"{":return l.D++,new Symbol(r());case"}":return l.D--,new Symbol(r());case"/":r();return quote(o());case"(":return i();case"<":if(r(),"<"!=t())throw new Error("Encoded strings not implemented yet");return r(),new Symbol("<<");case">":if(r(),">"!=t())throw new Error("Unexpected >");return r(),new Symbol(">>");default:return o()}}var l=this;return PsParser.prototype.init=e,PsParser.prototype.peek=t,PsParser.prototype.token=s,this}function Ps0(e,t,r){function n(a,i){if(isSymbol(a)&&!isQuoted(a)){var o=symbolName(a),s=inDs(t,o);if(!s)throw new Error("bind error '"+o+"'");r.push([!1,s[o]])}else if(i&&isArray(a)&&isQuoted(a)){if(0<a.length){var l=a[0],c=quote(a.slice(1));0<c.length&&r.push([!1,c]),n(l,!1)}}else"function"==typeof a?a():e.push(a)}function a(){n(e.pop(),!1)}function i(){for(var t=r.pop(),a=(t.shift(),t.pop()),i=0;i<t.length;i++)e.push(t[i]);n(a,!0)}function o(t){for(s.init(t);s.peek();){var n=s.token();if((n||0===n)&&(e.push(n),s.D<=0||isSymbol(n)&&(member(symbolName(n),"[]{}")||"<<"==symbolName(n)||">>"==symbolName(n))))for(a();0<r.length;)i()}return e}var s=new PsParser;return Ps0.prototype.run=n,Ps0.prototype.exec=a,Ps0.prototype.step=i,Ps0.prototype.parse=o,this}function Wps(e){function t(e){if(isSymbol(e)&&!isQuoted(e))return e;if(isArray(e)&&isQuoted(e)){for(var r=e.length,n=[],a=0;a<r;a++){var i=e[a],o=t(i);n=isArray(i)?n.concat(isQuoted(i)?quote([o]):[o]):n.concat(o)}return quote(n)}return e}function r(){var e=arguments;if(e.length)for(var t=0;t<e.length;t++)l.parse(e[t]);else l.parse(e);return a}var n=e,a=[],i={},o=[i],s=[],l=new Ps0(a,o,s);i.true=function(){a.push(!0)},i.false=function(){a.push(!1)},i.null=function(){a.push(null)},i.sub=function(){var e=a.pop();a.push(a.pop()-e)},i.mul=function(){a.push(a.pop()*a.pop())},i.div=function(){var e=a.pop();a.push(a.pop()/e)},i.mod=function(){var e=a.pop();a.push(a.pop()%e)};var c={};i.mark=function(){a.push(c)},i.counttomark=function(){for(var e=0,t=a.length-1;0<=t;t--){if(c===a[t])return a.push(e);e++}throw new Error("Mark not found")},i["<<"]=i.mark,i[">>"]=function(){for(var e={};0<a.length;){var t=a.pop();if(c===t)return a.push(e);e[a.pop()]=t}throw new Error("Mark not found")},i.exch=function(){var e=a.pop(),t=a.pop();a.push(e),a.push(t)},i.clear=function(){a.length=0},i.pop=function(){a.pop()},i.index=function(){a.push(a[a.length-2-a.pop()])},i.roll=function(){var e=a.pop(),t=a.pop(),r=[],n=[];e<0&&(e=t+e);for(var i=0;i<t;i++)i<e?r.unshift(a.pop()):n.unshift(a.pop());for(i=0;i<e;i++)a.push(r.shift());for(i=0;i<t-e;i++)a.push(n.shift())},i.copy=function(){var e=a.pop();if("object"==typeof e){var t=a.pop();for(var r in t)e[r]=t[r];a.push(e)}else for(var t=a.length-e,r=0;r<e;r++)a.push(a[t+r])},i.length=function(){a.push(a.pop().length)},i.astore=function(){for(var e=a.pop(),t=e.length,r=t-1;0<=r;r--)e[r]=a.pop();a.push(e)},i.array=function(){a.push(new Array(a.pop()))},i.eq=function(){var e=a.pop(),t=a.pop();a.push(t==e)},i.lt=function(){var e=a.pop(),t=a.pop();a.push(t<e)},i.ifelse=function(){var e=a.pop(),t=a.pop(),r=a.pop();s.push([!1,!0===r?t:e])},i.and=function(){var e=a.pop(),t=a.pop();if(!0===e||!1===e)return void a.push(1==e&&!0===t);a.push(e&t)},i.repeat=function e(){var t=a.pop(),r=a.pop();1<r&&s.push([!0,r-1,t,e]),0<r&&s.push([!1,t])},i.for=function e(){var t=a.pop(),r=a.pop(),n=a.pop(),i=a.pop();n<0?(r<=i+n&&s.push([!0,i+n,n,r,t,e]),r<=i&&s.push([!1,i,t])):(i+n<=r&&s.push([!0,i+n,n,r,t,e]),i<=r&&s.push([!1,i,t]))},i.exec=function(){s.push([!1,a.pop()])},i.cvx=function(){var e=a.pop();isSymbol(e)&&isQuoted(e)?a.push(unquote(e)):isArray(e)&&!isQuoted(e)?a.push(quote(e)):a.push(e)},i.dict=function(){a.pop(),a.push({})},i.get=function(){var e=a.pop(),t=a.pop();isSymbol(e)?a.push(t[symbolName(e)]):a.push(t[e])},i.getinterval=function(){for(var e=a.pop(),t=a.pop()+e,r=a.pop(),n=[];--e>=0;)n.push(r[t++]);a.push(n)},i.put=function(){var e=a.pop(),t=a.pop(),r=a.pop();isSymbol(t)?r[symbolName(t)]=e:r[t]=e},i.begin=function(){o.push(a.pop())},i.end=function(){o.pop()},i.currentdict=function(){a.push(o[o.length-1])},i.where=function(){var e=symbolName(a.pop()),t=inDs(o,e);t?(a.push(t),a.push(!0)):a.push(!1)},i.save=function(){for(var e=o.slice(),t=0;t<e.length;t++){var r=e[t],n={};for(var i in r)n[i]=r[i];e[t]=n}a.push(e)},i.restore=function(){for(var e=a.pop();0<o.length;)o.pop();for(;0<e.length;)o.unshift(e.pop())},i.type=function(){var e,t=a.pop();if(null===t)e="nulltype";else if(!0===t||!1===t)e="booleantype";else if(c===t)e="marktype";else if("string"==typeof t)e="stringtype";else if(isSymbol(t))e=isQuoted(t)?"nametype":"operatortype";else if("function"==typeof t)e="operatortype";else if(isArray(t))e="arraytype";else if("object"==typeof t)e="dicttype";else{if(1*t!=t)throw new Error("Undefined type '"+t+"'");e=t%1==0?"integertype":"realtype"}a.push(e)};var u=!0;return i[".strictBind"]=function(){u=!0===a.pop()},i.bind=function(){a.push(t(a.pop()))},i["="]=function(){var e=a.pop();alert(e&&e.nm||e)},i["=="]=function(){alert(a.pop())},i.stack=function(){alert(a)},i.pstack=function(){alert(a)},i[".call"]=function(){for(var e=a.pop(),t=a.pop(),r=a.pop(),n=[],i=0;i<e;i++)n.unshift(a.pop());if(!r[t])throw new Error(".call: "+t+" undef");a.push(r[t].apply(r,n))},i[".call0"]=function(){for(var e=a.pop(),t=a.pop(),r=a.pop(),n=[],i=0;i<e;i++)n.unshift(a.pop());if(!r[t])throw new Error(".call0: "+t+" undef");r[t].apply(r,n)},i[".svg"]=function(){a.push(n)},i[".math"]=function(){a.push(Math)},i[".date"]=function(){a.push(new Date)},i[".window"]=function(){a.push(window)},i[".callback"]=function(){var e=a.pop();a.push(function(){for(l.run(e,!0);0<s.length;)l.step()})},i[".minv"]=function(){var e=a.pop(),t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5];a.push([i,r,n,t,n*s-i*o,r*o-t*s])},i[".mmul"]=function(){var e=a.pop(),t=a.pop(),r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],l=t[5],c=e[0],u=e[1],$=e[2],f=e[3],p=e[4],d=e[5];a.push([r*c+n*$,r*u+n*f,i*c+o*$,i*u+o*f,s*c+l*$+p,s*u+l*f+d])},i[".xy"]=function(){var e=a.pop(),t=a.pop(),r=a.pop();a.push(e[0]*r+e[2]*t+e[4]),a.push(e[1]*r+e[3]*t+e[5])},i[".rgb"]=function(){var e=a.pop(),t=a.pop(),r=a.pop();a.push("rgb("+r+","+t+","+e+")")},i[".rgba"]=function(){var e=a.pop(),t=a.pop(),r=a.pop(),n=a.pop();a.push("rgba("+n+","+r+","+t+","+e+")")},Wps.prototype.parse=r,this}function Psvg(e){function t(){return s(0),[y.xoffs-y.xorig,y.yoffs-y.yorig]}function r(){if(p=!1,s(0),h+="<g",1!=y.xscale||1!=y.yscale||y.rotate){if(h+=' transform="',1==y.xscale&&1==y.yscale||(y.xscale==y.yscale?h+="scale("+y.xscale.toFixed(3)+")":h+="scale("+y.xscale.toFixed(3)+","+y.yscale.toFixed(3)+")"),y.rotate){if(y.xoffs||y.yoffs){var e,t=y.xoffs,r=y.yoffs,n=y.sin,i=y.cos;e=t*i-r*n,r=t*n+r*i,h+=" translate("+e.toFixed(2)+","+r.toFixed(2)+")",b=y.xoffs,x=y.yoffs,y.xoffs=0,y.yoffs=0}h+=" rotate("+y.rotate.toFixed(2)+")"}h+='"'}a(!1),y.rgb&&(h+=' style="color:'+y.rgb+'"'),h+=">\n",m=1}function n(e){var t,r=new e.constructor;for(t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}function a(e){var t=y.font_n;if(t){var r="",n=t.indexOf("Italic"),a=100,i=t.indexOf("Oblique"),o=t.indexOf("Bold"),s=0;o>0&&(r=' font-weight="bold"',a=o,s=2),(n>0||i>0)&&(n>0&&(r+=' font-style="italic"',n<a&&(a=n),s|=4),i>0&&(r+=' font-style="oblique"',i<a&&(a=i),s=8)),100!=a&&("-"==t[a-1]&&a--,t=t.slice(0,a)),e&&(!(2&s)&&w.indexOf("Bold")>=0&&(r+=' font-weight="normal"'),12&s||!(w.indexOf("Italic")>=0||w.indexOf("Oblique")>=0)||(r+=' font-style="normal"')),
h+=' font-family="'+t+'"'+r+' font-size="'+y.font_s+'"'}}function i(){d||(s(1),y.px=y.cx,y.py=y.cy,d='<path d="m'+(y.xoffs+y.cx).toFixed(2)+" "+(y.yoffs-y.cy).toFixed(2)+"\n")}function o(){h+=d,d=""}function s(e){2==m&&(h+="</text>\n",m=1),0==e?m&&(m=0,h+="</g>\n",y.rotate&&(y.xoffs=b,y.yoffs=x,b=0,x=0)):p&&r()}function l(e){return e.length*y.font_s*.5}function c(e,t,r,n,a,o){var s,l,c,u;n>=360&&(n-=360),a>=360&&(a-=360),s=e+r*Math.cos(n*Math.PI/180),l=t+r*Math.sin(n*Math.PI/180),void 0!=y.cx?d?(s!=y.cx||l!=y.cy?d+="l":d+="m",d+=(s-y.cx).toFixed(2)+" "+(-(l-y.cy)).toFixed(2)):(y.cx=s,y.cy=l,i()):(d&&(d=""),y.cx=s,y.cy=l,i()),n==a?(a=180-n,c=e+r*Math.cos(a*Math.PI/180),u=t+r*Math.sin(a*Math.PI/180),d+="a"+r.toFixed(2)+" "+r.toFixed(2)+" 0 0 "+(o?"1 ":"0 ")+(c-s).toFixed(2)+" "+(l-u).toFixed(2)+" "+r.toFixed(2)+" "+r.toFixed(2)+" 0 0 "+(o?"1 ":"0 ")+(s-c).toFixed(2)+" "+(u-l).toFixed(2)+"\n",y.cx=s,y.cy=l):(c=e+r*Math.cos(a*Math.PI/180),u=t+r*Math.sin(a*Math.PI/180),d+="a"+r.toFixed(2)+" "+r.toFixed(2)+" 0 0 "+(o?"1 ":"0 ")+(c-s).toFixed(2)+" "+(l-u).toFixed(2)+"\n",y.cx=c,y.cy=u)}function u(e,t){i(),d+=0==e?"\tv"+(-t).toFixed(2)+"\n":0==t?"\th"+e.toFixed(2)+"\n":"\tl"+e.toFixed(2)+" "+(-t).toFixed(2)+"\n",y.cx+=e,y.cy+=t}function $(e){e&&s(0),h&&(_.out_svg(h),h="")}function f(e,t,r,n){return y.xorig=y.xoffs=_.sx(0),y.yorig=y.yoffs=_.sy(0),y.cx=0,y.cy=0,g.parse(n+(t/_.stv_g().scale).toFixed(2)+" "+r.toFixed(2)+" "+e),$(!0),!0}var p,d,h="",_=e,g=new Wps(this),m=0,y={cx:0,cy:0,xoffs:0,yoffs:0,xscale:1,yscale:1,rotate:0,sin:0,cos:1,linewidth:.7,dash:""},v=[],b=0,x=0,w="";Psvg.prototype.strw=l,Psvg.prototype.arc=c,Psvg.prototype.arcn=function(e,t,r,n,a){c(e,t,r,n,a,!0)},Psvg.prototype.closepath=function(){d&&y.cx&&u(y.px-y.cx,y.py-y.cy)},Psvg.prototype.cx=function(){return y.cx},Psvg.prototype.cy=function(){return y.cy},Psvg.prototype.curveto=function(e,t,r,n,a,o){i(),d+="\tC"+(y.xoffs+e).toFixed(2)+" "+(y.yoffs-t).toFixed(2)+" "+(y.xoffs+r).toFixed(2)+" "+(y.yoffs-n).toFixed(2)+" "+(y.xoffs+a).toFixed(2)+" "+(y.yoffs-o).toFixed(2)+"\n",y.cx=a,y.cy=o},Psvg.prototype.eofill=function(){o(),h+='" fill-rule="evenodd" fill="currentColor"/>\n'},Psvg.prototype.fill=function(){o(),h+='" fill="currentColor"/>\n'},Psvg.prototype.gsave=function(){v.push(n(y))},Psvg.prototype.grestore=function(){y=v.pop(),p=!0},Psvg.prototype.lineto=function(e,t){i(),e==y.cx?d+="\tv"+(y.cy-t).toFixed(2)+"\n":t==y.cy?d+="\th"+(e-y.cx).toFixed(2)+"\n":d+="\tl"+(e-y.cx).toFixed(2)+" "+(y.cy-t).toFixed(2)+"\n",y.cx=e,y.cy=t},Psvg.prototype.moveto=function(e,t){y.cx=e,y.cy=t,d?d+="\tM"+(y.xoffs+y.cx).toFixed(2)+" "+(y.yoffs-y.cy).toFixed(2)+"\n":2==m&&(h+="</text>\n",m=1)},Psvg.prototype.newpath=function(){y.cx=y.cy=void 0},Psvg.prototype.rcurveto=function(e,t,r,n,a,o){i(),d+="\tc"+e.toFixed(2)+" "+(-t).toFixed(2)+" "+r.toFixed(2)+" "+(-n).toFixed(2)+" "+a.toFixed(2)+" "+(-o).toFixed(2)+"\n",y.cx+=a,y.cy+=o},Psvg.prototype.rlineto=u,Psvg.prototype.rmoveto=function(e,t){d?d+="\tm"+e.toFixed(2)+" "+(-t).toFixed(2)+"\n":2==m&&(h+="</text>\n",m=1),y.cx+=e,y.cy+=t},Psvg.prototype.rotate=function(e){s(0);var t,r=y.xoffs,n=y.yoffs,a=y.sin,i=y.cos;t=r*i-n*a,n=r*a+n*i,y.xoffs=t/y.xscale,y.yoffs=n/y.yscale,r=y.cx,n=y.cy,t=r*i-n*a,n=-r*a+n*i,y.cx=t/y.xscale,y.cy=n/y.yscale,e=360-e,y.rotate+=e,y.rotate>180?y.rotate-=360:y.rotate<=-180&&(y.rotate+=360),e=y.rotate*Math.PI/180,y.sin=a=Math.sin(e),y.cos=i=Math.cos(e),t=y.cx,y.cx=(t*i+y.cy*a)*y.xscale,y.cy=(-t*a+y.cy*i)*y.yscale,t=y.xoffs,y.xoffs=(t*i+y.yoffs*a)*y.xscale,y.yoffs=(-t*a+y.yoffs*i)*y.yscale,p=!0},Psvg.prototype.scale=function(e,t){y.xoffs/=e,y.yoffs/=t,y.cx/=e,y.cy/=t,y.xscale*=e,y.yscale*=t,p=!0},Psvg.prototype.selectfont=function(e,t){e=e.nm,0==t&&""==e||(y.font_n_old=y.font_n,y.font_n=e,y.font_s=t,p=!0)},Psvg.prototype.setdash=function(e,t){var r,n=e.length;if(0==n)return void(y.dash="");for(y.dash=' stroke-dashoffset="'+t+'"  stroke-dasharray="',r=0;;){if(y.dash+=e[r],0==--n)break;y.dash+=" "}y.dash+='"'},Psvg.prototype.setlinewidth=function(e){y.linewidth=e},Psvg.prototype.setrgbcolor=function(e,t,r){var n=16777216+(Math.floor(255*e)<<16)+(Math.floor(255*t)<<8)+Math.floor(255*r);n=n.toString(16),(n=n.replace("1","#"))!=y.rgb&&(y.rgb=n,p=!0)},Psvg.prototype.show=function(e){var t,n,i;p&&(2==m?t=!0:r()),n=y.cx,i=y.cy,t?(h+="<tspan\n\t",a(!0),h+=">"):2!=m&&(h+='<text x="'+(n+y.xoffs).toFixed(2)+'" y="'+(y.yoffs-i).toFixed(2)+'">',m=2),h+=e.replace(/<|>|&|  /g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"  ":return" "}}),t&&(h+="</tspan>"),y.cx=n+l(e)},Psvg.prototype.stroke=function(){o(),.7!=y.linewidth&&(h+='" stroke-width="'+y.linewidth.toFixed(2)),h+='" stroke="currentColor" fill="none"'+y.dash+"/>\n"},Psvg.prototype.translate=function(e,t){y.xoffs+=e,y.yoffs-=t,y.cx-=e,y.cy-=t},Psvg.prototype.arp=function(e,r,n){var a=t();$(),_.out_arp((r+a[0])*_.stv_g().scale,n-a[1],e)},Psvg.prototype.ltr=function(e,r,n){var a=t();$(),_.out_ltr((r+a[0])*_.stv_g().scale,n-a[1],e)},Psvg.prototype.xygl=function(e,r,n){var a=t();$(),_.xygl((e+a[0])*_.stv_g().scale,r-a[1],n)},Psvg.prototype.xygls=function(e,r,n,a){var i=t();$(),_.out_deco_str((r+i[0])*_.stv_g().scale,n-i[1],a,e)},Psvg.prototype.xyglv=function(e,r,n,a){var i=t();$(),_.out_deco_val((r+i[0])*_.stv_g().scale,n-i[1],a,e)},Psvg.prototype.y0=function(e){return e+_.get_staff_tb()[0].y},Psvg.prototype.y1=function(e){return e+_.get_staff_tb()[1].y},Psvg.prototype.ps_flush=$,Psvg.prototype.ps_eval=function(e){g.parse(e),$()},Psvg.prototype.psdeco=function(e,t,r,n){var a,i,o,s,l=g.parse("/"+e+" where"),c=l.pop(),u=_.get_staff_tb();return!!c&&(s=0,n.defl.nost&&(s=1),n.defl.noen&&(s|=2),n.s.stem>=0&&(s|=4),l.pop(),o="/defl "+s+" def ",n.lden&&(o+=t.toFixed(2)+" "+r.toFixed(2)+" ",i=n.start,t=i.x,r=i.y+u[i.st].y,t>n.x-20&&(t=n.x-20)),a=n.dd,n.has_val?o+=n.val+" ":a.str&&(o+="("+a.str+") ",r+=.2*a.h),f(e,t,r,o))},Psvg.prototype.psxygl=function(e,t,r){var n=g.parse("/"+r+" where");return!!n.pop()&&(n.pop(),f(r,e,t,"dlw "))},Psvg.prototype.svgcall=function(e,r,n,a,i){var o=t();$(),e((r+o[0])*_.stv_g().scale,n-o[1],a,i)},g.parse("currentdict/systemdict currentdict put\nsystemdict/{/mark cvx put\nsystemdict/[/mark cvx put\nsystemdict/]\n/counttomark cvx\n/array cvx\n/astore cvx\n/exch cvx\n/pop cvx\n5 array astore cvx put\nsystemdict/}/] cvx/cvx cvx 2 array astore cvx put\nsystemdict/def{currentdict 2 index 2 index put pop pop}put\n\n/maxlength 1000 def % TODO\n/.bdef{bind def}bind def\n/.xdef{exch def}.bdef\n/dup{0 index}.bdef\n/load{dup where pop exch get}.bdef\n/.ldef{load def}.bdef\n/if{{}ifelse}.bdef\n/cleartomark{array pop}.bdef\n/known{exch begin where{currentdict eq}{false}if end}.bdef\n/store{1 index where{3 1 roll put}{def}ifelse}.bdef\n/not{{false}{true}ifelse}.bdef\n%/.logand{{{true}{false}ifelse}{pop false}ifelse}.bdef\n%/and/.logand .ldef % TODO numeric and\n/.logor{{pop true}{{true}{false}ifelse}ifelse}.bdef\n/or/.logor .ldef % TODO numeric or\n/ne{eq not}.bdef\n/ge{lt not}.bdef\n/le{1 index 1 index eq 3 1 roll lt or}.bdef\n/gt{le not}.bdef\n/.repeat{1 1 4 2 roll for}.bdef\n\n%% math\n\n/floor{.math(floor)1 .call}.bdef\n\n/neg{0 exch sub}.bdef\n/add{neg sub}.bdef\n/idiv{div floor}.bdef\n\n/.pi{.math(PI)get}.bdef\n\n/abs{.math(abs)1 .call}.bdef\n%/.acos{.math(acos)1 .call}.bdef\n%/.asin{.math(asin)1 .call}.bdef\n/atan{.math(atan2)2 .call 180 mul .pi div}.bdef\n%/.atan2{.math(atan2)2 .call}.bdef\n%/ceiling{.math(ceil)1 .call}.bdef\n/cos{.pi mul 180 div .math(cos)1 .call}.bdef\n%/.exp{.math(exp)1 .call}.bdef\n%/log{.math(log)1 .call}.bdef\n%/.max{.math(max)2 .call}.bdef\n%/.min{.math(min)2 .call}.bdef\n%/.pow{.math(pow)2 .call}.bdef\n%/.random{.math(random)0 .call}.bdef\n%/rand{.random}.bdef % TODO follow spec\n%/round{.math(round)1 .call}.bdef\n%/sin{.math(sin)1 .call}.bdef\n%/sqrt{.math(sqrt)1 .call}.bdef\n%/.tan{.math(tan)1 .call}.bdef\n%/truncate{.math(truncate)1 .call}.bdef % TODO Math.truncate does not exist!\n\n% graphic\n/arc{.svg(arc)5 .call0}.bdef\n/arcn{.svg(arcn)5 .call0}.bdef\n/closepath{.svg(closepath)0 .call}.bdef\n/currentpoint{.svg(cx)0 .call .svg(cy)0 .call}.bdef\n/curveto{.svg(curveto)6 .call0}.bdef\n/eofill{.svg(eofill)0 .call0}.bdef\n/fill{.svg(fill)0 .call0}.bdef\n/grestore{.svg(grestore)0 .call0}.bdef\n/gsave{.svg(gsave)0 .call0}.bdef\n/lineto{.svg(lineto)2 .call0}.bdef\n/moveto{.svg(moveto)2 .call0}.bdef\n/newpath{.svg(newpath)0 .call0}.bdef\n/rcurveto{.svg(rcurveto)6 .call0}.bdef\n/rlineto{.svg(rlineto)2 .call0}.bdef\n/rmoveto{.svg(rmoveto)2 .call0}.bdef\n/rotate{.svg(rotate)1 .call0}.bdef\n/scale{.svg(scale)2 .call0}.bdef\n/selectfont{.svg(selectfont)2 .call0}.bdef\n/setdash{.svg(setdash)2 .call0}.bdef\n/setlinewidth{.svg(setlinewidth)1 .call0}.bdef\n/setrgbcolor{.svg(setrgbcolor)3 .call0}.bdef\n/show{.svg(show)1 .call0}.bdef\n/stroke{.svg(stroke)0 .call0}.bdef\n/stringwidth{.svg(strw)1 .call 1}.bdef\t\t%fixme: height KO\n/translate{.svg(translate)2 .call0}.bdef\n\n/setgray{255 mul dup dup setrgbcolor}.bdef\n% abcm2ps syms.c\n/!{bind def}bind def\n/T/translate load def\n/M/moveto load def\n/RM/rmoveto load def\n/L/lineto load def\n/RL/rlineto load def\n/C/curveto load def\n/RC/rcurveto load def\n/SLW/setlinewidth load def\n/defl 0 def\n/dlw{0.7 SLW}!\n/xymove{/x 2 index def/y 1 index def M}!\n/showc{dup stringwidth pop .5 mul neg 0 RM show}!\n%\n% abcm2ps internal glyphs\n/arp{.svg(arp)3 .call0}.bdef\n/ltr{.svg(ltr)3 .call0}.bdef\n/ft0{(acc-1).svg(xygl)3 .call0}.bdef\n/nt0{(acc3).svg(xygl)3 .call0}.bdef\n/sh0{(acc1).svg(xygl)3 .call0}.bdef\n/dsh0{(acc2).svg(xygl)3 .call0}.bdef\n/trl{(trl).svg(xygl)3 .call0}.bdef\n/lmrd{(lmrd).svg(xygl)3 .call0}.bdef\n/turn{(turn).svg(xygl)3 .call0}.bdef\n/umrd{(umrd).svg(xygl)3 .call0}.bdef\n/y0{.svg(y0)1 .call}.bdef\n/y1{.svg(y1)1 .call}.bdef\n")}navigator={},function(e){function t(){}function r(){}function n(){}function a(){}function i(){}if(void 0!==this.Opal)return console.warn("Opal already loaded. Loading twice can cause troubles, please fix your setup."),this.Opal;var o,s,l,c,u,$=this.Opal={},f={},p=function(){};p.prototype=$,$.constructor=p,$.constants=[],$.global=this,$.config={missing_require_severity:"error",unsupported_features_severity:"warning"};var d=$.hasOwnProperty,h=($.slice=Array.prototype.slice,4);$.uid=function(){return h+=2},$.cvars={},$.gvars={},$.exit=function(e){$.gvars.DEBUG&&console.log("Exited with status "+e)},$.exceptions=[],$.pop_exception=function(){$.gvars["!"]=$.exceptions.pop()||o},$.get=function(e){var t=this[e];return null==t?this.base.$const_get(e):t},$.create_scope=function(e,t,r){var n=function(){},a=n.prototype=new e.constructor;t.$$scope=a,t.$$base_module=e.base,a.base=t,a.constructor=n,a.constants=[],r&&($.cdecl(e,r,t),n.displayName=r+"_scope_alloc")},$.casgn=function(e,t,r){function n(e,t){e.$$name=t;for(t in e.$$scope){var r=e.$$scope[t];r.$$name===o&&(r.$$is_class||r.$$is_module)&&n(r,t)}}var a=e.$$scope;if((r.$$is_class||r.$$is_module)&&((r.$$is_class||r.$$base_module===l)&&(r.$$base_module=e),r.$$name===o&&r.$$base_module.$$name!==o&&n(r,t)),a.constants.push(t),a[t]=r,e.$$is_module&&e.$$dep)for(var i=0;i<e.$$dep.length;i++){var s=e.$$dep[i];$.casgn(s,t,r)}return r},$.cdecl=function(e,t,r){return(r.$$is_class||r.$$is_module)&&null==r.$$orig_scope&&(r.$$name=t,r.$$orig_scope=e,r.$$base_module=e.base,e.constructor[t]=r),e.constants.push(t),e[t]=r},$.klass=function(e,t,r,n){var a,i,o;if(e.$$is_class||e.$$is_module||(e=e.$$class),"function"==typeof t&&(i=t,t=l),(a=e.$$scope[r])&&a.$$orig_scope===e.$$scope){if(!a.$$is_class)throw $.TypeError.$new(r+" is not a class");if(t&&a.$$super!==t)throw $.TypeError.$new("superclass mismatch for class "+r);return a}return null==t&&(t=l),o=i||$.boot_class_alloc(r,n,t),a=$.setup_class_object(r,o,t.$$name,t.constructor),a.$$super=t,a.$$parent=t,$.create_scope(e.$$scope,a,r),e[r]=a,i?$.bridge(a,o):(t!==l&&t!==s&&$.donate_constants(t,a),t.$inherited&&t.$inherited(a)),a},$.boot_class_alloc=function(e,t,r){if(r){var n=function(){};n.prototype=r.$$proto||r.prototype,t.prototype=new n}return e&&(t.displayName=e+"_alloc"),t.prototype.constructor=t,t},$.setup_class_object=function(e,t,r,n){var a=function(){};a.prototype=n.prototype,a.displayName=r;var i=function(){};i.prototype=new a;var s=new i;return s.$$alloc=t,s.$$name=e||o,s.$$id=$.uid(),i.displayName="#<Class:"+(e||"#<Class:"+s.$$id+">")+">",s.$$proto=t.prototype,s.$$proto.$$class=s,s.constructor=i,s.$$is_class=!0,s.$$class=u,s.$$inc=[],s},$.module=function(e,t){var r;if(e.$$is_class||e.$$is_module||(e=e.$$class),d.call(e.$$scope,t)){if(r=e.$$scope[t],!r.$$is_module&&r!==l)throw $.TypeError.$new(t+" is not a module")}else r=$.module_allocate(c),$.create_scope(e.$$scope,r,t);return r},$.module_initialize=function(e,t){if(t!==o){var r=t.$$s;t.$$s=null,t.call(e),t.$$s=r}return o},$.module_allocate=function(e){function t(){}var r=function(){};r.prototype=e.$$alloc.prototype,t.prototype=new r;var n=new t,a={};return n.$$id=$.uid(),t.displayName="#<Class:#<Module:"+n.$$id+">>",n.$$proto=a,n.constructor=t,n.$$is_module=!0,n.$$class=c,n.$$super=e,n.$$parent=e,n.$$inc=[],n.$$is_module=!0,n.$$dep=[],n.$$name=o,n},$.get_singleton_class=function(e){return e.$$meta?e.$$meta:e.$$is_class||e.$$is_module?$.build_class_singleton_class(e):$.build_object_singleton_class(e)},$.build_class_singleton_class=function(e){var t,r,n;return e.$$meta?e.$$meta:(t=e.constructor,r=e===s?u:$.build_class_singleton_class(e.$$super),n=$.setup_class_object(null,t,r.$$name,r.constructor),n.$$super=r,n.$$parent=r,$.create_scope(e.$$scope,n),n.$$is_singleton=!0,n.$$singleton_of=e,e.$$meta=n)},$.build_object_singleton_class=function(e){var t=e.$$class,r="#<Class:#<"+t.$$name+":"+t.$$id+">>",n=$.boot_class_alloc(r,function(){},t),a=$.setup_class_object(r,n,t.$$name,t.constructor);return a.$$super=t,a.$$parent=t,a.$$class=t.$$class,a.$$scope=t.$$scope,a.$$proto=e,a.$$is_singleton=!0,a.$$singleton_of=e,e.$$meta=a},$.bridge_method=function(e,t,r,n){var a,i,o,s;for(a=e.$$bridge.$ancestors(),i=0,s=a.length;i<s&&(o=a[i],!d.call(o.$$proto,r)||!o.$$proto[r]||o.$$proto[r].$$donated||o.$$proto[r].$$stub||o===t);i++)if(o===t){e.prototype[r]=n;break}},$._bridge=function(e,t){var r,n,a,i,o;if("function"==typeof e){for(r=t.$__id__(),n=t.$instance_methods(),i=n.length-1;i>=0;i--)a="$"+n[i],$.bridge_method(e,t,a,t.$$proto[a]);f[r]||(f[r]=[]),f[r].push(e)}else if(o=f[e.$__id__()]){for(i=o.length-1;i>=0;i--)$._bridge(o[i],t);f[t.$__id__()]=o.slice()}},$.append_features=function(e,t){var r,n,a,i,o,s;for(s=t.$$inc.length-1;s>=0;s--)if(t.$$inc[s]===e)return;for(t.$$inc.push(e),e.$$dep.push(t),$._bridge(t,e),r={$$name:e.$$name,$$proto:e.$$proto,$$parent:t.$$parent,$$module:e,$$iclass:!0},t.$$parent=r,n=e.$$proto,a=t.$$proto,i=e.$instance_methods(),s=i.length-1;s>=0;s--)o="$"+i[s],(!a.hasOwnProperty(o)||a[o].$$donated||a[o].$$stub)&&(a[o]=n[o],a[o].$$donated=e);$.donate_constants(e,t)},$.stubs={},$.bridge=function(e,r){if(r.$$bridge)throw $.ArgumentError.$new("already bridged");$.stub_subscribers.push(r.prototype);for(var n in $.stubs)n in r.prototype||(r.prototype[n]=$.stub_for(n));r.prototype.$$class=e,r.$$bridge=e;for(var a=e.$ancestors(),i=a.length-1;i>=0;i--)$._bridge(r,a[i]);for(var o in t.prototype){var s=t.prototype[s];!s||!s.$$stub||o in r.prototype||(r.prototype[o]=s)}return e},$.donate_constants=function(e,t){for(var r=e.$$scope.constants,n=t.$$scope,a=n.constants,i=0,o=r.length;i<o;i++)a.push(r[i]),n[r[i]]=e.$$scope[r[i]]},$.donate=function(e,t){var r,n,a,i,o,s,l,c,u,f,p=e.$$dep,d=e.$$proto[t];if(p)for(r=0,n=p.length;r<n;r++){if(a=p[r],i=a.$$proto,o=i[t],!i.hasOwnProperty(t)||o.$$donated||o.$$stub)if(i.hasOwnProperty(t)&&!o.$$stub){for(s=a.$$inc,l=0,c=s.length;l<c;l++)s[l]===o.$$donated&&(u=l),s[l]===e&&(f=l);u<=f&&(i[t]=d,i[t].$$donated=e)}else i[t]=d,i[t].$$donated=e;else;a.$$dep&&$.donate(a,t)}},$.ancestors=function(e){for(var t,r=e,n=[];r;){n.push(r);for(var a=0;a<r.$$inc.length;a++){t=$.ancestors(r.$$inc[a]);for(var i=0;i<t.length;i++)n.push(t[i])}r=r.$$is_singleton&&r.$$singleton_of.$$is_module?r.$$singleton_of.$$super:r.$$is_class?r.$$super:null}return n},$.add_stubs=function(e){var t,r,n,a,i,o=$.stub_subscribers,s=e.length,l=o.length;for(r=0;r<s;r++)for(a=e[r],$.stubs[a]=!0,i=$.stub_for(a),n=0;n<l;n++)t=o[n],a in t||(t[a]=i)},$.stub_subscribers=[t.prototype],$.add_stub_for=function(e,t){var r=$.stub_for(t);e[t]=r},$.stub_for=function(e){function t(){this.$method_missing.$$p=t.$$p,t.$$p=null;for(var r=new Array(arguments.length),n=0,a=r.length;n<a;n++)r[n]=arguments[n];return this.$method_missing.apply(this,[e.slice(1)].concat(r))}return t.$$stub=!0,t},$.ac=function(e,t,r,n){var a="";throw r.$$is_class||r.$$is_module?a+=r.$$name+".":a+=r.$$class.$$name+"#",a+=n,$.ArgumentError.$new("["+a+"] wrong number of arguments("+e+" for "+t+")")},$.block_ac=function(e,t,r){var n="`block in "+r+"'";throw $.ArgumentError.$new(n+": wrong number of arguments ("+e+" for "+t+")")},$.find_super_dispatcher=function(e,t,r,n,a){var i;if(i=a?e.$$is_class||e.$$is_module?a.$$super:e.$$class.$$proto:$.find_obj_super_dispatcher(e,t,r),i=i["$"+t],!n&&i.$$stub&&$.Kernel.$method_missing===e.$method_missing)throw $.NoMethodError.$new("super: no superclass method `"+t+"' for "+e,t);return i},$.find_iter_super_dispatcher=function(e,t,r,n,a){var i=t;if(!r)throw $.RuntimeError.$new("super called outside of method");if(a&&r.$$define_meth)throw $.RuntimeError.$new("implicit argument passing of super from method defined by define_method() is not supported. Specify all arguments explicitly");return r.$$def&&(i=r.$$jsid),$.find_super_dispatcher(e,i,r,n)},$.find_obj_super_dispatcher=function(e,t,r){var n=e.$$meta||e.$$class;if(!(n=$.find_owning_class(n,r)))throw new Error("could not find current class for super()");return t="$"+t,$.find_super_func(n,t,r)},$.find_owning_class=function(e,t){for(var r=t.$$owner;e&&(!e.$$iclass||e.$$module!==t.$$donated)&&(!e.$$iclass||e.$$module!==r)&&(!r.$$is_singleton||e!==r.$$singleton_of.$$class)&&e!==r;)e=e.$$parent;return e},$.find_super_func=function(e,t,r){for(var n=e.$$parent;n;){var a=n.$$proto[t];if(a&&a!==r)break;n=n.$$parent}return n.$$proto},$.ret=function(e){throw $.returner.$v=e,$.returner},$.brk=function(e,t){throw t.$v=e,t},$.new_brk=function(){return new Error("unexpected break")},$.yield1=function(e,t){if("function"!=typeof e)throw $.LocalJumpError.$new("no block given");var r=e.$$has_top_level_mlhs_arg,n=e.$$has_trailing_comma_in_args;return(e.length>1||(r||n)&&1===e.length)&&(t=$.to_ary(t)),(e.length>1||n&&1===e.length)&&t.$$is_array?e.apply(null,t):e(t)},$.yieldX=function(e,t){if("function"!=typeof e)throw $.LocalJumpError.$new("no block given");if(e.length>1&&1===t.length&&t[0].$$is_array)return e.apply(null,t[0]);if(!t.$$is_array){for(var r=new Array(t.length),n=0,a=r.length;n<a;n++)r[n]=t[n];return e.apply(null,r)}return e.apply(null,t)},$.rescue=function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(n.$$is_array){var a=$.rescue(e,n);if(a)return a}else if(n["$==="](e))return n}return null},$.is_a=function(e,t){if(e.$$meta===t)return!0;var r,n,a=$.ancestors(e.$$class);for(r=0,n=a.length;r<n;r++)if(a[r]===t)return!0;for(a=$.ancestors(e.$$meta),r=0,n=a.length;r<n;r++)if(a[r]===t)return!0;return!1},$.to_hash=function(e){if(e.$$is_hash)return e;if(e["$respond_to?"]("to_hash",!0)){var t=e.$to_hash();if(t.$$is_hash)return t;throw $.TypeError.$new("Can't convert "+e.$$class+" to Hash ("+e.$$class+"#to_hash gives "+t.$$class+")")}throw $.TypeError.$new("no implicit conversion of "+e.$$class+" into Hash")},$.to_ary=function(e){if(e.$$is_array)return e;if(e["$respond_to?"]("to_ary",!0)){var t=e.$to_ary();if(t===o)return[e];if(t.$$is_array)return t;throw $.TypeError.$new("Can't convert "+e.$$class+" to Array ("+e.$$class+"#to_ary gives "+t.$$class+")")}return[e]},$.to_a=function(e){if(e.$$is_array)return e.slice();if(e["$respond_to?"]("to_a",!0)){var t=e.$to_a();if(t===o)return[e];if(t.$$is_array)return t;throw $.TypeError.$new("Can't convert "+e.$$class+" to Array ("+e.$$class+"#to_a gives "+t.$$class+")")}return[e]},$.extract_kwargs=function(e){var t=e[e.length-1];return null!=t&&t["$respond_to?"]("to_hash",!0)?(Array.prototype.splice.call(e,e.length-1,1),t.$to_hash()):$.hash2([],{})},$.kwrestargs=function(e,t){var r=[],n={},a=null,i=e.$$smap;for(a in i)t[a]||(r.push(a),n[a]=i[a]);return $.hash2(r,n)},$.send=function(e,t){for(var r=new Array(Math.max(arguments.length-2,0)),n=0,a=r.length;n<a;n++)r[n]=arguments[n+2];var i=e["$"+t];return i?i.apply(e,r):e.$method_missing.apply(e,[t].concat(r))},$.block_send=function(e,t,r){for(var n=new Array(Math.max(arguments.length-3,0)),a=0,i=n.length;a<i;a++)n[a]=arguments[a+3];var o=e["$"+t];return o?(o.$$p=r,o.apply(e,n)):e.$method_missing.apply(e,[t].concat(n))},$.defn=function(e,t,r){if(e.$$proto[t]=r,r.$$owner=e,e.$$is_module&&($.donate(e,t),e.$$module_function&&$.defs(e,t,r)),e.$__id__&&!e.$__id__.$$stub){var n=f[e.$__id__()];if(n)for(var a=n.length-1;a>=0;a--)$.bridge_method(n[a],e,t,r)}var i=e.$$singleton_of;return!e.$method_added||e.$method_added.$$stub||i?i&&i.$singleton_method_added&&!i.$singleton_method_added.$$stub&&i.$singleton_method_added(t.substr(1)):e.$method_added(t.substr(1)),o},$.defs=function(e,t,r){$.defn($.get_singleton_class(e),t,r)},$.def=function(e,t,r){e.$$eval||!e.$$is_class&&!e.$$is_module?$.defs(e,t,r):$.defn(e,t,r)},$.rdef=function(e,t){if(!d.call(e.$$proto,t))throw $.NameError.$new("method '"+t.substr(1)+"' not defined in "+e.$name());delete e.$$proto[t],e.$$is_singleton?e.$$proto.$singleton_method_removed&&!e.$$proto.$singleton_method_removed.$$stub&&e.$$proto.$singleton_method_removed(t.substr(1)):e.$method_removed&&!e.$method_removed.$$stub&&e.$method_removed(t.substr(1))},$.udef=function(e,t){if(!e.$$proto[t]||e.$$proto[t].$$stub)throw $.NameError.$new("method '"+t.substr(1)+"' not defined in "+e.$name());$.add_stub_for(e.$$proto,t),e.$$is_singleton?e.$$proto.$singleton_method_undefined&&!e.$$proto.$singleton_method_undefined.$$stub&&e.$$proto.$singleton_method_undefined(t.substr(1)):e.$method_undefined&&!e.$method_undefined.$$stub&&e.$method_undefined(t.substr(1))},$.alias=function(e,t,r){var n="$"+t,a="$"+r,i=e.$$proto["$"+r];if(e.$$eval)return $.alias($.get_singleton_class(e),t,r);if("function"!=typeof i||i.$$stub){for(var o=e.$$super;"function"!=typeof i&&o;)i=o[a],o=o.$$super;if("function"!=typeof i||i.$$stub)throw $.NameError.$new("undefined method `"+r+"' for class `"+e.$name()+"'")}return $.defn(e,n,i),e},$.alias_native=function(e,t,r){var n="$"+t,a=e.$$proto[r];if("function"!=typeof a||a.$$stub)throw $.NameError.$new("undefined native method `"+r+"' for class `"+e.$name()+"'");return $.defn(e,n,a),e},$.hash_init=function(e){e.$$smap={},e.$$map={},e.$$keys=[]},$.hash_clone=function(e,t){t.$$none=e.$$none,t.$$proc=e.$$proc;for(var r,n,a=0,i=e.$$keys,o=i.length;a<o;a++)r=e.$$keys[a],r.$$is_string?n=e.$$smap[r]:(n=r.value,r=r.key),$.hash_put(t,r,n)},$.hash_put=function(t,r,n){if(r.$$is_string)return t.$$smap.hasOwnProperty(r)||t.$$keys.push(r),void(t.$$smap[r]=n);var a,i,o=r.$hash();if(!t.$$map.hasOwnProperty(o))return a={key:r,key_hash:o,value:n},t.$$keys.push(a),void(t.$$map[o]=a);for(a=t.$$map[o];a;){if(r===a.key||r["$eql?"](a.key)){i=e,a.value=n;break}i=a,a=a.next}i&&(a={key:r,key_hash:o,value:n},t.$$keys.push(a),i.next=a)},$.hash_get=function(e,t){if(t.$$is_string){if(e.$$smap.hasOwnProperty(t))return e.$$smap[t]}else{var r,n=t.$hash();if(e.$$map.hasOwnProperty(n))for(r=e.$$map[n];r;){if(t===r.key||t["$eql?"](r.key))return r.value;r=r.next}}},$.hash_delete=function(e,t){var r,n,a=e.$$keys,i=a.length;if(t.$$is_string){if(!e.$$smap.hasOwnProperty(t))return;for(r=0;r<i;r++)if(a[r]===t){a.splice(r,1);break}return n=e.$$smap[t],delete e.$$smap[t],n}var o=t.$hash();if(e.$$map.hasOwnProperty(o))for(var s,l=e.$$map[o];l;){if(t===l.key||t["$eql?"](l.key)){for(n=l.value,r=0;r<i;r++)if(a[r]===l){a.splice(r,1);break}return s&&l.next?s.next=l.next:s?delete s.next:l.next?e.$$map[o]=l.next:delete e.$$map[o],n}s=l,l=l.next}},$.hash_rehash=function(t){for(var r,n,a,i=0,o=t.$$keys.length;i<o;i++)if(!t.$$keys[i].$$is_string&&(r=t.$$keys[i].key.$hash())!==t.$$keys[i].key_hash){for(n=t.$$map[t.$$keys[i].key_hash],a=e;n;){if(n===t.$$keys[i]){a&&n.next?a.next=n.next:a?delete a.next:n.next?t.$$map[t.$$keys[i].key_hash]=n.next:delete t.$$map[t.$$keys[i].key_hash];break}a=n,n=n.next}if(t.$$keys[i].key_hash=r,t.$$map.hasOwnProperty(r)){for(n=t.$$map[r],a=e;n;){if(n===t.$$keys[i]){a=e;break}a=n,n=n.next}a&&(a.next=t.$$keys[i])}else t.$$map[r]=t.$$keys[i]}},$.hash=function(){var e,t,r,n,a,i,o=arguments.length;if(1===o&&arguments[0].$$is_hash)return arguments[0];if(t=new $.Hash.$$alloc,$.hash_init(t),1===o&&arguments[0].$$is_array){for(e=arguments[0],n=e.length,r=0;r<n;r++){if(2!==e[r].length)throw $.ArgumentError.$new("value not of length 2: "+e[r].$inspect());a=e[r][0],i=e[r][1],$.hash_put(t,a,i)}return t}if(1===o){e=arguments[0];for(a in e)e.hasOwnProperty(a)&&(i=e[a],$.hash_put(t,a,i));return t}if(o%2!=0)throw $.ArgumentError.$new("odd number of arguments for Hash");for(r=0;r<o;r+=2)a=arguments[r],i=arguments[r+1],$.hash_put(t,a,i);return t},$.hash2=function(e,t){var r=new $.Hash.$$alloc;return r.$$smap=t,r.$$map={},r.$$keys=e,r},$.range=function(e,t,r){var n=new $.Range.$$alloc;return n.begin=e,n.end=t,n.exclude=r,n},$.ivar=function(e){return"constructor"===e||"displayName"===e||"__count__"===e||"__noSuchMethod__"===e||"__parent__"===e||"__proto__"===e||"hasOwnProperty"===e||"valueOf"===e?e+"$":e},$.modules={},$.loaded_features=["corelib/runtime"],$.current_dir=".",$.require_table={"corelib/runtime":!0},$.normalize=function(e){var t,r,n=[];"."!==$.current_dir&&(e=$.current_dir.replace(/\/*$/,"/")+e),e=e.replace(/\.(rb|opal|js)$/,""),t=e.split("/");for(var a=0,i=t.length;a<i;a++)""!==(r=t[a])&&(".."===r?n.pop():n.push(r));return n.join("/")},$.loaded=function(e){var t,r,n;for(t=0,r=e.length;t<r;t++){if(n=$.normalize(e[t]),$.require_table[n])return;$.loaded_features.push(n),$.require_table[n]=!0}},$.load=function(e){e=$.normalize(e),$.loaded([e]);var t=$.modules[e];if(t)t($);else{var r=$.config.missing_require_severity,n="cannot load such file -- "+e;"error"===r?$.LoadError?$.LoadError.$new(n):function(){throw n}():"warning"===r&&console.warn("WARNING: LoadError: "+n)}return!0},$.require=function(e){return e=$.normalize(e),!$.require_table[e]&&$.load(e)},$.boot_class_alloc("BasicObject",t),$.boot_class_alloc("Object",r,t),$.boot_class_alloc("Module",a,r),$.boot_class_alloc("Class",n,a),$.BasicObject=s=$.setup_class_object("BasicObject",t,"Class",n),$.Object=l=$.setup_class_object("Object",r,"BasicObject",s.constructor),$.Module=c=$.setup_class_object("Module",a,"Object",l.constructor),$.Class=u=$.setup_class_object("Class",n,"Module",c.constructor),$.constants.push("BasicObject"),$.constants.push("Object"),$.constants.push("Module"),$.constants.push("Class"),s.$$class=u,l.$$class=u,c.$$class=u,u.$$class=u,s.$$super=null,l.$$super=s,c.$$super=l,u.$$super=c,s.$$parent=null,l.$$parent=s,c.$$parent=l,u.$$parent=c,$.base=l,s.$$scope=l.$$scope=$,s.$$orig_scope=l.$$orig_scope=$,c.$$scope=l.$$scope,c.$$orig_scope=l.$$orig_scope,u.$$scope=l.$$scope,u.$$orig_scope=l.$$orig_scope,l.$$proto.toString=function(){return this.$to_s()},l.$$proto.$require=$.require,$.top=new l.$$alloc,$.klass(l,l,"NilClass",i),o=$.nil=new i,o.$$id=4,o.call=o.apply=function(){throw $.LocalJumpError.$new("no block given")},$.breaker=new Error("unexpected break (old)"),$.returner=new Error("unexpected return"),TypeError.$$super=Error}.call(this),"undefined"!=typeof global&&(global.Opal=this.Opal,Opal.global=global),"undefined"!=typeof window&&(window.Opal=this.Opal,Opal.global=window),Opal.loaded(["corelib/runtime"]),Opal.modules["corelib/helpers"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.module);return e.add_stubs(["$new","$class","$===","$respond_to?","$raise","$type_error","$__send__","$coerce_to","$nil?","$<=>","$inspect","$coerce_to!","$!=","$[]","$upcase"]),function(t){var a,i,o,s,l,c,u,$,f,p,d,h,_,g,m=a=n(t,"Opal"),y=(m.$$proto,m.$$scope);e.defs(m,"$bridge",i=function(t,r){return e.bridge(t,r)},i.$$arity=2),e.defs(m,"$type_error",o=function(e,t,n,a){var i;return null==n&&(n=r),null==a&&(a=r),(i=!1!==n&&n!==r&&null!=n?a:n)===r||null==i||i.$$is_boolean&&1!=i?y.get("TypeError").$new("no implicit conversion of "+e.$class()+" into "+t):y.get("TypeError").$new("can't convert "+e.$class()+" into "+t+" ("+e.$class()+"#"+n+" gives "+a.$class())},o.$$arity=-3),e.defs(m,"$coerce_to",s=function(e,t,n){var a,i=this;return(a=t["$==="](e))===r||null==a||a.$$is_boolean&&1!=a?(((a=e["$respond_to?"](n))===r||null==a||a.$$is_boolean&&1!=a)&&i.$raise(i.$type_error(e,t)),e.$__send__(n)):e},s.$$arity=3),e.defs(m,"$coerce_to!",l=function(e,t,n){var a,i=this,o=r;return o=i.$coerce_to(e,t,n),((a=t["$==="](o))===r||null==a||a.$$is_boolean&&1!=a)&&i.$raise(i.$type_error(e,t,n,o)),o},l.$$arity=3),e.defs(m,"$coerce_to?",c=function(e,t,n){var a,i=this,o=r;return(a=e["$respond_to?"](n))===r||null==a||a.$$is_boolean&&1!=a?r:(o=i.$coerce_to(e,t,n),(a=o["$nil?"]())===r||null==a||a.$$is_boolean&&1!=a?(((a=t["$==="](o))===r||null==a||a.$$is_boolean&&1!=a)&&i.$raise(i.$type_error(e,t,n,o)),o):r)},c.$$arity=3),e.defs(m,"$try_convert",u=function(e,t,n){var a;return(a=t["$==="](e))===r||null==a||a.$$is_boolean&&1!=a?(a=e["$respond_to?"](n))===r||null==a||a.$$is_boolean&&1!=a?r:e.$__send__(n):e},u.$$arity=3),e.defs(m,"$compare",$=function(e,t){var n,a=this,i=r;return i=e["$<=>"](t),(n=i===r)===r||null==n||n.$$is_boolean&&1!=n||a.$raise(y.get("ArgumentError"),"comparison of "+e.$class()+" with "+t.$class()+" failed"),i},$.$$arity=2),e.defs(m,"$destructure",f=function(e){if(1==e.length)return e[0];if(e.$$is_array)return e;for(var t=new Array(e.length),r=0,n=t.length;r<n;r++)t[r]=e[r];return t},f.$$arity=1),e.defs(m,"$respond_to?",p=function(e,t){return!(null==e||!e.$$class)&&e["$respond_to?"](t)},p.$$arity=2),e.defs(m,"$inspect",d=function(e){return void 0===e?"undefined":null===e?"null":e.$$class?e.$inspect():e.toString()},d.$$arity=1),e.defs(m,"$instance_variable_name!",h=function(e){var t,n=this;return e=y.get("Opal")["$coerce_to!"](e,y.get("String"),"to_str"),((t=/^@[a-zA-Z_][a-zA-Z0-9_]*?$/.test(e))===r||null==t||t.$$is_boolean&&1!=t)&&n.$raise(y.get("NameError").$new("'"+e+"' is not allowed as an instance variable name",e)),e},h.$$arity=1),e.defs(m,"$const_name!",_=function(e){var t,n=this;return e=y.get("Opal")["$coerce_to!"](e,y.get("String"),"to_str"),(t=e["$[]"](0)["$!="](e["$[]"](0).$upcase()))===r||null==t||t.$$is_boolean&&1!=t||n.$raise(y.get("NameError"),"wrong constant name "+e),e},_.$$arity=1),e.defs(m,"$pristine",g=function(e,t){var n,a=arguments.length,i=a-1;i<0&&(i=0),n=new Array(i);for(var o=1;o<a;o++)n[o-1]=arguments[o];for(var s,l=n.length-1;l>=0;l--)s=n[l],e.$$proto["$"+s].$$pristine=!0;return r},g.$$arity=-2)}(t.base)},Opal.modules["corelib/module"]=function(Opal){function $rb_lt(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function $rb_gt(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}var self=Opal.top,$scope=Opal,nil=Opal.nil,$breaker=Opal.breaker,$slice=Opal.slice,$klass=Opal.klass,$range=Opal.range,$hash2=Opal.hash2;return Opal.add_stubs(["$===","$raise","$equal?","$<","$>","$nil?","$attr_reader","$attr_writer","$coerce_to!","$new","$const_name!","$=~","$inject","$const_get","$split","$const_missing","$==","$!","$start_with?","$to_proc","$lambda","$bind","$call","$class","$append_features","$included","$name","$cover?","$size","$merge","$compile","$proc","$to_s","$__id__","$constants","$include?"]),function($base,$super){function $Module(){}
var self=$Module=$klass($base,$super,"Module",$Module),def=self.$$proto,$scope=self.$$scope,TMP_1,TMP_2,TMP_3,TMP_4,TMP_5,TMP_6,TMP_7,TMP_8,TMP_9,TMP_10,TMP_11,TMP_12,TMP_13,TMP_14,TMP_15,TMP_16,TMP_17,TMP_18,TMP_19,TMP_20,TMP_22,TMP_23,TMP_24,TMP_25,TMP_27,TMP_28,TMP_29,TMP_30,TMP_31,TMP_32,TMP_33,TMP_34,TMP_35,TMP_36,TMP_37,TMP_38,TMP_39,TMP_41,TMP_42,TMP_43,TMP_44,TMP_45,TMP_46,TMP_47,TMP_48,TMP_49;return Opal.defs(self,"$allocate",TMP_1=function(){var e,t=this;return e=Opal.module_allocate(t),Opal.create_scope(Opal.Module.$$scope,e,null),e},TMP_1.$$arity=0),Opal.defn(self,"$initialize",TMP_2=function(){var e=this,t=TMP_2.$$p,r=t||nil;return TMP_2.$$p=null,Opal.module_initialize(e,r)},TMP_2.$$arity=0),Opal.defn(self,"$===",TMP_3=function(e){var t,r=this;return!!((t=null==e)===nil||null==t||t.$$is_boolean&&1!=t)&&Opal.is_a(e,r)},TMP_3.$$arity=1),Opal.defn(self,"$<",TMP_4=function(e){var t,r=this;((t=$scope.get("Module")["$==="](e))===nil||null==t||t.$$is_boolean&&1!=t)&&r.$raise($scope.get("TypeError"),"compared with non class/module");var n,a,i,o=r;if(o===e)return!1;for(a=0,n=Opal.ancestors(r),i=n.length;a<i;a++)if(n[a]===e)return!0;for(a=0,n=Opal.ancestors(e),i=n.length;a<i;a++)if(n[a]===r)return!1;return nil},TMP_4.$$arity=1),Opal.defn(self,"$<=",TMP_5=function(e){var t,r=this;return!1!==(t=r["$equal?"](e))&&t!==nil&&null!=t?t:$rb_lt(r,e)},TMP_5.$$arity=1),Opal.defn(self,"$>",TMP_6=function(e){var t,r=this;return((t=$scope.get("Module")["$==="](e))===nil||null==t||t.$$is_boolean&&1!=t)&&r.$raise($scope.get("TypeError"),"compared with non class/module"),$rb_lt(e,r)},TMP_6.$$arity=1),Opal.defn(self,"$>=",TMP_7=function(e){var t,r=this;return!1!==(t=r["$equal?"](e))&&t!==nil&&null!=t?t:$rb_gt(r,e)},TMP_7.$$arity=1),Opal.defn(self,"$<=>",TMP_8=function(e){var t,r=this,n=nil;return r===e?0:(t=$scope.get("Module")["$==="](e))===nil||null==t||t.$$is_boolean&&1!=t?nil:(n=$rb_lt(r,e),(t=n["$nil?"]())===nil||null==t||t.$$is_boolean&&1!=t?!1!==n&&n!==nil&&null!=n?-1:1:nil)},TMP_8.$$arity=1),Opal.defn(self,"$alias_method",TMP_9=function(e,t){var r=this;return Opal.alias(r,e,t),r},TMP_9.$$arity=2),Opal.defn(self,"$alias_native",TMP_10=function(e,t){var r=this;return null==t&&(t=e),Opal.alias_native(r,e,t),r},TMP_10.$$arity=-2),Opal.defn(self,"$ancestors",TMP_11=function(){var e=this;return Opal.ancestors(e)},TMP_11.$$arity=0),Opal.defn(self,"$append_features",TMP_12=function(e){var t=this;return Opal.append_features(t,e),t},TMP_12.$$arity=1),Opal.defn(self,"$attr_accessor",TMP_13=function(e){var t,r,n,a=this,i=arguments.length,o=i-0;o<0&&(o=0),n=new Array(o);for(var s=0;s<i;s++)n[s-0]=arguments[s];return(t=a).$attr_reader.apply(t,Opal.to_a(n)),(r=a).$attr_writer.apply(r,Opal.to_a(n))},TMP_13.$$arity=-1),Opal.alias(self,"attr","attr_accessor"),Opal.defn(self,"$attr_reader",TMP_14=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=r.$$proto,s=t.length-1;s>=0;s--){var l=t[s],c="$"+l,u=Opal.ivar(l),$=function(e){return function(){return null==this[e]?nil:this[e]}}(u);o[u]=nil,$.$$parameters=[],$.$$arity=0,r.$$is_singleton?o.constructor.prototype[c]=$:Opal.defn(r,c,$)}return nil},TMP_14.$$arity=-1),Opal.defn(self,"$attr_writer",TMP_15=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=r.$$proto,s=t.length-1;s>=0;s--){var l=t[s],c="$"+l+"=",u=Opal.ivar(l),$=function(e){return function(t){return this[e]=t}}(u);$.$$parameters=[["req"]],$.$$arity=1,o[u]=nil,r.$$is_singleton?o.constructor.prototype[c]=$:Opal.defn(r,c,$)}return nil},TMP_15.$$arity=-1),Opal.defn(self,"$autoload",TMP_16=function(e,t){var r,n=this;return(r=n.$$autoload)||(r=n.$$autoload={}),r[e]=t,nil},TMP_16.$$arity=2),Opal.defn(self,"$class_variable_get",TMP_17=function(e){var t,r=this;e=$scope.get("Opal")["$coerce_to!"](e,$scope.get("String"),"to_str"),(t=e.length<3||"@@"!==e.slice(0,2))===nil||null==t||t.$$is_boolean&&1!=t||r.$raise($scope.get("NameError").$new("class vars should start with @@",e));var n=Opal.cvars[e.slice(2)];return function(){(t=null==n)===nil||null==t||t.$$is_boolean&&1!=t||r.$raise($scope.get("NameError").$new("uninitialized class variable @@a in",e))}(),n},TMP_17.$$arity=1),Opal.defn(self,"$class_variable_set",TMP_18=function(e,t){var r,n=this;return e=$scope.get("Opal")["$coerce_to!"](e,$scope.get("String"),"to_str"),(r=e.length<3||"@@"!==e.slice(0,2))===nil||null==r||r.$$is_boolean&&1!=r||n.$raise($scope.get("NameError")),Opal.cvars[e.slice(2)]=t,t},TMP_18.$$arity=2),Opal.defn(self,"$constants",TMP_19=function(){return this.$$scope.constants.slice(0)},TMP_19.$$arity=0),Opal.defn(self,"$const_defined?",TMP_20=function(e,t){var r,n=this;null==t&&(t=!0),e=$scope.get("Opal")["$const_name!"](e),((r=e["$=~"]($scope.get("Opal").$$scope.get("CONST_NAME_REGEXP")))===nil||null==r||r.$$is_boolean&&1!=r)&&n.$raise($scope.get("NameError").$new("wrong constant name "+e,e));var a=[n.$$scope];if(t||n===Opal.Object)for(var i=n.$$super;i!==Opal.BasicObject;)a.push(i.$$scope),i=i.$$super;for(var o=0,s=a.length;o<s;o++)if(a[o].hasOwnProperty(e))return!0;return!1},TMP_20.$$arity=-2),Opal.defn(self,"$const_get",TMP_22=function(e,t){var r,n,a,i=this;if(null==t&&(t=!0),e=$scope.get("Opal")["$const_name!"](e),0===e.indexOf("::")&&"::"!==e&&(e=e.slice(2)),(r=-1!=e.indexOf("::")&&"::"!=e)!==nil&&null!=r&&(!r.$$is_boolean||1==r))return(r=(n=e.$split("::")).$inject,r.$$p=(a=function(e,t){a.$$s;return null==e&&(e=nil),null==t&&(t=nil),e.$const_get(t)},a.$$s=i,a.$$arity=2,a),r).call(n,i);((r=e["$=~"]($scope.get("Opal").$$scope.get("CONST_NAME_REGEXP")))===nil||null==r||r.$$is_boolean&&1!=r)&&i.$raise($scope.get("NameError").$new("wrong constant name "+e,e));var o=[i.$$scope];if(t||i==Opal.Object)for(var s=i.$$super;s!==Opal.BasicObject;)o.push(s.$$scope),s=s.$$super;for(var l=0,c=o.length;l<c;l++)if(o[l].hasOwnProperty(e))return o[l][e];return i.$const_missing(e)},TMP_22.$$arity=-2),Opal.defn(self,"$const_missing",TMP_23=function(e){var t=this,r=nil;if(t.$$autoload){var n=t.$$autoload[e];if(n)return t.$require(n),t.$const_get(e)}return r=function(){return t["$=="]($scope.get("Object"))?e:t+"::"+e}(),t.$raise($scope.get("NameError").$new("uninitialized constant "+r,e))},TMP_23.$$arity=1),Opal.defn(self,"$const_set",TMP_24=function(e,t){var r,n,a=this;return e=$scope.get("Opal")["$const_name!"](e),(r=!1!==(n=e["$=~"]($scope.get("Opal").$$scope.get("CONST_NAME_REGEXP"))["$!"]())&&n!==nil&&null!=n?n:e["$start_with?"]("::"))===nil||null==r||r.$$is_boolean&&1!=r||a.$raise($scope.get("NameError").$new("wrong constant name "+e,e)),Opal.casgn(a,e,t),t},TMP_24.$$arity=2),Opal.defn(self,"$define_method",TMP_25=function(e,t){var r,n,a,i,o=this,s=TMP_25.$$p,l=s||nil,c=nil;TMP_25.$$p=null,(r=void 0===t&&l===nil)===nil||null==r||r.$$is_boolean&&1!=r||o.$raise($scope.get("ArgumentError"),"tried to create a Proc object without a block"),!1!==(r=l)&&r!==nil&&null!=r||(l=function(){return c=t,$scope.get("Proc")["$==="](c)?t:$scope.get("Method")["$==="](c)?t.$to_proc().$$unbound:$scope.get("UnboundMethod")["$==="](c)?(n=(a=o).$lambda,n.$$p=(i=function(e){var r,n,a=i.$$s||this,o=nil,s=arguments.length,l=s-0;l<0&&(l=0),r=new Array(l);for(var c=0;c<s;c++)r[c-0]=arguments[c];return o=t.$bind(a),(n=o).$call.apply(n,Opal.to_a(r))},i.$$s=o,i.$$arity=-1,i),n).call(a):o.$raise($scope.get("TypeError"),"wrong argument type "+l.$class()+" (expected Proc/Method)")}());var u="$"+e;return l.$$jsid=e,l.$$s=null,l.$$def=l,l.$$define_meth=!0,Opal.defn(o,u,l),e},TMP_25.$$arity=-2),Opal.defn(self,"$remove_method",TMP_27=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=0,s=t.length;o<s;o++)Opal.rdef(r,"$"+t[o]);return r},TMP_27.$$arity=-1),Opal.defn(self,"$singleton_class?",TMP_28=function(){return!!this.$$is_singleton},TMP_28.$$arity=0),Opal.defn(self,"$include",TMP_29=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=t.length-1;o>=0;o--){var s=t[o];s!==r&&(s.$$is_module||r.$raise($scope.get("TypeError"),"wrong argument type "+s.$class()+" (expected Module)"),s.$append_features(r),s.$included(r))}return r},TMP_29.$$arity=-1),Opal.defn(self,"$included_modules",TMP_30=function(){var e,t=this,r=function(e){for(var t=[],n=0;n!=e.$$inc.length;n++){var a=e.$$inc[n];t.push(a),t=t.concat(r(a))}return t};if(e=r(t),t.$$is_class)for(var n=t;n;n=n.$$super)e=e.concat(r(n));return e},TMP_30.$$arity=0),Opal.defn(self,"$include?",TMP_31=function(e){for(var t=this,r=t;r;r=r.$$super)for(var n=0;n!=r.$$inc.length;n++){var a=r.$$inc[n];if(e===a)return!0}return!1},TMP_31.$$arity=1),Opal.defn(self,"$instance_method",TMP_32=function(e){var t=this,r=t.$$proto["$"+e];return r&&!r.$$stub||t.$raise($scope.get("NameError").$new("undefined method `"+e+"' for class `"+t.$name()+"'",e)),$scope.get("UnboundMethod").$new(t,r,e)},TMP_32.$$arity=1),Opal.defn(self,"$instance_methods",TMP_33=function(e){var t=this;null==e&&(e=!0);var r=[],n=t.$$proto;for(var a in n)if("$"===a.charAt(0)&&"function"==typeof n[a]&&!n[a].$$stub){if(!t.$$is_module){if(t!==Opal.BasicObject&&n[a]===Opal.BasicObject.$$proto[a])continue;if(!e&&!n.hasOwnProperty(a))continue;if(!e&&n[a].$$donated)continue}r.push(a.substr(1))}return r},TMP_33.$$arity=-1),Opal.defn(self,"$included",TMP_34=function(e){return nil},TMP_34.$$arity=1),Opal.defn(self,"$extended",TMP_35=function(e){return nil},TMP_35.$$arity=1),Opal.defn(self,"$method_added",TMP_36=function(e){return nil},TMP_36.$$arity=-1),Opal.defn(self,"$method_removed",TMP_37=function(e){return nil},TMP_37.$$arity=-1),Opal.defn(self,"$method_undefined",TMP_38=function(e){return nil},TMP_38.$$arity=-1),Opal.defn(self,"$module_eval",TMP_39=function $$module_eval($a_rest){var $b,$c,TMP_40,self=this,args,$iter=TMP_39.$$p,block=$iter||nil,string=nil,file=nil,_lineno=nil,default_eval_options=nil,compiling_options=nil,compiled=nil,$args_len=arguments.length,$rest_len=$args_len-0;$rest_len<0&&($rest_len=0),args=new Array($rest_len);for(var $arg_idx=0;$arg_idx<$args_len;$arg_idx++)args[$arg_idx-0]=arguments[$arg_idx];TMP_39.$$p=null,$c=block["$nil?"](),($b=!1!==$c&&$c!==nil&&null!=$c?!!Opal.compile:$c)===nil||null==$b||$b.$$is_boolean&&1!=$b?($b=$rb_gt(args.$size(),0))===nil||null==$b||$b.$$is_boolean&&1!=$b||$scope.get("Kernel").$raise($scope.get("ArgumentError"),"wrong number of arguments ("+args.$size()+" for 0)"):((($b=$range(1,3,!1)["$cover?"](args.$size()))===nil||null==$b||$b.$$is_boolean&&1!=$b)&&$scope.get("Kernel").$raise($scope.get("ArgumentError"),"wrong number of arguments (0 for 1..3)"),$b=Opal.to_a(args),string=null==$b[0]?nil:$b[0],file=null==$b[1]?nil:$b[1],_lineno=null==$b[2]?nil:$b[2],default_eval_options=$hash2(["file","eval"],{file:!1!==($b=file)&&$b!==nil&&null!=$b?$b:"(eval)",eval:!0}),compiling_options=Opal.hash({arity_check:!1}).$merge(default_eval_options),compiled=$scope.get("Opal").$compile(string,compiling_options),block=($b=($c=$scope.get("Kernel")).$proc,$b.$$p=(TMP_40=function(){var self=TMP_40.$$s||this;return function(self){return eval(compiled)}(self)},TMP_40.$$s=self,TMP_40.$$arity=0,TMP_40),$b).call($c));var old=block.$$s,result;return block.$$s=null,result=block.apply(self,[self]),block.$$s=old,result},TMP_39.$$arity=-1),Opal.alias(self,"class_eval","module_eval"),Opal.defn(self,"$module_exec",TMP_41=function(e){var t,r=this,n=TMP_41.$$p,a=n||nil,i=arguments.length,o=i-0;o<0&&(o=0),t=new Array(o);for(var s=0;s<i;s++)t[s-0]=arguments[s];TMP_41.$$p=null,a===nil&&r.$raise($scope.get("LocalJumpError"),"no block given");var l,c=a.$$s;return a.$$s=null,l=a.apply(r,t),a.$$s=c,l},TMP_41.$$arity=-1),Opal.alias(self,"class_exec","module_exec"),Opal.defn(self,"$method_defined?",TMP_42=function(e){var t=this,r=t.$$proto["$"+e];return!!r&&!r.$$stub},TMP_42.$$arity=1),Opal.defn(self,"$module_function",TMP_43=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];if(0===t.length)r.$$module_function=!0;else for(var o=0,s=t.length;o<s;o++){var l=t[o],c="$"+l,u=r.$$proto[c];Opal.defs(r,c,u)}return r},TMP_43.$$arity=-1),Opal.defn(self,"$name",TMP_44=function(){var e=this;if(e.$$full_name)return e.$$full_name;for(var t=[],r=e;r;){if(r.$$name===nil)return 0===t.length?nil:t.join("::");if(t.unshift(r.$$name),(r=r.$$base_module)===Opal.Object)break}return 0===t.length?nil:e.$$full_name=t.join("::")},TMP_44.$$arity=0),Opal.defn(self,"$remove_class_variable",TMP_45=function(e){return nil},TMP_45.$$arity=-1),Opal.defn(self,"$remove_const",TMP_46=function(e){var t=this,r=t.$$scope[e];return delete t.$$scope[e],r},TMP_46.$$arity=1),Opal.defn(self,"$to_s",TMP_47=function(){var e,t=this;return!1!==(e=Opal.Module.$name.call(t))&&e!==nil&&null!=e?e:"#<"+(t.$$is_module?"Module":"Class")+":0x"+t.$__id__().$to_s(16)+">"},TMP_47.$$arity=0),Opal.defn(self,"$undef_method",TMP_48=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=0,s=t.length;o<s;o++)Opal.udef(r,"$"+t[o]);return r},TMP_48.$$arity=-1),Opal.defn(self,"$instance_variables",TMP_49=function(){var e=this,t=nil;t=e.$constants();var r=[];for(var n in e)e.hasOwnProperty(n)&&"$"!==n.charAt(0)&&"constructor"!==n&&!t["$include?"](n)&&r.push("@"+n);return r},TMP_49.$$arity=0),nil&&"instance_variables"}($scope.base,null)},Opal.modules["corelib/class"]=function(e){var t=e.top,r=e,n=e.nil,a=(e.breaker,e.slice,e.klass);return e.add_stubs(["$require","$allocate","$name","$to_s"]),t.$require("corelib/module"),function(t,r){function i(){}var o,s,l,c,u,$,f=i=a(t,null,"Class",i),p=(f.$$proto,f.$$scope);return e.defs(f,"$new",o=function(t){var r=o.$$p,a=r||n;if(null==t&&(t=p.get("Object")),o.$$p=null,!t.$$is_class)throw e.TypeError.$new("superclass must be a Class");var i=e.boot_class_alloc(null,function(){},t),s=e.setup_class_object(null,i,t.$$name,t.constructor);return s.$$super=t,s.$$parent=t,e.create_scope(t.$$scope,s),t.$inherited(s),e.module_initialize(s,a),s},o.$$arity=-1),e.defn(f,"$allocate",s=function(){var t=this,r=new t.$$alloc;return r.$$id=e.uid(),r},s.$$arity=0),e.defn(f,"$inherited",l=function(e){return n},l.$$arity=1),e.defn(f,"$new",c=function(e){var t,r=this,a=c.$$p,i=a||n,o=arguments.length,s=o-0;s<0&&(s=0),t=new Array(s);for(var l=0;l<o;l++)t[l-0]=arguments[l];c.$$p=null;var u=r.$allocate();return u.$initialize.$$p=i,u.$initialize.apply(u,t),u},c.$$arity=-1),e.defn(f,"$superclass",u=function(){return this.$$super||n},u.$$arity=0),e.defn(f,"$to_s",$=function(){var t,r,n=this;$.$$p;$.$$p=null;var a=n.$$singleton_of;return a&&(a.$$is_class||a.$$is_module)?"#<Class:"+a.$name()+">":a?"#<Class:#<"+a.$$class.$name()+":0x"+a.$$id.$to_s(16)+">>":(r=n,t=e.find_super_dispatcher(n,"to_s",$,!1),t.$$p=null,t).call(r)},$.$$arity=0),n&&"to_s"}(r.base)},Opal.modules["corelib/basic_object"]=function(Opal){function $rb_gt(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}var self=Opal.top,$scope=Opal,nil=Opal.nil,$breaker=Opal.breaker,$slice=Opal.slice,$klass=Opal.klass,$range=Opal.range,$hash2=Opal.hash2;return Opal.add_stubs(["$==","$!","$nil?","$cover?","$size","$raise","$merge","$compile","$proc","$>","$new","$inspect"]),function($base,$super){function $BasicObject(){}var self=$BasicObject=$klass($base,$super,"BasicObject",$BasicObject),def=self.$$proto,$scope=self.$$scope,TMP_1,TMP_2,TMP_3,TMP_4,TMP_5,TMP_6,TMP_7,TMP_8,TMP_10,TMP_11,TMP_12,TMP_13,TMP_14;return Opal.defn(self,"$initialize",TMP_1=function(e){return nil},TMP_1.$$arity=-1),Opal.defn(self,"$==",TMP_2=function(e){return this===e},TMP_2.$$arity=1),Opal.defn(self,"$eql?",TMP_3=function(e){return this["$=="](e)},TMP_3.$$arity=1),Opal.alias(self,"equal?","=="),Opal.defn(self,"$__id__",TMP_4=function(){var e=this;return e.$$id||(e.$$id=Opal.uid())},TMP_4.$$arity=0),Opal.defn(self,"$__send__",TMP_5=function(e,t){var r,n=this,a=TMP_5.$$p,i=a||nil,o=arguments.length,s=o-1;s<0&&(s=0),r=new Array(s);for(var l=1;l<o;l++)r[l-1]=arguments[l];TMP_5.$$p=null;var c=n["$"+e];return c?(i!==nil&&(c.$$p=i),c.apply(n,r)):(i!==nil&&(n.$method_missing.$$p=i),n.$method_missing.apply(n,[e].concat(r)))},TMP_5.$$arity=-2),Opal.defn(self,"$!",TMP_6=function(){return!1},TMP_6.$$arity=0),Opal.defn(self,"$!=",TMP_7=function(e){return this["$=="](e)["$!"]()},TMP_7.$$arity=1),Opal.alias(self,"equal?","=="),Opal.defn(self,"$instance_eval",TMP_8=function $$instance_eval($a_rest){var $b,$c,TMP_9,self=this,args,$iter=TMP_8.$$p,block=$iter||nil,string=nil,file=nil,_lineno=nil,default_eval_options=nil,compiling_options=nil,compiled=nil,$args_len=arguments.length,$rest_len=$args_len-0;$rest_len<0&&($rest_len=0),args=new Array($rest_len);for(var $arg_idx=0;$arg_idx<$args_len;$arg_idx++)args[$arg_idx-0]=arguments[$arg_idx];TMP_8.$$p=null,$c=block["$nil?"](),($b=!1!==$c&&$c!==nil&&null!=$c?!!Opal.compile:$c)===nil||null==$b||$b.$$is_boolean&&1!=$b?($b=$rb_gt(args.$size(),0))===nil||null==$b||$b.$$is_boolean&&1!=$b||$scope.get("Kernel").$raise($scope.get("ArgumentError"),"wrong number of arguments ("+args.$size()+" for 0)"):((($b=$range(1,3,!1)["$cover?"](args.$size()))===nil||null==$b||$b.$$is_boolean&&1!=$b)&&$scope.get("Kernel").$raise($scope.get("ArgumentError"),"wrong number of arguments (0 for 1..3)"),$b=Opal.to_a(args),string=null==$b[0]?nil:$b[0],file=null==$b[1]?nil:$b[1],_lineno=null==$b[2]?nil:$b[2],default_eval_options=$hash2(["file","eval"],{file:!1!==($b=file)&&$b!==nil&&null!=$b?$b:"(eval)",eval:!0}),compiling_options=Opal.hash({arity_check:!1}).$merge(default_eval_options),compiled=$scope.get("Opal").$compile(string,compiling_options),block=($b=($c=$scope.get("Kernel")).$proc,$b.$$p=(TMP_9=function(){var self=TMP_9.$$s||this;return function(self){return eval(compiled)}(self)},TMP_9.$$s=self,TMP_9.$$arity=0,TMP_9),$b).call($c));var old=block.$$s,result;if(block.$$s=null,self.$$is_class||self.$$is_module){self.$$eval=!0;try{result=block.call(self,self)}finally{self.$$eval=!1}}else result=block.call(self,self);return block.$$s=old,result},TMP_8.$$arity=-1),Opal.defn(self,"$instance_exec",TMP_10=function(e){var t,r=this,n=TMP_10.$$p,a=n||nil,i=arguments.length,o=i-0;o<0&&(o=0),t=new Array(o);for(var s=0;s<i;s++)t[s-0]=arguments[s];TMP_10.$$p=null,!1!==a&&a!==nil&&null!=a||$scope.get("Kernel").$raise($scope.get("ArgumentError"),"no block given");var l,c=a.$$s;if(a.$$s=null,r.$$is_class||r.$$is_module){r.$$eval=!0;try{l=a.apply(r,t)}finally{r.$$eval=!1}}else l=a.apply(r,t);return a.$$s=c,l},TMP_10.$$arity=-1),Opal.defn(self,"$singleton_method_added",TMP_11=function(e){return nil},TMP_11.$$arity=-1),Opal.defn(self,"$singleton_method_removed",TMP_12=function(e){return nil},TMP_12.$$arity=-1),Opal.defn(self,"$singleton_method_undefined",TMP_13=function(e){return nil},TMP_13.$$arity=-1),Opal.defn(self,"$method_missing",TMP_14=function(e,t){var r,n,a=this,i=(TMP_14.$$p,arguments.length),o=i-1;o<0&&(o=0),n=new Array(o);for(var s=1;s<i;s++)n[s-1]=arguments[s];return TMP_14.$$p=null,$scope.get("Kernel").$raise($scope.get("NoMethodError").$new(function(){return(r=a.$inspect&&!a.$inspect.$$stub)===nil||null==r||r.$$is_boolean&&1!=r?"undefined method `"+e+"' for "+a.$$class:"undefined method `"+e+"' for "+a.$inspect()+":"+a.$$class}(),e))},TMP_14.$$arity=-2),nil&&"method_missing"}($scope.base,null)},Opal.modules["corelib/kernel"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e<=t:e["$<="](t)}var n=(e.top,e),a=e.nil,i=(e.breaker,e.slice,e.module),o=e.gvars,s=e.hash2,l=e.klass;return e.add_stubs(["$raise","$new","$inspect","$!","$=~","$==","$object_id","$class","$coerce_to?","$<<","$allocate","$copy_instance_variables","$copy_singleton_methods","$initialize_clone","$initialize_copy","$define_method","$to_proc","$singleton_class","$initialize_dup","$for","$>","$size","$pop","$call","$append_features","$extended","$length","$respond_to?","$[]","$nil?","$to_a","$to_int","$fetch","$Integer","$Float","$to_ary","$to_str","$coerce_to","$to_s","$__id__","$instance_variable_name!","$coerce_to!","$===","$enum_for","$print","$format","$puts","$each","$<=","$empty?","$exception","$kind_of?","$respond_to_missing?","$try_convert!","$expand_path","$join","$start_with?","$sym","$arg","$open","$include"]),function(n){var l,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne,ae,ie,oe,se,le,ce,ue,$e,fe,pe,de,he,_e,ge=l=i(n,"Kernel"),me=(ge.$$proto,ge.$$scope);e.defn(ge,"$method_missing",c=function(e,t){var r,n=this,a=(c.$$p,arguments.length),i=a-1;i<0&&(i=0),r=new Array(i);for(var o=1;o<a;o++)r[o-1]=arguments[o];return c.$$p=null,n.$raise(me.get("NoMethodError").$new("undefined method `"+e+"' for "+n.$inspect(),e,r))},c.$$arity=-2),e.defn(ge,"$=~",u=function(e){return!1},u.$$arity=1),e.defn(ge,"$!~",$=function(e){return this["$=~"](e)["$!"]()},$.$$arity=1),e.defn(ge,"$===",f=function(e){var t,r=this;return!1!==(t=r.$object_id()["$=="](e.$object_id()))&&t!==a&&null!=t?t:r["$=="](e)},f.$$arity=1),e.defn(ge,"$<=>",p=function(e){var t=this;t.$$comparable=!0;var r=t["$=="](e);return r&&r!==a?0:a},p.$$arity=1),e.defn(ge,"$method",d=function(e){var t=this,r=t["$"+e];return r&&!r.$$stub||t.$raise(me.get("NameError").$new("undefined method `"+e+"' for class `"+t.$class()+"'",e)),me.get("Method").$new(t,r,e)},d.$$arity=1),e.defn(ge,"$methods",h=function(t){var r=this;null==t&&(t=!0);var n=[];for(var i in r)if("$"==i[0]&&"function"==typeof r[i]){if((0==t||t===a)&&!e.hasOwnProperty.call(r,i))continue;void 0===r[i].$$stub&&n.push(i.substr(1))}return n},h.$$arity=-1),e.alias(ge,"public_methods","methods"),e.defn(ge,"$Array",_=function(e){var t;return e===a?[]:e.$$is_array?e:(t=me.get("Opal")["$coerce_to?"](e,me.get("Array"),"to_ary"))!==a?t:(t=me.get("Opal")["$coerce_to?"](e,me.get("Array"),"to_a"),t!==a?t:[e])},_.$$arity=1),e.defn(ge,"$at_exit",g=function(){var e,t=g.$$p,r=t||a;return null==o.__at_exit__&&(o.__at_exit__=a),g.$$p=null,!1!==(e=o.__at_exit__)&&e!==a&&null!=e||(o.__at_exit__=[]),o.__at_exit__["$<<"](r)},g.$$arity=0),e.defn(ge,"$caller",m=function(){return[]},m.$$arity=0),e.defn(ge,"$class",y=function(){return this.$$class},y.$$arity=0),e.defn(ge,"$copy_instance_variables",v=function(e){var t=this;for(var r in e)e.hasOwnProperty(r)&&"$"!==r.charAt(0)&&(t[r]=e[r])},v.$$arity=1),e.defn(ge,"$copy_singleton_methods",b=function(t){var r,n=this;if(t.hasOwnProperty("$$meta")){var a=e.get_singleton_class(t).$$proto,i=e.get_singleton_class(n).$$proto;for(r in a)"$"===r.charAt(0)&&a.hasOwnProperty(r)&&(i[r]=a[r])}for(r in t)"$"===r.charAt(0)&&"$"!==r.charAt(1)&&t.hasOwnProperty(r)&&(n[r]=t[r])},b.$$arity=1),e.defn(ge,"$clone",x=function(){var e=this,t=a;return t=e.$class().$allocate(),t.$copy_instance_variables(e),t.$copy_singleton_methods(e),t.$initialize_clone(e),t},x.$$arity=0),e.defn(ge,"$initialize_clone",w=function(e){return this.$initialize_copy(e)},w.$$arity=1),e.defn(ge,"$define_singleton_method",A=function(e,t){var r,n,i=this,o=A.$$p,s=o||a;return A.$$p=null,(r=(n=i.$singleton_class()).$define_method,r.$$p=s.$to_proc(),r).call(n,e,t)},A.$$arity=-2),e.defn(ge,"$dup",k=function(){var e=this,t=a;return t=e.$class().$allocate(),t.$copy_instance_variables(e),t.$initialize_dup(e),t},k.$$arity=0),e.defn(ge,"$initialize_dup",E=function(e){return this.$initialize_copy(e)},E.$$arity=1),e.defn(ge,"$enum_for",C=function(t,r){var n,i,o,s=this,l=C.$$p,c=l||a;null==t&&(t="each");var u=arguments.length,$=u-1;$<0&&($=0),o=new Array($);for(var f=1;f<u;f++)o[f-1]=arguments[f];return C.$$p=null,(n=(i=me.get("Enumerator")).$for,n.$$p=c.$to_proc(),n).apply(i,[s,t].concat(e.to_a(o)))},C.$$arity=-1),e.alias(ge,"to_enum","enum_for"),e.defn(ge,"$equal?",S=function(e){return this===e},S.$$arity=1),e.defn(ge,"$exit",I=function(r){var n,i,s=a;for(null==o.__at_exit__&&(o.__at_exit__=a),null==r&&(r=!0),!1!==(n=o.__at_exit__)&&n!==a&&null!=n||(o.__at_exit__=[]);(i=t(o.__at_exit__.$size(),0))!==a&&null!=i&&(!i.$$is_boolean||1==i);)s=o.__at_exit__.$pop(),s.$call();return(n=!0===r)===a||null==n||n.$$is_boolean&&1!=n||(r=0),e.exit(r),a},I.$$arity=-1),e.defn(ge,"$extend",O=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=r.$singleton_class(),s=t.length-1;s>=0;s--){var l=t[s];l.$$is_module||r.$raise(me.get("TypeError"),"wrong argument type "+l.$class()+" (expected Module)"),l.$append_features(o),l.$extended(r)}return r},O.$$arity=-1),e.defn(ge,"$format",T=function(e,t){function r(){N&L&&d.$raise(me.get("ArgumentError"),"flag after width"),N&z&&d.$raise(me.get("ArgumentError"),"flag after precision")}function n(){N&L&&d.$raise(me.get("ArgumentError"),"width given twice"),N&z&&d.$raise(me.get("ArgumentError"),"width after precision")}function i(e){return e>=p.length&&d.$raise(me.get("ArgumentError"),"too few arguments"),p[e]}function s(){switch(D){case-1:d.$raise(me.get("ArgumentError"),"unnumbered("+F+") mixed with numbered");case-2:d.$raise(me.get("ArgumentError"),"unnumbered("+F+") mixed with named")}return D=F++,i(D-1)}function l(e){return D>0&&d.$raise(me.get("ArgumentError"),"numbered("+e+") after unnumbered("+D+")"),-2===D&&d.$raise(me.get("ArgumentError"),"numbered("+e+") after named"),e<1&&d.$raise(me.get("ArgumentError"),"invalid index - "+e+"$"),D=-1,i(e-1)}function c(){return void 0===M?s():M}function u(t){for(var r,n="";;v++){if(v===j&&d.$raise(me.get("ArgumentError"),"malformed format string - %*[0-9]"),e.charCodeAt(v)<48||e.charCodeAt(v)>57)return v--,r=parseInt(n,10)||0,r>2147483647&&d.$raise(me.get("ArgumentError"),t+" too big"),r;n+=e.charAt(v)}}function $(t){var r,n=u(t);return"$"===e.charAt(v+1)?(v++,r=l(n)):r=s(),r.$to_int()}var f,p,d=this,h=a;null==o.DEBUG&&(o.DEBUG=a);var _=arguments.length,g=_-1;g<0&&(g=0),p=new Array(g);for(var m=1;m<_;m++)p[m-1]=arguments[m];(f=p.$length()["$=="](1)?p["$[]"](0)["$respond_to?"]("to_ary"):p.$length()["$=="](1))===a||null==f||f.$$is_boolean&&1!=f||(h=me.get("Opal")["$coerce_to?"](p["$[]"](0),me.get("Array"),"to_ary"),((f=h["$nil?"]())===a||null==f||f.$$is_boolean&&1!=f)&&(p=h.$to_a()));var y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B="",R=0,j=e.length,F=1,D=0,L=32,z=128;for(v=e.indexOf("%");-1!==v;v=e.indexOf("%",v)){switch(x=void 0,N=0,A=-1,k=-1,M=void 0,y=v,v++,e.charAt(v)){case"%":R=v;case"":case"\n":case"\0":v++;continue}e:for(;v<j;v++)switch(e.charAt(v)){case" ":r(),N|=16;continue e;case"#":r(),N|=1;continue e;case"+":r(),N|=4;continue e;case"-":r(),N|=2;continue e;case"0":r(),N|=8;continue e;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(E=u("width"),"$"===e.charAt(v+1)){if(v+2===j){x="%",v++;break e}void 0!==M&&d.$raise(me.get("ArgumentError"),"value given twice - %"+E+"$"),M=l(E),v++}else n(),N|=L,A=E;continue e;case"<":case"{":for(S="<"===e.charAt(v)?">":"}",C="",v++;;v++){if(v===j&&d.$raise(me.get("ArgumentError"),"malformed name - unmatched parenthesis"),e.charAt(v)===S){if(D>0&&d.$raise(me.get("ArgumentError"),"named "+C+" after unnumbered("+D+")"),-1===D&&d.$raise(me.get("ArgumentError"),"named "+C+" after numbered"),D=-2,void 0!==p[0]&&p[0].$$is_hash||d.$raise(me.get("ArgumentError"),"one hash required"),M=p[0].$fetch(C),">"===S)continue e;if(x=M.toString(),-1!==k&&(x=x.slice(0,k)),2&N)for(;x.length<A;)x+=" ";else for(;x.length<A;)x=" "+x;break e}C+=e.charAt(v)}case"*":v++,n(),N|=L,A=$("width"),A<0&&(N|=2,A=-A);continue e;case".":if(N&z&&d.$raise(me.get("ArgumentError"),"precision given twice"),N|=64|z,k=0,v++,"*"===e.charAt(v)){v++,k=$("precision"),k<0&&(N&=-65);continue e}k=u("precision");continue e;case"d":case"i":case"u":if((b=d.$Integer(c()))>=0){for(x=b.toString();x.length<k;)x="0"+x;if(2&N)for((4&N||16&N)&&(x=(4&N?"+":" ")+x);x.length<A;)x+=" ";else if(8&N&&-1===k){for(;x.length<A-(4&N||16&N?1:0);)x="0"+x;(4&N||16&N)&&(x=(4&N?"+":" ")+x)}else for((4&N||16&N)&&(x=(4&N?"+":" ")+x);x.length<A;)x=" "+x}else{for(x=(-b).toString();x.length<k;)x="0"+x;if(2&N)for(x="-"+x;x.length<A;)x+=" ";else if(8&N&&-1===k){for(;x.length<A-1;)x="0"+x;x="-"+x}else for(x="-"+x;x.length<A;)x=" "+x}break e;case"b":case"B":case"o":case"x":case"X":switch(e.charAt(v)){case"b":case"B":I=2,O="0b",T=/^1+/,P="1";break;case"o":I=8,O="0",T=/^3?7+/,P="7";break;case"x":case"X":I=16,O="0x",T=/^f+/,P="f"}if((b=d.$Integer(c()))>=0){for(x=b.toString(I);x.length<k;)x="0"+x;if(2&N)for((4&N||16&N)&&(x=(4&N?"+":" ")+x),1&N&&0!==b&&(x=O+x);x.length<A;)x+=" ";else if(8&N&&-1===k){for(;x.length<A-(4&N||16&N?1:0)-(1&N&&0!==b?O.length:0);)x="0"+x;1&N&&0!==b&&(x=O+x),(4&N||16&N)&&(x=(4&N?"+":" ")+x)}else for(1&N&&0!==b&&(x=O+x),(4&N||16&N)&&(x=(4&N?"+":" ")+x);x.length<A;)x=" "+x}else if(4&N||16&N){for(x=(-b).toString(I);x.length<k;)x="0"+x;if(2&N)for(1&N&&(x=O+x),x="-"+x;x.length<A;)x+=" ";else if(8&N&&-1===k){for(;x.length<A-1-(1&N?2:0);)x="0"+x;1&N&&(x=O+x),x="-"+x}else for(1&N&&(x=O+x),x="-"+x;x.length<A;)x=" "+x}else{for(x=(b>>>0).toString(I).replace(T,P);x.length<k-2;)x=P+x;if(2&N)for(x=".."+x,1&N&&(x=O+x);x.length<A;)x+=" ";else if(8&N&&-1===k){for(;x.length<A-2-(1&N?O.length:0);)x=P+x;x=".."+x,1&N&&(x=O+x)}else for(x=".."+x,1&N&&(x=O+x);x.length<A;)x=" "+x}e.charAt(v)===e.charAt(v).toUpperCase()&&(x=x.toUpperCase());break e;case"f":case"e":case"E":case"g":case"G":if((b=d.$Float(c()))>=0||isNaN(b)){if(b===1/0)x="Inf";else switch(e.charAt(v)){case"f":x=b.toFixed(-1===k?6:k);break;case"e":case"E":x=b.toExponential(-1===k?6:k);break;case"g":case"G":x=b.toExponential(),w=parseInt(x.split("e")[1],10),w<-4||w>=(-1===k?6:k)||(x=b.toPrecision(-1===k?1&N?6:void 0:k))}if(2&N)for((4&N||16&N)&&(x=(4&N?"+":" ")+x);x.length<A;)x+=" ";else if(8&N&&b!==1/0&&!isNaN(b)){for(;x.length<A-(4&N||16&N?1:0);)x="0"+x;(4&N||16&N)&&(x=(4&N?"+":" ")+x)}else for((4&N||16&N)&&(x=(4&N?"+":" ")+x);x.length<A;)x=" "+x}else{if(b===-1/0)x="Inf";else switch(e.charAt(v)){case"f":x=(-b).toFixed(-1===k?6:k);break;case"e":case"E":x=(-b).toExponential(-1===k?6:k);break;case"g":case"G":x=(-b).toExponential(),w=parseInt(x.split("e")[1],10),w<-4||w>=(-1===k?6:k)||(x=(-b).toPrecision(-1===k?1&N?6:void 0:k))}if(2&N)for(x="-"+x;x.length<A;)x+=" ";else if(8&N&&b!==-1/0){for(;x.length<A-1;)x="0"+x;x="-"+x}else for(x="-"+x;x.length<A;)x=" "+x}e.charAt(v)!==e.charAt(v).toUpperCase()||b===1/0||b===-1/0||isNaN(b)||(x=x.toUpperCase()),x=x.replace(/([eE][-+]?)([0-9])$/,"$10$2");break e;case"a":case"A":d.$raise(me.get("NotImplementedError"),"`A` and `a` format field types are not implemented in Opal yet");case"c":if(b=c(),b["$respond_to?"]("to_ary")&&(b=b.$to_ary()[0]),x=b["$respond_to?"]("to_str")?b.$to_str():String.fromCharCode(me.get("Opal").$coerce_to(b,me.get("Integer"),"to_int")),1!==x.length&&d.$raise(me.get("ArgumentError"),"%c requires a character"),2&N)for(;x.length<A;)x+=" ";else for(;x.length<A;)x=" "+x;break e;case"p":if(x=c().$inspect(),-1!==k&&(x=x.slice(0,k)),2&N)for(;x.length<A;)x+=" ";else for(;x.length<A;)x=" "+x;break e;case"s":if(x=c().$to_s(),-1!==k&&(x=x.slice(0,k)),2&N)for(;x.length<A;)x+=" ";else for(;x.length<A;)x=" "+x;break e;default:d.$raise(me.get("ArgumentError"),"malformed format string - %"+e.charAt(v))}void 0===x&&d.$raise(me.get("ArgumentError"),"malformed format string - %"),B+=e.slice(R,y)+x,R=v+1}return o.DEBUG&&D>=0&&F<p.length&&d.$raise(me.get("ArgumentError"),"too many arguments for format string"),B+e.slice(R)},T.$$arity=-2),e.defn(ge,"$hash",P=function(){return this.$__id__()},P.$$arity=0),e.defn(ge,"$initialize_copy",M=function(e){return a},M.$$arity=1),e.defn(ge,"$inspect",N=function(){return this.$to_s()},N.$$arity=0),e.defn(ge,"$instance_of?",B=function(e){var t=this;return e.$$is_class||e.$$is_module||t.$raise(me.get("TypeError"),"class or module required"),t.$$class===e},B.$$arity=1),e.defn(ge,"$instance_variable_defined?",R=function(t){var r=this;return t=me.get("Opal")["$instance_variable_name!"](t),e.hasOwnProperty.call(r,t.substr(1))},R.$$arity=1),
e.defn(ge,"$instance_variable_get",j=function(t){var r=this;t=me.get("Opal")["$instance_variable_name!"](t);var n=r[e.ivar(t.substr(1))];return null==n?a:n},j.$$arity=1),e.defn(ge,"$instance_variable_set",F=function(t,r){var n=this;return t=me.get("Opal")["$instance_variable_name!"](t),n[e.ivar(t.substr(1))]=r},F.$$arity=2),e.defn(ge,"$remove_instance_variable",D=function(t){var r=this;t=me.get("Opal")["$instance_variable_name!"](t);var n,a=e.ivar(t.substr(1));return r.hasOwnProperty(a)?(n=r[a],delete r[a],n):r.$raise(me.get("NameError"),"instance variable "+t+" not defined")},D.$$arity=1),e.defn(ge,"$instance_variables",L=function(){var e,t=this,r=[];for(var n in t)t.hasOwnProperty(n)&&"$"!==n.charAt(0)&&(e="$"===n.substr(-1)?n.slice(0,n.length-1):n,r.push("@"+e));return r},L.$$arity=0),e.defn(ge,"$Integer",z=function(e,t){var r,n,i,o=this;return e.$$is_string?(void 0===t?t=0:(1===(t=me.get("Opal").$coerce_to(t,me.get("Integer"),"to_int"))||t<0||t>36)&&o.$raise(me.get("ArgumentError"),"invalid radix "+t),n=e.toLowerCase(),n=n.replace(/(\d)_(?=\d)/g,"$1"),n=n.replace(/^(\s*[+-]?)(0[bodx]?)/,function(r,n,a){switch(a){case"0b":if(0===t||2===t)return t=2,n;case"0":case"0o":if(0===t||8===t)return t=8,n;case"0d":if(0===t||10===t)return t=10,n;case"0x":if(0===t||16===t)return t=16,n}o.$raise(me.get("ArgumentError"),'invalid value for Integer(): "'+e+'"')}),t=0===t?10:t,i="0-"+(t<=10?t-1:"9a-"+String.fromCharCode(t-11+97)),new RegExp("^\\s*[+-]?["+i+"]+\\s*$").test(n)||o.$raise(me.get("ArgumentError"),'invalid value for Integer(): "'+e+'"'),r=parseInt(n,t),isNaN(r)&&o.$raise(me.get("ArgumentError"),'invalid value for Integer(): "'+e+'"'),r):(void 0!==t&&o.$raise(me.get("ArgumentError"),"base specified for non string value"),e===a&&o.$raise(me.get("TypeError"),"can't convert nil into Integer"),e.$$is_number?((e===1/0||e===-1/0||isNaN(e))&&o.$raise(me.get("FloatDomainError"),e),Math.floor(e)):e["$respond_to?"]("to_int")&&(r=e.$to_int())!==a?r:me.get("Opal")["$coerce_to!"](e,me.get("Integer"),"to_i"))},z.$$arity=-2),e.defn(ge,"$Float",q=function(e){var t,r=this;return e===a&&r.$raise(me.get("TypeError"),"can't convert nil into Float"),e.$$is_string?(t=e.toString(),t=t.replace(/(\d)_(?=\d)/g,"$1"),/^\s*[-+]?0[xX][0-9a-fA-F]+\s*$/.test(t)?r.$Integer(t):(/^\s*[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(t)||r.$raise(me.get("ArgumentError"),'invalid value for Float(): "'+e+'"'),parseFloat(t))):me.get("Opal")["$coerce_to!"](e,me.get("Float"),"to_f")},q.$$arity=1),e.defn(ge,"$Hash",U=function(e){var t,r;return(t=!1!==(r=e["$nil?"]())&&r!==a&&null!=r?r:e["$=="]([]))===a||null==t||t.$$is_boolean&&1!=t?(t=me.get("Hash")["$==="](e))===a||null==t||t.$$is_boolean&&1!=t?me.get("Opal")["$coerce_to!"](e,me.get("Hash"),"to_hash"):e:s([],{})},U.$$arity=1),e.defn(ge,"$is_a?",H=function(t){var r=this;return t.$$is_class||t.$$is_module||r.$raise(me.get("TypeError"),"class or module required"),e.is_a(r,t)},H.$$arity=1),e.alias(ge,"kind_of?","is_a?"),e.defn(ge,"$lambda",G=function(){var e=G.$$p,t=e||a;return G.$$p=null,t.$$is_lambda=!0,t},G.$$arity=0),e.defn(ge,"$load",Y=function(t){return t=me.get("Opal")["$coerce_to!"](t,me.get("String"),"to_str"),e.load(t)},Y.$$arity=1),e.defn(ge,"$loop",Q=function(){var t=this,r=Q.$$p,n=r||a;if(Q.$$p=null,n===a)return t.$enum_for("loop");for(;;)e.yieldX(n,[]);return t},Q.$$arity=0),e.defn(ge,"$nil?",V=function(){return!1},V.$$arity=0),e.alias(ge,"object_id","__id__"),e.defn(ge,"$printf",X=function(r){var n,i,o=this,s=arguments.length,l=s-0;l<0&&(l=0),i=new Array(l);for(var c=0;c<s;c++)i[c-0]=arguments[c];return(n=t(i.$length(),0))===a||null==n||n.$$is_boolean&&1!=n||o.$print((n=o).$format.apply(n,e.to_a(i))),a},X.$$arity=-1),e.defn(ge,"$proc",W=function(){var e=this,t=W.$$p,r=t||a;return W.$$p=null,!1!==r&&r!==a&&null!=r||e.$raise(me.get("ArgumentError"),"tried to create Proc object without a block"),r.$$is_lambda=!1,r},W.$$arity=0),e.defn(ge,"$puts",J=function(t){var r,n;null==o.stdout&&(o.stdout=a);var i=arguments.length,s=i-0;s<0&&(s=0),n=new Array(s);for(var l=0;l<i;l++)n[l-0]=arguments[l];return(r=o.stdout).$puts.apply(r,e.to_a(n))},J.$$arity=-1),e.defn(ge,"$p",K=function(e){var t,n,i,s,l=this,c=arguments.length,u=c-0;u<0&&(u=0),s=new Array(u);for(var $=0;$<c;$++)s[$-0]=arguments[$];return(t=(n=s).$each,t.$$p=(i=function(e){i.$$s;return null==o.stdout&&(o.stdout=a),null==e&&(e=a),o.stdout.$puts(e.$inspect())},i.$$s=l,i.$$arity=1,i),t).call(n),(t=r(s.$length(),1))===a||null==t||t.$$is_boolean&&1!=t?s:s["$[]"](0)},K.$$arity=-1),e.defn(ge,"$print",Z=function(t){var r,n;null==o.stdout&&(o.stdout=a);var i=arguments.length,s=i-0;s<0&&(s=0),n=new Array(s);for(var l=0;l<i;l++)n[l-0]=arguments[l];return(r=o.stdout).$print.apply(r,e.to_a(n))},Z.$$arity=-1),e.defn(ge,"$warn",ee=function(t){var r,n,i;null==o.VERBOSE&&(o.VERBOSE=a),null==o.stderr&&(o.stderr=a);var s=arguments.length,l=s-0;l<0&&(l=0),i=new Array(l);for(var c=0;c<s;c++)i[c-0]=arguments[c];return(r=!1!==(n=o.VERBOSE["$nil?"]())&&n!==a&&null!=n?n:i["$empty?"]())===a||null==r||r.$$is_boolean&&1!=r?(r=o.stderr).$puts.apply(r,e.to_a(i)):a},ee.$$arity=-1),e.defn(ge,"$raise",te=function(t,r,n){if(null==o["!"]&&(o["!"]=a),null==r&&(r=a),null==n&&(n=a),null==t&&o["!"]!==a)throw o["!"];throw null==t?t=me.get("RuntimeError").$new():t.$$is_string?t=me.get("RuntimeError").$new(t):t.$$is_class&&t["$respond_to?"]("exception")?t=t.$exception(r):t["$kind_of?"](me.get("Exception"))||(t=me.get("TypeError").$new("exception class/object expected")),o["!"]!==a&&e.exceptions.push(o["!"]),o["!"]=t,t},te.$$arity=-1),e.alias(ge,"fail","raise"),e.defn(ge,"$rand",re=function(e){var t=this;if(void 0===e)return Math.random();if(e.$$is_range){var r=e.begin,n=e.end-r;return e.exclude||n++,t.$rand(n)+r}return Math.floor(Math.random()*Math.abs(me.get("Opal").$coerce_to(e,me.get("Integer"),"to_int")))},re.$$arity=-1),e.defn(ge,"$respond_to?",ne=function(e,t){var r,n=this;if(null==t&&(t=!1),(r=n["$respond_to_missing?"](e,t))!==a&&null!=r&&(!r.$$is_boolean||1==r))return!0;var i=n["$"+e];return"function"==typeof i&&!i.$$stub},ne.$$arity=-2),e.defn(ge,"$respond_to_missing?",ae=function(e,t){return null==t&&(t=!1),!1},ae.$$arity=-2),e.defn(ge,"$require",ie=function(t){return t=me.get("Opal")["$coerce_to!"](t,me.get("String"),"to_str"),e.require(t)},ie.$$arity=1),e.defn(ge,"$require_relative",oe=function(t){return me.get("Opal")["$try_convert!"](t,me.get("String"),"to_str"),t=me.get("File").$expand_path(me.get("File").$join(e.current_file,"..",t)),e.require(t)},oe.$$arity=1),e.defn(ge,"$require_tree",se=function(t){t=me.get("File").$expand_path(t),t["$=="](".")&&(t="");for(var r in e.modules)r["$start_with?"](t)&&e.require(r);return a},se.$$arity=1),e.alias(ge,"send","__send__"),e.alias(ge,"public_send","__send__"),e.defn(ge,"$singleton_class",le=function(){var t=this;return e.get_singleton_class(t)},le.$$arity=0),e.defn(ge,"$sleep",ce=function(e){var t=this;null==e&&(e=a),e===a&&t.$raise(me.get("TypeError"),"can't convert NilClass into time interval"),e.$$is_number||t.$raise(me.get("TypeError"),"can't convert "+e.$class()+" into time interval"),e<0&&t.$raise(me.get("ArgumentError"),"time interval must be positive");for(var r=new Date;new Date-r<=1e3*e;);return e},ce.$$arity=-1),e.alias(ge,"sprintf","format"),e.alias(ge,"srand","rand"),e.defn(ge,"$String",ue=function(e){var t;return!1!==(t=me.get("Opal")["$coerce_to?"](e,me.get("String"),"to_str"))&&t!==a&&null!=t?t:me.get("Opal")["$coerce_to!"](e,me.get("String"),"to_s")},ue.$$arity=1),e.defn(ge,"$tap",$e=function(){var t=this,r=$e.$$p,n=r||a;return $e.$$p=null,e.yield1(n,t),t},$e.$$arity=0),e.defn(ge,"$to_proc",fe=function(){return this},fe.$$arity=0),e.defn(ge,"$to_s",pe=function(){var e=this;return"#<"+e.$class()+":0x"+e.$__id__().$to_s(16)+">"},pe.$$arity=0),e.defn(ge,"$catch",de=function(t){var r=this,n=de.$$p,i=n||a,o=a;de.$$p=null;try{return e.yieldX(i,[])}catch(n){if(!e.rescue(n,[me.get("UncaughtThrowError")]))throw n;o=n;try{return o.$sym()["$=="](t)?o.$arg():r.$raise()}finally{e.pop_exception()}}},de.$$arity=1),e.defn(ge,"$throw",he=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];return r.$raise(me.get("UncaughtThrowError").$new(t))},he.$$arity=-1),e.defn(ge,"$open",_e=function(t){var r,n,i,o=_e.$$p,s=o||a,l=arguments.length,c=l-0;c<0&&(c=0),i=new Array(c);for(var u=0;u<l;u++)i[u-0]=arguments[u];return _e.$$p=null,(r=(n=me.get("File")).$open,r.$$p=s.$to_proc(),r).apply(n,e.to_a(i))},_e.$$arity=-1)}(n.base),function(e,t){function r(){}var n=r=l(e,null,"Object",r),a=(n.$$proto,n.$$scope);return n.$include(a.get("Kernel"))}(n.base)},Opal.modules["corelib/error"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}var r=(e.top,e),n=e.nil,a=(e.breaker,e.slice,e.klass),i=e.module;return e.add_stubs(["$new","$clone","$to_s","$empty?","$class","$attr_reader","$[]","$>","$length","$inspect"]),function(t,r){function i(){}var o,s,l,c,u,$,f,p,d=i=a(t,r,"Exception",i),h=d.$$proto;d.$$scope;h.message=n,e.defs(d,"$new",o=function(e){var t,r=this,a=arguments.length,i=a-0;i<0&&(i=0),t=new Array(i);for(var o=0;o<a;o++)t[o-0]=arguments[o];var s=t.length>0?t[0]:n,l=new r.$$alloc(s);return Error.captureStackTrace&&Error.captureStackTrace(l),l.name=r.$$name,l.$initialize.apply(l,t),l},o.$$arity=-1),e.defs(d,"$exception",s=function(t){var r,n,a=this,i=arguments.length,o=i-0;o<0&&(o=0),n=new Array(o);for(var s=0;s<i;s++)n[s-0]=arguments[s];return(r=a).$new.apply(r,e.to_a(n))},s.$$arity=-1),e.defn(d,"$initialize",l=function(e){var t,r=this,a=arguments.length,i=a-0;i<0&&(i=0),t=new Array(i);for(var o=0;o<a;o++)t[o-0]=arguments[o];return r.message=t.length>0?t[0]:n},l.$$arity=-1),e.defn(d,"$backtrace",c=function(){var e=this,t=e.stack;return"string"==typeof t?t.split("\n").slice(0,15):t?t.slice(0,15):[]},c.$$arity=0),e.defn(d,"$exception",u=function(e){var t=this;if(null==e&&(e=n),e===n||t===e)return t;var r=t.$clone();return r.message=e,r},u.$$arity=-1),e.defn(d,"$message",$=function(){return this.$to_s()},$.$$arity=0),e.defn(d,"$inspect",f=function(){var e,t=this,r=n;return r=t.$to_s(),(e=r["$empty?"]())===n||null==e||e.$$is_boolean&&1!=e?"#<"+t.$class().$to_s()+": "+t.$to_s()+">":t.$class().$to_s()},f.$$arity=0),e.defn(d,"$to_s",p=function(){var e,t,r=this;return!1!==(t=r.message,e=!1!==t&&t!==n&&null!=t?r.message.$to_s():t)&&e!==n&&null!=e?e:r.$class().$to_s()},p.$$arity=0)}(r.base,Error),function(e,t){function r(){}var n=r=a(e,t,"ScriptError",r);n.$$proto,n.$$scope}(r.base,r.get("Exception")),function(e,t){function r(){}var n=r=a(e,t,"SyntaxError",r);n.$$proto,n.$$scope}(r.base,r.get("ScriptError")),function(e,t){function r(){}var n=r=a(e,t,"LoadError",r);n.$$proto,n.$$scope}(r.base,r.get("ScriptError")),function(e,t){function r(){}var n=r=a(e,t,"NotImplementedError",r);n.$$proto,n.$$scope}(r.base,r.get("ScriptError")),function(e,t){function r(){}var n=r=a(e,t,"SystemExit",r);n.$$proto,n.$$scope}(r.base,r.get("Exception")),function(e,t){function r(){}var n=r=a(e,t,"NoMemoryError",r);n.$$proto,n.$$scope}(r.base,r.get("Exception")),function(e,t){function r(){}var n=r=a(e,t,"SignalException",r);n.$$proto,n.$$scope}(r.base,r.get("Exception")),function(e,t){function r(){}var n=r=a(e,t,"Interrupt",r);n.$$proto,n.$$scope}(r.base,r.get("Exception")),function(e,t){function r(){}var n=r=a(e,t,"SecurityError",r);n.$$proto,n.$$scope}(r.base,r.get("Exception")),function(e,t){function r(){}var n=r=a(e,t,"StandardError",r);n.$$proto,n.$$scope}(r.base,r.get("Exception")),function(e,t){function r(){}var n=r=a(e,t,"ZeroDivisionError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"NameError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"NoMethodError",r);n.$$proto,n.$$scope}(r.base,r.get("NameError")),function(e,t){function r(){}var n=r=a(e,t,"RuntimeError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"LocalJumpError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"TypeError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"ArgumentError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"IndexError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"StopIteration",r);n.$$proto,n.$$scope}(r.base,r.get("IndexError")),function(e,t){function r(){}var n=r=a(e,t,"KeyError",r);n.$$proto,n.$$scope}(r.base,r.get("IndexError")),function(e,t){function r(){}var n=r=a(e,t,"RangeError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"FloatDomainError",r);n.$$proto,n.$$scope}(r.base,r.get("RangeError")),function(e,t){function r(){}var n=r=a(e,t,"IOError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(e,t){function r(){}var n=r=a(e,t,"SystemCallError",r);n.$$proto,n.$$scope}(r.base,r.get("StandardError")),function(t){var r,n=r=i(t,"Errno"),o=(n.$$proto,n.$$scope);!function(t,r){function n(){}var i,o=n=a(t,r,"EINVAL",n);o.$$proto,o.$$scope;e.defs(o,"$new",i=function(){var t,r,a=this;i.$$p;return i.$$p=null,(r=a,t=e.find_super_dispatcher(a,"new",i,!1,n),t.$$p=null,t).call(r,"Invalid argument")},i.$$arity=0)}(o.base,o.get("SystemCallError"))}(r.base),function(r,i){function o(){}var s,l=o=a(r,i,"UncaughtThrowError",o),c=l.$$proto;l.$$scope;c.sym=n,l.$attr_reader("sym","arg"),e.defn(l,"$initialize",s=function(r){var a,i,o=this;s.$$p;return s.$$p=null,o.sym=r["$[]"](0),(a=t(r.$length(),1))===n||null==a||a.$$is_boolean&&1!=a||(o.arg=r["$[]"](1)),(i=o,a=e.find_super_dispatcher(o,"initialize",s,!1),a.$$p=null,a).call(i,"uncaught throw "+o.sym.$inspect())},s.$$arity=1)}(r.base,r.get("ArgumentError")),function(t,r){function i(){}var o,s=i=a(t,null,"NameError",i);s.$$proto,s.$$scope;s.$attr_reader("name"),e.defn(s,"$initialize",o=function(t,r){var a,i,s=this;o.$$p;return null==r&&(r=n),o.$$p=null,(i=s,a=e.find_super_dispatcher(s,"initialize",o,!1),a.$$p=null,a).call(i,t),s.name=r},o.$$arity=-2)}(r.base),function(t,r){function i(){}var o,s=i=a(t,null,"NoMethodError",i);s.$$proto,s.$$scope;return s.$attr_reader("args"),e.defn(s,"$initialize",o=function(t,r,a){var i,s,l=this;o.$$p;return null==r&&(r=n),null==a&&(a=[]),o.$$p=null,(s=l,i=e.find_super_dispatcher(l,"initialize",o,!1),i.$$p=null,i).call(s,t,r),l.args=a},o.$$arity=-2),n&&"initialize"}(r.base)},Opal.modules["corelib/constants"]=function(e){var t=(e.top,e);e.nil,e.breaker,e.slice;return e.cdecl(t,"RUBY_PLATFORM","opal"),e.cdecl(t,"RUBY_ENGINE","opal"),e.cdecl(t,"RUBY_VERSION","2.2.10"),e.cdecl(t,"RUBY_ENGINE_VERSION","0.10.6"),e.cdecl(t,"RUBY_RELEASE_DATE","2018-06-21"),e.cdecl(t,"RUBY_PATCHLEVEL",0),e.cdecl(t,"RUBY_REVISION",0),e.cdecl(t,"RUBY_COPYRIGHT","opal - Copyright (C) 2013-2015 Adam Beynon"),e.cdecl(t,"RUBY_DESCRIPTION","opal "+t.get("RUBY_ENGINE_VERSION")+" ("+t.get("RUBY_RELEASE_DATE")+" revision "+t.get("RUBY_REVISION")+")")},Opal.modules["opal/base"]=function(e){var t=e.top;e.nil,e.breaker,e.slice;return e.add_stubs(["$require"]),t.$require("corelib/runtime"),t.$require("corelib/helpers"),t.$require("corelib/module"),t.$require("corelib/class"),t.$require("corelib/basic_object"),t.$require("corelib/kernel"),t.$require("corelib/error"),t.$require("corelib/constants")},Opal.modules["corelib/nil"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}var r=(e.top,e),n=e.nil,a=(e.breaker,e.slice,e.klass);return e.add_stubs(["$raise","$class","$new","$>","$length","$Rational"]),function(r,i){function o(){}var s,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k=o=a(r,null,"NilClass",o),E=k.$$proto,C=k.$$scope;E.$$meta=k,e.defn(k,"$!",s=function(){return!0},s.$$arity=0),e.defn(k,"$&",l=function(e){return!1},l.$$arity=1),e.defn(k,"$|",c=function(e){return!1!==e&&e!==n},c.$$arity=1),e.defn(k,"$^",u=function(e){return!1!==e&&e!==n},u.$$arity=1),e.defn(k,"$==",$=function(e){return e===n},$.$$arity=1),e.defn(k,"$dup",f=function(){var e=this;return e.$raise(C.get("TypeError"),"can't dup "+e.$class())},f.$$arity=0),e.defn(k,"$clone",p=function(){var e=this;return e.$raise(C.get("TypeError"),"can't clone "+e.$class())},p.$$arity=0),e.defn(k,"$inspect",d=function(){return"nil"},d.$$arity=0),e.defn(k,"$nil?",h=function(){return!0},h.$$arity=0),e.defn(k,"$singleton_class",_=function(){return C.get("NilClass")},_.$$arity=0),e.defn(k,"$to_a",g=function(){return[]},g.$$arity=0),e.defn(k,"$to_h",m=function(){return e.hash()},m.$$arity=0),e.defn(k,"$to_i",y=function(){return 0},y.$$arity=0),e.alias(k,"to_f","to_i"),e.defn(k,"$to_s",v=function(){return""},v.$$arity=0),e.defn(k,"$to_c",b=function(){return C.get("Complex").$new(0,0)},b.$$arity=0),e.defn(k,"$rationalize",x=function(e){var r,a,i=this,o=arguments.length,s=o-0;s<0&&(s=0),a=new Array(s);for(var l=0;l<o;l++)a[l-0]=arguments[l];return(r=t(a.$length(),1))===n||null==r||r.$$is_boolean&&1!=r||i.$raise(C.get("ArgumentError")),i.$Rational(0,1)},x.$$arity=-1),e.defn(k,"$to_r",w=function(){return this.$Rational(0,1)},w.$$arity=0),e.defn(k,"$instance_variables",A=function(){return[]},A.$$arity=0)}(r.base),e.cdecl(r,"NIL",n)},Opal.modules["corelib/boolean"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.klass);return e.add_stubs(["$raise","$class"]),function(t,a){function i(){}var o,s,l,c,u,$,f,p,d,h,_=i=n(t,a,"Boolean",i),g=_.$$proto,m=_.$$scope;g.$$is_boolean=!0,g.$$meta=_,e.defn(_,"$__id__",o=function(){return this.valueOf()?2:0},o.$$arity=0),e.alias(_,"object_id","__id__"),e.defn(_,"$!",s=function(){return 1!=this},s.$$arity=0),e.defn(_,"$&",l=function(e){return 1==this&&!1!==e&&e!==r},l.$$arity=1),e.defn(_,"$|",c=function(e){return 1==this||!1!==e&&e!==r},c.$$arity=1),e.defn(_,"$^",u=function(e){return 1==this?!1===e||e===r:!1!==e&&e!==r},u.$$arity=1),e.defn(_,"$==",$=function(e){return 1==this===e.valueOf()},$.$$arity=1),e.alias(_,"equal?","=="),e.alias(_,"eql?","=="),e.defn(_,"$singleton_class",f=function(){return m.get("Boolean")},f.$$arity=0),e.defn(_,"$to_s",p=function(){return 1==this?"true":"false"},p.$$arity=0),e.defn(_,"$dup",d=function(){var e=this;return e.$raise(m.get("TypeError"),"can't dup "+e.$class())},d.$$arity=0),e.defn(_,"$clone",h=function(){var e=this;return e.$raise(m.get("TypeError"),"can't clone "+e.$class())},h.$$arity=0)}(t.base,Boolean),e.cdecl(t,"TrueClass",t.get("Boolean")),e.cdecl(t,"FalseClass",t.get("Boolean")),e.cdecl(t,"TRUE",!0),e.cdecl(t,"FALSE",!1)},Opal.modules["corelib/comparable"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}var n=(e.top,e),a=e.nil,i=(e.breaker,e.slice,e.module);return e.add_stubs(["$===","$>","$<","$equal?","$<=>","$normalize","$raise","$class"]),function(n){var o,s,l,c,u,$,f,p,d=o=i(n,"Comparable"),h=(d.$$proto,d.$$scope);e.defs(d,"$normalize",s=function(e){var n;return(n=h.get("Integer")["$==="](e))===a||null==n||n.$$is_boolean&&1!=n?(n=t(e,0))===a||null==n||n.$$is_boolean&&1!=n?(n=r(e,0))===a||null==n||n.$$is_boolean&&1!=n?0:-1:1:e},s.$$arity=1),e.defn(d,"$==",l=function(t){var r,n=this,i=a;try{return!((r=n["$equal?"](t))===a||null==r||r.$$is_boolean&&1!=r)||n["$<=>"]!=e.Kernel["$<=>"]&&(n.$$comparable?(delete n.$$comparable,!1):!((r=i=n["$<=>"](t))===a||null==r||r.$$is_boolean&&1!=r)&&0==h.get("Comparable").$normalize(i))}catch(t){if(!e.rescue(t,[h.get("StandardError")]))throw t;try{return!1}finally{e.pop_exception()}}},l.$$arity=1),e.defn(d,"$>",c=function(e){var t,r=this,n=a;return((t=n=r["$<=>"](e))===a||null==t||t.$$is_boolean&&1!=t)&&r.$raise(h.get("ArgumentError"),"comparison of "+r.$class()+" with "+e.$class()+" failed"),h.get("Comparable").$normalize(n)>0},c.$$arity=1),e.defn(d,"$>=",u=function(e){var t,r=this,n=a;return((t=n=r["$<=>"](e))===a||null==t||t.$$is_boolean&&1!=t)&&r.$raise(h.get("ArgumentError"),"comparison of "+r.$class()+" with "+e.$class()+" failed"),h.get("Comparable").$normalize(n)>=0},u.$$arity=1),e.defn(d,"$<",$=function(e){var t,r=this,n=a;return((t=n=r["$<=>"](e))===a||null==t||t.$$is_boolean&&1!=t)&&r.$raise(h.get("ArgumentError"),"comparison of "+r.$class()+" with "+e.$class()+" failed"),h.get("Comparable").$normalize(n)<0},$.$$arity=1),e.defn(d,"$<=",f=function(e){var t,r=this,n=a;return((t=n=r["$<=>"](e))===a||null==t||t.$$is_boolean&&1!=t)&&r.$raise(h.get("ArgumentError"),"comparison of "+r.$class()+" with "+e.$class()+" failed"),h.get("Comparable").$normalize(n)<=0},f.$$arity=1),e.defn(d,"$between?",p=function(e,n){var a=this;return!r(a,e)&&!t(a,n)},p.$$arity=2)}(n.base)},Opal.modules["corelib/regexp"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.klass),a=e.gvars;return e.add_stubs(["$nil?","$[]","$raise","$escape","$options","$to_str","$new","$join","$coerce_to!","$!","$match","$coerce_to?","$begin","$coerce_to","$call","$=~","$attr_reader","$===","$inspect","$to_a"]),function(e,t){function r(){}var a=r=n(e,t,"RegexpError",r);a.$$proto,a.$$scope}(t.base,t.get("StandardError")),function(t,i){function o(){}var s,l,c,u,$,f,p,d,h,_,g=o=n(t,i,"Regexp",o),m=g.$$proto,y=g.$$scope;e.cdecl(y,"IGNORECASE",1),e.cdecl(y,"MULTILINE",4),m.$$is_regexp=!0,function(t){var n,i,o,s,l,c=t.$$scope;t.$$proto;e.defn(t,"$allocate",n=function(){var t,a,i=this,o=n.$$p,s=r,l=r,c=r;for(n.$$p=null,l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];return s=(a=i,t=e.find_super_dispatcher(i,"allocate",n,!1),t.$$p=o,t).apply(a,l),s.uninitialized=!0,s},n.$$arity=0),e.defn(t,"$escape",i=function(e){return e.replace(/([-[\]\/{}()*+?.^$\\| ])/g,"\\$1").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\f]/g,"\\f").replace(/[\t]/g,"\\t")},i.$$arity=1),e.defn(t,"$last_match",o=function(e){var t;return null==a["~"]&&(a["~"]=r),null==e&&(e=r),(t=e["$nil?"]())===r||null==t||t.$$is_boolean&&1!=t?a["~"]["$[]"](e):a["~"]},o.$$arity=-1),e.alias(t,"quote","escape"),e.defn(t,"$union",s=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];var o,s,l,u,$;if(0==t.length)return/(?!)/;o=t[0].$$is_array,t.length>1&&o&&r.$raise(c.get("TypeError"),"no implicit conversion of Array into String"),o&&(t=t[0]),u=void 0,s=[];for(var f=0;f<t.length;f++)l=t[f],l.$$is_string?s.push(r.$escape(l)):l.$$is_regexp?($=l.$options(),void 0!=u&&u!=$&&r.$raise(c.get("TypeError"),"All expressions must use the same options"),u=$,s.push("("+l.source+")")):s.push(r.$escape(l.$to_str()));return r.$new(s.$join("|"),u)},s.$$arity=-1),e.defn(t,"$new",l=function(e,t){var r=this;if(e.$$is_regexp)return new RegExp(e);if(e=c.get("Opal")["$coerce_to!"](e,c.get("String"),"to_str"),"\\"===e.charAt(e.length-1)&&"\\"!==e.charAt(e.length-2)&&r.$raise(c.get("RegexpError"),"too short escape sequence: /"+e+"/"),void 0===t||t["$!"]())return new RegExp(e);if(t.$$is_number){var n="";c.get("IGNORECASE")&t&&(n+="i"),c.get("MULTILINE")&t&&(n+="m"),t=n}else t="i";return new RegExp(e,t)},l.$$arity=-2)}(e.get_singleton_class(g)),e.defn(g,"$==",s=function(e){var t=this;return e.constructor==RegExp&&t.toString()===e.toString()},s.$$arity=1),e.defn(g,"$===",l=function(e){return this.$match(y.get("Opal")["$coerce_to?"](e,y.get("String"),"to_str"))!==r},l.$$arity=1),e.defn(g,"$=~",c=function(e){var t,n=this;return null==a["~"]&&(a["~"]=r),t=n.$match(e),!1!==t&&t!==r&&null!=t?a["~"].$begin(0):t},c.$$arity=1),e.alias(g,"eql?","=="),e.defn(g,"$inspect",u=function(){return this.toString()},u.$$arity=0),e.defn(g,"$match",$=function(e,t){var n=this,i=$.$$p,o=i||r;if(null==a["~"]&&(a["~"]=r),$.$$p=null,n.uninitialized&&n.$raise(y.get("TypeError"),"uninitialized Regexp"),t=void 0===t?0:y.get("Opal").$coerce_to(t,y.get("Integer"),"to_int"),e===r)return a["~"]=r;if(e=y.get("Opal").$coerce_to(e,y.get("String"),"to_str"),t<0&&(t+=e.length)<0)return a["~"]=r;var s=n.source,l="g";n.multiline&&(s=s.replace(".","[\\s\\S]"),l+="m");for(var c,u=new RegExp(s,l+(n.ignoreCase?"i":""));;){if(null===(c=u.exec(e)))return a["~"]=r;if(c.index>=t)return a["~"]=y.get("MatchData").$new(u,c),o===r?a["~"]:o.$call(a["~"]);u.lastIndex=c.index+1}},$.$$arity=-2),e.defn(g,"$~",f=function(){var e=this;return null==a._&&(a._=r),e["$=~"](a._)},f.$$arity=0),e.defn(g,"$source",p=function(){return this.source},p.$$arity=0),e.defn(g,"$options",d=function(){var e=this;e.uninitialized&&e.$raise(y.get("TypeError"),"uninitialized Regexp");var t=0;return e.multiline&&(t|=y.get("MULTILINE")),e.ignoreCase&&(t|=y.get("IGNORECASE")),t},d.$$arity=0),e.defn(g,"$casefold?",h=function(){return this.ignoreCase},h.$$arity=0),e.alias(g,"to_s","source"),e.defs(g,"$_load",_=function(t){var r;return(r=this).$new.apply(r,e.to_a(t))},_.$$arity=1)}(t.base,RegExp),function(t,i){function o(){}var s,l,c,u,$,f,p,d,h,_,g,m,y=o=n(t,null,"MatchData",o),v=y.$$proto,b=y.$$scope;return v.matches=r,y.$attr_reader("post_match","pre_match","regexp","string"),e.defn(y,"$initialize",s=function(e,t){var n=this;a["~"]=n,n.regexp=e,n.begin=t.index,n.string=t.input,n.pre_match=t.input.slice(0,t.index),n.post_match=t.input.slice(t.index+t[0].length),n.matches=[];for(var i=0,o=t.length;i<o;i++){var s=t[i];null==s?n.matches.push(r):n.matches.push(s)}},s.$$arity=2),e.defn(y,"$[]",l=function(t){var r,n,a=this,i=arguments.length,o=i-0;o<0&&(o=0),n=new Array(o);for(var s=0;s<i;s++)n[s-0]=arguments[s];return(r=a.matches)["$[]"].apply(r,e.to_a(n))},l.$$arity=-1),e.defn(y,"$offset",c=function(e){var t=this;return 0!==e&&t.$raise(b.get("ArgumentError"),"MatchData#offset only supports 0th element"),[t.begin,t.begin+t.matches[e].length]},c.$$arity=1),e.defn(y,"$==",u=function(e){var t,n,a,i,o=this;return!((t=b.get("MatchData")["$==="](e))===r||null==t||t.$$is_boolean&&1!=t)&&(i=o.string==e.string,a=!1!==i&&i!==r&&null!=i?o.regexp.toString()==e.regexp.toString():i,n=!1!==a&&a!==r&&null!=a?o.pre_match==e.pre_match:a,t=!1!==n&&n!==r&&null!=n?o.post_match==e.post_match:n,!1!==t&&t!==r&&null!=t?o.begin==e.begin:t)},u.$$arity=1),e.alias(y,"eql?","=="),e.defn(y,"$begin",$=function(e){var t=this;return 0!==e&&t.$raise(b.get("ArgumentError"),"MatchData#begin only supports 0th element"),t.begin},$.$$arity=1),e.defn(y,"$end",f=function(e){var t=this;return 0!==e&&t.$raise(b.get("ArgumentError"),"MatchData#end only supports 0th element"),t.begin+t.matches[e].length},f.$$arity=1),e.defn(y,"$captures",p=function(){return this.matches.slice(1)},p.$$arity=0),e.defn(y,"$inspect",d=function(){for(var e=this,t="#<MatchData "+e.matches[0].$inspect(),r=1,n=e.matches.length;r<n;r++)t+=" "+r+":"+e.matches[r].$inspect();return t+">"},d.$$arity=0),e.defn(y,"$length",h=function(){return this.matches.length},h.$$arity=0),e.alias(y,"size","length"),e.defn(y,"$to_a",_=function(){return this.matches},_.$$arity=0),e.defn(y,"$to_s",g=function(){return this.matches[0]},g.$$arity=0),e.defn(y,"$values_at",m=function(e){var t,n=this,a=arguments.length,i=a-0;i<0&&(i=0),t=new Array(i);for(var o=0;o<a;o++)t[o-0]=arguments[o];var s,l,c,u=[];for(s=0;s<t.length;s++)t[s].$$is_range&&(l=t[s].$to_a(),l.unshift(s,1),Array.prototype.splice.apply(t,l)),c=b.get("Opal")["$coerce_to!"](t[s],b.get("Integer"),"to_int"),c<0&&(c+=n.matches.length)<0?u.push(r):u.push(n.matches[c]);return u},m.$$arity=-1),r&&"values_at"}(t.base)},Opal.modules["corelib/string"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var n=e.top,a=e,i=e.nil,o=(e.breaker,e.slice,e.klass),s=e.gvars;return e.add_stubs(["$require","$include","$coerce_to?","$coerce_to","$raise","$===","$format","$to_s","$respond_to?","$to_str","$<=>","$==","$=~","$new","$empty?","$ljust","$ceil","$/","$+","$rjust","$floor","$to_a","$each_char","$to_proc","$coerce_to!","$copy_singleton_methods","$initialize_clone","$initialize_dup","$enum_for","$size","$chomp","$[]","$to_i","$each_line","$class","$match","$captures","$proc","$shift","$__send__","$succ","$escape"]),n.$require("corelib/comparable"),n.$require("corelib/regexp"),function(n,a){function l(){}function c(e){function t(e,t){if(0===e.length)return t;var r,n,a="",i=e.length;for(r=0;r<i;r++)n=e.charAt(r),-1!==t.indexOf(n)&&(a+=n);return a}var r,n,a,i,o,s,l="",c="";for(r=0,n=e.length;r<n;r++)a=Ae.get("Opal").$coerce_to(e[r],Ae.get("String"),"to_str"),i="^"===a.charAt(0)&&a.length>1,a=function(e){var t,r,n,a,i,o,s="",l=e.length;for(t=0;t<l;t++)if("-"===(r=e.charAt(t))&&t>0&&t<l-1&&!n){for(a=e.charCodeAt(t-1),i=e.charCodeAt(t+1),a>i&&xe.$raise(Ae.get("ArgumentError"),'invalid range "'+a+"-"+i+'" in string transliteration'),o=a+1;o<i+1;o++)s+=String.fromCharCode(o);n=!0,t++}else n="\\"===r,s+=r;return s}(i?a.slice(1):a),i?c=t(c,a):l=t(l,a);if(l.length>0&&c.length>0){for(s="",r=0,n=l.length;r<n;r++)o=l.charAt(r),-1===c.indexOf(o)&&(s+=o);l=s,c=""}return l.length>0?"["+Ae.get("Regexp").$escape(l)+"]":c.length>0?"[^"+Ae.get("Regexp").$escape(c)+"]":null}var u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne,ae,ie,oe,se,le,ce,ue,$e,fe,pe,de,he,_e,ge,me,ye,ve,be,xe=l=o(n,a,"String",l),we=xe.$$proto,Ae=xe.$$scope;we.length=i,xe.$include(Ae.get("Comparable")),we.$$is_string=!0,e.defn(xe,"$__id__",u=function(){return this.toString()},u.$$arity=0),e.alias(xe,"object_id","__id__"),e.defs(xe,"$try_convert",$=function(e){return Ae.get("Opal")["$coerce_to?"](e,Ae.get("String"),"to_str")},$.$$arity=1),e.defs(xe,"$new",f=function(e){return null==e&&(e=""),e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),new String(e)},f.$$arity=-1),e.defn(xe,"$initialize",p=function(e){var t=this;return void 0===e?t:t.$raise(Ae.get("NotImplementedError"),"Mutable strings are not supported in Opal.")},p.$$arity=-1),e.defn(xe,"$%",d=function(t){var r,n=this;return(r=Ae.get("Array")["$==="](t))===i||null==r||r.$$is_boolean&&1!=r?n.$format(n,t):(r=n).$format.apply(r,[n].concat(e.to_a(t)))},d.$$arity=1),e.defn(xe,"$*",h=function(e){var t=this;if(e=Ae.get("Opal").$coerce_to(e,Ae.get("Integer"),"to_int"),e<0&&t.$raise(Ae.get("ArgumentError"),"negative argument"),0===e)return"";var r="",n=t.toString();for(n.length*e>=1<<28&&t.$raise(Ae.get("RangeError"),"multiply count must not overflow maximum string size");1==(1&e)&&(r+=n),0!==(e>>>=1);)n+=n;return r},h.$$arity=1),e.defn(xe,"$+",_=function(e){var t=this;return e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),t+e.$to_s()},_.$$arity=1),e.defn(xe,"$<=>",g=function(e){var t,r=this;if((t=e["$respond_to?"]("to_str"))===i||null==t||t.$$is_boolean&&1!=t){var n=e["$<=>"](r);return n===i?i:n>0?-1:n<0?1:0}return e=e.$to_str().$to_s(),r>e?1:r<e?-1:0},g.$$arity=1),e.defn(xe,"$==",m=function(e){var t=this;return e.$$is_string?t.toString()===e.toString():!!Ae.get("Opal")["$respond_to?"](e,"to_str")&&e["$=="](t)},m.$$arity=1),e.alias(xe,"eql?","=="),e.alias(xe,"===","=="),e.defn(xe,"$=~",y=function(e){var t=this;return e.$$is_string&&t.$raise(Ae.get("TypeError"),"type mismatch: String given"),e["$=~"](t)},y.$$arity=1),e.defn(xe,"$[]",v=function(e,t){var r,n=this,a=n.length;if(e.$$is_range)return r=e.exclude,t=Ae.get("Opal").$coerce_to(e.end,Ae.get("Integer"),"to_int"),e=Ae.get("Opal").$coerce_to(e.begin,Ae.get("Integer"),"to_int"),Math.abs(e)>a?i:(e<0&&(e+=a),t<0&&(t+=a),r||(t+=1),t-=e,t<0&&(t=0),n.substr(e,t));if(e.$$is_string)return null!=t&&n.$raise(Ae.get("TypeError")),-1!==n.indexOf(e)?e:i;if(e.$$is_regexp){var o=n.match(e);return null===o?(s["~"]=i,i):(s["~"]=Ae.get("MatchData").$new(e,o),null==t?o[0]:(t=Ae.get("Opal").$coerce_to(t,Ae.get("Integer"),"to_int"),t<0&&-t<o.length?o[t+=o.length]:t>=0&&t<o.length?o[t]:i))}return e=Ae.get("Opal").$coerce_to(e,Ae.get("Integer"),"to_int"),e<0&&(e+=a),null==t?e>=a||e<0?i:n.substr(e,1):(t=Ae.get("Opal").$coerce_to(t,Ae.get("Integer"),"to_int"),t<0?i:e>a||e<0?i:n.substr(e,t))},v.$$arity=-2),e.alias(xe,"byteslice","[]"),e.defn(xe,"$capitalize",b=function(){
var e=this;return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()},b.$$arity=0),e.defn(xe,"$casecmp",x=function(e){var t=this;e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str").$to_s();var r=/^[\x00-\x7F]*$/;return r.test(t)&&r.test(e)&&(t=t.toLowerCase(),e=e.toLowerCase()),t["$<=>"](e)},x.$$arity=1),e.defn(xe,"$center",w=function(e,n){var a,o=this;if(null==n&&(n=" "),e=Ae.get("Opal").$coerce_to(e,Ae.get("Integer"),"to_int"),n=Ae.get("Opal").$coerce_to(n,Ae.get("String"),"to_str").$to_s(),(a=n["$empty?"]())===i||null==a||a.$$is_boolean&&1!=a||o.$raise(Ae.get("ArgumentError"),"zero width padding"),(a=e<=o.length)!==i&&null!=a&&(!a.$$is_boolean||1==a))return o;var s=o.$ljust(t(r(e,o.length),2).$ceil(),n);return o.$rjust(t(r(e,o.length),2).$floor(),n)+s.slice(o.length)},w.$$arity=-2),e.defn(xe,"$chars",A=function(){var e,t,r=this,n=A.$$p,a=n||i;return A.$$p=null,!1===a||a===i||null==a?r.$each_char().$to_a():(e=(t=r).$each_char,e.$$p=a.$to_proc(),e).call(t)},A.$$arity=0),e.defn(xe,"$chomp",k=function(e){var t,r=this;if(null==s["/"]&&(s["/"]=i),null==e&&(e=s["/"]),(t=e===i||0===r.length)!==i&&null!=t&&(!t.$$is_boolean||1==t))return r;if("\n"===(e=Ae.get("Opal")["$coerce_to!"](e,Ae.get("String"),"to_str").$to_s()))return r.replace(/\r?\n?$/,"");if(""===e)return r.replace(/(\r?\n)+$/,"");if(r.length>e.length){if(r.substr(r.length-e.length,e.length)===e)return r.substr(0,r.length-e.length)}return r},k.$$arity=-1),e.defn(xe,"$chop",E=function(){var e=this,t=e.length;return t<=1?"":"\n"===e.charAt(t-1)&&"\r"===e.charAt(t-2)?e.substr(0,t-2):e.substr(0,t-1)},E.$$arity=0),e.defn(xe,"$chr",C=function(){return this.charAt(0)},C.$$arity=0),e.defn(xe,"$clone",S=function(){var e=this,t=i;return t=e.slice(),t.$copy_singleton_methods(e),t.$initialize_clone(e),t},S.$$arity=0),e.defn(xe,"$dup",I=function(){var e=this,t=i;return t=e.slice(),t.$initialize_dup(e),t},I.$$arity=0),e.defn(xe,"$count",O=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];0===t.length&&r.$raise(Ae.get("ArgumentError"),"ArgumentError: wrong number of arguments (0 for 1+)");var o=c(t);return null===o?0:r.length-r.replace(new RegExp(o,"g"),"").length},O.$$arity=-1),e.defn(xe,"$delete",T=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];0===t.length&&r.$raise(Ae.get("ArgumentError"),"ArgumentError: wrong number of arguments (0 for 1+)");var o=c(t);return null===o?r:r.replace(new RegExp(o,"g"),"")},T.$$arity=-1),e.defn(xe,"$downcase",P=function(){return this.toLowerCase()},P.$$arity=0),e.defn(xe,"$each_char",M=function(){var t,r,n,a=this,o=M.$$p,s=o||i;if(M.$$p=null,s===i)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=a,n.$$arity=0,n),t).call(r,"each_char");for(var l=0,c=a.length;l<c;l++)e.yield1(s,a.charAt(l));return a},M.$$arity=0),e.defn(xe,"$each_line",N=function(t){var r=this,n=N.$$p,a=n||i;if(null==s["/"]&&(s["/"]=i),null==t&&(t=s["/"]),N.$$p=null,a===i)return r.$enum_for("each_line",t);if(t===i)return e.yield1(a,r),r;t=Ae.get("Opal").$coerce_to(t,Ae.get("String"),"to_str");var o,l,c,u,$,f,p;if(0===t.length){for(o=r.split(/(\n{2,})/),l=0,c=o.length;l<c;l+=2)(o[l]||o[l+1])&&e.yield1(a,(o[l]||"")+(o[l+1]||""));return r}for($=r.$chomp(t),f=r.length!=$.length,p=$.split(t),l=0,u=p.length;l<u;l++)l<u-1||f?e.yield1(a,p[l]+t):e.yield1(a,p[l]);return r},N.$$arity=-1),e.defn(xe,"$empty?",B=function(){return 0===this.length},B.$$arity=0),e.defn(xe,"$end_with?",R=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=0,s=t.length;o<s;o++){var l=Ae.get("Opal").$coerce_to(t[o],Ae.get("String"),"to_str").$to_s();if(r.length>=l.length&&r.substr(r.length-l.length,l.length)==l)return!0}return!1},R.$$arity=-1),e.alias(xe,"eql?","=="),e.alias(xe,"equal?","==="),e.defn(xe,"$gsub",j=function(e,t){var r=this,n=j.$$p,a=n||i;if(j.$$p=null,void 0===t&&a===i)return r.$enum_for("gsub",e);var o,l,c="",u=i,$=0;for(e.$$is_regexp?e=new RegExp(e.source,"gm"+(e.ignoreCase?"i":"")):(e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),e=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gm"));;){if(null===(o=e.exec(r))){s["~"]=i,c+=r.slice($);break}u=Ae.get("MatchData").$new(e,o),void 0===t?l=a(o[0]):t.$$is_hash?l=t["$[]"](o[0]).$to_s():(t.$$is_string||(t=Ae.get("Opal").$coerce_to(t,Ae.get("String"),"to_str")),l=t.replace(/([\\]+)([0-9+&`'])/g,function(e,t,n){if(t.length%2==0)return e;switch(n){case"+":for(var a=o.length-1;a>0;a--)if(void 0!==o[a])return t.slice(1)+o[a];return"";case"&":return t.slice(1)+o[0];case"`":return t.slice(1)+r.slice(0,o.index);case"'":return t.slice(1)+r.slice(o.index+o[0].length);default:return t.slice(1)+(o[n]||"")}}).replace(/\\\\/g,"\\")),e.lastIndex===o.index?(c+=l+r.slice($,o.index+1),e.lastIndex+=1):c+=r.slice($,o.index)+l,$=e.lastIndex}return s["~"]=u,c},j.$$arity=-2),e.defn(xe,"$hash",F=function(){return this.toString()},F.$$arity=0),e.defn(xe,"$hex",D=function(){return this.$to_i(16)},D.$$arity=0),e.defn(xe,"$include?",L=function(e){var t=this;return e.$$is_string||(e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str")),-1!==t.indexOf(e)},L.$$arity=1),e.defn(xe,"$index",z=function(e,t){var r,n,a,o=this;if(void 0===t)t=0;else if((t=Ae.get("Opal").$coerce_to(t,Ae.get("Integer"),"to_int"))<0&&(t+=o.length)<0)return i;if(e.$$is_regexp)for(a=new RegExp(e.source,"gm"+(e.ignoreCase?"i":""));;){if(null===(n=a.exec(o))){s["~"]=i,r=-1;break}if(n.index>=t){s["~"]=Ae.get("MatchData").$new(a,n),r=n.index;break}a.lastIndex=n.index+1}else e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),r=0===e.length&&t>o.length?-1:o.indexOf(e,t);return-1===r?i:r},z.$$arity=-2),e.defn(xe,"$inspect",q=function(){var e=this,t=/[\\\"\x00-\x1f\x7f-\x9f\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r={"":"\\a","":"\\e","\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\v":"\\v",'"':'\\"',"\\":"\\\\"};return'"'+e.replace(t,function(e){return r[e]||"\\u"+("0000"+e.charCodeAt(0).toString(16).toUpperCase()).slice(-4)}).replace(/\#[\$\@\{]/g,"\\$&")+'"'},q.$$arity=0),e.defn(xe,"$intern",U=function(){return this},U.$$arity=0),e.defn(xe,"$lines",H=function(e){var t,r,n=this,a=H.$$p,o=a||i,l=i;return null==s["/"]&&(s["/"]=i),null==e&&(e=s["/"]),H.$$p=null,l=(t=(r=n).$each_line,t.$$p=o.$to_proc(),t).call(r,e),!1!==o&&o!==i&&null!=o?n:l.$to_a()},H.$$arity=-1),e.defn(xe,"$length",G=function(){return this.length},G.$$arity=0),e.defn(xe,"$ljust",Y=function(e,t){var r,n=this;if(null==t&&(t=" "),e=Ae.get("Opal").$coerce_to(e,Ae.get("Integer"),"to_int"),t=Ae.get("Opal").$coerce_to(t,Ae.get("String"),"to_str").$to_s(),(r=t["$empty?"]())===i||null==r||r.$$is_boolean&&1!=r||n.$raise(Ae.get("ArgumentError"),"zero width padding"),(r=e<=n.length)!==i&&null!=r&&(!r.$$is_boolean||1==r))return n;var a=-1,o="";for(e-=n.length;++a<e;)o+=t;return n+o.slice(0,e)},Y.$$arity=-2),e.defn(xe,"$lstrip",Q=function(){return this.replace(/^\s*/,"")},Q.$$arity=0),e.defn(xe,"$match",V=function(e,t){var r,n,a=this,o=V.$$p,s=o||i;return V.$$p=null,(r=!1!==(n=Ae.get("String")["$==="](e))&&n!==i&&null!=n?n:e["$respond_to?"]("to_str"))===i||null==r||r.$$is_boolean&&1!=r||(e=Ae.get("Regexp").$new(e.$to_str())),((r=Ae.get("Regexp")["$==="](e))===i||null==r||r.$$is_boolean&&1!=r)&&a.$raise(Ae.get("TypeError"),"wrong argument type "+e.$class()+" (expected Regexp)"),(r=(n=e).$match,r.$$p=s.$to_proc(),r).call(n,a,t)},V.$$arity=-2),e.defn(xe,"$next",X=function(){var e=this,t=e.length;if(0===t)return"";for(var r,n=e,a=e.search(/[a-zA-Z0-9]/),i=!1;t--;){if((r=e.charCodeAt(t))>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122)switch(r){case 57:i=!0,r=48;break;case 90:i=!0,r=65;break;case 122:i=!0,r=97;break;default:i=!1,r+=1}else-1===a?255===r?(i=!0,r=0):(i=!1,r+=1):i=!0;if(n=n.slice(0,t)+String.fromCharCode(r)+n.slice(t+1),i&&(0===t||t===a)){switch(r){case 65:case 97:break;default:r+=1}n=0===t?String.fromCharCode(r)+n:n.slice(0,t)+String.fromCharCode(r)+n.slice(t),i=!1}if(!i)break}return n},X.$$arity=0),e.defn(xe,"$oct",W=function(){var e,t=this,r=t,n=8;return/^\s*_/.test(r)?0:(r=r.replace(/^(\s*[+-]?)(0[bodx]?)(.+)$/i,function(e,t,r,a){switch(a.charAt(0)){case"+":case"-":return e;case"0":if("x"===a.charAt(1)&&"0x"===r)return e}switch(r){case"0b":n=2;break;case"0":case"0o":n=8;break;case"0d":n=10;break;case"0x":n=16}return t+a}),e=parseInt(r.replace(/_(?!_)/g,""),n),isNaN(e)?0:e)},W.$$arity=0),e.defn(xe,"$ord",J=function(){return this.charCodeAt(0)},J.$$arity=0),e.defn(xe,"$partition",K=function(e){var t,r,n=this;return e.$$is_regexp?(r=e.exec(n),null===r?t=-1:(Ae.get("MatchData").$new(e,r),e=r[0],t=r.index)):(e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),t=n.indexOf(e)),-1===t?[n,"",""]:[n.slice(0,t),n.slice(t,t+e.length),n.slice(t+e.length)]},K.$$arity=1),e.defn(xe,"$reverse",Z=function(){return this.split("").reverse().join("")},Z.$$arity=0),e.defn(xe,"$rindex",ee=function(e,t){var r,n,a,o,l=this;if(void 0===t)t=l.length;else if((t=Ae.get("Opal").$coerce_to(t,Ae.get("Integer"),"to_int"))<0&&(t+=l.length)<0)return i;if(e.$$is_regexp){for(n=null,a=new RegExp(e.source,"gm"+(e.ignoreCase?"i":""));;){if(null===(o=a.exec(l))||o.index>t)break;n=o,a.lastIndex=n.index+1}null===n?(s["~"]=i,r=-1):(Ae.get("MatchData").$new(a,n),r=n.index)}else e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),r=l.lastIndexOf(e,t);return-1===r?i:r},ee.$$arity=-2),e.defn(xe,"$rjust",te=function(e,t){var r,n=this;if(null==t&&(t=" "),e=Ae.get("Opal").$coerce_to(e,Ae.get("Integer"),"to_int"),t=Ae.get("Opal").$coerce_to(t,Ae.get("String"),"to_str").$to_s(),(r=t["$empty?"]())===i||null==r||r.$$is_boolean&&1!=r||n.$raise(Ae.get("ArgumentError"),"zero width padding"),(r=e<=n.length)!==i&&null!=r&&(!r.$$is_boolean||1==r))return n;var a=Math.floor(e-n.length),o=Math.floor(a/t.length),s=Array(o+1).join(t),l=a-s.length;return s+t.slice(0,l)+n},te.$$arity=-2),e.defn(xe,"$rpartition",re=function(e){var t,r,n,a,i=this;if(e.$$is_regexp){for(r=null,n=new RegExp(e.source,"gm"+(e.ignoreCase?"i":""));;){if(null===(a=n.exec(i)))break;r=a,n.lastIndex=r.index+1}null===r?t=-1:(Ae.get("MatchData").$new(n,r),e=r[0],t=r.index)}else e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),t=i.lastIndexOf(e);return-1===t?["","",i]:[i.slice(0,t),i.slice(t,t+e.length),i.slice(t+e.length)]},re.$$arity=1),e.defn(xe,"$rstrip",ne=function(){return this.replace(/[\s\u0000]*$/,"")},ne.$$arity=0),e.defn(xe,"$scan",ae=function(e){var t=this,r=ae.$$p,n=r||i;ae.$$p=null;var a,o=[],l=i;for(e.$$is_regexp?e=new RegExp(e.source,"gm"+(e.ignoreCase?"i":"")):(e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),e=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gm"));null!=(a=e.exec(t));)l=Ae.get("MatchData").$new(e,a),n===i?1==a.length?o.push(a[0]):o.push(l.$captures()):1==a.length?n(a[0]):n.call(t,l.$captures()),e.lastIndex===a.index&&(e.lastIndex+=1);return s["~"]=l,n!==i?t:o},ae.$$arity=1),e.alias(xe,"size","length"),e.alias(xe,"slice","[]"),e.defn(xe,"$split",ie=function(e,t){var r,n=this;if(null==s[";"]&&(s[";"]=i),0===n.length)return[];if(void 0===t)t=0;else if(1===(t=Ae.get("Opal")["$coerce_to!"](t,Ae.get("Integer"),"to_int")))return[n];void 0!==e&&e!==i||(e=!1!==(r=s[";"])&&r!==i&&null!=r?r:" ");var a,o,l=[],c=n.toString(),u=0;if(e.$$is_regexp?e=new RegExp(e.source,"gm"+(e.ignoreCase?"i":"")):(e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str").$to_s()," "===e?(e=/\s+/gm,c=c.replace(/^\s+/,"")):e=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gm")),l=c.split(e),1===l.length&&l[0]===c)return l;for(;-1!==(o=l.indexOf(void 0));)l.splice(o,1);if(0===t){for(;""===l[l.length-1];)l.length-=1;return l}if(a=e.exec(c),t<0){if(null!==a&&""===a[0]&&-1===e.source.indexOf("(?="))for(o=0;o<a.length;o++)l.push("");return l}if(null!==a&&""===a[0])return l.splice(t-1,l.length-1,l.slice(t-1).join("")),l;if(t>=l.length)return l;for(o=0;null!==a&&(o++,u=e.lastIndex,o+1!==t);)a=e.exec(c);return l.splice(t-1,l.length-1,c.slice(u)),l},ie.$$arity=-1),e.defn(xe,"$squeeze",oe=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];if(0===t.length)return r.replace(/(.)\1+/g,"$1");var o=c(t);return null===o?r:r.replace(new RegExp("("+o+")\\1+","g"),"$1")},oe.$$arity=-1),e.defn(xe,"$start_with?",se=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=0,s=t.length;o<s;o++){var l=Ae.get("Opal").$coerce_to(t[o],Ae.get("String"),"to_str").$to_s();if(0===r.indexOf(l))return!0}return!1},se.$$arity=-1),e.defn(xe,"$strip",le=function(){return this.replace(/^\s*/,"").replace(/[\s\u0000]*$/,"")},le.$$arity=0),e.defn(xe,"$sub",ce=function(e,t){var r=this,n=ce.$$p,a=n||i;ce.$$p=null,e.$$is_regexp||(e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str"),e=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")));var o=e.exec(r);return null===o?(s["~"]=i,r.toString()):(Ae.get("MatchData").$new(e,o),void 0===t?(a===i&&r.$raise(Ae.get("ArgumentError"),"wrong number of arguments (1 for 2)"),r.slice(0,o.index)+a(o[0])+r.slice(o.index+o[0].length)):t.$$is_hash?r.slice(0,o.index)+t["$[]"](o[0]).$to_s()+r.slice(o.index+o[0].length):(t=Ae.get("Opal").$coerce_to(t,Ae.get("String"),"to_str"),t=t.replace(/([\\]+)([0-9+&`'])/g,function(e,t,n){if(t.length%2==0)return e;switch(n){case"+":for(var a=o.length-1;a>0;a--)if(void 0!==o[a])return t.slice(1)+o[a];return"";case"&":return t.slice(1)+o[0];case"`":return t.slice(1)+r.slice(0,o.index);case"'":return t.slice(1)+r.slice(o.index+o[0].length);default:return t.slice(1)+(o[n]||"")}}).replace(/\\\\/g,"\\"),r.slice(0,o.index)+t+r.slice(o.index+o[0].length)))},ce.$$arity=-2),e.alias(xe,"succ","next"),e.defn(xe,"$sum",ue=function(e){var t=this;null==e&&(e=16),e=Ae.get("Opal").$coerce_to(e,Ae.get("Integer"),"to_int");for(var r=0,n=t.length,a=0;a<n;a++)r+=t.charCodeAt(a);return e<=0?r:r&Math.pow(2,e)-1},ue.$$arity=-1),e.defn(xe,"$swapcase",$e=function(){var e=this,t=e.replace(/([a-z]+)|([A-Z]+)/g,function(e,t,r){return t?e.toUpperCase():e.toLowerCase()});return e.constructor===String?t:e.$class().$new(t)},$e.$$arity=0),e.defn(xe,"$to_f",fe=function(){var e=this;if("_"===e.charAt(0))return 0;var t=parseFloat(e.replace(/_/g,""));return isNaN(t)||t==1/0||t==-1/0?0:t},fe.$$arity=0),e.defn(xe,"$to_i",pe=function(e){var t=this;null==e&&(e=10);var r,n=t.toLowerCase(),a=Ae.get("Opal").$coerce_to(e,Ae.get("Integer"),"to_int");return(1===a||a<0||a>36)&&t.$raise(Ae.get("ArgumentError"),"invalid radix "+a),/^\s*_/.test(n)?0:(n=n.replace(/^(\s*[+-]?)(0[bodx]?)(.+)$/,function(e,t,r,n){switch(n.charAt(0)){case"+":case"-":return e;case"0":if("x"===n.charAt(1)&&"0x"===r&&(0===a||16===a))return e}switch(r){case"0b":if(0===a||2===a)return a=2,t+n;break;case"0":case"0o":if(0===a||8===a)return a=8,t+n;break;case"0d":if(0===a||10===a)return a=10,t+n;break;case"0x":if(0===a||16===a)return a=16,t+n}return e}),r=parseInt(n.replace(/_(?!_)/g,""),a),isNaN(r)?0:r)},pe.$$arity=-1),e.defn(xe,"$to_proc",de=function(){var t,r,n,a=this,o=i;return o=a,(t=(r=a).$proc,t.$$p=(n=function(t){var r,a,s,l,c=n.$$s||this,u=i;r=n.$$p||i,n.$$p=null;var $=arguments.length,f=$-0;f<0&&(f=0),a=new Array(f);for(var p=0;p<$;p++)a[p-0]=arguments[p];return(s=a["$empty?"]())===i||null==s||s.$$is_boolean&&1!=s||c.$raise(Ae.get("ArgumentError"),"no receiver given"),u=a.$shift(),(s=(l=u).$__send__,s.$$p=r.$to_proc(),s).apply(l,[o].concat(e.to_a(a)))},n.$$s=a,n.$$arity=-1,n),t).call(r)},de.$$arity=0),e.defn(xe,"$to_s",he=function(){return this.toString()},he.$$arity=0),e.alias(xe,"to_str","to_s"),e.alias(xe,"to_sym","intern"),e.defn(xe,"$tr",_e=function(e,t){var r=this;if(e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str").$to_s(),t=Ae.get("Opal").$coerce_to(t,Ae.get("String"),"to_str").$to_s(),0==e.length||e===t)return r;var n,a,i,o,s,l,c,u={},$=e.split(""),f=$.length,p=t.split(""),d=p.length,h=!1,_=null;"^"===$[0]&&$.length>1&&(h=!0,$.shift(),_=p[d-1],f-=1);var g=[],m=null;for(a=!1,n=0;n<f;n++)if(o=$[n],null==m)m=o,g.push(o);else if("-"===o)"-"===m?(g.push("-"),g.push("-")):n==f-1?g.push("-"):a=!0;else if(a){for(s=m.charCodeAt(0),l=o.charCodeAt(0),s>l&&r.$raise(Ae.get("ArgumentError"),'invalid range "'+String.fromCharCode(s)+"-"+String.fromCharCode(l)+'" in string transliteration'),i=s+1;i<l;i++)g.push(String.fromCharCode(i));g.push(o),a=null,m=null}else g.push(o);if($=g,f=$.length,h)for(n=0;n<f;n++)u[$[n]]=!0;else{if(d>0){var y=[],v=null;for(a=!1,n=0;n<d;n++)if(o=p[n],null==v)v=o,y.push(o);else if("-"===o)"-"===v?(y.push("-"),y.push("-")):n==d-1?y.push("-"):a=!0;else if(a){for(s=v.charCodeAt(0),l=o.charCodeAt(0),s>l&&r.$raise(Ae.get("ArgumentError"),'invalid range "'+String.fromCharCode(s)+"-"+String.fromCharCode(l)+'" in string transliteration'),i=s+1;i<l;i++)y.push(String.fromCharCode(i));y.push(o),a=null,v=null}else y.push(o);p=y,d=p.length}var b=f-d;if(b>0){var x=d>0?p[d-1]:"";for(n=0;n<b;n++)p.push(x)}for(n=0;n<f;n++)u[$[n]]=p[n]}var w="";for(n=0,c=r.length;n<c;n++){o=r.charAt(n);var A=u[o];w+=h?null==A?_:o:null!=A?A:o}return w},_e.$$arity=2),e.defn(xe,"$tr_s",ge=function(e,t){var r=this;if(e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str").$to_s(),t=Ae.get("Opal").$coerce_to(t,Ae.get("String"),"to_str").$to_s(),0==e.length)return r;var n,a,i,o,s,l,c,u={},$=e.split(""),f=$.length,p=t.split(""),d=p.length,h=!1,_=null;"^"===$[0]&&$.length>1&&(h=!0,$.shift(),_=p[d-1],f-=1);var g=[],m=null;for(a=!1,n=0;n<f;n++)if(o=$[n],null==m)m=o,g.push(o);else if("-"===o)"-"===m?(g.push("-"),g.push("-")):n==f-1?g.push("-"):a=!0;else if(a){for(s=m.charCodeAt(0),l=o.charCodeAt(0),s>l&&r.$raise(Ae.get("ArgumentError"),'invalid range "'+String.fromCharCode(s)+"-"+String.fromCharCode(l)+'" in string transliteration'),i=s+1;i<l;i++)g.push(String.fromCharCode(i));g.push(o),a=null,m=null}else g.push(o);if($=g,f=$.length,h)for(n=0;n<f;n++)u[$[n]]=!0;else{if(d>0){var y=[];for(a=!1,n=0;n<d;n++)if(o=p[n],null==m)m=o,y.push(o);else if("-"===o)n==d-1?y.push("-"):a=!0;else if(a){for(s=m.charCodeAt(0),l=o.charCodeAt(0),s>l&&r.$raise(Ae.get("ArgumentError"),'invalid range "'+String.fromCharCode(s)+"-"+String.fromCharCode(l)+'" in string transliteration'),i=s+1;i<l;i++)y.push(String.fromCharCode(i));y.push(o),a=null,m=null}else y.push(o);p=y,d=p.length}var v=f-d;if(v>0){var b=d>0?p[d-1]:"";for(n=0;n<v;n++)p.push(b)}for(n=0;n<f;n++)u[$[n]]=p[n]}var x="",w=null;for(n=0,c=r.length;n<c;n++){o=r.charAt(n);var A=u[o];h?null==A?null==w&&(x+=_,w=!0):(x+=o,w=null):null!=A?null!=w&&w===A||(x+=A,w=A):(x+=o,w=null)}return x},ge.$$arity=2),e.defn(xe,"$upcase",me=function(){return this.toUpperCase()},me.$$arity=0),e.defn(xe,"$upto",ye=function(e,t){var r=this,n=ye.$$p,a=n||i;if(null==t&&(t=!1),ye.$$p=null,a===i)return r.$enum_for("upto",e,t);e=Ae.get("Opal").$coerce_to(e,Ae.get("String"),"to_str");var o,s,l=r.toString();if(1===l.length&&1===e.length)for(o=l.charCodeAt(0),s=e.charCodeAt(0);o<=s&&(!t||o!==s);)a(String.fromCharCode(o)),o+=1;else if(parseInt(l,10).toString()===l&&parseInt(e,10).toString()===e)for(o=parseInt(l,10),s=parseInt(e,10);o<=s&&(!t||o!==s);)a(o.toString()),o+=1;else for(;l.length<=e.length&&l<=e&&(!t||l!==e);)a(l),l=l.$succ();return r},ye.$$arity=-2),e.defn(xe,"$instance_variables",ve=function(){return[]},ve.$$arity=0),e.defs(xe,"$_load",be=function(t){var r,n,a=this,i=arguments.length,o=i-0;o<0&&(o=0),n=new Array(o);for(var s=0;s<i;s++)n[s-0]=arguments[s];return(r=a).$new.apply(r,e.to_a(n))},be.$$arity=-1)}(a.base,String),e.cdecl(a,"Symbol",a.get("String"))},Opal.modules["corelib/enumerable"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function o(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}var s=(e.top,e),l=e.nil,c=(e.breaker,e.slice,e.module);return e.add_stubs(["$each","$destructure","$raise","$new","$yield","$dup","$enum_for","$enumerator_size","$flatten","$map","$proc","$==","$nil?","$respond_to?","$coerce_to!","$>","$*","$coerce_to","$try_convert","$<","$+","$-","$to_enum","$ceil","$/","$size","$===","$<<","$[]","$[]=","$inspect","$__send__","$<=>","$first","$reverse","$sort","$to_proc","$compare","$call","$to_a","$lambda","$sort!","$map!","$zip"]),function(s){var u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z=u=c(s,"Enumerable"),ee=(Z.$$proto,Z.$$scope);e.defn(Z,"$all?",$=function(){try{var t,r,n,a,i,o=this,s=$.$$p,c=s||l;return $.$$p=null,c!==l?(t=(r=o).$each,t.$$p=(n=function(t){var r,a,i=(n.$$s,arguments.length),o=i-0;o<0&&(o=0),r=new Array(o);for(var s=0;s<i;s++)r[s-0]=arguments[s];if(!((a=e.yieldX(c,e.to_a(r)))===l||null==a||a.$$is_boolean&&1!=a))return l;e.ret(!1)},n.$$s=o,n.$$arity=-1,n),t).call(r):(t=(a=o).$each,t.$$p=(i=function(t){var r,n,a=(i.$$s,arguments.length),o=a-0;o<0&&(o=0),r=new Array(o);for(var s=0;s<a;s++)r[s-0]=arguments[s];if(!((n=ee.get("Opal").$destructure(r))===l||null==n||n.$$is_boolean&&1!=n))return l;e.ret(!1)},i.$$s=o,i.$$arity=-1,i),t).call(a),!0}catch(t){if(t===e.returner)return t.$v;throw t}},$.$$arity=0),e.defn(Z,"$any?",f=function(){try{var t,r,n,a,i,o=this,s=f.$$p,c=s||l;return f.$$p=null,c!==l?(t=(r=o).$each,t.$$p=(n=function(t){var r,a,i=(n.$$s,arguments.length),o=i-0;o<0&&(o=0),r=new Array(o);for(var s=0;s<i;s++)r[s-0]=arguments[s];if((a=e.yieldX(c,e.to_a(r)))===l||null==a||a.$$is_boolean&&1!=a)return l;e.ret(!0)},n.$$s=o,n.$$arity=-1,n),t).call(r):(t=(a=o).$each,t.$$p=(i=function(t){var r,n,a=(i.$$s,arguments.length),o=a-0;o<0&&(o=0),r=new Array(o);for(var s=0;s<a;s++)r[s-0]=arguments[s];if((n=ee.get("Opal").$destructure(r))===l||null==n||n.$$is_boolean&&1!=n)return l;e.ret(!0)},i.$$s=o,i.$$arity=-1,i),t).call(a),!1}catch(t){if(t===e.returner)return t.$v;throw t}},f.$$arity=0),e.defn(Z,"$chunk",p=function(t){var r,n,a,i=this,o=p.$$p,s=o||l;return p.$$p=null,!1!==s&&s!==l&&null!=s||ee.get("Kernel").$raise(ee.get("ArgumentError"),"no block given"),(r=(n=e.get("Enumerator")).$new,r.$$p=(a=function(r){function n(){p.length>0&&r.$yield(f,p)}var i,o,c,u=a.$$s||this;null==r&&(r=l);var $,f=l,p=[];$=void 0==t||t===l?s:(i=(o=ee.get("Proc")).$new,i.$$p=(c=function(e){c.$$s;return null==e&&(e=l),s.$yield(e,t.$dup())},c.$$s=u,c.$$arity=1,c),i).call(o),u.$each.$$p=function(t){var r=e.yield1($,t);r===l?(n(),p=[],f=l):(f===l||f===r?p.push(t):(n(),p=[t]),f=r)},u.$each(),n()},a.$$s=i,a.$$arity=1,a),r).call(n)},p.$$arity=-1),e.defn(Z,"$collect",d=function(){var t,r,n,a=this,i=d.$$p,o=i||l;if(d.$$p=null,o===l)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=a,n.$$arity=0,n),t).call(r,"collect");var s=[];return a.$each.$$p=function(){var t=e.yieldX(o,arguments);s.push(t)},a.$each(),s},d.$$arity=0),e.defn(Z,"$collect_concat",h=function(){var t,r,n,a,i,o=this,s=h.$$p,c=s||l;return h.$$p=null,c===l?(t=(r=o).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=o,n.$$arity=0,n),t).call(r,"collect_concat"):(t=(a=o).$map,t.$$p=(i=function(t){i.$$s;return null==t&&(t=l),e.yield1(c,t)},i.$$s=o,i.$$arity=1,i),t).call(a).$flatten(1)},h.$$arity=0),e.defn(Z,"$count",_=function(t){var r,n,a,i,o,s,c,u=this,$=_.$$p,f=$||l,p=l;return _.$$p=null,p=0,(r=null!=t)===l||null==r||r.$$is_boolean&&1!=r?(r=f["$nil?"]())===l||null==r||r.$$is_boolean&&1!=r||(f=(r=(i=u).$proc,r.$$p=(o=function(){o.$$s;return!0},o.$$s=u,o.$$arity=0,o),r).call(i)):f=(r=(n=u).$proc,r.$$p=(a=function(e){var r,n=(a.$$s,arguments.length),i=n-0;i<0&&(i=0),r=new Array(i);for(var o=0;o<n;o++)r[o-0]=arguments[o];return ee.get("Opal").$destructure(r)["$=="](t)},a.$$s=u,a.$$arity=-1,a),r).call(n),(r=(s=u).$each,r.$$p=(c=function(t){var r,n,a=(c.$$s,arguments.length),i=a-0;i<0&&(i=0),r=new Array(i);for(var o=0;o<a;o++)r[o-0]=arguments[o];return(n=e.yieldX(f,r))===l||null==n||n.$$is_boolean&&1!=n?l:p++},c.$$s=u,c.$$arity=-1,c),r).call(s),p},_.$$arity=-1),e.defn(Z,"$cycle",g=function(n){var a,i,o,s=this,c=g.$$p,u=c||l;if(null==n&&(n=l),g.$$p=null,u===l)return(a=(i=s).$enum_for,a.$$p=(o=function(){var e,a=o.$$s||this;return n["$=="](l)?(e=a["$respond_to?"]("size"))===l||null==e||e.$$is_boolean&&1!=e?l:ee.get("Float").$$scope.get("INFINITY"):(n=ee.get("Opal")["$coerce_to!"](n,ee.get("Integer"),"to_int"),(e=t(n,0))===l||null==e||e.$$is_boolean&&1!=e?0:r(a.$enumerator_size(),n))},o.$$s=s,o.$$arity=0,o),a).call(i,"cycle",n);if((a=n["$nil?"]())===l||null==a||a.$$is_boolean&&1!=a){if(n=ee.get("Opal")["$coerce_to!"](n,ee.get("Integer"),"to_int"),(a=n<=0)!==l&&null!=a&&(!a.$$is_boolean||1==a))return l}else;var $,f,p=[];if(s.$each.$$p=function(){var t=ee.get("Opal").$destructure(arguments);e.yield1(u,t);p.push(t)},s.$each(),0===p.length)return l;if(n===l)for(;;)for($=0,f=p.length;$<f;$++)e.yield1(u,p[$]);else for(;n>1;){for($=0,f=p.length;$<f;$++)e.yield1(u,p[$]);n--}},g.$$arity=-1),e.defn(Z,"$detect",m=function(t){try{var r,n,a,i=this,o=m.$$p,s=o||l;return m.$$p=null,s===l?i.$enum_for("detect",t):((r=(n=i).$each,r.$$p=(a=function(t){var r,n,i=(a.$$s,l),o=arguments.length,c=o-0;c<0&&(c=0),r=new Array(c);for(var u=0;u<o;u++)r[u-0]=arguments[u];if(i=ee.get("Opal").$destructure(r),(n=e.yield1(s,i))===l||null==n||n.$$is_boolean&&1!=n)return l;e.ret(i)},a.$$s=i,a.$$arity=-1,a),r).call(n),void 0!==t?"function"==typeof t?t():t:l)}catch(t){if(t===e.returner)return t.$v;throw t}},m.$$arity=-1),e.defn(Z,"$drop",y=function(e){var t,r=this;e=ee.get("Opal").$coerce_to(e,ee.get("Integer"),"to_int"),(t=e<0)===l||null==t||t.$$is_boolean&&1!=t||r.$raise(ee.get("ArgumentError"),"attempt to drop negative size");var n=[],a=0;return r.$each.$$p=function(){e<=a&&n.push(ee.get("Opal").$destructure(arguments)),a++},r.$each(),n},y.$$arity=1),e.defn(Z,"$drop_while",v=function(){var t,r=this,n=v.$$p,a=n||l;if(v.$$p=null,a===l)return r.$enum_for("drop_while");var i=[],o=!0;return r.$each.$$p=function(){var r=ee.get("Opal").$destructure(arguments);if(o){var n=e.yield1(a,r);((t=n)===l||null==t||t.$$is_boolean&&0==t)&&(o=!1,i.push(r))}else i.push(r)},r.$each(),i},v.$$arity=0),e.defn(Z,"$each_cons",b=function(t){var r,o,s,c=this,u=b.$$p,$=u||l;if(b.$$p=null,(r=1!=arguments.length)===l||null==r||r.$$is_boolean&&1!=r||c.$raise(ee.get("ArgumentError"),"wrong number of arguments ("+arguments.length+" for 1)"),t=ee.get("Opal").$try_convert(t,ee.get("Integer"),"to_int"),(r=t<=0)===l||null==r||r.$$is_boolean&&1!=r||c.$raise(ee.get("ArgumentError"),"invalid size"),$===l)return(r=(o=c).$enum_for,r.$$p=(s=function(){var e,r,o=s.$$s||this,c=l;return c=o.$enumerator_size(),(e=c["$nil?"]())===l||null==e||e.$$is_boolean&&1!=e?(e=!1!==(r=c["$=="](0))&&r!==l&&null!=r?r:n(c,t))===l||null==e||e.$$is_boolean&&1!=e?a(i(c,t),1):0:l},s.$$s=c,s.$$arity=0,s),r).call(o,"each_cons",t);var f=[],p=l;return c.$each.$$p=function(){var r=ee.get("Opal").$destructure(arguments);f.push(r),f.length>t&&f.shift(),f.length==t&&e.yield1($,f.slice(0,t))},c.$each(),p},b.$$arity=1),e.defn(Z,"$each_entry",x=function(t){var r,n,a,i,o=this,s=x.$$p,c=s||l,u=arguments.length,$=u-0;$<0&&($=0),i=new Array($);for(var f=0;f<u;f++)i[f-0]=arguments[f];return x.$$p=null,c===l?(r=(n=o).$to_enum,r.$$p=(a=function(){return(a.$$s||this).$enumerator_size()},a.$$s=o,a.$$arity=0,a),r).apply(n,["each_entry"].concat(e.to_a(i))):(o.$each.$$p=function(){var t=ee.get("Opal").$destructure(arguments);e.yield1(c,t)},o.$each.apply(o,i),o)},x.$$arity=-1),e.defn(Z,"$each_slice",w=function(t){var r,n,a,i=this,s=w.$$p,c=s||l;if(w.$$p=null,t=ee.get("Opal").$coerce_to(t,ee.get("Integer"),"to_int"),(r=t<=0)===l||null==r||r.$$is_boolean&&1!=r||i.$raise(ee.get("ArgumentError"),"invalid slice size"),c===l)return(r=(n=i).$enum_for,r.$$p=(a=function(){var e,r=a.$$s||this;return(e=r["$respond_to?"]("size"))===l||null==e||e.$$is_boolean&&1!=e?l:o(r.$size(),t).$ceil()},a.$$s=i,a.$$arity=0,a),r).call(n,"each_slice",t);var u=[];return i.$each.$$p=function(){var r=ee.get("Opal").$destructure(arguments);u.push(r),u.length===t&&(e.yield1(c,u),u=[])},i.$each(),u.length>0&&e.yield1(c,u),l},w.$$arity=1),e.defn(Z,"$each_with_index",A=function(t){var r,n,a,i,o=this,s=A.$$p,c=s||l,u=arguments.length,$=u-0;$<0&&($=0),i=new Array($);for(var f=0;f<u;f++)i[f-0]=arguments[f];if(A.$$p=null,c===l)return(r=(n=o).$enum_for,r.$$p=(a=function(){return(a.$$s||this).$enumerator_size()},a.$$s=o,a.$$arity=0,a),r).apply(n,["each_with_index"].concat(e.to_a(i)));var p=0;return o.$each.$$p=function(){var e=ee.get("Opal").$destructure(arguments);c(e,p),p++},o.$each.apply(o,i),o},A.$$arity=-1),e.defn(Z,"$each_with_object",k=function(e){var t,r,n,a=this,i=k.$$p,o=i||l;if(k.$$p=null,o===l)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=a,n.$$arity=0,n),t).call(r,"each_with_object",e);return a.$each.$$p=function(){var t=ee.get("Opal").$destructure(arguments);o(t,e)},a.$each(),e},k.$$arity=1),e.defn(Z,"$entries",E=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];var o=[];return r.$each.$$p=function(){o.push(ee.get("Opal").$destructure(arguments))},r.$each.apply(r,t),o},E.$$arity=-1),e.alias(Z,"find","detect"),e.defn(Z,"$find_all",C=function(){var t,r,n,a=this,i=C.$$p,o=i||l;if(C.$$p=null,o===l)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=a,n.$$arity=0,n),t).call(r,"find_all");var s=[];return a.$each.$$p=function(){var r=ee.get("Opal").$destructure(arguments),n=e.yield1(o,r);(t=n)===l||null==t||t.$$is_boolean&&1!=t||s.push(r)},a.$each(),s},C.$$arity=0),e.defn(Z,"$find_index",S=function(t){try{var r,n,a,i,o,s=this,c=S.$$p,u=c||l,$=l;return S.$$p=null,(r=void 0===t&&u===l)===l||null==r||r.$$is_boolean&&1!=r?($=0,(r=null!=t)===l||null==r||r.$$is_boolean&&1!=r?(r=(i=s).$each,r.$$p=(o=function(t){var r,n,a=(o.$$s,arguments.length),i=a-0;i<0&&(i=0),r=new Array(i);for(var s=0;s<a;s++)r[s-0]=arguments[s];return(n=e.yieldX(u,e.to_a(r)))===l||null==n||n.$$is_boolean&&1!=n||e.ret($),$+=1},o.$$s=s,o.$$arity=-1,o),r).call(i):(r=(n=s).$each,r.$$p=(a=function(r){var n,i=(a.$$s,arguments.length),o=i-0;o<0&&(o=0),n=new Array(o);for(var s=0;s<i;s++)n[s-0]=arguments[s];return ee.get("Opal").$destructure(n)["$=="](t)&&e.ret($),$+=1},a.$$s=s,a.$$arity=-1,a),r).call(n),l):s.$enum_for("find_index")}catch(t){if(t===e.returner)return t.$v;throw t}},S.$$arity=-1),e.defn(Z,"$first",I=function(t){try{var r,n,a,i,o,s=this,c=l,u=l;return(r=void 0===t)===l||null==r||r.$$is_boolean&&1!=r?(c=[],t=ee.get("Opal").$coerce_to(t,ee.get("Integer"),"to_int"),(r=t<0)===l||null==r||r.$$is_boolean&&1!=r||s.$raise(ee.get("ArgumentError"),"attempt to take negative size"),(r=0==t)===l||null==r||r.$$is_boolean&&1!=r?(u=0,(r=(i=s).$each,r.$$p=(o=function(r){var n,a,i=(o.$$s,arguments.length),s=i-0;s<0&&(s=0),n=new Array(s);for(var $=0;$<i;$++)n[$-0]=arguments[$];if(c.push(ee.get("Opal").$destructure(n)),(a=t<=++u)===l||null==a||a.$$is_boolean&&1!=a)return l;e.ret(c)},o.$$s=s,o.$$arity=-1,o),r).call(i),c):[]):(r=(n=s).$each,r.$$p=(a=function(t){a.$$s;null==t&&(t=l),e.ret(t)},a.$$s=s,a.$$arity=1,a),r).call(n)}catch(t){if(t===e.returner)return t.$v;throw t}},I.$$arity=-1),e.alias(Z,"flat_map","collect_concat"),e.defn(Z,"$grep",O=function(t){var r,n=this,a=O.$$p,i=a||l;O.$$p=null;var o=[];return n.$each.$$p=i!==l?function(){var n=ee.get("Opal").$destructure(arguments),a=t["$==="](n);(r=a)===l||null==r||r.$$is_boolean&&1!=r||(a=e.yield1(i,n),o.push(a))}:function(){var e=ee.get("Opal").$destructure(arguments),n=t["$==="](e);(r=n)===l||null==r||r.$$is_boolean&&1!=r||o.push(e)},n.$each(),o},O.$$arity=1),e.defn(Z,"$group_by",T=function(){var t,r,n,a,i,o=this,s=T.$$p,c=s||l,u=l;if(T.$$p=null,c===l)return(t=(r=o).$enum_for,
t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=o,n.$$arity=0,n),t).call(r,"group_by");u=ee.get("Hash").$new();return o.$each.$$p=function(){var r=ee.get("Opal").$destructure(arguments),n=e.yield1(c,r);(t=n,a=u,!1!==(i=a["$[]"](t))&&i!==l&&null!=i?i:a["$[]="](t,[]))["$<<"](r)},o.$each(),u},T.$$arity=0),e.defn(Z,"$include?",P=function(t){try{var r,n,a,i=this;return(r=(n=i).$each,r.$$p=(a=function(r){var n,i=(a.$$s,arguments.length),o=i-0;o<0&&(o=0),n=new Array(o);for(var s=0;s<i;s++)n[s-0]=arguments[s];if(!ee.get("Opal").$destructure(n)["$=="](t))return l;e.ret(!0)},a.$$s=i,a.$$arity=-1,a),r).call(n),!1}catch(t){if(t===e.returner)return t.$v;throw t}},P.$$arity=1),e.defn(Z,"$inject",M=function(t,r){var n=this,a=M.$$p,i=a||l;M.$$p=null;var o=t;return i!==l&&void 0===r?n.$each.$$p=function(){var t=ee.get("Opal").$destructure(arguments);if(void 0===o)return void(o=t);t=e.yieldX(i,[o,t]),o=t}:(void 0===r&&(ee.get("Symbol")["$==="](t)||n.$raise(ee.get("TypeError"),t.$inspect()+" is not a Symbol"),r=t,o=void 0),n.$each.$$p=function(){var e=ee.get("Opal").$destructure(arguments);if(void 0===o)return void(o=e);o=o.$__send__(r,e)}),n.$each(),void 0==o?l:o},M.$$arity=-1),e.defn(Z,"$lazy",N=function(){var t,r,n,a=this;return(t=(r=ee.get("Enumerator").$$scope.get("Lazy")).$new,t.$$p=(n=function(t,r){var a,i,o=(n.$$s,arguments.length),s=o-1;s<0&&(s=0),a=new Array(s);for(var c=1;c<o;c++)a[c-1]=arguments[c];return null==t&&(t=l),(i=t).$yield.apply(i,e.to_a(a))},n.$$s=a,n.$$arity=-2,n),t).call(r,a,a.$enumerator_size())},N.$$arity=0),e.defn(Z,"$enumerator_size",B=function(){var e,t=this;return(e=t["$respond_to?"]("size"))===l||null==e||e.$$is_boolean&&1!=e?l:t.$size()},B.$$arity=0),e.alias(Z,"map","collect"),e.defn(Z,"$max",R=function(t){var r,n,a=this,i=R.$$p,o=i||l;if(R.$$p=null,void 0===t||t===l){var s,c;return a.$each.$$p=function(){var t=ee.get("Opal").$destructure(arguments);if(void 0===s)return void(s=t);c=o!==l?e.yieldX(o,[t,s]):t["$<=>"](s),c===l&&a.$raise(ee.get("ArgumentError"),"comparison failed"),c>0&&(s=t)},a.$each(),void 0===s?l:s}return t=ee.get("Opal").$coerce_to(t,ee.get("Integer"),"to_int"),(r=(n=a).$sort,r.$$p=o.$to_proc(),r).call(n).$reverse().$first(t)},R.$$arity=-1),e.defn(Z,"$max_by",j=function(){var t,r,n,a=this,i=j.$$p,o=i||l;if(j.$$p=null,!1===o||o===l||null==o)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=a,n.$$arity=0,n),t).call(r,"max_by");var s,c;return a.$each.$$p=function(){var t=ee.get("Opal").$destructure(arguments),r=e.yield1(o,t);if(void 0===s)return s=t,void(c=r);r["$<=>"](c)>0&&(s=t,c=r)},a.$each(),void 0===s?l:s},j.$$arity=0),e.alias(Z,"member?","include?"),e.defn(Z,"$min",F=function(){var e=this,t=F.$$p,r=t||l;F.$$p=null;var n;return e.$each.$$p=r!==l?function(){var t=ee.get("Opal").$destructure(arguments);if(void 0===n)return void(n=t);var a=r(t,n);a===l&&e.$raise(ee.get("ArgumentError"),"comparison failed"),a<0&&(n=t)}:function(){var e=ee.get("Opal").$destructure(arguments);if(void 0===n)return void(n=e);ee.get("Opal").$compare(e,n)<0&&(n=e)},e.$each(),void 0===n?l:n},F.$$arity=0),e.defn(Z,"$min_by",D=function(){var t,r,n,a=this,i=D.$$p,o=i||l;if(D.$$p=null,!1===o||o===l||null==o)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=a,n.$$arity=0,n),t).call(r,"min_by");var s,c;return a.$each.$$p=function(){var t=ee.get("Opal").$destructure(arguments),r=e.yield1(o,t);if(void 0===s)return s=t,void(c=r);r["$<=>"](c)<0&&(s=t,c=r)},a.$each(),void 0===s?l:s},D.$$arity=0),e.defn(Z,"$minmax",L=function(){var e,t,r,n,a=this,i=L.$$p,o=i||l;L.$$p=null,!1!==(e=o)&&e!==l&&null!=e||(o=(t=(r=a).$proc,t.$$p=(n=function(e,t){n.$$s;return null==e&&(e=l),null==t&&(t=l),e["$<=>"](t)},n.$$s=a,n.$$arity=2,n),t).call(r));var s=l,c=l,u=!0;return a.$each.$$p=function(){var e=ee.get("Opal").$destructure(arguments);if(u)s=c=e,u=!1;else{var t=o.$call(s,e);t===l?a.$raise(ee.get("ArgumentError"),"comparison failed"):t>0&&(s=e);var r=o.$call(c,e);r===l?a.$raise(ee.get("ArgumentError"),"comparison failed"):r<0&&(c=e)}},a.$each(),[s,c]},L.$$arity=0),e.defn(Z,"$minmax_by",z=function(){var e=this;z.$$p;return z.$$p=null,e.$raise(ee.get("NotImplementedError"))},z.$$arity=0),e.defn(Z,"$none?",q=function(){try{var t,r,n,a,i,o=this,s=q.$$p,c=s||l;return q.$$p=null,c!==l?(t=(r=o).$each,t.$$p=(n=function(t){var r,a,i=(n.$$s,arguments.length),o=i-0;o<0&&(o=0),r=new Array(o);for(var s=0;s<i;s++)r[s-0]=arguments[s];if((a=e.yieldX(c,e.to_a(r)))===l||null==a||a.$$is_boolean&&1!=a)return l;e.ret(!1)},n.$$s=o,n.$$arity=-1,n),t).call(r):(t=(a=o).$each,t.$$p=(i=function(t){var r,n,a=(i.$$s,arguments.length),o=a-0;o<0&&(o=0),r=new Array(o);for(var s=0;s<a;s++)r[s-0]=arguments[s];if((n=ee.get("Opal").$destructure(r))===l||null==n||n.$$is_boolean&&1!=n)return l;e.ret(!1)},i.$$s=o,i.$$arity=-1,i),t).call(a),!0}catch(t){if(t===e.returner)return t.$v;throw t}},q.$$arity=0),e.defn(Z,"$one?",U=function(){try{var r,n,i,o,s,c=this,u=U.$$p,$=u||l,f=l;return U.$$p=null,f=0,$!==l?(r=(n=c).$each,r.$$p=(i=function(r){var n,o,s=(i.$$s,arguments.length),c=s-0;c<0&&(c=0),n=new Array(c);for(var u=0;u<s;u++)n[u-0]=arguments[u];return(o=e.yieldX($,e.to_a(n)))===l||null==o||o.$$is_boolean&&1!=o?l:(f=a(f,1),(o=t(f,1))===l||null==o||o.$$is_boolean&&1!=o?l:void e.ret(!1))},i.$$s=c,i.$$arity=-1,i),r).call(n):(r=(o=c).$each,r.$$p=(s=function(r){var n,i,o=(s.$$s,arguments.length),c=o-0;c<0&&(c=0),n=new Array(c);for(var u=0;u<o;u++)n[u-0]=arguments[u];return(i=ee.get("Opal").$destructure(n))===l||null==i||i.$$is_boolean&&1!=i?l:(f=a(f,1),(i=t(f,1))===l||null==i||i.$$is_boolean&&1!=i?l:void e.ret(!1))},s.$$s=c,s.$$arity=-1,s),r).call(o),f["$=="](1)}catch(t){if(t===e.returner)return t.$v;throw t}},U.$$arity=0),e.defn(Z,"$partition",H=function(){var t,r,n,a=this,i=H.$$p,o=i||l;if(H.$$p=null,o===l)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=a,n.$$arity=0,n),t).call(r,"partition");var s=[],c=[];return a.$each.$$p=function(){var r=ee.get("Opal").$destructure(arguments),n=e.yield1(o,r);(t=n)===l||null==t||t.$$is_boolean&&1!=t?c.push(r):s.push(r)},a.$each(),[s,c]},H.$$arity=0),e.alias(Z,"reduce","inject"),e.defn(Z,"$reject",G=function(){var t,r,n,a=this,i=G.$$p,o=i||l;if(G.$$p=null,o===l)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=a,n.$$arity=0,n),t).call(r,"reject");var s=[];return a.$each.$$p=function(){var r=ee.get("Opal").$destructure(arguments),n=e.yield1(o,r);((t=n)===l||null==t||t.$$is_boolean&&0==t)&&s.push(r)},a.$each(),s},G.$$arity=0),e.defn(Z,"$reverse_each",Y=function(){var t,r,n,a=this,i=Y.$$p,o=i||l;if(Y.$$p=null,o===l)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=a,n.$$arity=0,n),t).call(r,"reverse_each");var s=[];a.$each.$$p=function(){s.push(arguments)},a.$each();for(var c=s.length-1;c>=0;c--)e.yieldX(o,s[c]);return s},Y.$$arity=0),e.alias(Z,"select","find_all"),e.defn(Z,"$slice_before",Q=function(t){var r,n,a,i=this,o=Q.$$p,s=o||l;return Q.$$p=null,(r=void 0===t&&s===l||arguments.length>1)===l||null==r||r.$$is_boolean&&1!=r||i.$raise(ee.get("ArgumentError"),"wrong number of arguments ("+arguments.length+" for 1)"),(r=(n=ee.get("Enumerator")).$new,r.$$p=(a=function(r){var n,i=a.$$s||this;null==r&&(r=l);var o=[];i.$each.$$p=s!==l?void 0===t?function(){var t=ee.get("Opal").$destructure(arguments),a=e.yield1(s,t);(n=a)!==l&&null!=n&&(!n.$$is_boolean||1==n)&&o.length>0&&(r["$<<"](o),o=[]),o.push(t)}:function(){var e=ee.get("Opal").$destructure(arguments),a=s(e,t.$dup());(n=a)!==l&&null!=n&&(!n.$$is_boolean||1==n)&&o.length>0&&(r["$<<"](o),o=[]),o.push(e)}:function(){var e=ee.get("Opal").$destructure(arguments),a=t["$==="](e);(n=a)!==l&&null!=n&&(!n.$$is_boolean||1==n)&&o.length>0&&(r["$<<"](o),o=[]),o.push(e)},i.$each(),o.length>0&&r["$<<"](o)},a.$$s=i,a.$$arity=1,a),r).call(n)},Q.$$arity=-1),e.defn(Z,"$sort",V=function(){var e,t,r,n,a=this,i=V.$$p,o=i||l,s=l;return V.$$p=null,s=a.$to_a(),o!==l||(o=(e=(t=a).$lambda,e.$$p=(r=function(e,t){r.$$s;return null==e&&(e=l),null==t&&(t=l),e["$<=>"](t)},r.$$s=a,r.$$arity=2,r),e).call(t)),(e=(n=s).$sort,e.$$p=o.$to_proc(),e).call(n)},V.$$arity=0),e.defn(Z,"$sort_by",X=function(){var t,r,n,a,i,o,s,c,u,$=this,f=X.$$p,p=f||l,d=l;return X.$$p=null,p===l?(t=(r=$).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$enumerator_size()},n.$$s=$,n.$$arity=0,n),t).call(r,"sort_by"):(d=(t=(a=$).$map,t.$$p=(i=function(){var t,r=(i.$$s,l);return r=ee.get("Opal").$destructure(arguments),t=e.yield1(p,r),[t,r]},i.$$s=$,i.$$arity=0,i),t).call(a),(t=(o=d)["$sort!"],t.$$p=(s=function(e,t){s.$$s;return null==e&&(e=l),null==t&&(t=l),e[0]["$<=>"](t[0])},s.$$s=$,s.$$arity=2,s),t).call(o),(t=(c=d)["$map!"],t.$$p=(u=function(e){u.$$s;return null==e&&(e=l),e[1]},u.$$s=$,u.$$arity=1,u),t).call(c))},X.$$arity=0),e.defn(Z,"$take",W=function(e){return this.$first(e)},W.$$arity=1),e.defn(Z,"$take_while",J=function(){try{var t,r,n,a=this,i=J.$$p,o=i||l,s=l;return J.$$p=null,!1===o||o===l||null==o?a.$enum_for("take_while"):(s=[],(t=(r=a).$each,t.$$p=(n=function(t){var r,a,i=(n.$$s,l),c=arguments.length,u=c-0;u<0&&(u=0),r=new Array(u);for(var $=0;$<c;$++)r[$-0]=arguments[$];return i=ee.get("Opal").$destructure(r),((a=e.yield1(o,i))===l||null==a||a.$$is_boolean&&1!=a)&&e.ret(s),s.push(i)},n.$$s=a,n.$$arity=-1,n),t).call(r))}catch(t){if(t===e.returner)return t.$v;throw t}},J.$$arity=0),e.alias(Z,"to_a","entries"),e.defn(Z,"$zip",K=function(t){var r,n,a=this,i=(K.$$p,arguments.length),o=i-0;o<0&&(o=0),n=new Array(o);for(var s=0;s<i;s++)n[s-0]=arguments[s];return K.$$p=null,(r=a.$to_a()).$zip.apply(r,e.to_a(n))},K.$$arity=-1)}(s.base)},Opal.modules["corelib/enumerator"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}var n=e.top,a=e,i=e.nil,o=e.breaker,s=e.slice,l=e.klass;return e.add_stubs(["$require","$include","$allocate","$new","$to_proc","$coerce_to","$nil?","$empty?","$+","$class","$__send__","$===","$call","$enum_for","$size","$destructure","$inspect","$[]","$raise","$yield","$each","$enumerator_size","$respond_to?","$try_convert","$<","$for"]),n.$require("corelib/enumerable"),function(n,a){function c(){}var u,$,f,p,d,h,_=c=l(n,null,"Enumerator",c),g=_.$$proto,m=_.$$scope;return g.size=g.args=g.object=g.method=i,_.$include(m.get("Enumerable")),g.$$is_enumerator=!0,e.defs(_,"$for",u=function(e,t,r){var n,a=this,o=u.$$p,s=o||i;null==t&&(t="each");var l=arguments.length,c=l-2;c<0&&(c=0),n=new Array(c);for(var $=2;$<l;$++)n[$-2]=arguments[$];u.$$p=null;var f=a.$allocate();return f.object=e,f.size=s,f.method=t,f.args=n,f},u.$$arity=-2),e.defn(_,"$initialize",$=function(e){var t,r,n=this,a=$.$$p,o=a||i;return $.$$p=null,!1!==o&&o!==i&&null!=o?(n.object=(t=(r=m.get("Generator")).$new,t.$$p=o.$to_proc(),t).call(r),n.method="each",n.args=[],n.size=arguments[0]||i,(t=n.size)===i||null==t||t.$$is_boolean&&1!=t?i:n.size=m.get("Opal").$coerce_to(n.size,m.get("Integer"),"to_int")):(n.object=arguments[0],n.method=arguments[1]||"each",n.args=s.call(arguments,2),n.size=i)},$.$$arity=-1),e.defn(_,"$each",f=function(r){var n,a,o,s,l=this,c=f.$$p,u=c||i,$=arguments.length,p=$-0;p<0&&(p=0),s=new Array(p);for(var d=0;d<$;d++)s[d-0]=arguments[d];return f.$$p=null,a=u["$nil?"](),(n=!1!==a&&a!==i&&null!=a?s["$empty?"]():a)===i||null==n||n.$$is_boolean&&1!=n?(s=t(l.args,s),(n=u["$nil?"]())===i||null==n||n.$$is_boolean&&1!=n?(a=(o=l.object).$__send__,a.$$p=u.$to_proc(),a).apply(o,[l.method].concat(e.to_a(s))):(n=l.$class()).$new.apply(n,[l.object,l.method].concat(e.to_a(s)))):l},f.$$arity=-1),e.defn(_,"$size",p=function(){var t,r=this;return(t=m.get("Proc")["$==="](r.size))===i||null==t||t.$$is_boolean&&1!=t?r.size:(t=r.size).$call.apply(t,e.to_a(r.args))},p.$$arity=0),e.defn(_,"$with_index",d=function(e){var t,r,n,a=this,o=d.$$p,s=o||i;if(null==e&&(e=0),d.$$p=null,e=!1!==e&&e!==i&&null!=e?m.get("Opal").$coerce_to(e,m.get("Integer"),"to_int"):0,!1===s||s===i||null==s)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=a,n.$$arity=0,n),t).call(r,"with_index",e);var l=e;return a.$each.$$p=function(){var e=m.get("Opal").$destructure(arguments),t=s(e,l);return l++,t},a.$each()},d.$$arity=-1),e.alias(_,"with_object","each_with_object"),e.defn(_,"$inspect",h=function(){var e,r=this,n=i;return n="#<"+r.$class()+": "+r.object.$inspect()+":"+r.method,((e=r.args["$empty?"]())===i||null==e||e.$$is_boolean&&1!=e)&&(n=t(n,"("+r.args.$inspect()["$[]"](m.get("Range").$new(1,-2))+")")),t(n,">")},h.$$arity=0),function(t,r){function n(){}var a,s,c=n=l(t,null,"Generator",n),u=c.$$proto,$=c.$$scope;u.block=i,c.$include($.get("Enumerable")),e.defn(c,"$initialize",a=function(){var e=this,t=a.$$p,r=t||i;return a.$$p=null,!1!==r&&r!==i&&null!=r||e.$raise($.get("LocalJumpError"),"no block given"),e.block=r},a.$$arity=0),e.defn(c,"$each",s=function(t){var r,n,a,l=this,c=s.$$p,u=c||i,f=i,p=arguments.length,d=p-0;d<0&&(d=0),a=new Array(d);for(var h=0;h<p;h++)a[h-0]=arguments[h];s.$$p=null,f=(r=(n=$.get("Yielder")).$new,r.$$p=u.$to_proc(),r).call(n);try{a.unshift(f),e.yieldX(l.block,a)}catch(e){if(e===o)return o.$v;throw e}return l},s.$$arity=-1)}(m.base),function(t,r){function n(){}var a,s,c,u=n=l(t,null,"Yielder",n),$=u.$$proto;u.$$scope;$.block=i,e.defn(u,"$initialize",a=function(){var e=this,t=a.$$p,r=t||i;return a.$$p=null,e.block=r},a.$$arity=0),e.defn(u,"$yield",s=function(t){var r,n=this,a=arguments.length,i=a-0;i<0&&(i=0),r=new Array(i);for(var s=0;s<a;s++)r[s-0]=arguments[s];var l=e.yieldX(n.block,r);if(l===o)throw o;return l},s.$$arity=-1),e.defn(u,"$<<",c=function(t){var r,n,a=this,i=arguments.length,o=i-0;o<0&&(o=0),n=new Array(o);for(var s=0;s<i;s++)n[s-0]=arguments[s];return(r=a).$yield.apply(r,e.to_a(n)),a},c.$$arity=-1)}(m.base),function(n,a){function o(){}var s,c,u,$,f,p,d,h,_,g,m,y,v,b=o=l(n,a,"Lazy",o),x=b.$$proto,w=b.$$scope;return x.enumerator=i,function(e,t){function r(){}var n=r=l(e,t,"StopLazyError",r);n.$$proto,n.$$scope}(w.base,w.get("Exception")),e.defn(b,"$initialize",s=function(t,r){var n,a,o,l=this,c=s.$$p,u=c||i;return null==r&&(r=i),s.$$p=null,u!==i||l.$raise(w.get("ArgumentError"),"tried to call lazy new without a block"),l.enumerator=t,(a=l,n=e.find_super_dispatcher(l,"initialize",s,!1),n.$$p=(o=function(r,n){var a,s,l,c,$=o.$$s||this,f=arguments.length,p=f-1;p<0&&(p=0),a=new Array(p);for(var d=1;d<f;d++)a[d-1]=arguments[d];null==r&&(r=i);try{return(s=(l=t).$each,s.$$p=(c=function(t){var n,a=(c.$$s,arguments.length),i=a-0;i<0&&(i=0),n=new Array(i);for(var o=0;o<a;o++)n[o-0]=arguments[o];n.unshift(r),e.yieldX(u,n)},c.$$s=$,c.$$arity=-1,c),s).apply(l,e.to_a(a))}catch(t){if(!e.rescue(t,[w.get("Exception")]))throw t;try{return i}finally{e.pop_exception()}}},o.$$s=l,o.$$arity=-2,o),n).call(a,r)},s.$$arity=-2),e.alias(b,"force","to_a"),e.defn(b,"$lazy",c=function(){return this},c.$$arity=0),e.defn(b,"$collect",u=function(){var t,r,n,a=this,o=u.$$p,s=o||i;return u.$$p=null,!1!==s&&s!==i&&null!=s||a.$raise(w.get("ArgumentError"),"tried to call lazy map without a block"),(t=(r=w.get("Lazy")).$new,t.$$p=(n=function(t,r){var a,o=(n.$$s,arguments.length),l=o-1;l<0&&(l=0),a=new Array(l);for(var c=1;c<o;c++)a[c-1]=arguments[c];null==t&&(t=i);var u=e.yieldX(s,a);t.$yield(u)},n.$$s=a,n.$$arity=-2,n),t).call(r,a,a.$enumerator_size())},u.$$arity=0),e.defn(b,"$collect_concat",$=function(){var t,r,n,a=this,o=$.$$p,s=o||i;return $.$$p=null,!1!==s&&s!==i&&null!=s||a.$raise(w.get("ArgumentError"),"tried to call lazy map without a block"),(t=(r=w.get("Lazy")).$new,t.$$p=(n=function(t,r){var a,o,l,c,u,$,f=n.$$s||this,p=arguments.length,d=p-1;d<0&&(d=0),a=new Array(d);for(var h=1;h<p;h++)a[h-1]=arguments[h];null==t&&(t=i);var _=e.yieldX(s,a);if(_["$respond_to?"]("force")&&_["$respond_to?"]("each"))(o=(l=_).$each,o.$$p=(c=function(e){c.$$s;return null==e&&(e=i),t.$yield(e)},c.$$s=f,c.$$arity=1,c),o).call(l);else{w.get("Opal").$try_convert(_,w.get("Array"),"to_ary")===i?t.$yield(_):(o=(u=_).$each,o.$$p=($=function(e){$.$$s;return null==e&&(e=i),t.$yield(e)},$.$$s=f,$.$$arity=1,$),o).call(u)}},n.$$s=a,n.$$arity=-2,n),t).call(r,a,i)},$.$$arity=0),e.defn(b,"$drop",f=function(n){var a,o,s,l=this,c=i,u=i,$=i;return n=w.get("Opal").$coerce_to(n,w.get("Integer"),"to_int"),(a=r(n,0))===i||null==a||a.$$is_boolean&&1!=a||l.$raise(w.get("ArgumentError"),"attempt to drop negative size"),c=l.$enumerator_size(),u=function(){return(a=w.get("Integer")["$==="](c))===i||null==a||a.$$is_boolean&&1!=a?c:(a=r(n,c))===i||null==a||a.$$is_boolean&&1!=a?c:n}(),$=0,(a=(o=w.get("Lazy")).$new,a.$$p=(s=function(a,o){var l,c,u=(s.$$s,arguments.length),f=u-1;f<0&&(f=0),l=new Array(f);for(var p=1;p<u;p++)l[p-1]=arguments[p];return null==a&&(a=i),(c=r($,n))===i||null==c||c.$$is_boolean&&1!=c?(c=a).$yield.apply(c,e.to_a(l)):$=t($,1)},s.$$s=l,s.$$arity=-2,s),a).call(o,l,u)},f.$$arity=1),e.defn(b,"$drop_while",p=function(){var t,r,n,a=this,o=p.$$p,s=o||i,l=i;return p.$$p=null,!1!==s&&s!==i&&null!=s||a.$raise(w.get("ArgumentError"),"tried to call lazy drop_while without a block"),l=!0,(t=(r=w.get("Lazy")).$new,t.$$p=(n=function(t,r){var a,o,c,u=(n.$$s,arguments.length),$=u-1;$<0&&($=0),a=new Array($);for(var f=1;f<u;f++)a[f-1]=arguments[f];if(null==t&&(t=i),!1===l||l===i||null==l)return(c=t).$yield.apply(c,e.to_a(a));((o=e.yieldX(s,a))===i||null==o||o.$$is_boolean&&0==o)&&(l=!1,(o=t).$yield.apply(o,e.to_a(a)))},n.$$s=a,n.$$arity=-2,n),t).call(r,a,i)},p.$$arity=0),e.defn(b,"$enum_for",d=function(t,r){var n,a,o,s=this,l=d.$$p,c=l||i;null==t&&(t="each");var u=arguments.length,$=u-1;$<0&&($=0),o=new Array($);for(var f=1;f<u;f++)o[f-1]=arguments[f];return d.$$p=null,(n=(a=s.$class()).$for,n.$$p=c.$to_proc(),n).apply(a,[s,t].concat(e.to_a(o)))},d.$$arity=-1),e.defn(b,"$find_all",h=function(){var t,r,n,a=this,o=h.$$p,s=o||i;return h.$$p=null,!1!==s&&s!==i&&null!=s||a.$raise(w.get("ArgumentError"),"tried to call lazy select without a block"),(t=(r=w.get("Lazy")).$new,t.$$p=(n=function(t,r){var a,o,l=(n.$$s,arguments.length),c=l-1;c<0&&(c=0),a=new Array(c);for(var u=1;u<l;u++)a[u-1]=arguments[u];null==t&&(t=i),(o=e.yieldX(s,a))===i||null==o||o.$$is_boolean&&1!=o||(o=t).$yield.apply(o,e.to_a(a))},n.$$s=a,n.$$arity=-2,n),t).call(r,a,i)},h.$$arity=0),e.alias(b,"flat_map","collect_concat"),e.defn(b,"$grep",_=function(t){var r,n,a,o,s,l=this,c=_.$$p,u=c||i;return _.$$p=null,!1!==u&&u!==i&&null!=u?(r=(n=w.get("Lazy")).$new,r.$$p=(a=function(r,n){var o,s,l=(a.$$s,arguments.length),c=l-1;c<0&&(c=0),o=new Array(c);for(var $=1;$<l;$++)o[$-1]=arguments[$];null==r&&(r=i);var f=w.get("Opal").$destructure(o),p=t["$==="](f);(s=p)===i||null==s||s.$$is_boolean&&1!=s||(p=e.yield1(u,f),r.$yield(e.yield1(u,f)))},a.$$s=l,a.$$arity=-2,a),r).call(n,l,i):(r=(o=w.get("Lazy")).$new,r.$$p=(s=function(e,r){var n,a,o=(s.$$s,arguments.length),l=o-1;l<0&&(l=0),n=new Array(l);for(var c=1;c<o;c++)n[c-1]=arguments[c];null==e&&(e=i);var u=w.get("Opal").$destructure(n);(a=t["$==="](u))===i||null==a||a.$$is_boolean&&1!=a||e.$yield(u)},s.$$s=l,s.$$arity=-2,s),r).call(o,l,i)},_.$$arity=1),e.alias(b,"map","collect"),e.alias(b,"select","find_all"),e.defn(b,"$reject",g=function(){var t,r,n,a=this,o=g.$$p,s=o||i;return g.$$p=null,!1!==s&&s!==i&&null!=s||a.$raise(w.get("ArgumentError"),"tried to call lazy reject without a block"),(t=(r=w.get("Lazy")).$new,t.$$p=(n=function(t,r){var a,o,l=(n.$$s,arguments.length),c=l-1;c<0&&(c=0),a=new Array(c);for(var u=1;u<l;u++)a[u-1]=arguments[u];null==t&&(t=i),((o=e.yieldX(s,a))===i||null==o||o.$$is_boolean&&0==o)&&(o=t).$yield.apply(o,e.to_a(a))},n.$$s=a,n.$$arity=-2,n),t).call(r,a,i)},g.$$arity=0),e.defn(b,"$take",m=function(n){var a,o,s,l=this,c=i,u=i,$=i;return n=w.get("Opal").$coerce_to(n,w.get("Integer"),"to_int"),(a=r(n,0))===i||null==a||a.$$is_boolean&&1!=a||l.$raise(w.get("ArgumentError"),"attempt to take negative size"),c=l.$enumerator_size(),u=function(){return(a=w.get("Integer")["$==="](c))===i||null==a||a.$$is_boolean&&1!=a?c:(a=r(n,c))===i||null==a||a.$$is_boolean&&1!=a?c:n}(),$=0,(a=(o=w.get("Lazy")).$new,a.$$p=(s=function(a,o){var l,c,u=s.$$s||this,f=arguments.length,p=f-1;p<0&&(p=0),l=new Array(p);for(var d=1;d<f;d++)l[d-1]=arguments[d];return null==a&&(a=i),(c=r($,n))===i||null==c||c.$$is_boolean&&1!=c?u.$raise(w.get("StopLazyError")):((c=a).$yield.apply(c,e.to_a(l)),$=t($,1))},s.$$s=l,s.$$arity=-2,s),a).call(o,l,u)},m.$$arity=1),e.defn(b,"$take_while",y=function(){var t,r,n,a=this,o=y.$$p,s=o||i;return y.$$p=null,!1!==s&&s!==i&&null!=s||a.$raise(w.get("ArgumentError"),"tried to call lazy take_while without a block"),(t=(r=w.get("Lazy")).$new,t.$$p=(n=function(t,r){var a,o,l=n.$$s||this,c=arguments.length,u=c-1;u<0&&(u=0),a=new Array(u);for(var $=1;$<c;$++)a[$-1]=arguments[$];null==t&&(t=i),(o=e.yieldX(s,a))===i||null==o||o.$$is_boolean&&1!=o?l.$raise(w.get("StopLazyError")):(o=t).$yield.apply(o,e.to_a(a))},n.$$s=a,n.$$arity=-2,n),t).call(r,a,i)},y.$$arity=0),e.alias(b,"to_enum","enum_for"),e.defn(b,"$inspect",v=function(){var e=this;return"#<"+e.$class()+": "+e.enumerator.$inspect()+">"},v.$$arity=0),i&&"inspect"}(m.base,_)}(a.base)},Opal.modules["corelib/numeric"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}var o=e.top,s=e,l=e.nil,c=(e.breaker,e.slice,e.klass);return e.add_stubs(["$require","$include","$instance_of?","$class","$Float","$coerce","$===","$raise","$__send__","$equal?","$coerce_to!","$-@","$**","$-","$*","$div","$<","$ceil","$to_f","$denominator","$to_r","$==","$floor","$/","$%","$Complex","$zero?","$numerator","$abs","$arg","$round","$to_i","$truncate","$>"]),o.$require("corelib/comparable"),function(o,s){function u(){}var $,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q=u=c(o,null,"Numeric",u),V=(Q.$$proto,Q.$$scope);return Q.$include(V.get("Comparable")),e.defn(Q,"$coerce",$=function(e){var t,r=this;return(t=e["$instance_of?"](r.$class()))===l||null==t||t.$$is_boolean&&1!=t?[r.$Float(e),r.$Float(r)]:[e,r]},$.$$arity=1),e.defn(Q,"$__coerced__",f=function(t,r){var n,a,i=this,o=l,s=l,c=l;try{a=r.$coerce(i),n=e.to_ary(a),o=null==n[0]?l:n[0],s=null==n[1]?l:n[1]}catch(n){if(!e.rescue(n,[V.get("StandardError")]))throw n;try{c=t,"+"["$==="](c)||"-"["$==="](c)||"*"["$==="](c)||"/"["$==="](c)||"%"["$==="](c)||"&"["$==="](c)||"|"["$==="](c)||"^"["$==="](c)||"**"["$==="](c)?i.$raise(V.get("TypeError"),r.$class()+" can't be coerce into Numeric"):(">"["$==="](c)||">="["$==="](c)||"<"["$==="](c)||"<="["$==="](c)||"<=>"["$==="](c))&&i.$raise(V.get("ArgumentError"),"comparison of "+i.$class()+" with "+r.$class()+" failed")}finally{e.pop_exception()}}return o.$__send__(t,s)},f.$$arity=2),e.defn(Q,"$<=>",p=function(e){var t;return(t=this["$equal?"](e))===l||null==t||t.$$is_boolean&&1!=t?l:0},p.$$arity=1),e.defn(Q,"$[]",d=function(e){var r=this,n=l,a=l;return e=V.get("Opal")["$coerce_to!"](e,V.get("Integer"),"to_int"),n=2["$**"](30)["$-@"](),a=t(2["$**"](30),1),e<n||e>a?0:(r>>e)%2},d.$$arity=1),e.defn(Q,"$+@",h=function(){return this},h.$$arity=0),e.defn(Q,"$-@",_=function(){return t(0,this)},_.$$arity=0),e.defn(Q,"$%",g=function(e){var n=this;return t(n,r(e,n.$div(e)))},g.$$arity=1),e.defn(Q,"$abs",m=function(){var e=this;return n(e,0)?e["$-@"]():e},m.$$arity=0),e.defn(Q,"$abs2",y=function(){var e=this;return r(e,e)},y.$$arity=0),e.defn(Q,"$angle",v=function(){return n(this,0)?V.get("Math").$$scope.get("PI"):0},v.$$arity=0),e.alias(Q,"arg","angle"),e.defn(Q,"$ceil",b=function(){return this.$to_f().$ceil()},b.$$arity=0),e.defn(Q,"$conj",x=function(){return this},x.$$arity=0),e.alias(Q,"conjugate","conj"),e.defn(Q,"$denominator",w=function(){return this.$to_r().$denominator()},w.$$arity=0),e.defn(Q,"$div",A=function(e){var t=this;return e["$=="](0)&&t.$raise(V.get("ZeroDivisionError"),"divided by o"),a(t,e).$floor()},A.$$arity=1),e.defn(Q,"$divmod",k=function(e){var t=this;return[t.$div(e),t["$%"](e)]},k.$$arity=1),e.defn(Q,"$fdiv",E=function(e){return a(this.$to_f(),e)},E.$$arity=1),e.defn(Q,"$floor",C=function(){return this.$to_f().$floor()},C.$$arity=0),e.defn(Q,"$i",S=function(){var e=this;return e.$Complex(0,e)},S.$$arity=0),e.defn(Q,"$imag",I=function(){return 0},I.$$arity=0),e.alias(Q,"imaginary","imag"),e.defn(Q,"$integer?",O=function(){return!1},O.$$arity=0),e.alias(Q,"magnitude","abs"),e.alias(Q,"modulo","%"),e.defn(Q,"$nonzero?",T=function(){var e,t=this;return(e=t["$zero?"]())===l||null==e||e.$$is_boolean&&1!=e?t:l},T.$$arity=0),e.defn(Q,"$numerator",P=function(){return this.$to_r().$numerator()},P.$$arity=0),e.alias(Q,"phase","arg"),e.defn(Q,"$polar",M=function(){var e=this;return[e.$abs(),e.$arg()]},M.$$arity=0),e.defn(Q,"$quo",N=function(e){var t=this;return a(V.get("Opal")["$coerce_to!"](t,V.get("Rational"),"to_r"),e)},N.$$arity=1),e.defn(Q,"$real",B=function(){return this},B.$$arity=0),e.defn(Q,"$real?",R=function(){return!0},R.$$arity=0),e.defn(Q,"$rect",j=function(){return[this,0]},j.$$arity=0),e.alias(Q,"rectangular","rect"),e.defn(Q,"$round",F=function(e){return this.$to_f().$round(e)},F.$$arity=-1),e.defn(Q,"$to_c",D=function(){var e=this;return e.$Complex(e,0)},D.$$arity=0),e.defn(Q,"$to_int",L=function(){return this.$to_i()},L.$$arity=0),e.defn(Q,"$truncate",z=function(){return this.$to_f().$truncate()},z.$$arity=0),e.defn(Q,"$zero?",q=function(){return this["$=="](0)},q.$$arity=0),e.defn(Q,"$positive?",U=function(){return i(this,0)},U.$$arity=0),e.defn(Q,"$negative?",H=function(){return n(this,0)},H.$$arity=0),e.defn(Q,"$dup",G=function(){var e=this;return e.$raise(V.get("TypeError"),"can't dup "+e.$class())},G.$$arity=0),e.defn(Q,"$clone",Y=function(){var e=this;return e.$raise(V.get("TypeError"),"can't clone "+e.$class())},Y.$$arity=0),l&&"clone"}(s.base)},Opal.modules["corelib/array"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e>=t:e["$>="](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}var i=e.top,o=e,s=e.nil,l=(e.breaker,e.slice,e.klass),c=e.hash2,u=e.gvars;return e.add_stubs(["$require","$include","$to_a","$raise","$===","$replace","$respond_to?","$to_ary","$coerce_to","$coerce_to?","$join","$to_str","$class","$clone","$hash","$<=>","$==","$object_id","$inspect","$enum_for","$coerce_to!","$>","$*","$enumerator_size","$empty?","$size","$eql?","$length","$begin","$end","$exclude_end?","$flatten","$__id__","$[]","$to_s","$new","$!","$>=","$**","$delete_if","$to_proc","$each","$reverse","$rotate","$rand","$at","$keep_if","$shuffle!","$dup","$<","$sort","$sort_by","$!=","$times","$[]=","$<<","$values","$kind_of?","$last","$first","$upto","$reject","$pristine"]),i.$require("corelib/enumerable"),i.$require("corelib/numeric"),function(i,o){function $(){}function f(t,r){return r.$$name===e.Array?t:r.$allocate().$replace(t.$to_a())}function p(e,t){return e===t||0===t?1:t>0&&e>t?p(e-1,t-1)+p(e-1,t):0}function d(e,t){for(var r=t>=0?1:0;t;)r*=e,e--,t--;return r}var h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne,ae,ie,oe,se,le,ce,ue,$e,fe,pe,de,he,_e,ge,me,ye,ve,be,xe,we,Ae,ke,Ee,Ce,Se,Ie,Oe,Te,Pe,Me,Ne,Be,Re,je,Fe,De,Le,ze,qe,Ue,He,Ge,Ye,Qe,Ve=$=l(i,o,"Array",$),Xe=Ve.$$proto,We=Ve.$$scope;return Xe.length=s,Ve.$include(We.get("Enumerable")),Xe.$$is_array=!0,e.defs(Ve,"$[]",h=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];return f(t,r)},h.$$arity=-1),e.defn(Ve,"$initialize",_=function(e,t){var r,n=this,a=_.$$p,i=a||s;if(null==e&&(e=s),null==t&&(t=s),_.$$p=null,(r=arguments.length>2)===s||null==r||r.$$is_boolean&&1!=r||n.$raise(We.get("ArgumentError"),"wrong number of arguments ("+arguments.length+" for 0..2)"),0===arguments.length)return n.splice(0,n.length),n;if((r=1===arguments.length)!==s&&null!=r&&(!r.$$is_boolean||1==r)){if(!((r=We.get("Array")["$==="](e))===s||null==r||r.$$is_boolean&&1!=r))return n.$replace(e.$to_a()),n;if((r=e["$respond_to?"]("to_ary"))!==s&&null!=r&&(!r.$$is_boolean||1==r))return n.$replace(e.$to_ary()),n}e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),(r=e<0)===s||null==r||r.$$is_boolean&&1!=r||n.$raise(We.get("ArgumentError"),"negative array size"),n.splice(0,n.length);var o,l;if(i===s)for(o=0;o<e;o++)n.push(t);else for(o=0,l;o<e;o++)l=i(o),n[o]=l;return n},_.$$arity=-1),e.defs(Ve,"$try_convert",g=function(e){return We.get("Opal")["$coerce_to?"](e,We.get("Array"),"to_ary")},g.$$arity=1),e.defn(Ve,"$&",m=function(t){var r,n=this;t=(r=We.get("Array")["$==="](t))===s||null==r||r.$$is_boolean&&1!=r?We.get("Opal").$coerce_to(t,We.get("Array"),"to_ary").$to_a():t.$to_a();var a,i,o,l=[],u=c([],{});for(a=0,i=t.length;a<i;a++)e.hash_put(u,t[a],!0);for(a=0,i=n.length;a<i;a++)o=n[a],void 0!==e.hash_delete(u,o)&&l.push(o);return l},m.$$arity=1),e.defn(Ve,"$|",y=function(t){var r,n=this;t=(r=We.get("Array")["$==="](t))===s||null==r||r.$$is_boolean&&1!=r?We.get("Opal").$coerce_to(t,We.get("Array"),"to_ary").$to_a():t.$to_a();var a,i,o=c([],{});for(a=0,i=n.length;a<i;a++)e.hash_put(o,n[a],!0);for(a=0,i=t.length;a<i;a++)e.hash_put(o,t[a],!0);return o.$keys()},y.$$arity=1),e.defn(Ve,"$*",v=function(e){var t,r=this;if((t=e["$respond_to?"]("to_str"))!==s&&null!=t&&(!t.$$is_boolean||1==t))return r.$join(e.$to_str());e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),(t=e<0)===s||null==t||t.$$is_boolean&&1!=t||r.$raise(We.get("ArgumentError"),"negative argument");for(var n=[],a=r.$to_a(),i=0;i<e;i++)n=n.concat(a);return f(n,r.$class())},v.$$arity=1),e.defn(Ve,"$+",b=function(e){var t,r=this;return e=(t=We.get("Array")["$==="](e))===s||null==t||t.$$is_boolean&&1!=t?We.get("Opal").$coerce_to(e,We.get("Array"),"to_ary").$to_a():e.$to_a(),r.concat(e)},b.$$arity=1),e.defn(Ve,"$-",x=function(t){var r,n=this;if(t=(r=We.get("Array")["$==="](t))===s||null==r||r.$$is_boolean&&1!=r?We.get("Opal").$coerce_to(t,We.get("Array"),"to_ary").$to_a():t.$to_a(),(r=0===n.length)!==s&&null!=r&&(!r.$$is_boolean||1==r))return[];if((r=0===t.length)!==s&&null!=r&&(!r.$$is_boolean||1==r))return n.$clone().$to_a();var a,i,o,l=[],u=c([],{});for(a=0,i=t.length;a<i;a++)e.hash_put(u,t[a],!0);for(a=0,i=n.length;a<i;a++)o=n[a],void 0===e.hash_get(u,o)&&l.push(o);return l},x.$$arity=1),e.defn(Ve,"$<<",w=function(e){var t=this;return t.push(e),t},w.$$arity=1),e.defn(Ve,"$<=>",A=function(e){var t,r=this;if((t=We.get("Array")["$==="](e))===s||null==t||t.$$is_boolean&&1!=t){if((t=e["$respond_to?"]("to_ary"))===s||null==t||t.$$is_boolean&&1!=t)return s;e=e.$to_ary().$to_a()}else e=e.$to_a();if(r.$hash()===e.$hash())return 0;for(var n=Math.min(r.length,e.length),a=0;a<n;a++){var i=r[a]["$<=>"](e[a]);if(0!==i)return i}return r.length["$<=>"](e.length)},A.$$arity=1),e.defn(Ve,"$==",k=function(e){function t(e,r){var a,i,o,s;if(e===r)return!0;if(!r.$$is_array)return!!We.get("Opal")["$respond_to?"](r,"to_ary")&&r["$=="](e);if(e.constructor!==Array&&(e=e.$to_a()),r.constructor!==Array&&(r=r.$to_a()),e.length!==r.length)return!1;for(n[e.$object_id()]=!0,a=0,i=e.length;a<i;a++)if(o=e[a],s=r[a],o.$$is_array){if(s.$$is_array&&s.length!==o.length)return!1;if(!n.hasOwnProperty(o.$object_id())&&!t(o,s))return!1}else if(!o["$=="](s))return!1;return!0}var r=this,n={};return t(r,e)},k.$$arity=1),e.defn(Ve,"$[]",E=function(e,t){var r,n,a,i,o=this,l=o.length;if(e.$$is_range){if(r=e.exclude,n=We.get("Opal").$coerce_to(e.begin,We.get("Integer"),"to_int"),a=We.get("Opal").$coerce_to(e.end,We.get("Integer"),"to_int"),n<0&&(n+=l)<0)return s;if(n>l)return s
;if(a<0&&(a+=l)<0)return[];r||(a+=1),i=o.slice(n,a)}else{if((e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"))<0&&(e+=l)<0)return s;if(void 0===t)return e>=l||e<0?s:o[e];if((t=We.get("Opal").$coerce_to(t,We.get("Integer"),"to_int"))<0||e>l||e<0)return s;i=o.slice(e,e+t)}return f(i,o.$class())},E.$$arity=-2),e.defn(Ve,"$[]=",C=function(e,t,r){var n,a,i=this,o=s,l=s,c=i.length;if((n=We.get("Range")["$==="](e))===s||null==n||n.$$is_boolean&&1!=n){(n=void 0===r)===s||null==n||n.$$is_boolean&&1!=n?(l=t,t=r,o=(n=We.get("Array")["$==="](t))===s||null==n||n.$$is_boolean&&1!=n?(n=t["$respond_to?"]("to_ary"))===s||null==n||n.$$is_boolean&&1!=n?[t]:t.$to_ary().$to_a():t.$to_a()):l=1;var u;if(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),l=We.get("Opal").$coerce_to(l,We.get("Integer"),"to_int"),e<0&&(u=e,(e+=c)<0&&i.$raise(We.get("IndexError"),"index "+u+" too small for array; minimum "+-i.length)),l<0&&i.$raise(We.get("IndexError"),"negative length ("+l+")"),e>c)for(a=c;a<e;a++)i[a]=s;return void 0===r?i[e]=t:i.splice.apply(i,[e,l].concat(o)),t}o=(n=We.get("Array")["$==="](t))===s||null==n||n.$$is_boolean&&1!=n?(n=t["$respond_to?"]("to_ary"))===s||null==n||n.$$is_boolean&&1!=n?[t]:t.$to_ary().$to_a():t.$to_a();var $=e.exclude,f=We.get("Opal").$coerce_to(e.begin,We.get("Integer"),"to_int"),p=We.get("Opal").$coerce_to(e.end,We.get("Integer"),"to_int");if(f<0&&(f+=c)<0&&i.$raise(We.get("RangeError"),e.$inspect()+" out of range"),p<0&&(p+=c),$||(p+=1),f>c)for(a=c;a<f;a++)i[a]=s;return p<0?i.splice.apply(i,[f,0].concat(o)):i.splice.apply(i,[f,p-f].concat(o)),t},C.$$arity=-3),e.defn(Ve,"$assoc",S=function(e){for(var t,r=this,n=0,a=r.length;n<a;n++)if(t=r[n],t.length&&t[0]["$=="](e))return t;return s},S.$$arity=1),e.defn(Ve,"$at",I=function(e){var t=this;return e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),e<0&&(e+=t.length),e<0||e>=t.length?s:t[e]},I.$$arity=1),e.defn(Ve,"$bsearch",O=function(){var e=this,t=O.$$p,r=t||s;if(O.$$p=null,r===s)return e.$enum_for("bsearch");for(var n,a,i,o=0,l=e.length,c=!1,u=s;o<l;){if(n=o+Math.floor((l-o)/2),a=e[n],!0===(i=r(a)))u=a,c=!0;else if(!1===i||i===s)c=!1;else if(i.$$is_number){if(0===i)return a;c=i<0}else e.$raise(We.get("TypeError"),"wrong argument type "+i.$class()+" (must be numeric, true, false or nil)");c?l=n:o=n+1}return u},O.$$arity=0),e.defn(Ve,"$cycle",T=function(n){var a,i,o,l,c=this,u=T.$$p,$=u||s;if(null==n&&(n=s),T.$$p=null,$===s)return(a=(i=c).$enum_for,a.$$p=(o=function(){var e,a=o.$$s||this;return n["$=="](s)?We.get("Float").$$scope.get("INFINITY"):(n=We.get("Opal")["$coerce_to!"](n,We.get("Integer"),"to_int"),(e=t(n,0))===s||null==e||e.$$is_boolean&&1!=e?0:r(a.$enumerator_size(),n))},o.$$s=c,o.$$arity=0,o),a).call(i,"cycle",n);if((a=!1!==(l=c["$empty?"]())&&l!==s&&null!=l?l:n["$=="](0))!==s&&null!=a&&(!a.$$is_boolean||1==a))return s;var f,p;if(n===s)for(;;)for(f=0,p=c.length;f<p;f++)e.yield1($,c[f]);else{if((n=We.get("Opal")["$coerce_to!"](n,We.get("Integer"),"to_int"))<=0)return c;for(;n>0;){for(f=0,p=c.length;f<p;f++)e.yield1($,c[f]);n--}}return c},T.$$arity=-1),e.defn(Ve,"$clear",P=function(){var e=this;return e.splice(0,e.length),e},P.$$arity=0),e.defn(Ve,"$count",M=function(t){var r,n,a=this,i=M.$$p,o=i||s,l=s,c=s;for(null==t&&(t=s),M.$$p=null,l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];return(r=!1!==(n=t)&&n!==s&&null!=n?n:o)===s||null==r||r.$$is_boolean&&1!=r?a.$size():(n=a,r=e.find_super_dispatcher(a,"count",M,!1),r.$$p=i,r).apply(n,l)},M.$$arity=-1),e.defn(Ve,"$initialize_copy",N=function(e){return this.$replace(e)},N.$$arity=1),e.defn(Ve,"$collect",B=function(){var t,r,n,a=this,i=B.$$p,o=i||s;if(B.$$p=null,o===s)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=a,n.$$arity=0,n),t).call(r,"collect");for(var l=[],c=0,u=a.length;c<u;c++){var $=e.yield1(o,a[c]);l.push($)}return l},B.$$arity=0),e.defn(Ve,"$collect!",R=function(){var t,r,n,a=this,i=R.$$p,o=i||s;if(R.$$p=null,o===s)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=a,n.$$arity=0,n),t).call(r,"collect!");for(var l=0,c=a.length;l<c;l++){var u=e.yield1(o,a[l]);a[l]=u}return a},R.$$arity=0),e.defn(Ve,"$combination",j=function(t){var r,n,a,i=this,o=j.$$p,l=o||s,c=s;if(j.$$p=null,c=We.get("Opal")["$coerce_to!"](t,We.get("Integer"),"to_int"),l===s)return(r=(n=i).$enum_for,r.$$p=(a=function(){return p((a.$$s||this).length,c)},a.$$s=i,a.$$arity=0,a),r).call(n,"combination",c);var u,$,f,d,h,_,g;if(0===c)e.yield1(l,[]);else if(1===c)for(u=0,$=i.length;u<$;u++)e.yield1(l,[i[u]]);else if(c===i.length)e.yield1(l,i.slice());else if(c>=0&&c<i.length){for(f=[],u=0;u<=c+1;u++)f.push(0);for(d=[],h=0,_=!1,f[0]=-1;!_;){for(d[h]=i[f[h+1]];h<c-1;)h++,g=f[h+1]=f[h]+1,d[h]=i[g];e.yield1(l,d.slice()),h++;do{_=0===h,f[h]++,h--}while(f[h+1]+c===i.length+h+1)}}return i},j.$$arity=1),e.defn(Ve,"$repeated_combination",F=function(t){function r(t,n,a,i){if(a.length==t){var o=a.slice();return void e.yield1(c,o)}for(var s=n;s<i.length;s++)a.push(i[s]),r(t,s,a,i),a.pop()}var n,a,i,o=this,l=F.$$p,c=l||s,u=s;return F.$$p=null,u=We.get("Opal")["$coerce_to!"](t,We.get("Integer"),"to_int"),c===s?(n=(a=o).$enum_for,n.$$p=(i=function(){return p((i.$$s||this).length+u-1,u)},i.$$s=o,i.$$arity=0,i),n).call(a,"repeated_combination",u):(u>=0&&r(u,0,[],o),o)},F.$$arity=1),e.defn(Ve,"$compact",D=function(){for(var e,t=this,r=[],n=0,a=t.length;n<a;n++)(e=t[n])!==s&&r.push(e);return r},D.$$arity=0),e.defn(Ve,"$compact!",L=function(){for(var e=this,t=e.length,r=0,n=e.length;r<n;r++)e[r]===s&&(e.splice(r,1),n--,r--);return e.length===t?s:e},L.$$arity=0),e.defn(Ve,"$concat",z=function(e){var t,r=this;e=(t=We.get("Array")["$==="](e))===s||null==t||t.$$is_boolean&&1!=t?We.get("Opal").$coerce_to(e,We.get("Array"),"to_ary").$to_a():e.$to_a();for(var n=0,a=e.length;n<a;n++)r.push(e[n]);return r},z.$$arity=1),e.defn(Ve,"$delete",q=function(t){var r=this,n=q.$$p,a=n||s;q.$$p=null;for(var i=r.length,o=0,l=i;o<l;o++)r[o]["$=="](t)&&(r.splice(o,1),l--,o--);return r.length===i?a!==s?e.yieldX(a,[]):s:t},q.$$arity=1),e.defn(Ve,"$delete_at",U=function(e){var t=this;if(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),e<0&&(e+=t.length),e<0||e>=t.length)return s;var r=t[e];return t.splice(e,1),r},U.$$arity=1),e.defn(Ve,"$delete_if",H=function(){var e,t,r,n=this,a=H.$$p,i=a||s;if(H.$$p=null,i===s)return(e=(t=n).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=n,r.$$arity=0,r),e).call(t,"delete_if");for(var o,l=0,c=n.length;l<c;l++)!1!==(o=i(n[l]))&&o!==s&&(n.splice(l,1),c--,l--);return n},H.$$arity=0),e.defn(Ve,"$drop",G=function(e){var t=this;return e<0&&t.$raise(We.get("ArgumentError")),t.slice(e)},G.$$arity=1),e.defn(Ve,"$dup",Y=function(){var t,r,n=this,a=Y.$$p,i=s,o=s;for(Y.$$p=null,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return n.$$class===e.Array&&n.$allocate.$$pristine&&n.$copy_instance_variables.$$pristine&&n.$initialize_dup.$$pristine?n.slice(0):(r=n,t=e.find_super_dispatcher(n,"dup",Y,!1),t.$$p=a,t).apply(r,i)},Y.$$arity=0),e.defn(Ve,"$each",Q=function(){var t,r,n,a=this,i=Q.$$p,o=i||s;if(Q.$$p=null,o===s)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=a,n.$$arity=0,n),t).call(r,"each");for(var l=0,c=a.length;l<c;l++){e.yield1(o,a[l])}return a},Q.$$arity=0),e.defn(Ve,"$each_index",V=function(){var t,r,n,a=this,i=V.$$p,o=i||s;if(V.$$p=null,o===s)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=a,n.$$arity=0,n),t).call(r,"each_index");for(var l=0,c=a.length;l<c;l++){e.yield1(o,l)}return a},V.$$arity=0),e.defn(Ve,"$empty?",X=function(){return 0===this.length},X.$$arity=0),e.defn(Ve,"$eql?",W=function(e){function t(e,r){var a,i,o,s;if(!r.$$is_array)return!1;if(r=r.$to_a(),e.length!==r.length)return!1;for(n[e.$object_id()]=!0,a=0,i=e.length;a<i;a++)if(o=e[a],s=r[a],o.$$is_array){if(s.$$is_array&&s.length!==o.length)return!1;if(!n.hasOwnProperty(o.$object_id())&&!t(o,s))return!1}else if(!o["$eql?"](s))return!1;return!0}var r=this,n={};return t(r,e)},W.$$arity=1),e.defn(Ve,"$fetch",J=function(e,t){var r=this,n=J.$$p,a=n||s;J.$$p=null;var i=e;return e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),e<0&&(e+=r.length),e>=0&&e<r.length?r[e]:a!==s?a(i):null!=t?t:void(0===r.length?r.$raise(We.get("IndexError"),"index "+i+" outside of array bounds: 0...0"):r.$raise(We.get("IndexError"),"index "+i+" outside of array bounds: -"+r.length+"..."+r.length))},J.$$arity=-2),e.defn(Ve,"$fill",K=function(t){var r,n,a,i=this,o=K.$$p,l=o||s,c=s,u=s,$=s,f=s,p=s,d=arguments.length,h=d-0;h<0&&(h=0),a=new Array(h);for(var _=0;_<d;_++)a[_-0]=arguments[_];K.$$p=null;var g,m;if(!1!==l&&l!==s&&null!=l?((r=a.length>2)===s||null==r||r.$$is_boolean&&1!=r||i.$raise(We.get("ArgumentError"),"wrong number of arguments ("+a.$length()+" for 0..2)"),n=a,r=e.to_ary(n),c=null==r[0]?s:r[0],u=null==r[1]?s:r[1]):((r=0==a.length)===s||null==r||r.$$is_boolean&&1!=r?(r=a.length>3)===s||null==r||r.$$is_boolean&&1!=r||i.$raise(We.get("ArgumentError"),"wrong number of arguments ("+a.$length()+" for 1..3)"):i.$raise(We.get("ArgumentError"),"wrong number of arguments (0 for 1..3)"),n=a,r=e.to_ary(n),$=null==r[0]?s:r[0],c=null==r[1]?s:r[1],u=null==r[2]?s:r[2]),(r=We.get("Range")["$==="](c))===s||null==r||r.$$is_boolean&&1!=r)if(!1!==c&&c!==s&&null!=c)if(f=We.get("Opal").$coerce_to(c,We.get("Integer"),"to_int"),(r=f<0)===s||null==r||r.$$is_boolean&&1!=r||(f+=i.length),(r=f<0)===s||null==r||r.$$is_boolean&&1!=r||(f=0),!1!==u&&u!==s&&null!=u){if(p=We.get("Opal").$coerce_to(u,We.get("Integer"),"to_int"),(r=0==p)!==s&&null!=r&&(!r.$$is_boolean||1==r))return i;p+=f}else p=i.length;else f=0,p=i.length;else if(!1!==u&&u!==s&&null!=u&&i.$raise(We.get("TypeError"),"length invalid with range"),f=We.get("Opal").$coerce_to(c.$begin(),We.get("Integer"),"to_int"),(r=f<0)===s||null==r||r.$$is_boolean&&1!=r||(f+=i.length),(r=f<0)===s||null==r||r.$$is_boolean&&1!=r||i.$raise(We.get("RangeError"),c.$inspect()+" out of range"),p=We.get("Opal").$coerce_to(c.$end(),We.get("Integer"),"to_int"),(r=p<0)===s||null==r||r.$$is_boolean&&1!=r||(p+=i.length),((r=c["$exclude_end?"]())===s||null==r||r.$$is_boolean&&1!=r)&&(p+=1),(r=p<=f)!==s&&null!=r&&(!r.$$is_boolean||1==r))return i;if((r=f>i.length)!==s&&null!=r&&(!r.$$is_boolean||1==r))for(g=i.length;g<p;g++)i[g]=s;if((r=p>i.length)===s||null==r||r.$$is_boolean&&1!=r||(i.length=p),!1!==l&&l!==s&&null!=l)for(i.length;f<p;f++)m=l(f),i[f]=m;else for(i.length;f<p;f++)i[f]=$;return i},K.$$arity=-1),e.defn(Ve,"$first",Z=function(e){var t=this;return null==e?0===t.length?s:t[0]:(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),e<0&&t.$raise(We.get("ArgumentError"),"negative array size"),t.slice(0,e))},Z.$$arity=-1),e.defn(Ve,"$flatten",ee=function(e){function t(e,n){var a,i,o,l,c=[];for(e=e.$to_a(),a=0,i=e.length;a<i;a++)if(o=e[a],We.get("Opal")["$respond_to?"](o,"to_ary"))if((l=o.$to_ary())!==s)switch(l.$$is_array||r.$raise(We.get("TypeError")),l===r&&r.$raise(We.get("ArgumentError")),n){case void 0:c=c.concat(t(l));break;case 0:c.push(l);break;default:c.push.apply(c,t(l,n-1))}else c.push(o);else c.push(o);return c}var r=this;return void 0!==e&&(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int")),f(t(r,e),r.$class())},ee.$$arity=-1),e.defn(Ve,"$flatten!",te=function(e){var t=this,r=t.$flatten(e);if(t.length==r.length){for(var n=0,a=t.length;n<a&&t[n]===r[n];n++);if(n==a)return s}return t.$replace(r),t},te.$$arity=-1),e.defn(Ve,"$hash",re=function(){var t,r,n,a=this,i=void 0==e.hash_ids,o=["A"],s=a.$object_id();try{if(i&&(e.hash_ids={}),e.hash_ids.hasOwnProperty(s))return"self";for(n in e.hash_ids)if(e.hash_ids.hasOwnProperty(n)&&(t=e.hash_ids[n],a["$eql?"](t)))return"self";for(e.hash_ids[s]=a,r=0;r<a.length;r++)t=a[r],o.push(t.$hash());return o.join(",")}finally{i&&delete e.hash_ids}},re.$$arity=0),e.defn(Ve,"$include?",ne=function(e){for(var t=this,r=0,n=t.length;r<n;r++)if(t[r]["$=="](e))return!0;return!1},ne.$$arity=1),e.defn(Ve,"$index",ae=function(e){var t=this,r=ae.$$p,n=r||s;ae.$$p=null;var a,i,o;if(null!=e){for(a=0,i=t.length;a<i;a++)if(t[a]["$=="](e))return a}else{if(n===s)return t.$enum_for("index");for(a=0,i=t.length;a<i;a++)if(!1!==(o=n(t[a]))&&o!==s)return a}return s},ae.$$arity=-1),e.defn(Ve,"$insert",ie=function(e,t){var r,n=this,a=arguments.length,i=a-1;i<0&&(i=0),r=new Array(i);for(var o=1;o<a;o++)r[o-1]=arguments[o];if(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),r.length>0){if(e<0&&(e+=n.length+1)<0&&n.$raise(We.get("IndexError"),e+" is out of bounds"),e>n.length)for(var l=n.length;l<e;l++)n.push(s);n.splice.apply(n,[e,0].concat(r))}return n},ie.$$arity=-2),e.defn(Ve,"$inspect",oe=function(){for(var e=this,t=[],r=e.$__id__(),n=0,a=e.length;n<a;n++){var i=e["$[]"](n);i.$__id__()===r?t.push("[...]"):t.push(i.$inspect())}return"["+t.join(", ")+"]"},oe.$$arity=0),e.defn(Ve,"$join",se=function(e){var t,r=this;if(null==u[","]&&(u[","]=s),null==e&&(e=s),(t=0===r.length)!==s&&null!=t&&(!t.$$is_boolean||1==t))return"";(t=e===s)===s||null==t||t.$$is_boolean&&1!=t||(e=u[","]);var n,a,i,o,l=[];for(n=0,a=r.length;n<a;n++)i=r[n],We.get("Opal")["$respond_to?"](i,"to_str")&&(o=i.$to_str())!==s?l.push(o.$to_s()):We.get("Opal")["$respond_to?"](i,"to_ary")&&(o=i.$to_ary(),o===r&&r.$raise(We.get("ArgumentError")),o!==s)?l.push(o.$join(e)):We.get("Opal")["$respond_to?"](i,"to_s")&&(o=i.$to_s())!==s?l.push(o):r.$raise(We.get("NoMethodError").$new(We.get("Opal").$inspect(i)+" doesn't respond to #to_str, #to_ary or #to_s","to_str"));return e===s?l.join(""):l.join(We.get("Opal")["$coerce_to!"](e,We.get("String"),"to_str").$to_s())},se.$$arity=-1),e.defn(Ve,"$keep_if",le=function(){var e,t,r,n=this,a=le.$$p,i=a||s;if(le.$$p=null,i===s)return(e=(t=n).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=n,r.$$arity=0,r),e).call(t,"keep_if");for(var o,l=0,c=n.length;l<c;l++)!1!==(o=i(n[l]))&&o!==s||(n.splice(l,1),c--,l--);return n},le.$$arity=0),e.defn(Ve,"$last",ce=function(e){var t=this;return null==e?0===t.length?s:t[t.length-1]:(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),e<0&&t.$raise(We.get("ArgumentError"),"negative array size"),e>t.length&&(e=t.length),t.slice(t.length-e,t.length))},ce.$$arity=-1),e.defn(Ve,"$length",ue=function(){return this.length},ue.$$arity=0),e.alias(Ve,"map","collect"),e.alias(Ve,"map!","collect!"),e.defn(Ve,"$permutation",$e=function(t){var r,n,a,i=this,o=$e.$$p,l=o||s,c=s,u=s;if($e.$$p=null,l===s)return(r=(n=i).$enum_for,r.$$p=(a=function(){var e=a.$$s||this;return d(e.length,void 0===t?e.length:t)},a.$$s=i,a.$$arity=0,a),r).call(n,"permutation",t);var $,f,p;if((t=void 0===t?i.length:We.get("Opal").$coerce_to(t,We.get("Integer"),"to_int"))<0||i.length<t);else if(0===t)e.yield1(l,[]);else if(1===t)for(var h=0;h<i.length;h++)e.yield1(l,[i[h]]);else c=We.get("Array").$new(t),u=We.get("Array").$new(i.length,!1),$=function(t,r,n,a,o){i=this;for(var s=0;s<i.length;s++)if(a["$[]"](s)["$!"]())if(r[n]=s,n<t-1)a[s]=!0,$.call(i,t,r,n+1,a,o),a[s]=!1;else{p=[];for(var l=0;l<r.length;l++)p.push(i[r[l]]);e.yield1(o,p)}},l!==s?(f=i.slice(),$.call(f,t,c,0,u,l)):$.call(i,t,c,0,u,l);return i},$e.$$arity=-1),e.defn(Ve,"$repeated_permutation",fe=function(t){function r(t,n,a){if(n.length==t){var i=n.slice();return void e.yield1(u,i)}for(var o=0;o<a.length;o++)n.push(a[o]),r(t,n,a),n.pop()}var a,i,o,l=this,c=fe.$$p,u=c||s,$=s;return fe.$$p=null,$=We.get("Opal")["$coerce_to!"](t,We.get("Integer"),"to_int"),u===s?(a=(i=l).$enum_for,a.$$p=(o=function(){var e,t=o.$$s||this;return(e=n($,0))===s||null==e||e.$$is_boolean&&1!=e?0:t.$size()["$**"]($)},o.$$s=l,o.$$arity=0,o),a).call(i,"repeated_permutation",$):(r($,[],l.slice()),l)},fe.$$arity=1),e.defn(Ve,"$pop",pe=function(e){var t,r=this;return(t=void 0===e)===s||null==t||t.$$is_boolean&&1!=t?(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),(t=e<0)===s||null==t||t.$$is_boolean&&1!=t||r.$raise(We.get("ArgumentError"),"negative array size"),(t=0===r.length)===s||null==t||t.$$is_boolean&&1!=t?(t=e>r.length)===s||null==t||t.$$is_boolean&&1!=t?r.splice(r.length-e,r.length):r.splice(0,r.length):[]):(t=0===r.length)===s||null==t||t.$$is_boolean&&1!=t?r.pop():s},pe.$$arity=-1),e.defn(Ve,"$product",de=function(t){var r,n=this,a=de.$$p,i=a||s,o=arguments.length,l=o-0;l<0&&(l=0),r=new Array(l);for(var c=0;c<o;c++)r[c-0]=arguments[c];de.$$p=null;var u,$,f,p,d=i!==s?null:[],h=r.length+1,_=new Array(h),g=new Array(h),m=new Array(h),y=1;for(m[0]=n,u=1;u<h;u++)m[u]=We.get("Opal").$coerce_to(r[u-1],We.get("Array"),"to_ary");for(u=0;u<h;u++){if(0===(p=m[u].length))return d||n;y*=p,y>2147483647&&n.$raise(We.get("RangeError"),"too big to product"),g[u]=p,_[u]=0}e:for(;;){for(f=[],u=0;u<h;u++)f.push(m[u][_[u]]);for(d?d.push(f):e.yield1(i,f),$=h-1,_[$]++;_[$]===g[$];){if(_[$]=0,--$<0)break e;_[$]++}}return d||n},de.$$arity=-1),e.defn(Ve,"$push",he=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=0,s=t.length;o<s;o++)r.push(t[o]);return r},he.$$arity=-1),e.defn(Ve,"$rassoc",_e=function(e){for(var t,r=this,n=0,a=r.length;n<a;n++)if(t=r[n],t.length&&void 0!==t[1]&&t[1]["$=="](e))return t;return s},_e.$$arity=1),e.defn(Ve,"$reject",ge=function(){var e,t,r,n=this,a=ge.$$p,i=a||s;if(ge.$$p=null,i===s)return(e=(t=n).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=n,r.$$arity=0,r),e).call(t,"reject");for(var o,l=[],c=0,u=n.length;c<u;c++)!1!==(o=i(n[c]))&&o!==s||l.push(n[c]);return l},ge.$$arity=0),e.defn(Ve,"$reject!",me=function(){var e,t,r,n,a=this,i=me.$$p,o=i||s,l=s;return me.$$p=null,o===s?(e=(t=a).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=a,r.$$arity=0,r),e).call(t,"reject!"):(l=a.$length(),(e=(n=a).$delete_if,e.$$p=o.$to_proc(),e).call(n),a.$length()["$=="](l)?s:a)},me.$$arity=0),e.defn(Ve,"$replace",ye=function(e){var t,r=this;return e=(t=We.get("Array")["$==="](e))===s||null==t||t.$$is_boolean&&1!=t?We.get("Opal").$coerce_to(e,We.get("Array"),"to_ary").$to_a():e.$to_a(),r.splice(0,r.length),r.push.apply(r,e),r},ye.$$arity=1),e.defn(Ve,"$reverse",ve=function(){return this.slice(0).reverse()},ve.$$arity=0),e.defn(Ve,"$reverse!",be=function(){return this.reverse()},be.$$arity=0),e.defn(Ve,"$reverse_each",xe=function(){var e,t,r,n,a=this,i=xe.$$p,o=i||s;return xe.$$p=null,o===s?(e=(t=a).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=a,r.$$arity=0,r),e).call(t,"reverse_each"):((e=(n=a.$reverse()).$each,e.$$p=o.$to_proc(),e).call(n),a)},xe.$$arity=0),e.defn(Ve,"$rindex",we=function(e){var t=this,r=we.$$p,n=r||s;we.$$p=null;var a,i;if(null!=e){for(a=t.length-1;a>=0&&!(a>=t.length);a--)if(t[a]["$=="](e))return a}else if(n!==s){for(a=t.length-1;a>=0&&!(a>=t.length);a--)if(!1!==(i=n(t[a]))&&i!==s)return a}else if(null==e)return t.$enum_for("rindex");return s},we.$$arity=-1),e.defn(Ve,"$rotate",Ae=function(e){var t=this;null==e&&(e=1),e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int");var r,n,a,i;return 1===t.length?t.slice():0===t.length?[]:(r=t.slice(),n=e%r.length,a=r.slice(n),i=r.slice(0,n),a.concat(i))},Ae.$$arity=-1),e.defn(Ve,"$rotate!",ke=function(e){var t=this,r=s;return null==e&&(e=1),0===t.length||1===t.length?t:(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),r=t.$rotate(e),t.$replace(r))},ke.$$arity=-1),function(t,r){function n(){}var a,i,o=n=l(t,null,"SampleRandom",n),c=o.$$proto,u=o.$$scope;c.rng=s,e.defn(o,"$initialize",a=function(e){return this.rng=e},a.$$arity=1),e.defn(o,"$rand",i=function(e){var t,r=this,n=s;return n=u.get("Opal").$coerce_to(r.rng.$rand(e),u.get("Integer"),"to_int"),(t=n<0)===s||null==t||t.$$is_boolean&&1!=t||r.$raise(u.get("RangeError"),"random value must be >= 0"),((t=n<e)===s||null==t||t.$$is_boolean&&1!=t)&&r.$raise(u.get("RangeError"),"random value must be less than Array size"),n},i.$$arity=1)}(We.base),e.defn(Ve,"$sample",Ee=function(e,t){var r,n=this,a=s,i=s;if((r=void 0===e)!==s&&null!=r&&(!r.$$is_boolean||1==r))return n.$at(We.get("Kernel").$rand(n.length));if((r=void 0===t)===s||null==r||r.$$is_boolean&&1!=r?(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),t=We.get("Opal").$coerce_to(t,We.get("Hash"),"to_hash")):(r=a=We.get("Opal")["$coerce_to?"](e,We.get("Hash"),"to_hash"))===s||null==r||r.$$is_boolean&&1!=r?(t=s,e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int")):(t=a,e=s),(r=!1!==e&&e!==s&&null!=e?e<0:e)===s||null==r||r.$$is_boolean&&1!=r||n.$raise(We.get("ArgumentError"),"count must be greater than 0"),!1!==t&&t!==s&&null!=t&&(i=t["$[]"]("random")),i=(r=!1!==i&&i!==s&&null!=i?i["$respond_to?"]("rand"):i)===s||null==r||r.$$is_boolean&&1!=r?We.get("Kernel"):We.get("SampleRandom").$new(i),!1===e||e===s||null==e)return n[i.$rand(n.length)];var o,l,c,u,$,f,p,d;switch(e>n.length&&(e=n.length),e){case 0:return[];case 1:return[n[i.$rand(n.length)]];case 2:return u=i.$rand(n.length),$=i.$rand(n.length),u===$&&($=0===u?u+1:u-1),[n[u],n[$]];default:if(n.length/e>3){for(o=!1,l=0,c=We.get("Array").$new(e),u=1,c[0]=i.$rand(n.length);u<e;){for(f=i.$rand(n.length),$=0;$<u;){for(;f===c[$];){if(++l>100){o=!0;break}f=i.$rand(n.length)}if(o)break;$++}if(o)break;c[u]=f,u++}if(!o){for(u=0;u<e;)c[u]=n[c[u]],u++;return c}}c=n.slice();for(var h=0;h<e;h++)p=i.$rand(n.length),d=c[h],c[h]=c[p],c[p]=d;return e===n.length?c:c["$[]"](0,e)}},Ee.$$arity=-1),e.defn(Ve,"$select",Ce=function(){var t,r,n,a=this,i=Ce.$$p,o=i||s;if(Ce.$$p=null,o===s)return(t=(r=a).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=a,n.$$arity=0,n),t).call(r,"select");for(var l,c,u=[],$=0,f=a.length;$<f;$++)l=a[$],!1!==(c=e.yield1(o,l))&&c!==s&&u.push(l);return u},Ce.$$arity=0),e.defn(Ve,"$select!",Se=function(){var e,t,r,n,a=this,i=Se.$$p,o=i||s;if(Se.$$p=null,o===s)return(e=(t=a).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=a,r.$$arity=0,r),e).call(t,"select!");var l=a.length;return(e=(n=a).$keep_if,e.$$p=o.$to_proc(),e).call(n),a.length===l?s:a},Se.$$arity=0),e.defn(Ve,"$shift",Ie=function(e){var t,r=this;return(t=void 0===e)===s||null==t||t.$$is_boolean&&1!=t?(e=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),(t=e<0)===s||null==t||t.$$is_boolean&&1!=t||r.$raise(We.get("ArgumentError"),"negative array size"),(t=0===r.length)===s||null==t||t.$$is_boolean&&1!=t?r.splice(0,e):[]):(t=0===r.length)===s||null==t||t.$$is_boolean&&1!=t?r.shift():s},Ie.$$arity=-1),e.alias(Ve,"size","length"),e.defn(Ve,"$shuffle",Oe=function(e){return this.$dup().$to_a()["$shuffle!"](e)},Oe.$$arity=-1),e.defn(Ve,"$shuffle!",Te=function(e){var t,r,n,a=this,i=a.length;for(void 0!==e&&(e=We.get("Opal")["$coerce_to?"](e,We.get("Hash"),"to_hash"))!==s&&(e=e["$[]"]("random"))!==s&&e["$respond_to?"]("rand")&&(t=e);i;)t?(r=t.$rand(i).$to_int(),r<0&&a.$raise(We.get("RangeError"),"random number too small "+r),r>=i&&a.$raise(We.get("RangeError"),"random number too big "+r)):r=Math.floor(Math.random()*i),n=a[--i],a[i]=a[r],a[r]=n;return a},Te.$$arity=-1),e.alias(Ve,"slice","[]"),e.defn(Ve,"$slice!",Pe=function(e,t){var r,n=this,a=s,i=s,o=s,l=s,c=s;if(a=s,(r=void 0===t)===s||null==r||r.$$is_boolean&&1!=r){if(c=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),(t=We.get("Opal").$coerce_to(t,We.get("Integer"),"to_int"))<0)return s;a=n["$[]"](c,t),c<0&&(c+=n.length),c+t>n.length&&(t=n.length-c),c<n.length&&c>=0&&n.splice(c,t)}else if((r=We.get("Range")["$==="](e))===s||null==r||r.$$is_boolean&&1!=r){if(c=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),c<0&&(c+=n.length),c<0||c>=n.length)return s;a=n[c],0===c?n.shift():n.splice(c,1)}else{i=e,a=n["$[]"](i),o=We.get("Opal").$coerce_to(i.$begin(),We.get("Integer"),"to_int"),l=We.get("Opal").$coerce_to(i.$end(),We.get("Integer"),"to_int"),o<0&&(o+=n.length),l<0?l+=n.length:l>=n.length&&(l=n.length-1,i.exclude&&(l+=1));var u=l-o;i.exclude?l-=1:u+=1,o<n.length&&o>=0&&l<n.length&&l>=0&&u>0&&n.splice(o,u)}return a},Pe.$$arity=-2),e.defn(Ve,"$sort",Me=function(){var e,r=this,n=Me.$$p,i=n||s;return Me.$$p=null,(e=r.length>1)===s||null==e||e.$$is_boolean&&1!=e?r:(i===s&&(i=function(e,t){return e["$<=>"](t)}),r.slice().sort(function(e,n){var o=i(e,n);return o===s&&r.$raise(We.get("ArgumentError"),"comparison of "+e.$inspect()+" with "+n.$inspect()+" failed"),t(o,0)?1:a(o,0)?-1:0}))},Me.$$arity=0),e.defn(Ve,"$sort!",Ne=function(){var e,t,r=this,n=Ne.$$p,a=n||s;Ne.$$p=null;var i;i=a!==s?(e=(t=r.slice()).$sort,e.$$p=a.$to_proc(),e).call(t):r.slice().$sort(),r.length=0;for(var o=0,l=i.length;o<l;o++)r.push(i[o]);return r},Ne.$$arity=0),e.defn(Ve,"$sort_by!",Be=function(){var e,t,r,n,a=this,i=Be.$$p,o=i||s;return Be.$$p=null,o===s?(e=(t=a).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=a,r.$$arity=0,r),e).call(t,"sort_by!"):a.$replace((e=(n=a).$sort_by,e.$$p=o.$to_proc(),e).call(n))},Be.$$arity=0),e.defn(Ve,"$take",Re=function(e){var t=this;return e<0&&t.$raise(We.get("ArgumentError")),t.slice(0,e)},Re.$$arity=1),e.defn(Ve,"$take_while",je=function(){var e=this,t=je.$$p,r=t||s;je.$$p=null;for(var n,a,i=[],o=0,l=e.length;o<l;o++){if(n=e[o],!1===(a=r(n))||a===s)return i;i.push(n)}return i},je.$$arity=0),e.defn(Ve,"$to_a",Fe=function(){return this},Fe.$$arity=0),e.alias(Ve,"to_ary","to_a"),e.defn(Ve,"$to_h",De=function(){var t,r,n,a,i=this,o=i.length,s=c([],{});for(t=0;t<o;t++)r=We.get("Opal")["$coerce_to?"](i[t],We.get("Array"),"to_ary"),r.$$is_array||i.$raise(We.get("TypeError"),"wrong element type "+r.$class()+" at "+t+" (expected array)"),2!==r.length&&i.$raise(We.get("ArgumentError"),"wrong array length at "+t+" (expected 2, was "+r.$length()+")"),n=r[0],a=r[1],e.hash_put(s,n,a);return s},De.$$arity=0),e.alias(Ve,"to_s","inspect"),e.defn(Ve,"$transpose",Le=function(){var e,t,r,n=this,a=s,i=s;return(e=n["$empty?"]())===s||null==e||e.$$is_boolean&&1!=e?(a=[],i=s,(e=(t=n).$each,e.$$p=(r=function(e){var t,n,o,l=r.$$s||this;return null==e&&(e=s),e=(t=We.get("Array")["$==="](e))===s||null==t||t.$$is_boolean&&1!=t?We.get("Opal").$coerce_to(e,We.get("Array"),"to_ary").$to_a():e.$to_a(),!1!==(t=i)&&t!==s&&null!=t||(i=e.length),(t=e.length["$!="](i))===s||null==t||t.$$is_boolean&&1!=t||l.$raise(We.get("IndexError"),"element size differs ("+e.length+" should be "+i),(t=(n=e.length).$times,t.$$p=(o=function(t){var r,n,i,l=(o.$$s,s);return null==t&&(t=s),r=t,n=a,l=!1!==(i=n["$[]"](r))&&i!==s&&null!=i?i:n["$[]="](r,[]),l["$<<"](e.$at(t))},o.$$s=l,o.$$arity=1,o),t).call(n)},r.$$s=n,r.$$arity=1,r),e).call(t),a):[]},Le.$$arity=0),e.defn(Ve,"$uniq",ze=function(){var t=this,r=ze.$$p,n=r||s;ze.$$p=null;var a,i,o,l,u=c([],{});if(n===s)for(a=0,i=t.length;a<i;a++)o=t[a],void 0===e.hash_get(u,o)&&e.hash_put(u,o,o);else for(a=0,i=t.length;a<i;a++)o=t[a],l=e.yield1(n,o),void 0===e.hash_get(u,l)&&e.hash_put(u,l,o);return f(u.$values(),t.$class())},ze.$$arity=0),e.defn(Ve,"$uniq!",qe=function(){var t=this,r=qe.$$p,n=r||s;qe.$$p=null;var a,i,o,l,u=t.length,$=c([],{});for(a=0,i=u;a<i;a++)o=t[a],l=n===s?o:e.yield1(n,o),void 0!==e.hash_get($,l)?(t.splice(a,1),i--,a--):e.hash_put($,l,o);return t.length===u?s:t},qe.$$arity=0),e.defn(Ve,"$unshift",Ue=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];for(var o=t.length-1;o>=0;o--)r.unshift(t[o]);return r},Ue.$$arity=-1),e.defn(Ve,"$values_at",He=function(e){var t,r,n,a,i=this,o=s,l=arguments.length,c=l-0;c<0&&(c=0),a=new Array(c);for(var u=0;u<l;u++)a[u-0]=arguments[u];return o=[],(t=(r=a).$each,t.$$p=(n=function(e){var t,r,a,i=n.$$s||this,l=s,c=s,u=s;return null==e&&(e=s),(t=e["$kind_of?"](We.get("Range")))===s||null==t||t.$$is_boolean&&1!=t?(u=We.get("Opal").$coerce_to(e,We.get("Integer"),"to_int"),o["$<<"](i.$at(u))):(l=We.get("Opal").$coerce_to(e.$last(),We.get("Integer"),"to_int"),(c=We.get("Opal").$coerce_to(e.$first(),We.get("Integer"),"to_int"))<0?(c+=i.length,s):(l<0&&(l+=i.length),e["$exclude_end?"]()&&l--,l<c?s:(t=(r=c).$upto,t.$$p=(a=function(e){var t=a.$$s||this;return null==e&&(e=s),o["$<<"](t.$at(e))},a.$$s=i,a.$$arity=1,a),t).call(r,l)))},n.$$s=i,n.$$arity=1,n),t).call(r),o},He.$$arity=-1),e.defn(Ve,"$zip",Ge=function(e){var t,r,n=this,a=Ge.$$p,i=a||s,o=arguments.length,l=o-0;l<0&&(l=0),r=new Array(l);for(var c=0;c<o;c++)r[c-0]=arguments[c];Ge.$$p=null;var u,$,f,p,d,h=[],_=n.length;for(p=0,d=r.length;p<d;p++)$=r[p],$.$$is_array||($.$$is_enumerator?$.$size()===1/0?r[p]=$.$take(_):r[p]=$.$to_a():r[p]=(!1!==(t=We.get("Opal")["$coerce_to?"]($,We.get("Array"),"to_ary"))&&t!==s&&null!=t?t:We.get("Opal")["$coerce_to!"]($,We.get("Enumerator"),"each")).$to_a());for(f=0;f<_;f++){for(u=[n[f]],p=0,d=r.length;p<d;p++)$=r[p][f],null==$&&($=s),u[p+1]=$;h[f]=u}if(i!==s){for(f=0;f<_;f++)i(h[f]);return s}return h},Ge.$$arity=-1),e.defs(Ve,"$inherited",Ye=function(e){e.$$proto.$to_a=function(){return this.slice(0,this.length)}},Ye.$$arity=1),e.defn(Ve,"$instance_variables",Qe=function(){var t,r,n,a,i,o=this,l=Qe.$$p,c=s,u=s;for(Qe.$$p=null,c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];return(t=(r=(i=o,a=e.find_super_dispatcher(o,"instance_variables",Qe,!1),a.$$p=l,a).apply(i,c)).$reject,t.$$p=(n=function(e){var t;n.$$s;return null==e&&(e=s),!1!==(t=/^@\d+$/.test(e))&&t!==s&&null!=t?t:e["$=="]("@length")},n.$$s=o,n.$$arity=1,n),t).call(r)},Qe.$$arity=0),We.get("Opal").$pristine(Ve,"allocate","copy_instance_variables","initialize_dup")}(o.base,Array)},Opal.modules["corelib/hash"]=function(e){var t=e.top,r=e,n=e.nil,a=(e.breaker,e.slice,e.klass);return e.add_stubs(["$require","$include","$coerce_to?","$[]","$merge!","$allocate","$raise","$==","$coerce_to!","$lambda?","$abs","$arity","$call","$enum_for","$size","$inspect","$flatten","$eql?","$default","$to_proc","$dup","$===","$default_proc","$default_proc=","$default=","$alias_method"]),t.$require("corelib/enumerable"),function(t,r){function i(){}var o,s,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K=i=a(t,null,"Hash",i),Z=K.$$proto,ee=K.$$scope;K.$include(ee.get("Enumerable")),Z.$$is_hash=!0,e.defs(K,"$[]",o=function(e){var t,r=this,a=arguments.length,i=a-0;i<0&&(i=0),t=new Array(i);for(var o=0;o<a;o++)t[o-0]=arguments[o];var s,l,c=t.length;if(1===c){if((s=ee.get("Opal")["$coerce_to?"](t["$[]"](0),ee.get("Hash"),"to_hash"))!==n)return r.$allocate()["$merge!"](s);for(t=ee.get("Opal")["$coerce_to?"](t["$[]"](0),ee.get("Array"),"to_ary"),t===n&&r.$raise(ee.get("ArgumentError"),"odd number of arguments for Hash"),c=t.length,s=r.$allocate(),l=0;l<c;l++)if(t[l].$$is_array)switch(t[l].length){case 1:s.$store(t[l][0],n);break;case 2:s.$store(t[l][0],t[l][1]);break;default:r.$raise(ee.get("ArgumentError"),"invalid number of elements ("+t[l].length+" for 1..2)")}return s}for(c%2!=0&&r.$raise(ee.get("ArgumentError"),"odd number of arguments for Hash"),s=r.$allocate(),l=0;l<c;l+=2)s.$store(t[l],t[l+1]);return s},o.$$arity=-1),e.defs(K,"$allocate",s=function(){var t=this,r=new t.$$alloc;return e.hash_init(r),r.$$none=n,r.$$proc=n,r},s.$$arity=0),e.defs(K,"$try_convert",l=function(e){return ee.get("Opal")["$coerce_to?"](e,ee.get("Hash"),"to_hash")},l.$$arity=1),e.defn(K,"$initialize",c=function(e){var t=this,r=c.$$p,a=r||n;return c.$$p=null,void 0!==e&&a!==n&&t.$raise(ee.get("ArgumentError"),"wrong number of arguments (1 for 0)"),t.$$none=void 0===e?n:e,t.$$proc=a,t},c.$$arity=-1),e.defn(K,"$==",u=function(t){var r=this;if(r===t)return!0;if(!t.$$is_hash)return!1;if(r.$$keys.length!==t.$$keys.length)return!1;for(var n,a,i,o=0,s=r.$$keys,l=s.length;o<l;o++)if(n=s[o],n.$$is_string?(a=r.$$smap[n],i=t.$$smap[n]):(a=n.value,i=e.hash_get(t,n.key)),void 0===i||!a["$eql?"](i))return!1;return!0},u.$$arity=1),e.defn(K,"$[]",$=function(t){var r=this,n=e.hash_get(r,t);return void 0!==n?n:r.$default(t)},$.$$arity=1),e.defn(K,"$[]=",f=function(t,r){var n=this;return e.hash_put(n,t,r),r},f.$$arity=2),e.defn(K,"$assoc",p=function(e){for(var t,r=this,a=0,i=r.$$keys,o=i.length;a<o;a++)if(t=i[a],t.$$is_string){if(t["$=="](e))return[t,r.$$smap[t]]}else if(t.key["$=="](e))return[t.key,t.value];return n},p.$$arity=1),
e.defn(K,"$clear",d=function(){var t=this;return e.hash_init(t),t},d.$$arity=0),e.defn(K,"$clone",h=function(){var t=this,r=new t.$$class.$$alloc;return e.hash_init(r),e.hash_clone(t,r),r},h.$$arity=0),e.defn(K,"$default",_=function(e){var t=this;return void 0!==e&&t.$$proc!==n&&void 0!==t.$$proc?t.$$proc.$call(t,e):void 0===t.$$none?n:t.$$none},_.$$arity=-1),e.defn(K,"$default=",g=function(e){var t=this;return t.$$proc=n,t.$$none=e,e},g.$$arity=1),e.defn(K,"$default_proc",m=function(){var e=this;return void 0!==e.$$proc?e.$$proc:n},m.$$arity=0),e.defn(K,"$default_proc=",y=function(e){var t=this;return e!==n&&(e=ee.get("Opal")["$coerce_to!"](e,ee.get("Proc"),"to_proc"),e["$lambda?"]()&&2!==e.$arity().$abs()&&t.$raise(ee.get("TypeError"),"default_proc takes two arguments")),t.$$none=n,t.$$proc=e,e},y.$$arity=1),e.defn(K,"$delete",v=function(t){var r=this,a=v.$$p,i=a||n;v.$$p=null;var o=e.hash_delete(r,t);return void 0!==o?o:i!==n?i.$call(t):n},v.$$arity=1),e.defn(K,"$delete_if",b=function(){var t,r,a,i=this,o=b.$$p,s=o||n;if(b.$$p=null,!1===s||s===n||null==s)return(t=(r=i).$enum_for,t.$$p=(a=function(){return(a.$$s||this).$size()},a.$$s=i,a.$$arity=0,a),t).call(r,"delete_if");for(var l,c,u,$=0,f=i.$$keys,p=f.length;$<p;$++)l=f[$],l.$$is_string?c=i.$$smap[l]:(c=l.value,l=l.key),!1!==(u=s(l,c))&&u!==n&&void 0!==e.hash_delete(i,l)&&(p--,$--);return i},b.$$arity=0),e.alias(K,"dup","clone"),e.defn(K,"$each",x=function(){var t,r,a,i=this,o=x.$$p,s=o||n;if(x.$$p=null,!1===s||s===n||null==s)return(t=(r=i).$enum_for,t.$$p=(a=function(){return(a.$$s||this).$size()},a.$$s=i,a.$$arity=0,a),t).call(r,"each");for(var l,c,u=0,$=i.$$keys,f=$.length;u<f;u++)l=$[u],l.$$is_string?c=i.$$smap[l]:(c=l.value,l=l.key),e.yield1(s,[l,c]);return i},x.$$arity=0),e.defn(K,"$each_key",w=function(){var e,t,r,a=this,i=w.$$p,o=i||n;if(w.$$p=null,!1===o||o===n||null==o)return(e=(t=a).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=a,r.$$arity=0,r),e).call(t,"each_key");for(var s,l=0,c=a.$$keys,u=c.length;l<u;l++)s=c[l],o(s.$$is_string?s:s.key);return a},w.$$arity=0),e.alias(K,"each_pair","each"),e.defn(K,"$each_value",A=function(){var e,t,r,a=this,i=A.$$p,o=i||n;if(A.$$p=null,!1===o||o===n||null==o)return(e=(t=a).$enum_for,e.$$p=(r=function(){return(r.$$s||this).$size()},r.$$s=a,r.$$arity=0,r),e).call(t,"each_value");for(var s,l=0,c=a.$$keys,u=c.length;l<u;l++)s=c[l],o(s.$$is_string?a.$$smap[s]:s.value);return a},A.$$arity=0),e.defn(K,"$empty?",k=function(){return 0===this.$$keys.length},k.$$arity=0),e.alias(K,"eql?","=="),e.defn(K,"$fetch",E=function(t,r){var a=this,i=E.$$p,o=i||n;E.$$p=null;var s=e.hash_get(a,t);return void 0!==s?s:o!==n?o(t):void 0!==r?r:a.$raise(ee.get("KeyError"),"key not found: "+t.$inspect())},E.$$arity=-2),e.defn(K,"$flatten",C=function(e){var t=this;null==e&&(e=1),e=ee.get("Opal")["$coerce_to!"](e,ee.get("Integer"),"to_int");for(var r,n,a=[],i=0,o=t.$$keys,s=o.length;i<s;i++)if(r=o[i],r.$$is_string?n=t.$$smap[r]:(n=r.value,r=r.key),a.push(r),n.$$is_array){if(1===e){a.push(n);continue}a=a.concat(n.$flatten(e-2))}else a.push(n);return a},C.$$arity=-1),e.defn(K,"$has_key?",S=function(t){var r=this;return void 0!==e.hash_get(r,t)},S.$$arity=1),e.defn(K,"$has_value?",I=function(e){for(var t,r=this,n=0,a=r.$$keys,i=a.length;n<i;n++)if(t=a[n],(t.$$is_string?r.$$smap[t]:t.value)["$=="](e))return!0;return!1},I.$$arity=1),e.defn(K,"$hash",O=function(){var t,r,n=this,a=void 0===e.hash_ids,i=n.$object_id(),o=["Hash"];try{if(a&&(e.hash_ids={}),e.hash_ids.hasOwnProperty(i))return"self";for(t in e.hash_ids)if(e.hash_ids.hasOwnProperty(t)&&(r=e.hash_ids[t],n["$eql?"](r)))return"self";e.hash_ids[i]=n;for(var s=0,l=n.$$keys,c=l.length;s<c;s++)t=l[s],t.$$is_string?o.push([t,n.$$smap[t].$hash()]):o.push([t.key_hash,t.value.$hash()]);return o.sort().join()}finally{a&&delete e.hash_ids}},O.$$arity=0),e.alias(K,"include?","has_key?"),e.defn(K,"$index",T=function(e){for(var t,r,a=this,i=0,o=a.$$keys,s=o.length;i<s;i++)if(t=o[i],t.$$is_string?r=a.$$smap[t]:(r=t.value,t=t.key),r["$=="](e))return t;return n},T.$$arity=1),e.defn(K,"$indexes",P=function(t){var r,n=this,a=arguments.length,i=a-0;i<0&&(i=0),r=new Array(i);for(var o=0;o<a;o++)r[o-0]=arguments[o];for(var s,l,c=[],u=0,$=r.length;u<$;u++)s=r[u],l=e.hash_get(n,s),void 0!==l?c.push(l):c.push(n.$default());return c},P.$$arity=-1),e.alias(K,"indices","indexes");var te;return e.defn(K,"$inspect",M=function(){var e=this,t=void 0===te,r=e.$object_id(),n=[];try{if(t&&(te={}),te.hasOwnProperty(r))return"{...}";te[r]=!0;for(var a,i,o=0,s=e.$$keys,l=s.length;o<l;o++)a=s[o],a.$$is_string?i=e.$$smap[a]:(i=a.value,a=a.key),n.push(a.$inspect()+"=>"+i.$inspect());return"{"+n.join(", ")+"}"}finally{t&&(te=void 0)}},M.$$arity=0),e.defn(K,"$invert",N=function(){for(var t,r,n=this,a=e.hash(),i=0,o=n.$$keys,s=o.length;i<s;i++)t=o[i],t.$$is_string?r=n.$$smap[t]:(r=t.value,t=t.key),e.hash_put(a,r,t);return a},N.$$arity=0),e.defn(K,"$keep_if",B=function(){var t,r,a,i=this,o=B.$$p,s=o||n;if(B.$$p=null,!1===s||s===n||null==s)return(t=(r=i).$enum_for,t.$$p=(a=function(){return(a.$$s||this).$size()},a.$$s=i,a.$$arity=0,a),t).call(r,"keep_if");for(var l,c,u,$=0,f=i.$$keys,p=f.length;$<p;$++)l=f[$],l.$$is_string?c=i.$$smap[l]:(c=l.value,l=l.key),!1!==(u=s(l,c))&&u!==n||void 0!==e.hash_delete(i,l)&&(p--,$--);return i},B.$$arity=0),e.alias(K,"key","index"),e.alias(K,"key?","has_key?"),e.defn(K,"$keys",R=function(){for(var e,t=this,r=[],n=0,a=t.$$keys,i=a.length;n<i;n++)e=a[n],e.$$is_string?r.push(e):r.push(e.key);return r},R.$$arity=0),e.defn(K,"$length",j=function(){return this.$$keys.length},j.$$arity=0),e.alias(K,"member?","has_key?"),e.defn(K,"$merge",F=function(e){var t,r,a=this,i=F.$$p,o=i||n;return F.$$p=null,(t=(r=a.$dup())["$merge!"],t.$$p=o.$to_proc(),t).call(r,e)},F.$$arity=1),e.defn(K,"$merge!",D=function(t){var r=this,a=D.$$p,i=a||n;D.$$p=null,ee.get("Hash")["$==="](t)||(t=ee.get("Opal")["$coerce_to!"](t,ee.get("Hash"),"to_hash"));var o,s,l,c,u=t.$$keys,$=u.length;if(i===n){for(o=0;o<$;o++)s=u[o],s.$$is_string?c=t.$$smap[s]:(c=s.value,s=s.key),e.hash_put(r,s,c);return r}for(o=0;o<$;o++)s=u[o],s.$$is_string?c=t.$$smap[s]:(c=s.value,s=s.key),l=e.hash_get(r,s),void 0!==l?e.hash_put(r,s,i(s,l,c)):e.hash_put(r,s,c);return r},D.$$arity=1),e.defn(K,"$rassoc",L=function(e){for(var t,r,a=this,i=0,o=a.$$keys,s=o.length;i<s;i++)if(t=o[i],t.$$is_string?r=a.$$smap[t]:(r=t.value,t=t.key),r["$=="](e))return[t,r];return n},L.$$arity=1),e.defn(K,"$rehash",z=function(){var t=this;return e.hash_rehash(t),t},z.$$arity=0),e.defn(K,"$reject",q=function(){var t,r,a,i=this,o=q.$$p,s=o||n;if(q.$$p=null,!1===s||s===n||null==s)return(t=(r=i).$enum_for,t.$$p=(a=function(){return(a.$$s||this).$size()},a.$$s=i,a.$$arity=0,a),t).call(r,"reject");for(var l,c,u,$=e.hash(),f=0,p=i.$$keys,d=p.length;f<d;f++)l=p[f],l.$$is_string?c=i.$$smap[l]:(c=l.value,l=l.key),!1!==(u=s(l,c))&&u!==n||e.hash_put($,l,c);return $},q.$$arity=0),e.defn(K,"$reject!",U=function(){var t,r,a,i=this,o=U.$$p,s=o||n;if(U.$$p=null,!1===s||s===n||null==s)return(t=(r=i).$enum_for,t.$$p=(a=function(){return(a.$$s||this).$size()},a.$$s=i,a.$$arity=0,a),t).call(r,"reject!");for(var l,c,u,$=!1,f=0,p=i.$$keys,d=p.length;f<d;f++)l=p[f],l.$$is_string?c=i.$$smap[l]:(c=l.value,l=l.key),!1!==(u=s(l,c))&&u!==n&&void 0!==e.hash_delete(i,l)&&($=!0,d--,f--);return $?i:n},U.$$arity=0),e.defn(K,"$replace",H=function(t){var r,a,i=this;t=ee.get("Opal")["$coerce_to!"](t,ee.get("Hash"),"to_hash"),e.hash_init(i);for(var o,s,l=0,c=t.$$keys,u=c.length;l<u;l++)o=c[l],o.$$is_string?s=t.$$smap[o]:(s=o.value,o=o.key),e.hash_put(i,o,s);return(r=t.$default_proc())===n||null==r||r.$$is_boolean&&1!=r?(r=[t.$default()],a=i,a["$default="].apply(a,r),r[r.length-1]):(r=[t.$default_proc()],a=i,a["$default_proc="].apply(a,r),r[r.length-1]),i},H.$$arity=1),e.defn(K,"$select",G=function(){var t,r,a,i=this,o=G.$$p,s=o||n;if(G.$$p=null,!1===s||s===n||null==s)return(t=(r=i).$enum_for,t.$$p=(a=function(){return(a.$$s||this).$size()},a.$$s=i,a.$$arity=0,a),t).call(r,"select");for(var l,c,u,$=e.hash(),f=0,p=i.$$keys,d=p.length;f<d;f++)l=p[f],l.$$is_string?c=i.$$smap[l]:(c=l.value,l=l.key),!1!==(u=s(l,c))&&u!==n&&e.hash_put($,l,c);return $},G.$$arity=0),e.defn(K,"$select!",Y=function(){var t,r,a,i=this,o=Y.$$p,s=o||n;if(Y.$$p=null,!1===s||s===n||null==s)return(t=(r=i).$enum_for,t.$$p=(a=function(){return(a.$$s||this).$size()},a.$$s=i,a.$$arity=0,a),t).call(r,"select!");for(var l,c,u,$=n,f=0,p=i.$$keys,d=p.length;f<d;f++)l=p[f],l.$$is_string?c=i.$$smap[l]:(c=l.value,l=l.key),!1!==(u=s(l,c))&&u!==n||(void 0!==e.hash_delete(i,l)&&(d--,f--),$=i);return $},Y.$$arity=0),e.defn(K,"$shift",Q=function(){var t,r=this,a=r.$$keys;return a.length>0?(t=a[0],t=t.$$is_string?t:t.key,[t,e.hash_delete(r,t)]):r.$default(n)},Q.$$arity=0),e.alias(K,"size","length"),K.$alias_method("store","[]="),e.defn(K,"$to_a",V=function(){for(var e,t,r=this,n=[],a=0,i=r.$$keys,o=i.length;a<o;a++)e=i[a],e.$$is_string?t=r.$$smap[e]:(t=e.value,e=e.key),n.push([e,t]);return n},V.$$arity=0),e.defn(K,"$to_h",X=function(){var t=this;if(t.$$class===e.Hash)return t;var r=new e.Hash.$$alloc;return e.hash_init(r),e.hash_clone(t,r),r},X.$$arity=0),e.defn(K,"$to_hash",W=function(){return this},W.$$arity=0),e.alias(K,"to_s","inspect"),e.alias(K,"update","merge!"),e.alias(K,"value?","has_value?"),e.alias(K,"values_at","indexes"),e.defn(K,"$values",J=function(){for(var e,t=this,r=[],n=0,a=t.$$keys,i=a.length;n<i;n++)e=a[n],e.$$is_string?r.push(t.$$smap[e]):r.push(e.value);return r},J.$$arity=0),n&&"values"}(r.base)},Opal.modules["corelib/number"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function o(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function s(e,t){return"number"==typeof e&&"number"==typeof t?e<=t:e["$<="](t)}function l(e,t){return"number"==typeof e&&"number"==typeof t?e>=t:e["$>="](t)}var c=e.top,u=e,$=e.nil,f=(e.breaker,e.slice,e.klass);return e.add_stubs(["$require","$bridge","$raise","$class","$Float","$respond_to?","$coerce_to!","$__coerced__","$===","$!","$>","$**","$new","$<","$to_f","$==","$nan?","$infinite?","$enum_for","$+","$-","$gcd","$lcm","$/","$frexp","$to_i","$ldexp","$rationalize","$*","$<<","$to_r","$-@","$size","$<=","$>="]),c.$require("corelib/numeric"),function(c,u){function p(){}var d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne,ae,ie,oe,se,le,ce,ue,$e,fe,pe,de,he,_e,ge,me,ye,ve,be,xe,we,Ae=p=f(c,u,"Number",p),ke=(Ae.$$proto,Ae.$$scope);ke.get("Opal").$bridge(Ae,Number),Number.prototype.$$is_number=!0,e.defn(Ae,"$coerce",d=function(e){var t=this;if(e===$)t.$raise(ke.get("TypeError"),"can't convert "+e.$class()+" into Float");else{if(e.$$is_string)return[t.$Float(e),t];if(e["$respond_to?"]("to_f"))return[ke.get("Opal")["$coerce_to!"](e,ke.get("Float"),"to_f"),t];if(e.$$is_number)return[e,t];t.$raise(ke.get("TypeError"),"can't convert "+e.$class()+" into Float")}},d.$$arity=1),e.defn(Ae,"$__id__",h=function(){return 2*this+1},h.$$arity=0),e.alias(Ae,"object_id","__id__"),e.defn(Ae,"$+",_=function(e){var t=this;return e.$$is_number?t+e:t.$__coerced__("+",e)},_.$$arity=1),e.defn(Ae,"$-",g=function(e){var t=this;return e.$$is_number?t-e:t.$__coerced__("-",e)},g.$$arity=1),e.defn(Ae,"$*",m=function(e){var t=this;return e.$$is_number?t*e:t.$__coerced__("*",e)},m.$$arity=1),e.defn(Ae,"$/",y=function(e){var t=this;return e.$$is_number?t/e:t.$__coerced__("/",e)},y.$$arity=1),e.alias(Ae,"fdiv","/"),e.defn(Ae,"$%",v=function(e){var t=this;return e.$$is_number?e==-1/0?e:0!=e?e<0||t<0?(t%e+e)%e:t%e:void t.$raise(ke.get("ZeroDivisionError"),"divided by 0"):t.$__coerced__("%",e)},v.$$arity=1),e.defn(Ae,"$&",b=function(e){var t=this;return e.$$is_number?t&e:t.$__coerced__("&",e)},b.$$arity=1),e.defn(Ae,"$|",x=function(e){var t=this;return e.$$is_number?t|e:t.$__coerced__("|",e)},x.$$arity=1),e.defn(Ae,"$^",w=function(e){var t=this;return e.$$is_number?t^e:t.$__coerced__("^",e)},w.$$arity=1),e.defn(Ae,"$<",A=function(e){var t=this;return e.$$is_number?t<e:t.$__coerced__("<",e)},A.$$arity=1),e.defn(Ae,"$<=",k=function(e){var t=this;return e.$$is_number?t<=e:t.$__coerced__("<=",e)},k.$$arity=1),e.defn(Ae,"$>",E=function(e){var t=this;return e.$$is_number?t>e:t.$__coerced__(">",e)},E.$$arity=1),e.defn(Ae,"$>=",C=function(e){var t=this;return e.$$is_number?t>=e:t.$__coerced__(">=",e)},C.$$arity=1);var Ee=function(e,t){return t.$$is_number?isNaN(e)||isNaN(t)?$:e>t?1:e<t?-1:0:e.$__coerced__("<=>",t)};e.defn(Ae,"$<=>",S=function(t){var r=this;try{return Ee(r,t)}catch(t){if(!e.rescue(t,[ke.get("ArgumentError")]))throw t;try{return $}finally{e.pop_exception()}}},S.$$arity=1),e.defn(Ae,"$<<",I=function(e){var t=this;return e=ke.get("Opal")["$coerce_to!"](e,ke.get("Integer"),"to_int"),e>0?t<<e:t>>-e},I.$$arity=1),e.defn(Ae,"$>>",O=function(e){var t=this;return e=ke.get("Opal")["$coerce_to!"](e,ke.get("Integer"),"to_int"),e>0?t>>e:t<<-e},O.$$arity=1),e.defn(Ae,"$[]",T=function(e){var t=this;return e=ke.get("Opal")["$coerce_to!"](e,ke.get("Integer"),"to_int"),e<0?0:e>=32?t<0?1:0:t>>e&1},T.$$arity=1),e.defn(Ae,"$+@",P=function(){return+this},P.$$arity=0),e.defn(Ae,"$-@",M=function(){return-this},M.$$arity=0),e.defn(Ae,"$~",N=function(){return~this},N.$$arity=0),e.defn(Ae,"$**",B=function(e){var n,a,i,o=this;return(n=ke.get("Integer")["$==="](e))===$||null==n||n.$$is_boolean&&1!=n?(n=(a=r(o,0))?!1!==(i=ke.get("Float")["$==="](e))&&i!==$&&null!=i?i:ke.get("Rational")["$==="](e):r(o,0))===$||null==n||n.$$is_boolean&&1!=n?(n=null!=e.$$is_number)===$||null==n||n.$$is_boolean&&1!=n?o.$__coerced__("**",e):Math.pow(o,e):ke.get("Complex").$new(o,0)["$**"](e.$to_f()):(n=!1!==(a=ke.get("Integer")["$==="](o)["$!"]())&&a!==$&&null!=a?a:t(e,0))===$||null==n||n.$$is_boolean&&1!=n?ke.get("Rational").$new(o,1)["$**"](e):Math.pow(o,e)},B.$$arity=1),e.defn(Ae,"$==",R=function(e){var t=this;return e.$$is_number?t==Number(e):!!e["$respond_to?"]("==")&&e["$=="](t)},R.$$arity=1),e.defn(Ae,"$abs",j=function(){var e=this;return Math.abs(e)},j.$$arity=0),e.defn(Ae,"$abs2",F=function(){var e=this;return Math.abs(e*e)},F.$$arity=0),e.defn(Ae,"$angle",D=function(){var e,t=this;return(e=t["$nan?"]())===$||null==e||e.$$is_boolean&&1!=e?0==t?1/t>0?0:Math.PI:t<0?Math.PI:0:t},D.$$arity=0),e.alias(Ae,"arg","angle"),e.alias(Ae,"phase","angle"),e.defn(Ae,"$bit_length",L=function(){var e,t=this;if(((e=ke.get("Integer")["$==="](t))===$||null==e||e.$$is_boolean&&1!=e)&&t.$raise(ke.get("NoMethodError").$new("undefined method `bit_length` for "+t+":Float","bit_length")),0===t||-1===t)return 0;for(var r=0,n=t<0?~t:t;0!=n;)r+=1,n>>>=1;return r},L.$$arity=0),e.defn(Ae,"$ceil",z=function(){var e=this;return Math.ceil(e)},z.$$arity=0),e.defn(Ae,"$chr",q=function(e){var t=this;return String.fromCharCode(t)},q.$$arity=-1),e.defn(Ae,"$denominator",U=function(){var t,r,n=this,a=U.$$p,i=$,o=$;for(U.$$p=null,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return(t=!1!==(r=n["$nan?"]())&&r!==$&&null!=r?r:n["$infinite?"]())===$||null==t||t.$$is_boolean&&1!=t?(r=n,t=e.find_super_dispatcher(n,"denominator",U,!1),t.$$p=a,t).apply(r,i):1},U.$$arity=0),e.defn(Ae,"$downto",H=function(e){var r,i,o,s=this,l=H.$$p,c=l||$;if(H.$$p=null,c===$)return(r=(i=s).$enum_for,r.$$p=(o=function(){var r,i=o.$$s||this;return((r=ke.get("Numeric")["$==="](e))===$||null==r||r.$$is_boolean&&1!=r)&&i.$raise(ke.get("ArgumentError"),"comparison of "+i.$class()+" with "+e.$class()+" failed"),(r=t(e,i))===$||null==r||r.$$is_boolean&&1!=r?n(a(i,e),1):0},o.$$s=s,o.$$arity=0,o),r).call(i,"downto",e);e.$$is_number||s.$raise(ke.get("ArgumentError"),"comparison of "+s.$class()+" with "+e.$class()+" failed");for(var u=s;u>=e;u--)c(u);return s},H.$$arity=1),e.alias(Ae,"eql?","=="),e.defn(Ae,"$equal?",G=function(e){var t,r=this;return!1!==(t=r["$=="](e))&&t!==$&&null!=t?t:isNaN(r)&&isNaN(e)},G.$$arity=1),e.defn(Ae,"$even?",Y=function(){return this%2==0},Y.$$arity=0),e.defn(Ae,"$floor",Q=function(){var e=this;return Math.floor(e)},Q.$$arity=0),e.defn(Ae,"$gcd",V=function(e){var t,r=this;((t=ke.get("Integer")["$==="](e))===$||null==t||t.$$is_boolean&&1!=t)&&r.$raise(ke.get("TypeError"),"not an integer");for(var n=Math.abs(r),a=Math.abs(e);n>0;){var i=n;n=a%n,a=i}return a},V.$$arity=1),e.defn(Ae,"$gcdlcm",X=function(e){var t=this;return[t.$gcd(),t.$lcm()]},X.$$arity=1),e.defn(Ae,"$integer?",W=function(){return this%1==0},W.$$arity=0),e.defn(Ae,"$is_a?",J=function(t){var r,n,a=this,i=J.$$p,o=$,s=$;for(J.$$p=null,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return!((r=(n=t["$=="](ke.get("Fixnum")))?ke.get("Integer")["$==="](a):t["$=="](ke.get("Fixnum")))===$||null==r||r.$$is_boolean&&1!=r)||(!((r=(n=t["$=="](ke.get("Integer")))?ke.get("Integer")["$==="](a):t["$=="](ke.get("Integer")))===$||null==r||r.$$is_boolean&&1!=r)||(!((r=(n=t["$=="](ke.get("Float")))?ke.get("Float")["$==="](a):t["$=="](ke.get("Float")))===$||null==r||r.$$is_boolean&&1!=r)||(n=a,r=e.find_super_dispatcher(a,"is_a?",J,!1),r.$$p=i,r).apply(n,o)))},J.$$arity=1),e.alias(Ae,"kind_of?","is_a?"),e.defn(Ae,"$instance_of?",K=function(t){var r,n,a=this,i=K.$$p,o=$,s=$;for(K.$$p=null,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return!((r=(n=t["$=="](ke.get("Fixnum")))?ke.get("Integer")["$==="](a):t["$=="](ke.get("Fixnum")))===$||null==r||r.$$is_boolean&&1!=r)||(!((r=(n=t["$=="](ke.get("Integer")))?ke.get("Integer")["$==="](a):t["$=="](ke.get("Integer")))===$||null==r||r.$$is_boolean&&1!=r)||(!((r=(n=t["$=="](ke.get("Float")))?ke.get("Float")["$==="](a):t["$=="](ke.get("Float")))===$||null==r||r.$$is_boolean&&1!=r)||(n=a,r=e.find_super_dispatcher(a,"instance_of?",K,!1),r.$$p=i,r).apply(n,o)))},K.$$arity=1),e.defn(Ae,"$lcm",Z=function(e){var t,r=this;return((t=ke.get("Integer")["$==="](e))===$||null==t||t.$$is_boolean&&1!=t)&&r.$raise(ke.get("TypeError"),"not an integer"),0==r||0==e?0:Math.abs(r*e/r.$gcd(e))},Z.$$arity=1),e.alias(Ae,"magnitude","abs"),e.alias(Ae,"modulo","%"),e.defn(Ae,"$next",ee=function(){return this+1},ee.$$arity=0),e.defn(Ae,"$nonzero?",te=function(){var e=this;return 0==e?$:e},te.$$arity=0),e.defn(Ae,"$numerator",re=function(){var t,r,n=this,a=re.$$p,i=$,o=$;for(re.$$p=null,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return(t=!1!==(r=n["$nan?"]())&&r!==$&&null!=r?r:n["$infinite?"]())===$||null==t||t.$$is_boolean&&1!=t?(r=n,t=e.find_super_dispatcher(n,"numerator",re,!1),t.$$p=a,t).apply(r,i):n},re.$$arity=0),e.defn(Ae,"$odd?",ne=function(){return this%2!=0},ne.$$arity=0),e.defn(Ae,"$ord",ae=function(){return this},ae.$$arity=0),e.defn(Ae,"$pred",ie=function(){return this-1},ie.$$arity=0),e.defn(Ae,"$quo",oe=function(t){var r,n,a=this,o=oe.$$p,s=$,l=$;for(oe.$$p=null,s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];return(r=ke.get("Integer")["$==="](a))===$||null==r||r.$$is_boolean&&1!=r?i(a,t):(n=a,r=e.find_super_dispatcher(a,"quo",oe,!1),r.$$p=o,r).apply(n,s)},oe.$$arity=1),e.defn(Ae,"$rationalize",se=function(t){var r,n,i=this,s=$,l=$;return arguments.length>1&&i.$raise(ke.get("ArgumentError"),"wrong number of arguments ("+arguments.length+" for 0..1)"),(r=ke.get("Integer")["$==="](i))===$||null==r||r.$$is_boolean&&1!=r?(r=i["$infinite?"]())===$||null==r||r.$$is_boolean&&1!=r?(r=i["$nan?"]())===$||null==r||r.$$is_boolean&&1!=r?(r=null==t)===$||null==r||r.$$is_boolean&&1!=r?i.$to_r().$rationalize(t):(n=ke.get("Math").$frexp(i),r=e.to_ary(n),s=null==r[0]?$:r[0],l=null==r[1]?$:r[1],s=ke.get("Math").$ldexp(s,ke.get("Float").$$scope.get("MANT_DIG")).$to_i(),l=a(l,ke.get("Float").$$scope.get("MANT_DIG")),ke.get("Rational").$new(o(2,s),1["$<<"](a(1,l))).$rationalize(ke.get("Rational").$new(1,1["$<<"](a(1,l))))):i.$raise(ke.get("FloatDomainError"),"NaN"):i.$raise(ke.get("FloatDomainError"),"Infinity"):ke.get("Rational").$new(i,1)},se.$$arity=-1),e.defn(Ae,"$round",le=function(o){var c,u,f=this,p=$;if((c=ke.get("Integer")["$==="](f))===$||null==c||c.$$is_boolean&&1!=c){if(u=f["$nan?"](),(c=!1!==u&&u!==$&&null!=u?null==o:u)===$||null==c||c.$$is_boolean&&1!=c||f.$raise(ke.get("FloatDomainError"),"NaN"),o=ke.get("Opal")["$coerce_to!"](o||0,ke.get("Integer"),"to_int"),(c=s(o,0))===$||null==c||c.$$is_boolean&&1!=c){if(o["$=="](0))return Math.round(f);if((c=!1!==(u=f["$nan?"]())&&u!==$&&null!=u?u:f["$infinite?"]())!==$&&null!=c&&(!c.$$is_boolean||1==c))return f}else(c=f["$nan?"]())===$||null==c||c.$$is_boolean&&1!=c?(c=f["$infinite?"]())===$||null==c||c.$$is_boolean&&1!=c||f.$raise(ke.get("FloatDomainError"),"Infinity"):f.$raise(ke.get("RangeError"),"NaN");return u=ke.get("Math").$frexp(f),c=e.to_ary(u),null==c[0]?$:c[0],p=null==c[1]?$:c[1],(c=l(o,a(n(ke.get("Float").$$scope.get("DIG"),2),function(){return(u=t(p,0))===$||null==u||u.$$is_boolean&&1!=u?a(i(p,3),1):i(p,4)}())))===$||null==c||c.$$is_boolean&&1!=c?(c=r(o,function(){return(u=t(p,0))===$||null==u||u.$$is_boolean&&1!=u?i(p,4):n(i(p,3),1)}()["$-@"]()))===$||null==c||c.$$is_boolean&&1!=c?Math.round(f*Math.pow(10,o))/Math.pow(10,o):0:f}if((c=null==o)!==$&&null!=c&&(!c.$$is_boolean||1==c))return f;if(u=ke.get("Float")["$==="](o),(c=!1!==u&&u!==$&&null!=u?o["$infinite?"]():u)===$||null==c||c.$$is_boolean&&1!=c||f.$raise(ke.get("RangeError"),"Infinity"),o=ke.get("Opal")["$coerce_to!"](o,ke.get("Integer"),"to_int"),(c=r(o,ke.get("Integer").$$scope.get("MIN")))===$||null==c||c.$$is_boolean&&1!=c||f.$raise(ke.get("RangeError"),"out of bounds"),(c=o>=0)!==$&&null!=c&&(!c.$$is_boolean||1==c))return f;if(.415241*(o=o["$-@"]())-.125>f.$size())return 0;var d=Math.pow(10,o),h=Math.floor((Math.abs(h)+d/2)/d)*d;return f<0?-h:h},le.$$arity=-1),e.defn(Ae,"$step",ce=function(e,t){var r,n=this,a=ce.$$p,i=a||$;if(null==t&&(t=1),ce.$$p=null,!1===i||i===$||null==i)return n.$enum_for("step",e,t);(r=0==t)===$||null==r||r.$$is_boolean&&1!=r||n.$raise(ke.get("ArgumentError"),"step cannot be 0");var o=n;if(e===1/0||e===-1/0)return i(o),n;if(t>0)for(;o<=e;)i(o),o+=t;else for(;o>=e;)i(o),o+=t;return n},ce.$$arity=-2),e.alias(Ae,"succ","next"),e.defn(Ae,"$times",ue=function(){var e,t,r,n=this,a=ue.$$p,i=a||$;if(ue.$$p=null,!1===i||i===$||null==i)return(e=(t=n).$enum_for,e.$$p=(r=function(){return r.$$s||this},r.$$s=n,r.$$arity=0,r),e).call(t,"times");for(var o=0;o<n;o++)i(o);return n},ue.$$arity=0),e.defn(Ae,"$to_f",$e=function(){return this},$e.$$arity=0),e.defn(Ae,"$to_i",fe=function(){var e=this;return parseInt(e,10)},fe.$$arity=0),e.alias(Ae,"to_int","to_i"),e.defn(Ae,"$to_r",pe=function(){var t,r,n=this,i=$,s=$;return(t=ke.get("Integer")["$==="](n))===$||null==t||t.$$is_boolean&&1!=t?(r=ke.get("Math").$frexp(n),t=e.to_ary(r),i=null==t[0]?$:t[0],s=null==t[1]?$:t[1],i=ke.get("Math").$ldexp(i,ke.get("Float").$$scope.get("MANT_DIG")).$to_i(),s=a(s,ke.get("Float").$$scope.get("MANT_DIG")),o(i,ke.get("Float").$$scope.get("RADIX")["$**"](s)).$to_r()):ke.get("Rational").$new(n,1)},pe.$$arity=0),e.defn(Ae,"$to_s",de=function(e){var n,a,i=this;return null==e&&(e=10),(n=!1!==(a=r(e,2))&&a!==$&&null!=a?a:t(e,36))===$||null==n||n.$$is_boolean&&1!=n||i.$raise(ke.get("ArgumentError"),"base must be between 2 and 36"),i.toString(e)},de.$$arity=-1),e.alias(Ae,"truncate","to_i"),e.alias(Ae,"inspect","to_s"),e.defn(Ae,"$divmod",he=function(t){var r,n,a=this,i=he.$$p,o=$,s=$;for(he.$$p=null,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return(r=!1!==(n=a["$nan?"]())&&n!==$&&null!=n?n:t["$nan?"]())===$||null==r||r.$$is_boolean&&1!=r?(r=a["$infinite?"]())===$||null==r||r.$$is_boolean&&1!=r?(n=a,r=e.find_super_dispatcher(a,"divmod",he,!1),r.$$p=i,r).apply(n,o):a.$raise(ke.get("FloatDomainError"),"Infinity"):a.$raise(ke.get("FloatDomainError"),"NaN")},he.$$arity=1),e.defn(Ae,"$upto",_e=function(e){var t,i,o,s=this,l=_e.$$p,c=l||$;if(_e.$$p=null,c===$)return(t=(i=s).$enum_for,t.$$p=(o=function(){var t,i=o.$$s||this;return((t=ke.get("Numeric")["$==="](e))===$||null==t||t.$$is_boolean&&1!=t)&&i.$raise(ke.get("ArgumentError"),"comparison of "+i.$class()+" with "+e.$class()+" failed"),(t=r(e,i))===$||null==t||t.$$is_boolean&&1!=t?n(a(e,i),1):0},o.$$s=s,o.$$arity=0,o),t).call(i,"upto",e);e.$$is_number||s.$raise(ke.get("ArgumentError"),"comparison of "+s.$class()+" with "+e.$class()+" failed");for(var u=s;u<=e;u++)c(u);return s},_e.$$arity=1),e.defn(Ae,"$zero?",ge=function(){return 0==this},ge.$$arity=0),e.defn(Ae,"$size",me=function(){return 4},me.$$arity=0),e.defn(Ae,"$nan?",ye=function(){var e=this;return isNaN(e)},ye.$$arity=0),e.defn(Ae,"$finite?",ve=function(){var e=this;return e!=1/0&&e!=-1/0&&!isNaN(e)},ve.$$arity=0),e.defn(Ae,"$infinite?",be=function(){var e=this;return e==1/0?1:e==-1/0?-1:$},be.$$arity=0),e.defn(Ae,"$positive?",xe=function(){var e=this;return e==1/0||1/e>0},xe.$$arity=0),e.defn(Ae,"$negative?",we=function(){var e=this;return e==-1/0||1/e<0},we.$$arity=0)}(u.base,u.get("Numeric")),e.cdecl(u,"Fixnum",u.get("Number")),function(t,r){function n(){}var a,i=n=f(t,r,"Integer",n),o=(i.$$proto,i.$$scope);e.defs(i,"$===",a=function(e){return!!e.$$is_number&&e%1==0},a.$$arity=1),e.cdecl(o,"MAX",Math.pow(2,30)-1),e.cdecl(o,"MIN",-Math.pow(2,30))}(u.base,u.get("Numeric")),function(t,r){function n(){}var a,i,o=n=f(t,r,"Float",n),s=(o.$$proto,o.$$scope);return e.defs(o,"$===",a=function(e){return!!e.$$is_number},a.$$arity=1),e.cdecl(s,"INFINITY",1/0),e.cdecl(s,"MAX",Number.MAX_VALUE),e.cdecl(s,"MIN",Number.MIN_VALUE),e.cdecl(s,"NAN",NaN),e.cdecl(s,"DIG",15),e.cdecl(s,"MANT_DIG",53),e.cdecl(s,"RADIX",2),(i=void 0!==Number.EPSILON)===$||null==i||i.$$is_boolean&&1!=i?e.cdecl(s,"EPSILON",2.220446049250313e-16):e.cdecl(s,"EPSILON",Number.EPSILON)}(u.base,u.get("Numeric"))},Opal.modules["corelib/range"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e<=t:e["$<="](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}var a=e.top,i=e,o=e.nil,s=(e.breaker,e.slice,e.klass);return e.add_stubs(["$require","$include","$attr_reader","$<=>","$raise","$include?","$<=","$<","$enum_for","$upto","$to_proc","$succ","$!","$==","$===","$exclude_end?","$eql?","$begin","$end","$-","$abs","$to_i","$inspect","$[]"]),a.$require("corelib/enumerable"),function(a,i){function l(){}var c,u,$,f,p,d,h,_,g,m,y,v,b,x=l=s(a,null,"Range",l),w=x.$$proto,A=x.$$scope;return w.begin=w.exclude=w.end=o,x.$include(A.get("Enumerable")),w.$$is_range=!0,x.$attr_reader("begin","end"),e.defn(x,"$initialize",c=function(e,t,r){var n,a=this;return null==r&&(r=!1),((n=e["$<=>"](t))===o||null==n||n.$$is_boolean&&1!=n)&&a.$raise(A.get("ArgumentError")),a.begin=e,a.end=t,a.exclude=r},c.$$arity=-3),e.defn(x,"$==",u=function(e){var t=this;return!!e.$$is_range&&(t.exclude===e.exclude&&t.begin==e.begin&&t.end==e.end)},u.$$arity=1),e.defn(x,"$===",$=function(e){return this["$include?"](e)},$.$$arity=1),e.defn(x,"$cover?",f=function(e){var n,a,i=this;return n=t(i.begin,e),!1!==n&&n!==o&&null!=n?function(){return(a=i.exclude)===o||null==a||a.$$is_boolean&&1!=a?t(e,i.end):r(e,i.end)}():n},f.$$arity=1),e.defn(x,"$each",p=function(){var t,n,a,i=this,s=p.$$p,l=s||o,c=o,u=o;if(p.$$p=null,l===o)return i.$enum_for("each");var $,f;if(i.begin.$$is_number&&i.end.$$is_number){for(i.begin%1==0&&i.end%1==0||i.$raise(A.get("TypeError"),"can't iterate from Float"),$=i.begin,f=i.end+function(){return(t=i.exclude)===o||null==t||t.$$is_boolean&&1!=t?1:0}();$<f;$++)l($);return i}if(i.begin.$$is_string&&i.end.$$is_string)return(t=(n=i.begin).$upto,t.$$p=l.$to_proc(),t).call(n,i.end,i.exclude),i;for(c=i.begin,u=i.end;(a=r(c,u))!==o&&null!=a&&(!a.$$is_boolean||1==a);)e.yield1(l,c),c=c.$succ();return a=i.exclude["$!"](),(t=!1!==a&&a!==o&&null!=a?c["$=="](u):a)===o||null==t||t.$$is_boolean&&1!=t||e.yield1(l,c),i},p.$$arity=0),e.defn(x,"$eql?",d=function(e){var t,r,n=this;return!((t=A.get("Range")["$==="](e))===o||null==t||t.$$is_boolean&&1!=t)&&(r=n.exclude["$==="](e["$exclude_end?"]()),t=!1!==r&&r!==o&&null!=r?n.begin["$eql?"](e.$begin()):r,!1!==t&&t!==o&&null!=t?n.end["$eql?"](e.$end()):t)},d.$$arity=1),e.defn(x,"$exclude_end?",h=function(){return this.exclude},h.$$arity=0),e.alias(x,"first","begin"),e.alias(x,"include?","cover?"),e.alias(x,"last","end"),e.defn(x,"$max",_=function(){var t,r,n=this,a=_.$$p,i=a||o,s=o,l=o;for(_.$$p=null,s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];return i!==o?(r=n,t=e.find_super_dispatcher(n,"max",_,!1),t.$$p=a,t).apply(r,s):n.exclude?n.end-1:n.end},_.$$arity=0),e.alias(x,"member?","cover?"),e.defn(x,"$min",g=function(){var t,r,n=this,a=g.$$p,i=a||o,s=o,l=o;for(g.$$p=null,s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];return i!==o?(r=n,t=e.find_super_dispatcher(n,"min",g,!1),t.$$p=a,t).apply(r,s):n.begin},g.$$arity=0),e.alias(x,"member?","include?"),e.defn(x,"$size",m=function(){var e,t,a=this,i=o,s=o,l=o;return i=a.begin,s=a.end,(e=a.exclude)===o||null==e||e.$$is_boolean&&1!=e||(s=n(s,1)),t=A.get("Numeric")["$==="](i),(e=!1!==t&&t!==o&&null!=t?A.get("Numeric")["$==="](s):t)===o||null==e||e.$$is_boolean&&1!=e?o:(e=r(s,i))===o||null==e||e.$$is_boolean&&1!=e?(l=A.get("Float").$$scope.get("INFINITY"),(e=!1!==(t=l["$=="](i.$abs()))&&t!==o&&null!=t?t:s.$abs()["$=="](l))===o||null==e||e.$$is_boolean&&1!=e?(Math.abs(s-i)+1).$to_i():l):0},m.$$arity=0),e.defn(x,"$step",y=function(e){var t=this;return null==e&&(e=1),t.$raise(A.get("NotImplementedError"))},y.$$arity=-1),e.defn(x,"$to_s",v=function(){var e=this;return e.begin.$inspect()+(e.exclude?"...":"..")+e.end.$inspect()},v.$$arity=0),e.alias(x,"inspect","to_s"),e.defn(x,"$marshal_load",b=function(e){var t=this;return t.begin=e["$[]"]("begin"),t.end=e["$[]"]("end"),t.exclude=e["$[]"]("excl")},b.$$arity=1),o&&"marshal_load"}(i.base)},Opal.modules["corelib/proc"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice),a=e.klass;return e.add_stubs(["$raise","$coerce_to!"]),function(t,i){function o(){}var s,l,c,u,$,f,p,d,h,_,g=o=a(t,i,"Proc",o),m=g.$$proto,y=g.$$scope;return m.$$is_proc=!0,m.$$is_lambda=!1,e.defs(g,"$new",s=function(){var e=this,t=s.$$p,n=t||r;return s.$$p=null,!1!==n&&n!==r&&null!=n||e.$raise(y.get("ArgumentError"),"tried to create a Proc object without a block"),n},s.$$arity=0),e.defn(g,"$call",l=function(t){var n,a=this,i=l.$$p,o=i||r,s=arguments.length,c=s-0;c<0&&(c=0),n=new Array(c);for(var u=0;u<s;u++)n[u-0]=arguments[u];l.$$p=null,o!==r&&(a.$$p=o);var $,f=a.$$brk;if(f)try{$=a.$$is_lambda?a.apply(null,n):e.yieldX(a,n)}catch(e){if(e===f)return f.$v;throw e}else $=a.$$is_lambda?a.apply(null,n):e.yieldX(a,n);return $},l.$$arity=-1),e.alias(g,"[]","call"),e.alias(g,"===","call"),e.alias(g,"yield","call"),e.defn(g,"$to_proc",c=function(){return this},c.$$arity=0),e.defn(g,"$lambda?",u=function(){return!!this.$$is_lambda},u.$$arity=0),e.defn(g,"$arity",$=function(){var e=this;return e.$$is_curried?-1:e.$$arity},$.$$arity=0),e.defn(g,"$source_location",f=function(){return this.$$is_curried,r},f.$$arity=0),e.defn(g,"$binding",p=function(){var e=this;return e.$$is_curried&&e.$raise(y.get("ArgumentError"),"Can't create Binding"),r},p.$$arity=0),e.defn(g,"$parameters",d=function(){var e=this;if(e.$$is_curried)return[["rest"]];if(e.$$parameters){if(e.$$is_lambda)return e.$$parameters;var t,r,n=[];for(t=0,r=e.$$parameters.length;t<r;t++){var a=e.$$parameters[t];"req"===a[0]&&(a=["opt",a[1]]),n.push(a)}return n}return[]},d.$$arity=0),e.defn(g,"$curry",h=function(e){function t(){var a,i=n.call(arguments),o=i.length;return o>e&&r.$$is_lambda&&!r.$$is_curried&&r.$raise(y.get("ArgumentError"),"wrong number of arguments ("+o+" for "+e+")"),o>=e?r.$call.apply(r,i):(a=function(){return t.apply(null,i.concat(n.call(arguments)))},a.$$is_lambda=r.$$is_lambda,a.$$is_curried=!0,a)}var r=this;return void 0===e?e=r.length:(e=y.get("Opal")["$coerce_to!"](e,y.get("Integer"),"to_int"),
r.$$is_lambda&&e!==r.length&&r.$raise(y.get("ArgumentError"),"wrong number of arguments ("+e+" for "+r.length+")")),t.$$is_lambda=r.$$is_lambda,t.$$is_curried=!0,t},h.$$arity=-1),e.defn(g,"$dup",_=function(){var e=this,t=e.$$original_proc||e,r=function(){return t.apply(this,arguments)};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r},_.$$arity=0),e.alias(g,"clone","dup")}(t.base,Function)},Opal.modules["corelib/method"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice),a=e.klass;return e.add_stubs(["$attr_reader","$class","$arity","$new","$name"]),function(t,i){function o(){}var s,l,c,u,$,f,p,d=o=a(t,null,"Method",o),h=d.$$proto,_=d.$$scope;h.method=h.receiver=h.owner=h.name=r,d.$attr_reader("owner","receiver","name"),e.defn(d,"$initialize",s=function(e,t,r){var n=this;return n.receiver=e,n.owner=e.$class(),n.name=r,n.method=t},s.$$arity=3),e.defn(d,"$arity",l=function(){return this.method.$arity()},l.$$arity=0),e.defn(d,"$parameters",c=function(){return this.method.$$parameters},c.$$arity=0),e.defn(d,"$call",u=function(e){var t,n=this,a=u.$$p,i=a||r,o=arguments.length,s=o-0;s<0&&(s=0),t=new Array(s);for(var l=0;l<o;l++)t[l-0]=arguments[l];return u.$$p=null,n.method.$$p=i,n.method.apply(n.receiver,t)},u.$$arity=-1),e.alias(d,"[]","call"),e.defn(d,"$unbind",$=function(){var e=this;return _.get("UnboundMethod").$new(e.owner,e.method,e.name)},$.$$arity=0),e.defn(d,"$to_proc",f=function(){var e=this,t=function(){return e.$call.apply(e,n.call(arguments))};return t.$$unbound=e.method,t.$$is_lambda=!0,t},f.$$arity=0),e.defn(d,"$inspect",p=function(){var e=this;return"#<Method: "+e.receiver.$class()+"#"+e.name+">"},p.$$arity=0)}(t.base),function(t,n){function i(){}var o,s,l,c,u,$=i=a(t,null,"UnboundMethod",i),f=$.$$proto,p=$.$$scope;return f.method=f.name=f.owner=r,$.$attr_reader("owner","name"),e.defn($,"$initialize",o=function(e,t,r){var n=this;return n.owner=e,n.method=t,n.name=r},o.$$arity=3),e.defn($,"$arity",s=function(){return this.method.$arity()},s.$$arity=0),e.defn($,"$parameters",l=function(){return this.method.$$parameters},l.$$arity=0),e.defn($,"$bind",c=function(e){var t=this;return p.get("Method").$new(e,t.method,t.name)},c.$$arity=1),e.defn($,"$inspect",u=function(){var e=this;return"#<UnboundMethod: "+e.owner.$name()+"#"+e.name+">"},u.$$arity=0),r&&"inspect"}(t.base)},Opal.modules["corelib/variables"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.gvars),a=e.hash2;return e.add_stubs(["$new"]),n["&"]=n["~"]=n["`"]=n["'"]=r,n.LOADED_FEATURES=n['"']=e.loaded_features,n.LOAD_PATH=n[":"]=[],n["/"]="\n",n[","]=r,e.cdecl(t,"ARGV",[]),e.cdecl(t,"ARGF",t.get("Object").$new()),e.cdecl(t,"ENV",a([],{})),n.VERBOSE=!1,n.DEBUG=!1,n.SAFE=0},Opal.modules["opal/regexp_anchors"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.module);return e.add_stubs(["$==","$new"]),function(t){var a,i=a=n(t,"Opal"),o=(i.$$proto,i.$$scope);e.cdecl(o,"REGEXP_START",function(){return o.get("RUBY_ENGINE")["$=="]("opal")?"^":r}()),e.cdecl(o,"REGEXP_END",function(){return o.get("RUBY_ENGINE")["$=="]("opal")?"$":r}()),e.cdecl(o,"FORBIDDEN_STARTING_IDENTIFIER_CHARS","\\u0001-\\u002F\\u003A-\\u0040\\u005B-\\u005E\\u0060\\u007B-\\u007F"),e.cdecl(o,"FORBIDDEN_ENDING_IDENTIFIER_CHARS","\\u0001-\\u0020\\u0022-\\u002F\\u003A-\\u003E\\u0040\\u005B-\\u005E\\u0060\\u007B-\\u007F"),e.cdecl(o,"INLINE_IDENTIFIER_REGEXP",o.get("Regexp").$new("[^"+o.get("FORBIDDEN_STARTING_IDENTIFIER_CHARS")+"]*[^"+o.get("FORBIDDEN_ENDING_IDENTIFIER_CHARS")+"]")),e.cdecl(o,"FORBIDDEN_CONST_NAME_CHARS","\\u0001-\\u0020\\u0021-\\u002F\\u003B-\\u003F\\u0040\\u005B-\\u005E\\u0060\\u007B-\\u007F"),e.cdecl(o,"CONST_NAME_REGEXP",o.get("Regexp").$new(o.get("REGEXP_START")+"(::)?[A-Z][^"+o.get("FORBIDDEN_CONST_NAME_CHARS")+"]*"+o.get("REGEXP_END")))}(t.base)},Opal.modules["opal/mini"]=function(e){var t=e.top;e.nil,e.breaker,e.slice;return e.add_stubs(["$require"]),t.$require("opal/base"),t.$require("corelib/nil"),t.$require("corelib/boolean"),t.$require("corelib/string"),t.$require("corelib/comparable"),t.$require("corelib/enumerable"),t.$require("corelib/enumerator"),t.$require("corelib/array"),t.$require("corelib/hash"),t.$require("corelib/number"),t.$require("corelib/range"),t.$require("corelib/proc"),t.$require("corelib/method"),t.$require("corelib/regexp"),t.$require("corelib/variables"),t.$require("opal/regexp_anchors")},Opal.modules["corelib/string/inheritance"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}var a=e.top,i=e,o=e.nil,s=(e.breaker,e.slice,e.klass),l=e.gvars;return e.add_stubs(["$require","$new","$allocate","$initialize","$to_proc","$__send__","$class","$clone","$respond_to?","$==","$inspect","$+","$*","$map","$split","$enum_for","$each_line","$to_a","$%","$-"]),a.$require("corelib/string"),function(t,r){function n(){}var a,i=n=s(t,null,"String",n),l=(i.$$proto,i.$$scope);e.defs(i,"$inherited",a=function(e){var t=o;t=l.get("Class").$new(l.get("String").$$scope.get("Wrapper")),e.$$proto=t.$$proto,e.$$proto.$$class=e,e.$$alloc=t.$$alloc,e.$$parent=l.get("String").$$scope.get("Wrapper"),e.$allocate=t.$allocate,e.$new=t.$new},a.$$arity=1)}(i.base),function(a,i){function c(){}var u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S=c=s(a,null,"Wrapper",c),I=S.$$proto;S.$$scope;return I.literal=o,I.$$is_string=!0,e.defs(S,"$allocate",u=function(t){var r,n,a=this,i=(u.$$p,o);return null==t&&(t=""),u.$$p=null,i=(n=a,r=e.find_super_dispatcher(a,"allocate",u,!1,c),r.$$p=null,r).call(n),i.literal=t,i},u.$$arity=-1),e.defs(S,"$new",$=function(t){var r,n,a,i=this,s=$.$$p,l=s||o,c=o,u=arguments.length,f=u-0;f<0&&(f=0),a=new Array(f);for(var p=0;p<u;p++)a[p-0]=arguments[p];return $.$$p=null,c=i.$allocate(),(r=(n=c).$initialize,r.$$p=l.$to_proc(),r).apply(n,e.to_a(a)),c},$.$$arity=-1),e.defs(S,"$[]",f=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];return r.$allocate(t)},f.$$arity=-1),e.defn(S,"$initialize",p=function(e){var t=this;return null==e&&(e=""),t.literal=e},p.$$arity=-1),e.defn(S,"$method_missing",d=function(t){var r,n,a,i=this,s=d.$$p,l=s||o,c=o,u=arguments.length,$=u-0;$<0&&($=0),a=new Array($);for(var f=0;f<u;f++)a[f-0]=arguments[f];return d.$$p=null,c=(r=(n=i.literal).$__send__,r.$$p=l.$to_proc(),r).apply(n,e.to_a(a)),(r=null!=c.$$is_string)===o||null==r||r.$$is_boolean&&1!=r?c:(r=c==i.literal)===o||null==r||r.$$is_boolean&&1!=r?i.$class().$allocate(c):i},d.$$arity=-1),e.defn(S,"$initialize_copy",h=function(e){return this.literal=e.literal.$clone()},h.$$arity=1),e.defn(S,"$respond_to?",_=function(t,r){var n,a,i,s=this,l=_.$$p,c=o,u=o;for(_.$$p=null,c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];return!1!==(n=(i=s,a=e.find_super_dispatcher(s,"respond_to?",_,!1),a.$$p=l,a).apply(i,c))&&n!==o&&null!=n?n:s.literal["$respond_to?"](t)},_.$$arity=-2),e.defn(S,"$==",g=function(e){return this.literal["$=="](e)},g.$$arity=1),e.alias(S,"eql?","=="),e.alias(S,"===","=="),e.defn(S,"$to_s",m=function(){return this.literal},m.$$arity=0),e.alias(S,"to_str","to_s"),e.defn(S,"$inspect",y=function(){return this.literal.$inspect()},y.$$arity=0),e.defn(S,"$+",v=function(e){return t(this.literal,e)},v.$$arity=1),e.defn(S,"$*",b=function(e){var t=this,n=r(t.literal,e);return n.$$is_string?t.$class().$allocate(n):n},b.$$arity=1),e.defn(S,"$split",x=function(e,t){var r,n,a,i=this;return(r=(n=i.literal.$split(e,t)).$map,r.$$p=(a=function(e){var t=a.$$s||this;return null==e&&(e=o),t.$class().$allocate(e)},a.$$s=i,a.$$arity=1,a),r).call(n)},x.$$arity=-1),e.defn(S,"$replace",w=function(e){return this.literal=e},w.$$arity=1),e.defn(S,"$each_line",A=function(t){var r,n,a,i=this,s=A.$$p,c=s||o;return null==l["/"]&&(l["/"]=o),null==t&&(t=l["/"]),A.$$p=null,c===o?i.$enum_for("each_line",t):(r=(n=i.literal).$each_line,r.$$p=(a=function(t){var r=a.$$s||this;return null==t&&(t=o),e.yield1(c,r.$class().$allocate(t))},a.$$s=i,a.$$arity=1,a),r).call(n,t)},A.$$arity=-1),e.defn(S,"$lines",k=function(e){var t,r,n=this,a=k.$$p,i=a||o,s=o;return null==l["/"]&&(l["/"]=o),null==e&&(e=l["/"]),k.$$p=null,s=(t=(r=n).$each_line,t.$$p=i.$to_proc(),t).call(r,e),!1!==i&&i!==o&&null!=i?n:s.$to_a()},k.$$arity=-1),e.defn(S,"$%",E=function(e){return this.literal["$%"](e)},E.$$arity=1),e.defn(S,"$instance_variables",C=function(){var t,r,a=this,i=C.$$p,s=o,l=o;for(C.$$p=null,s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];return n((r=a,t=e.find_super_dispatcher(a,"instance_variables",C,!1),t.$$p=i,t).apply(r,s),["@literal"])},C.$$arity=0),o&&"instance_variables"}(i.get("String"))},Opal.modules["corelib/string/encoding"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var r,n,a,i,o,s,l,c=e.top,u=e,$=e.nil,f=(e.breaker,e.slice,e.klass),p=e.hash2;return e.add_stubs(["$require","$+","$[]","$new","$to_proc","$each","$const_set","$sub","$upcase","$const_get","$===","$==","$name","$include?","$names","$constants","$raise","$attr_accessor","$attr_reader","$register","$length","$bytes","$to_a","$each_byte","$bytesize","$enum_for","$force_encoding","$dup","$coerce_to!","$find","$nil?","$getbyte"]),c.$require("corelib/string"),function(r,n){function a(){}var i,o,s,l,c,u,d,h,_,g,m=a=f(r,null,"Encoding",a),y=m.$$proto,v=m.$$scope;y.ascii=y.dummy=y.name=$,e.defs(m,"$register",i=function(e,r){var n,a,o,s,l=this,c=i.$$p,u=c||$,f=$,d=$;return null==r&&(r=p([],{})),i.$$p=null,f=t([e],!1!==(n=r["$[]"]("aliases"))&&n!==$&&null!=n?n:[]),d=(n=(a=v.get("Class")).$new,n.$$p=u.$to_proc(),n).call(a,l).$new(e,f,!1!==(n=r["$[]"]("ascii"))&&n!==$&&null!=n&&n,!1!==(n=r["$[]"]("dummy"))&&n!==$&&null!=n&&n),(n=(o=f).$each,n.$$p=(s=function(e){var t=s.$$s||this;return null==e&&(e=$),t.$const_set(e.$sub("-","_"),d)},s.$$s=l,s.$$arity=1,s),n).call(o)},i.$$arity=-2),e.defs(m,"$find",o=function(t){try{var r,n,a,i=this,o=$;return o=t.$upcase(),(r=(n=i.$constants()).$each,r.$$p=(a=function(t){var r,n,i=a.$$s||this,s=$;return null==t&&(t=$),s=i.$const_get(t),(r=v.get("Encoding")["$==="](s))===$||null==r||r.$$is_boolean&&1!=r?$:(r=!1!==(n=s.$name()["$=="](o))&&n!==$&&null!=n?n:s.$names()["$include?"](o))===$||null==r||r.$$is_boolean&&1!=r?$:void e.ret(s)},a.$$s=i,a.$$arity=1,a),r).call(n),i.$raise(v.get("ArgumentError"),"unknown encoding name - "+t)}catch(t){if(t===e.returner)return t.$v;throw t}},o.$$arity=1),function(e){e.$$scope,e.$$proto;e.$attr_accessor("default_external")}(e.get_singleton_class(m)),m.$attr_reader("name","names"),e.defn(m,"$initialize",s=function(e,t,r,n){var a=this;return a.name=e,a.names=t,a.ascii=r,a.dummy=n},s.$$arity=4),e.defn(m,"$ascii_compatible?",l=function(){return this.ascii},l.$$arity=0),e.defn(m,"$dummy?",c=function(){return this.dummy},c.$$arity=0),e.defn(m,"$to_s",u=function(){return this.name},u.$$arity=0),e.defn(m,"$inspect",d=function(){var e,t=this;return"#<Encoding:"+t.name+function(){return(e=t.dummy)===$||null==e||e.$$is_boolean&&1!=e?$:" (dummy)"}()+">"},d.$$arity=0),e.defn(m,"$each_byte",h=function(e){return this.$raise(v.get("NotImplementedError"))},h.$$arity=-1),e.defn(m,"$getbyte",_=function(e){return this.$raise(v.get("NotImplementedError"))},_.$$arity=-1),e.defn(m,"$bytesize",g=function(e){return this.$raise(v.get("NotImplementedError"))},g.$$arity=-1),function(e,t){function r(){}var n=r=f(e,t,"EncodingError",r);n.$$proto,n.$$scope}(v.base,v.get("StandardError")),function(e,t){function r(){}var n=r=f(e,t,"CompatibilityError",r);n.$$proto,n.$$scope}(v.base,v.get("EncodingError"))}(u.base),(r=(n=u.get("Encoding")).$register,r.$$p=(a=function(){var t,r,n=a.$$s||this;return e.def(n,"$each_byte",t=function(r){var n=t.$$p,a=n||$;t.$$p=null;for(var i=0,o=r.length;i<o;i++){var s=r.charCodeAt(i);if(s<=127)e.yield1(a,s);else for(var l=encodeURIComponent(r.charAt(i)).substr(1).split("%"),c=0,u=l.length;c<u;c++)e.yield1(a,parseInt(l[c],16))}},t.$$arity=1),e.def(n,"$bytesize",r=function(){return this.$bytes().$length()},r.$$arity=0),$&&"bytesize"},a.$$s=c,a.$$arity=0,a),r).call(n,"UTF-8",p(["aliases","ascii"],{aliases:["CP65001"],ascii:!0})),(r=(i=u.get("Encoding")).$register,r.$$p=(o=function(){var t,r,n=o.$$s||this;return e.def(n,"$each_byte",t=function(r){var n=t.$$p,a=n||$;t.$$p=null;for(var i=0,o=r.length;i<o;i++){var s=r.charCodeAt(i);e.yield1(a,255&s),e.yield1(a,s>>8)}},t.$$arity=1),e.def(n,"$bytesize",r=function(){return this.$bytes().$length()},r.$$arity=0),$&&"bytesize"},o.$$s=c,o.$$arity=0,o),r).call(i,"UTF-16LE"),(r=(s=u.get("Encoding")).$register,r.$$p=(l=function(){var t,r,n=l.$$s||this;return e.def(n,"$each_byte",t=function(r){var n=t.$$p,a=n||$;t.$$p=null;for(var i=0,o=r.length;i<o;i++)e.yield1(a,255&r.charCodeAt(i))},t.$$arity=1),e.def(n,"$bytesize",r=function(){return this.$bytes().$length()},r.$$arity=0),$&&"bytesize"},l.$$s=c,l.$$arity=0,l),r).call(s,"ASCII-8BIT",p(["aliases","ascii"],{aliases:["BINARY"],ascii:!0})),function(t,r){function n(){}var a,i,o,s,l,c,u,p=n=f(t,null,"String",n),d=p.$$proto,h=p.$$scope;return d.encoding=$,String.prototype.encoding=h.get("Encoding").$$scope.get("UTF_16LE"),e.defn(p,"$bytes",a=function(){return this.$each_byte().$to_a()},a.$$arity=0),e.defn(p,"$bytesize",i=function(){var e=this;return e.encoding.$bytesize(e)},i.$$arity=0),e.defn(p,"$each_byte",o=function(){var e,t,r=this,n=o.$$p,a=n||$;return o.$$p=null,a===$?r.$enum_for("each_byte"):((e=(t=r.encoding).$each_byte,e.$$p=a.$to_proc(),e).call(t,r),r)},o.$$arity=0),e.defn(p,"$encode",s=function(e){return this.$dup().$force_encoding(e)},s.$$arity=1),e.defn(p,"$encoding",l=function(){return this.encoding},l.$$arity=0),e.defn(p,"$force_encoding",c=function(e){var t,r=this;if(e=h.get("Opal")["$coerce_to!"](e,h.get("String"),"to_str"),e=h.get("Encoding").$find(e),e["$=="](r.encoding))return r;(t=e["$nil?"]())===$||null==t||t.$$is_boolean&&1!=t||r.$raise(h.get("ArgumentError"),"unknown encoding name - "+e);var n=new String(r);return n.encoding=e,n},c.$$arity=1),e.defn(p,"$getbyte",u=function(e){var t=this;return t.encoding.$getbyte(t,e)},u.$$arity=1),$&&"getbyte"}(u.base)},Opal.modules["corelib/math"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}var n=(e.top,e),a=e.nil,i=(e.breaker,e.slice,e.module);return e.add_stubs(["$new","$raise","$Float","$type_error","$Integer","$module_function","$checked","$float!","$===","$gamma","$-","$integer!","$/","$infinite?"]),function(n){var o,s,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j=o=i(n,"Math"),F=(j.$$proto,j.$$scope);e.cdecl(F,"E",Math.E),e.cdecl(F,"PI",Math.PI),e.cdecl(F,"DomainError",F.get("Class").$new(F.get("StandardError"))),e.defs(j,"$checked",s=function(e,t){var r,n=this,a=arguments.length,i=a-1;i<0&&(i=0),r=new Array(i);for(var o=1;o<a;o++)r[o-1]=arguments[o];if(isNaN(r[0])||2==r.length&&isNaN(r[1]))return NaN;var s=Math[e].apply(null,r);return isNaN(s)&&n.$raise(F.get("DomainError"),'Numerical argument is out of domain - "'+e+'"'),s},s.$$arity=-2),e.defs(j,"$float!",l=function(t){var r=this;try{return r.$Float(t)}catch(n){if(!e.rescue(n,[F.get("ArgumentError")]))throw n;try{return r.$raise(F.get("Opal").$type_error(t,F.get("Float")))}finally{e.pop_exception()}}},l.$$arity=1),e.defs(j,"$integer!",c=function(t){var r=this;try{return r.$Integer(t)}catch(n){if(!e.rescue(n,[F.get("ArgumentError")]))throw n;try{return r.$raise(F.get("Opal").$type_error(t,F.get("Integer")))}finally{e.pop_exception()}}},c.$$arity=1),j.$module_function(),e.defn(j,"$acos",u=function(e){return F.get("Math").$checked("acos",F.get("Math")["$float!"](e))},u.$$arity=1),(($=void 0!==Math.acosh)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.acosh=function(e){return Math.log(e+Math.sqrt(e*e-1))}),e.defn(j,"$acosh",f=function(e){return F.get("Math").$checked("acosh",F.get("Math")["$float!"](e))},f.$$arity=1),e.defn(j,"$asin",p=function(e){return F.get("Math").$checked("asin",F.get("Math")["$float!"](e))},p.$$arity=1),(($=void 0!==Math.asinh)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.asinh=function(e){return Math.log(e+Math.sqrt(e*e+1))}),e.defn(j,"$asinh",d=function(e){return F.get("Math").$checked("asinh",F.get("Math")["$float!"](e))},d.$$arity=1),e.defn(j,"$atan",h=function(e){return F.get("Math").$checked("atan",F.get("Math")["$float!"](e))},h.$$arity=1),e.defn(j,"$atan2",_=function(e,t){return F.get("Math").$checked("atan2",F.get("Math")["$float!"](e),F.get("Math")["$float!"](t))},_.$$arity=2),(($=void 0!==Math.atanh)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.atanh=function(e){return.5*Math.log((1+e)/(1-e))}),e.defn(j,"$atanh",g=function(e){return F.get("Math").$checked("atanh",F.get("Math")["$float!"](e))},g.$$arity=1),(($=void 0!==Math.cbrt)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.cbrt=function(e){if(0==e)return 0;if(e<0)return-Math.cbrt(-e);for(var t=e,r=0;t<.125;)t*=8,r--;for(;t>1;)t*=.125,r++;for(t=(-.46946116*t+1.072302)*t+.3812513;r<0;)t*=.5,r++;for(;r>0;)t*=2,r--;return t=2/3*t+1/3*e/(t*t),t=2/3*t+1/3*e/(t*t),t=2/3*t+1/3*e/(t*t),t=2/3*t+1/3*e/(t*t)}),e.defn(j,"$cbrt",m=function(e){return F.get("Math").$checked("cbrt",F.get("Math")["$float!"](e))},m.$$arity=1),e.defn(j,"$cos",y=function(e){return F.get("Math").$checked("cos",F.get("Math")["$float!"](e))},y.$$arity=1),(($=void 0!==Math.cosh)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.cosh=function(e){return(Math.exp(e)+Math.exp(-e))/2}),e.defn(j,"$cosh",v=function(e){return F.get("Math").$checked("cosh",F.get("Math")["$float!"](e))},v.$$arity=1),(($=void 0!==Math.erf)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.erf=function(e){var t=1;e<0&&(t=-1),e=Math.abs(e);var r=1/(1+.3275911*e);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-e*e))}),e.defn(j,"$erf",b=function(e){return F.get("Math").$checked("erf",F.get("Math")["$float!"](e))},b.$$arity=1),(($=void 0!==Math.erfc)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.erfc=function(e){var t=Math.abs(e),r=1/(.5*t+1),n=.17087277*r-.82215223,a=r*n+1.48851587,i=r*a-1.13520398,o=r*i+.27886807,s=r*o-.18628806,l=r*s+.09678418,c=r*l+.37409196,u=r*c+1.00002368,$=r*u,f=-t*t-1.26551223+$,p=r*Math.exp(f);return e<0?2-p:p}),e.defn(j,"$erfc",x=function(e){return F.get("Math").$checked("erfc",F.get("Math")["$float!"](e))},x.$$arity=1),e.defn(j,"$exp",w=function(e){return F.get("Math").$checked("exp",F.get("Math")["$float!"](e))},w.$$arity=1),e.defn(j,"$frexp",A=function(e){if(e=F.get("Math")["$float!"](e),isNaN(e))return[NaN,0];var t=Math.floor(Math.log(Math.abs(e))/Math.log(2))+1;return[e/Math.pow(2,t),t]},A.$$arity=1),e.defn(j,"$gamma",k=function(e){var r=this;e=F.get("Math")["$float!"](e);var n,a,i,o,s,l,c,u,$,f=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];if(isNaN(e))return NaN;if(0===e&&1/e<0)return-1/0;if(-1!==e&&e!==-1/0||r.$raise(F.get("DomainError"),'Numerical argument is out of domain - "gamma"'),F.get("Integer")["$==="](e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(o=e-2,s=e-1;o>1;)s*=o,o--;return 0==s&&(s=1),s}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*F.get("Math").$gamma(t(1,e)));if(e>=171.35)return 1/0;if(e>85)return l=e*e,c=l*e,u=c*e,$=u*e,Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*l)-139/(51840*c)-571/(2488320*u)+163879/(209018880*$)+5246819/(75246796800*$*e));for(e-=1,i=f[0],n=1;n<f.length;++n)i+=f[n]/(e+n);return a=e+4.7421875+.5,Math.sqrt(2*Math.PI)*Math.pow(a,e+.5)*Math.exp(-a)*i},k.$$arity=1),(($=void 0!==Math.hypot)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.hypot=function(e,t){return Math.sqrt(e*e+t*t)}),e.defn(j,"$hypot",E=function(e,t){return F.get("Math").$checked("hypot",F.get("Math")["$float!"](e),F.get("Math")["$float!"](t))},E.$$arity=2),e.defn(j,"$ldexp",C=function(e,t){var r=this;return e=F.get("Math")["$float!"](e),t=F.get("Math")["$integer!"](t),isNaN(t)&&r.$raise(F.get("RangeError"),"float NaN out of range of integer"),e*Math.pow(2,t)},C.$$arity=2),e.defn(j,"$lgamma",S=function(e){return-1==e?[1/0,1]:[Math.log(Math.abs(F.get("Math").$gamma(e))),F.get("Math").$gamma(e)<0?-1:1]},S.$$arity=1),e.defn(j,"$log",I=function(e,t){var n,i=this;return(n=F.get("String")["$==="](e))===a||null==n||n.$$is_boolean&&1!=n||i.$raise(F.get("Opal").$type_error(e,F.get("Float"))),(n=null==t)===a||null==n||n.$$is_boolean&&1!=n?((n=F.get("String")["$==="](t))===a||null==n||n.$$is_boolean&&1!=n||i.$raise(F.get("Opal").$type_error(t,F.get("Float"))),r(F.get("Math").$checked("log",F.get("Math")["$float!"](e)),F.get("Math").$checked("log",F.get("Math")["$float!"](t)))):F.get("Math").$checked("log",F.get("Math")["$float!"](e))},I.$$arity=-2),(($=void 0!==Math.log10)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.log10=function(e){return Math.log(e)/Math.LN10}),e.defn(j,"$log10",O=function(e){var t,r=this;return(t=F.get("String")["$==="](e))===a||null==t||t.$$is_boolean&&1!=t||r.$raise(F.get("Opal").$type_error(e,F.get("Float"))),F.get("Math").$checked("log10",F.get("Math")["$float!"](e))},O.$$arity=1),(($=void 0!==Math.log2)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.log2=function(e){return Math.log(e)/Math.LN2}),e.defn(j,"$log2",T=function(e){var t,r=this;return(t=F.get("String")["$==="](e))===a||null==t||t.$$is_boolean&&1!=t||r.$raise(F.get("Opal").$type_error(e,F.get("Float"))),F.get("Math").$checked("log2",F.get("Math")["$float!"](e))},T.$$arity=1),e.defn(j,"$sin",P=function(e){return F.get("Math").$checked("sin",F.get("Math")["$float!"](e))},P.$$arity=1),(($=void 0!==Math.sinh)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.sinh=function(e){return(Math.exp(e)-Math.exp(-e))/2}),e.defn(j,"$sinh",M=function(e){return F.get("Math").$checked("sinh",F.get("Math")["$float!"](e))},M.$$arity=1),e.defn(j,"$sqrt",N=function(e){return F.get("Math").$checked("sqrt",F.get("Math")["$float!"](e))},N.$$arity=1),e.defn(j,"$tan",B=function(e){var t;return e=F.get("Math")["$float!"](e),(t=e["$infinite?"]())===a||null==t||t.$$is_boolean&&1!=t?F.get("Math").$checked("tan",F.get("Math")["$float!"](e)):F.get("Float").$$scope.get("NAN")},B.$$arity=1),(($=void 0!==Math.tanh)===a||null==$||$.$$is_boolean&&1!=$)&&(Math.tanh=function(e){return e==1/0?1:e==-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}),e.defn(j,"$tanh",R=function(e){return F.get("Math").$checked("tanh",F.get("Math")["$float!"](e))},R.$$arity=1)}(n.base)},Opal.modules["corelib/complex"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}var o=e.top,s=e,l=e.nil,c=(e.breaker,e.slice,e.klass),u=e.module;return e.add_stubs(["$require","$===","$real?","$raise","$new","$*","$cos","$sin","$attr_reader","$class","$==","$real","$imag","$Complex","$-@","$+","$__coerced__","$-","$nan?","$/","$conj","$abs2","$quo","$polar","$exp","$log","$>","$!=","$divmod","$**","$hypot","$atan2","$lcm","$denominator","$to_s","$numerator","$abs","$arg","$rationalize","$to_f","$to_i","$to_r","$inspect","$positive?","$infinite?"]),o.$require("corelib/numeric"),function(o,s){function u(){}var $,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L=u=c(o,s,"Complex",u),z=L.$$proto,q=L.$$scope;z.real=z.imag=l,e.defs(L,"$rect",$=function(e,t){var r,n,a,i,o=this;return null==t&&(t=0),i=q.get("Numeric")["$==="](e),a=!1!==i&&i!==l&&null!=i?e["$real?"]():i,n=!1!==a&&a!==l&&null!=a?q.get("Numeric")["$==="](t):a,((r=!1!==n&&n!==l&&null!=n?t["$real?"]():n)===l||null==r||r.$$is_boolean&&1!=r)&&o.$raise(q.get("TypeError"),"not a real"),o.$new(e,t)},$.$$arity=-2),function(t){t.$$scope,t.$$proto;e.alias(t,"rectangular","rect")}(e.get_singleton_class(L)),e.defs(L,"$polar",f=function(e,r){var n,a,i,o,s=this;return null==r&&(r=0),o=q.get("Numeric")["$==="](e),i=!1!==o&&o!==l&&null!=o?e["$real?"]():o,a=!1!==i&&i!==l&&null!=i?q.get("Numeric")["$==="](r):i,((n=!1!==a&&a!==l&&null!=a?r["$real?"]():a)===l||null==n||n.$$is_boolean&&1!=n)&&s.$raise(q.get("TypeError"),"not a real"),s.$new(t(e,q.get("Math").$cos(r)),t(e,q.get("Math").$sin(r)))},f.$$arity=-2),L.$attr_reader("real","imag"),e.defn(L,"$initialize",p=function(e,t){var r=this;return null==t&&(t=0),r.real=e,r.imag=t},p.$$arity=-2),e.defn(L,"$coerce",d=function(e){var t,r,n=this;return(t=q.get("Complex")["$==="](e))===l||null==t||t.$$is_boolean&&1!=t?(r=q.get("Numeric")["$==="](e),(t=!1!==r&&r!==l&&null!=r?e["$real?"]():r)===l||null==t||t.$$is_boolean&&1!=t?n.$raise(q.get("TypeError"),e.$class()+" can't be coerced into Complex"):[q.get("Complex").$new(e,0),n]):[e,n]},d.$$arity=1),e.defn(L,"$==",h=function(e){var t,r,n=this;return(t=q.get("Complex")["$==="](e))===l||null==t||t.$$is_boolean&&1!=t?(r=q.get("Numeric")["$==="](e),(t=!1!==r&&r!==l&&null!=r?e["$real?"]():r)===l||null==t||t.$$is_boolean&&1!=t?e["$=="](n):(t=n.real["$=="](e))?n.imag["$=="](0):n.real["$=="](e)):(t=n.real["$=="](e.$real()))?n.imag["$=="](e.$imag()):n.real["$=="](e.$real())},h.$$arity=1),e.defn(L,"$-@",_=function(){var e=this;return e.$Complex(e.real["$-@"](),e.imag["$-@"]())},_.$$arity=0),e.defn(L,"$+",g=function(e){var t,n,a=this;return(t=q.get("Complex")["$==="](e))===l||null==t||t.$$is_boolean&&1!=t?(n=q.get("Numeric")["$==="](e),(t=!1!==n&&n!==l&&null!=n?e["$real?"]():n)===l||null==t||t.$$is_boolean&&1!=t?a.$__coerced__("+",e):a.$Complex(r(a.real,e),a.imag)):a.$Complex(r(a.real,e.$real()),r(a.imag,e.$imag()))},g.$$arity=1),e.defn(L,"$-",m=function(e){var t,r,a=this;return(t=q.get("Complex")["$==="](e))===l||null==t||t.$$is_boolean&&1!=t?(r=q.get("Numeric")["$==="](e),(t=!1!==r&&r!==l&&null!=r?e["$real?"]():r)===l||null==t||t.$$is_boolean&&1!=t?a.$__coerced__("-",e):a.$Complex(n(a.real,e),a.imag)):a.$Complex(n(a.real,e.$real()),n(a.imag,e.$imag()))},m.$$arity=1),e.defn(L,"$*",y=function(e){var a,i,o=this;return(a=q.get("Complex")["$==="](e))===l||null==a||a.$$is_boolean&&1!=a?(i=q.get("Numeric")["$==="](e),(a=!1!==i&&i!==l&&null!=i?e["$real?"]():i)===l||null==a||a.$$is_boolean&&1!=a?o.$__coerced__("*",e):o.$Complex(t(o.real,e),t(o.imag,e))):o.$Complex(n(t(o.real,e.$real()),t(o.imag,e.$imag())),r(t(o.real,e.$imag()),t(o.imag,e.$real())))},y.$$arity=1),e.defn(L,"$/",v=function(e){var r,n,i,o,s,c=this;return(r=q.get("Complex")["$==="](e))===l||null==r||r.$$is_boolean&&1!=r?(n=q.get("Numeric")["$==="](e),(r=!1!==n&&n!==l&&null!=n?e["$real?"]():n)===l||null==r||r.$$is_boolean&&1!=r?c.$__coerced__("/",e):c.$Complex(c.real.$quo(e),c.imag.$quo(e))):(r=!1!==(n=!1!==(i=!1!==(s=q.get("Number")["$==="](c.real),o=!1!==s&&s!==l&&null!=s?c.real["$nan?"]():s)&&o!==l&&null!=o?o:(s=q.get("Number")["$==="](c.imag),!1!==s&&s!==l&&null!=s?c.imag["$nan?"]():s))&&i!==l&&null!=i?i:(o=q.get("Number")["$==="](e.$real()),!1!==o&&o!==l&&null!=o?e.$real()["$nan?"]():o))&&n!==l&&null!=n?n:(i=q.get("Number")["$==="](e.$imag()),!1!==i&&i!==l&&null!=i?e.$imag()["$nan?"]():i))===l||null==r||r.$$is_boolean&&1!=r?a(t(c,e.$conj()),e.$abs2()):q.get("Complex").$new(q.get("Float").$$scope.get("NAN"),q.get("Float").$$scope.get("NAN"))},v.$$arity=1),e.defn(L,"$**",b=function(o){var s,c,u,$,f,p=this,d=l,h=l,_=l,g=l,m=l,y=l,v=l,b=l,x=l,w=l,A=l;if(o["$=="](0))return q.get("Complex").$new(1,0);if((s=q.get("Complex")["$==="](o))===l||null==s||s.$$is_boolean&&1!=s){if((s=q.get("Integer")["$==="](o))===l||null==s||s.$$is_boolean&&1!=s)return(s=!1!==(c=q.get("Float")["$==="](o))&&c!==l&&null!=c?c:q.get("Rational")["$==="](o))===l||null==s||s.$$is_boolean&&1!=s?p.$__coerced__("**",o):(c=p.$polar(),s=e.to_ary(c),d=null==s[0]?l:s[0],h=null==s[1]?l:s[1],q.get("Complex").$polar(d["$**"](o),t(h,o)));if((s=i(o,0))===l||null==s||s.$$is_boolean&&1!=s)return a(q.get("Rational").$new(1,1),p)["$**"](o["$-@"]());for(v=p,b=v,x=n(o,1);(c=x["$!="](0))!==l&&null!=c&&(!c.$$is_boolean||1==c);){for(;f=x.$divmod(2),$=e.to_ary(f),w=null==$[0]?l:$[0],A=null==$[1]?l:$[1],(u=A["$=="](0))!==l&&null!=u&&(!u.$$is_boolean||1==u);)v=p.$Complex(n(t(v.$real(),v.$real()),t(v.$imag(),v.$imag())),t(t(2,v.$real()),v.$imag())),x=w;b=t(b,v),x=n(x,1)}return b}return c=p.$polar(),s=e.to_ary(c),d=null==s[0]?l:s[0],h=null==s[1]?l:s[1],_=o.$real(),g=o.$imag(),m=q.get("Math").$exp(n(t(_,q.get("Math").$log(d)),t(g,h))),y=r(t(h,_),t(g,q.get("Math").$log(d))),q.get("Complex").$polar(m,y)},b.$$arity=1),e.defn(L,"$abs",x=function(){var e=this;return q.get("Math").$hypot(e.real,e.imag)},x.$$arity=0),e.defn(L,"$abs2",w=function(){var e=this;return r(t(e.real,e.real),t(e.imag,e.imag))},w.$$arity=0),e.defn(L,"$angle",A=function(){var e=this;return q.get("Math").$atan2(e.imag,e.real)},A.$$arity=0),e.alias(L,"arg","angle"),e.defn(L,"$conj",k=function(){var e=this;return e.$Complex(e.real,e.imag["$-@"]())},k.$$arity=0),e.alias(L,"conjugate","conj"),e.defn(L,"$denominator",E=function(){var e=this;return e.real.$denominator().$lcm(e.imag.$denominator())},E.$$arity=0),e.alias(L,"divide","/"),e.defn(L,"$eql?",C=function(e){var t,r,n=this;return r=q.get("Complex")["$==="](e),t=!1!==r&&r!==l&&null!=r?n.real.$class()["$=="](n.imag.$class()):r,!1!==t&&t!==l&&null!=t?n["$=="](e):t},C.$$arity=1),e.defn(L,"$fdiv",S=function(e){var t,r=this;return((t=q.get("Numeric")["$==="](e))===l||null==t||t.$$is_boolean&&1!=t)&&r.$raise(q.get("TypeError"),e.$class()+" can't be coerced into Complex"),a(r,e)},S.$$arity=1),e.defn(L,"$hash",I=function(){var e=this;return"Complex:"+e.real+":"+e.imag},I.$$arity=0),e.alias(L,"imaginary","imag"),e.defn(L,"$inspect",O=function(){return"("+this.$to_s()+")"},O.$$arity=0),e.alias(L,"magnitude","abs"),e.defn(L,"$numerator",T=function(){var e=this,r=l;return r=e.$denominator(),e.$Complex(t(e.real.$numerator(),a(r,e.real.$denominator())),t(e.imag.$numerator(),a(r,e.imag.$denominator())))},T.$$arity=0),e.alias(L,"phase","arg"),e.defn(L,"$polar",P=function(){var e=this;return[e.$abs(),e.$arg()]},P.$$arity=0),e.alias(L,"quo","/"),e.defn(L,"$rationalize",M=function(e){var t,r=this;return arguments.length>1&&r.$raise(q.get("ArgumentError"),"wrong number of arguments ("+arguments.length+" for 0..1)"),(t=r.imag["$!="](0))===l||null==t||t.$$is_boolean&&1!=t||r.$raise(q.get("RangeError"),"can't' convert "+r+" into Rational"),r.$real().$rationalize(e)},M.$$arity=-1),e.defn(L,"$real?",N=function(){return!1},N.$$arity=0),e.defn(L,"$rect",B=function(){var e=this;return[e.real,e.imag]},B.$$arity=0),e.alias(L,"rectangular","rect"),e.defn(L,"$to_f",R=function(){var e=this;return e.imag["$=="](0)||e.$raise(q.get("RangeError"),"can't convert "+e+" into Float"),e.real.$to_f()},R.$$arity=0),e.defn(L,"$to_i",j=function(){var e=this;return e.imag["$=="](0)||e.$raise(q.get("RangeError"),"can't convert "+e+" into Integer"),e.real.$to_i()},j.$$arity=0),e.defn(L,"$to_r",F=function(){var e=this;return e.imag["$=="](0)||e.$raise(q.get("RangeError"),"can't convert "+e+" into Rational"),e.real.$to_r()},F.$$arity=0),e.defn(L,"$to_s",D=function(){var e,t,n,a=this,i=l;return i=a.real.$inspect(),i=(e=!1!==(n=q.get("Number")["$==="](a.imag),t=!1!==n&&n!==l&&null!=n?a.imag["$nan?"]():n)&&t!==l&&null!=t?t:a.imag["$positive?"]())===l||null==e||e.$$is_boolean&&1!=e?r(i,"-"):r(i,"+"),i=r(i,a.imag.$abs().$inspect()),t=q.get("Number")["$==="](a.imag),(e=!1!==t&&t!==l&&null!=t?!1!==(n=a.imag["$nan?"]())&&n!==l&&null!=n?n:a.imag["$infinite?"]():t)===l||null==e||e.$$is_boolean&&1!=e||(i=r(i,"*")),r(i,"i")},D.$$arity=0),e.cdecl(q,"I",L.$new(0,1))}(s.base,s.get("Numeric")),function(t){var r,n,a=r=u(t,"Kernel"),i=(a.$$proto,a.$$scope);e.defn(a,"$Complex",n=function(e,t){return null==t&&(t=l),
!1!==t&&t!==l&&null!=t?i.get("Complex").$new(e,t):i.get("Complex").$new(e,0)},n.$$arity=-2)}(s.base)},Opal.modules["corelib/rational"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function o(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function s(e,t){return"number"==typeof e&&"number"==typeof t?e<=t:e["$<="](t)}var l=e.top,c=e,u=e.nil,$=(e.breaker,e.slice,e.klass),f=e.module;return e.add_stubs(["$require","$to_i","$==","$raise","$<","$-@","$new","$gcd","$/","$nil?","$===","$reduce","$to_r","$equal?","$!","$coerce_to!","$attr_reader","$to_f","$numerator","$denominator","$<=>","$-","$*","$__coerced__","$+","$Rational","$>","$**","$abs","$ceil","$with_precision","$floor","$to_s","$<=","$truncate","$send","$convert"]),l.$require("corelib/numeric"),function(l,c){function f(){}var p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D=f=$(l,c,"Rational",f),L=D.$$proto,z=D.$$scope;L.num=L.den=u,e.defs(D,"$reduce",p=function(e,n){var a,i=this,o=u;if(e=e.$to_i(),n=n.$to_i(),n["$=="](0))i.$raise(z.get("ZeroDivisionError"),"divided by 0");else if((a=t(n,0))===u||null==a||a.$$is_boolean&&1!=a){if(n["$=="](1))return i.$new(e,n)}else e=e["$-@"](),n=n["$-@"]();return o=e.$gcd(n),i.$new(r(e,o),r(n,o))},p.$$arity=2),e.defs(D,"$convert",d=function(e,t){var n,a,i,o=this;return(n=!1!==(a=e["$nil?"]())&&a!==u&&null!=a?a:t["$nil?"]())===u||null==n||n.$$is_boolean&&1!=n||o.$raise(z.get("TypeError"),"cannot convert nil into Rational"),a=z.get("Integer")["$==="](e),(n=!1!==a&&a!==u&&null!=a?z.get("Integer")["$==="](t):a)===u||null==n||n.$$is_boolean&&1!=n?((n=!1!==(a=!1!==(i=z.get("Float")["$==="](e))&&i!==u&&null!=i?i:z.get("String")["$==="](e))&&a!==u&&null!=a?a:z.get("Complex")["$==="](e))===u||null==n||n.$$is_boolean&&1!=n||(e=e.$to_r()),(n=!1!==(a=!1!==(i=z.get("Float")["$==="](t))&&i!==u&&null!=i?i:z.get("String")["$==="](t))&&a!==u&&null!=a?a:z.get("Complex")["$==="](t))===u||null==n||n.$$is_boolean&&1!=n||(t=t.$to_r()),a=t["$equal?"](1),(n=!1!==a&&a!==u&&null!=a?z.get("Integer")["$==="](e)["$!"]():a)===u||null==n||n.$$is_boolean&&1!=n?(a=z.get("Numeric")["$==="](e),(n=!1!==a&&a!==u&&null!=a?z.get("Numeric")["$==="](t):a)===u||null==n||n.$$is_boolean&&1!=n?o.$reduce(e,t):r(e,t)):z.get("Opal")["$coerce_to!"](e,z.get("Rational"),"to_r")):o.$reduce(e,t)},d.$$arity=2),D.$attr_reader("numerator","denominator"),e.defn(D,"$initialize",h=function(e,t){var r=this;return r.num=e,r.den=t},h.$$arity=2),e.defn(D,"$numerator",_=function(){return this.num},_.$$arity=0),e.defn(D,"$denominator",g=function(){return this.den},g.$$arity=0),e.defn(D,"$coerce",m=function(e){var t=this,r=u;return function(){return r=e,z.get("Rational")["$==="](r)?[e,t]:z.get("Integer")["$==="](r)?[e.$to_r(),t]:z.get("Float")["$==="](r)?[e,t.$to_f()]:u}()},m.$$arity=1),e.defn(D,"$==",y=function(e){var t,r=this,n=u;return function(){return n=e,z.get("Rational")["$==="](n)?(t=r.num["$=="](e.$numerator()))?r.den["$=="](e.$denominator()):r.num["$=="](e.$numerator()):z.get("Integer")["$==="](n)?(t=r.num["$=="](e))?r.den["$=="](1):r.num["$=="](e):z.get("Float")["$==="](n)?r.$to_f()["$=="](e):e["$=="](r)}()},y.$$arity=1),e.defn(D,"$<=>",v=function(e){var t=this,r=u;return function(){return r=e,z.get("Rational")["$==="](r)?n(a(t.num,e.$denominator()),a(t.den,e.$numerator()))["$<=>"](0):z.get("Integer")["$==="](r)?n(t.num,a(t.den,e))["$<=>"](0):z.get("Float")["$==="](r)?t.$to_f()["$<=>"](e):t.$__coerced__("<=>",e)}()},v.$$arity=1),e.defn(D,"$+",b=function(e){var t=this,r=u,n=u,o=u;return function(){return r=e,z.get("Rational")["$==="](r)?(n=i(a(t.num,e.$denominator()),a(t.den,e.$numerator())),o=a(t.den,e.$denominator()),t.$Rational(n,o)):z.get("Integer")["$==="](r)?t.$Rational(i(t.num,a(e,t.den)),t.den):z.get("Float")["$==="](r)?i(t.$to_f(),e):t.$__coerced__("+",e)}()},b.$$arity=1),e.defn(D,"$-",x=function(e){var t=this,r=u,i=u,o=u;return function(){return r=e,z.get("Rational")["$==="](r)?(i=n(a(t.num,e.$denominator()),a(t.den,e.$numerator())),o=a(t.den,e.$denominator()),t.$Rational(i,o)):z.get("Integer")["$==="](r)?t.$Rational(n(t.num,a(e,t.den)),t.den):z.get("Float")["$==="](r)?n(t.$to_f(),e):t.$__coerced__("-",e)}()},x.$$arity=1),e.defn(D,"$*",w=function(e){var t=this,r=u,n=u,i=u;return function(){return r=e,z.get("Rational")["$==="](r)?(n=a(t.num,e.$numerator()),i=a(t.den,e.$denominator()),t.$Rational(n,i)):z.get("Integer")["$==="](r)?t.$Rational(a(t.num,e),t.den):z.get("Float")["$==="](r)?a(t.$to_f(),e):t.$__coerced__("*",e)}()},w.$$arity=1),e.defn(D,"$/",A=function(e){var t=this,n=u,i=u,o=u;return function(){return n=e,z.get("Rational")["$==="](n)?(i=a(t.num,e.$denominator()),o=a(t.den,e.$numerator()),t.$Rational(i,o)):z.get("Integer")["$==="](n)?e["$=="](0)?r(t.$to_f(),0):t.$Rational(t.num,a(t.den,e)):z.get("Float")["$==="](n)?r(t.$to_f(),e):t.$__coerced__("/",e)}()},A.$$arity=1),e.defn(D,"$**",k=function(e){var r,n,a=this,i=u;return function(){return i=e,z.get("Integer")["$==="](i)?(r=(n=a["$=="](0))?t(e,0):a["$=="](0))===u||null==r||r.$$is_boolean&&1!=r?(r=o(e,0))===u||null==r||r.$$is_boolean&&1!=r?(r=t(e,0))===u||null==r||r.$$is_boolean&&1!=r?a.$Rational(1,1):a.$Rational(a.den["$**"](e["$-@"]()),a.num["$**"](e["$-@"]())):a.$Rational(a.num["$**"](e),a.den["$**"](e)):z.get("Float").$$scope.get("INFINITY"):z.get("Float")["$==="](i)?a.$to_f()["$**"](e):z.get("Rational")["$==="](i)?e["$=="](0)?a.$Rational(1,1):e.$denominator()["$=="](1)?(r=t(e,0))===u||null==r||r.$$is_boolean&&1!=r?a.$Rational(a.num["$**"](e.$numerator()),a.den["$**"](e.$numerator())):a.$Rational(a.den["$**"](e.$numerator().$abs()),a.num["$**"](e.$numerator().$abs())):(r=(n=a["$=="](0))?t(e,0):a["$=="](0))===u||null==r||r.$$is_boolean&&1!=r?a.$to_f()["$**"](e):a.$raise(z.get("ZeroDivisionError"),"divided by 0"):a.$__coerced__("**",e)}()},k.$$arity=1),e.defn(D,"$abs",E=function(){var e=this;return e.$Rational(e.num.$abs(),e.den.$abs())},E.$$arity=0),e.defn(D,"$ceil",C=function(e){var t=this;return null==e&&(e=0),e["$=="](0)?r(t.num["$-@"](),t.den)["$-@"]().$ceil():t.$with_precision("ceil",e)},C.$$arity=-1),e.alias(D,"divide","/"),e.defn(D,"$floor",S=function(e){var t=this;return null==e&&(e=0),e["$=="](0)?r(t.num["$-@"](),t.den)["$-@"]().$floor():t.$with_precision("floor",e)},S.$$arity=-1),e.defn(D,"$hash",I=function(){var e=this;return"Rational:"+e.num+":"+e.den},I.$$arity=0),e.defn(D,"$inspect",O=function(){return"("+this.$to_s()+")"},O.$$arity=0),e.alias(D,"quo","/"),e.defn(D,"$rationalize",T=function(e){var t=this;if(arguments.length>1&&t.$raise(z.get("ArgumentError"),"wrong number of arguments ("+arguments.length+" for 0..1)"),null==e)return t;for(var a,o,l,c,u,$=e.$abs(),f=n(t,$),p=i(t,$),d=0,h=1,_=1,g=0;;){if(l=f.$ceil(),s(l,p))break;c=l-1,a=c*h+d,o=c*g+_,u=r(1,n(p,c)),p=r(1,n(f,c)),f=u,d=h,_=g,h=a,g=o}return t.$Rational(l*h+d,l*g+_)},T.$$arity=-1),e.defn(D,"$round",P=function(e){var n,o=this,s=u,l=u,c=u;return null==e&&(e=0),e["$=="](0)?o.num["$=="](0)?0:o.den["$=="](1)?o.num:(s=i(a(o.num.$abs(),2),o.den),l=a(o.den,2),c=r(s,l).$truncate(),(n=t(o.num,0))===u||null==n||n.$$is_boolean&&1!=n?c:c["$-@"]()):o.$with_precision("round",e)},P.$$arity=-1),e.defn(D,"$to_f",M=function(){var e=this;return r(e.num,e.den)},M.$$arity=0),e.defn(D,"$to_i",N=function(){return this.$truncate()},N.$$arity=0),e.defn(D,"$to_r",B=function(){return this},B.$$arity=0),e.defn(D,"$to_s",R=function(){var e=this;return e.num+"/"+e.den},R.$$arity=0),e.defn(D,"$truncate",j=function(e){var r,n=this;return null==e&&(e=0),e["$=="](0)?(r=t(n.num,0))===u||null==r||r.$$is_boolean&&1!=r?n.$floor():n.$ceil():n.$with_precision("truncate",e)},j.$$arity=-1),e.defn(D,"$with_precision",F=function(e,n){var i,o=this,s=u,l=u;return((i=z.get("Integer")["$==="](n))===u||null==i||i.$$is_boolean&&1!=i)&&o.$raise(z.get("TypeError"),"not an Integer"),s=10["$**"](n),l=a(o,s),(i=t(n,1))===u||null==i||i.$$is_boolean&&1!=i?o.$Rational(l.$send(e),s):r(l.$send(e),s).$to_i()},F.$$arity=2)}(c.base,c.get("Numeric")),function(t){var r,n,a=r=f(t,"Kernel"),i=(a.$$proto,a.$$scope);e.defn(a,"$Rational",n=function(e,t){return null==t&&(t=1),i.get("Rational").$convert(e,t)},n.$$arity=-2)}(c.base)},Opal.modules["corelib/time"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function o(e,t){return"number"==typeof e&&"number"==typeof t?e<=t:e["$<="](t)}var s=e.top,l=e,c=e.nil,u=(e.breaker,e.slice),$=e.klass,f=e.range;return e.add_stubs(["$require","$include","$===","$raise","$coerce_to!","$respond_to?","$to_str","$to_i","$new","$<=>","$to_f","$nil?","$>","$<","$strftime","$year","$month","$day","$+","$round","$/","$-","$copy_instance_variables","$initialize_dup","$is_a?","$zero?","$wday","$utc?","$mon","$yday","$hour","$min","$sec","$rjust","$ljust","$zone","$to_s","$[]","$cweek_cyear","$isdst","$<=","$!=","$==","$ceil"]),s.$require("corelib/comparable"),function(s,l){function p(){}function d(e,t,r,n,a,i){if(e=e.$$is_string?parseInt(e,10):ae.get("Opal")["$coerce_to!"](e,ae.get("Integer"),"to_int"),t===c)t=1;else if(!t.$$is_number)if(t["$respond_to?"]("to_str"))switch(t=t.$to_str(),t.toLowerCase()){case"jan":t=1;break;case"feb":t=2;break;case"mar":t=3;break;case"apr":t=4;break;case"may":t=5;break;case"jun":t=6;break;case"jul":t=7;break;case"aug":t=8;break;case"sep":t=9;break;case"oct":t=10;break;case"nov":t=11;break;case"dec":t=12;break;default:t=t.$to_i()}else t=ae.get("Opal")["$coerce_to!"](t,ae.get("Integer"),"to_int");return(t<1||t>12)&&ne.$raise(ae.get("ArgumentError"),"month out of range: "+t),t-=1,r=r===c?1:r.$$is_string?parseInt(r,10):ae.get("Opal")["$coerce_to!"](r,ae.get("Integer"),"to_int"),(r<1||r>31)&&ne.$raise(ae.get("ArgumentError"),"day out of range: "+r),n=n===c?0:n.$$is_string?parseInt(n,10):ae.get("Opal")["$coerce_to!"](n,ae.get("Integer"),"to_int"),(n<0||n>24)&&ne.$raise(ae.get("ArgumentError"),"hour out of range: "+n),a=a===c?0:a.$$is_string?parseInt(a,10):ae.get("Opal")["$coerce_to!"](a,ae.get("Integer"),"to_int"),(a<0||a>59)&&ne.$raise(ae.get("ArgumentError"),"min out of range: "+a),i===c?i=0:i.$$is_number||(i=i.$$is_string?parseInt(i,10):ae.get("Opal")["$coerce_to!"](i,ae.get("Integer"),"to_int")),(i<0||i>60)&&ne.$raise(ae.get("ArgumentError"),"sec out of range: "+i),[e,t,r,n,a,i]}var h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne=p=$(s,l,"Time",p),ae=(ne.$$proto,ne.$$scope);ne.$include(ae.get("Comparable"));var ie=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],oe=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],se=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],le=["January","February","March","April","May","June","July","August","September","October","November","December"];return e.defs(ne,"$at",h=function(e,t){var r,n=this;return ae.get("Time")["$==="](e)?(void 0!==t&&n.$raise(ae.get("TypeError"),"can't convert Time into an exact number"),r=new Date(e.getTime()),r.is_utc=e.is_utc,r):(e.$$is_number||(e=ae.get("Opal")["$coerce_to!"](e,ae.get("Integer"),"to_int")),void 0===t?new Date(1e3*e):(t.$$is_number||(t=ae.get("Opal")["$coerce_to!"](t,ae.get("Integer"),"to_int")),new Date(1e3*e+t/1e3)))},h.$$arity=-2),e.defs(ne,"$new",_=function(e,t,r,n,a,i,o){var s=this;null==t&&(t=c),null==r&&(r=c),null==n&&(n=c),null==a&&(a=c),null==i&&(i=c),null==o&&(o=c);var l,u;return void 0===e?new Date:(o!==c&&s.$raise(ae.get("ArgumentError"),"Opal does not support explicitly specifying UTC offset for Time"),l=d(e,t,r,n,a,i),e=l[0],t=l[1],r=l[2],n=l[3],a=l[4],i=l[5],u=new Date(e,t,r,n,a,0,1e3*i),e<100&&u.setFullYear(e),u)},_.$$arity=-1),e.defs(ne,"$local",g=function(e,t,r,n,a,i,o,s,l,$){null==t&&(t=c),null==r&&(r=c),null==n&&(n=c),null==a&&(a=c),null==i&&(i=c),null==o&&(o=c),null==s&&(s=c),null==l&&(l=c),null==$&&($=c);var f,p;return 10===arguments.length&&(f=u.call(arguments),e=f[5],t=f[4],r=f[3],n=f[2],a=f[1],i=f[0]),f=d(e,t,r,n,a,i),e=f[0],t=f[1],r=f[2],n=f[3],a=f[4],i=f[5],p=new Date(e,t,r,n,a,0,1e3*i),e<100&&p.setFullYear(e),p},g.$$arity=-2),e.defs(ne,"$gm",m=function(e,t,r,n,a,i,o,s,l,$){null==t&&(t=c),null==r&&(r=c),null==n&&(n=c),null==a&&(a=c),null==i&&(i=c),null==o&&(o=c),null==s&&(s=c),null==l&&(l=c),null==$&&($=c);var f,p;return 10===arguments.length&&(f=u.call(arguments),e=f[5],t=f[4],r=f[3],n=f[2],a=f[1],i=f[0]),f=d(e,t,r,n,a,i),e=f[0],t=f[1],r=f[2],n=f[3],a=f[4],i=f[5],p=new Date(Date.UTC(e,t,r,n,a,0,1e3*i)),e<100&&p.setUTCFullYear(e),p.is_utc=!0,p},m.$$arity=-2),function(t){t.$$scope,t.$$proto;e.alias(t,"mktime","local"),e.alias(t,"utc","gm")}(e.get_singleton_class(ne)),e.defs(ne,"$now",y=function(){return this.$new()},y.$$arity=0),e.defn(ne,"$+",v=function(e){var t,r=this;(t=ae.get("Time")["$==="](e))===c||null==t||t.$$is_boolean&&1!=t||r.$raise(ae.get("TypeError"),"time + time?"),e.$$is_number||(e=ae.get("Opal")["$coerce_to!"](e,ae.get("Integer"),"to_int"));var n=new Date(r.getTime()+1e3*e);return n.is_utc=r.is_utc,n},v.$$arity=1),e.defn(ne,"$-",b=function(e){var t,r=this;if((t=ae.get("Time")["$==="](e))!==c&&null!=t&&(!t.$$is_boolean||1==t))return(r.getTime()-e.getTime())/1e3;e.$$is_number||(e=ae.get("Opal")["$coerce_to!"](e,ae.get("Integer"),"to_int"));var n=new Date(r.getTime()-1e3*e);return n.is_utc=r.is_utc,n},b.$$arity=1),e.defn(ne,"$<=>",x=function(e){var n,a=this,i=c;return(n=ae.get("Time")["$==="](e))===c||null==n||n.$$is_boolean&&1!=n?(i=e["$<=>"](a),(n=i["$nil?"]())===c||null==n||n.$$is_boolean&&1!=n?(n=t(i,0))===c||null==n||n.$$is_boolean&&1!=n?(n=r(i,0))===c||null==n||n.$$is_boolean&&1!=n?0:1:-1:c):a.$to_f()["$<=>"](e.$to_f())},x.$$arity=1),e.defn(ne,"$==",w=function(e){return this.$to_f()===e.$to_f()},w.$$arity=1),e.defn(ne,"$asctime",A=function(){return this.$strftime("%a %b %e %H:%M:%S %Y")},A.$$arity=0),e.alias(ne,"ctime","asctime"),e.defn(ne,"$day",k=function(){var e=this;return e.is_utc?e.getUTCDate():e.getDate()},k.$$arity=0),e.defn(ne,"$yday",E=function(){var e=this,t=c,r=c,o=c;return t=ae.get("Time").$new(e.$year()).$to_i(),r=ae.get("Time").$new(e.$year(),e.$month(),e.$day()).$to_i(),o=86400,n(a(i(r,t),o).$round(),1)},E.$$arity=0),e.defn(ne,"$isdst",C=function(){var e=this,t=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),r.getTimezoneOffset())},C.$$arity=0),e.alias(ne,"dst?","isdst"),e.defn(ne,"$dup",S=function(){var e=this,t=c;return t=new Date(e.getTime()),t.$copy_instance_variables(e),t.$initialize_dup(e),t},S.$$arity=0),e.defn(ne,"$eql?",I=function(e){var t,r=this;return t=e["$is_a?"](ae.get("Time")),!1!==t&&t!==c&&null!=t?r["$<=>"](e)["$zero?"]():t},I.$$arity=1),e.defn(ne,"$friday?",O=function(){return 5==this.$wday()},O.$$arity=0),e.defn(ne,"$hash",T=function(){return"Time:"+this.getTime()},T.$$arity=0),e.defn(ne,"$hour",P=function(){var e=this;return e.is_utc?e.getUTCHours():e.getHours()},P.$$arity=0),e.defn(ne,"$inspect",M=function(){var e,t=this;return(e=t["$utc?"]())===c||null==e||e.$$is_boolean&&1!=e?t.$strftime("%Y-%m-%d %H:%M:%S %z"):t.$strftime("%Y-%m-%d %H:%M:%S UTC")},M.$$arity=0),e.alias(ne,"mday","day"),e.defn(ne,"$min",N=function(){var e=this;return e.is_utc?e.getUTCMinutes():e.getMinutes()},N.$$arity=0),e.defn(ne,"$mon",B=function(){var e=this;return(e.is_utc?e.getUTCMonth():e.getMonth())+1},B.$$arity=0),e.defn(ne,"$monday?",R=function(){return 1==this.$wday()},R.$$arity=0),e.alias(ne,"month","mon"),e.defn(ne,"$saturday?",j=function(){return 6==this.$wday()},j.$$arity=0),e.defn(ne,"$sec",F=function(){var e=this;return e.is_utc?e.getUTCSeconds():e.getSeconds()},F.$$arity=0),e.defn(ne,"$succ",D=function(){var e=this,t=new Date(e.getTime()+1e3);return t.is_utc=e.is_utc,t},D.$$arity=0),e.defn(ne,"$usec",L=function(){return 1e3*this.getMilliseconds()},L.$$arity=0),e.defn(ne,"$zone",z=function(){var e,t=this,r=t.toString();return e=-1==r.indexOf("(")?r.match(/[A-Z]{3,4}/)[0]:r.match(/\((.+)\)(?:\s|$)/)[1],"GMT"==e&&/(GMT\W*\d{4})/.test(r)?RegExp.$1:e},z.$$arity=0),e.defn(ne,"$getgm",q=function(){var e=this,t=new Date(e.getTime());return t.is_utc=!0,t},q.$$arity=0),e.alias(ne,"getutc","getgm"),e.defn(ne,"$gmtime",U=function(){var e=this;return e.is_utc=!0,e},U.$$arity=0),e.alias(ne,"utc","gmtime"),e.defn(ne,"$gmt?",H=function(){return!0===this.is_utc},H.$$arity=0),e.defn(ne,"$gmt_offset",G=function(){return 60*-this.getTimezoneOffset()},G.$$arity=0),e.defn(ne,"$strftime",Y=function(e){var t=this;return e.replace(/%([\-_#^0]*:{0,2})(\d+)?([EO]*)(.)/g,function(e,r,n,a,i){var o="",s=-1!==r.indexOf("0"),l=-1===r.indexOf("-"),c=-1!==r.indexOf("_"),u=-1!==r.indexOf("^"),$=-1!==r.indexOf("#"),p=(r.match(":")||[]).length;switch(n=parseInt(n,10),s&&c&&(r.indexOf("0")<r.indexOf("_")?s=!1:c=!1),i){case"Y":o+=t.$year();break;case"C":s=!c,o+=Math.round(t.$year()/100);break;case"y":s=!c,o+=t.$year()%100;break;case"m":s=!c,o+=t.$mon();break;case"B":o+=le[t.$mon()-1];break;case"b":case"h":c=!s,o+=se[t.$mon()-1];break;case"d":s=!c,o+=t.$day();break;case"e":c=!s,o+=t.$day();break;case"j":o+=t.$yday();break;case"H":s=!c,o+=t.$hour();break;case"k":c=!s,o+=t.$hour();break;case"I":s=!c,o+=t.$hour()%12||12;break;case"l":c=!s,o+=t.$hour()%12||12;break;case"P":o+=t.$hour()>=12?"pm":"am";break;case"p":o+=t.$hour()>=12?"PM":"AM";break;case"M":s=!c,o+=t.$min();break;case"S":s=!c,o+=t.$sec();break;case"L":s=!c,n=isNaN(n)?3:n,o+=t.getMilliseconds();break;case"N":n=isNaN(n)?9:n,o+=t.getMilliseconds().toString().$rjust(3,"0"),o=o.$ljust(n,"0");break;case"z":var d=t.getTimezoneOffset(),h=Math.floor(Math.abs(d)/60),_=Math.abs(d)%60;o+=d<0?"+":"-",o+=h<10?"0":"",o+=h,p>0&&(o+=":"),o+=_<10?"0":"",o+=_,p>1&&(o+=":00");break;case"Z":o+=t.$zone();break;case"A":o+=ie[t.$wday()];break;case"a":o+=oe[t.$wday()];break;case"u":o+=t.$wday()+1;break;case"w":o+=t.$wday();break;case"V":o+=t.$cweek_cyear()["$[]"](0).$to_s().$rjust(2,"0");break;case"G":o+=t.$cweek_cyear()["$[]"](1);break;case"g":o+=t.$cweek_cyear()["$[]"](1)["$[]"](f(-2,-1,!1));break;case"s":o+=t.$to_i();break;case"n":o+="\n";break;case"t":o+="\t";break;case"%":o+="%";break;case"c":o+=t.$strftime("%a %b %e %T %Y");break;case"D":case"x":o+=t.$strftime("%m/%d/%y");break;case"F":o+=t.$strftime("%Y-%m-%d");break;case"v":o+=t.$strftime("%e-%^b-%4Y");break;case"r":o+=t.$strftime("%I:%M:%S %p");break;case"R":o+=t.$strftime("%H:%M");break;case"T":case"X":o+=t.$strftime("%H:%M:%S");break;default:return e}return u&&(o=o.toUpperCase()),$&&(o=o.replace(/[A-Z]/,function(e){e.toLowerCase()}).replace(/[a-z]/,function(e){e.toUpperCase()})),l&&(s||c)&&(o=o.$rjust(isNaN(n)?2:n,c?" ":"0")),o})},Y.$$arity=1),e.defn(ne,"$sunday?",Q=function(){return 0==this.$wday()},Q.$$arity=0),e.defn(ne,"$thursday?",V=function(){return 4==this.$wday()},V.$$arity=0),e.defn(ne,"$to_a",X=function(){var e=this;return[e.$sec(),e.$min(),e.$hour(),e.$day(),e.$month(),e.$year(),e.$wday(),e.$yday(),e.$isdst(),e.$zone()]},X.$$arity=0),e.defn(ne,"$to_f",W=function(){return this.getTime()/1e3},W.$$arity=0),e.defn(ne,"$to_i",J=function(){var e=this;return parseInt(e.getTime()/1e3,10)},J.$$arity=0),e.alias(ne,"to_s","inspect"),e.defn(ne,"$tuesday?",K=function(){return 2==this.$wday()},K.$$arity=0),e.alias(ne,"tv_sec","sec"),e.alias(ne,"tv_usec","usec"),e.alias(ne,"utc?","gmt?"),e.alias(ne,"gmtoff","gmt_offset"),e.alias(ne,"utc_offset","gmt_offset"),e.defn(ne,"$wday",Z=function(){var e=this;return e.is_utc?e.getUTCDay():e.getDay()},Z.$$arity=0),e.defn(ne,"$wednesday?",ee=function(){return 3==this.$wday()},ee.$$arity=0),e.defn(ne,"$year",te=function(){var e=this;return e.is_utc?e.getUTCFullYear():e.getFullYear()},te.$$arity=0),e.defn(ne,"$cweek_cyear",re=function(){var e,t,r=this,s=c,l=c,u=c,$=c,f=c,p=c,d=c;return s=ae.get("Time").$new(r.$year(),1,1),l=s.$wday(),0,u=r.$year(),t=o(l,4),(e=!1!==t&&t!==c&&null!=t?l["$!="](0):t)===c||null==e||e.$$is_boolean&&1!=e?($=i(i(l,7),1),$["$=="](-8)&&($=-1)):$=i(l,1),f=a(n(r.$yday(),$),7).$ceil(),(e=o(f,0))===c||null==e||e.$$is_boolean&&1!=e?(f["$=="](53)&&(p=ae.get("Time").$new(r.$year(),12,31),d=p.$wday(),t=o(d,3),(e=!1!==t&&t!==c&&null!=t?d["$!="](0):t)===c||null==e||e.$$is_boolean&&1!=e||(f=1,u=n(u,1))),[f,u]):ae.get("Time").$new(i(r.$year(),1),12,31).$cweek_cyear()},re.$$arity=0),c&&"cweek_cyear"}(l.base,Date)},Opal.modules["corelib/struct"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e>=t:e["$>="](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var i=e.top,o=e,s=e.nil,l=(e.breaker,e.slice,e.klass),c=e.hash2;return e.add_stubs(["$require","$include","$const_name!","$unshift","$map","$coerce_to!","$new","$each","$define_struct_attribute","$allocate","$initialize","$module_eval","$to_proc","$const_set","$==","$raise","$<<","$members","$define_method","$instance_eval","$>","$length","$class","$each_with_index","$[]=","$[]","$hash","$===","$<","$-@","$size","$>=","$include?","$to_sym","$instance_of?","$__id__","$eql?","$enum_for","$name","$+","$join","$inspect","$each_pair","$inject","$flatten","$to_a","$values_at"]),i.$require("corelib/enumerable"),function(i,o){function u(){}var $,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O=u=l(i,null,"Struct",u),T=(O.$$proto,O.$$scope);return O.$include(T.get("Enumerable")),e.defs(O,"$new",$=function(t,r){var n,a,i,o,l,c,u,f=this,p=$.$$p,d=p||s,h=s,_=arguments.length,g=_-1;g<0&&(g=0),u=new Array(g);for(var m=1;m<_;m++)u[m-1]=arguments[m];if($.$$p=null,!1!==t&&t!==s&&null!=t)try{t=T.get("Opal")["$const_name!"](t)}catch(r){if(!e.rescue(r,[T.get("TypeError"),T.get("NameError")]))throw r;try{u.$unshift(t),t=s}finally{e.pop_exception()}}return(n=(a=u).$map,n.$$p=(i=function(e){i.$$s;return null==e&&(e=s),T.get("Opal")["$coerce_to!"](e,T.get("String"),"to_str")},i.$$s=f,i.$$arity=1,i),n).call(a),h=(n=(o=T.get("Class")).$new,n.$$p=(l=function(){var t,r,n,a=l.$$s||this;return(t=(r=u).$each,t.$$p=(n=function(e){var t=n.$$s||this;return null==e&&(e=s),t.$define_struct_attribute(e)},n.$$s=a,n.$$arity=1,n),t).call(r),function(t){var r;t.$$scope,t.$$proto;return e.defn(t,"$new",r=function(t){var r,n,a=this,i=s,o=arguments.length,l=o-0;l<0&&(l=0),n=new Array(l);for(var c=0;c<o;c++)n[c-0]=arguments[c];return i=a.$allocate(),i.$$data={},(r=i).$initialize.apply(r,e.to_a(n)),i},r.$$arity=-1),e.alias(t,"[]","new")}(e.get_singleton_class(a))},l.$$s=f,l.$$arity=0,l),n).call(o,f),!1!==d&&d!==s&&null!=d&&(n=(c=h).$module_eval,n.$$p=d.$to_proc(),n).call(c),!1!==t&&t!==s&&null!=t&&T.get("Struct").$const_set(t,h),h},$.$$arity=-2),e.defs(O,"$define_struct_attribute",f=function(e){var t,r,n,a,i,o=this;return o["$=="](T.get("Struct"))&&o.$raise(T.get("ArgumentError"),"you cannot define attributes to the Struct class"),o.$members()["$<<"](e),(t=(r=o).$define_method,t.$$p=(n=function(){return(n.$$s||this).$$data[e]},n.$$s=o,n.$$arity=0,n),t).call(r,e),(t=(a=o).$define_method,t.$$p=(i=function(t){var r=i.$$s||this;return null==t&&(t=s),r.$$data[e]=t},i.$$s=o,i.$$arity=1,i),t).call(a,e+"=")},f.$$arity=1),e.defs(O,"$members",p=function(){var e,t=this;return null==t.members&&(t.members=s),t["$=="](T.get("Struct"))&&t.$raise(T.get("ArgumentError"),"the Struct class has no members"),!1!==(e=t.members)&&e!==s&&null!=e?e:t.members=[]},p.$$arity=0),e.defs(O,"$inherited",d=function(e){var t,r,n,a=this,i=s;return null==a.members&&(a.members=s),i=a.members,(t=(r=e).$instance_eval,t.$$p=(n=function(){return(n.$$s||this).members=i},n.$$s=a,n.$$arity=0,n),t).call(r)},d.$$arity=1),e.defn(O,"$initialize",h=function(e){var r,n,a,i,o=this,l=arguments.length,c=l-0;c<0&&(c=0),i=new Array(c);for(var u=0;u<l;u++)i[u-0]=arguments[u];return(r=t(i.$length(),o.$class().$members().$length()))===s||null==r||r.$$is_boolean&&1!=r||o.$raise(T.get("ArgumentError"),"struct size differs"),(r=(n=o.$class().$members()).$each_with_index,r.$$p=(a=function(e,t){var r=a.$$s||this;return null==e&&(e=s),null==t&&(t=s),r["$[]="](e,i["$[]"](t))},a.$$s=o,a.$$arity=2,a),r).call(n)},h.$$arity=-1),e.defn(O,"$members",_=function(){return this.$class().$members()},_.$$arity=0),e.defn(O,"$hash",g=function(){var e=this;return T.get("Hash").$new(e.$$data).$hash()},g.$$arity=0),e.defn(O,"$[]",m=function(e){var t,a=this;return(t=T.get("Integer")["$==="](e))===s||null==t||t.$$is_boolean&&1!=t?(t=T.get("String")["$==="](e))===s||null==t||t.$$is_boolean&&1!=t?a.$raise(T.get("TypeError"),"no implicit conversion of "+e.$class()+" into Integer"):a.$$data.hasOwnProperty(e)||a.$raise(T.get("NameError").$new("no member '"+e+"' in struct",e)):((t=r(e,a.$class().$members().$size()["$-@"]()))===s||null==t||t.$$is_boolean&&1!=t||a.$raise(T.get("IndexError"),"offset "+e+" too small for struct(size:"+a.$class().$members().$size()+")"),(t=n(e,a.$class().$members().$size()))===s||null==t||t.$$is_boolean&&1!=t||a.$raise(T.get("IndexError"),"offset "+e+" too large for struct(size:"+a.$class().$members().$size()+")"),e=a.$class().$members()["$[]"](e)),e=T.get("Opal")["$coerce_to!"](e,T.get("String"),"to_str"),a.$$data[e]},m.$$arity=1),e.defn(O,"$[]=",y=function(e,t){var a,i=this;return(a=T.get("Integer")["$==="](e))===s||null==a||a.$$is_boolean&&1!=a?(a=T.get("String")["$==="](e))===s||null==a||a.$$is_boolean&&1!=a?i.$raise(T.get("TypeError"),"no implicit conversion of "+e.$class()+" into Integer"):((a=i.$class().$members()["$include?"](e.$to_sym()))===s||null==a||a.$$is_boolean&&1!=a)&&i.$raise(T.get("NameError").$new("no member '"+e+"' in struct",e)):((a=r(e,i.$class().$members().$size()["$-@"]()))===s||null==a||a.$$is_boolean&&1!=a||i.$raise(T.get("IndexError"),"offset "+e+" too small for struct(size:"+i.$class().$members().$size()+")"),(a=n(e,i.$class().$members().$size()))===s||null==a||a.$$is_boolean&&1!=a||i.$raise(T.get("IndexError"),"offset "+e+" too large for struct(size:"+i.$class().$members().$size()+")"),e=i.$class().$members()["$[]"](e)),e=T.get("Opal")["$coerce_to!"](e,T.get("String"),"to_str"),i.$$data[e]=t},y.$$arity=2),e.defn(O,"$==",v=function(e){function t(e,r){var n,o,s;a[e.$__id__()]=!0,i[r.$__id__()]=!0;for(n in e.$$data)if(o=e.$$data[n],s=r.$$data[n],T.get("Struct")["$==="](o)){if(!(a.hasOwnProperty(o.$__id__())&&i.hasOwnProperty(s.$__id__())||t(o,s)))return!1}else if(!o["$=="](s))return!1;return!0}var r,n=this;if((r=e["$instance_of?"](n.$class()))===s||null==r||r.$$is_boolean&&1!=r)return!1;var a={},i={};return t(n,e)},v.$$arity=1),e.defn(O,"$eql?",b=function(e){function t(e,r){var n,o,s;a[e.$__id__()]=!0,i[r.$__id__()]=!0;for(n in e.$$data)if(o=e.$$data[n],s=r.$$data[n],T.get("Struct")["$==="](o)){if(!(a.hasOwnProperty(o.$__id__())&&i.hasOwnProperty(s.$__id__())||t(o,s)))return!1}else if(!o["$eql?"](s))return!1;return!0}var r,n=this;if((r=e["$instance_of?"](n.$class()))===s||null==r||r.$$is_boolean&&1!=r)return!1;var a={},i={};return t(n,e)},b.$$arity=1),e.defn(O,"$each",x=function(){var t,r,n,a,i,o=this,l=x.$$p,c=l||s;return x.$$p=null,c===s?(t=(r=o).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=o,n.$$arity=0,n),t).call(r,"each"):((t=(a=o.$class().$members()).$each,t.$$p=(i=function(t){var r=i.$$s||this;return null==t&&(t=s),e.yield1(c,r["$[]"](t))},i.$$s=o,i.$$arity=1,i),t).call(a),o)},x.$$arity=0),e.defn(O,"$each_pair",w=function(){var t,r,n,a,i,o=this,l=w.$$p,c=l||s;return w.$$p=null,c===s?(t=(r=o).$enum_for,t.$$p=(n=function(){return(n.$$s||this).$size()},n.$$s=o,n.$$arity=0,n),t).call(r,"each_pair"):((t=(a=o.$class().$members()).$each,t.$$p=(i=function(t){var r=i.$$s||this;return null==t&&(t=s),e.yield1(c,[t,r["$[]"](t)])},i.$$s=o,i.$$arity=1,i),t).call(a),o)},w.$$arity=0),e.defn(O,"$length",A=function(){return this.$class().$members().$length()},A.$$arity=0),e.alias(O,"size","length"),e.defn(O,"$to_a",k=function(){var e,t,r,n=this;return(e=(t=n.$class().$members()).$map,e.$$p=(r=function(e){var t=r.$$s||this;return null==e&&(e=s),t["$[]"](e)},r.$$s=n,r.$$arity=1,r),e).call(t)},k.$$arity=0),e.alias(O,"values","to_a"),e.defn(O,"$inspect",E=function(){var e,t,r,n=this,i=s;return i="#<struct ",t=T.get("Struct")["$==="](n),(e=!1!==t&&t!==s&&null!=t?n.$class().$name():t)===s||null==e||e.$$is_boolean&&1!=e||(i=a(i,n.$class()+" ")),i=a(i,(e=(t=n.$each_pair()).$map,e.$$p=(r=function(e,t){r.$$s;return null==e&&(e=s),null==t&&(t=s),e+"="+t.$inspect()},r.$$s=n,r.$$arity=2,r),e).call(t).$join(", ")),i=a(i,">")},E.$$arity=0),e.alias(O,"to_s","inspect"),e.defn(O,"$to_h",C=function(){var e,t,r,n=this;return(e=(t=n.$class().$members()).$inject,e.$$p=(r=function(e,t){var n=r.$$s||this;return null==e&&(e=s),null==t&&(t=s),e["$[]="](t,n["$[]"](t)),e},r.$$s=n,r.$$arity=2,r),e).call(t,c([],{}))},C.$$arity=0),e.defn(O,"$values_at",S=function(e){var t,r,n,a,i=this,o=arguments.length,l=o-0;l<0&&(l=0),a=new Array(l);for(var c=0;c<o;c++)a[c-0]=arguments[c];a=(t=(r=a).$map,t.$$p=(n=function(e){n.$$s;return null==e&&(e=s),e.$$is_range?e.$to_a():e},n.$$s=i,n.$$arity=1,n),t).call(r).$flatten();for(var u=[],$=0,f=a.length;$<f;$++)a[$].$$is_number||i.$raise(T.get("TypeError"),"no implicit conversion of "+a[$].$class()+" into Integer"),u.push(i["$[]"](a[$]));return u},S.$$arity=-1),e.defs(O,"$_load",I=function(t){var r,n,a=this,i=s;return i=(r=t).$values_at.apply(r,e.to_a(a.$members())),(n=a).$new.apply(n,e.to_a(i))},I.$$arity=1),s&&"_load"}(o.base)},Opal.modules["corelib/io"]=function(e){var t,r,n=(e.top,e),a=e.nil,i=(e.breaker,e.slice,e.klass),o=e.module,s=e.gvars;return e.add_stubs(["$attr_accessor","$size","$write","$join","$map","$String","$empty?","$concat","$chomp","$getbyte","$getc","$raise","$new","$write_proc=","$extend"]),function(t,r){function n(){}var l,c,u,$,f=n=i(t,null,"IO",n),p=f.$$proto,d=f.$$scope;p.tty=p.closed=a,e.cdecl(d,"SEEK_SET",0),e.cdecl(d,"SEEK_CUR",1),e.cdecl(d,"SEEK_END",2),e.defn(f,"$tty?",l=function(){return this.tty},l.$$arity=0),e.defn(f,"$closed?",c=function(){return this.closed},c.$$arity=0),f.$attr_accessor("write_proc"),e.defn(f,"$write",u=function(e){return this.write_proc(e),e.$size()},u.$$arity=1),f.$attr_accessor("sync","tty"),e.defn(f,"$flush",$=function(){return a},$.$$arity=0),function(t){var r,n,i,l,c=r=o(t,"Writable");c.$$proto,c.$$scope;e.defn(c,"$<<",n=function(e){var t=this;return t.$write(e),t},n.$$arity=1),e.defn(c,"$print",i=function(e){var t,r,n,i,o=this;null==s[","]&&(s[","]=a);var l=arguments.length,c=l-0;c<0&&(c=0),i=new Array(c);for(var u=0;u<l;u++)i[u-0]=arguments[u];return o.$write((t=(r=i).$map,t.$$p=(n=function(e){var t=n.$$s||this;return null==e&&(e=a),t.$String(e)},n.$$s=o,n.$$arity=1,n),t).call(r).$join(s[","])),a},i.$$arity=-1),e.defn(c,"$puts",l=function(e){var t,r,n,i,o=this,l=a;null==s["/"]&&(s["/"]=a);var c=arguments.length,u=c-0;u<0&&(u=0),i=new Array(u);for(var $=0;$<c;$++)i[$-0]=arguments[$];return l=s["/"],(t=i["$empty?"]())===a||null==t||t.$$is_boolean&&1!=t?o.$write((t=(r=i).$map,t.$$p=(n=function(e){var t=n.$$s||this;return null==e&&(e=a),t.$String(e).$chomp()},n.$$s=o,n.$$arity=1,n),t).call(r).$concat([a]).$join(l)):o.$write(s["/"]),a},l.$$arity=-1)}(d.base),function(t){var r,n,i,l,c,u=r=o(t,"Readable"),$=(u.$$proto,u.$$scope);e.defn(u,"$readbyte",n=function(){return this.$getbyte()},n.$$arity=0),e.defn(u,"$readchar",i=function(){return this.$getc()},i.$$arity=0),e.defn(u,"$readline",l=function(e){var t=this;return null==s["/"]&&(s["/"]=a),null==e&&(e=s["/"]),t.$raise($.get("NotImplementedError"))},l.$$arity=-1),e.defn(u,"$readpartial",c=function(e,t){var r=this;return null==t&&(t=a),
r.$raise($.get("NotImplementedError"))},c.$$arity=-2)}(d.base)}(n.base),e.cdecl(n,"STDERR",s.stderr=n.get("IO").$new()),e.cdecl(n,"STDIN",s.stdin=n.get("IO").$new()),e.cdecl(n,"STDOUT",s.stdout=n.get("IO").$new()),t=["object"==typeof process?function(e){process.stdout.write(e)}:function(e){console.log(e)}],r=n.get("STDOUT"),r["$write_proc="].apply(r,t),t[t.length-1],t=["object"==typeof process?function(e){process.stderr.write(e)}:function(e){console.warn(e)}],r=n.get("STDERR"),r["$write_proc="].apply(r,t),t[t.length-1],n.get("STDOUT").$extend(n.get("IO").$$scope.get("Writable")),n.get("STDERR").$extend(n.get("IO").$$scope.get("Writable"))},Opal.modules["corelib/main"]=function(e){var t,r,n=e.top,a=e,i=e.nil;e.breaker,e.slice;return e.add_stubs(["$include"]),e.defs(n,"$to_s",t=function(){return"main"},t.$$arity=0),e.defs(n,"$include",r=function(e){return a.get("Object").$include(e)},r.$$arity=1),i&&"include"},Opal.modules["corelib/dir"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.klass);return e.add_stubs(["$[]"]),function(t,a){function i(){}var o=i=n(t,null,"Dir",i);o.$$proto,o.$$scope;return function(t){var n,a,i,o=t.$$scope;t.$$proto;return e.defn(t,"$chdir",n=function(t){var a=n.$$p,i=a||r,o=r;n.$$p=null;try{return o=e.current_dir,e.current_dir=t,e.yieldX(i,[])}finally{e.current_dir=o}},n.$$arity=1),e.defn(t,"$pwd",a=function(){return e.current_dir||"."},a.$$arity=0),e.alias(t,"getwd","pwd"),e.defn(t,"$home",i=function(){var e;return!1!==(e=o.get("ENV")["$[]"]("HOME"))&&e!==r&&null!=e?e:"."},i.$$arity=0),r&&"home"}(e.get_singleton_class(o))}(t.base)},Opal.modules["corelib/file"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}var n=(e.top,e),a=e.nil,i=(e.breaker,e.slice,e.klass),o=e.range;return e.add_stubs(["$join","$compact","$split","$==","$first","$[]=","$home","$pwd","$each","$pop","$<<","$raise","$respond_to?","$to_path","$class","$nil?","$is_a?","$basename","$empty?","$rindex","$[]","$+","$-","$length","$gsub","$find","$=~"]),function(n,s){function l(){}var c=l=i(n,s,"File",l),u=(c.$$proto,c.$$scope);return e.cdecl(u,"Separator",e.cdecl(u,"SEPARATOR","/")),e.cdecl(u,"ALT_SEPARATOR",a),e.cdecl(u,"PATH_SEPARATOR",":"),e.cdecl(u,"FNM_SYSCASE",0),function(n){function i(e){for(var t;e.length>0;)if(u(e)){for(t=e,e=e.substring(1,e.length);e.length>0&&u(e);)e=s(e);if(0==e.length)return t}else e=s(e);return e}function s(e){return e.substring(1,e.length)}function l(e){return e}function c(e){for(var t,r;e.length>0;)if(u(e)){for(t=e,e=s(e);e.length>0&&u(e);)e=s(e);if(!e)break;r=t}else e=s(e);return r}function u(e){return e.charAt(0)===x.get("SEPARATOR")}function $(e){for(;e.length>0&&u(e);)e=s(e);return e}function f(e,t){return 0==e.length?t.length:t.indexOf(e)}function p(e,t,r,n,i,o){var s;return e>=0&&(n===a?t=e:(s=".*"===n?"\\.\\w+":n.replace(/\?/g,"\\?"),s=new RegExp(s+x.get("Separator")+"*$").exec(r),t=s?s.index:e),t===o.length)?i:r.substring(0,t)}var d,h,_,g,m,y,v,b,x=n.$$scope;n.$$proto;return e.defn(n,"$expand_path",d=function(e,t){var r,n,i,o=this,s=a,l=a;return null==t&&(t=a),e=[t,e].$compact().$join(x.get("SEPARATOR")),s=e.$split(x.get("SEPARATOR")),l=[],s.$first()["$=="]("~")&&s["$[]="](0,x.get("Dir").$home()),s.$first()["$=="](".")&&s["$[]="](0,x.get("Dir").$pwd()),(r=(n=s).$each,r.$$p=(i=function(e){i.$$s;return null==e&&(e=a),e["$=="]("..")?l.$pop():l["$<<"](e)},i.$$s=o,i.$$arity=1,i),r).call(n),l.$join(x.get("SEPARATOR"))},d.$$arity=-2),e.alias(n,"realpath","expand_path"),e.defn(n,"$dirname",h=function(e){var t=this;e===a&&t.$raise(x.get("TypeError"),"no implicit conversion of nil into String"),e["$respond_to?"]("to_path")&&(e=e.$to_path()),e.$$is_string||t.$raise(x.get("TypeError"),"no implicit conversion of "+e.$class()+" into String");var r,n;return r=$(e),0==r.length?e=e.substring(e.length-1,e.length):r.length-e.length<0&&(e=e.substring(e.indexOf(r)-1,e.length)),n=c(r),n||(n=r),n===e?".":e.substring(0,e.length-n.length)},h.$$arity=1),e.defn(n,"$basename",_=function(e,t){var r=this;null==t&&(t=a);var n,o,$,d,h,_=0,g=-1;if(e===a&&r.$raise(x.get("TypeError"),"no implicit conversion of nil into String"),e["$respond_to?"]("to_path")&&(e=e.$to_path()),e.$$is_string||r.$raise(x.get("TypeError"),"no implicit conversion of "+e.$class()+" into String"),t===a||t.$$is_string||r.$raise(x.get("TypeError"),"no implicit conversion of "+t.$class()+" into String"),0==e.length)return e;for(h=e,e=l(e);u(e);)d=e,e=s(e);if(e){if(n=c(e))for(;u(n);)n=s(n);else n=e;for(g=f(i(n),n),o=n;f(o,n)<g&&"."===o.charAt(0);o=s(o));for($=null;f(o,n)<g;o=s(o))"."===o.charAt(0)&&($=o);_=$?f($,n):g}else n=d,_=1;return p(g,_,n,t,e,h)},_.$$arity=-2),e.defn(n,"$extname",g=function(e){var n,i,s=this,l=a,c=a;return(n=e["$nil?"]())===a||null==n||n.$$is_boolean&&1!=n||s.$raise(x.get("TypeError"),"no implicit conversion of nil into String"),(n=e["$respond_to?"]("to_path"))===a||null==n||n.$$is_boolean&&1!=n||(e=e.$to_path()),((n=e["$is_a?"](x.get("String")))===a||null==n||n.$$is_boolean&&1!=n)&&s.$raise(x.get("TypeError"),"no implicit conversion of "+e.$class()+" into String"),l=s.$basename(e),(n=l["$empty?"]())===a||null==n||n.$$is_boolean&&1!=n?(c=l["$[]"](o(1,-1,!1)).$rindex("."),(n=!1!==(i=c["$nil?"]())&&i!==a&&null!=i?i:t(c,1)["$=="](r(l.$length(),1)))===a||null==n||n.$$is_boolean&&1!=n?l["$[]"](o(t(c,1),-1,!1)):""):""},g.$$arity=1),e.defn(n,"$exist?",m=function(t){return null!=e.modules[t]},m.$$arity=1),e.alias(n,"exists?","exist?"),e.defn(n,"$directory?",y=function(t){var r,n,i,o=this,s=a;s=[];for(var l in e.modules)s.push(l);return t=t.$gsub(new RegExp("(^."+x.get("SEPARATOR")+"+|"+x.get("SEPARATOR")+"+$)")),(r=(n=s).$find,r.$$p=(i=function(e){i.$$s;return null==e&&(e=a),e["$=~"](new RegExp("^"+t))},i.$$s=o,i.$$arity=1,i),r).call(n)},y.$$arity=1),e.defn(n,"$join",v=function(e){var t,r=arguments.length,n=r-0;n<0&&(n=0),t=new Array(n);for(var a=0;a<r;a++)t[a-0]=arguments[a];return t.$join(x.get("SEPARATOR")).$gsub(new RegExp(x.get("SEPARATOR")+"+"),x.get("SEPARATOR"))},v.$$arity=-1),e.defn(n,"$split",b=function(e){return e.$split(x.get("SEPARATOR"))},b.$$arity=1),a&&"split"}(e.get_singleton_class(c))}(n.base,n.get("IO"))},Opal.modules["corelib/process"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.klass);return e.add_stubs(["$to_f","$now","$new"]),function(t,a){function i(){}var o,s,l,c=i=n(t,null,"Process",i),u=(c.$$proto,c.$$scope);e.cdecl(u,"CLOCK_REALTIME",0),e.cdecl(u,"CLOCK_MONOTONIC",1),e.defs(c,"$pid",o=function(){return 0},o.$$arity=0),e.defs(c,"$times",s=function(){var e=r;return e=u.get("Time").$now().$to_f(),u.get("Benchmark").$$scope.get("Tms").$new(e,e,e,e,e)},s.$$arity=0),e.defs(c,"$clock_gettime",l=function(e,t){return null==t&&(t=r),u.get("Time").$now().$to_f()},l.$$arity=-2)}(t.base),function(t,a){function i(){}var o,s=i=n(t,null,"Signal",i);s.$$proto,s.$$scope;e.defs(s,"$trap",o=function(e){return r},o.$$arity=-1)}(t.base),function(t,a){function i(){}var o,s=i=n(t,null,"GC",i);s.$$proto,s.$$scope;return e.defs(s,"$start",o=function(){return r},o.$$arity=0),r&&"start"}(t.base)},Opal.modules["corelib/unsupported"]=function(e){function t(t){switch(e.config.unsupported_features_severity){case"error":o.get("Kernel").$raise(o.get("NotImplementedError"),t);break;case"warning":r(t)}}function r(e){u[e]||(u[e]=!0,i.$warn(e))}var n,a,i=e.top,o=e,s=e.nil,l=(e.breaker,e.slice,e.klass),c=e.module;e.add_stubs(["$raise","$warn","$%"]);var u={};return function(t,r){function n(){}var a,i,o,s,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w=n=l(t,null,"String",n),A=(w.$$proto,w.$$scope),k="String#%s not supported. Mutable String methods are not supported in Opal.";e.defn(w,"$<<",a=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("<<"))},a.$$arity=-1),e.defn(w,"$capitalize!",i=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("capitalize!"))},i.$$arity=-1),e.defn(w,"$chomp!",o=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("chomp!"))},o.$$arity=-1),e.defn(w,"$chop!",s=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("chop!"))},s.$$arity=-1),e.defn(w,"$downcase!",c=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("downcase!"))},c.$$arity=-1),e.defn(w,"$gsub!",u=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("gsub!"))},u.$$arity=-1),e.defn(w,"$lstrip!",$=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("lstrip!"))},$.$$arity=-1),e.defn(w,"$next!",f=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("next!"))},f.$$arity=-1),e.defn(w,"$reverse!",p=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("reverse!"))},p.$$arity=-1),e.defn(w,"$slice!",d=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("slice!"))},d.$$arity=-1),e.defn(w,"$squeeze!",h=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("squeeze!"))},h.$$arity=-1),e.defn(w,"$strip!",_=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("strip!"))},_.$$arity=-1),e.defn(w,"$sub!",g=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("sub!"))},g.$$arity=-1),e.defn(w,"$succ!",m=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("succ!"))},m.$$arity=-1),e.defn(w,"$swapcase!",y=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("swapcase!"))},y.$$arity=-1),e.defn(w,"$tr!",v=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("tr!"))},v.$$arity=-1),e.defn(w,"$tr_s!",b=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("tr_s!"))},b.$$arity=-1),e.defn(w,"$upcase!",x=function(e){return this.$raise(A.get("NotImplementedError"),k["$%"]("upcase!"))},x.$$arity=-1)}(o.base),function(r){var n,a,i,o=n=c(r,"Kernel"),s=(o.$$proto,o.$$scope,"Object freezing is not supported by Opal");e.defn(o,"$freeze",a=function(){var e=this;return t(s),e},a.$$arity=0),e.defn(o,"$frozen?",i=function(){return t(s),!1},i.$$arity=0)}(o.base),function(r){var n,a,i,o,s=n=c(r,"Kernel"),l=(s.$$proto,s.$$scope,"Object tainting is not supported by Opal");e.defn(s,"$taint",a=function(){var e=this;return t(l),e},a.$$arity=0),e.defn(s,"$untaint",i=function(){var e=this;return t(l),e},i.$$arity=0),e.defn(s,"$tainted?",o=function(){return t(l),!1},o.$$arity=0)}(o.base),function(t,r){function n(){}var a,i,o,c,u=n=l(t,null,"Module",n);u.$$proto,u.$$scope;e.defn(u,"$public",a=function(e){var t,r=this,n=arguments.length,a=n-0;a<0&&(a=0),t=new Array(a);for(var i=0;i<n;i++)t[i-0]=arguments[i];return 0===t.length&&(r.$$module_function=!1),s},a.$$arity=-1),e.alias(u,"private","public"),e.alias(u,"protected","public"),e.alias(u,"nesting","public"),e.defn(u,"$private_class_method",i=function(e){return this},i.$$arity=-1),e.alias(u,"public_class_method","private_class_method"),e.defn(u,"$private_method_defined?",o=function(e){return!1},o.$$arity=1),e.defn(u,"$private_constant",c=function(e){return s},c.$$arity=-1),e.alias(u,"protected_method_defined?","private_method_defined?"),e.alias(u,"public_instance_methods","instance_methods"),e.alias(u,"public_method_defined?","method_defined?")}(o.base),function(t){var r,n,a=r=c(t,"Kernel");a.$$proto,a.$$scope;e.defn(a,"$private_methods",n=function(e){return[]},n.$$arity=-1),e.alias(a,"private_instance_methods","private_methods")}(o.base),function(t){var r,n,a=r=c(t,"Kernel"),i=(a.$$proto,a.$$scope);e.defn(a,"$eval",n=function(e){return this.$raise(i.get("NotImplementedError"),"To use Kernel#eval, you must first require 'opal-parser'. See https://github.com/opal/opal/blob/"+i.get("RUBY_ENGINE_VERSION")+"/docs/opal_parser.md for details.")},n.$$arity=-1)}(o.base),e.defs(i,"$public",n=function(e){return s},n.$$arity=-1),e.defs(i,"$private",a=function(e){return s},a.$$arity=-1),s&&"private"},Opal.modules.opal=function(e){var t=e.top;e.nil,e.breaker,e.slice;return e.add_stubs(["$require"]),t.$require("opal/base"),t.$require("opal/mini"),t.$require("corelib/string/inheritance"),t.$require("corelib/string/encoding"),t.$require("corelib/math"),t.$require("corelib/complex"),t.$require("corelib/rational"),t.$require("corelib/time"),t.$require("corelib/struct"),t.$require("corelib/io"),t.$require("corelib/main"),t.$require("corelib/dir"),t.$require("corelib/file"),t.$require("corelib/process"),t.$require("corelib/unsupported")},Opal.modules["opal-platform"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,r),a=r,i=r;return"undefined"!=typeof document,n="undefined"!=typeof process&&process.versions&&process.versions.node,a="undefined"!=typeof Java&&Java.type,i="undefined"!=typeof navigator&&/\bHeadlessChrome\//.test(navigator.userAgent),function(){return!1!==a&&a!==r&&null!=a?e.cdecl(t,"OPAL_PLATFORM","nashorn"):!1!==n&&n!==r&&null!=n?e.cdecl(t,"OPAL_PLATFORM","nodejs"):!1!==i&&i!==r&&null!=i?e.cdecl(t,"OPAL_PLATFORM","headless-chrome"):e.cdecl(t,"OPAL_PLATFORM",r)}()},Opal.modules["nodejs/kernel"]=function(e){var t,r,n=(e.top,e),a=e.nil,i=(e.breaker,e.slice,e.module);return e.add_stubs(["$to_str","$new","$to_s"]),e.exit=process.exit,function(t){var r,n,a,o=r=i(t,"Kernel"),s=(o.$$proto,o.$$scope);e.cdecl(s,"NODE_REQUIRE",require),e.defn(o,"$caller",n=function(){var e;try{throw Error("my error")}catch(t){e=t.stack}return e.$split("\n").slice(3)},n.$$arity=0),e.defn(o,"$node_require",a=function(e){return s.get("NODE_REQUIRE")(e.$to_str())},a.$$arity=1)}(n.base),e.cdecl(n,"ARGV",process.argv.slice(2)),e.cdecl(n,"ENV",n.get("Object").$new()),e.defs(n.get("ENV"),"$[]=",t=function(e,t){return process.env[e.$to_s()]=t.$to_s()},t.$$arity=2),e.defs(n.get("ENV"),"$[]",r=function(e){return process.env[e]||a},r.$$arity=1),a&&"[]"},Opal.modules["nodejs/file"]=function(e){function t(t){switch(e.config.unsupported_features_severity){case"error":a.get("Kernel").$raise(a.get("NotImplementedError"),t);break;case"warning":r(t)}}function r(e){s[e]||(s[e]=!0,n.$warn(e))}var n=e.top,a=e,i=e.nil,o=(e.breaker,e.slice,e.klass);e.add_stubs(["$raise","$warn","$include","$node_require","$size","$respond_to?","$path","$join","$message","$error","$call","$exist?","$new","$close","$match","$gsub","$attr_reader"]);var s={};return function(r,n){function a(){}var s,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w=a=o(r,n,"File",a),A=w.$$proto,k=w.$$scope;null==w.__fs__&&(w.__fs__=i),null==w.__path__&&(w.__path__=i),A.fd=A.path=i,w.$include(e.get("IO").$$scope.get("Writable")),w.$include(e.get("IO").$$scope.get("Readable")),w.__fs__=w.$node_require("fs"),w.__path__=w.$node_require("path");var E=w.__fs__,C=w.__path__;e.defs(w,"$read",s=function(e){return E.readFileSync(e).toString()},s.$$arity=1),e.defs(w,"$write",l=function(e,t){return E.writeFileSync(e,t),t.$size()},l.$$arity=2),e.defs(w,"$exist?",c=function(e){var t;return(t=e["$respond_to?"]("path"))===i||null==t||t.$$is_boolean&&1!=t||(e=e.$path()),E.existsSync(e)},c.$$arity=1),e.defs(w,"$realpath",u=function(e,t,r){var n=this,a=u.$$p,o=a||i;if(null==t&&(t=i),null==r&&(r=i),u.$$p=null,!1!==t&&t!==i&&null!=t&&(e=n.$join(t,e)),o===i)return E.realpathSync(e,r);E.realpath(e,r,function(e,t){e?n.$raise(n.$error().$message()):o.$call(t)})},u.$$arity=-2),e.defs(w,"$join",$=function(e){var t,r=arguments.length,n=r-0;n<0&&(n=0),t=new Array(n);for(var a=0;a<r;a++)t[a-0]=arguments[a];return C.join.apply(C,t)},$.$$arity=-1),e.defs(w,"$directory?",f=function(e){var t;return(t=this["$exist?"](e))===i||null==t||t.$$is_boolean&&1!=t?i:!!E.lstatSync(e).isDirectory()},f.$$arity=1),e.defs(w,"$file?",p=function(e){var t;return(t=this["$exist?"](e))===i||null==t||t.$$is_boolean&&1!=t?i:!!E.lstatSync(e).isFile()},p.$$arity=1),e.defs(w,"$size",d=function(e){var t;return(t=this["$exist?"](e))===i||null==t||t.$$is_boolean&&1!=t?i:E.lstatSync(e).size},d.$$arity=1),e.defs(w,"$open",h=function(t,r){var n=this,a=h.$$p,o=a||i,s=i;if(h.$$p=null,s=n.$new(t,r),o===i)return s;try{return e.yield1(o,s)}finally{s.$close()}},h.$$arity=2),e.defs(w,"$stat",_=function(e){var t;return(t=e["$respond_to?"]("path"))===i||null==t||t.$$is_boolean&&1!=t||(e=e.$path()),k.get("File").$$scope.get("Stat").$new(e)},_.$$arity=1),e.defs(w,"$mtime",g=function(e){return E.statSync(e).mtime},g.$$arity=1),e.defn(w,"$initialize",m=function(e,r){var n,a=this,o=i,s=i;return o=/b/,s=/:(.*)/,(n=r.$match(o))===i||null==n||n.$$is_boolean&&1!=n||t("Binary flag (b) is unsupported by Node.js openSync method, removing flag."),r=r.$gsub(o,""),(n=r.$match(s))===i||null==n||n.$$is_boolean&&1!=n||t("Encoding flag (:encoding) is unsupported by Node.js openSync method, removing flag."),r=r.$gsub(s,""),a.path=e,a.flags=r,a.fd=E.openSync(e,r)},m.$$arity=2),w.$attr_reader("path"),e.defn(w,"$write",y=function(e){var t=this;return E.writeSync(t.fd,e)},y.$$arity=1),e.defn(w,"$flush",v=function(){var e=this;return E.fsyncSync(e.fd)},v.$$arity=0),e.defn(w,"$close",b=function(){var e=this;return E.closeSync(e.fd)},b.$$arity=0),e.defn(w,"$mtime",x=function(){var e=this;return E.statSync(e.path).mtime},x.$$arity=0)}(a.base,a.get("IO")),function(t,r){function n(){}var a,s,l,c=n=o(t,null,"Stat",n),u=c.$$proto;c.$$scope;null==c.__fs__&&(c.__fs__=i),u.path=i,c.__fs__=c.$node_require("fs");var $=c.__fs__;return e.defn(c,"$initialize",a=function(e){return this.path=e},a.$$arity=1),e.defn(c,"$file?",s=function(){var e=this;return $.statSync(e.path).isFile()},s.$$arity=0),e.defn(c,"$mtime",l=function(){var e=this;return $.statSync(e.path).mtime},l.$$arity=0),i&&"mtime"}(a.get("File"))},Opal.modules["nodejs/dir"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.klass);return e.add_stubs(["$node_require"]),function(t,a){function i(){}var o=i=n(t,null,"Dir",i);o.$$proto,o.$$scope;null==o.__glob__&&(o.__glob__=r),null==o.__fs__&&(o.__fs__=r),o.__glob__=o.$node_require("glob"),o.__fs__=o.$node_require("fs");var s=o.__glob__,l=o.__fs__;return function(t){var r,n,a,i;t.$$scope,t.$$proto;return e.defn(t,"$[]",r=function(e){return s.sync(e)},r.$$arity=1),e.defn(t,"$pwd",n=function(){return process.cwd()},n.$$arity=0),e.defn(t,"$mkdir",a=function(e){return l.mkdirSync(e)},a.$$arity=1),e.defn(t,"$entries",i=function(e){for(var t=[],r=l.readdirSync(e),n=0;n<r.length;n++)t.push(r[n]);return t},i.$$arity=1),e.alias(t,"getwd","pwd")}(e.get_singleton_class(o))}(t.base)},Opal.modules["nodejs/io"]=function(e){var t,r,n,a,i,o,s,l=e.top,c=e,u=e.nil,$=(e.breaker,e.slice,e.klass),f=e.gvars;return e.add_stubs(["$node_require","$attr_reader","$size","$to_enum","$read","$chomp","$each_line","$write_proc=","$lambda","$tty="]),function(t,r){function n(){}var a,i,o,s=n=$(t,null,"IO",n),l=s.$$proto,c=s.$$scope;null==s.__fs__&&(s.__fs__=u),l.eof=l.path=u,s.__fs__=s.$node_require("fs");var p=s.__fs__;s.$attr_reader("eof"),s.$attr_reader("lineno"),e.defn(s,"$initialize",a=function(){var e=this;return e.eof=!1,e.lineno=0},a.$$arity=0),e.defn(s,"$read",i=function(){var e,t=this,r=u;return(e=t.eof)===u||null==e||e.$$is_boolean&&1!=e?(r=p.readFileSync(t.path).toString(),t.eof=!0,t.lineno=r.$size(),r):""},i.$$arity=0),e.defn(s,"$each_line",o=function(t){var r,n=this,a=o.$$p,i=a||u,s=u;if(null==f["/"]&&(f["/"]=u),null==t&&(t=f["/"]),o.$$p=null,(r=n.eof)!==u&&null!=r&&(!r.$$is_boolean||1==r))return function(){return i!==u?n:[].$to_enum()}();if(i!==u){s=c.get("File").$read(n.path),n.eof=!1,n.lineno=0;for(var l=s.$chomp(),$=s.length!=l.length,p=l.split(t),d=0,h=p.length;d<h;d++)n.lineno+=1,d<h-1||$?e.yield1(i,p[d]+t):e.yield1(i,p[d]);return n.eof=!0,n}return n.$read().$each_line()},o.$$arity=-1)}(c.base),t=[(n=(a=l).$lambda,n.$$p=(i=function(e){i.$$s;return null==e&&(e=u),process.stdout.write(e)},i.$$s=l,i.$$arity=1,i),n).call(a)],r=c.get("STDOUT"),r["$write_proc="].apply(r,t),t[t.length-1],t=[(n=(o=l).$lambda,n.$$p=(s=function(e){s.$$s;return null==e&&(e=u),process.stderr.write(e)},s.$$s=l,s.$$arity=1,s),n).call(o)],r=c.get("STDERR"),r["$write_proc="].apply(r,t),t[t.length-1],t=[!0],r=c.get("STDOUT"),r["$tty="].apply(r,t),t[t.length-1],t=[!0],r=c.get("STDERR"),r["$tty="].apply(r,t),t[t.length-1]},Opal.modules.nodejs=function(e){var t=e.top,r=e,n=(e.nil,e.breaker,e.slice,e.module);return e.add_stubs(["$require"]),function(e){var t,r=t=n(e,"NodeJS");r.$$proto,r.$$scope}(r.base),t.$require("nodejs/kernel"),t.$require("nodejs/file"),t.$require("nodejs/dir"),t.$require("nodejs/io")},Opal.modules["nodejs/fileutils"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.module);return e.add_stubs(["$extend","$===","$raise","$each","$Array","$directory?","$join","$basename"]),function(t){var a,i,o,s,l,c,u=a=n(t,"FileUtils"),$=(u.$$proto,u.$$scope);u.$extend(u);var f=$.get("File").__fs__;e.defn(u,"$chmod",i=function(e,t){var n,a,i,o=this;return(n=$.get("String")["$==="](e))===r||null==n||n.$$is_boolean&&1!=n||o.$raise($.get("NotImplementedError"),"symbolic mode is not supported, use numeric mode"),(n=(a=o.$Array(t)).$each,n.$$p=(i=function(t){i.$$s;return null==t&&(t=r),f.chmodSync(e,t)},i.$$s=o,i.$$arity=1,i),n).call(a)},i.$$arity=2),e.defn(u,"$cp",o=function(e,t){var n;(n=$.get("File")["$directory?"](t))===r||null==n||n.$$is_boolean&&1!=n||(t=$.get("File").$join(t,$.get("File").$basename(e))),f.writeFileSync(t,f.readFileSync(e))},o.$$arity=2),e.defn(u,"$rm",s=function(e){return f.unlinkSync(e)},s.$$arity=1),e.defn(u,"$mkdir_p",l=function(e){var t;return!((t=$.get("File")["$directory?"](e))===r||null==t||t.$$is_boolean&&1!=t)||f.mkdirSync(e)},l.$$arity=1),e.alias(u,"mkpath","mkdir_p"),e.alias(u,"makedirs","mkdir_p"),e.defn(u,"$mv",c=function(e,t){var n;return(n=$.get("File")["$directory?"](t))===r||null==n||n.$$is_boolean&&1!=n||(t=$.get("File").$join(t,$.get("File").$basename(e))),f.renameSync(e,t)},c.$$arity=2)}(t.base)},Opal.modules["vector2d/calculations"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var a=(e.top,e),i=e.nil,o=(e.breaker,e.slice,e.klass),s=e.module;return e.add_stubs(["$-","$*","$x","$y","$+","$normalized?","$normalize","$acos","$dot_product","$calculate_each","$sqrt","$squared_distance","$coerce","$class","$cross_product","$angle_between","$private","$new","$send"]),function(a,l){function c(){}var u=c=o(a,null,"Vector2d",c),$=(u.$$proto,u.$$scope);return function(a){var o,l,c,u,$,f,p,d,h,_,g,m=o=s(a,"Calculations"),y=(m.$$proto,m.$$scope);!function(a){var o,l,c,u,$=o=s(a,"ClassMethods"),f=($.$$proto,$.$$scope);e.defn($,"$cross_product",l=function(e,n){return t(r(e.$x(),n.$y()),r(e.$y(),n.$x()))},l.$$arity=2),e.defn($,"$dot_product",c=function(e,t){return n(r(e.$x(),t.$x()),r(e.$y(),t.$y()))},c.$$arity=2),e.defn($,"$angle_between",u=function(e,t){var r,n=this,a=i,o=i;return a=function(){return(r=e["$normalized?"]())===i||null==r||r.$$is_boolean&&1!=r?e.$normalize():e}(),o=function(){return(r=t["$normalized?"]())===i||null==r||r.$$is_boolean&&1!=r?t.$normalize():t}(),f.get("Math").$acos(n.$dot_product(a,o))},u.$$arity=2)}(y.base),e.defn(m,"$*",l=function(e){return this.$calculate_each("*",e)},l.$$arity=1),e.defn(m,"$/",c=function(e){return this.$calculate_each("/",e)},c.$$arity=1),e.defn(m,"$+",u=function(e){return this.$calculate_each("+",e)},u.$$arity=1),e.defn(m,"$-",$=function(e){return this.$calculate_each("-",e)},$.$$arity=1),e.defn(m,"$distance",f=function(e){var t=this;return y.get("Math").$sqrt(t.$squared_distance(e))},f.$$arity=1),e.defn(m,"$squared_distance",p=function(a){var o,s,l=this,c=i,u=i,$=i;return s=l.$coerce(a),o=e.to_ary(s),c=null==o[0]?i:o[0],null==o[1]?i:o[1],u=t(c.$x(),l.$x()),$=t(c.$y(),l.$y()),n(r(u,u),r($,$))},p.$$arity=1),e.defn(m,"$dot_product",d=function(t){var r,n,a=this,o=i;return n=a.$coerce(t),r=e.to_ary(n),o=null==r[0]?i:r[0],null==r[1]?i:r[1],a.$class().$dot_product(a,o)},d.$$arity=1),e.defn(m,"$cross_product",h=function(t){var r,n,a=this,o=i;return n=a.$coerce(t),r=e.to_ary(n),o=null==r[0]?i:r[0],null==r[1]?i:r[1],a.$class().$cross_product(a,o)},h.$$arity=1),e.defn(m,"$angle_between",_=function(t){var r,n,a=this,o=i;return n=a.$coerce(t),r=e.to_ary(n),o=null==r[0]?i:r[0],null==r[1]?i:r[1],a.$class().$angle_between(a,o)},_.$$arity=1),m.$private(),e.defn(m,"$calculate_each",g=function(t,r){var n,a,o=this,s=i;return a=o.$coerce(r),n=e.to_ary(a),s=null==n[0]?i:n[0],null==n[1]?i:n[1],o.$class().$new(o.$x().$send(t,s.$x()),o.$y().$send(t,s.$y()))},g.$$arity=2)}($.base)}(a.base)},Opal.modules["vector2d/coercions"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.klass),a=e.module,i=e.hash2;return e.add_stubs(["$===","$parse","$raise","$class","$x","$y","$new","$to_i","$to_f"]),function(t,o){function s(){}var l=s=n(t,null,"Vector2d",s),c=(l.$$proto,l.$$scope);return function(t){var n,o,s,l,c,u,$,f,p=n=a(t,"Coercions"),d=(p.$$proto,p.$$scope);e.defn(p,"$coerce",o=function(e){var t=this,n=r;return function(){return n=e,d.get("Vector2d")["$==="](n)?[e,t]:d.get("Array")["$==="](n)||d.get("Numeric")["$==="](n)||d.get("String")["$==="](n)||d.get("Hash")["$==="](n)?[d.get("Vector2d").$parse(e),t]:t.$raise(d.get("TypeError"),t.$class()+" can't be coerced into "+e.$class())}()},o.$$arity=1),e.defn(p,"$inspect",s=function(){var e=this;return"Vector2d("+e.$x()+","+e.$y()+")"},s.$$arity=0),e.defn(p,"$to_a",l=function(){var e=this;return[e.$x(),e.$y()]},l.$$arity=0),e.defn(p,"$to_hash",c=function(){var e=this;return i(["x","y"],{x:e.$x(),y:e.$y()})},c.$$arity=0),e.defn(p,"$to_i_vector",u=function(){var e=this;return e.$class().$new(e.$x().$to_i(),e.$y().$to_i())},u.$$arity=0),e.defn(p,"$to_f_vector",$=function(){var e=this;return e.$class().$new(e.$x().$to_f(),e.$y().$to_f())},$.$$arity=0),e.defn(p,"$to_s",f=function(){var e=this;return e.$x()+"x"+e.$y()},f.$$arity=0)}(c.base)}(t.base)},Opal.modules["vector2d/fitting"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}var i=(e.top,e),o=e.nil,s=(e.breaker,e.slice,e.klass),l=e.module;return e.add_stubs(["$coerce","$>","$x","$y","$fit","$/","$to_f_vector","$*","$==","$<","$alias_method"]),function(i,c){function u(){}var $=u=s(i,null,"Vector2d",u),f=($.$$proto,$.$$scope);return function(i){var s,c,u,$,f=s=l(i,"Fitting");f.$$proto,f.$$scope;e.defn(f,"$contain",c=function(r){var n,a,i=this,s=o;return a=i.$coerce(r),n=e.to_ary(a),s=null==n[0]?o:n[0],null==n[1]?o:n[1],(n=!1!==(a=t(s.$x(),i.$x()))&&a!==o&&null!=a?a:t(s.$y(),i.$y()))===o||null==n||n.$$is_boolean&&1!=n?r:r.$fit(i)},c.$$arity=1),e.defn(f,"$fit",u=function(i){var s,l,c,u=this,$=o,f=o;return l=u.$coerce(i),s=e.to_ary(l),$=null==s[0]?o:s[0],null==s[1]?o:s[1],f=r($.$to_f_vector(),u),n(u,function(){return(s=!1!==(l=f.$y()["$=="](0))&&l!==o&&null!=l?l:(c=t(f.$x(),0),!1!==c&&c!==o&&null!=c?a(f.$x(),f.$y()):c))===o||null==s||s.$$is_boolean&&1!=s?f.$y():f.$x()}())},u.$$arity=1),f.$alias_method("constrain_both","fit"),e.defn(f,"$fit_either",$=function(i){var s,l,c=this,u=o,$=o;return l=c.$coerce(i),s=e.to_ary(l),u=null==s[0]?o:s[0],null==s[1]?o:s[1],$=r(u.$to_f_vector(),c),l=t($.$x(),0),(s=!1!==l&&l!==o&&null!=l?t($.$y(),0):l)===o||null==s||s.$$is_boolean&&1!=s?c.$fit(u):($=function(){return(s=a($.$x(),$.$y()))===o||null==s||s.$$is_boolean&&1!=s?$.$x():$.$y()}(),n(c,$))},$.$$arity=1),f.$alias_method("constrain_one","fit_either")}(f.base)}(i.base)},Opal.modules["vector2d/properties"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}var a=(e.top,e),i=(e.nil,e.breaker,e.slice,e.klass),o=e.module;return e.add_stubs(["$atan2","$y","$x","$abs","$/","$to_f","$sqrt","$squared_length","$+","$*","$==","$length"]),function(a,s){function l(){}var c=l=i(a,null,"Vector2d",l),u=(c.$$proto,c.$$scope);return function(a){var i,s,l,c,u,$,f=i=o(a,"Properties"),p=(f.$$proto,f.$$scope);e.defn(f,"$angle",s=function(){var e=this;return p.get("Math").$atan2(e.$y(),e.$x())},s.$$arity=0),e.defn(f,"$aspect_ratio",l=function(){var e=this;return t(e.$x().$to_f(),e.$y().$to_f()).$abs()},l.$$arity=0),e.defn(f,"$length",c=function(){var e=this;return p.get("Math").$sqrt(e.$squared_length())},c.$$arity=0),e.defn(f,"$squared_length",u=function(){var e=this;return r(n(e.$x(),e.$x()),n(e.$y(),e.$y()))},u.$$arity=0),e.defn(f,"$normalized?",$=function(){return this.$length().$to_f()["$=="](1)},$.$$arity=0)}(u.base)}(a.base)},Opal.modules["vector2d/transformations"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var i=(e.top,e),o=(e.nil,e.breaker,e.slice,e.klass),s=e.module;return e.add_stubs(["$new","$class","$ceil","$x","$y","$floor","$resize","$-@","$*","$/","$length","$-","$cos","$sin","$+","$round","$min"]),function(i,l){function c(){}var u=c=o(i,null,"Vector2d",c),$=(u.$$proto,u.$$scope);return function(i){var o,l,c,u,$,f,p,d,h,_,g=o=s(i,"Transformations"),m=(g.$$proto,g.$$scope);e.defn(g,"$ceil",l=function(){var e=this;return e.$class().$new(e.$x().$ceil(),e.$y().$ceil())},l.$$arity=0),e.defn(g,"$floor",c=function(){var e=this;return e.$class().$new(e.$x().$floor(),e.$y().$floor())},c.$$arity=0),e.defn(g,"$normalize",u=function(){return this.$resize(1)},u.$$arity=0),e.defn(g,"$perpendicular",$=function(){var e=this;return m.get("Vector2d").$new(e.$y()["$-@"](),e.$x())},$.$$arity=0),e.defn(g,"$resize",f=function(e){var n=this;return t(n,r(e,n.$length()))},f.$$arity=1),e.defn(g,"$reverse",p=function(){var e=this;return e.$class().$new(e.$x()["$-@"](),e.$y()["$-@"]())},p.$$arity=0),e.defn(g,"$rotate",d=function(e){var r=this;return m.get("Vector2d").$new(n(t(r.$x(),m.get("Math").$cos(e)),t(r.$y(),m.get("Math").$sin(e))),a(t(r.$x(),m.get("Math").$sin(e)),t(r.$y(),m.get("Math").$cos(e))))},d.$$arity=1),e.defn(g,"$round",h=function(e){var t=this;return null==e&&(e=0),t.$class().$new(t.$x().$round(e),t.$y().$round(e))},h.$$arity=-1),e.defn(g,"$truncate",_=function(e){var t=this;return t.$resize([e,t.$length()].$min())},_.$$arity=1)}($.base)}(i.base)},Opal.modules["vector2d/version"]=function(e){var t=(e.top,e),r=(e.nil,e.breaker,e.slice,e.klass);return function(t,n){function a(){}var i=a=r(t,null,"Vector2d",a),o=(i.$$proto,i.$$scope);return e.cdecl(o,"VERSION","2.1.0")}(t.base)},Opal.modules.vector2d=function(e){var t,r=e.top,n=e,a=e.nil,i=(e.breaker,e.slice,e.klass);return e.add_stubs(["$require","$extend","$include","$nil?","$parse_single_arg","$new","$private","$===","$parse","$parse_str","$parse_hash","$dup","$has_key?","$[]","$[]=","$=~","$map","$to_proc","$split","$raise","$attr_reader","$x","$y"]),r.$require("vector2d/calculations"),r.$require("vector2d/coercions"),r.$require("vector2d/fitting"),r.$require("vector2d/properties"),r.$require("vector2d/transformations"),r.$require("vector2d/version"),function(t,r){function n(){}var o,s,l=n=i(t,null,"Vector2d",n),c=(l.$$proto,l.$$scope);l.$extend(c.get("Vector2d").$$scope.get("Calculations").$$scope.get("ClassMethods")),l.$include(c.get("Vector2d").$$scope.get("Calculations")),l.$include(c.get("Vector2d").$$scope.get("Coercions")),l.$include(c.get("Vector2d").$$scope.get("Fitting")),l.$include(c.get("Vector2d").$$scope.get("Properties")),l.$include(c.get("Vector2d").$$scope.get("Transformations")),function(t){var r,n,i,o,s=t.$$scope;t.$$proto;e.defn(t,"$parse",r=function(e,t){var r,n=this;return null==t&&(t=a),(r=t["$nil?"]())===a||null==r||r.$$is_boolean&&1!=r?n.$new(e,t):n.$parse_single_arg(e)},r.$$arity=-2),t.$private(),e.defn(t,"$parse_single_arg",n=function(t){var r,n=this,i=a;return function(){return i=t,
s.get("Vector2d")["$==="](i)?t:s.get("Array")["$==="](i)?(r=n).$parse.apply(r,e.to_a(t)):s.get("String")["$==="](i)?n.$parse_str(t):s.get("Hash")["$==="](i)?n.$parse_hash(t.$dup()):n.$new(t,t)}()},n.$$arity=1),e.defn(t,"$parse_hash",i=function(e){var t,r,n,i=this;return(t=e["$has_key?"]("x"))===a||null==t||t.$$is_boolean&&1!=t||(t="x",r=e,!1!==(n=r["$[]"](t))&&n!==a&&null!=n||r["$[]="](t,e["$[]"]("x"))),(t=e["$has_key?"]("y"))===a||null==t||t.$$is_boolean&&1!=t||(t="y",r=e,!1!==(n=r["$[]"](t))&&n!==a&&null!=n||r["$[]="](t,e["$[]"]("y"))),i.$new(e["$[]"]("x"),e["$[]"]("y"))},i.$$arity=1),e.defn(t,"$parse_str",o=function(t){var r,n,i,o=this;return(r=t["$=~"](/^[\s]*[\d\.]*[\s]*x[\s]*[\d\.]*[\s]*$/))===a||null==r||r.$$is_boolean&&1!=r?o.$raise(s.get("ArgumentError"),"not a valid string input"):(r=o).$new.apply(r,e.to_a((n=(i=t.$split("x")).$map,n.$$p="to_f".$to_proc(),n).call(i)))},o.$$arity=1)}(e.get_singleton_class(l)),l.$attr_reader("x","y"),e.defn(l,"$initialize",o=function(e,t){var r,n=this;return r=[e,t],n.x=r[0],n.y=r[1],r},o.$$arity=2),e.defn(l,"$==",s=function(e){var t,r=this;return t=e.$x()["$==="](r.$x()),!1!==t&&t!==a&&null!=t?e.$y()["$==="](r.$y()):t},s.$$arity=1)}(n.base),e.defn(e.Object,"$Vector2d",t=function(t){var r,a,i=arguments.length,o=i-0;o<0&&(o=0),a=new Array(o);for(var s=0;s<i;s++)a[s-0]=arguments[s];return(r=n.get("Vector2d")).$parse.apply(r,e.to_a(a))},t.$$arity=-1),a&&"Vector2d"},Opal.modules.json=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.module),a=e.hash2,i=e.klass;return e.add_stubs(["$new","$push","$[]=","$[]","$create_id","$json_create","$attr_accessor","$create_id=","$===","$parse","$generate","$from_object","$merge","$to_json","$responds_to?","$to_io","$write","$to_s","$to_a","$strftime"]),function(t){function i(t,n){var a,o,s,l,c,u;switch(typeof t){case"string":case"number":return t;case"boolean":return!!t;case"null":return r;case"object":if(!t)return r;if(t.$$is_array){for(o=n.array_class.$new(),l=0,c=t.length;l<c;l++)o.$push(i(t[l],n));return o}s=n.object_class.$new();for(u in t)y.call(t,u)&&s["$[]="](u,i(t[u],n));return n.parse||(a=s["$[]"](g.get("JSON").$create_id()))==r?s:(a=e.get(a),a.$json_create(s))}}var o,s,l,c,u,$,f,p,d,h,_=o=n(t,"JSON"),g=(_.$$proto,_.$$scope),m=JSON.parse,y=e.hasOwnProperty;!function(e){e.$$scope,e.$$proto;e.$attr_accessor("create_id")}(e.get_singleton_class(_)),s=["json_class"],l=_,l["$create_id="].apply(l,s),s[s.length-1],e.defs(_,"$[]",c=function(e,t){var n,i=this;return null==t&&(t=a([],{})),(n=g.get("String")["$==="](e))===r||null==n||n.$$is_boolean&&1!=n?i.$generate(e,t):i.$parse(e,t)},c.$$arity=-2),e.defs(_,"$parse",u=function(e,t){var r=this;return null==t&&(t=a([],{})),r.$from_object(m(e),t.$merge(a(["parse"],{parse:!0})))},u.$$arity=-2),e.defs(_,"$parse!",$=function(e,t){var r=this;return null==t&&(t=a([],{})),r.$parse(e,t)},$.$$arity=-2),e.defs(_,"$load",f=function(e,t){var r=this;return null==t&&(t=a([],{})),r.$from_object(m(e),t)},f.$$arity=-2),e.defs(_,"$from_object",p=function(e,t){var n,o,s;return null==t&&(t=a([],{})),n="object_class",o=t,!1!==(s=o["$[]"](n))&&s!==r&&null!=s||o["$[]="](n,g.get("Hash")),n="array_class",o=t,!1!==(s=o["$[]"](n))&&s!==r&&null!=s||o["$[]="](n,g.get("Array")),i(e,t.$$smap)},p.$$arity=-2),e.defs(_,"$generate",d=function(e,t){return null==t&&(t=a([],{})),e.$to_json(t)},d.$$arity=-2),e.defs(_,"$dump",h=function(e,t,n){var a,i=this,o=r;return null==t&&(t=r),null==n&&(n=r),o=i.$generate(e),!1!==t&&t!==r&&null!=t?((a=t["$responds_to?"]("to_io"))===r||null==a||a.$$is_boolean&&1!=a||(t=t.$to_io()),t.$write(o),t):o},h.$$arity=-2)}(t.base),function(t,r){function n(){}var a,o=n=i(t,null,"Object",n);o.$$proto,o.$$scope;e.defn(o,"$to_json",a=function(){return this.$to_s().$to_json()},a.$$arity=0)}(t.base),function(t){var r,a,i=r=n(t,"Enumerable");i.$$proto,i.$$scope;e.defn(i,"$to_json",a=function(){return this.$to_a().$to_json()},a.$$arity=0)}(t.base),function(t,r){function n(){}var a,o=n=i(t,null,"Array",n);o.$$proto,o.$$scope;e.defn(o,"$to_json",a=function(){for(var e=this,t=[],r=0,n=e.length;r<n;r++)t.push(e[r].$to_json());return"["+t.join(", ")+"]"},a.$$arity=0)}(t.base),function(t,r){function n(){}var a,o=n=i(t,null,"Boolean",n);o.$$proto,o.$$scope;e.defn(o,"$to_json",a=function(){return 1==this?"true":"false"},a.$$arity=0)}(t.base),function(t,r){function n(){}var a,o=n=i(t,null,"Hash",n);o.$$proto,o.$$scope;e.defn(o,"$to_json",a=function(){for(var e,t,r=this,n=[],a=0,i=r.$$keys,o=i.length;a<o;a++)e=i[a],e.$$is_string?t=r.$$smap[e]:(t=e.value,e=e.key),n.push(e.$to_s().$to_json()+":"+t.$to_json());return"{"+n.join(", ")+"}"},a.$$arity=0)}(t.base),function(t,r){function n(){}var a,o=n=i(t,null,"NilClass",n);o.$$proto,o.$$scope;e.defn(o,"$to_json",a=function(){return"null"},a.$$arity=0)}(t.base),function(t,r){function n(){}var a,o=n=i(t,null,"Numeric",n);o.$$proto,o.$$scope;e.defn(o,"$to_json",a=function(){return this.toString()},a.$$arity=0)}(t.base),function(t,r){function n(){}var a=n=i(t,null,"String",n);a.$$proto,a.$$scope;e.alias(a,"to_json","inspect")}(t.base),function(t,r){function n(){}var a,o=n=i(t,null,"Time",n);o.$$proto,o.$$scope;e.defn(o,"$to_json",a=function(){return this.$strftime("%FT%T%z").$to_json()},a.$$arity=0)}(t.base),function(t,n){function a(){}var o,s,l=a=i(t,null,"Date",a);l.$$proto,l.$$scope;return e.defn(l,"$to_json",o=function(){return this.$to_s().$to_json()},o.$$arity=0),e.defn(l,"$as_json",s=function(){return this.$to_s()},s.$$arity=0),r&&"as_json"}(t.base)},Opal.modules["opal-neatjson"]=function(e){var t,r=e.top,n=e,a=e.nil,i=(e.breaker,e.slice,e.module),o=e.gvars,s=e.hash2;return e.add_stubs(["$==","$require","$has_key?","$[]=","$lambda","$[]","$to_n"]),(t=n.get("RUBY_ENGINE")["$=="]("opal"))===a||null==t||t.$$is_boolean&&1!=t?a:(r.$require("json"),function(t){var r,n,l=r=i(t,"JSON"),c=(l.$$proto,l.$$scope);c.get("OPAL_PLATFORM")["$=="]("nodejs"),o.neatJSON=neatJSON,e.defs(l,"$neat_generate",n=function(e,t){var r,n,i,l=this;return null==o.neatJSON&&(o.neatJSON=a),null==t&&(t=s(["explicit_sort"],{explicit_sort:[]})),(r=t["$has_key?"]("explicit_sort"))===a||null==r||r.$$is_boolean&&1!=r||t["$[]="]("sort",(r=(n=l).$lambda,r.$$p=(i=function(e,r,n){var o;i.$$s;return null==e&&(e=a),null==r&&(r=a),null==n&&(n=a),!1!==(o=t["$[]"]("explicit_sort")["$[]"](e))&&o!==a&&null!=o?o:"_9999_"+e},i.$$s=l,i.$$arity=3,i),r).call(n)),o.neatJSON(JSON.parse(JSON.stringify(e.$to_n())),t.$to_n())},n.$$arity=-2)}(n.base))},Opal.modules["opal-ajv"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.module),a=e.klass,i=e.range,o=e.gvars,s=e.hash2,l=e.hash;return e.add_stubs(["$==","$add_schema","$_schema","$to_n","$each","$start_with?","$gsub","$[]","$push","$error","$new","$strict=","$get","$keys","$validate"]),function(t){var c,u=c=n(t,"Ajv"),$=(u.$$proto,u.$$scope);!function(t,n){function c(){}var u,$,f,p,d,h=c=a(t,null,"JsonValidator",c),_=h.$$proto,g=h.$$scope;_.root=r,e.defn(h,"$initialize",u=function(){var e=this,t=r;return t=r,t=(g.get("OPAL_PLATFORM")["$=="]("nodejs"),Ajv),e.root=t({allErrors:!0,jsonPointers:!0}),e.$add_schema(e.$_schema(),"zupfnoter")},u.$$arity=0),e.defn(h,"$add_schema",$=function(e,t){this.root.addSchema(e.$to_n(),t)},$.$$arity=2),e.defn(h,"$validate",f=function(e,t){var n,a,s,l=this,c=r,u=r,$=r;return c=!1,c=l.root.validate(e,t.$to_n()),u=[],!1!==c&&c!==r&&null!=c||($=l.root.errors,(n=(a=$).$each,n.$$p=(s=function(e){var t,n=(s.$$s,r),a=r;return null==o.log&&(o.log=r),null==e&&(e=r),n=e.dataPath,(t=n["$start_with?"]("/"))===r||null==t||t.$$is_boolean&&1!=t||(n=n["$[]"](i(1,-1,!1)).$gsub("/",".")),u.$push(n),a=n+": "+e.message+"\n"+JSON.stringify(e.params,null," "),o.log.$error(a)},s.$$s=l,s.$$arity=1,s),n).call(a)),u},f.$$arity=2),e.defn(h,"$validate_conf",p=function(e){var t,n,a,i=this,o=r,c=r;return o=g.get("Confstack").$new(),t=[!1],n=o,n["$strict="].apply(n,t),t[t.length-1],o.$push(e.$get()),c=o.$get("extract.0"),(t=(n=o.$get("extract").$keys()).$each,t.$$p=(a=function(e){a.$$s;return null==e&&(e=r),o.$push(s(["extract"],{extract:l(e,c)}))},a.$$s=i,a.$$arity=1,a),t).call(n),o.$push(s(["extract"],{extract:e.$get("extract")})),o.$get(),i.$validate("zupfnoter",o.$get())},p.$$arity=1),e.defn(h,"$_schema",d=function(){return s(["$schema","description","type","required","definitions","properties"],{$schema:"http://json-schema.org/draft-04/schema#",description:"Generated from x.json with shasum 0b1781e0803dc084178858e9fbe2b4e0b65c08e7",type:"object",required:["produce","abc_parser","restposition","wrap","defaults","templates","annotations","extract","layout","neatjson"],definitions:s(["pos","notes_entry","minc_entry","nconf_entry","notebound_pos","notebound_repeat","annotated_bezier","extract_layout"],{pos:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:2,uniqueItems:!1,items:s(["type"],{type:"number"})}),notes_entry:s(["type","required","properties"],{type:"object",required:["pos","text","style"],properties:s(["pos","text","style"],{pos:s(["$ref"],{$ref:"#/definitions/pos"}),text:s(["type"],{type:"string"}),style:s(["type"],{type:"string"})})}),minc_entry:s(["type","required","additionalProperties","properties"],{type:"object",required:["minc_f"],additionalProperties:!1,properties:s(["minc_f"],{minc_f:s(["type"],{type:"number"})})}),nconf_entry:s(["type","additionalProperties","patternProperties"],{type:"object",additionalProperties:!1,patternProperties:s(["t_d*"],{"t_d*":s(["type","additionalProperties","patternProperties"],{type:"object",additionalProperties:!1,patternProperties:s(["n_d*"],{"n_d*":s(["type","additionalProperties","properties"],{type:"object",additionalProperties:!1,properties:s(["nshift"],{nshift:s(["type"],{type:"number"})})})})})})}),notebound_pos:s(["type","additionalProperties","patternProperties"],{type:"object",additionalProperties:!1,patternProperties:s(["v_d*"],{"v_d*":s(["type","additionalProperties","patternProperties"],{type:"object",additionalProperties:!1,patternProperties:s(["t_d*|d*"],{"t_d*|d*":s(["type","additionalProperties","properties"],{type:"object",additionalProperties:!1,properties:s(["pos"],{pos:s(["$ref"],{$ref:"#/definitions/pos"})})})})})})}),notebound_repeat:s(["type","additionalProperties","patternProperties"],{type:"object",additionalProperties:!1,patternProperties:s(["v_d*"],{"v_d*":s(["text","style","pos"],{text:"integer",style:s(["type"],{type:"string"}),pos:s(["$ref"],{$ref:"#/definitions/pos"})})})}),annotated_bezier:s(["type","properties"],{type:"object",properties:s(["cp1","cp2","pos","shape","show","style"],{cp1:s(["$ref"],{$ref:"#/definitions/pos"}),cp2:s(["$ref"],{$ref:"#/definitions/pos"}),pos:s(["$ref"],{$ref:"#/definitions/pos"}),shape:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:0,uniqueItems:!0,items:s(["type"],{type:"string"})}),show:s(["type"],{type:"boolean"}),style:s(["type"],{type:"string"})})}),extract_layout:s(["type","requiredx","additionalProperties","properties"],{type:"object",requiredx:["limit_a3","LINE_THIN","LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","grid"],additionalProperties:!1,properties:s(["limit_a3","beams","bottomup","jumpline_anchor","LINE_THIN","LINE_MEDIUM","LINE_THICK","PITCH_OFFSET","X_SPACING","X_OFFSET","instrument","DRAWING_AREA_SIZE","ELLIPSE_SIZE","REST_SIZE","grid","color","packer"],{limit_a3:s(["type"],{type:"boolean"}),beams:s(["type"],{type:"boolean"}),bottomup:s(["type"],{type:"boolean"}),jumpline_anchor:s(["$ref"],{$ref:"#/definitions/pos"}),LINE_THIN:s(["type"],{type:"number"}),LINE_MEDIUM:s(["type"],{type:"number"}),LINE_THICK:s(["type"],{type:"number"}),PITCH_OFFSET:s(["type"],{type:"integer"}),X_SPACING:s(["type"],{type:"number"}),X_OFFSET:s(["type"],{type:"number"}),instrument:s(["type"],{type:"string"}),DRAWING_AREA_SIZE:s(["type","minItems","items"],{type:"array",minItems:2,items:s(["type"],{type:"number"})}),ELLIPSE_SIZE:s(["type","minItems","items"],{type:"array",minItems:2,items:s(["type"],{type:"number"})}),REST_SIZE:s(["type","minItems","items"],{type:"array",minItems:2,items:s(["type"],{type:"number"})}),grid:s(["type"],{type:"boolean"}),color:s(["type","properties"],{type:"object",properties:s(["color_default","color_variant1","color_variant2"],{color_default:s(["type"],{type:"string"}),color_variant1:s(["type"],{type:"string"}),color_variant2:s(["type"],{type:"string"})})}),packer:s(["type","properties"],{type:"object",properties:s(["pack_method","pack_max_spread_factor","pack_min_increment"],{pack_method:s(["type"],{type:"integer"}),pack_max_spread_factor:s(["type"],{type:"number"}),pack_min_increment:s(["type"],{type:"number"})})})})})}),properties:s(["confstack","produce","template","abc_parser","restposition","wrap","defaults","templates","annotations","extract","layout","neatjson"],{confstack:s(["type","required","properties"],{type:"object",required:["env"],properties:s(["env"],{env:s(["type"],{type:"string"})})}),produce:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:0,uniqueItems:!0,items:s(["type"],{type:"integer"})}),template:s(["type","additionalProperties","properties"],{type:"object",additionalProperties:!1,properties:s(["filebase","title"],{filebase:s(["type"],{type:"string"}),title:s(["type"],{type:"string"})})}),abc_parser:s(["type"],{type:"string"}),restposition:s(["type","additionalProperties","required","properties"],{type:"object",additionalProperties:!1,required:["default","repeatstart","repeatend"],properties:s(["default","repeatstart","repeatend"],{default:s(["type"],{type:"string"}),repeatstart:s(["type"],{type:"string"}),repeatend:s(["type"],{type:"string"})})}),wrap:s(["type"],{type:"integer"}),defaults:s(["type","required","properties"],{type:"object",required:["notebound"],properties:s(["notebound"],{notebound:s(["type","required","properties"],{type:"object",required:["annotation","partname","variantend","tuplet"],properties:s(["annotation","partname","variantend","tuplet"],{annotation:s(["type","required","properties"],{type:"object",required:["pos"],properties:s(["pos","style"],{pos:s(["$ref"],{$ref:"#/definitions/pos"}),style:s(["type"],{type:"string"})})}),partname:s(["type","required","properties"],{type:"object",required:["pos"],properties:s(["pos","style"],{pos:s(["$ref"],{$ref:"#/definitions/pos"}),style:s(["type"],{type:"string"})})}),variantend:s(["type","required","properties"],{type:"object",required:["pos"],properties:s(["pos","style"],{pos:s(["$ref"],{$ref:"#/definitions/pos"}),style:s(["type"],{type:"string"})})}),tuplet:s(["$ref","required"],{$ref:"#/definitions/annotated_bezier",required:["cp1","cp2","shape"]})})})})}),templates:s(["type","required","properties"],{type:"object",required:["notes","lyrics","tuplet","annotations"],properties:s(["notes","lyrics","tuplet","annotations"],{notes:s(["$ref"],{$ref:"#/definitions/notes_entry"}),lyrics:s(["type","required","properties"],{type:"object",required:["verses","pos"],properties:s(["verses","pos","style"],{verses:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})}),pos:s(["$ref"],{$ref:"#/definitions/pos"}),style:s(["type"],{type:"string"})})}),tuplet:s(["type","required","properties"],{type:"object",required:["cp1","cp2","shape"],properties:s(["cp1","cp2","shape"],{cp1:s(["$ref"],{$ref:"#/definitions/pos"}),cp2:s(["$ref"],{$ref:"#/definitions/pos"}),shape:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"string"})})})}),annotations:s(["type","required","properties"],{type:"object",required:["text","pos"],properties:s(["text","pos","style"],{text:s(["type"],{type:"string"}),pos:s(["$ref"],{$ref:"#/definitions/pos"}),style:s(["type"],{type:"string"})})})})}),annotations:s(["type","required","properties"],{type:"object",required:["vl","vt","vr"],properties:s(["vl","vt","vr"],{vl:s(["type","required","properties"],{type:"object",required:["text","pos"],properties:s(["text","pos"],{text:s(["type"],{type:"string"}),pos:s(["$ref"],{$ref:"#/definitions/pos"})})}),vt:s(["type","required","properties"],{type:"object",required:["text","pos"],properties:s(["text","pos"],{text:s(["type"],{type:"string"}),pos:s(["$ref"],{$ref:"#/definitions/pos"})})}),vr:s(["type","required","properties"],{type:"object",required:["text","pos"],properties:s(["text","pos"],{text:s(["type"],{type:"string"}),pos:s(["$ref"],{$ref:"#/definitions/pos"})})})})}),extract:s(["type","patternProperties"],{type:"object",patternProperties:s(["d*","4","5"],{"d*":s(["type","additionalProperties","requiredx","properties"],{type:"object",additionalProperties:!1,requiredx:["title","filenamepart","startpos","voices","synchlines","flowlines","subflowlines","jumplines","repeatsigns","layoutlines","legend","lyrics","layout","nonflowrest","notes","barnumbers","countnotes","stringnames","printer"],properties:s(["title","filenamepart","startpos","voices","synchlines","flowlines","subflowlines","jumplines","repeatsigns","layoutlines","legend","lyrics","layout","nonflowrest","notes","notebound","tuplets","barnumbers","countnotes","stringnames","sortmark","printer","images"],{title:s(["type"],{type:"string"}),filenamepart:s([],{}),startpos:s(["type"],{type:"integer"}),voices:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})}),synchlines:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:0,uniqueItems:!0,items:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})})}),flowlines:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})}),subflowlines:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})}),jumplines:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})}),repeatsigns:s(["type","requiredx","properties"],{type:"object",requiredx:["voices","left","right"],properties:s(["voices","left","right"],{voices:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:0,uniqueItems:!0,items:s([],{})}),left:s(["type","required","properties"],{type:"object",required:["pos","text","style"],properties:s(["pos","text","style"],{pos:s(["$ref"],{$ref:"#/definitions/pos"}),text:s(["type"],{type:"string"}),style:s(["type"],{type:"string"})})}),right:s(["type","required","properties"],{type:"object",required:["pos","text","style"],properties:s(["pos","text","style"],{pos:s(["$ref"],{$ref:"#/definitions/pos"}),text:s(["type"],{type:"string"}),style:s(["type"],{type:"string"})})})})}),layoutlines:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:0,uniqueItems:!0,items:s(["type"],{type:"integer"})}),legend:s(["type","required","properties"],{type:"object",required:["spos","pos"],properties:s(["spos","pos","style"],{spos:s(["$ref"],{$ref:"#/definitions/pos"}),pos:s(["$ref"],{$ref:"#/definitions/pos"}),style:s(["type"],{type:"string"})})}),lyrics:s(["type","patternProperties"],{type:"object",patternProperties:s([".*"],{".*":s(["type","required"],{type:"object",required:["verses","pos"]})})}),layout:s(["$ref"],{$ref:"#/definitions/extract_layout"}),nonflowrest:s(["type"],{type:"boolean"}),notes:s(["patternProperties"],{patternProperties:s([".*"],{".*":s(["$ref"],{$ref:"#/definitions/notes_entry"})})}),notebound:s(["type","additionalProperties","properties"],{type:"object",additionalProperties:!1,properties:s(["annotation","barnumber","c_jumplines","countnote","decoration","flowline","minc","nconf","partname","repeat_begin","repeat_end","tuplet","variantend"],{annotation:s(["$ref"],{$ref:"#/definitions/notebound_pos"}),barnumber:s(["$ref"],{$ref:"#/definitions/notebound_pos"}),c_jumplines:s(["type","additionalProperties","patternProperties"],{type:"object",additionalProperties:!1,patternProperties:s(["v_d*"],{"v_d*":s(["p_repeat","p_begin","p_end","p_follow"],{p_repeat:s(["type"],{type:"number"}),p_begin:s(["type"],{type:"number"}),p_end:s(["type"],{type:"number"}),p_follow:s(["type"],{type:"number"})})})}),countnote:s(["$ref"],{$ref:"#/definitions/notebound_pos"}),decoration:s(["$ref"],{$ref:"#/definitions/notebound_pos"}),flowline:s(["type","patternProperties"],{type:"object",patternProperties:s(["v_d+"],{"v_d+":s(["type","patternProperties"],{type:"object",patternProperties:s(["d*"],{"d*":s(["$ref"],{$ref:"#/definitions/annotated_bezier"})})})})}),minc:s(["type","additionalProperties","patternProperties"],{type:"object",additionalProperties:!1,patternProperties:s(["d*"],{"d*":s(["$ref"],{$ref:"#/definitions/minc_entry"})})}),nconf:s(["type","additionalProperties","patternProperties"],{type:"object",additionalProperties:!1,patternProperties:s(["v_d*"],{"v_d*":s(["$ref"],{$ref:"#/definitions/nconf_entry"})})}),partname:s(["$ref"],{$ref:"#/definitions/notebound_pos"}),repeat_begin:s(["$ref"],{$ref:"#/definitions/notebound_pos"}),repeat_end:s(["$ref"],{$ref:"#/definitions/notebound_repeat"}),tuplet:s(["type","patternProperties"],{type:"object",patternProperties:s(["v_d*"],{"v_d*":s(["type","patternProperties"],{type:"object",patternProperties:s(["d*"],{"d*":s(["$ref"],{$ref:"#/definitions/annotated_bezier"})})})})}),variantend:s(["$ref"],{$ref:"#/definitions/notebound_pos"})})}),tuplets:s(["type","properties"],{type:"object",properties:s(["text"],{text:s(["type"],{type:"string"})})}),barnumbers:s(["type","required","properties"],{type:"object",required:["voices","pos","autopos","style","prefix"],properties:s(["voices","pos","autopos","style","prefix"],{voices:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:0,uniqueItems:!0,items:s([],{})}),pos:s(["$ref"],{$ref:"#/definitions/pos"}),autopos:s(["type"],{type:"boolean"}),style:s(["type"],{type:"string"}),prefix:s(["type"],{type:"string"})})}),countnotes:s(["type","required","properties"],{type:"object",required:["voices","pos","autopos","style"],properties:s(["voices","pos","autopos","style"],{voices:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:0,uniqueItems:!0,items:s([],{})}),pos:s(["$ref"],{$ref:"#/definitions/pos"}),autopos:s(["type"],{type:"boolean"}),style:s(["type"],{type:"string"})})}),stringnames:s(["type","required","properties"],{type:"object",required:["text","vpos","style","marks"],properties:s(["text","vpos","style","marks"],{text:s(["type"],{type:"string"}),vpos:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:0,uniqueItems:!0,items:s([],{})}),style:s(["type"],{type:"string"}),marks:s(["type","required","properties"],{type:"object",required:["vpos","hpos"],properties:s(["vpos","hpos"],{vpos:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})}),hpos:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})})})})})}),sortmark:s(["type","properties"],{type:"object",properties:s(["show"],{show:s(["type"],{type:"boolean"})})}),printer:s(["type","required","properties"],{type:"object",required:["a3_offset","a4_offset","show_border"],properties:s(["a3_offset","a4_offset","show_border"],{a3_offset:s(["type","minItems","axItems","uniqueItems","items"],{type:"array",minItems:2,axItems:2,uniqueItems:!1,items:s(["type"],{type:"integer"})}),a4_offset:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:2,uniqueItems:!1,items:s(["type"],{type:"integer"})}),show_border:s(["type"],{type:"boolean"})})}),images:s(["type","patternProperties"],{type:"object",patternProperties:s(["d*"],{"d*":s(["type","properties"],{type:"object",properties:s(["imagename","show","pos","height"],{imagename:s(["type"],{type:"string"}),show:s(["type"],{type:"boolean"}),pos:s(["$ref"],{$ref:"#/definitions/pos"}),height:s(["type"],{type:"number"})})})})})})}),4:s(["type","required","properties"],{type:"object",required:["title","voices"],properties:s(["title","filenamepart","voices"],{title:s(["type"],{type:"string"}),filenamepart:s([],{}),voices:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})})})}),5:s(["type","required","properties"],{type:"object",required:["title","voices"],properties:s(["title","filenamepart","voices"],{title:s(["type"],{type:"string"}),filenamepart:s([],{}),voices:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})})})})})}),layout:s(["type","required","properties"],{type:"object",required:["grid","limit_a3","SHOW_SLUR","LINE_THIN","LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","X_SPACING","X_OFFSET","Y_SCALE","DRAWING_AREA_SIZE","BEAT_RESOLUTION","SHORTEST_NOTE","BEAT_PER_DURATION","PITCH_OFFSET","FONT_STYLE_DEF","MM_PER_POINT","DURATION_TO_STYLE","REST_TO_GLYPH"],properties:s(["grid","limit_a3","SHOW_SLUR","LINE_THIN","LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","X_SPACING","X_OFFSET","Y_SCALE","DRAWING_AREA_SIZE","BEAT_RESOLUTION","SHORTEST_NOTE","BEAT_PER_DURATION","PITCH_OFFSET","FONT_STYLE_DEF","MM_PER_POINT","DURATION_TO_STYLE","REST_TO_GLYPH"],{grid:s(["type"],{type:"boolean"}),limit_a3:s(["type"],{type:"boolean"}),SHOW_SLUR:s(["type"],{type:"boolean"}),LINE_THIN:s(["type"],{type:"number"}),LINE_MEDIUM:s(["type"],{type:"number"}),LINE_THICK:s(["type"],{type:"number"}),ELLIPSE_SIZE:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"number"})}),REST_SIZE:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"number"})}),X_SPACING:s(["type"],{type:"number"}),X_OFFSET:s(["type"],{type:"number"}),Y_SCALE:s(["type"],{type:"integer"}),DRAWING_AREA_SIZE:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:s(["type"],{type:"integer"})}),BEAT_RESOLUTION:s(["type"],{type:"integer"}),SHORTEST_NOTE:s(["type"],{type:"integer"}),BEAT_PER_DURATION:s(["type"],{type:"integer"}),PITCH_OFFSET:s(["type"],{type:"integer"}),FONT_STYLE_DEF:s(["type","required","patternProperties"],{type:"object",required:["bold","italic","large","regular","small_bold","small_italic","small","smaller"],patternProperties:s([".*"],{".*":s(["type","required","properties"],{type:"object",required:["text_color","font_size","font_style"],properties:s(["text_color","font_size","font_style"],{text_color:s(["type","minItems","uniqueItems","items"],{type:"array",minItems:3,uniqueItems:!1,items:s(["type"],{type:"integer"})}),font_size:s(["type"],{type:"integer"}),font_style:s(["type"],{type:"string"})})})})}),MM_PER_POINT:s(["type"],{type:"number"}),DURATION_TO_STYLE:s(["type","required","patternProperties"],{type:"object",required:["err","d64","d48","d32","d24","d16","d12","d8","d6","d4","d3","d2","d1"],patternProperties:s([".*"],{".*":s(["type","minItems","uniqueItems","items"],{type:"array",minItems:3,uniqueItems:!1,items:s(["type"],{type:["number","string","boolean"]})})})}),REST_TO_GLYPH:s(["type","patternProperties"],{type:"object",patternProperties:s([".*"],{".*":s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!0,items:[s(["type","minItems","uniqueItems","items"],{type:"array",minItems:1,uniqueItems:!1,items:s(["type"],{type:"number"})}),s(["type"],{type:"string"}),s(["type"],{type:"boolean"})]})})})})}),neatjson:s(["type","required","properties"],{type:"object",required:["wrap","aligned","after_comma","after_colon_1","after_colon_n","before_colon_n","explicit_sort"],properties:s(["wrap","aligned","after_comma","after_colon_1","after_colon_n","before_colon_n","sorted","explicit_sort"],{wrap:s(["type"],{type:"integer"}),aligned:s(["type"],{type:"boolean"}),after_comma:s(["type"],{type:"integer"}),after_colon_1:s(["type"],{type:"integer"}),after_colon_n:s(["type"],{type:"integer"}),before_colon_n:s(["type"],{type:"integer"}),sorted:s(["type"],{type:"boolean"}),explicit_sort:s(["type"],{type:"object"})})})})})},d.$$arity=0)}($.base)}(t.base)},Opal.modules.consolelogger=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e<=t:e["$<="](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var i=(e.top,e),o=e.nil,s=(e.breaker,e.slice,e.hash2),l=e.klass,c=e.gvars;return e.add_stubs(["$attr_reader","$[]","$now","$clear_errors","$clear_annotations","$push","$add_annotation","$==","$loglevel","$join","$write","$loglevel?","$info","$-","$>","$count","$call","$to_sym","$message","$invert","$<=","$private","$first","$+","$last","$<<","$strftime","$puts","$write_html"]),e.cdecl(i,"LOGLEVELS",s(["message","error","warning","info","debug"],{message:0,error:1,warning:2,info:3,debug:4})),e.cdecl(i,"LOGICONS",s(["message","error","warning","info","debug"],{message:"icon-info-circled",error:"icon-error-alt",warning:"icon-attention",info:"icon-info-circled",debug:"icon-minus-squared"})),function(i,u){function $(){}var f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T=$=l(i,null,"Logger",$),P=T.$$proto,M=T.$$scope;P.captured_errors=P.timestamp=P.loglevel=P.annotations=o,T.$attr_reader("annotations"),e.defn(T,"$clear_annotations",f=function(){return this.annotations=[]},f.$$arity=0),e.defn(T,"$initialize",p=function(e){var t=this;return t.console=e,t.loglevel=M.get("LOGLEVELS")["$[]"]("info"),t.timestamp=M.get("Time").$now(),t.$clear_errors(),t.$clear_annotations()},p.$$arity=1),e.defn(T,"$clear_annotations",d=function(){return this.annotations=[]},d.$$arity=0),e.defn(T,"$error",h=function(e,t,r,n){var a=this,i=o;return null==t&&(t=o),null==r&&(r=o),null==n&&(n=[]),a.captured_errors.$push(e),a.$add_annotation(e,t,r,"error"),a.$loglevel()["$=="]("debug")&&(i=n.$join("\n")),a.$write("error",""+e+i)},h.$$arity=-2),e.defn(T,"$warning",_=function(e,t,r){var n,a=this;return null==t&&(t=o),null==r&&(r=o),(n=a["$loglevel?"]("warning"))===o||null==n||n.$$is_boolean&&1!=n||a.$add_annotation(e,t,r,"warning"),a.$write("warning",e)},_.$$arity=-2),e.defn(T,"$info",g=function(e,t,r){var n=this;return null==t&&(t=o),null==r&&(r=o),n.$add_annotation(e,t,r,"info"),n.$write("info",e)},g.$$arity=-2),e.defn(T,"$debug",m=function(e,t,r){var n=this;return null==t&&(t=o),null==r&&(r=o),n.$add_annotation(e,t,r,"debug"),n.$write("debug",e)},m.$$arity=-2),e.defn(T,"$message",y=function(e,t,r){var n=this;return null==t&&(t=o),null==r&&(r=o),n.$add_annotation(e,t,r,"message"),n.$write("message",e)},y.$$arity=-2),e.defn(T,"$timestamp",v=function(e,r,n){var a=this;return null==c.log&&(c.log=o),null==r&&(r=o),null==n&&(n=o),c.log.$info("Timestamp "+t(M.get("Time").$now(),a.timestamp)+" sec: "+e)},v.$$arity=-2),e.defn(T,"$timestamp_start",b=function(){return this.timestamp=M.get("Time").$now()},b.$$arity=0),e.defn(T,"$clear_errors",x=function(){return this.captured_errors=[]},x.$$arity=0),e.defn(T,"$has_errors?",w=function(){return r(this.captured_errors.$count(),0)},w.$$arity=0),e.defn(T,"$get_errors",A=function(){return this.captured_errors},A.$$arity=0),e.defn(T,"$benchmark",k=function(e){var r=k.$$p,n=r||o,a=o,i=o;return null==c.log&&(c.log=o),k.$$p=null,a=M.get("Time").$now(),i=n.$call(),c.log.$info("  elapsed "+t(M.get("Time").$now(),a)+" sec for "+e),i},k.$$arity=1),e.defn(T,"$loglevel=",E=function(e){var t,r=this;return null==c.log&&(c.log=o),r.loglevel=!1!==(t=M.get("LOGLEVELS")["$[]"](e.$to_sym()))&&t!==o&&null!=t?t:M.get("LOGLEVELS")["$[]"]("debug"),c.log.$message("logging messages up to "+M.get("LOGLEVELS").$invert()["$[]"](r.loglevel))},E.$$arity=1),e.defn(T,"$loglevel",C=function(){var e=this;return M.get("LOGLEVELS").$invert()["$[]"](e.loglevel)},C.$$arity=0),e.defn(T,"$loglevel?",S=function(e){var t,r=this;return n(!1!==(t=M.get("LOGLEVELS")["$[]"](e))&&t!==o&&null!=t?t:M.get("LOGLEVELS")["$[]"]("warning"),r.loglevel)},S.$$arity=1),T.$private(),
e.defn(T,"$add_annotation",I=function(e,t,r,n){var i,l=this,c=o,u=o;return!1!==t&&t!==o&&null!=t&&(c=t,u=!1!==(i=r)&&i!==o&&null!=i?i:[c.$first(),a(c.$last(),1)],l.annotations["$<<"](s(["start_pos","end_pos","text","type"],{start_pos:c,end_pos:u,text:e,type:n}))),o},I.$$arity=4),e.defn(T,"$write",O=function(e,t){var r,n=this;return(r=n["$loglevel?"](e))===o||null==r||r.$$is_boolean&&1!=r?o:(M.get("Time").$now().$strftime("%H:%M:%S"),n.$puts(t))},O.$$arity=2)}(i.base),function(t,r){function a(){}var i,s=a=l(t,r,"NodeLogger",a),c=s.$$proto,u=s.$$scope;c.loglevel=o,e.defn(s,"$write",i=function(e,t){var r,a=this,i=o;return i=!1!==(r=u.get("LOGLEVELS")["$[]"](e))&&r!==o&&null!=r?r:u.get("LOGLEVELS")["$[]"]("warning"),(r=n(i,a.loglevel))===o||null==r||r.$$is_boolean&&1!=r?o:(u.get("Time").$now().$strftime("%H:%M:%S"),a.$puts(t))},i.$$arity=2)}(i.base,i.get("Logger")),function(t,r){function a(){}var i,s,c=a=l(t,r,"ConsoleLogger",a),u=c.$$proto,$=c.$$scope;return u.loglevel=u.console=o,e.defn(c,"$initialize",i=function(t){var r,n,a=this,s=i.$$p,l=o,c=o;for(i.$$p=null,l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];return(n=a,r=e.find_super_dispatcher(a,"initialize",i,!1),r.$$p=s,r).apply(n,l),a.console=t},i.$$arity=1),e.defn(c,"$write",s=function(e,t){var r,a=this,i=o,s=o;return i=!1!==(r=$.get("LOGLEVELS")["$[]"](e))&&r!==o&&null!=r?r:$.get("LOGLEVELS")["$[]"]("warning"),(r=n(i,a.loglevel))===o||null==r||r.$$is_boolean&&1!=r?o:(s=$.get("Time").$now().$strftime("%H:%M:%S"),a.console.$write_html("<li class='"+e+"'><i class=\""+$.get("LOGICONS")["$[]"](e)+"\"><span class='time'>"+s+"</span><span class='msg'>"+t+"</span></li>"),a.$puts(t))},s.$$arity=2),o&&"write"}(i.base,i.get("Logger"))},Opal.modules.harpnotes=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function o(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function s(e,t){return"number"==typeof e&&"number"==typeof t?e<=t:e["$<="](t)}function l(e,t){return"number"==typeof e&&"number"==typeof t?e>=t:e["$>="](t)}var c=(e.top,e),u=e.nil,$=(e.breaker,e.slice,e.module),f=e.klass,p=e.hash2,d=e.range,h=e.gvars,_=e.hash;return e.add_stubs(["$attr_accessor","$first","$last","$to_json","$[]","$+","$class","$map","$instance_variable_get","$-","$instance_variables","$is_a?","$raise","$pitch","$beat","$duration","$first_in_part","$attr_reader","$nil?","$uniq","$flatten","$measure_start","$proxy_note","$alias_method","$each","$beat=","$get_proxy_object","$variant","$sheet_drawable","$prev_playable","$prev_playable=","$next_playable","$next_playable=","$companion=","$visible?","$update_beats","$<<","$compact","$select","$left","$right","$product","$min_by","$abs","$new","$expanded_beat_maps","$max","$keys","$last_beat","$private","$inject","$/","$time","$floor","$>","$start_pos","$error","$tuplet","$[]=","$index=","$index","$==","$reset","$_check1","$center","$size","$conf_key","$origin","$_rect_overlap?","$empty?","$warning","$t","$count","$push","$shapes","$get","$clone","$dotted?","$dotted","$length","$strip","$*","$to_f","$include","$set_instrument_handlers","$lambda","$===","$line_width=","$to_i","$each_with_index","$split","$call","$join","$tap","$conf_key=","$conf_value=","$draginfo=","$Vector2d","$%","$get_print_options","$initialize","$layout_debug_grid","$layout_images","$benchmark","$compute_beat_compression","$values","$<","$min","$include?","$build_synch_points","$synched_notes","$layout_voice","$voices","$loglevel?","$check_annotations","$notes","$color=","$compute_color_by_variant_no","$layout_stringnames","$meta_data","$strftime","$now","$get_uri","$checksum","$harpnote_options","$squeeze","$gsub","$delete","$layout_sortmark","$resolve_placeholder","$message","$printer_config=","$pop","$strict=","$upcase","$ord","$-@","$make_sheetmark_path","$to_a","$<=>","$!","$visible=","$visible","$layout_playable","$proxy","$decorations","$make_decorations_per_playable","$more_conf_keys","$layout_barnumbers_countnotes","$znid","$make_annotated_bezier_path","$first_in_part?","$tuplet_start?","$tuplet_end?","$round","$to_s","$tie_end?","$make_slur_path","$tie_start?","$slur_starts","$slur_ends","$policy","$debug","$from","$to","$make_path_from_jumpline","$make_repeatsign_annotation","$position","$style","$companion","$text","$<=","$next_pitch","$prev_pitch","$size_with_dot","$reverse","$compute_note_position","$count_note","$measure_start?","$measure_count","$compute_beat_compression_1","$compute_beat_compression_2","$compute_beat_compression_10","$compute_beat_compression_0","$group_by","$sort","$beat_maps","$duration_to_id","$get_minc_factor","$notes_on_beat","$>=","$next_first_in_part","$layout_note","$layout_accord","$layout_pause","$convert_pitch_to_xpos","$compute_ellipse_properties_from_note","$layout_note_shift","$sheet_drawable=","$layout_note_flags","$times","$odd?","$check_duration","$shift","$sort_by","$unshift","$x","$y","$normalize","$to_sym","$start_pos_to_s","$end_pos","$rotate","$angle","$perpendicular","$scan"]),function(c){var g,m=g=$(c,"Harpnotes"),y=(m.$$proto,m.$$scope);!function(i){var o,s=o=$(i,"Music"),l=(s.$$proto,s.$$scope);!function(n,a){function i(){}var o,s,l,c,$=i=f(n,null,"MusicEntity",i),p=$.$$proto,d=$.$$scope;p.visible=p.start_pos=u,$.$attr_accessor("beat","conf_key","count_note","decorations","end_pos","next_pitch","next_first_in_part","next_playable","prev_pitch","prev_playable","start_pos","time","endtime","visible","variant","znid","origin","sheet_drawable"),e.defn($,"$initialize",o=function(){var e=this;return e.visible=!0,e.origin=[u,e.decorations=[]]},o.$$arity=0),e.defn($,"$visible?",s=function(){return this.visible},s.$$arity=0),e.defn($,"$start_pos_to_s",l=function(){var e=this;return"["+e.start_pos.$first()+":"+e.start_pos.$last()+"]"},l.$$arity=0),e.defn($,"$to_json",c=function(){var e,n,a,i=this;return d.get("Hash")["$[]"](t([["class",i.$class()]],(e=(n=r(i.$instance_variables(),["@constructor","@toString"])).$map,e.$$p=(a=function(e){var t=a.$$s||this;return null==e&&(e=u),[e,t.$instance_variable_get(e)]},a.$$s=i,a.$$arity=1,a),e).call(n))).$to_json()},c.$$arity=0)}(l.base),function(t,r){function n(){}var a,i,o,s,l=n=f(t,r,"NonPlayable",n),c=l.$$proto,$=l.$$scope;c.companion=u,l.$attr_accessor("companion"),e.defn(l,"$companion=",a=function(e){var t,r=this;return((t=e["$is_a?"]($.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable")))===u||null==t||t.$$is_boolean&&1!=t)&&r.$raise("Companion must be playable"),r.companion=e},a.$$arity=1),e.defn(l,"$pitch",i=function(){var t=this;try{return t.companion.$pitch()}catch(t){if(e.rescue(t,[$.get("StandardError")]))return u;throw t}},i.$$arity=0),e.defn(l,"$beat",o=function(){var t=this;try{return t.companion.$beat()}catch(t){if(e.rescue(t,[$.get("StandardError")]))return u;throw t}},o.$$arity=0),e.defn(l,"$duration",s=function(){var t=this;try{return t.companion.$duration()}catch(t){if(e.rescue(t,[$.get("StandardError")]))return u;throw t}},s.$$arity=0)}(l.base,l.get("MusicEntity")),function(t,r){function n(){}var a,i,o,s,l,c,$,p,d,h,_=n=f(t,r,"Playable",n),g=_.$$proto;_.$$scope;g.tie_end=g.tie_start=g.tuplet_start=g.tuplet_end=g.measure_start=u,_.$attr_accessor("first_in_part","jump_starts","jump_ends","slur_starts","slur_ends","tie_start","tie_end","duration","tuplet","tuplet_start","tuplet_end","shift","count_note","measure_count","measure_start"),e.defn(_,"$initialize",a=function(){var t,r,n=this,i=a.$$p,o=u,s=u;for(a.$$p=null,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return(r=n,t=e.find_super_dispatcher(n,"initialize",a,!1),t.$$p=i,t).apply(r,o),n.slur_starts=[],n.slur_ends=[],n.tie_start=!1,n.tie_end=!1,n.tuplet=1,n.tuplet_start=!1,n.tuplet_end=!1,n.count_note=u},a.$$arity=0),e.defn(_,"$first_in_part?",i=function(){return this.$first_in_part()},i.$$arity=0),e.defn(_,"$tie_end?",o=function(){return this.tie_end},o.$$arity=0),e.defn(_,"$tie_start?",s=function(){return this.tie_start},s.$$arity=0),e.defn(_,"$tuplet_start?",l=function(){return this.tuplet_start},l.$$arity=0),e.defn(_,"$tuplet_end?",c=function(){return this.tuplet_end},c.$$arity=0),e.defn(_,"$measure_start?",$=function(){return this.measure_start},$.$$arity=0),e.defn(_,"$proxy_note",p=function(){return this},p.$$arity=0),e.defn(_,"$left",d=function(){return this},d.$$arity=0),e.defn(_,"$right",h=function(){return this},h.$$arity=0)}(l.base,l.get("MusicEntity")),function(t,r){function n(){}var a,i=n=f(t,r,"Note",n);i.$$proto,i.$$scope;i.$attr_reader("pitch","duration"),e.defn(i,"$initialize",a=function(t,r){var n,i,o=this;a.$$p;return a.$$p=null,(i=o,n=e.find_super_dispatcher(o,"initialize",a,!1),n.$$p=null,n).call(i),(n=t["$nil?"]())===u||null==n||n.$$is_boolean&&1!=n||o.$raise("trying to create a note with undefined pitch"),o.pitch=t,o.next_pitch=t,o.next_playable=o,o.prev_pitch=t,o.prev_playable=o,o.duration=r},a.$$arity=2)}(l.base,l.get("Playable")),function(t,r){function n(){}var a,i,o,s,l,c,$,p,d,h,_,g,m,y,v,b=n=f(t,r,"SynchPoint",n),x=b.$$proto,w=b.$$scope;x.notes=u,b.$attr_reader("notes","synched_notes"),e.defn(b,"$initialize",a=function(t,r){var n,i,o=this;a.$$p;return null==r&&(r=[]),a.$$p=null,(i=o,n=e.find_super_dispatcher(o,"initialize",a,!1),n.$$p=null,n).call(i),((n=t["$is_a?"](w.get("Array")))===u||null==n||n.$$is_boolean&&1!=n)&&o.$raise("Notes must be an array"),o.notes=t,o.synched_notes=[t,r].$flatten().$uniq()},a.$$arity=-2),e.defn(b,"$measure_start",i=function(){return this.$proxy_note().$measure_start()},i.$$arity=0),b.$alias_method("measure_start?","measure_start"),e.defn(b,"$duration",o=function(){return this.$proxy_note().$duration()},o.$$arity=0),e.defn(b,"$beat=",s=function(e){var t,r,n,a=this;return a.beat=e,(t=(r=a.notes).$each,t.$$p=(n=function(t){var r,a;n.$$s;return null==t&&(t=u),r=[e],a=t,a["$beat="].apply(a,r),r[r.length-1]},n.$$s=a,n.$$arity=1,n),t).call(r)},s.$$arity=1),e.defn(b,"$pitch",l=function(){return this.$proxy_note().$pitch()},l.$$arity=0),e.defn(b,"$proxy_note",c=function(){var e=this;return e.$get_proxy_object(e.notes)},c.$$arity=0),e.defn(b,"$variant",$=function(){return this.$proxy_note().$variant()},$.$$arity=0),e.defn(b,"$sheet_drawable",p=function(){return this.$proxy_note().$sheet_drawable()},p.$$arity=0),e.defn(b,"$prev_playable",d=function(){return this.$proxy_note().$prev_playable()},d.$$arity=0),e.defn(b,"$prev_playable=",h=function(e){var t,r,n=this;return t=[e],r=n.$proxy_note(),r["$prev_playable="].apply(r,t),t[t.length-1]},h.$$arity=1),e.defn(b,"$next_playable",_=function(){return this.$proxy_note().$next_playable()},_.$$arity=0),e.defn(b,"$next_playable=",g=function(e){var t,r,n=this;return t=[e],r=n.$proxy_note(),r["$next_playable="].apply(r,t),t[t.length-1]},g.$$arity=1),e.defn(b,"$get_proxy_object",m=function(e){return e.$last()},m.$$arity=1),e.defn(b,"$left",y=function(){return this.notes.$first()},y.$$arity=0),e.defn(b,"$right",v=function(){return this.notes.$last()},v.$$arity=0)}(l.base,l.get("Playable")),function(t,r){function n(){}var a,i,o,s=n=f(t,r,"Pause",n),l=s.$$proto;s.$$scope;l.visible=u,s.$attr_accessor("duration","pitch"),e.defn(s,"$initialize",a=function(t,r){var n,i,o=this;a.$$p;return a.$$p=null,(i=o,n=e.find_super_dispatcher(o,"initialize",a,!1),n.$$p=null,n).call(i),(n=t["$nil?"]())===u||null==n||n.$$is_boolean&&1!=n||o.$raise("trying to create a rest with undefined pitch"),o.pitch=t,o.duration=r,o.next_playable=o,o.prev_pitch=t,o.prev_playable=o},a.$$arity=2),e.defn(s,"$visible=",i=function(e){return this.visible=e},i.$$arity=1),e.defn(s,"$visible?",o=function(){return this.visible},o.$$arity=0)}(l.base,l.get("Playable")),function(t,r){function n(){}var a,i=n=f(t,r,"MeasureStart",n);i.$$proto,i.$$scope;e.defn(i,"$initialize",a=function(t){var r,n,i,o=this;a.$$p;return a.$$p=null,(n=o,r=e.find_super_dispatcher(o,"initialize",a,!1),r.$$p=null,r).call(n),r=[t],i=o,i["$companion="].apply(i,r),r[r.length-1],o.visible=t["$visible?"]()},a.$$arity=1)}(l.base,l.get("NonPlayable")),function(t,r){function n(){}var a,i=n=f(t,r,"NewPart",n);i.$$proto,i.$$scope;i.$attr_reader("name"),e.defn(i,"$initialize",a=function(t,r){var n,i,o=this;a.$$p;return null==r&&(r=u),a.$$p=null,(i=o,n=e.find_super_dispatcher(o,"initialize",a,!1),n.$$p=null,n).call(i),o.conf_key=r,o.name=t},a.$$arity=-2)}(l.base,l.get("NonPlayable")),function(t,r){function n(){}var a,i,o,s,l,c=n=f(t,r,"NoteBoundAnnotation",n),$=c.$$proto;c.$$scope;$.annotations=u,e.defn(c,"$initialize",a=function(t,r,n){var i,o,s,l=this;a.$$p;return null==n&&(n=u),a.$$p=null,(o=l,i=e.find_super_dispatcher(l,"initialize",a,!1),i.$$p=null,i).call(o),i=[t],s=l,s["$companion="].apply(s,i),i[i.length-1],l.conf_key=n,l.annotations=r},a.$$arity=-3),e.defn(c,"$style",i=function(){var e;return!1!==(e=this.annotations["$[]"]("style"))&&e!==u&&null!=e?e:"regular"},i.$$arity=0),e.defn(c,"$text",o=function(){return this.annotations["$[]"]("text")},o.$$arity=0),e.defn(c,"$position",s=function(){return this.annotations["$[]"]("pos")},s.$$arity=0),e.defn(c,"$policy",l=function(){return this.annotations["$[]"]("policy")},l.$$arity=0)}(l.base,l.get("NonPlayable")),function(t,r){function n(){}var a,i=n=f(t,r,"Goto",n),o=(i.$$proto,i.$$scope);i.$attr_reader("from","to","policy"),e.defn(i,"$initialize",a=function(t,r,n){var i,s,l=this;a.$$p;return a.$$p=null,(s=l,i=e.find_super_dispatcher(l,"initialize",a,!1),i.$$p=null,i).call(s),((i=t["$is_a?"](o.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable")))===u||null==i||i.$$is_boolean&&1!=i)&&l.$raise("End point of Jump ("+t.$class()+") must be a Playable"),((i=r["$is_a?"](o.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable")))===u||null==i||i.$$is_boolean&&1!=i)&&l.$raise("Start point of Jump ("+r.$class()+") must be a Playable"),l.from=t,l.to=r,l.policy=n,l.conf_key=n["$[]"]("conf_key")},a.$$arity=3)}(l.base,l.get("MusicEntity")),function(t,r){function n(){}var a,i=n=f(t,r,"BeatMap",n);i.$$proto,i.$$scope;i.$attr_accessor("index"),e.defn(i,"$initialize",a=function(e){return this.index=e},a.$$arity=1)}(l.base,l.get("Hash")),function(t,i){function o(){}var s,l,c,$,_,g,m,y=o=f(t,null,"Song",o),v=y.$$proto,b=y.$$scope;v.voices=v.beat_maps=v.meta_data=v.harpnote_options=u,y.$attr_reader("voices","beat_maps"),y.$attr_accessor("meta_data","harpnote_options","checksum"),e.defn(y,"$to_json",s=function(){var e=this;return p(["voices","beat_maps","meta_data","harpnote_options"],{voices:e.voices,beat_maps:e.beat_maps,meta_data:e.meta_data,harpnote_options:e.harpnote_options}).$to_json()},s.$$arity=0),e.defn(y,"$initialize",l=function(e,t,r){var n=this;return null==e&&(e=[]),null==t&&(t=8),null==r&&(r=p([],{})),n.voices=e,n.note_length_in_beats=t,n.meta_data=r,n.views=[],n.$update_beats()},l.$$arity=-1),e.defn(y,"$<<",c=function(e){var t=this;return t.voices["$<<"](e),t.$update_beats()},c.$$arity=1),e.defn(y,"$build_synch_points",$=function(e){var t,n,a,i=this;return null==e&&(e=u),(t=(n=i.$expanded_beat_maps()).$map,t.$$p=(a=function(t){var n,i,o,s,l,c=a.$$s||this,$=u,f=u,p=u,d=u,h=u,_=u,g=u,m=u,y=u,v=u;return null==t&&(t=u),$=(n=(i=[t["$[]"](e.$first()),t["$[]"](e.$last())].$compact()).$select,n.$$p=(o=function(e){o.$$s;return null==e&&(e=u),e["$visible?"]()},o.$$s=c,o.$$arity=1,o),n).call(i),f=$["$[]"](0),p=$["$[]"](1),(n=(s=!1!==f&&f!==u&&null!=f)?p:f)===u||null==n||n.$$is_boolean&&1!=n||(d=f.$left(),h=f.$right(),_=p.$left(),g=p.$right(),m=[d,h].$product([_,g])),!1!==m&&m!==u&&null!=m&&(y=(n=(s=m).$min_by,n.$$p=(l=function(e){l.$$s;return null==e&&(e=u),r(e.$last().$pitch(),e.$first().$pitch()).$abs()},l.$$s=c,l.$$arity=1,l),n).call(s),v=b.get("SynchPoint").$new(y,m)),v},a.$$s=i,a.$$arity=1,a),t).call(n).$flatten().$compact()},$.$$arity=-1),e.defn(y,"$last_beat",_=function(){var e,t,r,n=this;return(e=(t=n.beat_maps).$map,e.$$p=(r=function(e){r.$$s;return null==e&&(e=u),e.$keys().$max()},r.$$s=n,r.$$arity=1,r),e).call(t).$max()},_.$$arity=0),e.defn(y,"$expanded_beat_maps",g=function(){var e,t,r,n=this;return(e=(t=d(0,n.$last_beat(),!1)).$map,e.$$p=(r=function(e){var t,n,a,i=r.$$s||this;return null==i.beat_maps&&(i.beat_maps=u),null==e&&(e=u),(t=(n=i.beat_maps).$map,t.$$p=(a=function(t){a.$$s;return null==t&&(t=u),t["$[]"](e)},a.$$s=i,a.$$arity=1,a),t).call(n)},r.$$s=n,r.$$arity=1,r),e).call(t)},g.$$arity=0),y.$private(),e.defn(y,"$update_beats",m=function(){var e,t,i,o=this;return o.beat_maps=(e=(t=o.voices).$map,e.$$p=(i=function(e){var t,o,s,l,c,$,f=i.$$s||this,p=u;return null==e&&(e=u),p=0,(t=(o=(l=(c=e).$select,l.$$p=($=function(e){$.$$s;return null==e&&(e=u),e["$is_a?"](b.get("Playable"))},$.$$s=f,$.$$arity=1,$),l).call(c)).$inject,t.$$p=(s=function(t,i){var o,l,c=(s.$$s,u),$=u,f=u;return null==h.log&&(h.log=u),null==t&&(t=u),null==i&&(i=u),p=n(i.$time(),8),c=p.$floor(0),$=r(p,c),(o=a($,0))===u||null==o||o.$$is_boolean&&1!=o||(f=i.$start_pos(),h.log.$error("unsupported tuplet "+i.$tuplet()+" "+$,f),p=c),t["$[]="](p,i),o=[p],l=i,l["$beat="].apply(l,o),o[o.length-1],o=[e.$index()],l=t,l["$index="].apply(l,o),o[o.length-1],t},s.$$s=f,s.$$arity=2,s),t).call(o,b.get("BeatMap").$new(e.$index()))},i.$$s=o,i.$$arity=1,i),e).call(t),u},m.$$arity=0)}(l.base),function(t,r){function n(){}var a,i,o,s,l=n=f(t,r,"Voice",n),c=l.$$proto;l.$$scope;c.show_voice=c.show_flowline=c.show_jumpline=u,l.$attr_accessor("index","name","show_voice","show_flowline","show_jumpline"),e.defn(l,"$initialize",a=function(){var t,r,n=this,i=a.$$p,o=u,s=u;for(a.$$p=null,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return n.show_voice=!0,n.show_flowline=!0,n.show_jumpline=!0,(r=n,t=e.find_super_dispatcher(n,"initialize",a,!1),t.$$p=i,t).apply(r,o)},a.$$arity=0),e.defn(l,"$show_voice?",i=function(){return this.show_voice["$=="](!0)},i.$$arity=0),e.defn(l,"$show_flowline?",o=function(){return this.show_flowline["$=="](!0)},o.$$arity=0),e.defn(l,"$show_jumpline?",s=function(){return this.show_jumpline["$=="](!0)},s.$$arity=0)}(l.base,l.get("Array"))}(y.base),function(r){var n,o=n=$(r,"Drawing"),s=(o.$$proto,o.$$scope);!function(r,n){function i(){}var o,s,l,c,$,p=i=f(r,null,"CollisionDetector",i),d=p.$$proto,_=p.$$scope;d.coll_stack=u,e.defn(p,"$initialize",o=function(){return this.$reset()},o.$$arity=0),e.defn(p,"$check_annotations",s=function(e){var t,r,n,a,i,o,s=this;return(t=(r=(a=(i=e).$select,a.$$p=(o=function(e){o.$$s;return null==e&&(e=u),e["$is_a?"](_.get("Annotation"))},o.$$s=s,o.$$arity=1,o),a).call(i)).$each,t.$$p=(n=function(e){var t=n.$$s||this;return null==e&&(e=u),t.$_check1(e.$center(),e.$size(),e.$conf_key(),e.$origin())},n.$$s=s,n.$$arity=1,n),t).call(r)},s.$$arity=1),e.defn(p,"$reset",l=function(){return this.coll_stack=[]},l.$$arity=0),e.defn(p,"$_check1",c=function(r,n,a,i){var o,s,l,c=this,$=u,f=u,p=u,d=u,g=u,m=u,y=u;if(null==h.log&&(h.log=u),s=r,o=e.to_ary(s),$=null==o[0]?u:o[0],f=null==o[1]?u:o[1],s=n,o=e.to_ary(s),p=null==o[0]?u:o[0],d=null==o[1]?u:o[1],g=[$,f,t($,p),t(f,d)],m=(o=(s=c.coll_stack).$select,o.$$p=(l=function(e){var t=l.$$s||this;return null==e&&(e=u),t["$_rect_overlap?"](e,g)},l.$$s=c,l.$$arity=1,l),o).call(s),y=[0,0],(o=m["$empty?"]())===u||null==o||o.$$is_boolean&&1!=o){try{y=i["$[]"]("start_pos")}catch(t){if(!e.rescue(t,[_.get("StandardError")]))throw t;try{h.log.$error("BUG: Annotation without origin harpnotes 748")}finally{e.pop_exception()}}h.log.$warning(t(_.get("I18n").$t("annotations too close ["),m.$count()+"] "+a),y)}else;return c.coll_stack.$push(g),r},c.$$arity=4),e.defn(p,"$_rect_overlap?",$=function(t,r){var n,i,o,s=u,l=u,c=u,$=u,f=u,p=u,d=u,h=u;return i=t,n=e.to_ary(i),s=null==n[0]?u:n[0],l=null==n[1]?u:n[1],c=null==n[2]?u:n[2],$=null==n[3]?u:n[3],i=r,n=e.to_ary(i),f=null==n[0]?u:n[0],p=null==n[1]?u:n[1],d=null==n[2]?u:n[2],h=null==n[3]?u:n[3],o=a(c,f),i=!1!==o&&o!==u&&null!=o?a(d,s):o,n=!1!==i&&i!==u&&null!=i?a($,p):i,!1!==n&&n!==u&&null!=n?a(h,l):n},$.$$arity=2)}(s.base),function(t,r){function n(){}var a,i=n=f(t,null,"Sheet",n);i.$$proto,i.$$scope;i.$attr_reader("children","active_voices"),i.$attr_accessor("printer_config"),e.defn(i,"$initialize",a=function(e,t){var r=this;return null==h.conf&&(h.conf=u),r.children=e,r.active_voices=t,r.printer_config=h.conf["$[]"]("printer")},a.$$arity=2)}(s.base),function(r,n){function a(){}var i,o,s,l=a=f(r,null,"CompoundDrawable",a),c=l.$$proto;l.$$scope;c.shapes=u,l.$attr_accessor("shapes","proxy"),e.defn(l,"$initialize",i=function(e,t){var r=this;return r.shapes=e,r.proxy=t},i.$$arity=2),e.defn(l,"$push",o=function(e){return this.shapes["$<<"](e)},o.$$arity=1),e.defn(l,"$merge",s=function(e){var r=this;return r.shapes=t(r.shapes,e.$shapes())},s.$$arity=1)}(s.base),function(r,n){function a(){}var i,o,s,l,c,$,p,d,_,g=a=f(r,null,"Drawable",a),m=g.$$proto;g.$$scope;m.visible=m.line_width=m.color=m.size=u,g.$attr_accessor("conf_key","conf_value","draginfo","color","size","more_conf_keys"),e.defn(g,"$initialize",i=function(){var e=this;return null==h.conf&&(h.conf=u),e.visible=!0,e.line_width=h.conf.$get("layout.LINE_THIN"),e.conf_key=u,e.more_conf_keys=[],e.color=h.conf.$get("layout.color.color_default"),e.size=[1,1]},i.$$arity=0),e.defn(g,"$center",o=function(){var e=this;return e.$raise("center not implemented for "+e.$class())},o.$$arity=0),e.defn(g,"$visible?",s=function(){return this.visible},s.$$arity=0),e.defn(g,"$visible=",l=function(e){return this.visible=e},l.$$arity=1),e.defn(g,"$line_width=",c=function(e){return this.line_width=e},c.$$arity=1),e.defn(g,"$line_width",$=function(){return this.line_width},$.$$arity=0),e.defn(g,"$color=",p=function(e){return this.color=e},p.$$arity=1),e.defn(g,"$color",d=function(){return this.color},d.$$arity=0),e.defn(g,"$size_with_dot",_=function(){var e,r=this,n=u;return n=r.size.$clone(),(e=r["$dotted?"]())===u||null==e||e.$$is_boolean&&1!=e||n["$[]="](0,t(n["$[]"](0),1)),n},_.$$arity=0)}(s.base),function(t,r){function n(){}var a,i,o,s=n=f(t,r,"Symbol",n),l=s.$$proto;s.$$scope;l.dotted=l.hasbarover=u,s.$attr_accessor("dotted","hasbarover"),e.defn(s,"$iniitalize",a=function(){var t,r,n=this,i=a.$$p,o=u,s=u;for(a.$$p=null,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return(r=n,t=e.find_super_dispatcher(n,"iniitalize",a,!1),t.$$p=i,t).apply(r,o)},a.$$arity=0),e.defn(s,"$dotted?",i=function(){return this.dotted},i.$$arity=0),e.defn(s,"$hasbarover?",o=function(){return this.hasbarover},o.$$arity=0)}(s.base,s.get("Drawable")),function(t,r){function n(){}var a,i,o,s=n=f(t,r,"FlowLine",n),l=s.$$proto;s.$$scope;l.style=u,s.$attr_reader("from","to","style"),e.defn(s,"$initialize",a=function(t,r,n){var i,o,s=this;a.$$p;return null==n&&(n="solid"),a.$$p=null,(o=s,i=e.find_super_dispatcher(s,"initialize",a,!1),i.$$p=null,i).call(o),s.from=t,s.to=r,s.style=n},a.$$arity=-3),e.defn(s,"$dashed?",i=function(){return this.style["$=="]("dashed")},i.$$arity=0),e.defn(s,"$dotted?",o=function(){return this.style["$=="]("dotted")},o.$$arity=0)}(s.base,s.get("Drawable")),function(t,r){function n(){}var a,i=n=f(t,r,"Image",n);i.$$proto,i.$$scope;i.$attr_reader("url","llpos","height","opacity","origin"),e.defn(i,"$initialize",a=function(e,t,r,n){var a=this;return null==n&&(n=u),a.url=e,a.llpos=t,a.height=r,a.origin=u},a.$$arity=-4)}(s.base,s.get("Drawable")),function(t,r){function n(){}var a,i,o=n=f(t,r,"Path",n),s=o.$$proto;o.$$scope;s.fill=u,o.$attr_reader("path","style","origin"),e.defn(o,"$initialize",a=function(t,r,n){var i,o,s=this;a.$$p;return null==r&&(r=u),null==n&&(n=u),a.$$p=null,(o=s,i=e.find_super_dispatcher(s,"initialize",a,!1),i.$$p=null,i).call(o),s.path=t,s.fill=r,s.origin=n},a.$$arity=-2),e.defn(o,"$filled?",i=function(){return this.fill["$=="]("filled")},i.$$arity=0)}(s.base,s.get("Drawable")),function(t,r){function n(){}var a,i,o,s,l,c=n=f(t,r,"Ellipse",n),$=c.$$proto;c.$$scope;$.size=$.fill=$.rect=u,c.$attr_reader("center","size","fill","origin","color"),e.defn(c,"$initialize",a=function(t,r,n,i,o,s){var l,c,$=this;a.$$p;return null==n&&(n="filled"),null==i&&(i=!1),null==o&&(o=u),null==s&&(s=!1),a.$$p=null,(c=$,l=e.find_super_dispatcher($,"initialize",a,!1),l.$$p=null,l).call(c),$.center=t,$.size=r,$.fill=n,$.dotted=i,$.rect=s,$.origin=o},a.$$arity=-3),e.defn(c,"$height",i=function(){return this.size.$last()},i.$$arity=0),e.defn(c,"$dotted?",o=function(){return this.$dotted()},o.$$arity=0),e.defn(c,"$filled?",s=function(){return this.fill["$=="]("filled")},s.$$arity=0),e.defn(c,"$rect?",l=function(){return this.rect["$=="](!0)},l.$$arity=0)}(s.base,s.get("Symbol")),function(t,r){function n(){}var o,s,l=n=f(t,r,"Annotation",n),c=l.$$proto;l.$$scope;c.text=c.style=u,l.$attr_reader("center","text","style","origin"),l.$attr_accessor("conf_key","conf_value"),e.defn(l,"$initialize",o=function(t,r,n,a,i,s){var l,c,$=this;o.$$p;return null==n&&(n="regular"),null==a&&(a=u),null==i&&(i=u),null==s&&(s=p([],{})),o.$$p=null,(c=$,l=e.find_super_dispatcher($,"initialize",o,!1),l.$$p=null,l).call(c),$.center=t,$.text=r,$.style=n,$.origin=a,$.conf_key=i,$.conf_value=s},o.$$arity=-3),e.defn(l,"$size",s=function(){var e,t,r=this,n=u,o=u,s=u;return null==h.conf&&(h.conf=u),null==h.log&&(h.log=u),t=r.text,(e=!1!==t&&t!==u&&null!=t?a(r.text.$strip().$length(),0):t)===u||null==e||e.$$is_boolean&&1!=e?(e=[1.5,2],s=e[0],o=e[1]):(n=h.conf.$get("layout.FONT_STYLE_DEF."+r.style+".font_size"),!1!==n&&n!==u&&null!=n||(n=10,h.log.$error("unsupported style for annotation: "+r.style)),o=i(n,h.conf.$get("layout.MM_PER_POINT").$to_f()),s=i(r.text.$length(),o)),[s,o]},s.$$arity=0)}(s.base,s.get("Drawable")),function(t,r){function n(){}var a,i,o,s,l=n=f(t,r,"Glyph",n),c=l.$$proto,$=l.$$scope;c.size=c.fill=u,l.$attr_reader("center","size","glyph","origin"),e.cdecl($,"GLYPHS",p(["rest_1","rest_4","rest_8","rest_16","fermata","emphasis","error"],{rest_1:p(["d","w","h"],{d:[["M",-10,-5],["l",20,0],["l",0,10],["l",-20,0],["l",0,-10],["z"]],w:20,h:10}),rest_4:p(["d","w","h"],{d:[["M",-1,-10],["c",.12,-.06,.24,-.06,.36,-.03],["c",.09,.06,4.74,5.58,4.86,5.82],["c",.21,.39,.15,.78,-.15,1.26],["c",-.24,.33,-.72,.81,-1.62,1.56],["c",-.45,.36,-.87,.75,-.96,.84],["c",-.93,.99,-1.14,2.49,-.6,3.63],["c",.18,.39,.27,.48,1.32,1.68],["c",1.92,2.25,1.83,2.16,1.83,2.34],["c",0,.18,-.18,.36,-.36,.39],["c",-.15,0,-.27,-.06,-.48,-.27],["c",-.75,-.75,-2.46,-1.29,-3.39,-1.08],["c",-.45,.09,-.69,.27,-.9,.69],["c",-.12,.3,-.21,.66,-.24,1.14],["c",-.03,.66,.09,1.35,.3,2.01],["c",.15,.42,.24,.66,.45,.96],["c",.18,.24,.18,.33,.03,.42],["c",-.12,.06,-.18,.03,-.45,-.3],["c",-1.08,-1.38,-2.07,-3.36,-2.4,-4.83],["c",-.27,-1.05,-.15,-1.77,.27,-2.07],["c",.21,-.12,.42,-.15,.87,-.15],["c",.87,.06,2.1,.39,3.3,.9],["l",.39,.18],["l",-1.65,-1.95],["c",-2.52,-2.97,-2.61,-3.09,-2.7,-3.27],["c",-.09,-.24,-.12,-.48,-.03,-.75],["c",.15,-.48,.57,-.96,1.83,-2.01],["c",.45,-.36,.84,-.72,.93,-.78],["c",.69,-.75,1.02,-1.8,.9,-2.79],["c",-.06,-.33,-.21,-.84,-.39,-1.11],["c",-.09,-.15,-.45,-.6,-.81,-1.05],["c",-.36,-.42,-.69,-.81,-.72,-.87],["c",-.09,-.18,0,-.42,.21,-.51],["z"]],w:7.888,h:21.435}),rest_8:p(["d","w","h"],{d:[["M",-2,-6.7],["c",.66,-.09,1.23,.09,1.68,.51],["c",.27,.3,.39,.54,.57,1.26],["c",.09,.33,.18,.66,.21,.72],["c",.12,.27,.33,.45,.6,.48],["c",.12,0,.18,0,.33,-.09],["c",.39,-.18,1.32,-1.29,1.68,-1.98],["c",.09,-.21,.24,-.3,.39,-.3],["c",.12,0,.27,.09,.33,.18],["c",.03,.06,-.27,1.11,-1.86,6.42],["c",-1.02,3.48,-1.89,6.39,-1.92,6.42],["c",0,.03,-.12,.12,-.24,.15],["c",-.18,.09,-.21,.09,-.45,.09],["c",-.24,0,-.3,0,-.48,-.06],["c",-.09,-.06,-.21,-.12,-.21,-.15],["c",-.06,-.03,.15,-.57,1.68,-4.92],["c",.96,-2.67,1.74,-4.89,1.71,-4.89],["l",-.51,.15],["c",-1.08,.36,-1.74,.48,-2.55,.48],["c",-.66,0,-.84,-.03,-1.32,-.27],["c",-1.32,-.63,-1.77,-2.16,-1.02,-3.3],["c",.33,-.45,.84,-.81,1.38,-.9],["z"]],w:7.534,h:13.883}),rest_16:p(["d","w","h"],{d:[["M",-1.33,-11.12],["c",.66,-.09,1.23,.09,1.68,.51],["c",.27,.3,.39,.54,.57,1.26],["c",.09,.33,.18,.66,.21,.72],["c",.15,.39,.57,.57,.87,.42],["c",.39,-.18,1.2,-1.23,1.62,-2.07],["c",.06,-.15,.24,-.24,.36,-.24],["c",.12,0,.27,.09,.33,.18],["c",.03,.06,-.45,1.86,-2.67,10.17],["c",-1.5,5.55,-2.73,10.14,-2.76,10.17],["c",-.03,.03,-.12,.12,-.24,.15],["c",-.18,.09,-.21,.09,-.45,.09],["c",-.24,0,-.3,0,-.48,-.06],["c",-.09,-.06,-.21,-.12,-.21,-.15],["c",-.06,-.03,.12,-.57,1.44,-4.92],["c",.81,-2.67,1.47,-4.86,1.47,-4.89],["c",-.03,0,-.27,.06,-.54,.15],["c",-1.08,.36,-1.77,.48,-2.58,.48],["c",-.66,0,-.84,-.03,-1.32,-.27],["c",-1.32,-.63,-1.77,-2.16,-1.02,-3.3],["c",.72,-1.05,2.22,-1.23,3.06,-.42],["c",.3,.33,.42,.6,.6,1.38],["c",.09,.45,.21,.78,.33,.9],["c",.09,.09,.27,.18,.45,.21],["c",.12,0,.18,0,.33,-.09],["c",.33,-.15,1.02,-.93,1.41,-1.59],["c",.12,-.21,.18,-.39,.39,-1.08],["c",.66,-2.1,1.17,-3.84,1.17,-3.87],["c",0,0,-.21,.06,-.42,.15],["c",-.51,.15,-1.2,.33,-1.68,.42],["c",-.33,.06,-.51,.06,-.96,.06],["c",-.66,0,-.84,-.03,-1.32,-.27],["c",-1.32,-.63,-1.77,-2.16,-1.02,-3.3],["c",.33,-.45,.84,-.81,1.38,-.9],["z"]],w:9.724,h:21.383}),fermata:p(["d","w","h"],{d:[["M",-.75,-5.34],["c",.12,0,.45,-.03,.69,-.03],["c",2.91,-.03,5.55,1.53,7.41,4.35],["c",1.17,1.71,1.95,3.72,2.43,6.03],["c",.12,.51,.12,.57,.03,.69],["c",-.12,.21,-.48,.27,-.69,.12],["c",-.12,-.09,-.18,-.24,-.27,-.69],["c",-.78,-3.63,-3.42,-6.54,-6.78,-7.38],["c",-.78,-.21,-1.2,-.24,-2.07,-.24],["c",-.63,0,-.84,0,-1.2,.06],["c",-1.83,.27,-3.42,1.08,-4.8,2.37],["c",-1.41,1.35,-2.4,3.21,-2.85,5.19],["c",-.09,.45,-.15,.6,-.27,.69],["c",-.21,.15,-.57,.09,-.69,-.12],["c",-.09,-.12,-.09,-.18,.03,-.69],["c",.33,-1.62,.78,-3,1.47,-4.38],["c",1.77,-3.54,4.44,-5.67,7.56,-5.97],["z"],["M",-.5,1.5],["c",1.38,-.3,2.58,.9,2.31,2.25],["c",-.15,.72,-.78,1.35,-1.47,1.5],["c",-1.38,.27,-2.58,-.93,-2.31,-2.31],["c",.15,-.69,.78,-1.29,1.47,-1.44],["z"]],w:19.748,h:11.289}),emphasis:p(["d","w","h"],{d:[["M",-6.45,-3.69],["c",.06,-.03,.15,-.06,.18,-.06],["c",.06,0,2.85,.72,6.24,1.59],["l",6.33,1.65],["c",.33,.06,.45,.21,.45,.51],["c",0,.3,-.12,.45,-.45,.51],["l",-6.33,1.65],["c",-3.39,.87,-6.18,1.59,-6.21,1.59],["c",-.21,0,-.48,-.24,-.51,-.45],["c",0,-.15,.06,-.36,.18,-.45],["c",.09,-.06,.87,-.27,3.84,-1.05],["c",2.04,-.54,3.84,-.99,4.02,-1.02],["c",.15,-.06,1.14,-.24,2.22,-.42],["c",1.05,-.18,1.92,-.36,1.92,-.36],["c",0,0,-.87,-.18,-1.92,-.36],["c",-1.08,-.18,-2.07,-.36,-2.22,-.42],["c",-.18,-.03,-1.98,-.48,-4.02,-1.02],["c",-2.97,-.78,-3.75,-.99,-3.84,-1.05],["c",-.12,-.09,-.18,-.3,-.18,-.45],["c",.03,-.15,.15,-.3,.3,-.39],["z"]],w:13.5,h:7.5}),error:p(["d","w","h"],{d:[["M",-10,-5],["l",0,10],["l",20,-10],["l",0,10],["z"]],w:20,h:10})})),e.defn(l,"$initialize",a=function(t,r,n,i,o,s,l){var c,f,d=this,_=(a.$$p,u);return null==h.log&&(h.log=u),null==i&&(i=$.get("FALSE")),null==o&&(o=u),null==s&&(s=u),null==l&&(l=p([],{})),a.$$p=null,(f=d,c=e.find_super_dispatcher(d,"initialize",a,!1),c.$$p=null,c).call(f),_=$.get("GLYPHS")["$[]"](n),!1!==_&&_!==u&&null!=_||(!1!==_&&_!==u&&null!=_||h.log.$error("BUG: unsuppoerted glyph "+n),_=$.get("GLYPHS")["$[]"]("error")),d.center=t,d.glyph_name=n,d.glyph=_,d.size=r,d.dotted=i,d.origin=o,d.filled=!0,d.conf_key=s,d.conf_value=l,d.coll_stack=[]},a.$$arity=-4),e.defn(l,"$height",i=function(){return this.size.$last()},i.$$arity=0),e.defn(l,"$dotted?",o=function(){return this.$dotted()},o.$$arity=0),e.defn(l,"$filled?",s=function(){return this.fill["$=="]("filled")},s.$$arity=0)}(s.base,s.get("Symbol"))}(y.base),function(c){var g,m=g=$(c,"Layout"),y=(m.$$proto,m.$$scope);!function(c,$){function g(){}var m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z=g=f(c,null,"Default",g),ee=Z.$$proto,te=Z.$$scope;ee.placeholders=ee.y_offset=ee.beat_spacing=ee.print_options_raw=ee.bottom_annotation_positions=ee.draw_instrument=ee.slur_index=ee.color_default=ee.layout_minc=ee.conf_beat_resolution=ee.pitch_to_xpos=ee.color_variant1=ee.color_variant2=ee.print_options_keys=u,
Z.$include(te.get("Harpnotes").$$scope.get("Music")),Z.$include(te.get("Harpnotes").$$scope.get("Drawing")),Z.$attr_accessor("placeholders"),e.cdecl(te,"MM_PER_POINT",.3),e.defn(Z,"$initialize",m=function(){var e,t=this;return null==h.conf&&(h.conf=u),t.beat_spacing=n(i(h.conf.$get("layout.Y_SCALE"),1),h.conf.$get("layout.BEAT_RESOLUTION")),t.slur_index=p([],{}),t.y_offset=5,t.conf_beat_resolution=h.conf.$get("layout.BEAT_RESOLUTION"),t.layout_minc=p([],{}),t.color_default=h.conf.$get("layout.color.color_default"),t.color_variant1=h.conf.$get("layout.color.color_variant1"),t.color_variant2=h.conf.$get("layout.color.color_variant2"),t.draw_instrument=u,((e=t.placeholders)===u||null==e||e.$$is_boolean&&1!=e)&&(t.placeholders=p([],{})),t.$set_instrument_handlers()},m.$$arity=0),e.defn(Z,"$set_instrument_handlers",y=function(){var e,n,a,o,s,l,c,$,f,p,d,g,m,y,v,b=this,x=u,w=u,A=u,k=u,E=u,C=u,S=u,I=u,O=u;return null==h.conf&&(h.conf=u),x=h.conf["$[]"]("layout.X_OFFSET"),w=h.conf["$[]"]("layout.X_SPACING"),A=h.conf.$get("layout.PITCH_OFFSET"),b.bottom_annotation_positions=[[150,289],[325,289],[380,289]],b.pitch_to_xpos=(e=(n=b).$lambda,e.$$p=(a=function(e){a.$$s;return null==e&&(e=u),t(i(t(A,e),w),x)},a.$$s=b,a.$$arity=1,a),e).call(n),function(){return k=h.conf["$[]"]("layout.instrument"),"saitenspiel"["$==="](k)?(b.pitch_to_xpos=(e=(o=b).$lambda,e.$$p=(s=function(e){var r=(s.$$s,u),n=u;return null==e&&(e=u),r=te.get("Hash")["$[]"]([[31,0],[36,1],[38,2],[40,3],[41,4],[43,5],[45,6],[47,7],[48,8],[50,9]]),r=r["$[]"](t(e,A)),n=0,!1!==r&&r!==u&&null!=r&&(n=t(i(r,w),x)),n},s.$$s=b,s.$$arity=1,s),e).call(o),b.bottom_annotation_positions=[[x,287],[x,290],[t(x,100),290]],b.draw_instrument=(e=(l=b).$lambda,e.$$p=(c=function(){var e,r,n=(c.$$s,u);return null==h.conf&&(h.conf=u),n=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new([["M",t(x,30),6],["L",t(x,180),81],["L",t(x,180),216],["L",t(x,30),291]],"open"),e=[h.conf.$get("layout.LINE_MEDIUM")],r=n,r["$line_width="].apply(r,e),e[e.length-1],[n]},c.$$s=b,c.$$arity=0,c),e).call(l)):"okon-f"["$==="](k)||"okon-g"["$==="](k)||"okon-c"["$==="](k)||"okon-d"["$==="](k)?(E="",C="",k=h.conf["$[]"]("layout.instrument"),"okon-f"["$==="](k)?(C="55 57 58 60 62 64 65 67 69 70 72 74 76 77 79 81 82 84",E=""):"okon-g"["$==="](k)?(C="55 57 59 60 62 64 66 67 69 71 72 74 76 78 79 81 83 84",E="      59          66       71          78       83 "):"okon-c"["$==="](k)?(C="55 57 59 60 62 64 65 67 69 71 72 74 76 77 79 81 83 84",E="      59                   71                   83"):"okon-d"["$==="](k)&&(C="55 57 59 61 62 64 66 67 69 71 73 74 76 78 79 81 83 85",E="      59 61       66       71 73       78       83"),S=_(59,7,61,7,66,7,71,7,73,20,78,65,83,110),I=te.get("Hash")["$[]"]((e=($=C.$split(" ").$each_with_index()).$map,e.$$p=(f=function(e,t){f.$$s;return null==e&&(e=u),null==t&&(t=u),[e.$to_i(),t]},f.$$s=b,f.$$arity=2,f),e).call($)),O=(e=(p=E.$split(" ")).$map,e.$$p=(d=function(e){d.$$s;return null==e&&(e=u),e.$to_i()},d.$$s=b,d.$$arity=1,d),e).call(p),b.pitch_to_xpos=(e=(g=b).$lambda,e.$$p=(m=function(e){var r=(m.$$s,u),n=u;return null==e&&(e=u),r=I["$[]"](t(e,A)),n=0,!1!==r&&r!==u&&null!=r&&(n=t(i(r,w),x)),n},m.$$s=b,m.$$arity=1,m),e).call(g),b.bottom_annotation_positions=[[x,290],[t(x,200),290],[t(x,270),290]],b.draw_instrument=(e=(y=b).$lambda,e.$$p=(v=function(){var e,n,a,i,o=v.$$s||this,s=u,l=u;return null==h.conf&&(h.conf=u),s=[],(e=(n=O).$each,e.$$p=(a=function(e){var t=a.$$s||this;return null==t.pitch_to_xpos&&(t.pitch_to_xpos=u),null==e&&(e=u),s.$push(te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new([t.pitch_to_xpos.$call(e),S["$[]"](e)],"*","large"))},a.$$s=o,a.$$arity=1,a),e).call(n),l=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new([["M",r(x,15),280],["L",r(x,15),0],["M",t(x,135),0],["L",t(x,290),157],["L",t(x,290),280]],"open"),e=[h.conf.$get("layout.LINE_MEDIUM")],i=l,i["$line_width="].apply(i,e),e[e.length-1],s.$push(l)},v.$$s=b,v.$$arity=0,v),e).call(y)):"21-strings-a-f"["$==="](k)?b.bottom_annotation_positions=[[190,287],[190,290],[250,290]]:"18-strings-b-e"["$==="](k)?b.bottom_annotation_positions=[[210,287],[210,290],[280,290]]:u}()},y.$$arity=0),e.defn(Z,"$layout_images",v=function(e,t){var n,a,i,o=this,s=u,l=u;return s=[],l=e["$[]"]("images"),((n=l["$nil?"]())===u||null==n||n.$$is_boolean&&1!=n)&&(n=(a=l).$each,n.$$p=(i=function(e,n){var a,o,l,c=i.$$s||this,$=u;return null==h.resources&&(h.resources=u),null==e&&(e=u),null==n&&(n=u),n["$[]"]("show")["$=="](!0)?($=h.resources["$[]"](n["$[]"]("imagename")),(a=$["$is_a?"](te.get("Array")))===u||null==a||a.$$is_boolean&&1!=a||($=$.$join()),!1!==$&&$!==u&&null!=$?s.$push((a=(o=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Image").$new($,r(c.$Vector2d(n["$[]"]("pos")),[0,n["$[]"]("height")]),n["$[]"]("height"))).$tap,a.$$p=(l=function(r){var a,i;l.$$s;return null==r&&(r=u),a=["extract."+t+".images."+e+".pos"],i=r,i["$conf_key="].apply(i,a),a[a.length-1],a=[n["$[]"]("pos")],i=r,i["$conf_value="].apply(i,a),a[a.length-1],a=[p(["handler"],{handler:"annotation"})],i=r,i["$draginfo="].apply(i,a),a[a.length-1]},l.$$s=c,l.$$arity=1,l),a).call(o)):u):u},i.$$s=o,i.$$arity=2,i),n).call(a),s},v.$$arity=2),e.defn(Z,"$layout_debug_grid",b=function(){var e,t,r,a,o,s,l,c,$,f,h=this,_=u,g=u,m=u,y=u,v=u;return _=p(["size","emphasis","line","emphline"],{size:1,emphasis:10,line:.02,emphline:.2}),g=_["$[]"]("size"),m=i(_["$[]"]("emphasis"),g),y=[420,297],v=[],(e=(t=(a=(o=d(0,n(y.$first(),g),!1)).$map,a.$$p=(s=function(e){s.$$s;return null==e&&(e=u),i(e,g)},s.$$s=h,s.$$arity=1,s),a).call(o)).$each,e.$$p=(r=function(e){var t,n,a=(r.$$s,u);return null==e&&(e=u),a=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new([["M",e,0],["l",0,y.$last()]]),t=[_["$[]"]("line")],n=a,n["$line_width="].apply(n,t),t[t.length-1],e["$%"](m)["$=="](0)&&(t=[_["$[]"]("emphline")],n=a,n["$line_width="].apply(n,t),t[t.length-1]),v["$<<"](a)},r.$$s=h,r.$$arity=1,r),e).call(t),(e=(a=(c=($=d(0,n(y.$last(),g),!1)).$map,c.$$p=(f=function(e){f.$$s;return null==e&&(e=u),i(e,g)},f.$$s=h,f.$$arity=1,f),c).call($)).$each,e.$$p=(l=function(e){var t,r,n=(l.$$s,u);return null==e&&(e=u),n=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new([["M",0,e],["l",y.$first(),0]]),t=[_["$[]"]("line")],r=n,r["$line_width="].apply(r,t),t[t.length-1],e["$%"](m)["$=="](0)&&(t=[_["$[]"]("emphline")],r=n,r["$line_width="].apply(r,t),t[t.length-1]),v["$<<"](n)},l.$$s=h,l.$$arity=1,l),e).call(a),v},b.$$arity=0),e.defn(Z,"$layout",x=function(s,l,c,$){var f,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G=this,Y=u,Q=u,V=u,X=u,W=u,J=u,K=u,Z=u,ee=u,re=u,ne=u,ae=u,ie=u,oe=u,se=u,le=u,ce=u,ue=u,$e=u,fe=u,pe=u,de=u,he=u,_e=u,ge=u,me=u,ye=u,ve=u,be=u,xe=u,we=u,Ae=u,ke=u,Ee=u,Ce=u,Se=u,Ie=u,Oe=u,Te=u;null==h.conf&&(h.conf=u),null==h.log&&(h.log=u),null==l&&(l=u),null==c&&(c=0),null==$&&($="A4"),Y=G.$get_print_options(c),G.print_options_raw=Y,Q=Y.$get(),V=!1!==(f=Q["$[]"]("layout"))&&f!==u&&null!=f?f:p([],{}),h.conf.$push(p(["layout"],{layout:V})),h.conf.$push(p(["printer"],{printer:!1!==(f=Q["$[]"]("printer"))&&f!==u&&null!=f?f:p([],{})})),G.$initialize(),X=[],(f=h.conf["$[]"]("layout.grid"))===u||null==f||f.$$is_boolean&&1!=f||(X=G.$layout_debug_grid()),W=G.$layout_images(Q,c),G.layout_minc=!1!==(f=Y["$[]"]("notebound.minc"))&&f!==u&&null!=f?f:p([],{}),G.y_offset=Q["$[]"]("startpos"),G.y_size=h.conf.$get("layout.DRAWING_AREA_SIZE").$last(),J=u,(f=(_=h.log).$benchmark,f.$$p=(g=function(){var e=g.$$s||this,r=u;return r=t(Q["$[]"]("voices"),Q["$[]"]("layoutlines").$uniq()),J=e.$compute_beat_compression(s,r)},g.$$s=G,g.$$arity=0,g),f).call(_,"compute beat compression map"),K=!1!==(f=J.$values().$max())&&f!==u&&null!=f?f:0,Z=n(r(h.conf.$get("layout.DRAWING_AREA_SIZE").$last(),G.y_offset),K),(f=o(Z,G.beat_spacing))===u||null==f||f.$$is_boolean&&1!=f||(ee=n(G.beat_spacing,Z),h.log.$warning("note distance too small (factor "+ee+")")),G.beat_spacing=[Z,i(h.conf.$get("layout.packer.pack_max_spreadfactor"),G.beat_spacing)].$min(),l=(f=h.conf.$get("layout.bottomup"))===u||null==f||f.$$is_boolean&&1!=f?!1!==(f=l)&&f!==u&&null!=f?f:(m=(b=te.get("Proc")).$new,m.$$p=(x=function(e){var t=x.$$s||this;return null==t.beat_spacing&&(t.beat_spacing=u),null==t.y_offset&&(t.y_offset=u),null==e&&(e=u),e*t.beat_spacing+t.y_offset},x.$$s=G,x.$$arity=1,x),m).call(b):!1!==(f=l)&&f!==u&&null!=f?f:(m=(y=te.get("Proc")).$new,m.$$p=(v=function(e){var t=v.$$s||this;return null==t.y_size&&(t.y_size=u),null==t.beat_spacing&&(t.beat_spacing=u),null==e&&(e=u),t.y_size-e*t.beat_spacing},v.$$s=G,v.$$arity=1,v),m).call(y),re=(f=(m=te.get("Proc")).$new,f.$$p=(w=function(e){w.$$s;return null==e&&(e=u),l.$call(J["$[]"](e))},w.$$s=G,w.$$arity=1,w),f).call(m),ne=(f=(A=Q["$[]"]("synchlines")).$select,f.$$p=(k=function(e){var t;k.$$s;return null==e&&(e=u),t=Q["$[]"]("voices")["$include?"](e.$first()),!1!==t&&t!==u&&null!=t?Q["$[]"]("voices")["$include?"](e.$last()):t},k.$$s=G,k.$$arity=1,k),f).call(A),ae=(f=(E=ne).$map,f.$$p=(C=function(e){var t,r,n,a,i,o=C.$$s||this,l=u;return null==h.log&&(h.log=u),null==e&&(e=u),l=(t=(r=h.log).$benchmark,t.$$p=(n=function(){n.$$s;return s.$build_synch_points(e)},n.$$s=o,n.$$arity=0,n),t).call(r,"build_syncpoints"),(t=(a=l).$map,t.$$p=(i=function(e){i.$$s;return null==e&&(e=u),e.$synched_notes()},i.$$s=o,i.$$arity=1,i),t).call(a)},C.$$s=G,C.$$arity=1,C),f).call(E).$flatten(),ie=Q["$[]"]("voices"),oe=(f=(S=s.$voices().$each_with_index()).$map,f.$$p=(I=function(e,t){var r,n=I.$$s||this,a=u,i=u;return null==e&&(e=u),null==t&&(t=u),(r=ie["$include?"](t))===u||null==r||r.$$is_boolean&&1!=r?u:(a=Q["$[]"]("countnotes"),((r=a["$[]"]("voices")["$include?"](t))===u||null==r||r.$$is_boolean&&1!=r)&&(a=u),i=Q["$[]"]("barnumbers"),((r=i["$[]"]("voices")["$include?"](t))===u||null==r||r.$$is_boolean&&1!=r)&&(i=u),n.$layout_voice(e,re,c,p(["voice_nr","nonflowrest","flowline","subflowline","jumpline","repeatsigns","synched_notes","countnotes","barnumbers","print_options_raw"],{voice_nr:t,nonflowrest:Q["$[]"]("nonflowrest"),flowline:Q["$[]"]("flowlines")["$include?"](t),subflowline:Q["$[]"]("subflowlines")["$include?"](t),jumpline:Q["$[]"]("jumplines")["$include?"](t),repeatsigns:Q["$[]"]("repeatsigns"),synched_notes:ae,countnotes:a,barnumbers:i,print_options_raw:Y})))},I.$$s=G,I.$$arity=2,I),f).call(S).$flatten().$compact(),(f=h.log["$loglevel?"]("warning"))===u||null==f||f.$$is_boolean&&1!=f||(se=te.get("CollisionDetector").$new(),se.$check_annotations(oe)),le=(f=(O=ne).$map,f.$$p=(T=function(e){var t,r,n,a=T.$$s||this,i=u;return null==e&&(e=u),i=s.$build_synch_points(e),(t=(r=i).$map,t.$$p=(n=function(e){var t,r,a=n.$$s||this,i=u;return null==e&&(e=u),i=te.get("FlowLine").$new(e.$notes().$first().$sheet_drawable(),e.$notes().$last().$sheet_drawable(),"dashed"),t=[a.$compute_color_by_variant_no(e.$notes().$first().$variant())],r=i,r["$color="].apply(r,t),t[t.length-1],i},n.$$s=a,n.$$arity=1,n),t).call(r)},T.$$s=G,T.$$arity=1,T),f).call(O).$flatten(),ce=G.$layout_stringnames(Q,c),(f=(P=$["$=="]("A4"))?a(h.conf["$[]"]("printer.a4_pages").$length(),1):$["$=="]("A4"))===u||null==f||f.$$is_boolean&&1!=f||(ue=i(12,h.conf.$get("layout.X_SPACING")),(f=(P=d(1,2,!1)).$each,f.$$p=(M=function(e){var r,n,a,o=M.$$s||this;return null==e&&(e=u),(r=(n=[4,290]).$each,r.$$p=(a=function(r){a.$$s;return null==h.conf&&(h.conf=u),null==r&&(r=u),ce["$<<"](te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new([t(t(i(.25,h.conf.$get("layout.X_SPACING")),h.conf.$get("layout.X_OFFSET")),i(ue,e)),r],"x","small",u))},a.$$s=o,a.$$arity=1,a),r).call(n)},M.$$s=G,M.$$arity=1,M),f).call(P)),$e=[],fe=!1!==(f=s.$meta_data()["$[]"]("title"))&&f!==u&&null!=f?f:"untitled",pe=s.$meta_data()["$[]"]("filename"),de=s.$meta_data()["$[]"]("meter"),!1!==de&&de!==u&&null!=de&&(de=de.$last().$split("=").$first()),he=s.$meta_data()["$[]"]("key"),_e=s.$meta_data()["$[]"]("composer"),ge=s.$meta_data()["$[]"]("tempo_display"),me=Q["$[]"]("title"),ye=Q["$[]"]("legend")["$[]"]("pos"),ve=Q["$[]"]("legend")["$[]"]("spos"),be=me+"\n"+_e+"\nTakt: "+de+" ("+ge+")\nTonart: "+he,xe=!1!==(f=G.print_options_raw.$get("legend.style"))&&f!==u&&null!=f?f:"regular",$e["$<<"]((f=(N=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(ye,fe,"large",u,"extract."+c+".legend.pos",ye)).$tap,f.$$p=(B=function(e){var t,r;B.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},B.$$s=G,B.$$arity=1,B),f).call(N)),(f=h.conf["$[]"]("extract."+c+".notes.T06_legend")["$nil?"]())===u||null==f||f.$$is_boolean&&1!=f||$e["$<<"]((f=(R=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(ve,be,xe,u,"extract."+c+".legend.spos",ve)).$tap,f.$$p=(j=function(e){var t,r;j.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},j.$$s=G,j.$$arity=1,j),f).call(R)),we=te.get("Time").$now().$strftime("%Y-%m-%d %H:%M:%S"),$e["$<<"](te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(G.bottom_annotation_positions["$[]"](0),pe+" - created "+we+" by Zupfnoter "+te.get("VERSION")+" ["+te.get("Controller").$get_uri()["$[]"]("hostname")+"]","smaller")),$e["$<<"](te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(G.bottom_annotation_positions["$[]"](1),"Zupfnoter: https://www.zupfnoter.de","smaller")),$e["$<<"](te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(G.bottom_annotation_positions["$[]"](2),s.$checksum(),"smaller")),Ae=Q["$[]"]("lyrics"),ke=s.$harpnote_options()["$[]"]("lyrics")["$[]"]("text"),!1!==ke&&ke!==u&&null!=ke&&(Ee=ke.$join("\n"),!1!==Ae&&Ae!==u&&null!=Ae&&(Ce=Ee.$gsub("\t"," ").$squeeze(" ").$split(/\n\n+/),Ae.$delete("versepos"),(f=(F=Ae).$each,f.$$p=(D=function(e,t){var n,i,s,l,$,f=D.$$s||this,d=u,h=u,_=u,g=u;return null==f.print_options_raw&&(f.print_options_raw=u),null==e&&(e=u),null==t&&(t=u),d=t["$[]"]("pos"),h=(n=(i=!1!==(l=t["$[]"]("verses"))&&l!==u&&null!=l?l:[]).$map,n.$$p=(s=function(e){var t,n=(s.$$s,u);return null==e&&(e=u),e["$=="](0)&&(n=9999),(t=o(e,0))===u||null==t||t.$$is_boolean&&1!=t||(n=e),(t=a(e,0))===u||null==t||t.$$is_boolean&&1!=t||(n=r(e,1)),Ce["$[]"](n)},s.$$s=f,s.$$arity=1,s),n).call(i).$join("\n\n"),_="lyrics."+e,g="extract."+c+"."+_,xe=!1!==(n=f.print_options_raw.$get(_+".style"))&&n!==u&&null!=n?n:"regular",$e["$<<"]((n=(l=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(d,h,xe,u,g+".pos",d)).$tap,n.$$p=($=function(e){var t,r;$.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},$.$$s=f,$.$$arity=1,$),n).call(l))},D.$$s=G,D.$$arity=2,D),f).call(F))),Se=Q["$[]"]("sortmark"),(f=Se["$[]"]("show"))===u||null==f||f.$$is_boolean&&1!=f||ce["$<<"](G.$layout_sortmark(fe,Se));try{(f=(L=Q["$[]"]("notes")).$each,f.$$p=(z=function(e,t){var r,n,a,i=z.$$s||this,o=u;return null==e&&(e=u),null==t&&(t=u),o="extract."+c+".notes."+e,((r=t["$[]"]("pos"))===u||null==r||r.$$is_boolean&&1!=r)&&i.$raise(te.get("I18n").$t("missing pos")+" in "+o),((r=t["$[]"]("text"))===u||null==r||r.$$is_boolean&&1!=r)&&i.$raise(te.get("I18n").$t("missing text")+" in "+o),$e["$<<"]((r=(n=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(t["$[]"]("pos"),i.$resolve_placeholder(t["$[]"]("text"),o),t["$[]"]("style"),u,o+".pos",t["$[]"]("pos"))).$tap,r.$$p=(a=function(e){var t,r;a.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},a.$$s=i,a.$$arity=1,a),r).call(n))},z.$$s=G,z.$$arity=2,z),f).call(L)}catch(t){if(!e.rescue(t,[te.get("Exception")]))throw t;Ie=t;try{h.log.$error(Ie.$message())}finally{e.pop_exception()}}return(f=G.draw_instrument)===u||null==f||f.$$is_boolean&&1!=f||(f=(q=G.draw_instrument.$call()).$each,f.$$p=(U=function(e){U.$$s;return null==e&&(e=u),ce.$push(e)},U.$$s=G,U.$$arity=1,U),f).call(q),Oe=t(t(t(t(t(W,X),le),oe),$e),ce),Te=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Sheet").$new(Oe,ie),f=[h.conf["$[]"]("printer")],H=Te,H["$printer_config="].apply(H,f),f[f.length-1],h.conf.$pop(),h.conf.$pop(),Te},x.$$arity=-2),e.defn(Z,"$get_print_options",w=function(e){var t,r,n=u,a=u;return null==h.conf&&(h.conf=u),null==h.log&&(h.log=u),n=te.get("Confstack").$new(),t=[!1],r=n,r["$strict="].apply(r,t),t[t.length-1],n.$push(h.conf.$get("extract.0")),a=h.conf.$get("extract."+e),!1!==a&&a!==u&&null!=a?n.$push(a):h.log.$warning("selected print variant ["+e+"] not available using [0]: '"+n.$get("title")+"'"),(t=n["$[]"]("layout.beams"))===u||null==t||t.$$is_boolean&&1!=t||n.$push(p(["layout"],{layout:p(["DURATION_TO_STYLE"],{DURATION_TO_STYLE:h.conf["$[]"]("layout.DURATION_TO_BEAMS")})})),n},w.$$arity=1),e.defn(Z,"$layout_sortmark",A=function(a,o){var s,l,c,$,f=this,d=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u;return null==h.conf&&(h.conf=u),d=a.$upcase().$gsub(/[YZ]/,p(["","","","","Y","Z"],{"":"AE","":"OE","":"UE","":"ss",Y:"X",Z:"X"})).$gsub(/[^A-Za-z]/,""),_=(s=(l=t(d,"AAAA").$split("")).$map,s.$$p=(c=function(e){c.$$s;return null==e&&(e=u),r(e.$ord(),"A".$ord())},c.$$s=f,c.$$arity=1,c),s).call(l),g=t(_["$[]"](0),n(i(t(t(i(.1,_["$[]"](1)),i(.01,_["$[]"](2))),i(.001,_["$[]"](3))),.5),2.4)),$=o["$[]"]("size"),s=e.to_ary($),m=null==s[0]?u:s[0],y=null==s[1]?u:s[1],v=function(){return(s=o["$[]"]("fill"))===u||null==s||s.$$is_boolean&&1!=s?"open":"filled"}(),b=i(t(12.5,g),h.conf.$get("layout.X_SPACING")),x=[["M",b,0],["l",n(m["$-@"](),2),y],["l",m,0],["l",n(m["$-@"](),2),y["$-@"]()],["l",0,y],["l",0,y["$-@"]()],["z"]],te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(x,v)},A.$$arity=2),e.defn(Z,"$layout_stringnames",k=function(e,a){var o,s,l,c,$,f=this,p=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u,A=u,k=u;return null==h.conf&&(h.conf=u),p=e["$[]"]("stringnames")["$[]"]("vpos"),_=e["$[]"]("stringnames")["$[]"]("marks")["$[]"]("hpos"),g="stringnames",m=[],((o=_["$empty?"]())===u||null==o||o.$$is_boolean&&1!=o)&&(m=t(m,(o=(s=_).$inject,o.$$p=(l=function(t,r){var n,a,i,o=l.$$s||this;return null==t&&(t=u),null==r&&(r=u),(n=(a=e["$[]"]("stringnames")["$[]"]("marks")["$[]"]("vpos")).$each,n.$$p=(i=function(e){var n=i.$$s||this,a=u;return null==n.pitch_to_xpos&&(n.pitch_to_xpos=u),null==e&&(e=u),a=n.$make_sheetmark_path([n.pitch_to_xpos.$call(r),e]),t["$<<"](te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(a,"filled"))},i.$$s=o,i.$$arity=1,i),n).call(a),t},l.$$s=f,l.$$arity=2,l),o).call(s,[]))),((o=p["$empty?"]())===u||null==o||o.$$is_boolean&&1!=o)&&(y=37,v=e["$[]"]("stringnames")["$[]"]("text").$split(" "),v=i(v,t(n(y,v.$length()),1)),b=h.conf.$get("layout.PITCH_OFFSET")["$-@"](),x=r(t(b,y),1),p=e["$[]"]("stringnames")["$[]"]("vpos"),w=e["$[]"]("stringnames")["$[]"]("style"),A=h.conf.$get("layout.X_SPACING"),k=r(h.conf.$get("layout.X_OFFSET"),1),m=t(m,(o=(c=d(b,x,!1).$to_a()).$inject,o.$$p=($=function(e,n){var a,o,s,l=$.$$s||this,c=u;return null==e&&(e=u),null==n&&(n=u),c=t(i(t(b["$-@"](),n),A),k),(a=(o=p).$each,a.$$p=(s=function(t){s.$$s;return null==t&&(t=u),e["$<<"](te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new([c,t],v["$[]"](r(n,b)),w,u,g))},s.$$s=l,s.$$arity=1,s),a).call(o),e},$.$$s=f,$.$$arity=2,$),o).call(c,[]))),m},k.$$arity=2),e.cdecl(te,"NOTE_POSITION_LOOKUP",p(["11","12","13","21","22","23","31","32","33"],{11:["r","r"],12:["r","l"],13:["r","l"],21:["r","r"],22:["r","l"],23:["l","l"],31:["l","r"],32:["l","r"],33:["l","l"]})),e.defn(Z,"$compute_note_position",E=function(e,r,n,i){var s,l=u,c=u;return l=t(e["$<=>"](r),2),c=t(n["$<=>"](r),2),(s=!1!==i&&i!==u&&null!=i?o(r,10):i)===u||null==s||s.$$is_boolean&&1!=s?(s=!1!==i&&i!==u&&null!=i?a(r,410):i)===u||null==s||s.$$is_boolean&&1!=s?te.get("NOTE_POSITION_LOOKUP")["$[]"](""+l+c):["l","l"]:["r","r"]},E.$$arity=4),e.defn(Z,"$layout_voice",C=function(n,o,s,l){var c,$,f,d,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V=this,X=u,W=u,J=u,K=u,Z=u,ee=u,re=u,ne=u,ae=u,ie=u,oe=u,se=u,le=u,ce=u,ue=u,$e=u,fe=u,pe=u,de=u,he=u,_e=u,ge=u;return null==h.log&&(h.log=u),null==h.settings&&(h.settings=u),null==h.conf&&(h.conf=u),V.print_options_keys=V.print_options_raw.$keys(),X=l["$[]"]("voice_nr"),W=(c=($=n).$select,c.$$p=(f=function(e){f.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Playable"))},f.$$s=V,f.$$arity=1,f),c).call($),((c=l["$[]"]("nonflowrest"))===u||null==c||c.$$is_boolean&&1!=c)&&(J=u,(c=(d=W).$each,c.$$p=(_=function(e){var t,r,n;_.$$s;return null==e&&(e=u),r=e["$is_a?"](te.get("Pause")),(t=!1!==r&&r!==u&&null!=r?l["$[]"]("flowline")["$!"]():r)===u||null==t||t.$$is_boolean&&1!=t||(t=[!1],r=e,r["$visible="].apply(r,t),t[t.length-1]),n=e["$is_a?"](te.get("Pause")),r=!1!==n&&n!==u&&null!=n?l["$[]"]("subflowline")["$!"]():n,(t=!1!==r&&r!==u&&null!=r?l["$[]"]("flowline")["$!"]():r)===u||null==t||t.$$is_boolean&&1!=t||(t=[!1],r=e,r["$visible="].apply(r,t),t[t.length-1]),n=l["$[]"]("flowline")["$!"](),r=!1!==n&&n!==u&&null!=n?e.$visible():n,(t=!1!==r&&r!==u&&null!=r?l["$[]"]("synched_notes")["$include?"](e.$proxy_note())["$!"]():r)===u||null==t||t.$$is_boolean&&1!=t||((t=J["$nil?"]())===u||null==t||t.$$is_boolean&&1!=t)&&(t=[!0],r=J,r["$visible="].apply(r,t),t[t.length-1]),J=e},_.$$s=V,_.$$arity=1,_),c).call(d)),K=[],Z=(c=(g=W).$map,c.$$p=(m=function(e){var t,r=m.$$s||this,n=u,a=u,i=u,c=u;return null==e&&(e=u),n="notebound.nconf.v_"+X+".t_"+e.$time(),a="extract."+s+"."+n,i=r.$layout_playable(e,o,a),c=i.$proxy(),K.$push(function(){return(t=e.$decorations()["$empty?"]())===u||null==t||t.$$is_boolean&&1!=t?r.$make_decorations_per_playable(e,c,s,l,X):[]}()),c.$more_conf_keys().$push(p(["conf_key","text","icon"],{conf_key:"extract."+s+".notebound.minc."+e.$time()+".minc_f",text:te.get("I18n").$t("Edit Minc"),icon:"fa fa-arrows-v"})),i.$shapes()},m.$$s=V,m.$$arity=1,m),c).call(g).$flatten().$compact(),K=K.$flatten().$compact(),y=(v=(b=h.log).$benchmark,v.$$p=(x=function(){return(x.$$s||this).$layout_barnumbers_countnotes(W,s,l,X)},x.$$s=V,x.$$arity=0,x),v).call(b,"countnotes / barnumbers"),c=e.to_ary(y),ee=null==c[0]?u:c[0],re=null==c[1]?u:c[1],J=u,ne=h.settings["$[]"]("flowconf")["$=="]("true"),ae=h.conf["$[]"]("defaults.notebound.flowline"),ie="notebound.flowline.v_"+X,oe=!1!==(c=l["$[]"]("print_options_raw")["$[]"](ie))&&c!==u&&null!=c?c:p([],{}),se=(c=(y=(v=(A=n).$select,v.$$p=(k=function(e){k.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Playable"))},k.$$s=V,k.$$arity=1,k),v).call(A)).$map,c.$$p=(w=function(r){var n,a,i,o,l=w.$$s||this,c=u,$=u,f=u,d=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u,A=u,k=u;if(null==h.conf&&(h.conf=u),null==r&&(r=u),c=u,(n=J["$nil?"]())===u||null==n||n.$$is_boolean&&1!=n){if((n=!0)!==u&&null!=n&&(!n.$$is_boolean||1==n))if($=""+r.$znid(),f=oe["$[]"]($),(n=!1!==(a=f)&&a!==u&&null!=a?a:ne["$=="](!0))===u||null==n||n.$$is_boolean&&1!=n)c=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("FlowLine").$new(J.$sheet_drawable(),r.$sheet_drawable());else{d="extract."+s+"."+ie+"."+$,_=t(d,".*"),g=l.$Vector2d(J.$sheet_drawable().$center()),m=l.$Vector2d(r.$sheet_drawable().$center()),y=te.get("Confstack").$new(),y.$push(ae);try{y.$push(f)}catch(t){if(!e.rescue(t,[te.get("StandardError")]))throw t}a=l.$make_annotated_bezier_path([g,m],y),n=e.to_ary(a),v=null==n[0]?u:n[0],b=null==n[1]?u:n[1],x=null==n[2]?u:n[2],A=null==n[3]?u:n[3],k=ne["$=="](!0)?p(["handler","p1","p2","cp1","cp2","mp","tuplet_options","conf_key","callback"],{handler:"tuplet",p1:g,p2:m,cp1:x,cp2:A,mp:b,tuplet_options:y,conf_key:d,callback:u}):u,c=(n=(a=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(v)).$tap,n.$$p=(i=function(e){var t,r;i.$$s;return null==e&&(e=u),t=[_],r=e,r["$conf_key="].apply(r,t),t[t.length-1],t=[k],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},i.$$s=l,i.$$arity=1,i),n).call(a)}n=[h.conf.$get("layout.LINE_MEDIUM")],o=c,o["$line_width="].apply(o,n),n[n.length-1],((n=J["$visible?"]())===u||null==n||n.$$is_boolean&&1!=n)&&(c=u)}else;return(n=r["$first_in_part?"]())===u||null==n||n.$$is_boolean&&1!=n||(c=u),((n=r["$visible?"]())===u||null==n||n.$$is_boolean&&1!=n)&&(c=u),J=r,c},w.$$s=V,w.$$arity=1,w),c).call(y).$compact(),J=u,le=(c=(v=(C=(S=n).$select,C.$$p=(I=function(e){var t;I.$$s;return null==e&&(e=u),!1!==(t=e["$is_a?"](te.get("Playable")))&&t!==u&&null!=t?t:e["$is_a?"](te.get("SynchPoint"))},I.$$s=V,I.$$arity=1,I),C).call(S)).$map,c.$$p=(E=function(e){var t,r,n,a=(E.$$s,u);return null==e&&(e=u),((t=l["$[]"]("synched_notes")["$include?"](e.$proxy_note()))===u||null==t||t.$$is_boolean&&1!=t)&&(a=u,n=J["$nil?"]()["$!"](),r=!1!==n&&n!==u&&null!=n?J.$visible():n,(t=!1!==r&&r!==u&&null!=r?e.$visible():r)===u||null==t||t.$$is_boolean&&1!=t||(a=te.get("FlowLine").$new(J.$sheet_drawable(),e.$sheet_drawable(),"dotted")),(t=e["$first_in_part?"]())===u||null==t||t.$$is_boolean&&1!=t||(a=u)),J=e,a},E.$$s=V,E.$$arity=1,E),c).call(v).$compact(),((c=l["$[]"]("subflowline"))===u||null==c||c.$$is_boolean&&1!=c)&&(le=[]),((c=l["$[]"]("flowline"))===u||null==c||c.$$is_boolean&&1!=c)&&(se=[]),((c=l["$[]"]("countnotes"))===u||null==c||c.$$is_boolean&&1!=c)&&(re=[]),((c=l["$[]"]("barnumbers"))===u||null==c||c.$$is_boolean&&1!=c)&&(ee=[]),ce=W.$first(),ue=[],$e=(c=(C=W).$inject,c.$$p=(O=function(n,a){var i,o,c,$,f,d,_,g,m,y=O.$$s||this,v=u,b=u,x=u,w=u,A=u,k=u,E=u,C=u,S=u,I=u,T=u,P=u,M=u,N=u,B=u,R=u,j=u,F=u;if(null==h.conf&&(h.conf=u),null==n&&(n=u),null==a&&(a=u),(i=a["$tuplet_start?"]())===u||null==i||i.$$is_boolean&&1!=i||(ce=a),!1!==ce&&ce!==u&&null!=ce&&ue.$push(a.$time()),(i=a["$tuplet_end?"]())!==u&&null!=i&&(!i.$$is_boolean||1==i)){v="notebound.tuplet.v_"+X+"."+ce.$znid(),b="extract."+s+"."+v,x="pos",w=te.get("Confstack").$new(),w.$push(h.conf["$[]"]("defaults.notebound.tuplet"));try{w.$push(l["$[]"]("print_options_raw")["$[]"](v))}catch(t){if(!e.rescue(t,[te.get("StandardError")]))throw t}A=y.$Vector2d(ce.$sheet_drawable().$center()),k=y.$Vector2d(a.$sheet_drawable().$center()),o=y.$make_annotated_bezier_path([A,k],w),i=e.to_ary(o),E=null==i[0]?u:i[0],C=null==i[1]?u:i[1],S=null==i[2]?u:i[2],I=null==i[3]?u:i[3],T=function(){try{return w["$[]"]("pos")}catch(t){if(e.rescue(t,[te.get("StandardError")]))return[0,0];throw t}}(),P=t(C,T),M=(i=(o=r(P,C).$to_a()).$map,i.$$p=(c=function(e){c.$$s;return null==e&&(e=u),e.$round(0)},c.$$s=y,c.$$arity=1,c),i).call(o),N=(i=($=y).$lambda,i.$$p=(f=function(e){f.$$s;return null==e&&(e=u),u},f.$$s=y,f.$$arity=1,f),i).call($),w["$[]"]("show")["$=="](!1)||(B=t(b,".*"),R=!1!==(i=l["$[]"]("print_options_raw")["$[]"]("tuplets.style"))&&i!==u&&null!=i?i:"small",j=p(["handler","p1","p2","cp1","cp2","mp","tuplet_options","conf_key","callback"],{handler:"tuplet",p1:A,p2:k,cp1:S,cp2:I,mp:C,tuplet_options:w,conf_key:b,callback:N}),F=!1!==(i=l["$[]"]("print_options_raw")["$[]"]("tuplets.text"))&&i!==u&&null!=i?i:a.$tuplet().$to_s(),F=F.$gsub("{{tuplet}}",a.$tuplet().$to_s()),n.$push((i=(d=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(E)).$tap,i.$$p=(_=function(e){var t,r;_.$$s;return null==h.conf&&(h.conf=u),null==e&&(e=u),t=[B],r=e,r["$conf_key="].apply(r,t),t[t.length-1],t=[h.conf.$get("layout.LINE_THIN")],r=e,r["$line_width="].apply(r,t),t[t.length-1],t=[j],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},_.$$s=y,_.$$arity=1,_),i).call(d)),n.$push((i=(g=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(P.$to_a(),F,R,ce.$origin(),t(b,"."+x),M.$to_a())).$tap,i.$$p=(m=function(e){var t,r;m.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},m.$$s=y,m.$$arity=1,m),i).call(g))),ue=[],ce=u}return n},O.$$s=V,O.$$arity=2,O),c).call(C,[]),V.slur_index["$[]="]("first_playable",W.$first()),fe=W.$first(),pe=(c=(T=W).$inject,c.$$p=(P=function(r,n){var a,i,o,s,l,c,$,f,p,d=P.$$s||this,_=u,g=u,m=u;return null==d.slur_index&&(d.slur_index=u),null==h.conf&&(h.conf=u),null==r&&(r=u),null==n&&(n=u),(a=n["$tie_end?"]())===u||null==a||a.$$is_boolean&&1!=a||(_=t(d.$Vector2d(fe.$sheet_drawable().$center()),[3,0]),g=t(d.$Vector2d(n.$sheet_drawable().$center()),[3,0]),m=function(){return(a=h.conf["$[]"]("layout.bottomup"))===u||null==a||a.$$is_boolean&&1!=a?d.$make_slur_path(_,g):d.$make_slur_path(g,_)}(),r.$push((a=(i=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(m)).$tap,a.$$p=(o=function(e){var t,r;o.$$s;return null==h.conf&&(h.conf=u),null==e&&(e=u),t=[h.conf.$get("layout.LINE_MEDIUM")],r=e,r["$line_width="].apply(r,t),t[t.length-1]},o.$$s=d,o.$$arity=1,o),a).call(i)),(a=n["$is_a?"](te.get("Harpnotes").$$scope.get("Music").$$scope.get("SynchPoint")))===u||null==a||a.$$is_boolean&&1!=a||(a=(s=n.$notes()).$each_with_index,a.$$p=(l=function(n,a){var i,o,s,c=l.$$s||this;null==h.log&&(h.log=u),null==n&&(n=u),null==a&&(a=u);try{return _=fe.$notes()["$[]"](a),_=t(c.$Vector2d(_.$sheet_drawable().$center()),[3,0]),g=t(c.$Vector2d(n.$sheet_drawable().$center()),[3,0]),m=c.$make_slur_path(_,g),r.$push((i=(o=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(m)).$tap,i.$$p=(s=function(e){var t,r;s.$$s;return null==h.conf&&(h.conf=u),null==e&&(e=u),t=[h.conf.$get("layout.LINE_MEDIUM")],r=e,r["$line_width="].apply(r,t),t[t.length-1]},s.$$s=c,s.$$arity=1,s),i).call(o))}catch(t){if(!e.rescue(t,[te.get("Exception")]))throw t;t;try{return h.log.$error("tied chords which doesn't have same number of notes",n.$start_pos())}finally{e.pop_exception()}}},l.$$s=d,l.$$arity=2,l),a).call(s)),(a=n["$tie_start?"]())===u||null==a||a.$$is_boolean&&1!=a||(fe=n),(a=(c=n.$slur_starts()).$each,a.$$p=($=function(e){var t=$.$$s||this;return null==t.slur_index&&(t.slur_index=u),null==e&&(e=u),t.slur_index["$[]="](e,n)},$.$$s=d,$.$$arity=1,$),a).call(c),d.slur_index["$[]="](n.$slur_starts().$first(),n),(a=(f=n.$slur_ends()).$each,a.$$p=(p=function(e){var a,i,o,s=p.$$s||this,l=u,c=u;return null==s.slur_index&&(s.slur_index=u),null==h.conf&&(h.conf=u),null==e&&(e=u),l=!1!==(a=s.slur_index["$[]"](e))&&a!==u&&null!=a?a:s.slur_index["$[]"]("first_playable"),_=t(s.$Vector2d(l.$sheet_drawable().$center()),[3,0]),g=t(s.$Vector2d(n.$sheet_drawable().$center()),[3,0]),c=s.$make_slur_path(_,g),(a=h.conf.$get("layout.SHOW_SLUR"))===u||null==a||a.$$is_boolean&&1!=a?u:r.$push((a=(i=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(c)).$tap,a.$$p=(o=function(e){var t,r;o.$$s;return null==h.conf&&(h.conf=u),null==e&&(e=u),t=[h.conf.$get("layout.LINE_MEDIUM")],r=e,r["$line_width="].apply(r,t),t[t.length-1]},o.$$s=s,o.$$arity=1,o),a).call(i))},p.$$s=d,p.$$arity=1,p),a).call(f),r},P.$$s=V,P.$$arity=2,P),c).call(T,[]),de=(c=(M=(B=(R=n).$select,B.$$p=(j=function(e){j.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Goto"))},j.$$s=V,j.$$arity=1,j),B).call(R)).$map,c.$$p=(N=function(e){var n,o,c,$=N.$$s||this,f=u,d=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u,A=u,k=u,E=u,C=u;return null==h.log&&(h.log=u),null==h.conf&&(h.conf=u),null==e&&(e=u),(n=e.$conf_key())===u||null==n||n.$$is_boolean&&1!=n||(f="extract."+s+"."+e.$conf_key(),!1!==(d=l["$[]"]("print_options_raw")["$[]"](e.$conf_key()))&&d!==u&&null!=d||(_=f.$gsub(/(.*)\.(\d+)\.(\d+)\.(\w+)/,"\\1.\\2.\\4"),d=l["$[]"]("print_options_raw")["$[]"](_))),!1!==d&&d!==u&&null!=d||(d=e.$policy()["$[]"]("distance")),!1!==d&&d!==u&&null!=d||(d=1),g=function(){return!d["$=="](0)}(),(n=a(d,0))===u||null==n||n.$$is_boolean&&1!=n||(d=r(d,1)),m=!1!==(n=e.$policy()["$[]"]("from_anchor"))&&n!==u&&null!=n?n:"after",y=!1!==(n=e.$policy()["$[]"]("to_anchor"))&&n!==u&&null!=n?n:"before",v=!1!==(n=e.$policy()["$[]"]("vertical_anchor"))&&n!==u&&null!=n?n:"from",h.log.$debug("vertical line x offset: "+d+" harpnotes:2060"),b=i(t(d,.5),h.conf.$get("layout.X_SPACING")),x=e.$from().$sheet_drawable(),w=e.$to().$sheet_drawable(),(n=h.conf["$[]"]("layout.bottomup"))===u||null==n||n.$$is_boolean&&1!=n||(A=p(["before","after"],{before:"after",after:"before"}),m=A["$[]"](m),y=A["$[]"](y)),
k=p(["from","to","vertical","vertical_anchor","padding","xspacing","jumpline_anchor"],{from:p(["center","size","anchor"],{center:x.$center(),size:x.$size(),anchor:m}),to:p(["center","size","anchor"],{center:w.$center(),size:w.$size(),anchor:y}),vertical:b,vertical_anchor:v,padding:e.$policy()["$[]"]("padding"),xspacing:h.conf["$[]"]("layout.X_SPACING"),jumpline_anchor:h.conf["$[]"]("layout.jumpline_anchor")}),E=te.get("Harpnotes").$$scope.get("Layout").$$scope.get("Default").$make_path_from_jumpline(k),C=p(["handler","jumpline","xspacing"],{handler:"jumpline",jumpline:k,xspacing:h.conf.$get("layout.X_SPACING")}),!1!==g&&g!==u&&null!=g?(o=e.$policy()["$[]"]("is_repeat"),(n=!1!==o&&o!==u&&null!=o?l["$[]"]("repeatsigns")["$[]"]("voices")["$include?"](l["$[]"]("voice_nr")):o)===u||null==n||n.$$is_boolean&&1!=n?[(n=(o=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(E["$[]"](0),u,e.$from())).$tap,n.$$p=(c=function(e){var t,r;c.$$s;return null==h.conf&&(h.conf=u),null==e&&(e=u),t=[f],r=e,r["$conf_key="].apply(r,t),t[t.length-1],t=[d],r=e,r["$conf_value="].apply(r,t),t[t.length-1],t=[h.conf.$get("layout.LINE_THICK")],r=e,r["$line_width="].apply(r,t),t[t.length-1],t=[C],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},c.$$s=$,c.$$arity=1,c),n).call(o),te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(E["$[]"](1),"filled",e.$from())]:u):u},N.$$s=V,N.$$arity=1,N),c).call(M).$flatten().$compact(),((c=l["$[]"]("jumpline"))===u||null==c||c.$$is_boolean&&1!=c)&&(de=[]),he=V.color_default,(c=(B=de).$each,c.$$p=(F=function(e){var t,r;F.$$s;return null==e&&(e=u),t=[he],r=e,r["$color="].apply(r,t),t[t.length-1]},F.$$s=V,F.$$arity=1,F),c).call(B),_e=[],(c=l["$[]"]("repeatsigns")["$[]"]("voices")["$include?"](l["$[]"]("voice_nr")))===u||null==c||c.$$is_boolean&&1!=c||(_e=(c=(D=(z=(q=n).$select,z.$$p=(U=function(e){var t;U.$$s;return null==e&&(e=u),t=e["$is_a?"](te.get("Goto")),!1!==t&&t!==u&&null!=t?e.$policy()["$[]"]("is_repeat"):t},U.$$s=V,U.$$arity=1,U),z).call(q)).$map,c.$$p=(L=function(e){var t=L.$$s||this,r=u,n=u;return null==e&&(e=u),r=t.$make_repeatsign_annotation(e,"begin",s,l,X),n=t.$make_repeatsign_annotation(e,"end",s,l,X),[n,r]},L.$$s=V,L.$$arity=1,L),c).call(D).$flatten()),ge=(c=(z=(G=(Y=n).$select,G.$$p=(Q=function(e){Q.$$s;return null==e&&(e=u),e["$is_a?"](te.get("NoteBoundAnnotation"))},Q.$$s=V,Q.$$arity=1,Q),G).call(Y)).$map,c.$$p=(H=function(r){var n,a,i,o=H.$$s||this,c=u,$=u,f=u,d=u,h=u,_=u,g=u;return null==r&&(r=u),c=t(r.$conf_key(),".pos"),$=!1===(n=l["$[]"]("print_options_raw").$get(t(r.$conf_key(),".show")))||n===u||null==n||n,!1!==c&&c!==u&&null!=c?(f="extract."+s+"."+c,!1!==(d=function(){try{return l["$[]"]("print_options_raw").$get(c)}catch(t){if(e.rescue(t,[te.get("StandardError")]))return u;throw t}}())&&d!==u&&null!=d||(d=r.$position())):(d=r.$position(),f=u),h=!1!==(n=l["$[]"]("print_options_raw").$get(t(r.$conf_key(),".style")))&&n!==u&&null!=n?n:r.$style(),_=t(o.$Vector2d(r.$companion().$sheet_drawable().$center()),d),g=(n=(a=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(_.$to_a(),r.$text(),h,r.$companion().$origin(),f,d)).$tap,n.$$p=(i=function(e){var t,r;i.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},i.$$s=o,i.$$arity=1,i),n).call(a),(n=r.$policy()["$=="]("Goto")?l["$[]"]("jumpline")["$!"]():r.$policy()["$=="]("Goto"))===u||null==n||n.$$is_boolean&&1!=n||(g=u),$["$=="](!1)&&(g=u),g},H.$$s=V,H.$$arity=1,H),c).call(z),t(t(t(t(t(t(t(t(t(t(se,le),pe),$e),Z),re),ee),K),de),ge),_e).$compact()},C.$$arity=4),e.defn(Z,"$make_decorations_per_playable",S=function(a,o,s,l,c){var $,f,d,h,_,g=this,m=u,y=u,v=u,b=u,x=u;return m=u,m=a.$decorations(),(($=m["$empty?"]())===u||null==$||$.$$is_boolean&&1!=$)&&(y=function(){return($=a.$measure_start())===u||null==$||$.$$is_boolean&&1!=$?1:2}(),v=.8,b=($=(f=o.$size()).$map,$.$$p=(d=function(e){d.$$s;return null==e&&(e=u),i(e,v)},d.$$s=g,d.$$arity=1,d),$).call(f),x=[],($=(h=m).$each_with_index,$.$$p=(_=function(i,$){var f,d,h,g=_.$$s||this,m=u,w=u,A=u,k=u,E=u;return null==i&&(i=u),null==$&&($=u),m="notebound.decoration.v_"+c+".t_"+a.$znid()+"."+$+".pos",w="extract."+s+"."+m,A=function(){try{return l["$[]"]("print_options_raw")["$[]"](m)}catch(t){if(e.rescue(t,[te.get("StandardError")]))return u;throw t}}(),!1!==A&&A!==u&&null!=A||(A=[0,r(n(o.$size().$last()["$-@"](),v),y).$round()]),k=[t(o.$center().$first(),A.$first()),t(o.$center().$last(),A.$last())],E=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Glyph").$new(k,b,i,!1,u,w,A),(f=(d=E).$tap,f.$$p=(h=function(e){var t,r;h.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},h.$$s=g,h.$$arity=1,h),f).call(d),x.$push([E])},_.$$s=g,_.$$arity=2,_),$).call(h)),x},S.$$arity=5),e.defn(Z,"$make_repeatsign_annotation",I=function(r,n,a,i,o){var l,c,$,f=this,d=u,h=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u;return!1!==(l=r.$policy()["$[]"]("from_anchor"))&&l!==u&&null!=l?l:"after",!1!==(l=r.$policy()["$[]"]("to_anchor"))&&l!==u&&null!=l?l:"before",n["$=="]("begin")?(d=r.$to(),h=r.$to()["$=="](r.$from())?"left":function(){return(l=s(d.$pitch(),d.$next_pitch()))===u||null==l||l.$$is_boolean&&1!=l?"right":"left"}()):(d=r.$from(),h=r.$to()["$=="](r.$from())?"right":function(){return(l=s(d.$prev_pitch(),d.$pitch()))===u||null==l||l.$$is_boolean&&1!=l?"left":"right"}()),_="notebound.repeat_"+n.$to_s()+".v_"+o+"."+d.$znid(),g=_+".pos",m="extract."+a+"."+g,y=i["$[]"]("repeatsigns")["$[]"](h),v=function(){try{return i["$[]"]("print_options_raw")["$[]"](g)}catch(t){if(e.rescue(t,[te.get("StandardError")]))return u;throw t}}(),!1!==v&&v!==u&&null!=v||(v=y["$[]"]("pos")),b=!1!==(l=i["$[]"]("print_options_raw")["$[]"](_+".text"))&&l!==u&&null!=l?l:y["$[]"]("text"),x=!1!==(l=i["$[]"]("print_options_raw")["$[]"](_+".style"))&&l!==u&&null!=l?l:y["$[]"]("style"),w=t(f.$Vector2d(d.$sheet_drawable().$center()),v),(l=(c=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(w.$to_a(),b,x,d.$origin(),m,v)).$tap,l.$$p=($=function(e){var t,r;$.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},$.$$s=f,$.$$arity=1,$),l).call(c)},I.$$arity=5),Z.$private(),e.defn(Z,"$layout_barnumbers_countnotes",O=function(r,n,a,o){var s,l,c,$,f,d=this,_=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u,A=u,k=u,E=u,C=u,S=u,I=u,O=u,T=u,P=u,M=u,N=u,B=u,R=u,j=u;return null==h.conf&&(h.conf=u),_=h.conf["$[]"]("layout.limit_a3")["$=="](!0),g=h.conf["$[]"]("layout.bottomup")["$=="](!0),m=a["$[]"]("countnotes"),y=a["$[]"]("barnumbers"),v=[],b=[],(s=!1!==(l=m)&&l!==u&&null!=l?l:y)===u||null==s||s.$$is_boolean&&1!=s||(x=(s=(l=r).$select,s.$$p=(c=function(e){c.$$s;return null==e&&(e=u),e["$visible?"]()},c.$$s=d,c.$$arity=1,c),s).call(l),!1!==m&&m!==u&&null!=m&&(w=m["$[]"]("style"),$=[1,1],s=e.to_ary($),A=null==s[0]?u:s[0],k=null==s[1]?u:s[1],E=m["$[]"]("autopos"),C=m["$[]"]("pos"),$=m["$[]"]("apbase"),s=e.to_ary($),S=null==s[0]?u:s[0],I=null==s[1]?u:s[1]),!1!==y&&y!==u&&null!=y&&(O=y["$[]"]("style"),$=[2.7,2.7],s=e.to_ary($),T=null==s[0]?u:s[0],P=null==s[1]?u:s[1],M=y["$[]"]("autopos"),N=y["$[]"]("pos"),$=y["$[]"]("apbase"),s=e.to_ary($),B=null==s[0]?u:s[0],R=null==s[1]?u:s[1],j=y["$[]"]("prefix")),(s=($=x).$each,s.$$p=(f=function(r){var a,s,l,c,$,d=f.$$s||this,h=u,x=u,F=u,D=u,L=u,z=u,q=u,U=u,H=u,G=u,Y=u,Q=u,V=u,X=u,W=u,J=u,K=u,Z=u,ee=u,re=u,ne=u,ae=u,ie=u,oe=u;return null==d.print_options_keys&&(d.print_options_keys=u),null==d.print_options_raw&&(d.print_options_raw=u),null==r&&(r=u),h=r.$sheet_drawable(),x=h.$center(),s=x,a=e.to_ary(s),F=null==a[0]?u:a[0],null==a[1]?u:a[1],s=h.$size(),a=e.to_ary(s),D=null==a[0]?u:a[0],L=null==a[1]?u:a[1],s=h.$size_with_dot(),a=e.to_ary(s),z=null==a[0]?u:a[0],null==a[1]?u:a[1],s=r.$prev_playable().$sheet_drawable().$center(),a=e.to_ary(s),q=null==a[0]?u:a[0],null==a[1]?u:a[1],s=r.$next_playable().$sheet_drawable().$center(),a=e.to_ary(s),U=null==a[0]?u:a[0],null==a[1]?u:a[1],s=function(){return!1!==g&&g!==u&&null!=g?d.$compute_note_position(U,F,q,_).$reverse():d.$compute_note_position(q,F,U,_)}(),a=e.to_ary(s),H=null==a[0]?u:a[0],G=null==a[1]?u:a[1],!1!==m&&m!==u&&null!=m&&(Y="notebound.countnote.v_"+o+".t_"+r.$time()+".pos",Q="extract."+n+"."+Y,V=!1!==(a=r.$count_note())&&a!==u&&null!=a?a:"",(a=d.print_options_keys["$include?"](Y))===u||null==a||a.$$is_boolean&&1!=a||(X=d.print_options_raw["$[]"](Y)),!1!==X&&X!==u&&null!=X||(E["$=="](!0)?(W=function(){return(a=(s=G["$=="]("r"))?r["$tie_start?"]():G["$=="]("r"))===u||null==a||a.$$is_boolean&&1!=a?0:1.5}(),J=t(W,function(){return G["$=="]("l")?t(t(i(V.$length(),A),D),S)["$-@"]():t(z,S)}()),K=function(){return!1!==g&&g!==u&&null!=g?t(t(L,I),k)["$-@"]():t(L,I)}(),X=[J,K]):X=C),G=t(d.$Vector2d(x),X),v.$push((a=(s=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(G.$to_a(),V,w,r.$origin(),Q,X)).$tap,a.$$p=(l=function(e){var t,r;l.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},l.$$s=d,l.$$arity=1,l),a).call(s))),(a=(c=!1!==y&&y!==u&&null!=y)?r["$measure_start?"]():y)===u||null==a||a.$$is_boolean&&1!=a?u:(Z="notebound.barnumber.v_"+o+".t_"+r.$time()+".pos",ee="extract."+n+"."+Z,re=!1!==(a=""+j+r.$measure_count().$to_s())&&a!==u&&null!=a?a:"",(a=d.print_options_keys["$include?"](Z))===u||null==a||a.$$is_boolean&&1!=a||(ne=d.print_options_raw["$[]"](Z)),!1!==ne&&ne!==u&&null!=ne||(M["$=="](!0)?(ae=function(){return(a=(c=H["$=="]("r"))?r["$tie_start?"]():H["$=="]("r"))===u||null==a||a.$$is_boolean&&1!=a?0:1}(),ie=t(ae,function(){return H["$=="]("l")?t(t(i(re.$length(),T),D),B)["$-@"]():t(z,B)}()),oe=function(){return!1!==g&&g!==u&&null!=g?t(L,R):t(t(L,R),P)["$-@"]()}(),ne=[ie,oe]):ne=N),H=t(d.$Vector2d(x),ne),b.$push((a=(c=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation").$new(H.$to_a(),re,O,r.$origin(),ee,ne)).$tap,a.$$p=($=function(e){var t,r;$.$$s;return null==e&&(e=u),t=[p(["handler"],{handler:"annotation"})],r=e,r["$draginfo="].apply(r,t),t[t.length-1]},$.$$s=d,$.$$arity=1,$),a).call(c)))},f.$$s=d,f.$$arity=1,f),s).call($)),[b,v]},O.$$arity=4),e.defn(Z,"$compute_beat_compression",T=function(e,t){var r,n=this,a=u;return null==h.conf&&(h.conf=u),h.conf.$get("layout.packer.pack_method")["$=="](1)&&(a=n.$compute_beat_compression_1(e,t)),h.conf.$get("layout.packer.pack_method")["$=="](2)&&(a=n.$compute_beat_compression_2(e,t)),h.conf.$get("layout.packer.pack_method")["$=="](10)&&(a=n.$compute_beat_compression_10(e,t)),(!1!==(r=h.conf.$get("layout.packer.pack_method"))&&r!==u&&null!=r?r:0)["$=="](0)&&(a=n.$compute_beat_compression_0(e,t)),a},T.$$arity=2),e.defn(Z,"$compute_beat_compression_2",P=function(e,t){var r,n,a,o,s,l,c,$,f,d,h,_,g,m,y,v=this,b=u,x=u,w=u,A=u;return b=p([],{}),x=(r=(n=(o=(s=(c=($=t).$map,c.$$p=(f=function(t){f.$$s;return null==t&&(t=u),e.$voices()["$[]"](t)},f.$$s=v,f.$$arity=1,f),c).call($)).$inject,o.$$p=(l=function(e,t){l.$$s;return null==e&&(e=u),null==t&&(t=u),e.$push(t)},l.$$s=v,l.$$arity=2,l),o).call(s,[]).$flatten()).$select,r.$$p=(a=function(e){a.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable"))},a.$$s=v,a.$$arity=1,a),r).call(n),w=(r=(o=(c=(h=x).$select,c.$$p=(_=function(e){_.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Harpnotes").$$scope.get("Music").$$scope.get("SynchPoint"))},_.$$s=v,_.$$arity=1,_),c).call(h)).$map,r.$$p=(d=function(e){d.$$s;return null==e&&(e=u),e.$notes()},d.$$s=v,d.$$arity=1,d),r).call(o),x=x.$push(w).$flatten(),A=(r=(c=x).$group_by,r.$$p=(g=function(e){g.$$s;return null==e&&(e=u),e.$beat()},g.$$s=v,g.$$arity=1,g),r).call(c),(r=(m=A.$keys().$sort()).$each,r.$$p=(y=function(e){y.$$s;return null==e&&(e=u),b["$[]="](e,i(e,8))},y.$$s=v,y.$$arity=1,y),r).call(m),b},P.$$arity=2),e.defn(Z,"$compute_beat_compression_10",M=function(r,a){var i,o,s,l,c,$,f,p,d,_=this,g=u,m=u,y=u,v=u,b=u;return null==h.conf&&(h.conf=u),(i=(o=r.$beat_maps()).$map,i.$$p=(s=function(e){s.$$s;return null==e&&(e=u),e.$keys().$max()},s.$$s=_,s.$$arity=1,s),i).call(o).$max(),g=0,m=0,y=(i=(l=a).$inject,i.$$p=(c=function(e,t){c.$$s;return null==e&&(e=u),null==t&&(t=u),e.$push(r.$beat_maps()["$[]"](t))},c.$$s=_,c.$$arity=2,c),i).call(l,[]).$compact(),v=(i=($=r.$beat_maps()).$inject,i.$$p=(f=function(e,t){f.$$s;return null==e&&(e=u),null==t&&(t=u),e.$push(t.$keys()),e},f.$$s=_,f.$$arity=2,f),i).call($,[]).$flatten().$uniq().$sort(),b=h.conf.$get("layout.DURATION_TO_STYLE"),te.get("Hash")["$[]"]((i=(p=v).$map,i.$$p=(d=function(r){var a,i,o,s,l,c,$,f,p,_=d.$$s||this,v=u,x=u,w=u,A=u,k=u,E=u,C=u;if(null==_.conf_beat_resolution&&(_.conf_beat_resolution=u),null==h.log&&(h.log=u),null==r&&(r=u),v=(a=(i=y).$map,a.$$p=(o=function(e){o.$$s;return null==e&&(e=u),e["$[]"](r)},o.$$s=_,o.$$arity=1,o),a).call(i).$flatten().$compact(),x=(a=(s=v).$map,a.$$p=(l=function(e){l.$$s;return null==e&&(e=u),e.$duration()},l.$$s=_,l.$$arity=1,l),a).call(s).$max(),w=v["$empty?"](),A=(a=(c=v).$select,a.$$p=($=function(e){$.$$s;return null==e&&(e=u),e["$first_in_part?"]()},$.$$s=_,$.$$arity=1,$),a).call(c),k=(a=(f=v).$select,a.$$p=(p=function(e){p.$$s;return null==e&&(e=u),e["$measure_start?"]()},p.$$s=_,p.$$arity=1,p),a).call(f).$first(),!1!==w&&w!==u&&null!=w);else{try{E=_.conf_beat_resolution*b["$[]"](_.$duration_to_id(x)).$first()}catch(t){if(!e.rescue(t,[te.get("Exception")]))throw t;t;try{h.log.$error("BUG: unsupported duration: "+x+" on beat "+r+",  "+v.$to_json())}finally{e.pop_exception()}}C=n(t(E,m),2),m=E,!1!==k&&k!==u&&null!=k&&(C=t(C,n(C,4))),((a=A["$empty?"]())===u||null==a||a.$$is_boolean&&1!=a)&&(C=t(C,C)),C=t(C,_.$get_minc_factor(v.$first().$time(),C)),g=t(g,C)}return[r,g]},d.$$s=_,d.$$arity=1,d),i).call(p))},M.$$arity=2),e.defn(Z,"$get_minc_factor",N=function(e,t){var r=this,n=u;return null==t&&(t=r.conf_beat_resolution),n=r.layout_minc["$[]"](e.$to_s()),!1!==n&&n!==u&&null!=n?i(n["$[]"]("minc_f"),t):0},N.$$arity=-2),e.defn(Z,"$compute_beat_compression_0",B=function(r,a){var o,s,l,c,$,f,d,_,g,m,y,v,b,x,w,A=this,k=u,E=u,C=u,S=u,I=u,O=u,T=u;return null==h.conf&&(h.conf=u),k=h.conf.$get("layout.DURATION_TO_STYLE"),i(!1!==(o=h.conf.$get("layout.packer.pack_min_increment"))&&o!==u&&null!=o?o:0,A.conf_beat_resolution),E=0,C=p([],{}),S=0,I=(o=(s=(c=($=(d=(_=a).$map,d.$$p=(g=function(e){g.$$s;return null==e&&(e=u),r.$voices()["$[]"](e)},g.$$s=A,g.$$arity=1,g),d).call(_)).$inject,c.$$p=(f=function(e,t){f.$$s;return null==e&&(e=u),null==t&&(t=u),e.$push(t)},f.$$s=A,f.$$arity=2,f),c).call($,[]).$flatten()).$select,o.$$p=(l=function(e){l.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable"))},l.$$s=A,l.$$arity=1,l),o).call(s),O=(o=(c=(d=(y=I).$select,d.$$p=(v=function(e){v.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Harpnotes").$$scope.get("Music").$$scope.get("SynchPoint"))},v.$$s=A,v.$$arity=1,v),d).call(y)).$map,o.$$p=(m=function(e){m.$$s;return null==e&&(e=u),e.$notes()},m.$$s=A,m.$$arity=1,m),o).call(c),I=I.$push(O).$flatten(),T=(o=(d=I).$group_by,o.$$p=(b=function(e){b.$$s;return null==e&&(e=u),e.$beat()},b.$$s=A,b.$$arity=1,b),o).call(d),(o=(x=T.$keys().$sort()).$each,o.$$p=(w=function(r){var a,i,o,s,l,c,$,f=w.$$s||this,p=u,d=u,_=u,g=u,m=u,y=u,v=u;null==f.conf_beat_resolution&&(f.conf_beat_resolution=u),null==h.log&&(h.log=u),null==r&&(r=u),p=T["$[]"](r),d=(a=(i=p).$map,a.$$p=(o=function(e){o.$$s;return null==e&&(e=u),e.$duration()},o.$$s=f,o.$$arity=1,o),a).call(i).$max(),_=(a=(s=p).$select,a.$$p=(l=function(e){l.$$s;return null==e&&(e=u),e["$first_in_part?"]()},l.$$s=f,l.$$arity=1,l),a).call(s),g=(a=(c=p).$select,a.$$p=($=function(e){$.$$s;return null==e&&(e=u),e["$measure_start?"]()},$.$$s=f,$.$$arity=1,$),a).call(c);try{m=f.conf_beat_resolution*k["$[]"](f.$duration_to_id(d)).$first()}catch(t){if(!e.rescue(t,[te.get("Exception")]))throw t;t;try{h.log.$error("BUG: unsupported duration: "+d+" on beat "+r+",  "+f.$notes_on_beat().$to_json())}finally{e.pop_exception()}}return y=n(t(m,S),2),S=m,v=y,((a=_["$empty?"]())===u||null==a||a.$$is_boolean&&1!=a)&&(v=t(v,y)),((a=g["$empty?"]())===u||null==a||a.$$is_boolean&&1!=a)&&(v=t(v,n(v,4))),v=t(v,f.$get_minc_factor(p.$first().$time(),y)),E=t(E,v),C["$[]="](r,E)},w.$$s=A,w.$$arity=1,w),o).call(x),C},B.$$arity=2),e.defn(Z,"$compute_beat_compression_1",R=function(a,o){var s,c,$,f,d,_,g,m,y,v,b,x,w,A,k,E=this,C=u,S=u,I=u,O=u,T=u,P=u,M=u,N=u,B=u,R=u;return null==h.conf&&(h.conf=u),C=h.conf.$get("layout.DURATION_TO_STYLE"),S=i(!1!==(s=h.conf.$get("layout.packer.pack_min_increment"))&&s!==u&&null!=s?s:0,E.conf_beat_resolution),I=p([],{}),O=p([],{}),T=0,P=0,M=0,N=(s=(c=(f=(d=(g=(m=o).$map,g.$$p=(y=function(e){y.$$s;return null==e&&(e=u),a.$voices()["$[]"](e)},y.$$s=E,y.$$arity=1,y),g).call(m)).$inject,f.$$p=(_=function(e,t){_.$$s;return null==e&&(e=u),null==t&&(t=u),e.$push(t)},_.$$s=E,_.$$arity=2,_),f).call(d,[]).$flatten()).$select,s.$$p=($=function(e){$.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable"))},$.$$s=E,$.$$arity=1,$),s).call(c),B=(s=(f=(g=(b=N).$select,g.$$p=(x=function(e){x.$$s;return null==e&&(e=u),e["$is_a?"](te.get("Harpnotes").$$scope.get("Music").$$scope.get("SynchPoint"))},x.$$s=E,x.$$arity=1,x),g).call(b)).$map,s.$$p=(v=function(e){v.$$s;return null==e&&(e=u),e.$notes()},v.$$s=E,v.$$arity=1,v),s).call(f),N=N.$push(B).$flatten(),R=(s=(g=N).$group_by,s.$$p=(w=function(e){w.$$s;return null==e&&(e=u),e.$beat()},w.$$s=E,w.$$arity=1,w),s).call(g),(s=(A=R.$keys().$sort()).$each,s.$$p=(k=function(a){var i,o,s,c,$,f,p,d,_,g,m,y,v,b=k.$$s||this,x=u,w=u,A=u,E=u,N=u,B=u,j=u,F=u,D=u;null==b.conf_beat_resolution&&(b.conf_beat_resolution=u),null==h.log&&(h.log=u),null==a&&(a=u),x=R["$[]"](a),w=(i=(o=x).$map,i.$$p=(s=function(e){s.$$s;return null==e&&(e=u),e.$duration()},s.$$s=b,s.$$arity=1,s),i).call(o).$max();try{A=b.conf_beat_resolution*C["$[]"](b.$duration_to_id(w)).$first()}catch(t){if(!e.rescue(t,[te.get("Exception")]))throw t;t;try{h.log.$error("BUG: unsupported duration: "+w+" on beat "+a+",  "+b.$notes_on_beat().$to_json())}finally{e.pop_exception()}}return E=n(t(A,M),2),M=A,N=(i=(c=x).$select,i.$$p=($=function(e){var t;$.$$s;return null==e&&(e=u),l(!1!==(t=I["$[]"](e.$pitch()))&&t!==u&&null!=t?t:-1,r(T,S))},$.$$s=b,$.$$arity=1,$),i).call(c),B=(i=(f=x).$select,i.$$p=(p=function(e){var t,r=(p.$$s,u),n=u;return null==e&&(e=u),r=[!1!==(t=e.$prev_pitch())&&t!==u&&null!=t?t:e.$pitch(),e.$pitch(),!1!==(t=e.$next_pitch())&&t!==u&&null!=t?t:e.$pitch()],n=(!1!==(t=r.$sort().$reverse()["$=="](r))&&t!==u&&null!=t?t:r.$sort()["$=="](r))["$!"](),(t=e.$next_first_in_part())===u||null==t||t.$$is_boolean&&1!=t||(n=!1),n},p.$$s=b,p.$$arity=1,p),i).call(f),j=(i=(d=x).$select,i.$$p=(_=function(e){_.$$s;return null==e&&(e=u),e["$first_in_part?"]()},_.$$s=b,_.$$arity=1,_),i).call(d),F=(i=(g=x).$select,i.$$p=(m=function(e){m.$$s;return null==e&&(e=u),e["$measure_start?"]()},m.$$s=b,m.$$arity=1,m),i).call(g),D=P,P=S,(i=N["$empty?"]()["$!"]())===u||null==i||i.$$is_boolean&&1!=i?(i=B["$empty?"]()["$!"]())===u||null==i||i.$$is_boolean&&1!=i||(P=n(E,2),D=P):D=E,((i=j["$empty?"]())===u||null==i||i.$$is_boolean&&1!=i)&&(D=t(D,E),P=S),((i=F["$empty?"]())===u||null==i||i.$$is_boolean&&1!=i)&&(D=t(D,n(D,4))),D=t(D,b.$get_minc_factor(x.$first().$time(),E)),T=t(T,D),(i=(y=x).$each,i.$$p=(v=function(e){v.$$s;return null==e&&(e=u),I["$[]="](e.$pitch(),T)},v.$$s=b,v.$$arity=1,v),i).call(y),O["$[]="](a,T)},k.$$s=E,k.$$arity=1,k),s).call(A),O},R.$$arity=2),e.defn(Z,"$layout_playable",j=function(e,t,r){var n,a=this;return null==h.log&&(h.log=u),function(){return(n=e["$is_a?"](te.get("Note")))===u||null==n||n.$$is_boolean&&1!=n?(n=e["$is_a?"](te.get("SynchPoint")))===u||null==n||n.$$is_boolean&&1!=n?(n=e["$is_a?"](te.get("Pause")))===u||null==n||n.$$is_boolean&&1!=n?h.log.$error("BUG: Missing Music -> Sheet transform: "+e):a.$layout_pause(e,t,r+".n_0"):a.$layout_accord(e,t,r):a.$layout_note(e,t,r+".n_0")}()},j.$$arity=3),e.defn(Z,"$layout_note",F=function(a,i,o){var s,l,c=this,$=u,f=u,p=u,d=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u;return null==h.conf&&(h.conf=u),$=c.$convert_pitch_to_xpos(a),f=i.$call(a.$beat()),l=c.$compute_ellipse_properties_from_note(a),s=e.to_ary(l),p=null==s[0]?u:s[0],d=null==s[1]?u:s[1],_=null==s[2]?u:s[2],g=null==s[3]?u:s[3],m=c.$layout_note_shift(a,_,$,p,o),y=c.$compute_color_by_variant_no(a.$variant()),v=te.get("Ellipse").$new([t($,m),f],_,d,p,a),s=[t(o,".nconf")],l=v,l["$conf_key="].apply(l,s),s[s.length-1],s=[v],l=a,l["$sheet_drawable="].apply(l,s),s[s.length-1],s=[y],l=v,l["$color="].apply(l,s),s[s.length-1],s=[h.conf.$get("layout.LINE_THICK")],l=v,l["$line_width="].apply(l,s),s[s.length-1],b=te.get("CompoundDrawable").$new([v],v),!1!==g&&g!==u&&null!=g&&b.$push(c.$layout_note_flags($,f,_,m,y,g)),(s=a.$measure_start())===u||null==s||s.$$is_boolean&&1!=s||(x=t(_.$last(),h.conf.$get("layout.LINE_THICK")),(s=h.conf.$get("layout.bottomup"))===u||null==s||s.$$is_boolean&&1!=s||(x=x["$-@"]()),w=function(){return(s=(l=!1!==g&&g!==u&&null!=g)?h.conf.$get("layout.bottomup")["$!"]():g)===u||null==s||s.$$is_boolean&&1!=s?0:h.conf.$get("layout.LINE_THICK")}(),v=te.get("Ellipse").$new([r(t($,m),w),r(f,x)],[r(_.$first(),w),n(h.conf.$get("layout.LINE_THICK"),2)],"filled",!1,u,!0),s=[y],l=v,l["$color="].apply(l,s),s[s.length-1],s=[h.conf.$get("layout.LINE_THIN")],l=v,l["$line_width="].apply(l,s),s[s.length-1],b.$push(v)),b},F.$$arity=3),e.defn(Z,"$layout_note_flags",D=function(a,o,s,l,c,$){var f,p,d,_,g=this,m=u,y=u,v=u,b=u,x=u,w=u,A=u,k=u,E=u,C=u,S=u;return null==h.conf&&(h.conf=u),p=[.1,i(2,s["$[]"](1))],f=e.to_ary(p),m=null==f[0]?u:f[0],y=null==f[1]?u:f[1],p=[i(1.3,s["$[]"](1)),i(.6,s["$[]"](1))],f=e.to_ary(p),v=null==f[0]?u:f[0],b=null==f[1]?u:f[1],x=h.conf.$get("layout.LINE_MEDIUM"),w=r(t(t(a,l),s["$[]"](0)),n(x,2)),A=i(h.conf.$get("layout.LINE_MEDIUM"),3),A=b,k=function(){try{return n(i(m,A),y)}catch(t){if(e.rescue(t,[te.get("StandardError")]))return 0;throw t}}(),E=["l",v,b],C=[["M",w,o],["l",m,y["$-@"]()]],(f=(p=$).$times,f.$$p=(d=function(e){d.$$s;return null==e&&(e=u),C=t(C,[["M",r(t(w,m),i(e,k)),t(r(o,y),i(e,A))],E])},d.$$s=g,d.$$arity=1,d),f).call(p),S=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path").$new(C,"open"),f=[x],_=S,_["$line_width="].apply(_,f),f[f.length-1],f=[c],_=S,_["$color="].apply(_,f),f[f.length-1],S},D.$$arity=6),e.defn(Z,"$convert_pitch_to_xpos",L=function(e){return this.pitch_to_xpos.$call(e.$pitch())},L.$$arity=1),e.defn(Z,"$compute_color_by_variant_no",z=function(e){var t,r=this;return e["$=="](0)?r.color_default:function(){return(t=e["$odd?"]())===u||null==t||t.$$is_boolean&&1!=t?r.color_variant2:r.color_variant1}()},z.$$arity=1),e.defn(Z,"$compute_ellipse_properties_from_note",q=function(t){var r,n,a,o=this,s=u,l=u,c=u,$=u,f=u;return null==h.conf&&(h.conf=u),n=h.conf.$get("layout.DURATION_TO_STYLE")["$[]"](o.$check_duration(t)),r=e.to_ary(n),s=null==r[0]?u:r[0],l=null==r[1]?u:r[1],c=null==r[2]?u:r[2],$=null==r[3]?u:r[3],f=(r=(n=h.conf.$get("layout.ELLIPSE_SIZE")).$map,r.$$p=(a=function(e){a.$$s;return null==e&&(e=u),i(e,s)},a.$$s=o,a.$$arity=1,a),r).call(n),[c,l,f,$]},q.$$arity=1),e.defn(Z,"$layout_note_shift",U=function(e,n,s,l,c){var $,f=this,p=u,d=u,_=u;return null==h.conf&&(h.conf=u),p=0,($=h.conf.$get("layout.limit_a3"))===u||null==$||$.$$is_boolean&&1!=$||(($=o(s,5))===u||null==$||$.$$is_boolean&&1!=$||(p=t(p,n.$first())),($=a(s,415))===u||null==$||$.$$is_boolean&&1!=$||(p=t(p,n.$first()["$-@"]()),!1!==l&&l!==u&&null!=l&&(p=r(p,1.5)))),($=e.$shift())===u||null==$||$.$$is_boolean&&1!=$||(p=e.$shift()["$[]"]("dir")["$=="](-1)?t(p,n.$first()["$-@"]()):t(p,n.$first())),!1!==c&&c!==u&&null!=c&&(d=c.$gsub(/extract\.(\d+)\./,""),($=f.print_options_keys["$include?"](d+".nshift"))===u||null==$||$.$$is_boolean&&1!=$||(_=f.print_options_raw["$[]"](d+".nshift"),p=i(i(n.$first(),2),_))),p},U.$$arity=5),e.defn(Z,"$layout_accord",H=function(e,t,r){var n,a,i,o,s,l,c,$,f,p=this,d=u,h=u,_=u;return d=(n=(a=e.$notes().$reverse().$each_with_index()).$map,n.$$p=(i=function(e,n){var a=i.$$s||this;return null==e&&(e=u),null==n&&(n=u),a.$layout_note(e,t,r+".n_"+n)},i.$$s=p,i.$$arity=2,i),n).call(a).$reverse(),h=e.$get_proxy_object(d).$proxy(),_=(n=(o=(l=(c=d).$map,l.$$p=($=function(e){$.$$s;return null==e&&(e=u),e.$proxy()},$.$$s=p,$.$$arity=1,$),l).call(c)).$sort_by,n.$$p=(s=function(e){s.$$s;return null==e&&(e=u),e.$center().$first()},s.$$s=p,s.$$arity=1,s),n).call(o),d=(n=(l=d).$map,n.$$p=(f=function(e){f.$$s;return null==e&&(e=u),e.$shapes()},f.$$s=p,f.$$arity=1,f),n).call(l),d.$unshift(te.get("FlowLine").$new(_.$first(),_.$last(),"dashed")),te.get("CompoundDrawable").$new(d,h)},H.$$arity=3),e.defn(Z,"$layout_pause",G=function(a,o,s){var l,c,$=this,f=u,p=u,d=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u,A=u;return null==h.conf&&(h.conf=u),f=$.$convert_pitch_to_xpos(a),p=o.$call(a.$beat()),c=h.conf.$get("layout.REST_TO_GLYPH")["$[]"]($.$check_duration(a)),l=e.to_ary(c),d=null==l[0]?u:l[0],_=null==l[1]?u:l[1],g=null==l[2]?u:l[2],m=h.conf.$get("layout.REST_SIZE"),y=[i(m.$first(),d.$first()),i(m.$last(),d.$last())],v=$.$layout_note_shift(a,y,f,g,s),b=$.$compute_color_by_variant_no(a.$variant()),x=u,x=te.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Glyph").$new([t(f,v),p],y,_,g,a),l=[t(s,".nconf")],c=x,c["$conf_key="].apply(c,l),l[l.length-1],l=[x],c=a,c["$sheet_drawable="].apply(c,l),l[l.length-1],l=[b],c=x,c["$color="].apply(c,l),l[l.length-1],l=[h.conf.$get("layout.LINE_THICK")],c=x,c["$line_width="].apply(c,l),l[l.length-1],((l=a["$visible?"]())===u||null==l||l.$$is_boolean&&1!=l)&&(l=[!1],c=x,c["$visible="].apply(c,l),l[l.length-1]),w=te.get("CompoundDrawable").$new([x],x),(l=a.$measure_start())===u||null==l||l.$$is_boolean&&1!=l||(A=t(y.$last(),h.conf.$get("layout.LINE_THICK")),(l=h.conf.$get("layout.bottomup"))===u||null==l||l.$$is_boolean&&1!=l||(A=A["$-@"]()),x=te.get("Ellipse").$new([t(f,v),r(p,A)],[y.$first(),n(h.conf.$get("layout.LINE_THICK"),2)],"filled",!1,u,!0),l=[b],c=x,c["$color="].apply(c,l),l[l.length-1],l=[h.conf.$get("layout.LINE_THIN")],c=x,c["$line_width="].apply(c,l),l[l.length-1],((l=a["$visible?"]())===u||null==l||l.$$is_boolean&&1!=l)&&(l=[!1],c=x,c["$visible="].apply(c,l),l[l.length-1]),w.$push(x)),w},G.$$arity=3),e.defs(Z,"$make_path_from_jumpline",Y=function(n){var a,o,s=this,l=u,c=u,$=u,f=u,p=u,d=u,h=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u,A=u,k=u,E=u,C=u,S=u,I=u,O=u,T=u,P=u,M=u,N=u,B=u,R=u,j=u;return o=n["$[]"]("jumpline_anchor"),a=e.to_ary(o),l=null==a[0]?u:a[0],c=null==a[1]?u:a[1],$=s.$Vector2d(n["$[]"]("from")["$[]"]("center")),f=t(s.$Vector2d(n["$[]"]("from")["$[]"]("size")),[l,c]),p=function(){return n["$[]"]("from")["$[]"]("anchor")["$=="]("before")?-1:1}(),d=s.$Vector2d(n["$[]"]("to")["$[]"]("center")),h=t(s.$Vector2d(n["$[]"]("to")["$[]"]("size")),[l,c]),_=function(){return n["$[]"]("to")["$[]"]("anchor")["$=="]("before")?-1:1}(),g=n["$[]"]("vertical"),m=$,n["$[]"]("vertical_anchor")["$=="]("to")&&(m=d),y=s.$Vector2d(t(m.$x(),g),$.$y()),v=s.$Vector2d(t(m.$x(),g),d.$y()),b=s.$Vector2d(i(r(y,$),[1,0]).$normalize().$x(),0),x=s.$Vector2d(i(r(v,d),[1,0]).$normalize().$x(),0),w=i(f,[b.$x(),p]),A=i(h,[x.$x(),_]),y=t(y,i(w,[0,1])),v=t(v,i(A,[0,1])),k=t($,w),E=y,C=v,S=t(d,A),I=t(t(d,A),i(x,[2,0])),O=t(t(S,i(x,2.5)),[0,1]),T=r(t(S,i(x,2.5)),[0,1]),S,P=r(E,k),M=r(C,E),N=r(I,C),B=r(O,S),R=r(T,O),j=r(S,T),[[["M",k.$x(),k.$y()],["l",P.$x(),P.$y()],["l",M.$x(),M.$y()],["l",N.$x(),N.$y()]],[["M",S.$x(),S.$y()],["l",B.$x(),B.$y()],["l",R.$x(),R.$y()],["l",j.$x(),j.$y()],["z"]]]},Y.$$arity=1),e.defn(Z,"$duration_to_id",Q=function(e){var t,r=u;return null==h.conf&&(h.conf=u),r=("d"+e).$to_sym(),(t=h.conf.$get("layout.DURATION_TO_STYLE")["$[]"](r)["$nil?"]())===u||null==t||t.$$is_boolean&&1!=t||(r="err"),r},Q.$$arity=1),e.defn(Z,"$check_duration",V=function(e){var t,r=this,n=u;return null==h.log&&(h.log=u),n=r.$duration_to_id(e.$duration()),(t=n["$==="]("err"))===u||null==t||t.$$is_boolean&&1!=t||h.log.$error("unsupported duration at "+e.$start_pos_to_s(),e.$start_pos(),e.$end_pos()),n},V.$$arity=1),e.defn(Z,"$make_sheetmark_path",X=function(e){var t,a,o,s=this,l=u,c=u,$=u,f=u,p=u;return l=.5,c=5,$=r(s.$Vector2d(e),[l,n(c,2)]),f=[s.$Vector2d(l,i(2,l)["$-@"]()),s.$Vector2d(l,i(2,l)),s.$Vector2d(0,c),s.$Vector2d(l["$-@"](),i(2,l)),s.$Vector2d(l["$-@"](),i(-2,l)),s.$Vector2d(0,c["$-@"]())],p=[["M",$.$x(),$.$y()]],(t=(a=f).$each,t.$$p=(o=function(e){o.$$s;return null==e&&(e=u),p["$<<"](["l",e.$x(),e.$y()])},o.$$s=s,o.$$arity=1,o),t).call(a),p},X.$$arity=1),e.defn(Z,"$make_slur_path",W=function(e,n){var a=this,o=u,s=u,l=u,c=u;return o=r(n,e),s=a.$Vector2d(i(.3,o.$length()),0).$rotate(o.$angle()),l=s.$rotate(-.4),c=t(o,s.$reverse().$rotate(.4)),[["M",e.$x(),e.$y()],["c",l.$x(),l.$y(),c.$x(),c.$y(),o.$x(),o.$y()]]},W.$$arity=2),e.defn(Z,"$make_annotated_bezier_path",J=function(e,a){var o,l,c=this,$=u,f=u,p=u,d=u,_=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u,A=u,k=u,E=u,C=u,S=u,I=u,O=u,T=u,P=u;return null==h.log&&(h.log=u),$=e.$first(),f=e.$last(),p=r(f,$),d=c.$Vector2d(a["$[]"]("cp1")),_=c.$Vector2d(a["$[]"]("cp2")),g=i(te.get("Math").$$scope.get("PI"),-.5),m=d.$rotate(p.$angle()).$rotate(g),y=_.$rotate(p.$angle()).$rotate(g),y=t(p,y),h.log.$debug(m.$to_s()+" - "+y.$to_s()),v=t($,m),b=t($,y),x=n(t($,v),2),w=n(t(f,b),2),A=n(t(v,b),2),k=n(t(x,A),2),E=n(t(w,A),2),C=k["$=="](E)?c.$Vector2d([0,0]):r(k,E).$perpendicular().$normalize(),l=s(v.$x(),$.$x()),S=(o=!1!==l&&l!==u&&null!=l?s($.$x(),f.$x()):l)===u||null==o||o.$$is_boolean&&1!=o?t(n(t(k,E),2),i(C,2)):r(t(n(t(k,E),2),i(C,-2)),[2,0]),S=t(S,[0,-2]),I=[["M",$.$x(),$.$y()]],O=[["c",m.$x(),m.$y(),y.$x(),y.$y(),p.$x(),p.$y()]],T=[["l",m.$x(),m.$y()],["L",b.$x(),b.$y()],["L",f.$x(),f.$y()]],P=[],(o=a["$[]"]("shape")["$include?"]("c"))===u||null==o||o.$$is_boolean&&1!=o||(P=t(P,t(I,O))),(o=a["$[]"]("shape")["$include?"]("l"))===u||null==o||o.$$is_boolean&&1!=o||(P=t(P,t(I,T))),[P,S,v,b]},J.$$arity=2),e.defn(Z,"$resolve_placeholder",K=function(e,t){var r,n,a,i=this,o=u,s=u;return o=e,s=o.$scan(/\{\{([^\}]+)\}\}/),(r=(n=s).$each,r.$$p=(a=function(r){var n=a.$$s||this,i=u;return null==n.placeholders&&(n.placeholders=u),null==h.log&&(h.log=u),null==r&&(r=u),i=n.placeholders["$[]"](r.$first()),!1!==i&&i!==u&&null!=i?(e=i.$call(),!1!==e&&e!==u&&null!=e||(h.log.$error(te.get("I18n").$t("no placeholder value found in  ")+" in '"+t+"': '"+r.$first()+"'"),e=""),o=o.$gsub("{{"+r+"}}",e)):h.log.$error(te.get("I18n").$t("wrong placeholder: ")+" in '"+t+"': '"+r.$first()+"'")},a.$$s=i,a.$$arity=1,a),r).call(n),o},K.$$arity=2)}(y.base)}(y.base)}(c.base)},Opal.modules.abc_to_harpnotes_factory=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var r=(e.top,e),n=e.nil,a=(e.breaker,e.slice,e.module),i=e.klass,o=e.gvars,s=e.hash2;return e.add_stubs(["$===","$new","$error","$split","$[]","$count","$length","$last","$each","$match","$parse","$[]=","$first","$<<","$message","$+","$inject","$include?","$t","$strip","$==","$each_with_index","$get_metadata","$map","$select","$nil?","$join","$compact","$flatten"]),function(r){var l,c=l=a(r,"Harpnotes"),u=(c.$$proto,c.$$scope);!function(r){var l,c=l=a(r,"Input"),u=(c.$$proto,c.$$scope);!function(t,r){function a(){}var s,l=a=i(t,null,"ABCToHarpnotesFactory",a),c=(l.$$proto,l.$$scope);e.defs(l,"$create_engine",s=function(e){var t=n,r=n;return null==o.log&&(o.log=n),t=e,"ABC2SVG"["$==="](t)?r=c.get("Harpnotes").$$scope.get("Input").$$scope.get("Abc2svgToHarpnotes").$new():(o.log.$error("Undefined abc parser: "+e),r=c.get("Harpnotes").$$scope.get("Input").$$scope.get("Abc2svgToHarpnotes").$new()),r},s.$$arity=1)}(u.base),function(r,a){function l(){}var c,u,$,f,p,d=l=i(r,null,"AbstractAbcToHarpnotes",l),h=d.$$proto,_=d.$$scope;h.abc_code=n,e.defn(d,"$initialize",c=function(){var e=this;return e.abc_code=n,e.previous_new_part=[]},c.$$arity=0),e.defn(d,"$charpos_to_line_column",u=function(e){var t,r=this,a=n,i=n,o=n,s=n
;return a=!1!==(t=e)&&t!==n&&null!=t?t:1,i=r.abc_code["$[]"](1,a).$split("\n"),o=i.$count(),s=i.$last().$length(),[o,s]},u.$$arity=1),e.defn(d,"$parse_harpnote_config",$=function(r){var a,i,l,c=this,u=n,$=n;return u=s([],{}),$=1,(a=(i=r.$split("\n")).$each,a.$$p=(l=function(r){var a,i,s,c,f,p=l.$$s||this,d=n,h=n,g=n,m=n;if(null==o.log&&(o.log=n),null==r&&(r=n),!1!==(d=(a=(i=r).$match,a.$$p=(s=function(e){s.$$s;return null==e&&(e=n),[e["$[]"](1),e["$[]"](2)]},s.$$s=p,s.$$arity=1,s),a).call(i,/^%%%%hn\.(print|legend|note|annotation|lyrics) (.*)/))&&d!==n&&null!=d)try{h=_.get("JSON").$parse(d.$last()),h["$[]="]("line_no",$),a=d.$first(),c=u,!1!==(f=c["$[]"](a))&&f!==n&&null!=f||c["$[]="](a,[]),u["$[]"](d.$first())["$<<"](h)}catch(t){if(!e.rescue(t,[_.get("Exception")]))throw t;g=t;try{m="error in harpnote commands: "+g.$message()+" ["+$+":"+d+"]",o.log.$error(m,[$,1],[$,2])}finally{e.pop_exception()}}return $=t($,1)},l.$$s=c,l.$$arity=1,l),a).call(i),(a=u["$[]"]("legend"))===n||null==a||a.$$is_boolean&&1!=a||u["$[]="]("legend",u["$[]"]("legend").$first()),(a=u["$[]"]("lyrics"))===n||null==a||a.$$is_boolean&&1!=a||u["$[]="]("lyrics",u["$[]"]("lyrics").$first()),u},$.$$arity=1),e.defn(d,"$get_metadata",f=function(r){var a,i,l,c=this;return(a=(i=r.$split("\n").$each_with_index()).$inject,a.$$p=(l=function(r,a){var i,s,c,u,$,f,p=l.$$s||this,d=n,h=n,g=n;return null==o.log&&(o.log=n),null==a&&(a=n),a=e.to_ary(a),i=e.slice.call(a,0,a.length),s=i.splice(0,1)[0],null==s&&(s=n),c=i.splice(0,1)[0],null==c&&(c=n),null==r&&(r=n),d=(u=($=s).$match,u.$$p=(f=function(e){f.$$s;return null==e&&(e=n),[e["$[]"](1),e["$[]"](2)]},f.$$s=p,f.$$arity=1,f),u).call($,/^([A-Z]):\s*(.*)/),!1!==d&&d!==n&&null!=d&&(h=d.$first(),(u=r["$[]"](h))===n||null==u||u.$$is_boolean&&1!=u?(h["$=="]("F")&&(g=d.$last().$strip(),((u=g["$include?"]("{{"))===n||null==u||u.$$is_boolean&&1!=u)&&((u=g.$match(/^[a-zA-z0-9_\-\.]+$/))===n||null==u||u.$$is_boolean&&1!=u)&&o.log.$error('"'+g+'": '+_.get("I18n").$t("bad characters in filename"),[t(c,1),1])),r["$[]="](h,[d.$last().$strip()])):((u=["F","X"]["$include?"](h))===n||null==u||u.$$is_boolean&&1!=u||o.log.$error(_.get("I18n").$t("more than one line found for ")+" ':"+h+"'",[t(c,1),1]),r["$[]"](h)["$<<"](d.$last().$strip()))),r},l.$$s=c,l.$$arity=2,l.$$has_top_level_mlhs_arg=!0,l),a).call(i,s([],{}))},f.$$arity=1),e.defn(d,"$add_metadata",p=function(e,t){var r,a,i,o,s,l,c=this,u=n,$=n;return u=c.$get_metadata(e),$=(r=(a=(o=(s=t).$select,o.$$p=(l=function(e,t){l.$$s;return null==e&&(e=n),null==t&&(t=n),u["$[]"](e)["$nil?"]()},l.$$s=c,l.$$arity=2,l),o).call(s)).$map,r.$$p=(i=function(e,t){i.$$s;return null==e&&(e=n),null==t&&(t=n),e+":"+t},i.$$s=c,i.$$arity=2,i),r).call(a),[$,e].$flatten().$compact().$join("\n")},p.$$arity=2)}(u.base)}(u.base)}(r.base)},Opal.modules.native=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e>=t:e["$>="](t)}var n=e.top,a=e,i=e.nil,o=(e.breaker,e.slice,e.module),s=e.range,l=e.hash2,c=e.klass,u=e.gvars;return e.add_stubs(["$try_convert","$native?","$respond_to?","$to_n","$raise","$inspect","$Native","$proc","$map!","$end_with?","$define_method","$[]","$convert","$call","$to_proc","$new","$each","$native_reader","$native_writer","$extend","$is_a?","$map","$alias_method","$to_a","$_Array","$include","$method_missing","$bind","$instance_method","$[]=","$slice","$-","$length","$enum_for","$===","$>=","$<<","$each_pair","$_initialize","$name","$exiting_mid","$native_module"]),function(t){var r,n,a,c,u,$,f,p,d,h=r=o(t,"Native"),_=(h.$$proto,h.$$scope);e.defs(h,"$is_a?",n=function(e,t){var r=this;try{return e instanceof r.$try_convert(t)}catch(e){return!1}},n.$$arity=2),e.defs(h,"$try_convert",a=function(e,t){var r=this;return null==t&&(t=i),r["$native?"](e)?e:e["$respond_to?"]("to_n")?e.$to_n():t},a.$$arity=-2),e.defs(h,"$convert",c=function(e){var t=this;return t["$native?"](e)?e:e["$respond_to?"]("to_n")?e.$to_n():void t.$raise(_.get("ArgumentError"),e.$inspect()+" isn't native")},c.$$arity=1),e.defs(h,"$call",u=function(e,t,r){var n,a=this,o=u.$$p,s=o||i,l=arguments.length,c=l-2;c<0&&(c=0),n=new Array(c);for(var $=2;$<l;$++)n[$-2]=arguments[$];u.$$p=null;var f=e[t];if(f instanceof Function){for(var p=new Array(n.length),d=0,h=n.length;d<h;d++){var _=n[d],g=a.$try_convert(_);p[d]=g===i?_:g}return s!==i&&p.push(s),a.$Native(f.apply(e,p))}return a.$Native(f)},u.$$arity=-3),e.defs(h,"$proc",$=function(){var t,r,n,a=this,o=$.$$p,s=o||i;return $.$$p=null,!1!==s&&s!==i&&null!=s||a.$raise(_.get("LocalJumpError"),"no block given"),(t=(r=_.get("Kernel")).$proc,t.$$p=(n=function(t){var r,a,o,l,c=n.$$s||this,u=i,$=arguments.length,f=$-0;f<0&&(f=0),r=new Array(f);for(var p=0;p<$;p++)r[p-0]=arguments[p];if((a=(o=r)["$map!"],a.$$p=(l=function(e){var t=l.$$s||this;return null==e&&(e=i),t.$Native(e)},l.$$s=c,l.$$arity=1,l),a).call(o),u=c.$Native(this),this===e.global)return s.apply(c,r);var d=s.$$s;s.$$s=null;try{return s.apply(u,r)}finally{s.$$s=d}},n.$$s=a,n.$$arity=-1,n),t).call(r)},$.$$arity=0),function(t){var r,n,a,c,u,$=r=o(t,"Helpers"),f=($.$$proto,$.$$scope);e.defn($,"$alias_native",n=function(t,r,n){var a,o,c,u,$,p,d,h,_,g,m=this;if(h=e.slice.call(arguments,1,arguments.length),null==(n=e.extract_kwargs(h))||!n.$$is_hash){if(null!=n)throw e.ArgumentError.$new("expected kwargs");n=l([],{})}return null==(_=n.$$smap.as)&&(_=i),0<h.length&&(g=h.splice(0,1)[0]),null==g&&(g=t),(a=g["$end_with?"]("="))===i||null==a||a.$$is_boolean&&1!=a?!1!==_&&_!==i&&null!=_?(a=(u=m).$define_method,a.$$p=($=function(t){var r,n,a,o,s,l=$.$$s||this,c=i;null==l.native&&(l.native=i),r=$.$$p||i,$.$$p=null;var u=arguments.length,p=u-0;p<0&&(p=0),n=new Array(p);for(var d=0;d<u;d++)n[d-0]=arguments[d];return(a=c=(o=(s=f.get("Native")).$call,o.$$p=r.$to_proc(),o).apply(s,[l.native,g].concat(e.to_a(n))))===i||null==a||a.$$is_boolean&&1!=a?i:_.$new(c.$to_n())},$.$$s=m,$.$$arity=-1,$),a).call(u,t):(a=(p=m).$define_method,a.$$p=(d=function(t){var r,n,a,o,s=d.$$s||this;null==s.native&&(s.native=i),r=d.$$p||i,d.$$p=null;var l=arguments.length,c=l-0;c<0&&(c=0),n=new Array(c);for(var u=0;u<l;u++)n[u-0]=arguments[u];return(a=(o=f.get("Native")).$call,a.$$p=r.$to_proc(),a).apply(o,[s.native,g].concat(e.to_a(n)))},d.$$s=m,d.$$arity=-1,d),a).call(p,t):(a=(o=m).$define_method,a.$$p=(c=function(e){var t=c.$$s||this;return null==t.native&&(t.native=i),null==e&&(e=i),t.native[g["$[]"](s(0,-2,!1))]=f.get("Native").$convert(e),e},c.$$s=m,c.$$arity=1,c),a).call(o,t)},n.$$arity=-2),e.defn($,"$native_reader",a=function(e){var t,r,n,a,o=this,s=arguments.length,l=s-0;l<0&&(l=0),a=new Array(l);for(var c=0;c<s;c++)a[c-0]=arguments[c];return(t=(r=a).$each,t.$$p=(n=function(e){var t,r,a,o=n.$$s||this;return null==e&&(e=i),(t=(r=o).$define_method,t.$$p=(a=function(){var t=a.$$s||this;return null==t.native&&(t.native=i),t.$Native(t.native[e])},a.$$s=o,a.$$arity=0,a),t).call(r,e)},n.$$s=o,n.$$arity=1,n),t).call(r)},a.$$arity=-1),e.defn($,"$native_writer",c=function(e){var t,r,n,a,o=this,s=arguments.length,l=s-0;l<0&&(l=0),a=new Array(l);for(var c=0;c<s;c++)a[c-0]=arguments[c];return(t=(r=a).$each,t.$$p=(n=function(e){var t,r,a,o=n.$$s||this;return null==e&&(e=i),(t=(r=o).$define_method,t.$$p=(a=function(t){var r=a.$$s||this;return null==r.native&&(r.native=i),null==t&&(t=i),r.$Native(r.native[e]=t)},a.$$s=o,a.$$arity=1,a),t).call(r,e+"=")},n.$$s=o,n.$$arity=1,n),t).call(r)},c.$$arity=-1),e.defn($,"$native_accessor",u=function(t){var r,n,a,i=this,o=arguments.length,s=o-0;s<0&&(s=0),a=new Array(s);for(var l=0;l<o;l++)a[l-0]=arguments[l];return(r=i).$native_reader.apply(r,e.to_a(a)),(n=i).$native_writer.apply(n,e.to_a(a))},u.$$arity=-1)}(_.base),e.defs(h,"$included",f=function(e){return e.$extend(_.get("Helpers"))},f.$$arity=1),e.defn(h,"$initialize",p=function(e){var t,r=this;return((t=_.get("Kernel")["$native?"](e))===i||null==t||t.$$is_boolean&&1!=t)&&_.get("Kernel").$raise(_.get("ArgumentError"),e.$inspect()+" isn't native"),r.native=e},p.$$arity=1),e.defn(h,"$to_n",d=function(){var e=this;return null==e.native&&(e.native=i),e.native},d.$$arity=0)}(a.base),function(t){var r,n,a,s,l=r=o(t,"Kernel"),c=(l.$$proto,l.$$scope);e.defn(l,"$native?",n=function(e){return null==e||!e.$$class},n.$$arity=1),e.defn(l,"$Native",a=function(t){var r,n,a,o,s,l=this;return(r=null==t)===i||null==r||r.$$is_boolean&&1!=r?(r=l["$native?"](t))===i||null==r||r.$$is_boolean&&1!=r?(r=t["$is_a?"](c.get("Array")))===i||null==r||r.$$is_boolean&&1!=r?(r=t["$is_a?"](c.get("Proc")))===i||null==r||r.$$is_boolean&&1!=r?t:(r=(o=l).$proc,r.$$p=(s=function(r){var n,a,o,l,c=s.$$s||this;n=s.$$p||i,s.$$p=null;var u=arguments.length,$=u-0;$<0&&($=0),a=new Array($);for(var f=0;f<u;f++)a[f-0]=arguments[f];return c.$Native((o=(l=t).$call,o.$$p=n.$to_proc(),o).apply(l,e.to_a(a)))},s.$$s=l,s.$$arity=-1,s),r).call(o):(r=(n=t).$map,r.$$p=(a=function(e){var t=a.$$s||this;return null==e&&(e=i),t.$Native(e)},a.$$s=l,a.$$arity=1,a),r).call(n):c.get("Native").$$scope.get("Object").$new(t):i},a.$$arity=1),l.$alias_method("_Array","Array"),e.defn(l,"$Array",s=function(t,r){var n,a,o,l=this,u=s.$$p,$=u||i,f=arguments.length,p=f-1;p<0&&(p=0),o=new Array(p);for(var d=1;d<f;d++)o[d-1]=arguments[d];return s.$$p=null,(n=l["$native?"](t))===i||null==n||n.$$is_boolean&&1!=n?l.$_Array(t):(n=(a=c.get("Native").$$scope.get("Array")).$new,n.$$p=$.$to_proc(),n).apply(a,[t].concat(e.to_a(o))).$to_a()},s.$$arity=-2)}(a.base),function(r,n){function a(){}var o,s,u,$,f,p,d,h,_,g,m,y,v,b,x,w=a=c(r,n,"Object",a),A=w.$$proto,k=w.$$scope;A.native=i,w.$include(e.get("Native")),e.defn(w,"$==",o=function(e){return this.native===k.get("Native").$try_convert(e)},o.$$arity=1),e.defn(w,"$has_key?",s=function(t){var r=this;return e.hasOwnProperty.call(r.native,t)},s.$$arity=1),e.alias(w,"key?","has_key?"),e.alias(w,"include?","has_key?"),e.alias(w,"member?","has_key?"),e.defn(w,"$each",u=function(t){var r,n,a=this,o=u.$$p,s=o||i,l=arguments.length,c=l-0;c<0&&(c=0),n=new Array(c);for(var $=0;$<l;$++)n[$-0]=arguments[$];if(u.$$p=null,s!==i){for(var f in a.native)e.yieldX(s,[f,a.native[f]]);return a}return(r=a).$method_missing.apply(r,["each"].concat(e.to_a(n)))},u.$$arity=-1),e.defn(w,"$[]",$=function(t){var r=this,n=r.native[t];return n instanceof Function?n:e.get("Native").$call(r.native,t)},$.$$arity=1),e.defn(w,"$[]=",f=function(e,t){var r,n=this,a=i;return a=k.get("Native").$try_convert(t),(r=a===i)===i||null==r||r.$$is_boolean&&1!=r?n.native[e]=a:n.native[e]=t},f.$$arity=2),e.defn(w,"$merge!",p=function(e){var t=this;e=k.get("Native").$convert(e);for(var r in e)t.native[r]=e[r];return t},p.$$arity=1),e.defn(w,"$respond_to?",d=function(e,t){var r=this;return null==t&&(t=!1),k.get("Kernel").$instance_method("respond_to?").$bind(r).$call(e,t)},d.$$arity=-2),e.defn(w,"$respond_to_missing?",h=function(t,r){var n=this;return null==r&&(r=!1),e.hasOwnProperty.call(n.native,t)},h.$$arity=-2),e.defn(w,"$method_missing",_=function(r,n){var a,o,s,l=this,c=_.$$p,u=c||i,$=arguments.length,f=$-1;f<0&&(f=0),s=new Array(f);for(var p=1;p<$;p++)s[p-1]=arguments[p];return _.$$p=null,"="===r.charAt(r.length-1)?l["$[]="](r.$slice(0,t(r.$length(),1)),s["$[]"](0)):(a=(o=e.get("Native")).$call,a.$$p=u.$to_proc(),a).apply(o,[l.native,r].concat(e.to_a(s)))},_.$$arity=-2),e.defn(w,"$nil?",g=function(){return!1},g.$$arity=0),e.defn(w,"$is_a?",m=function(t){var r=this;return e.is_a(r,t)},m.$$arity=1),e.alias(w,"kind_of?","is_a?"),e.defn(w,"$instance_of?",y=function(e){return this.$$class===e},y.$$arity=1),e.defn(w,"$class",v=function(){return this.$$class},v.$$arity=0),e.defn(w,"$to_a",b=function(e){var t,r,n=this,a=b.$$p,o=a||i;return null==e&&(e=l([],{})),b.$$p=null,(t=(r=k.get("Native").$$scope.get("Array")).$new,t.$$p=o.$to_proc(),t).call(r,n.native,e).$to_a()},b.$$arity=-1),e.defn(w,"$inspect",x=function(){var e=this;return"#<Native:"+String(e.native)+">"},x.$$arity=0)}(a.get("Native"),a.get("BasicObject")),function(n,a){function o(){}var s,u,$,f,p,d,h,_=o=c(n,null,"Array",o),g=_.$$proto,m=_.$$scope;g.named=g.native=g.get=g.block=g.set=g.length=i,_.$include(m.get("Native")),_.$include(m.get("Enumerable")),e.defn(_,"$initialize",s=function(t,r){var n,a,o=this,c=s.$$p,u=c||i;return null==r&&(r=l([],{})),s.$$p=null,(a=o,n=e.find_super_dispatcher(o,"initialize",s,!1),n.$$p=null,n).call(a,t),o.get=!1!==(n=r["$[]"]("get"))&&n!==i&&null!=n?n:r["$[]"]("access"),o.named=r["$[]"]("named"),o.set=!1!==(n=r["$[]"]("set"))&&n!==i&&null!=n?n:r["$[]"]("access"),o.length=!1!==(n=r["$[]"]("length"))&&n!==i&&null!=n?n:"length",o.block=u,(n=null==o.$length())===i||null==n||n.$$is_boolean&&1!=n?i:o.$raise(m.get("ArgumentError"),"no length found on the array-like object")},s.$$arity=-2),e.defn(_,"$each",u=function(){var t=this,r=u.$$p,n=r||i;if(u.$$p=null,!1===n||n===i||null==n)return t.$enum_for("each");for(var a=0,o=t.$length();a<o;a++)e.yield1(n,t["$[]"](a));return t},u.$$arity=0),e.defn(_,"$[]",$=function(e){var t,r=this,n=i,a=i;return n=function(){return a=e,m.get("String")["$==="](a)||m.get("Symbol")["$==="](a)?(t=r.named)===i||null==t||t.$$is_boolean&&1!=t?r.native[e]:r.native[r.named](e):m.get("Integer")["$==="](a)?(t=r.get)===i||null==t||t.$$is_boolean&&1!=t?r.native[e]:r.native[r.get](e):i}(),!1!==n&&n!==i&&null!=n?(t=r.block)===i||null==t||t.$$is_boolean&&1!=t?r.$Native(n):r.block.$call(n):i},$.$$arity=1),e.defn(_,"$[]=",f=function(e,t){var r,n=this;return(r=n.set)===i||null==r||r.$$is_boolean&&1!=r?n.native[e]=m.get("Native").$convert(t):n.native[n.set](e,m.get("Native").$convert(t))},f.$$arity=2),e.defn(_,"$last",p=function(e){var n,a=this,o=i,s=i;if(null==e&&(e=i),!1!==e&&e!==i&&null!=e){for(o=t(a.$length(),1),s=[];(n=r(o,0))!==i&&null!=n&&(!n.$$is_boolean||1==n);)s["$<<"](a["$[]"](o)),o=t(o,1);return s}return a["$[]"](t(a.$length(),1))},p.$$arity=-1),e.defn(_,"$length",d=function(){var e=this;return e.native[e.length]},d.$$arity=0),e.alias(_,"to_ary","to_a"),e.defn(_,"$inspect",h=function(){return this.$to_a().$inspect()},h.$$arity=0)}(a.get("Native")),function(t,r){function n(){}var a,i=n=c(t,null,"Numeric",n);i.$$proto,i.$$scope;e.defn(i,"$to_n",a=function(){return this.valueOf()},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,i=n=c(t,null,"Proc",n);i.$$proto,i.$$scope;e.defn(i,"$to_n",a=function(){return this},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,i=n=c(t,null,"String",n);i.$$proto,i.$$scope;e.defn(i,"$to_n",a=function(){return this.valueOf()},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,i=n=c(t,null,"Regexp",n);i.$$proto,i.$$scope;e.defn(i,"$to_n",a=function(){return this.valueOf()},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,o=n=c(t,null,"MatchData",n),s=o.$$proto;o.$$scope;s.matches=i,e.defn(o,"$to_n",a=function(){return this.matches},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,o=n=c(t,null,"Struct",n),s=(o.$$proto,o.$$scope);e.defn(o,"$to_n",a=function(){var e,t,r,n=this,a=i;return a={},(e=(t=n).$each_pair,e.$$p=(r=function(e,t){r.$$s;return null==e&&(e=i),null==t&&(t=i),a[e]=s.get("Native").$try_convert(t,t)},r.$$s=n,r.$$arity=2,r),e).call(t),a},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,i=n=c(t,null,"Array",n),o=(i.$$proto,i.$$scope);e.defn(i,"$to_n",a=function(){for(var e=this,t=[],r=0,n=e.length;r<n;r++){var a=e[r];t.push(o.get("Native").$try_convert(a,a))}return t},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,i=n=c(t,null,"Boolean",n);i.$$proto,i.$$scope;e.defn(i,"$to_n",a=function(){return this.valueOf()},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,i=n=c(t,null,"Time",n);i.$$proto,i.$$scope;e.defn(i,"$to_n",a=function(){return this},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,i=n=c(t,null,"NilClass",n);i.$$proto,i.$$scope;e.defn(i,"$to_n",a=function(){return null},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,o,s=n=c(t,null,"Hash",n),l=(s.$$proto,s.$$scope);s.$alias_method("_initialize","initialize"),e.defn(s,"$initialize",a=function(e){var t,r,n=this,o=a.$$p,s=o||i;if(a.$$p=null,null!=e&&e.constructor===Object){var c,u,$=n.$$smap,f=n.$$keys;for(c in e)u=e[c],u&&u.constructor===Object?$[c]=l.get("Hash").$new(u):u&&u.$$is_array?(u=u.map(function(e){return e&&e.constructor===Object?l.get("Hash").$new(e):e}),$[c]=u):$[c]=n.$Native(u),f.push(c);return n}return(t=(r=n).$_initialize,t.$$p=s.$to_proc(),t).call(r,e)},a.$$arity=-1),e.defn(s,"$to_n",o=function(){for(var e,t,r=this,n={},a=r.$$keys,i=r.$$smap,o=0,s=a.length;o<s;o++)e=a[o],e.$$is_string?t=i[e]:(e=e.key,t=e.value),n[e]=l.get("Native").$try_convert(t,t);return n},o.$$arity=0)}(a.base),function(t,r){function n(){}var a,i=n=c(t,null,"Module",n);i.$$proto,i.$$scope;e.defn(i,"$native_module",a=function(){var t=this;return e.global[t.$name()]=t},a.$$arity=0)}(a.base),function(t,r){function n(){}var a,i,o=n=c(t,null,"Class",n),s=(o.$$proto,o.$$scope);e.defn(o,"$native_alias",a=function(e,t){var r=this,n=r.$$proto["$"+t];n||r.$raise(s.get("NameError").$new("undefined method `"+t+"' for class `"+r.$inspect()+"'",r.$exiting_mid())),r.$$proto[e]=n},a.$$arity=2),e.defn(o,"$native_class",i=function(){var e=this;e.$native_module(),e.new=e.$new},i.$$arity=0)}(a.base),u.$=u.global=n.$Native(e.global)},Opal.modules.abc2svg_to_harpnotes=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e>=t:e["$>="](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function o(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function s(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}var l=e.top,c=e,u=e.nil,$=(e.breaker,e.slice,e.module),f=e.klass,p=e.hash2,d=e.gvars,h=e.hash,_=e.range;return e.add_stubs(["$require","$attr_reader","$get","$_reset_state","$get_metadata","$new","$abcplay=","$get_abcmodel","$nil?","$raise","$t","$_make_metadata","$_transform_voices","$meta_data=","$harpnote_options=","$_make_harpnote_options","$[]","$meta_data","$empty?","$error","$[]=","$compact","$map","$gsub","$strip","$+","$_get_key_by_accidentals","$first","$==","$/","$to_i","$join","$>=","$private","$match","$charpos_to_line_column","$flatten","$to_a","$_transform_voice","$_make_variant_ending_jumps","$each_with_index","$unshift","$to_s","$_investigate_first_bar","$each","$send","$inject","$<<","$_make_jumplines","$_make_notebound_annotations","$count","$last","$-","$select","$!","$=~","$_extract_goto_info_from_bar","$!=","$length","$push","$_bar_is_repetition_end?","$>","$pop","$_transform_bar_repeat_end","$include?","$_parse_origin","$_parse_tuplet_info","$_parse_decorations","$_transform_measure_start","$_convert_duration","$decorations=","$measure_count=","$count_note=","$_transform_count_note","$time=","$znid=","$_mkznid","$origin=","$start_pos=","$end_pos=","$tuplet=","$tuplet_start=","$tuplet_end=","$variant=","$time","$duration=","$duration","$origin","$start_pos","$end_pos","$tuplet","$tuplet_start","$tuplet_end","$tie_end=","$tie_start=","$slur_starts=","$_push_slur","$_parse_slur","$slur_ends=","$_pop_slur","$measure_start=","$_make_repeats_jumps_annotations","$*","$%","$ceil","$split","$zip","$min","$round","$floor","$visible=","$is_a?","$pitch=","$prev_pitch","$znid","$start_pos_to_s","$_extract_chord_lines","$===","$shift=","$notes","$to_f","$next_pitch=","$pitch","$next_playable=","$next_first_in_part=","$prev_pitch=","$prev_playable=","$first_in_part=","$<","$start_with?","$to_sym","$&","$>>"]),l.$require("native"),function(l){var c,g=c=$(l,"Harpnotes"),m=(g.$$proto,g.$$scope);!function(l){var c,g=c=$(l,"Input"),m=(g.$$proto,g.$$scope);!function(l,c){function $(){}var g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne,ae,ie=$=f(l,c,"Abc2svgToHarpnotes",$),oe=ie.$$proto,se=ie.$$scope;oe.abc_code=oe.abcplay=oe.abc_model=oe.meta_data=oe.info_fields=oe.remark_table=oe.score_statements=oe.wmeasure=oe.measure_start_time=oe.next_note_marks=oe.variant_no=oe.variant_endings=oe.previous_note=oe.repetition_stack=oe.pushed_variant_ending_repeat=oe.part_table=oe.measure_count=oe.tie_started=oe.countby=oe._shortest_note=oe.pitch_providers=oe.slurstack=oe.tuplet_p=u,e.cdecl(se,"ABC2SVG_DURATION_FACTOR",1536),ie.$attr_reader("abc_model"),e.defn(ie,"$initialize",g=function(){var t,r,n=this,a=g.$$p,i=u,o=u;for(null==d.conf&&(d.conf=u),g.$$p=null,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return(r=n,t=e.find_super_dispatcher(n,"initialize",g,!1),t.$$p=a,t).apply(r,i),n.abcplay=u,n.abc_code=u,n.previous_new_part=[],n.score_statements=[],n.part_table=p([],{}),n.abc_model=p([],{}),n._shortest_note=d.conf.$get("layout.SHORTEST_NOTE"),n.$_reset_state()},g.$$arity=0),e.defn(ie,"$transform",m=function(t){var r,n,a=this,i=u,o=u,s=u,l=u;return null==d.conf&&(d.conf=u),null==d.log&&(d.log=u),a.abc_code=t,a.annotations=d.conf.$get("annotations"),a.info_fields=a.$get_metadata(a.abc_code),i=se.get("ABC2SVG").$$scope.get("Abc2Svg").$new(u,p(["mode"],{mode:"model"})),(r=a.abcplay)===u||null==r||r.$$is_boolean&&1!=r||(r=[a.abcplay],n=i,n["$abcplay="].apply(n,r),r[r.length-1]),n=i.$get_abcmodel(t),r=e.to_ary(n),a.abc_model=null==r[0]?u:r[0],o=null==r[1]?u:r[1],(r=a.abc_model["$nil?"]())===u||null==r||r.$$is_boolean&&1!=r||a.$raise(se.get("I18n").$t("no suitable ABC found")),a.$_make_metadata(),s=a.$_transform_voices(),r=[a.meta_data],n=s,n["$meta_data="].apply(n,r),r[r.length-1],r=[a.$_make_harpnote_options()],n=s,n["$harpnote_options="].apply(n,r),r[r.length-1],l=s.$meta_data()["$[]"]("filename"),(r=l["$empty?"]())===u||null==r||r.$$is_boolean&&1!=r||d.log.$error(se.get("I18n").$t("Filename not specified in song add an F: instruction"),[1,1]),[s,o]},m.$$arity=1),e.defn(ie,"$_make_harpnote_options",y=function(){var e,r,n,a=this,i=u;return null==d.conf&&(d.conf=u),i=p(["lyrics"],{lyrics:p(["text"],{text:a.info_fields["$[]"]("W")})}),i["$[]="]("template",d.conf.$get("template")),i["$[]="]("print",(e=(r=d.conf.$get("produce")).$map,e.$$p=(n=function(e){var r,a=(n.$$s,u),i=u;return null==d.conf&&(d.conf=u),null==d.log&&(d.log=u),null==e&&(e=u),a=d.conf.$get("extract."+e+".title"),!1!==a&&a!==u&&null!=a?(i=(!1!==(r=d.conf.$get("extract."+e+".filenamepart"))&&r!==u&&null!=r?r:a).$strip().$gsub(/[^a-zA-Z0-9\-\_]/,"_"),p(["title","view_id","filenamepart"],{title:a,view_id:e,filenamepart:i})):(d.log.$error(t(se.get("I18n").$t("could not find extract with number")," "+e),[1,1],[1e3,1e3]),u)},n.$$s=a,n.$$arity=1,n),e).call(r).$compact()),i},y.$$arity=0),e.defn(ie,"$_get_key_by_accidentals",v=function(e){return h(7,["C#","D#Dor","E#Phr","F#Lyd","G#Mix","A#m","B#Loc"],6,["F#","G#Dor","A#Phr","BLyd","C#Mix","D#m","E#Loc"],5,["B","C#Dor","D#Phr","ELyd","F#Mix","G#m","A#Loc"],4,["E","F#Dor","G#Phr","ALyd","BMix","C#m","D#Loc"],3,["A","BDor","C#Phr","DLyd","EMix","F#m","G#Loc"],2,["D","EDor","F#Phr","GLyd","AMix","Bm","C#Loc"],1,["G","ADor","BPhr","CLyd","DMix","Em","F#Loc"],0,["C","DDor","EPhr","FLyd","GMix","Am","BLoc"],-1,["F","GDor","APhr","BbLyd","CMix","Dm","ELoc"],-2,["Bb","CDor","DPhr","EbLyd","FMix","Gm","ALoc"],-3,["Eb","FDor","GPhr","AbLyd","BbMix","Cm","DLoc"],-4,["Ab","BbDor","CPhr","DbLyd","EbMix","Fm","GLoc"],-5,["Db","EbDor","FPhr","GbLyd","AbMix","Bbm","CLoc"],-6,["Gb","AbDor","BbPhrCbLyd","DbMix","Ebm","FLoc"],-7,["CbDbDor","EbPhrFbLyd","GbMix","Abm","BbLoc"])["$[]"](e["$[]"]("k_sf"))["$[]"](e["$[]"]("k_mode"))},v.$$arity=1),e.defn(ie,"$_make_metadata",b=function(){var t,a,i,o=this,s=u,l=u,c=u,$=u,f=u,d=u,h=u;return s=o.$_get_key_by_accidentals(o.abc_model["$[]"]("voices").$first()["$[]"]("voice_properties")["$[]"]("key")),l=o.$_get_key_by_accidentals(o.abc_model["$[]"]("voices").$first()["$[]"]("voice_properties")["$[]"]("okey")),c="",s["$=="](l)||(c="(Original in "+l+")"),$=function(){try{return o.abc_model["$[]"]("voices").$first()["$[]"]("voice_properties")["$[]"]("sym")}catch(t){if(e.rescue(t,[se.get("StandardError")]))return u;throw t}}(),(t=(a=!1!==$&&$!==u&&null!=$)?$["$[]"]("tempo_notes"):$)===u||null==t||t.$$is_boolean&&1!=t?(f=[.25],d=120,h="1/4=120"):(f=(t=(a=$["$[]"]("tempo_notes")).$map,t.$$p=(i=function(e){i.$$s;return null==e&&(e=u),r(e,se.get("ABC2SVG_DURATION_FACTOR"))},i.$$s=o,i.$$arity=1,i),t).call(a),d=$["$[]"]("tempo").$to_i(),h=o.info_fields["$[]"]("Q").$join(" ")),((t=n(d,1))===u||null==t||t.$$is_boolean&&1!=t)&&(d=120),o.meta_data=p(["number","composer","title","filename","tempo","tempo_display","meter","key","o_key"],{number:o.info_fields["$[]"]("X").$first(),composer:(!1!==(t=o.info_fields["$[]"]("C"))&&t!==u&&null!=t?t:[]).$join("\n"),title:(!1!==(t=o.info_fields["$[]"]("T"))&&t!==u&&null!=t?t:[]).$join("\n"),filename:(!1!==(t=o.info_fields["$[]"]("F"))&&t!==u&&null!=t?t:[]).$join("\n"),tempo:p(["duration","bpm","sym"],{duration:f,bpm:d,sym:$}),tempo_display:h,meter:o.info_fields["$[]"]("M"),key:s,o_key:c})},b.$$arity=0),ie.$private(),e.defn(ie,"$_mkznid",x=function(e){var t,r=this,n=u,a=u,i=u;return null==d.log&&(d.log=u),n=r.remark_table["$[]"](e["$[]"]("time")),!1!==n&&n!==u&&null!=n?((t=n.$match(/[a-z][a-zA-Z0-9_]*/))===u||null==t||t.$$is_boolean&&1!=t)&&(a=r.$charpos_to_line_column(e["$[]"]("istart")),i=r.$charpos_to_line_column(e["$[]"]("iend")),d.log.$error("illegal character in of [r:] (must be of [a-z][a-z0.9_])",a,i),n=u):!1!==n&&n!==u&&null!=n||(n=""+e["$[]"]("time")),n},x.$$arity=1),e.defn(ie,"$_reset_state",w=function(){var e,t,r,n=this;return n.countnames=(e=(t=_(1,32,!1).$to_a()).$map,e.$$p=(r=function(e){r.$$s;return null==e&&(e=u),[e,"e","u","e"]},r.$$s=n,r.$$arity=1,r),e).call(t).$flatten(),n.jumptargets=p([],{}),n.is_first_measure=!0,n.measure_start_time=0,n.measure_count=0,n.next_note_marks=p(["measure","repeat_start","variant_ending","variant_followup"],{measure:!1,repeat_start:!1,variant_ending:!1,variant_followup:!1}),n.previous_new_part=[],n.previous_note=u,n.remark_table=p([],{}),n.repetition_stack=[],n.variant_endings=[[]],n.tie_started=!1,n.variant_no=0,n.slurstack=0,n.tuplet_count=1,n.tuplet_down_count=1,n.countby=u,n.wmeasure=0},w.$$arity=0),e.defn(ie,"$_transform_voices",A=function(){var e,r,n,a=this,i=u;return i=(e=(r=a.abc_model["$[]"]("voices").$each_with_index()).$map,e.$$p=(n=function(e,r){var a=n.$$s||this,i=u,o=u;return null==e&&(e=u),null==r&&(r=u),i="v_"+t(r,1),o=a.$_transform_voice(e,i),!1!==o&&o!==u&&null!=o&&(o=t(o,a.$_make_variant_ending_jumps(i))),o},n.$$s=a,n.$$arity=2,n),e).call(r).$compact(),i.$unshift(i.$first()),se.get("Harpnotes").$$scope.get("Music").$$scope.get("Song").$new(i)},A.$$arity=0),e.defn(ie,"$_transform_voice",k=function(r,n){var i,o,s,l,c,$,f,p,h,_,g,m,y=this,v=u,b=u,x=u,w=u,A=u;return null==d.log&&(d.log=u),v=y.abc_model["$[]"]("music_type_ids")["$[]"]("note").$to_s(),y.$_reset_state(),y.wmeasure=r["$[]"]("voice_properties")["$[]"]("meter")["$[]"]("wmeasure"),y.countby=function(){try{return r["$[]"]("voice_properties")["$[]"]("meter")["$[]"]("a_meter").$first()["$[]"]("bot").$to_i()}catch(t){if(e.rescue(t,[se.get("StandardError")]))return u;throw t}}(),y.$_investigate_first_bar(r),(i=(o=r["$[]"]("symbols")).$each,i.$$p=(s=function(e){var t=s.$$s||this;return null==e&&(e=u),e["$[]="]("start_pos",t.$charpos_to_line_column(e["$[]"]("istart"))),e["$[]="]("end_pos",t.$charpos_to_line_column(e["$[]"]("iend")))},s.$$s=y,s.$$arity=1,s),i).call(o),y.pitch_providers=(i=(l=r["$[]"]("symbols")).$map,i.$$p=(c=function(e){c.$$s;return null==e&&(e=u),e["$[]"]("type").$to_s()["$=="](v)?e:u},c.$$s=y,c.$$arity=1,c),i).call(l),b=(i=($=r["$[]"]("symbols").$each_with_index()).$map,i.$$p=(f=function(t,r){var a=f.$$s||this,i=u,o=u;null==a.abc_model&&(a.abc_model=u),null==d.log&&(d.log=u),null==t&&(t=u),null==r&&(r=u),i=a.abc_model["$[]"]("music_types")["$[]"](t["$[]"]("type"));try{b=a.$send("_transform_"+i,t,r,n)}catch(r){if(!e.rescue(r,[se.get("Exception")]))throw r;o=r;try{d.log.$error("Bug: "+o,a.$charpos_to_line_column(t["$[]"]("istart")))}finally{e.pop_exception()}}return b},f.$$s=y,f.$$arity=2,f),i).call($),b=b.$flatten(),x=(i=(p=b).$inject,i.$$p=(h=function(e,t){var r=h.$$s||this;return null==e&&(e=u),null==t&&(t=u),e["$<<"](r.$_make_jumplines(t,n)),e},h.$$s=y,h.$$arity=2,h),i).call(p,[]),w=(i=(_=b).$inject,i.$$p=(g=function(e,t){var r=g.$$s||this;return null==e&&(e=u),null==t&&(t=u),e["$<<"](r.$_make_notebound_annotations(t,n))},g.$$s=y,g.$$arity=2,g),i).call(_,[]),b=t(b,t(x,w)),b=b.$flatten().$compact(),(i=b.$count()["$=="](0))===u||null==i||i.$$is_boolean&&1!=i||(A=n.$gsub("v_","").$to_i(),m=y.score_statements.$last(),((i=!1!==m&&m!==u&&null!=m?y.score_statements.$last()["$[]"]("sy")["$[]"]("voices")["$[]"](a(A,1))["$[]"]("range")["$=="](-1):m)===u||null==i||i.$$is_boolean&&1!=i)&&d.log.$error(se.get("I18n").$t("Empty voice")+" "+A+":  V:"+r["$[]"]("voice_properties")["$[]"]("id")),b=u),b},k.$$arity=2),e.defn(ie,"$_investigate_first_bar",E=function(e){var t,r,n,i,o=this,s=u,l=u;return s=o.abc_model["$[]"]("music_type_ids")["$[]"]("bar").$to_s(),l=(t=(r=e["$[]"]("symbols")).$select,t.$$p=(n=function(e){n.$$s;return null==e&&(e=u),e["$[]"]("type").$to_s()["$=="](s)?e["$[]"]("invisible")["$!"]():e["$[]"]("type").$to_s()["$=="](s)},n.$$s=o,n.$$arity=1,n),t).call(r).$compact(),o.measure_start_time=0,(t=l.$first())===u||null==t||t.$$is_boolean&&1!=t?u:(o.measure_start_time=a(l.$first()["$[]"]("time"),o.wmeasure),i=l.$first(),(t=!1!==i&&i!==u&&null!=i?o.measure_start_time["$=="](0):i)===u||null==t||t.$$is_boolean&&1!=t?u:o.next_note_marks["$[]="]("measure",!0))},E.$$arity=1),e.defn(ie,"$_bar_is_repetition_end?",C=function(e){return e["$=~"](/^:.*$/)},C.$$arity=1),e.defn(ie,"$_transform_bar",S=function(r,n,o){var s,l,c,$=this,f=u,h=u,_=u,g=u;return null==d.log&&(d.log=u),f=[],h=r["$[]"]("bar_type"),_=r["$[]"]("text"),g=function(){try{return $.$_extract_goto_info_from_bar(r).$last()["$[]"]("distance")}catch(t){if(e.rescue(t,[se.get("StandardError")]))return[-10,10,15];throw t}}(),((s=!1!==(l=r["$[]"]("invisible"))&&l!==u&&null!=l?l:h["$=~"](/^\:?([\[\]]+)$/))===u||null==s||s.$$is_boolean&&1!=s)&&$.next_note_marks["$[]="]("measure",!0),(s=h["$=~"](/^.*:$/))===u||null==s||s.$$is_boolean&&1!=s||$.next_note_marks["$[]="]("repeat_start",!0),r["$[]"]("rbstart")["$=="](2)&&($.variant_no=t($.variant_no,1),$.next_note_marks["$[]="]("variant_ending",p(["text"],{text:_}))),(s=(l=r["$[]"]("rbstart")["$=="](2))?$.variant_endings.$last()["$empty?"]():r["$[]"]("rbstart")["$=="](2))===u||null==s||s.$$is_boolean&&1!=s||((s=g.$length()["$!="](3))===u||null==s||s.$$is_boolean&&1!=s||(d.log.$error("you need to specify 3 values: "+g,$.$charpos_to_line_column(r["$[]"]("istart")),$.$charpos_to_line_column(r["$[]"]("iend"))),g=[-10,10,15]),$.variant_endings.$last().$push(p(["rbstop","distance"],{rbstop:$.previous_note,distance:g}))),c=r["$[]"]("rbstop")["$=="](2),l=!1!==c&&c!==u&&null!=c?$.variant_endings.$last().$last()["$nil?"]()["$!"]():c,(s=!1!==l&&l!==u&&null!=l?$.variant_endings.$last().$last()["$[]"]("rbstart"):l)===u||null==s||s.$$is_boolean&&1!=s||($.variant_endings.$last().$last()["$[]="]("rbstop",$.previous_note),(s=$["$_bar_is_repetition_end?"](h))===u||null==s||s.$$is_boolean&&1!=s||$.variant_endings.$last().$last()["$[]="]("repeat_end",!0),(s=$["$_bar_is_repetition_end?"](h))===u||null==s||s.$$is_boolean&&1!=s?(l=$.pushed_variant_ending_repeat,(s=!1!==l&&l!==u&&null!=l?i($.repetition_stack.$count(),1):l)===u||null==s||s.$$is_boolean&&1!=s||$.repetition_stack.$pop()):($.pushed_variant_ending_repeat=!0,$.repetition_stack.$push($.repetition_stack.$last())),r["$[]"]("rbstart")["$=="](2)||($.next_note_marks["$[]="]("variant_followup",!0),$.variant_endings.$push([]),$.variant_no=0)),(s=$["$_bar_is_repetition_end?"](h))===u||null==s||s.$$is_boolean&&1!=s||f["$<<"]($.$_transform_bar_repeat_end(r,n,o)),
(s=h["$include?"](":"))===u||null==s||s.$$is_boolean&&1!=s||((s=!1)===u||null==s||s.$$is_boolean&&1!=s)&&(a(r["$[]"]("time"),$.measure_start_time)["$=="]($.wmeasure)||$.next_note_marks["$[]="]("measure",!1)),$.is_first_measure=!1,f},S.$$arity=3),e.defn(ie,"$_transform_part",I=function(e,r,n){var a,i=this,o=u,s=u;return null==d.log&&(d.log=u),(a=i.part_table["$[]"](e["$[]"]("time")))===u||null==a||a.$$is_boolean&&1!=a||(o=i.$charpos_to_line_column(e["$[]"]("istart")),s=i.$charpos_to_line_column(e["$[]"]("iend")),d.log.$error(t("abc:"+o.$first()+":"+o.$last()+" Error: ",se.get("I18n").$t("Multiple parts for same note")),o,s)),i.part_table["$[]="](e["$[]"]("time"),e["$[]"]("text")),u},I.$$arity=3),e.defn(ie,"$_transform_remark",O=function(e,r,n){var a,i=this,o=u,s=u;return null==d.log&&(d.log=u),(a=i.remark_table["$[]"](e["$[]"]("time")))===u||null==a||a.$$is_boolean&&1!=a||(o=i.$charpos_to_line_column(e["$[]"]("istart")),s=i.$charpos_to_line_column(e["$[]"]("iend")),d.log.$error(t("abc:"+o.$first()+":"+o.$last()+" Error: ",se.get("I18n").$t("Multiple remarks for same note")),o,s)),i.remark_table["$[]="](e["$[]"]("time"),e["$[]"]("text")),u},O.$$arity=3),e.defn(ie,"$_transform_note",T=function(t,r,n){var a,i,o,s,l,c,$,f,p,d,h=this,g=u,m=u,y=u,v=u,b=u,x=u,w=u,A=u,k=u,E=u,C=u,S=u,I=u;return g=h.$_parse_origin(t),a=[g["$[]"]("startChar"),g["$[]"]("endChar")],m=a[0],y=a[1],i=h.$_parse_tuplet_info(t),a=e.to_ary(i),v=null==a[0]?u:a[0],b=null==a[1]?u:a[1],x=null==a[2]?u:a[2],w=h.$_parse_decorations(t),h.$_transform_measure_start(t),A=h.$_convert_duration(t["$[]"]("notes").$first()["$[]"]("dur")),k=(a=(i=t["$[]"]("notes")).$map,a.$$p=(o=function(e){var r,n,a=o.$$s||this,i=u;return null==a.measure_count&&(a.measure_count=u),null==a.variant_no&&(a.variant_no=u),null==e&&(e=u),i=se.get("Harpnotes").$$scope.get("Music").$$scope.get("Note").$new(e["$[]"]("midi"),A),r=[w],n=i,n["$decorations="].apply(n,r),r[r.length-1],r=[a.measure_count],n=i,n["$measure_count="].apply(n,r),r[r.length-1],r=[a.$_transform_count_note(t)],n=i,n["$count_note="].apply(n,r),r[r.length-1],r=[t["$[]"]("time")],n=i,n["$time="].apply(n,r),r[r.length-1],r=[a.$_mkznid(t)],n=i,n["$znid="].apply(n,r),r[r.length-1],r=[g],n=i,n["$origin="].apply(n,r),r[r.length-1],r=[a.$charpos_to_line_column(m)],n=i,n["$start_pos="].apply(n,r),r[r.length-1],r=[a.$charpos_to_line_column(y)],n=i,n["$end_pos="].apply(n,r),r[r.length-1],r=[v],n=i,n["$tuplet="].apply(n,r),r[r.length-1],r=[x],n=i,n["$tuplet_start="].apply(n,r),r[r.length-1],r=[b],n=i,n["$tuplet_end="].apply(n,r),r[r.length-1],r=[a.variant_no],n=i,n["$variant="].apply(n,r),r[r.length-1],i},o.$$s=h,o.$$arity=1,o),a).call(i),E=[],k.$count()["$=="](1)?E["$<<"](k.$first()):(C=se.get("Harpnotes").$$scope.get("Music").$$scope.get("SynchPoint").$new(k),S=k.$first(),a=[h.$_mkznid(t)],s=C,s["$znid="].apply(s,a),a[a.length-1],a=[w],s=C,s["$decorations="].apply(s,a),a[a.length-1],a=[h.measure_count],s=C,s["$measure_count="].apply(s,a),a[a.length-1],a=[h.$_transform_count_note(t)],s=C,s["$count_note="].apply(s,a),a[a.length-1],a=[S.$time()],s=C,s["$time="].apply(s,a),a[a.length-1],a=[S.$duration()],s=C,s["$duration="].apply(s,a),a[a.length-1],a=[S.$origin()],s=C,s["$origin="].apply(s,a),a[a.length-1],a=[S.$start_pos()],s=C,s["$start_pos="].apply(s,a),a[a.length-1],a=[S.$end_pos()],s=C,s["$end_pos="].apply(s,a),a[a.length-1],a=[S.$tuplet()],s=C,s["$tuplet="].apply(s,a),a[a.length-1],a=[S.$tuplet_start()],s=C,s["$tuplet_start="].apply(s,a),a[a.length-1],a=[S.$tuplet_end()],s=C,s["$tuplet_end="].apply(s,a),a[a.length-1],E["$<<"](C)),(a=h.repetition_stack["$empty?"]())===u||null==a||a.$$is_boolean&&1!=a||h.repetition_stack["$<<"](E.$last()),a=[h.tie_started],s=E.$first(),s["$tie_end="].apply(s,a),a[a.length-1],h.tie_started=t["$[]"]("ti1")["$nil?"]()["$!"](),a=[h.tie_started],s=E.$first(),s["$tie_start="].apply(s,a),a[a.length-1],a=[(l=(c=h.$_parse_slur(t["$[]"]("slur_start"))).$map,l.$$p=($=function(e){var t=$.$$s||this;return null==e&&(e=u),t.$_push_slur()},$.$$s=h,$.$$arity=1,$),l).call(c)],s=E.$first(),s["$slur_starts="].apply(s,a),a[a.length-1],I=!1!==(a=t["$[]"]("slur_end"))&&a!==u&&null!=a?a:0,a=[(l=(f=_(1,I,!1)).$map,l.$$p=(p=function(){return(p.$$s||this).$_pop_slur()},p.$$s=h,p.$$arity=0,p),l).call(f)],s=E.$first(),s["$slur_ends="].apply(s,a),a[a.length-1],(a=h.next_note_marks["$[]"]("measure"))===u||null==a||a.$$is_boolean&&1!=a||((a=(s=k).$each,a.$$p=(d=function(e){var t,r;d.$$s;return null==e&&(e=u),t=[!0],r=e,r["$measure_start="].apply(r,t),t[t.length-1]},d.$$s=h,d.$$arity=1,d),a).call(s),h.next_note_marks["$[]="]("measure",!1)),h.$_make_repeats_jumps_annotations(E,t,n),E},T.$$arity=3),e.defn(ie,"$_transform_measure_start",P=function(e){var r,n=this;return(r=n.next_note_marks["$[]"]("measure"))===u||null==r||r.$$is_boolean&&1!=r?u:(n.measure_count=t(n.measure_count,1),n.measure_start_time=e["$[]"]("time"))},P.$$arity=1),e.defn(ie,"$_transform_count_note",M=function(e){var i,s,l,c,$,f,p,d=this,h=u,g=u,m=u,y=u,v=u,b=u;return(i=d.countby)===u||null==i||i.$$is_boolean&&1!=i?u:(h=r(se.get("ABC2SVG_DURATION_FACTOR"),d.countby),g=r(o(4,a(e["$[]"]("time"),d.measure_start_time)),h),m=t(g,r(o(4,e["$[]"]("dur")),h)),s=g["$%"](1)["$=="](0),y=(i=!1!==s&&s!==u&&null!=s?m["$%"](1)["$=="](0):s)===u||null==i||i.$$is_boolean&&1!=i?g["$%"](1)["$=="](0)?(i=(c=_(g,m.$ceil(),!0).$to_a()).$map,i.$$p=($=function(e){var t=$.$$s||this;return null==t.countnames&&(t.countnames=u),null==e&&(e=u),t.countnames["$[]"](e)},$.$$s=d,$.$$arity=1,$),i).call(c).$join(""):"":(i=(s=_(g,m,!0).$to_a()).$map,i.$$p=(l=function(e){var t=l.$$s||this;return null==t.countnames&&(t.countnames=u),null==e&&(e=u),t.countnames["$[]"](e)},l.$$s=d,l.$$arity=1,l),i).call(s).$join(),v=y.$split(/[eui\?]+/),b=y.$split(/[0-9]+/),(i=b["$empty?"]())===u||null==i||i.$$is_boolean&&1!=i||(b=[""]),(i=(f=b).$each_with_index,i.$$p=(p=function(e,t){var r;p.$$s;return null==e&&(e=u),null==t&&(t=u),(r=n(t,1))===u||null==r||r.$$is_boolean&&1!=r?u:b["$[]="](t,u)},p.$$s=d,p.$$arity=2,p),i).call(f),y=b.$zip(v).$flatten().$compact().$join(" ").$strip().$split().$join("-"),y=y.$gsub("ue","u"))},M.$$arity=1),e.defn(ie,"$_convert_duration",N=function(e){var t=this;return[128,o(r(e,se.get("ABC2SVG_DURATION_FACTOR")),t._shortest_note).$round()].$min()},N.$$arity=1),e.defn(ie,"$_transform_staves",B=function(e,t,r){var n,a=this,o=u,s=u;return null==d.log&&(d.log=u),((n=a.score_statements)===u||null==n||n.$$is_boolean&&1!=n)&&(a.score_statements=[]),a.score_statements.$push(e),(n=i(a.score_statements.$length(),1))===u||null==n||n.$$is_boolean&&1!=n?u:(o=a.$charpos_to_line_column(e["$[]"]("istart")),s=a.$charpos_to_line_column(e["$[]"]("iend")),d.log.$error(se.get("I18n").$t("you have multiple %%score statements")+": "+a.score_statements.$length(),o,s))},B.$$arity=3),e.defn(ie,"$_transform_rest",R=function(t,n,a){var i,o,s,l,c=this,$=u,f=u,p=u,h=u,g=u,m=u,y=u,v=u,b=u,x=u,w=u;return null==d.conf&&(d.conf=u),$=c.$_parse_origin(t),i=[$["$[]"]("startChar"),$["$[]"]("endChar")],f=i[0],p=i[1],h=[c.pitch_providers["$[]"](_(0,n,!1)).$compact().$last(),c.pitch_providers["$[]"](_(n,-1,!1)).$compact().$first()],d.conf["$[]"]("restposition.default")["$=="]("previous")&&(h=[!1!==(i=h.$first())&&i!==u&&null!=i?i:h.$last()]),d.conf["$[]"]("restposition.default")["$=="]("next")&&(h=[!1!==(i=h.$last())&&i!==u&&null!=i?i:h.$first()]),g=c.$_parse_decorations(t),h=h.$compact(),(i=h["$empty?"]())===u||null==i||i.$$is_boolean&&1!=i?(h=(i=(o=h).$map,i.$$p=(s=function(e){s.$$s;return null==e&&(e=u),e["$[]"]("notes").$last()["$[]"]("midi")},s.$$s=c,s.$$arity=1,s),i).call(o),m=r(h.$inject("+"),h.$length()).$floor().$to_i()):m=60,(i=m["$nil?"]())===u||null==i||i.$$is_boolean&&1!=i||(c.$raise("undefined pitch"),m=60),c.$_transform_measure_start(t),y=c.$_convert_duration(t["$[]"]("dur")),l=c.$_parse_tuplet_info(t),i=e.to_ary(l),v=null==i[0]?u:i[0],b=null==i[1]?u:i[1],x=null==i[2]?u:i[2],w=se.get("Harpnotes").$$scope.get("Music").$$scope.get("Pause").$new(m,y),i=[c.measure_count],l=w,l["$measure_count="].apply(l,i),i[i.length-1],i=[g],l=w,l["$decorations="].apply(l,i),i[i.length-1],i=[c.$_transform_count_note(t)],l=w,l["$count_note="].apply(l,i),i[i.length-1],i=[c.$_mkznid(t)],l=w,l["$znid="].apply(l,i),i[i.length-1],i=[t["$[]"]("time")],l=w,l["$time="].apply(l,i),i[i.length-1],i=[c.$_parse_origin(t)],l=w,l["$origin="].apply(l,i),i[i.length-1],i=[c.$charpos_to_line_column(f)],l=w,l["$start_pos="].apply(l,i),i[i.length-1],i=[c.$charpos_to_line_column(p)],l=w,l["$end_pos="].apply(l,i),i[i.length-1],i=[c.variant_no],l=w,l["$variant="].apply(l,i),i[i.length-1],i=[v],l=w,l["$tuplet="].apply(l,i),i[i.length-1],i=[x],l=w,l["$tuplet_start="].apply(l,i),i[i.length-1],i=[b],l=w,l["$tuplet_end="].apply(l,i),i[i.length-1],(i=t["$[]"]("invis"))===u||null==i||i.$$is_boolean&&1!=i||(i=[!1],l=w,l["$visible="].apply(l,i),i[i.length-1]),(i=c.repetition_stack["$empty?"]())===u||null==i||i.$$is_boolean&&1!=i||c.repetition_stack["$<<"](w),w=[w],(i=c.next_note_marks["$[]"]("measure"))===u||null==i||i.$$is_boolean&&1!=i||(i=[!0],l=w.$first(),l["$measure_start="].apply(l,i),i[i.length-1],c.next_note_marks["$[]="]("measure",!1)),c.$_make_repeats_jumps_annotations(w,t,a),w},R.$$arity=3),e.defn(ie,"$_transform_tempo",j=function(e,r,n){var a=this,i=u,o=u;return null==d.log&&(d.log=u),e["$[]"]("istart")["$=="](a.meta_data["$[]"]("tempo")["$[]"]("sym")["$[]"]("istart"))?u:(i=a.$charpos_to_line_column(e["$[]"]("istart")),o=a.$charpos_to_line_column(e["$[]"]("iend")),d.log.$error(t("abc:"+i.$first()+":"+i.$last()+" Error: ",se.get("I18n").$t("tempo change not suported by zupfnoter")),i,o))},j.$$arity=3),e.defn(ie,"$_transform_yspace",F=function(e,t){return u},F.$$arity=2),e.defn(ie,"$_transform_bar_repeat_end",D=function(t,r,n){var a,o,s=this,l=u,c=u,$=u,f=u,h=u,_=u;return null==d.conf&&(d.conf=u),l=s.repetition_stack.$length(),c=l["$=="](1)?s.repetition_stack.$last():s.repetition_stack.$pop(),$=s.$_extract_goto_info_from_bar(t),f=function(){try{return $.$last()["$[]"]("distance")}catch(t){if(e.rescue(t,[se.get("StandardError")]))return[2];throw t}}(),(a=i(f.$count(),1))===u||null==a||a.$$is_boolean&&1!=a||s.$raise("too many distance values for repeat end. Need only one "+f),(a=s.previous_note["$is_a?"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("Pause")))===u||null==a||a.$$is_boolean&&1!=a||d.conf["$[]"]("restposition.repeatend")["$=="]("previous")&&(a=[s.previous_note.$prev_pitch()],o=s.previous_note,o["$pitch="].apply(o,a),a[a.length-1]),f=f.$first(),s.next_note_marks["$[]="]("first_in_part",!0),h=s.previous_note,_="notebound.c_jumplines."+n+"."+h.$znid()+".p_repeat",[se.get("Harpnotes").$$scope.get("Music").$$scope.get("Goto").$new(s.previous_note,c,p(["distance","is_repeat","level","conf_key"],{distance:f,is_repeat:!0,level:l,conf_key:_}))]},D.$$arity=3),e.defn(ie,"$_transform_grace",L=function(){return u},L.$$arity=0),e.defn(ie,"$_transform_format",z=function(e){return u},z.$$arity=1),e.defn(ie,"$_transform_key",q=function(e){return u},q.$$arity=1),e.defn(ie,"$_transform_meter",U=function(t){var r=this;return r.is_first_measure=!0,r.wmeasure=t["$[]"]("wmeasure"),r.countby=function(){try{return t["$[]"]("a_meter").$first()["$[]"]("bot").$to_i()}catch(t){if(e.rescue(t,[se.get("StandardError")]))return u;throw t}}(),u},U.$$arity=1),e.defn(ie,"$_transform_block",H=function(e){return u},H.$$arity=1),e.defn(ie,"$_transform_clef",G=function(e){return u},G.$$arity=1),e.defn(ie,"$_make_variant_ending_jumps",Y=function(e){var t,r,n,a=this,i=u,o=u;return i=[],o=function(){return(t=a.variant_endings.$last()["$empty?"]())===u||null==t||t.$$is_boolean&&1!=t?-1:-2}(),(t=(r=a.variant_endings["$[]"](_(0,o,!1))).$each,t.$$p=(n=function(t){var r,a,o,s,l,c=n.$$s||this,$=u,f=u,d=u,h=u,g=u;return null==t&&(t=u),$=t["$[]"](0)["$[]"]("distance"),f=t.$first()["$[]"]("rbstop"),d="notebound.c_jumplines."+e+"."+f.$znid(),h=(r=t["$[]"](-1)["$[]"]("is_followup"))===u||null==r||r.$$is_boolean&&1!=r?-1:-2,(r=(a=t["$[]"](_(1,h,!1))).$each_with_index,r.$$p=(o=function(e,r){var n=(o.$$s,u);return null==e&&(e=u),null==r&&(r=u),n=d+"."+r+".p_begin",i["$<<"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("Goto").$new(t["$[]"](0)["$[]"]("rbstop"),e["$[]"]("rbstart"),p(["conf_key","distance","from_anchor","to_anchor"],{conf_key:n,distance:$["$[]"](0),from_anchor:"after",to_anchor:"before"})))},o.$$s=c,o.$$arity=2,o),r).call(a),(r=(s=t["$[]"](_(1,-3,!1))).$each_with_index,r.$$p=(l=function(e,r){var n,a=(l.$$s,u);return null==e&&(e=u),null==r&&(r=u),(n=e["$[]"]("repeat_end"))===u||null==n||n.$$is_boolean&&1!=n?(a=d+".p_end",i["$<<"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("Goto").$new(e["$[]"]("rbstop"),t["$[]"](-1)["$[]"]("rbstart"),p(["conf_key","distance","from_anchor","to_anchor","vertical_anchor"],{conf_key:a,distance:$["$[]"](1),from_anchor:"after",to_anchor:"before",vertical_anchor:"to"})))):u},l.$$s=c,l.$$arity=2,l),r).call(s),(r=t["$[]"](-1)["$[]"]("is_followup"))===u||null==r||r.$$is_boolean&&1!=r?u:(g=d+".p_follow",i["$<<"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("Goto").$new(t["$[]"](-2)["$[]"]("rbstop"),t["$[]"](-1)["$[]"]("rbstart"),p(["conf_key","distance","from_anchor","to_anchor","vertical_anchor"],{conf_key:g,distance:$["$[]"](2),from_anchor:"after",to_anchor:"before",vertical_anchor:"to"}))))},n.$$s=a,n.$$arity=1,n),t).call(r),i},Y.$$arity=1),e.defn(ie,"$_make_jumplines",Q=function(e,t){var r,n,a,i=this,o=u;return(r=e["$is_a?"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable")))===u||null==r||r.$$is_boolean&&1!=r?u:(o=i.$_extract_goto_info_from_bar(e.$origin()["$[]"]("raw_voice_element")),(r=(n=o).$inject,r.$$p=(a=function(r,n){var i,o=a.$$s||this,s=u,l=u,c=u,$=u;return null==o.jumptargets&&(o.jumptargets=u),null==d.log&&(d.log=u),null==r&&(r=u),null==n&&(n=u),s=n["$[]"]("target"),l=o.jumptargets["$[]"](s),c="notebound.c_jumplines."+t+"."+e.$znid()+".p_goto",$=!1!==(i=n["$[]"]("distance").$first())&&i!==u&&null!=i?i:2,(i=l["$nil?"]())===u||null==i||i.$$is_boolean&&1!=i?r["$<<"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("Goto").$new(e,l,p(["conf_key","distance"],{conf_key:c,distance:$}))):d.log.$error("target '"+s+"' not found in voice at "+e.$start_pos_to_s(),e.$start_pos(),e.$end_pos()),r},a.$$s=i,a.$$arity=2,a),r).call(n,[]))},Q.$$arity=2),e.defn(ie,"$_make_notebound_annotations",V=function(e,t){var r,n,a,o=this,s=u,l=u;return s=[],(r=e["$is_a?"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable")))===u||null==r||r.$$is_boolean&&1!=r||(l=o.$_extract_chord_lines(e.$origin()["$[]"]("raw_voice_element")),(r=(n=l).$each_with_index,r.$$p=(a=function(r,n){var o,l,c,$,f,h,_,g,m=a.$$s||this,y=u,v=u,b=u,x=u,w=u,A=u,k=u,E=u,C=u,S=u;return null==m.annotations&&(m.annotations=u),null==d.log&&(d.log=u),null==d.conf&&(d.conf=u),null==r&&(r=u),null==n&&(n=u),y=r.$match(/^([!#\<\>])([^\@]+)?(\@(\-?[0-9\.]+),(\-?[0-9\.]+))?$/),!1!==y&&y!==u&&null!=y?(v=y["$[]"](1),b=y["$[]"](2),(o=y["$[]"](4))===u||null==o||o.$$is_boolean&&1!=o||(x=y["$[]"](4)),(o=y["$[]"](5))===u||null==o||o.$$is_boolean&&1!=o||(w=y["$[]"](5)),A=v,"#"["$==="](A)?!1!==(k=m.annotations["$[]"](b))&&k!==u&&null!=k||d.log.$error("could not find annotation "+b,e.$start_pos(),e.$end_pos()):"!"["$==="](A)?k=p(["text","style"],{text:b,style:"regular"}):"<"["$==="](A)?(o=[p(["dir","size","style"],{dir:-1,size:b,style:"regular"})],l=e,l["$shift="].apply(l,o),o[o.length-1],(o=e["$is_a?"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("SynchPoint")))===u||null==o||o.$$is_boolean&&1!=o||(o=(l=e.$notes()).$each,o.$$p=(c=function(e){var t,r;c.$$s;return null==e&&(e=u),t=[p(["dir","size","style"],{dir:-1,size:b,style:"regular"})],r=e,r["$shift="].apply(r,t),t[t.length-1]},c.$$s=m,c.$$arity=1,c),o).call(l)):">"["$==="](A)?(o=[p(["dir","size","style"],{dir:1,size:b,style:"regular"})],$=e,$["$shift="].apply($,o),o[o.length-1],(o=e["$is_a?"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("SynchPoint")))===u||null==o||o.$$is_boolean&&1!=o||(o=($=e.$notes()).$each,o.$$p=(f=function(e){var t,r;f.$$s;return null==e&&(e=u),t=[p(["dir","size","style"],{dir:1,size:b,style:"regular"})],r=e,r["$shift="].apply(r,t),t[t.length-1]},f.$$s=m,f.$$arity=1,f),o).call($)):k=u,!1!==k&&k!==u&&null!=k?(!1!==x&&x!==u&&null!=x&&(E=(o=(h=[x,w]).$map,o.$$p=(_=function(e){_.$$s;return null==e&&(e=u),e.$to_f()},_.$$s=m,_.$$arity=1,_),o).call(h)),C=!1!==(o=!1!==(g=E)&&g!==u&&null!=g?g:k["$[]"]("pos"))&&o!==u&&null!=o?o:d.conf["$[]"]("defaults.notebound.annotation.pos"),(o=e.$znid())===u||null==o||o.$$is_boolean&&1!=o||(S="notebound.annotation."+t+"."+e.$znid()),(o=i(n,0))===u||null==o||o.$$is_boolean&&1!=o||(S="notebound.annotation."+t+"."+e.$znid()+"."+n),s["$<<"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("NoteBoundAnnotation").$new(e,p(["style","pos","text"],{style:k["$[]"]("style"),pos:C,text:k["$[]"]("text")}),S))):u):u},a.$$s=o,a.$$arity=2,a),r).call(n)),s},V.$$arity=2),e.defn(ie,"$_make_repeats_jumps_annotations",X=function(e,t,r){var n,a,i,o,s,l,c=this,$=u,f=u,h=u,g=u,m=u,y=u,v=u;return null==d.conf&&(d.conf=u),$=e.$first(),f=c.part_table["$[]"](t["$[]"]("time")),(n=c.previous_note)===u||null==n||n.$$is_boolean&&1!=n||(n=[$.$pitch()],a=c.previous_note,a["$next_pitch="].apply(a,n),n[n.length-1],n=[$],a=c.previous_note,a["$next_playable="].apply(a,n),n[n.length-1],!1!==f&&f!==u&&null!=f&&(n=[!0],a=c.previous_note,a["$next_first_in_part="].apply(a,n),n[n.length-1]),n=[c.previous_note.$pitch()],a=$,a["$prev_pitch="].apply(a,n),n[n.length-1],n=[c.previous_note],a=$,a["$prev_playable="].apply(a,n),n[n.length-1]),c.previous_note=$,h=$.$znid(),!1!==f&&f!==u&&null!=f&&(!1!==h&&h!==u&&null!=h&&(g="notebound.partname."+r+"."+h),m=d.conf["$[]"]("defaults.notebound.partname.pos"),n=[!0],a=e.$first(),a["$first_in_part="].apply(a,n),n[n.length-1],e["$<<"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("NoteBoundAnnotation").$new(e.$first(),p(["style","pos","text"],{style:"regular",pos:m,text:f}),g))),(n=c.next_note_marks["$[]"]("repeat_start"))===u||null==n||n.$$is_boolean&&1!=n||(n=[!0],a=c.previous_note,a["$first_in_part="].apply(a,n),n[n.length-1],c.repetition_stack["$<<"](e.$first()),c.next_note_marks["$[]="]("repeat_start",!1)),(n=c.next_note_marks["$[]"]("first_in_part"))===u||null==n||n.$$is_boolean&&1!=n||(n=[!0],a=c.previous_note,a["$first_in_part="].apply(a,n),n[n.length-1],c.next_note_marks["$[]="]("first_in_part",!1)),(n=c.next_note_marks["$[]"]("variant_ending"))===u||null==n||n.$$is_boolean&&1!=n||(y=c.next_note_marks["$[]"]("variant_ending")["$[]"]("text"),!1!==h&&h!==u&&null!=h&&(g="notebound.variantend."+r+"."+h),m=d.conf["$[]"]("defaults.notebound.variantend.pos"),n=[!0],a=e.$first(),a["$first_in_part="].apply(a,n),n[n.length-1],e["$<<"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("NoteBoundAnnotation").$new(e.$first(),p(["style","pos","text","policy"],{style:"regular",pos:m,text:y,policy:"Goto"}),g)),c.next_note_marks["$[]="]("variant_ending",u),c.variant_endings.$last().$push(p([],{})),c.variant_endings.$last().$last()["$[]="]("rbstart",c.previous_note)),(n=c.next_note_marks["$[]"]("variant_followup"))===u||null==n||n.$$is_boolean&&1!=n||(n=[!0],a=c.previous_note,a["$first_in_part="].apply(a,n),n[n.length-1],c.variant_endings["$[]"](-2).$push(p(["rbstart","is_followup"],{rbstart:c.previous_note,is_followup:!0})),c.next_note_marks["$[]="]("variant_followup",!1)),v=c.$_extract_chord_lines(t),(n=(a=(o=(s=v).$select,o.$$p=(l=function(e){l.$$s;return null==e&&(e=u),e["$[]"](0)["$=="](":")},l.$$s=c,l.$$arity=1,l),o).call(s)).$each,n.$$p=(i=function(t){var r,n,a,o=i.$$s||this;return null==o.jumptargets&&(o.jumptargets=u),null==t&&(t=u),o.jumptargets["$[]="](t["$[]"](_(1,-1,!1)),(r=(n=e).$select,r.$$p=(a=function(e){a.$$s;return null==e&&(e=u),e["$is_a?"](se.get("Harpnotes").$$scope.get("Music").$$scope.get("Playable"))},a.$$s=o,a.$$arity=1,a),r).call(n).$last())},i.$$s=c,i.$$arity=1,i),n).call(a)},X.$$arity=3),e.defn(ie,"$_get_extra",W=function(t,r){var n,a,i,o,s=this;return function(){try{return n=t["$[]"]("extra"),!1!==n&&n!==u&&null!=n?(a=(i=t["$[]"]("extra")).$select,a.$$p=(o=function(e){o.$$s;return null==e&&(e=u),e["$[]"]("type").$to_s()["$=="](r.$to_s())},o.$$s=s,o.$$arity=1,o),a).call(i).$first():n}catch(t){if(e.rescue(t,[se.get("StandardError")]))return u;throw t}}()},W.$$arity=2),e.defn(ie,"$_push_slur",J=function(){var e=this;return e.slurstack=t(e.slurstack,1)},J.$$arity=0),e.defn(ie,"$_pop_slur",K=function(){var e,t=this,r=u;return r=t.slurstack,t.slurstack=a(t.slurstack,1),(e=s(t.slurstack,0))===u||null==e||e.$$is_boolean&&1!=e||(t.slurstack=0),r},K.$$arity=0),e.defn(ie,"$_extract_chord_lines",Z=function(e){var t,r,n,a,i,o,s=this,l=u;return l=e["$[]"]("a_gch"),!1!==l&&l!==u&&null!=l?(t=(r=(a=(i=l).$select,a.$$p=(o=function(e){o.$$s;return null==e&&(e=u),e["$[]="]("type","^")},o.$$s=s,o.$$arity=1,o),a).call(i)).$map,t.$$p=(n=function(e){n.$$s;return null==e&&(e=u),e["$[]"]("text")},n.$$s=s,n.$$arity=1,n),t).call(r):[]},Z.$$arity=1),e.defn(ie,"$_extract_goto_info_from_bar",ee=function(e){var t,r,n,a=this,i=u;return i=a.$_extract_chord_lines(e),(t=(r=i).$inject,t.$$p=(n=function(t,r){var a,i,o,s=n.$$s||this,l=u,c=u,$=u,f=u,h=u;return null==d.log&&(d.log=u),null==t&&(t=u),null==r&&(r=u),(a=r["$start_with?"]("@"))===u||null==a||a.$$is_boolean&&1!=a||(l=r.$match(/^^@([^\@]*)@(\-?\d*)(,(\-?\d*),(\-?\d*))?$/),!1!==l&&l!==u&&null!=l?(c=l["$[]"](1),$=(a=(i=[2,4,5]).$map,a.$$p=(o=function(e){var t;o.$$s;return null==e&&(e=u),(t=l["$[]"](e))===u||null==t||t.$$is_boolean&&1!=t?u:l["$[]"](e).$to_i()},o.$$s=s,o.$$arity=1,o),a).call(i).$compact(),t.$push(p(["target","distance"],{target:c,distance:$}))):(f=s.$charpos_to_line_column(e["$[]"]("istart")),h=s.$charpos_to_line_column(e["$[]"]("iend")),d.log.$error("Syntax-Error in Jump anotation",f,h))),t},n.$$s=a,n.$$arity=2,n),t).call(r,[])},ee.$$arity=1),e.defn(ie,"$_parse_decorations",te=function(e){var t,r,n,a,i,o=this,s=u,l=u;return s=!1!==(t=e["$[]"]("a_dd"))&&t!==u&&null!=t?t:[],l=(t=(r=s).$map,t.$$p=(n=function(e){n.$$s;return null==e&&(e=u),l=e["$[]"]("name").$to_sym()},n.$$s=o,n.$$arity=1,n),t).call(r),(t=(a=l.$flatten()).$select,t.$$p=(i=function(e){i.$$s;return null==e&&(e=u),["fermata","emphasis"]["$include?"](e)},i.$$s=o,i.$$arity=1,i),t).call(a)},te.$$arity=1),e.defn(ie,"$_parse_origin",re=function(e){return p(["startChar","endChar","start_pos","end_pos","raw_voice_element"],{startChar:e["$[]"]("istart"),endChar:e["$[]"]("iend"),start_pos:e["$[]"]("start_pos"),end_pos:e["$[]"]("end_pos"),raw_voice_element:e})},re.$$arity=1),e.defn(ie,"$_parse_slur",ne=function(e){var t,r,n=u,a=u;for(n=!1!==(t=e)&&t!==u&&null!=t?t:0,a=[];(r=i(n,0))!==u&&null!=r&&(!r.$$is_boolean||1==r);)a.$push(n["$&"](15)),n=n["$>>"](4);return a},ne.$$arity=1),e.defn(ie,"$_parse_tuplet_info",ae=function(e){var r,n=this,a=u,i=u,o=u,s=u,l=u;return null==d.log&&(d.log=u),(r=e["$[]"]("in_tuplet"))===u||null==r||r.$$is_boolean&&1!=r?(s=1,o=u,l=u):((r=e["$[]"]("tp1"))===u||null==r||r.$$is_boolean&&1!=r||(a=n.$charpos_to_line_column(e["$[]"]("istart")),i=n.$charpos_to_line_column(e["$[]"]("iend")),d.log.$error(t("abc:"+a.$first()+":"+a.$last()+" Error: ",se.get("I18n").$t("Nested Tuplet")),a,i)),(r=e["$[]"]("tp0"))===u||null==r||r.$$is_boolean&&1!=r?o=u:(n.tuplet_p=e["$[]"]("tp0"),o=!0),s=n.tuplet_p,l=!((r=e["$[]"]("te0"))===u||null==r||r.$$is_boolean&&1!=r)||u),[s,l,o]},ae.$$arity=1)}(m.base,m.get("AbstractAbcToHarpnotes"))}(m.base)}(c.base)},Opal.modules["opal-jspdf"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}var i=e.top,o=e,s=e.nil,l=(e.breaker,e.slice,e.klass);return e.add_stubs(["$require","$attr_accessor","$apply_offset_to_point","$[]","$nil?","$start_with?","$raise","$map","$*","$-","$==","$+","$/","$private","$first","$last"]),i.$require("native"),jsPDF.API.setLineDash=function(e,t){return void 0==e?this.internal.write("[] 0 d"):this.internal.write("["+e+"] "+t+" d"),this},function(i,o){function c(){}var u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T=c=l(i,null,"JsPDF",c),P=T.$$proto;T.$$scope;return P.native_jspdf=P.x_offset=P.y_offset=s,T.$attr_accessor("x_offset","y_offset"),e.defn(T,"$initialize",u=function(e,t,r){var n=this;return null==e&&(e="p"),null==t&&(t="mm"),null==r&&(r="a4"),n.x_offset=0,n.y_offset=0,n.native_jspdf=new jsPDF(e,t,r)},u.$$arity=-1),e.defn(T,"$line",$=function(e,t){var r=this,n=s,a=s;return n=r.$apply_offset_to_point(e),a=r.$apply_offset_to_point(t),r.native_jspdf.lines([[a[0]-n[0],a[1]-n[1]]],n[0],n[1])},$.$$arity=2),e.defn(T,"$line_cap=",f=function(e){return this.native_jspdf.setLineCap(e)},f.$$arity=1),e.defn(T,"$ellipse",p=function(e,t,r){var n=this,a=s;return null==r&&(r=void 0),a=n.$apply_offset_to_point(e),n.native_jspdf.ellipse(a["$[]"](0),a["$[]"](1),t["$[]"](0),t["$[]"](1),r)},p.$$arity=-3),e.defn(T,"$fill=",d=function(e){return this.native_jspdf.setFillColor(e[0],e[1],e[2])},d.$$arity=1),e.defn(T,"$stroke=",h=function(e){return this.native_jspdf.setDrawColor(e[0],e[1],e[2])},h.$$arity=1),e.defn(T,"$line_width=",_=function(e){return this.native_jspdf.setLineWidth(e)},_.$$arity=1),e.defn(T,"$line_dash=",g=function(e){var t,r=this;return null==e&&(e=3),(t=e["$nil?"]())===s||null==t||t.$$is_boolean&&1!=t||(e=void 0),r.native_jspdf.setLineDash(e,e)},g.$$arity=-1),e.defn(T,"$text_color=",m=function(e){return this.native_jspdf.setTextColor(e[0],e[1],e[2])},m.$$arity=1),e.defn(T,"$font_size=",y=function(e){return this.native_jspdf.setFontSize(e)},y.$$arity=1),e.defn(T,"$font_style=",v=function(e){return this.native_jspdf.setFontStyle(e)},v.$$arity=1),e.defn(T,"$use_solid_lines",b=function(){return this.native_jspdf.setLineDash("",0)},b.$$arity=0),e.defn(T,"$image",x=function(t,r,n,a){var i,o,l=this,c=s,u=s,$=s;return o=l.$apply_offset_to_point([r,n]),i=e.to_ary(o),c=null==i[0]?s:i[0],u=null==i[1]?s:i[1],$=s,(i=t["$start_with?"]("data:image/jpeg"))===s||null==i||i.$$is_boolean&&1!=i||($="jpeg"),(i=t["$start_with?"]("data:image/png"))===s||null==i||i.$$is_boolean&&1!=i||($="png"),!1!==$&&$!==s&&null!=$?l.native_jspdf.addImage(t,$,c,u,0,a):l.$raise("image format not supported for pdf: "+$)},x.$$arity=4),e.defn(T,"$text",w=function(t,r,n,a){var i,o,l=this,c=s,u=s;return null==a&&(a=s),o=l.$apply_offset_to_point([t,r]),i=e.to_ary(o),c=null==i[0]?s:i[0],u=null==i[1]?s:i[1],l.native_jspdf.text(c,u,n,a)},w.$$arity=-4),e.defn(T,"$rect_like_ellipse",A=function(e,n,a){var i,o,l,c=this,u=s,$=s;return null==a&&(a="undefined"),u=c.$apply_offset_to_point(e),$=(i=(o=n).$map,i.$$p=(l=function(e){l.$$s;return null==e&&(e=s),t(2,e)},l.$$s=c,l.$$arity=1,l),i).call(o),c.native_jspdf.rect(r(u["$[]"](0),n["$[]"](0)),r(u["$[]"](1),n["$[]"](1)),$["$[]"](0),$["$[]"](1),a)},A.$$arity=-3),e.defn(T,"$rect",k=function(t,r,n,a,i){var o,l,c=this,u=s,$=s;return null==i&&(i="undefined"),l=c.$apply_offset_to_point([t,r]),o=e.to_ary(l),u=null==o[0]?s:o[0],$=null==o[1]?s:o[1],c.native_jspdf.rect(u,$,n,a,i)},k.$$arity=-5),e.defn(T,"$lines",E=function(t,r,n,a,i,o){var l,c,u=this,$=s,f=s;return c=u.$apply_offset_to_point([r,n]),l=e.to_ary(c),$=null==l[0]?s:l[0],f=null==l[1]?s:l[1],u.native_jspdf.lines(t,$,f,a,i,o)},E.$$arity=6),e.defn(T,"$output",C=function(e,t){var r,n=this;return null==e&&(e="raw"),null==t&&(t=s),e["$=="]("raw")&&(e=void 0),(r=t["$nil?"]())===s||null==r||r.$$is_boolean&&1!=r||(t=void 0),n.native_jspdf.output(e,t)},C.$$arity=-1),e.defn(T,"$left_arrowhead",S=function(t,i){var o,l,c=this,u=s,$=s,f=s,p=s,d=s,h=s,_=s;return u=1,l=c.$apply_offset_to_point([t,i]),o=e.to_ary(l),$=null==o[0]?s:o[0],f=null==o[1]?s:o[1],p=$,d=n($,u),h=n(f,a(u,2)),_=r(f,a(u,2)),c.native_jspdf.triangle(p,f,d,h,d,_,p,f,"FD")},S.$$arity=2),e.defn(T,"$addPage",I=function(){return this.native_jspdf.addPage()},I.$$arity=0),T.$private(),e.defn(T,"$apply_offset_to_point",O=function(e){var t=this;return[n(e.$first(),t.x_offset),n(e.$last(),t.y_offset)]},O.$$arity=1),s&&"apply_offset_to_point"}(o.base)},Opal.modules["opal-jszip"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.module),a=e.klass;return e.add_stubs(["$new","$to_blob"]),function(t){var i,o=i=n(t,"JSZip"),s=(o.$$proto,o.$$scope);!function(t,n){function i(){}var o,s,l,c,u,$,f=i=a(t,null,"ZipFile",i),p=(f.$$proto,f.$$scope);e.defn(f,"$initialize",o=function(){return this.zip=new JSZip},o.$$arity=0),e.defn(f,"$folder",s=function(e){var t=this;return p.get("Folder").$new(t.zip.folder(e))},s.$$arity=1),e.defn(f,"$file",l=function(e,t){return this.zip.file(e,t)},l.$$arity=2),e.defn(f,"$to_blob",c=function(){return this.zip.generate({type:"blob"})},c.$$arity=0),e.defn(f,"$to_blob_url",u=function(){var e=this,t=r;return t=e.$to_blob(),window.URL.createObjectURL(t)},u.$$arity=0),e.defn(f,"$to_base64",$=function(){return this.zip.generate()},$.$$arity=0)}(s.base),function(t,r){function n(){}var i,o,s=n=a(t,null,"Folder",n);s.$$proto,s.$$scope;e.defn(s,"$initialize",i=function(e){return this.folder=e},i.$$arity=1),e.defn(s,"$file",o=function(e,t){return this.folder.file(e,t)},o.$$arity=2)}(s.base)}(t.base)},Opal.modules.pdf_engine=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}var i=e.top,o=e,s=e.nil,l=(e.breaker,e.slice,e.module),c=e.klass,u=e.hash2,$=e.gvars,f=e.range;return e.add_stubs(["$require","$include","$attr_reader","$new","$*","$[]","$y_offset=","$last","$printer_config","$each","$draw_segment","$+","$first","$x_offset=","$draw_sheet","$addPage","$rect","$line_width=","$line_width","$is_a?","$visible?","$draw_ellipse","$draw_flowline","$draw_glyph","$draw_path","$draw_annotation","$draw_image","$error","$class","$children","$private","$get","$style","$text_color=","$font_size=","$font_style=","$gsub","$==","$text","$center","$color","$filled?","$size","$stroke=","$fill=","$rect?","$rect_like_ellipse","$ellipse","$fill","$map","$-","$/","$dotted?","$draw_the_dot","$hasbarover","$draw_the_barover","$glyph","$===","$empty?","$lines","$push","$hasbarover?","$dashed?","$line_dash=","$line","$from","$to","$use_solid_lines","$clone","$[]=","$distance","$nil?","$level","$left_arrowhead","$Vector2d","$llpos","$height","$image","$url","$x","$y","$opacity","$line_cap=","$inject","$flatten","$path"]),i.$require("opal-jspdf"),i.$require("harpnotes"),function(i){var o,p=o=l(i,"Harpnotes"),d=(p.$$proto,p.$$scope);!function(i,o){function l(){}var p,d,h,_,g,m,y,v,b,x,w,A,k,E,C=l=c(i,null,"PDFEngine",l),S=C.$$proto,I=C.$$scope;S.pdf=s,C.$include(I.get("Harpnotes").$$scope.get("Drawing")),C.$attr_reader("pdf"),e.cdecl(I,"PADDING",4),e.cdecl(I,"JUMPLINE_INDENT",10),e.cdecl(I,"DOTTED_SIZE",.5),e.cdecl(I,"COLORS",u(["black","white","grey","lightgrey","darkgrey","dimgrey"],{black:[0,0,0],white:[255,255,255],grey:[128,128,128],lightgrey:[211,211,211],darkgrey:[169,169,169],dimgrey:[105,105,105]})),e.defn(C,"$initialize",p=function(){return this.pdf=I.get("JsPDF").$new("l","mm","a3")},p.$$arity=0),e.defn(C,"$draw_in_segments",d=function(e){var n,a,i,o=this,l=s,c=s,u=s;return null==$.conf&&($.conf=s),l=t(-12,$.conf["$[]"]("layout.X_SPACING")),o.pdf=I.get("JsPDF").$new("p","mm","a4"),n=[e.$printer_config()["$[]"]("a4_offset").$last()],a=o.pdf,a["$y_offset="].apply(a,n),n[n.length-1],c=!1,u=!1!==(n=e.$printer_config()["$[]"]("a4_pages"))&&n!==s&&null!=n?n:[0,1,2],(n=(a=u).$each,n.$$p=(i=function(n){var a=i.$$s||this;return null==n&&(n=s),a.$draw_segment(r(r(30,e.$printer_config()["$[]"]("a4_offset").$first()),t(n,l)),e,c),c=!0},i.$$s=o,i.$$arity=1,i),n).call(a),o.pdf},d.$$arity=1),e.defn(C,"$draw",h=function(t){var r,n,a=this
;return n=t.$printer_config()["$[]"]("a3_offset"),r=e.to_ary(n),a.pdf["$x_offset="](null==r[0]?s:r[0]),a.pdf["$y_offset="](null==r[1]?s:r[1]),a.$draw_sheet(t)},h.$$arity=1),e.defn(C,"$draw_segment",_=function(e,t,r){var n,a,i=this;return null==r&&(r=!1),n=[e],a=i.pdf,a["$x_offset="].apply(a,n),n[n.length-1],!1!==r&&r!==s&&null!=r&&i.pdf.$addPage(),i.$draw_sheet(t)},_.$$arity=-3),e.defn(C,"$draw_sheet",g=function(e){var t,r,n,a=this;return(t=e.$printer_config()["$[]"]("show_border"))===s||null==t||t.$$is_boolean&&1!=t||(a.pdf.$rect(1,1,418,295),a.pdf.$rect(0,0,420,297)),(t=(r=e.$children()).$each,t.$$p=(n=function(e){var t,r,a=n.$$s||this;return null==a.pdf&&(a.pdf=s),null==$.log&&($.log=s),null==e&&(e=s),t=[e.$line_width()],r=a.pdf,r["$line_width="].apply(r,t),t[t.length-1],(t=e["$is_a?"](I.get("Ellipse")))===s||null==t||t.$$is_boolean&&1!=t?(t=e["$is_a?"](I.get("FlowLine")))===s||null==t||t.$$is_boolean&&1!=t?(t=e["$is_a?"](I.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Glyph")))===s||null==t||t.$$is_boolean&&1!=t?(t=e["$is_a?"](I.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Path")))===s||null==t||t.$$is_boolean&&1!=t?(t=e["$is_a?"](I.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Annotation")))===s||null==t||t.$$is_boolean&&1!=t?(t=e["$is_a?"](I.get("Harpnotes").$$scope.get("Drawing").$$scope.get("Image")))===s||null==t||t.$$is_boolean&&1!=t?($.log.$error("BUG: don't know how to draw "+e.$class()+" (pdf_engine 73)"),s):a.$draw_image(e):(t=e["$visible?"]())===s||null==t||t.$$is_boolean&&1!=t?s:a.$draw_annotation(e):(t=e["$visible?"]())===s||null==t||t.$$is_boolean&&1!=t?s:a.$draw_path(e):(t=e["$visible?"]())===s||null==t||t.$$is_boolean&&1!=t?s:a.$draw_glyph(e):(t=e["$visible?"]())===s||null==t||t.$$is_boolean&&1!=t?s:a.$draw_flowline(e):(t=e["$visible?"]())===s||null==t||t.$$is_boolean&&1!=t?s:a.$draw_ellipse(e)},n.$$s=a,n.$$arity=1,n),t).call(r),a.pdf},g.$$arity=1),C.$private(),e.defn(C,"$draw_annotation",m=function(e){var n,a,i,o=this,l=s,c=s,u=s;return null==$.conf&&($.conf=s),l=!1!==(n=$.conf.$get("layout.FONT_STYLE_DEF")["$[]"](e.$style()))&&n!==s&&null!=n?n:$.conf.$get("layout.FONT_STYLE_DEF")["$[]"]("regular"),c=$.conf.$get("layout.MM_PER_POINT"),n=[l["$[]"]("text_color")],a=o.pdf,a["$text_color="].apply(a,n),n[n.length-1],n=[l["$[]"]("font_size")],a=o.pdf,a["$font_size="].apply(a,n),n[n.length-1],n=[l["$[]"]("font_style")],a=o.pdf,a["$font_style="].apply(a,n),n[n.length-1],u=(n=(a=e.$text()).$gsub,n.$$p=(i=function(e){i.$$s;return null==e&&(e=s),e["$[]"](0)["$=="]("\\")?e["$[]"](1):" "},i.$$s=o,i.$$arity=1,i),n).call(a,/(\\?)(~)/),o.pdf.$text(e.$center().$first(),r(e.$center().$last(),t(l["$[]"]("font_size"),c)),u)},m.$$arity=1),e.defn(C,"$draw_ellipse",y=function(e){var t,r,i,o,l=this,c=s,u=s,$=s;return c=I.get("COLORS")["$[]"](e.$color()),u=function(){return(t=e["$filled?"]())===s||null==t||t.$$is_boolean&&1!=t?"FD":"F"}(),$=e.$size(),t=[0],r=l.pdf,r["$line_width="].apply(r,t),t[t.length-1],t=[c],r=l.pdf,r["$stroke="].apply(r,t),t[t.length-1],t=[function(){return(i=e["$filled?"]())===s||null==i||i.$$is_boolean&&1!=i?I.get("COLORS")["$[]"]("white"):c}()],r=l.pdf,r["$fill="].apply(r,t),t[t.length-1],(t=e["$rect?"]())===s||null==t||t.$$is_boolean&&1!=t?l.pdf.$ellipse(e.$center(),$,u):l.pdf.$rect_like_ellipse(e.$center(),$,u),e.$fill()["$=="]("filled")||(t=[e.$line_width()],r=l.pdf,r["$line_width="].apply(r,t),t[t.length-1],$=(t=(r=$).$map,t.$$p=(o=function(t){o.$$s;return null==t&&(t=s),n(t,a(e.$line_width(),2))},o.$$s=l,o.$$arity=1,o),t).call(r),(t=e["$rect?"]())===s||null==t||t.$$is_boolean&&1!=t?l.pdf.$ellipse(e.$center(),$,u):l.pdf.$rect_like_ellipse(e.$center(),$,u)),(t=e["$dotted?"]())===s||null==t||t.$$is_boolean&&1!=t||l.$draw_the_dot(e),(t=e.$hasbarover())===s||null==t||t.$$is_boolean&&1!=t||l.$draw_the_barover(e),t=[I.get("COLORS")["$[]"]("black")],i=l.pdf,i["$stroke="].apply(i,t),t[t.length-1],t=[I.get("COLORS")["$[]"]("black")],i=l.pdf,i["$fill="].apply(i,t),t[t.length-1]},y.$$arity=1),e.defn(C,"$draw_glyph",v=function(e){var i,o,l,c,u,p,d,h,_=this,g=s,m=s,y=s,v=s,b=s,x=s,w=s;return e["$filled?"]("FD","FD"),i=[(l=(c=f(0,3,!0)).$map,l.$$p=(u=function(){var t;u.$$s;return(t=e["$filled?"]())===s||null==t||t.$$is_boolean&&1!=t?128:0},u.$$s=_,u.$$arity=0,u),l).call(c)],o=_.pdf,o["$fill="].apply(o,i),i[i.length-1],g=[n(e.$center().$first(),e.$size().$first()),n(e.$center().$last(),e.$size().$last())],g=[e.$center().$first(),e.$center().$last()],m=[t(e.$size().$first(),2),t(e.$size().$last(),2)],y=a(m.$last(),e.$glyph()["$[]"]("h")),[e.$glyph()["$[]"]("w"),e.$glyph()["$[]"]("h")],(i=(o=[e.$glyph()["$[]"]("w"),e.$glyph()["$[]"]("h")]).$map,i.$$p=(p=function(e){p.$$s;return null==e&&(e=s),t(a(e,2),y)},p.$$s=_,p.$$arity=1,p),i).call(o),v=I.get("COLORS")["$[]"]("white"),i=[v],l=_.pdf,l["$fill="].apply(l,i),i[i.length-1],i=[v],l=_.pdf,l["$stroke="].apply(l,i),i[i.length-1],_.pdf.$rect_like_ellipse(e.$center(),e.$size(),"FD"),v=I.get("COLORS")["$[]"](e.$color()),i=[v],l=_.pdf,l["$fill="].apply(l,i),i[i.length-1],i=[v],l=_.pdf,l["$stroke="].apply(l,i),i[i.length-1],b=[y,y],x=[],w=[],i=[1e-4],l=_.pdf,l["$line_width="].apply(l,i),i[i.length-1],(i=(l=e.$glyph()["$[]"]("d")).$each,i.$$p=(d=function(e){var n,a=d.$$s||this,i=s;return null==a.pdf&&(a.pdf=s),null==$.log&&($.log=s),null==e&&(e=s),function(){return i=e.$first(),"M"["$==="](i)?(x=[],w=[r(g.$first(),t(e["$[]"](1),b.$first())),r(g.$last(),t(e["$[]"](2),b.$last()))],(n=x["$empty?"]())===s||null==n||n.$$is_boolean&&1!=n?a.pdf.$lines(x,w.$first(),w.$last(),b,"FD",!1):s):"l"["$==="](i)?x.$push(e["$[]"](f(1,-1,!1))):"m"["$==="](i)?x.$push(e["$[]"](f(1,-1,!1))):"c"["$==="](i)?x.$push(e["$[]"](f(1,-1,!1))):"z"["$==="](i)?(((n=x["$empty?"]())===s||null==n||n.$$is_boolean&&1!=n)&&a.pdf.$lines(x,w.$first(),w.$last(),b,"FD",!0),x=[]):$.log.$error("BUG: unsupported Pdf Path command '"+e.$first()+"' in glyph (pdf_engine 191)")}()},d.$$s=_,d.$$arity=1,d),i).call(l),i=[[0,0,0]],h=_.pdf,h["$stroke="].apply(h,i),i[i.length-1],(i=e["$dotted?"]())===s||null==i||i.$$is_boolean&&1!=i||_.$draw_the_dot(e),(i=e["$hasbarover?"]())===s||null==i||i.$$is_boolean&&1!=i?s:_.$draw_the_barover(e)},v.$$arity=1),e.defn(C,"$draw_the_dot",b=function(e){var t,n,a=this,i=s,o=s,l=s,c=s,u=s;return i=I.get("COLORS")["$[]"](e.$color()),o=r(I.get("DOTTED_SIZE"),e.$line_width()),l=r(I.get("DOTTED_SIZE"),e.$line_width()),c=r(e.$center().$first(),r(e.$size().$first(),o)),u=e.$center().$last(),t=[0],n=a.pdf,n["$line_width="].apply(n,t),t[t.length-1],t=[[255,255,255]],n=a.pdf,n["$fill="].apply(n,t),t[t.length-1],t=[[255,255,255]],n=a.pdf,n["$stroke="].apply(n,t),t[t.length-1],a.pdf.$ellipse([c,u],[l,l],"FD"),t=[i],n=a.pdf,n["$fill="].apply(n,t),t[t.length-1],t=[i],n=a.pdf,n["$stroke="].apply(n,t),t[t.length-1],a.pdf.$ellipse([c,u],[I.get("DOTTED_SIZE"),I.get("DOTTED_SIZE")],"FD")},b.$$arity=1),e.defn(C,"$draw_the_barover",x=function(e){var r,a,i=this,o=s,l=s;return r=[I.get("COLORS")["$[]"](e.$color())],a=i.pdf,a["$fill="].apply(a,r),r[r.length-1],o=[e.$center().$first(),n(n(e.$center().$last(),e.$size().$last()),t(1.3,e.$line_width()))],l=[e.$size().$first(),.2],i.pdf.$rect_like_ellipse(o,l,"F")},x.$$arity=1),e.defn(C,"$draw_flowline",w=function(e){var t,r,n=this,a=s;return a=I.get("COLORS")["$[]"](e.$color()),t=[a],r=n.pdf,r["$stroke="].apply(r,t),t[t.length-1],(t=e["$dashed?"]())===s||null==t||t.$$is_boolean&&1!=t||(t=[3],r=n.pdf,r["$line_dash="].apply(r,t),t[t.length-1]),(t=e["$dotted?"]())===s||null==t||t.$$is_boolean&&1!=t||(t=[6],r=n.pdf,r["$line_dash="].apply(r,t),t[t.length-1]),n.pdf.$line(e.$from().$center(),e.$to().$center()),n.pdf.$use_solid_lines()},w.$$arity=1),e.defn(C,"$draw_jumpline",A=function(e){var i,o,l,c,u,$=this,p=s,d=s,h=s,_=s;return p=e.$from().$center().$clone(),i=0,o=p,o["$[]="](i,r(o["$[]"](i),I.get("PADDING"))),i=1,o=p,o["$[]="](i,n(o["$[]"](i),a(I.get("PADDING"),4))),d=e.$to().$center().$clone(),i=0,o=d,o["$[]="](i,r(o["$[]"](i),I.get("PADDING"))),i=1,o=d,o["$[]="](i,r(o["$[]"](i),a(I.get("PADDING"),4))),h=e.$distance(),_=(i=h["$nil?"]())===s||null==i||i.$$is_boolean&&1!=i?r(d["$[]"](0),h):n(418,t(e.$level(),I.get("JUMPLINE_INDENT"))),i=[(l=(c=f(0,3,!0)).$map,l.$$p=(u=function(){u.$$s;return 0},u.$$s=$,u.$$arity=0,u),l).call(c)],o=$.pdf,o["$stroke="].apply(o,i),i[i.length-1],$.pdf.$line(d,[_,d["$[]"](1)]),$.pdf.$line([_,d["$[]"](1)],[_,p["$[]"](1)]),$.pdf.$line([_,p["$[]"](1)],p),$.pdf.$left_arrowhead(p["$[]"](0),p["$[]"](1))},A.$$arity=1),e.defn(C,"$draw_image",k=function(e){var t=this,n=s;return n=r(r(t.$Vector2d([0,0]),e.$llpos()),[0,e.$height()]),t.pdf.$image(e.$url(),n.$x(),n.$y(),e.$height(),e.$opacity())},k.$$arity=1),e.defn(C,"$draw_path",E=function(e){var t,a,i,o,l=this,c=s,u=s,p=s,d=s,h=s;return c=[],u=[1,1],p=[],d=function(){return(t=e["$filled?"]())===s||null==t||t.$$is_boolean&&1!=t?"":"FD"}(),h=I.get("COLORS")["$[]"](e.$color()),t=[function(){return(i=e["$filled?"]())===s||null==i||i.$$is_boolean&&1!=i?I.get("COLORS")["$[]"]("white"):h}()],a=l.pdf,a["$fill="].apply(a,t),t[t.length-1],t=[h],a=l.pdf,a["$stroke="].apply(a,t),t[t.length-1],t=["round"],a=l.pdf,a["$line_cap="].apply(a,t),t[t.length-1],(t=(a=e.$path()).$each,t.$$p=(o=function(e){var t,a,i,l=o.$$s||this,h=s,_=s;return null==l.pdf&&(l.pdf=s),null==$.log&&($.log=s),null==e&&(e=s),function(){return h=e.$first(),"M"["$==="](h)?(((t=c["$empty?"]())===s||null==t||t.$$is_boolean&&1!=t)&&l.pdf.$lines(c,p.$first(),p.$last(),u,d,!1),c=[],p=e["$[]"](f(1,2,!1))):"L"["$==="](h)?(_=(t=(a=[[p],c].$flatten(1)).$inject,t.$$p=(i=function(e,t){i.$$s;return null==e&&(e=s),null==t&&(t=s),[r(t["$[]"](0),e["$[]"](-2)),r(t["$[]"](1),e["$[]"](-1))]},i.$$s=l,i.$$arity=2,i),t).call(a,[0,0]),((t=c["$empty?"]())===s||null==t||t.$$is_boolean&&1!=t)&&l.pdf.$lines(c,p.$first(),p.$last(),u,d,!1),c=[],p=_,c.$push([n(e["$[]"](1),_.$first()),n(e["$[]"](2),_.$last())])):"l"["$==="](h)?c.$push(e["$[]"](f(1,-1,!1))):"c"["$==="](h)?c.$push(e["$[]"](f(1,-1,!1))):"z"["$==="](h)?(((t=c["$empty?"]())===s||null==t||t.$$is_boolean&&1!=t)&&l.pdf.$lines(c,p.$first(),p.$last(),u,"FD",!0),c=[]):$.log.$error("BUG: unsupported command '"+e.$first()+"' in glyph (pdf_engine 323)")}()},o.$$s=l,o.$$arity=1,o),t).call(a),(t=c["$empty?"]())===s||null==t||t.$$is_boolean&&1!=t?l.pdf.$lines(c,p.$first(),p.$last(),u,d,!1):s},E.$$arity=1)}(d.base)}(o.base)},Opal.modules.init_conf=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var r=(e.top,e),n=e.nil,a=(e.breaker,e.slice,e.module),i=e.hash2,o=e.gvars,s=e.range;return e.add_stubs(["$join","$map","$between?","$each_with_index","$split","$lambda","$[]","$get","$cut_string_names","$year","$now","$t","$first","$+","$last","$to_a"]),function(r){var l,c,u,$=l=a(r,"InitConf"),f=($.$$proto,$.$$scope);e.defs($,"$cut_string_names",c=function(e,t,r){var a,i,o,s=this;return(a=(i=e.$split(" ").$each_with_index()).$map,a.$$p=(o=function(e,a){var i;o.$$s;return null==e&&(e=n),null==a&&(a=n),(i=a["$between?"](t,r))===n||null==i||i.$$is_boolean&&1!=i?"~":e},o.$$s=s,o.$$arity=2,o),a).call(i).$join(" ")},c.$$arity=3),e.defs($,"$init_conf",u=function(){var e,r,a,l,c,u,$,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne,ae,ie,oe,se,le,ce,ue,$e,fe,pe,de,he,_e,ge=this,me=n;return me=["produce","annotations","restposition","default","repeatstart","repeatend","extract","title","filenamepart","startpos","voices","flowlines","subflowlines","synchlines","jumplines","repeatsigns","layoutlines","barnumbers","countnotes","legend","nonflowrest","lyrics","notes","images","tuplets","layout","printer","annotation","decoration","partname","variantend","countnote","c_jumplines","tuplet","minc","flowline","imagename","stringnames","limit_a3","LINE_THIN","LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","DRAWING_AREA_SIZE","instrument","bottomup","beams","packer","pack_method","pack_max_spreadfactor","pack_min_increment","sortmark","show","fill","size","PITCH_OFFSET","X_OFFSET","X_SPACING","jumpline_anchor","a3_offset","a4_offset","a4_pages","T01_number","T01_number_extract","T02_copyright_music","T03_copyright_harpnotes","T04_to_order","T05_printed_extracts","T99_do_not_copy","0","1","2","3","4","5","6","verses","cp1","cp2","shape","pos","hpos","height","vpos","spos","autopos","apbase","text","style","marks","resources","d64","d48","d32","d24","d16","d12","d8","d6","d4","d3","d2","d1"],i(["produce","abc_parser","restposition","template","wrap","defaults","templates","presets","annotations","extract","layout","neatjson"],{produce:[0],abc_parser:"ABC2SVG",restposition:i(["default","repeatstart","repeatend"],{default:"center",repeatstart:"next",repeatend:"default"}),template:i(["filebase","title"],{filebase:"-no-template-",title:"- no template -"}),wrap:60,defaults:i(["notebound"],{notebound:i(["annotation","partname","variantend","tuplet","flowline"],{annotation:i(["pos"],{pos:[5,-7]}),partname:i(["pos"],{pos:[-4,-7]}),variantend:i(["pos"],{pos:[-4,-7]}),tuplet:i(["cp1","cp2","shape","show"],{cp1:[5,2],cp2:[5,-2],shape:["c"],show:!0}),flowline:i(["cp1","cp2","shape","show"],{cp1:[0,10],cp2:[0,-10],shape:["c"],show:!0})})}),templates:i(["notes","lyrics","images","tuplet","annotations"],{notes:i(["pos","text","style"],{pos:[320,6],text:"ENTER_NOTE",style:"large"}),lyrics:i(["verses","pos","style"],{verses:[1],pos:[350,70],style:"regular"}),images:i(["imagename","show","pos","height"],{imagename:"",show:!0,pos:[10,10],height:100}),tuplet:i(["cp1","cp2","shape","show"],{cp1:[5,2],cp2:[5,-2],shape:["c"],show:!0}),annotations:i(["text","pos"],{text:"_vorlage_",pos:[-5,-6]})}),presets:i(["stdextract","layout","instrument","notes","printer"],{stdextract:i([],{}),layout:i(["notes_small","notes_regular","notes_large","notes_with_beams","-","packer_compact","packer_regular","--","color_on","color_off","---","jumpline_anchor_close","jumpline_anchor_medium","jumpline_anchor_wide"],{notes_small:i(["LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","beams"],{LINE_MEDIUM:.2,LINE_THICK:.3,ELLIPSE_SIZE:[3.5,1.3],REST_SIZE:[4,1.5],beams:!1}),notes_regular:i(["LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","beams"],{LINE_MEDIUM:(e=(r=ge).$lambda,e.$$p=(a=function(){a.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.LINE_MEDIUM")},a.$$s=ge,a.$$arity=0,a),e).call(r),LINE_THICK:(e=(l=ge).$lambda,e.$$p=(c=function(){c.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.LINE_THICK")},c.$$s=ge,c.$$arity=0,c),e).call(l),ELLIPSE_SIZE:(e=(u=ge).$lambda,e.$$p=($=function(){$.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.ELLIPSE_SIZE")},$.$$s=ge,$.$$arity=0,$),e).call(u),REST_SIZE:(e=(p=ge).$lambda,e.$$p=(d=function(){d.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.REST_SIZE")},d.$$s=ge,d.$$arity=0,d),e).call(p),beams:!1}),notes_large:i(["LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","beams"],{LINE_MEDIUM:.3,LINE_THICK:.7,ELLIPSE_SIZE:[4,2],REST_SIZE:[4,2],beams:!1}),notes_with_beams:i(["LINE_THIN","LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","beams"],{LINE_THIN:.1,LINE_MEDIUM:.2,LINE_THICK:.5,ELLIPSE_SIZE:[1.3,1],REST_SIZE:[2,1.3],beams:!0}),"-":i([],{}),packer_compact:i(["packer"],{packer:i(["pack_method","pack_max_spreadfactor","pack_min_increment"],{pack_method:1,pack_max_spreadfactor:2,pack_min_increment:.2})}),packer_regular:i(["packer"],{packer:(e=(h=ge).$lambda,e.$$p=(_=function(){_.$$s;return null==o.conf&&(o.conf=n),o.conf.$get("extract.0.layout.packer")},_.$$s=ge,_.$$arity=0,_),e).call(h)}),"--":i([],{}),color_on:i(["color"],{color:i(["color_default","color_variant1","color_variant2"],{color_default:"black",color_variant1:"grey",color_variant2:"darkgrey"})}),color_off:i(["color"],{color:i(["color_default","color_variant1","color_variant2"],{color_default:"black",color_variant1:"black",color_variant2:"black"})}),"---":i([],{}),jumpline_anchor_close:i(["jumpline_anchor"],{jumpline_anchor:[3,1]}),jumpline_anchor_medium:i(["jumpline_anchor"],{jumpline_anchor:[5,1]}),jumpline_anchor_wide:i(["jumpline_anchor"],{jumpline_anchor:[10,1]})}),instrument:i(["37-strings-g-g","25-strings-g-g","25-strings-G-g Bass","21-strings-a-f","18-strings-b-e","saitenspiel","Okon-Harfe"],{"37-strings-g-g":i(["layout","stringnames","printer"],{layout:i(["instrument","limit_a3","beams","bottomup","PITCH_OFFSET","X_SPACING","X_OFFSET"],{instrument:"37-strings-g-g",limit_a3:!0,beams:!1,bottomup:!1,PITCH_OFFSET:(e=(g=ge).$lambda,e.$$p=(m=function(){m.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.PITCH_OFFSET")},m.$$s=ge,m.$$arity=0,m),e).call(g),X_SPACING:(e=(y=ge).$lambda,e.$$p=(v=function(){v.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.X_SPACING")},v.$$s=ge,v.$$arity=0,v),e).call(y),X_OFFSET:(e=(b=ge).$lambda,e.$$p=(x=function(){x.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.X_OFFSET")},x.$$s=ge,x.$$arity=0,x),e).call(b)}),stringnames:i(["text","marks"],{text:(e=(w=ge).$lambda,e.$$p=(A=function(){A.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.stringnames.text")},A.$$s=ge,A.$$arity=0,A),e).call(w),marks:i(["hpos"],{hpos:[43,79]})}),printer:i(["a4_pages","a4_offset","a3_offset"],{a4_pages:[0,1,2],a4_offset:(e=(k=ge).$lambda,e.$$p=(E=function(){E.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.printer.a4_offset")},E.$$s=ge,E.$$arity=0,E),e).call(k),a3_offset:(e=(C=ge).$lambda,e.$$p=(S=function(){S.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.printer.a3_offset")},S.$$s=ge,S.$$arity=0,S),e).call(C)})}),"25-strings-g-g":i(["layout","stringnames","printer"],{layout:i(["instrument","limit_a3","beams","bottomup","PITCH_OFFSET","X_SPACING","X_OFFSET"],{instrument:"25-strings-g-g",limit_a3:!1,beams:!1,bottomup:!1,PITCH_OFFSET:(e=(I=ge).$lambda,e.$$p=(O=function(){O.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.PITCH_OFFSET")},O.$$s=ge,O.$$arity=0,O),e).call(I),X_SPACING:(e=(T=ge).$lambda,e.$$p=(P=function(){P.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.X_SPACING")},P.$$s=ge,P.$$arity=0,P),e).call(T),X_OFFSET:(e=(M=ge).$lambda,e.$$p=(N=function(){N.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.X_OFFSET")},N.$$s=ge,N.$$arity=0,N),e).call(M)}),stringnames:i(["text","marks"],{text:(e=(B=ge).$lambda,e.$$p=(R=function(){var e=R.$$s||this;return null==o.conf&&(o.conf=n),e.$cut_string_names(o.conf["$[]"]("extract.0.stringnames.text"),12,36)},R.$$s=ge,R.$$arity=0,R),e).call(B),marks:i(["hpos"],{hpos:[55,79]})}),printer:i(["a4_pages","a3_offset","a4_offset"],{a4_pages:[1,2],a3_offset:[-5,0],a4_offset:(e=(j=ge).$lambda,e.$$p=(F=function(){F.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.printer.a4_offset")},F.$$s=ge,F.$$arity=0,F),e).call(j)})}),"25-strings-G-g Bass":i(["layout","stringnames","printer"],{layout:i(["instrument","limit_a3","beams","bottomup","PITCH_OFFSET","X_SPACING","X_OFFSET"],{instrument:"25-strings-g-g",limit_a3:!1,beams:!1,bottomup:!1,PITCH_OFFSET:(e=(D=ge).$lambda,e.$$p=(L=function(){L.$$s;return-31},L.$$s=ge,L.$$arity=0,L),e).call(D),X_SPACING:(e=(z=ge).$lambda,e.$$p=(q=function(){q.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.X_SPACING")},q.$$s=ge,q.$$arity=0,q),e).call(z),X_OFFSET:(e=(U=ge).$lambda,e.$$p=(H=function(){H.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.X_OFFSET")},H.$$s=ge,H.$$arity=0,H),e).call(U)}),stringnames:i(["text","marks"],{text:(e=(G=ge).$lambda,e.$$p=(Y=function(){var e=Y.$$s||this;return null==o.conf&&(o.conf=n),e.$cut_string_names(o.conf["$[]"]("extract.0.stringnames.text"),12,36)},Y.$$s=ge,Y.$$arity=0,Y),e).call(G),marks:i(["hpos"],{hpos:[43,67]})}),printer:i(["a4_pages","a3_offset","a4_offset"],{a4_pages:[1,2],a3_offset:[-5,0],a4_offset:(e=(Q=ge).$lambda,e.$$p=(V=function(){V.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.printer.a4_offset")},V.$$s=ge,V.$$arity=0,V),e).call(Q)})}),"21-strings-a-f":i(["layout","stringnames","printer"],{layout:i(["instrument","limit_a3","beams","bottomup","PITCH_OFFSET","X_SPACING","X_OFFSET"],{instrument:"21-strings-a-f",limit_a3:!1,beams:!1,bottomup:!1,PITCH_OFFSET:(e=(X=ge).$lambda,e.$$p=(W=function(){W.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.PITCH_OFFSET")},W.$$s=ge,W.$$arity=0,W),e).call(X),X_SPACING:(e=(J=ge).$lambda,e.$$p=(K=function(){K.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.X_SPACING")},K.$$s=ge,K.$$arity=0,K),e).call(J),X_OFFSET:23}),stringnames:i(["text","marks"],{text:(e=(Z=ge).$lambda,e.$$p=(ee=function(){var e=ee.$$s||this;return null==o.conf&&(o.conf=n),e.$cut_string_names(o.conf["$[]"]("extract.0.stringnames.text"),14,34)},ee.$$s=ge,ee.$$arity=0,ee),e).call(Z),marks:i(["hpos"],{hpos:[57,77]})}),printer:i(["a4_pages","a3_offset","a4_offset"],{a4_pages:[1,2],a3_offset:[-5,0],a4_offset:(e=(te=ge).$lambda,e.$$p=(re=function(){re.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.printer.a4_offset")},re.$$s=ge,re.$$arity=0,re),e).call(te)})}),"18-strings-b-e":i(["layout","stringnames","printer"],{layout:i(["instrument","limit_a3","beams","bottomup","PITCH_OFFSET","X_SPACING","X_OFFSET"],{instrument:"18-strings-b-e",limit_a3:!1,beams:!1,bottomup:!1,PITCH_OFFSET:(e=(ne=ge).$lambda,e.$$p=(ae=function(){ae.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.PITCH_OFFSET")},ae.$$s=ge,ae.$$arity=0,ae),e).call(ne),X_SPACING:(e=(ie=ge).$lambda,e.$$p=(oe=function(){oe.$$s;return null==o.conf&&(o.conf=n),o.conf["$[]"]("extract.0.layout.X_SPACING")},oe.$$s=ge,oe.$$arity=0,oe),e).call(ie),X_OFFSET:28.5}),stringnames:i(["text","marks"],{text:(e=(se=ge).$lambda,e.$$p=(le=function(){var e=le.$$s||this;return null==o.conf&&(o.conf=n),e.$cut_string_names(o.conf["$[]"]("extract.0.stringnames.text"),16,33)},le.$$s=ge,le.$$arity=0,le),e).call(se),marks:i(["hpos"],{hpos:[59,76]})}),printer:i(["a4_pages","a3_offset","a4_offset"],{a4_pages:[2],a3_offset:[0,0],a4_offset:[40,0]})}),saitenspiel:i(["layout","stringnames","printer"],{layout:i(["instrument","limit_a3","beams","bottomup","PITCH_OFFSET","X_SPACING","X_OFFSET"],{instrument:"saitenspiel",limit_a3:!1,beams:!1,bottomup:!1,PITCH_OFFSET:-24,X_SPACING:14.5,X_OFFSET:240}),stringnames:i(["text","marks"],{text:"G C D E F G A B C D  ~ ~ ~ ~ ~ ~ ~",marks:i(["hpos"],{hpos:[55,74]})}),printer:i(["a4_pages","a3_offset","a4_offset"],{a4_pages:[2],a3_offset:[0,0],a4_offset:[35,0]})}),"Okon-Harfe":i(["layout","stringnames","printer"],{layout:i(["instrument","beams","bottomup","limit_a3","PITCH_OFFSET","X_SPACING","X_OFFSET"],{instrument:"okon-f",beams:!0,bottomup:!0,limit_a3:!1,PITCH_OFFSET:0,X_SPACING:15,X_OFFSET:50}),stringnames:i(["text","marks"],{text:"G A B C D E F G A B C D E F G A B C ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~",marks:i(["hpos"],{hpos:[55,74]})}),printer:i(["a4_pages","a3_offset","a4_offset"],{a4_pages:[1,2],a3_offset:[-35,0],a4_offset:[70,0]})})}),notes:i(["T01_number","T01_number_extract","T01_number_extract_value","T02_copyright_music","T03_copyright_harpnotes","T04_to_order","T05_printed_extracts","T06_legend","T99_do_not_copy","T01_T99"],{T01_number:i(["value"],{value:i(["pos","text","style"],{pos:[393,17],text:"XXX-{{number}}",style:"bold"})}),T01_number_extract:i(["value"],{value:i(["pos","text","style"],{pos:[411,17],text:"{{extract_filename}}",style:"bold"})}),T01_number_extract_value:i(["key","value"],{key:"T01_number_extract",value:i(["text"],{text:"{{extract_filename}}"})}),T02_copyright_music:i(["value"],{value:i(["pos","text","style"],{pos:[340,251],text:(e=(ce=ge).$lambda,e.$$p=(ue=function(){ue.$$s;return" "+f.get("Time").$now().$year()+"\n"+f.get("I18n").$t("Private copy")},ue.$$s=ge,ue.$$arity=0,ue),e).call(ce),style:"small"})}),T03_copyright_harpnotes:i(["value"],{value:i(["pos","text","style"],{pos:[340,260],text:" "+f.get("Time").$now().$year()+" Notenbild: zupfnoter.de",style:"small"})}),T04_to_order:i(["value"],{value:i(["pos","text","style"],{pos:[340,242],text:(e=($e=ge).$lambda,e.$$p=(fe=function(){fe.$$s;return f.get("I18n").$t("provided by\n")},fe.$$s=ge,fe.$$arity=0,fe),e).call($e),style:"small"})}),T05_printed_extracts:i(["value"],{value:i(["pos","text","style"],{pos:[393,22],text:"{{printed_extracts}}",style:"smaller"})}),T06_legend:i(["value"],{value:i(["pos","text","style"],{pos:[360,30],text:"{{extract_title}}\n{{composer}}\nTakt: {{meter}} ({{tempo}})\nTonart: {{key}}",style:"small"})}),T99_do_not_copy:i(["value"],{value:i(["pos","text","style"],{pos:[380,284],text:(e=(pe=ge).$lambda,e.$$p=(de=function(){de.$$s;return f.get("I18n").$t("Please do not copy")},de.$$s=ge,de.$$arity=0,de),e).call(pe),style:"small_bold"})}),T01_T99:i(["value"],{value:i([],{})})}),printer:i(["printer_left","printer_centric","printer_right"],{printer_left:i(["printer","layout"],{printer:i(["a3_offset","a4_offset","show_border"],{a3_offset:[-10,0],a4_offset:[-5,0],show_border:!1}),layout:i(["limit_a3"],{limit_a3:!1})}),printer_centric:i(["printer","layout"],{printer:i(["a3_offset","a4_offset","show_border"],{a3_offset:[0,0],a4_offset:[5,0],show_border:!1}),layout:i(["limit_a3"],{limit_a3:!0})}),printer_right:i(["printer","layout"],{printer:i(["a3_offset","a4_offset","show_border"],{a3_offset:[10,0],a4_offset:[5,0],show_border:!1}),layout:i(["limit_a3"],{limit_a3:!1})})})}),annotations:i(["vl","vt","vr"],{vl:i(["text","pos"],{text:"v",pos:[-5,-5]}),vt:i(["text","pos"],{text:"v",pos:[-1,-5]}),vr:i(["text","pos"],{text:"v",pos:[2,-5]})}),extract:i(["0","1","2","3","4","5"],{0:i(["title","startpos","voices","synchlines","flowlines","subflowlines","jumplines","repeatsigns","layoutlines","legend","lyrics","images","layout","sortmark","nonflowrest","notes","tuplets","barnumbers","countnotes","stringnames","printer"],{title:"alle Stimmen",startpos:15,voices:[1,2,3,4],synchlines:[[1,2],[3,4]],flowlines:[1,3],subflowlines:[2,4],jumplines:[1,3],repeatsigns:i(["voices","left","right"],{voices:[],left:i(["pos","text","style"],{pos:[-7,-2],text:"|:",style:"bold"}),right:i(["pos","text","style"],{pos:[5,-2],text:":|",style:"bold"})}),layoutlines:[1,2,3,4],legend:i(["spos","pos"],{spos:[320,27],pos:[320,7]}),lyrics:i([],{}),images:i([],{}),layout:i(["limit_a3","bottomup","beams","jumpline_anchor","color","LINE_THIN","LINE_MEDIUM","LINE_THICK","PITCH_OFFSET","X_SPACING","X_OFFSET","ELLIPSE_SIZE","REST_SIZE","DRAWING_AREA_SIZE","instrument","packer"],{limit_a3:!0,bottomup:!1,beams:!1,jumpline_anchor:[3,1],color:i(["color_default","color_variant1","color_variant2"],{color_default:"black",color_variant1:"grey",color_variant2:"dimgrey"}),LINE_THIN:.1,LINE_MEDIUM:.3,LINE_THICK:.5,PITCH_OFFSET:-43,X_SPACING:11.5,X_OFFSET:2.8,ELLIPSE_SIZE:[3.5,1.7],REST_SIZE:[4,2],DRAWING_AREA_SIZE:[400,282],instrument:"37-strings-g-g",packer:i(["pack_method","pack_max_spreadfactor","pack_min_increment"],{pack_method:0,pack_max_spreadfactor:2,pack_min_increment:.2})}),sortmark:i(["size","fill","show"],{size:[2,4],fill:!0,show:!1}),nonflowrest:!1,notes:i([],{}),tuplets:i(["text"],{text:"{{tuplet}}"}),barnumbers:i(["voices","pos","autopos","apbase","style","prefix"],{voices:[],pos:[6,-4],autopos:!0,apbase:[1,1],style:"small_bold",prefix:""}),countnotes:i(["voices","pos","autopos","apbase","style"],{voices:[],pos:[3,-2],autopos:!0,apbase:[1,-.5],style:"smaller"}),stringnames:i(["text","vpos","style","marks"],{text:"G G# A A# B C C# D D# E F F# G G# A A# B C C# D D# E F F# G G# A A# B C C# D D# E F F# G",vpos:[],style:"small",marks:i(["vpos","hpos"],{vpos:[11],hpos:[43,55,79]})}),printer:i(["a3_offset","a4_offset","a4_pages","show_border"],{a3_offset:[0,0],a4_offset:[-5,0],a4_pages:[0,1,2],show_border:!1})}),1:i(["title","voices"],{title:"Sopran, Alt",voices:[1,2]}),2:i(["title","voices"],{title:"Tenor, Bass",voices:[3,4]}),3:i(["title","voices"],{title:"Melodie",voices:[1]}),4:i(["title","voices"],{title:"Extract 4",voices:[1]}),5:i(["title","voices"],{title:"Extract 5",voices:[1]})}),layout:i(["grid","limit_a3","SHOW_SLUR","LINE_THIN","LINE_MEDIUM","LINE_THICK","ELLIPSE_SIZE","REST_SIZE","X_SPACING","X_OFFSET","Y_SCALE","DRAWING_AREA_SIZE","BEAT_RESOLUTION","SHORTEST_NOTE","BEAT_PER_DURATION","PITCH_OFFSET","FONT_STYLE_DEF","MM_PER_POINT","DURATION_TO_STYLE","DURATION_TO_BEAMS","REST_TO_GLYPH"],{grid:!1,limit_a3:!0,SHOW_SLUR:!1,LINE_THIN:.1,LINE_MEDIUM:.3,LINE_THICK:.5,ELLIPSE_SIZE:[3.5,1.7],REST_SIZE:[4,2],X_SPACING:11.5,X_OFFSET:2.8,Y_SCALE:4,DRAWING_AREA_SIZE:[400,282],BEAT_RESOLUTION:192,SHORTEST_NOTE:64,BEAT_PER_DURATION:3,PITCH_OFFSET:-43,FONT_STYLE_DEF:i(["bold","italic","large","regular","small_bold","small_italic","small","smaller"],{bold:i(["text_color","font_size","font_style"],{text_color:[0,0,0],font_size:12,font_style:"bold"}),italic:i(["text_color","font_size","font_style"],{text_color:[0,0,0],font_size:12,font_style:"italic"}),large:i(["text_color","font_size","font_style"],{text_color:[0,0,0],font_size:20,font_style:"bold"}),regular:i(["text_color","font_size","font_style"],{text_color:[0,0,0],font_size:12,font_style:"normal"}),small_bold:i(["text_color","font_size","font_style"],{text_color:[0,0,0],font_size:9,font_style:"bold"}),small_italic:i(["text_color","font_size","font_style"],{text_color:[0,0,0],font_size:9,font_style:"italic"}),small:i(["text_color","font_size","font_style"],{text_color:[0,0,0],font_size:9,font_style:"normal"}),smaller:i(["text_color","font_size","font_style"],{text_color:[0,0,0],font_size:6,font_style:"normal"})}),MM_PER_POINT:.3,DURATION_TO_STYLE:i(["err","d64","d48","d32","d24","d16","d12","d8","d6","d4","d3","d2","d1"],{err:[2,"filled",!1],d64:[1,"empty",!1],d48:[.75,"empty",!0],d32:[.75,"empty",!1],d24:[.75,"filled",!0],d16:[.75,"filled",!1],d12:[.5,"filled",!0],d8:[.5,"filled",!1],d6:[.3,"filled",!0],d4:[.3,"filled",!1],d3:[.1,"filled",!0],d2:[.1,"filled",!1],d1:[.05,"filled",!1]}),DURATION_TO_BEAMS:i(["d64","d48","d32","d24","d16","d12","d8","d6","d4","d3","d2","d1"],{d64:[1,"empty",!1],d48:[1,"empty",!0,0],d32:[1,"empty",!1,0],d24:[1,"filled",!0,0],d16:[1,"filled",!1,0],d12:[1,"filled",!0,1],d8:[1,"filled",!1,1],d6:[1,"filled",!0,2],d4:[1,"filled",!1,2],d3:[1,"filled",!0,3],d2:[1,"filled",!1,3],d1:[1,"filled",!1,4]}),REST_TO_GLYPH:i(["err","d64","d48","d32","d24","d16","d12","d8","d6","d4","d3","d2","d1"],{err:[[2,2],"rest_1",!1],d64:[[1,.8],"rest_1",!1],d48:[[.5,.4],"rest_1",!0],d32:[[.5,.4],"rest_1",!1],d24:[[.4,.75],"rest_4",!0],d16:[[.4,.75],"rest_4",!1],d12:[[.4,.5],"rest_8",!0],d8:[[.4,.5],"rest_8",!1],d6:[[.4,.3],"rest_16",!0],d4:[[.3,.3],"rest_16",!1],d3:[[.3,.5],"rest_32",!0],d2:[[.3,.5],"rest_32",!1],d1:[[.3,.5],"rest_64",!1]})}),neatjson:i(["wrap","aligned","after_comma","after_colon_1","after_colon_n","before_colon_n","short","afterComma","afterColon1","afterColonN","beforeColonN","decimals","explicit_sort"],{wrap:60,aligned:!0,after_comma:1,after_colon_1:1,after_colon_n:1,before_colon_n:1,short:!1,afterComma:1,afterColon1:1,afterColonN:1,beforeColonN:1,decimals:2,explicit_sort:f.get("Hash")["$[]"]((e=(he=me.$each_with_index().$to_a()).$map,e.$$p=(_e=function(e){_e.$$s;return null==e&&(e=n),[e.$first(),t("_",("000"+e.$last())["$[]"](s(-4,-1,!1)))]},_e.$$s=ge,_e.$$arity=1,_e),e).call(he))})})},u.$$arity=0)}(r.base),e.cdecl(r,"DBX_APIKEY_FULL","zwydv2vbgp30e05"),e.cdecl(r,"DBX_APIKEY_APP","xr3zna7wrp75zax"),e.cdecl(r,"CONFIG_SEPARATOR","%%%%zupfnoter.config")},Opal.modules.text_pane=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}var a=(e.top,e),i=e.nil,o=(e.breaker,e.slice,e.module),s=e.klass,l=e.hash2,c=e.gvars,u=e.range
;return e.add_stubs(["$attr_accessor","$reset","$push","$[]","$pop","$empty?","$reverse","$flatten","$lambda","$new","$_clean_models","$create_lyrics_editor","$from_lyrics","$on","$save_to_localstorage","$clear_markers","$call","$Native","$getSession","$get_selection_positions","$min","$first","$max","$last","$strip","$_get_abc_from_editor","$+","$_get_config_json","$_has_resources?","$_get_resources_json","$_split_parts","$editor","$map","$-","$set_markers","$to_n","$each","$add_marker","$join","$split","$<<","$clear","$_get_config_model","$scan","$to_s","$[]=","$==","$do","$_set_config_model","$get","$set_config_model","$gsub","$_set_config_json","$token","$get_selection_info","$type","$raise","$replace_range","$startpos","$endpos","$start_with?","$delete","$deep_dup","$get_lyrics_raw","$>","$count","$get_abc_part","$error","$clear_errors","$get_lyrics","$replace_text","$call_consumers","$nil?","$_set_abc_to_editor","$_set_resources_json","$set_text","$clean_localstorage","$each_with_index","$t","$parse","$benchmark","$neat_generate","$undo","$info","$dig","$redo","$undo_history","$redo_history","$!"]),function(a){var $,f=$=o(a,"Harpnotes"),p=(f.$$proto,f.$$scope);!function(a,o){function $(){}var f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne,ae,ie,oe,se,le,ce,ue,$e,fe,pe,de,he=$=s(a,null,"TextPane",$),_e=he.$$proto,ge=he.$$scope;_e.editor=_e.range=_e.config_separator=_e.markers=_e.config_models=_e.dirty=_e.config_undo=_e.on_change=_e.lyrics_editor=_e.controller=_e.handle_from_lyrics=i,he.$attr_accessor("editor","controller","autofold"),function(t,r){function n(){}var a,o,c,u,$,f,p,d=n=s(t,null,"UndoManager",n),h=d.$$proto;d.$$scope;h.undostack=h.currentstate=h.redostack=i,e.defn(d,"$initialize",a=function(){return this.$reset()},a.$$arity=0),e.defn(d,"$reset",o=function(){var e=this;return e.undostack=[],e.redostack=[],e.currentstate=l(["title","state"],{title:"init state",state:l([],{})})},o.$$arity=0),e.defn(d,"$do",c=function(e,t){var r=this;return r.undostack.$push(r.currentstate),r.redostack=[],r.currentstate=l(["title","state"],{title:t,state:e}),r.currentstate},c.$$arity=2),e.defn(d,"$undo",u=function(){var e,t=this,r=i;return(e=t.undostack["$[]"](1))===i||null==e||e.$$is_boolean&&1!=e?i:(r=t.undostack.$pop(),t.redostack.$push(t.currentstate),t.currentstate=r)},u.$$arity=0),e.defn(d,"$redo",$=function(){var e,t=this,r=i;return(e=t.redostack["$empty?"]())===i||null==e||e.$$is_boolean&&1!=e?(r=t.redostack.$pop(),t.undostack.$push(t.currentstate),t.currentstate=r):i},$.$$arity=0),e.defn(d,"$undo_history",f=function(){var e=this;return[e.undostack,e.currentstate].$flatten().$reverse()},f.$$arity=0),e.defn(d,"$redo_history",p=function(){return[this.redostack].$flatten().$reverse()},p.$$arity=0)}(ge.base),e.defn(he,"$initialize",f=function(e){var t,r,n,a=this,o=ace.require("ace/ext/language_tools");o.setCompleters([o.snippetCompleter]);var s=ace.edit(e);return s.commands.bindKey("Cmd-L",null),s.commands.bindKey("Ctrl-L",null),s.commands.bindKey("Ctrl-P",null),s.commands.bindKey("Ctrl-K",null),s.$blockScrolling=1/0,s.getSession().setMode("ace/mode/abc"),s.setTheme("ace/theme/abc"),s.setOptions({highlightActiveLine:!0,enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1}),a.editor=s,a.range=ace.require("ace/range").Range,a.inhibit_callbacks=!1,a.markers=[],a.autofold=!0,a.on_change=(t=(r=a).$lambda,t.$$p=(n=function(){n.$$s;return i},n.$$s=a,n.$$arity=0,n),t).call(r),a.config_separator="%%%%zupfnoter",a.dirty=l([],{}),a.config_undo=ge.get("UndoManager").$new(),a.$_clean_models(),a.$create_lyrics_editor("abcLyrics")},f.$$arity=1),e.defn(he,"$create_lyrics_editor",p=function(e){var t=this,r=ace.require("ace/ext/language_tools");r.setCompleters([r.snippetCompleter]);var n=ace.edit(e);return n.$blockScrolling=1/0,n.getSession().setMode("ace/mode/markdown"),n.setTheme("ace/theme/abc"),n.setOptions({highlightActiveLine:!0,enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1}),n.on("change",function(){t.$from_lyrics()}),t.lyrics_editor=n,t.lyrics_range=ace.require("ace/range").Range,t.lyrics_inhibit_callbacks=!1,t.lyrics_markers=[]},p.$$arity=1),e.defn(he,"$on_change",d=function(){var e,t,r,n=this,a=d.$$p,o=a||i;return d.$$p=null,n.on_change=o,(e=(t=n.$Native(n.$Native(n.editor).$getSession())).$on,e.$$p=(r=function(e){var t=r.$$s||this;return null==t.on_change&&(t.on_change=i),null==e&&(e=i),t.$save_to_localstorage("zn_abc"),t.$clear_markers(),t.on_change.$call(e)},r.$$s=n,r.$$arity=1,r),e).call(t,"change")},d.$$arity=0),e.defn(he,"$on_selection_change",h=function(){var e,t,r,n=this,a=h.$$p,o=a||i;return h.$$p=null,(e=(t=n.$Native(n.$Native(n.editor)["$[]"]("selection"))).$on,e.$$p=(r=function(e){var t,n=r.$$s||this;return null==n.inhibit_callbacks&&(n.inhibit_callbacks=i),null==e&&(e=i),(t=n.inhibit_callbacks)===i||null==t||t.$$is_boolean&&1!=t?o.$call(e):i},r.$$s=n,r.$$arity=1,r),e).call(t,"changeSelection")},h.$$arity=0),e.defn(he,"$on_cursor_change",_=function(){var e,t,r,n=this,a=_.$$p,o=a||i;return _.$$p=null,o.$call(i),(e=(t=n.$Native(n.$Native(n.editor)["$[]"]("selection"))).$on,e.$$p=(r=function(e){var t,n=r.$$s||this;return null==n.inhibit_callbacks&&(n.inhibit_callbacks=i),null==e&&(e=i),(t=n.inhibit_callbacks)===i||null==t||t.$$is_boolean&&1!=t?o.$call(e):i},r.$$s=n,r.$$arity=1,r),e).call(t,"changeCursor")},_.$$arity=0),e.defn(he,"$clear_selection",g=function(){this.editor.selection.clearSelection()},g.$$arity=0),e.defn(he,"$get_selection_positions",m=function(){var e=this;return doc=e.editor.selection.doc,range=e.editor.selection.getRange(),range_start=doc.positionToIndex(range.start,0),range_end=doc.positionToIndex(range.end,0),[range_start,range_end]},m.$$arity=0),e.defn(he,"$get_selection_ranges",y=function(){var e=this,t=e.editor.selection.doc;return e.editor.selection.getAllRanges().map(function(e){return[t.positionToIndex(e.start,0),t.positionToIndex(e.end,0)]})},y.$$arity=0),e.defn(he,"$get_selection_info",v=function(){var e=this;return doc=e.editor.selection.doc,range=e.editor.selection.getRange(),token=e.editor.session.getTokenAt(range.start.row,range.start.column),token&&(token.startpos=[range.start.row,token.start],token.endpos=[range.start.row,token.start+token.value.length]),e.$Native({selection:[[range.start.row+1,range.start.column+1],[range.end.row+1,range.end.column+1]],token:token})},v.$$arity=0),e.defn(he,"$select_range_by_position",b=function(e,t,r){var n=this,a=i,o=i,s=i;null==r&&(r=!1),a=!1!==r&&r!==i&&null!=r?n.$get_selection_positions():[e,t],o=[a.$first(),e].$min(),s=[a.$last(),t].$max(),doc=n.editor.selection.doc,startrange=doc.indexToPosition(o),endrange=doc.indexToPosition(s),range=new n.range(startrange.row,startrange.column,endrange.row,endrange.column),myrange={start:startrange,end:endrange},n.editor.focus(),n.editor.selection.setSelectionRange(myrange,!1)},b.$$arity=-3),e.defn(he,"$set_focus",x=function(){return this.editor.focus()},x.$$arity=0),e.defn(he,"$select_add_range_by_position",w=function(e,t,r){var n=this,a=i,o=i,s=i;null==r&&(r=!1),a=!1!==r&&r!==i&&null!=r?n.$get_selection_positions():[e,t],o=[a.$first(),e].$min(),s=[a.$last(),t].$max(),doc=n.editor.selection.doc,startrange=doc.indexToPosition(o),endrange=doc.indexToPosition(s),range=new n.range(startrange.row,startrange.column,endrange.row,endrange.column),myrange={start:startrange,end:endrange},n.editor.focus(),n.editor.selection.addRange(range,!1)},w.$$arity=-3),e.defn(he,"$get_text",A=function(){var e,r=this,n=i;return n=r.$_get_abc_from_editor().$strip(),n=t(n,t("\n\n"+r.config_separator+".config\n\n",r.$_get_config_json())),(e=r["$_has_resources?"]())===i||null==e||e.$$is_boolean&&1!=e||(n=t(n,t("\n\n"+r.config_separator+".resources\n\n",r.$_get_resources_json()))),n},A.$$arity=0),e.defn(he,"$set_text",k=function(e){return this.$_split_parts(e)},k.$$arity=1),e.defn(he,"$replace_range",E=function(e,t,r){var n=this;therange=new n.range(e[0],e[1],t[0],t[1]),n.$editor().getSession().replace(therange,r)},E.$$arity=3),e.defn(he,"$replace_text",C=function(e,t){return this.editor.replace(t,{needle:e})},C.$$arity=2),e.defn(he,"$set_annotations",S=function(e){var t,n,a,o=this,s=i;return s=(t=(n=e).$map,t.$$p=(a=function(e){a.$$s;return null==e&&(e=i),l(["row","text","type"],{row:r(e["$[]"]("start_pos").$first(),1),text:e["$[]"]("text"),type:e["$[]"]("type")})},a.$$s=o,a.$$arity=1,a),t).call(n),o.$set_markers(e),o.editor.getSession().setAnnotations(s.$to_n())},S.$$arity=1),e.defn(he,"$set_markers",I=function(e){var t,r,n,a=this;return a.$clear_markers(),(t=(r=e).$each,t.$$p=(n=function(e){var t=n.$$s||this;return null==e&&(e=i),t.$add_marker(e)},n.$$s=a,n.$$arity=1,n),t).call(r)},I.$$arity=1),e.defn(he,"$prepend_comment",O=function(e){var r,n,a,o=this,s=i;s=t((r=(n=e.$split(/\r?\n/)).$map,r.$$p=(a=function(e){a.$$s;return null==e&&(e=i),"% "+e},a.$$s=o,a.$$arity=1,a),r).call(n).$join("\n"),"\n%\n"),o.editor.selection.moveCursorFileStart(),o.editor.insert(s)},O.$$arity=1),e.defn(he,"$append_text",T=function(e){var t=this;t.editor.selection.moveCursorFileEnd(),t.editor.insert(e)},T.$$arity=1),e.defn(he,"$add_marker",P=function(e){var t=this,n=i,a=i,o=i;return n=l(["row","col"],{row:e["$[]"]("start_pos").$first(),col:e["$[]"]("start_pos").$last()}),a=l(["row","col"],{row:e["$[]"]("end_pos").$first(),col:e["$[]"]("end_pos").$last()}),o=t.editor.getSession().addMarker(new t.range(r(n["$[]"]("row"),1),r(n["$[]"]("col"),1),r(a["$[]"]("row"),1),r(a["$[]"]("col"),1)),"marked","line",!0),t.markers["$<<"](l(["from","to","id"],{from:[n["$[]"]("row"),n["$[]"]("col")],to:[a["$[]"]("row"),a["$[]"]("col")],id:o})),i},P.$$arity=1),e.defn(he,"$clear_markers",M=function(){var e,t,r,n=this;return(e=(t=n.markers).$each,e.$$p=(r=function(e){var t=r.$$s||this;return null==t.editor&&(t.editor=i),null==e&&(e=i),t.editor.session.removeMarker(e["$[]"]("id"))},r.$$s=n,r.$$arity=1,r),e).call(t),n.markers.$clear()},M.$$arity=0),e.defn(he,"$get_abc_part",N=function(){return this.editor.getSession().getValue()},N.$$arity=0),e.defn(he,"$get_config_part",B=function(){return this.config_models["$[]"]("config")},B.$$arity=0),e.defn(he,"$get_config_model",R=function(){var e=this,t=i;return t=e.$_get_config_model(),!1!==t&&t!==i&&null!=t?[e.$_get_config_model(),!0]:[l([],{}),!1]},R.$$arity=0),e.defn(he,"$get_checksum",j=function(){var e=this,t=i;t=e.$_get_abc_from_editor().$strip();var r,n=305419896;for(r=0;r<t.length;r++)n+=t.charCodeAt(r)*(r+1);return n.$to_s().$scan(/...?/).$join(" ")},j.$$arity=0),e.defn(he,"$resize",F=function(){return this.editor.resize()},F.$$arity=0),e.defn(he,"$set_config_model",D=function(e,t,r){var n=this;return null==t&&(t="no desc"),null==r&&(r=!0),n.dirty["$[]="]("zn_config",!0),r["$=="](!0)&&n.config_undo.$do(e,t),n.$_set_config_model(e)},D.$$arity=-2),e.defn(he,"$patch_config_part",L=function(e,t,r){var n=this,a=i,o=i;return null==r&&(r=e),a=ge.get("Confstack").$$scope.get("Confstack").$new(!1),o=ge.get("Confstack").$$scope.get("Confstack").$new(!1),a.$push(n.$_get_config_model()),o["$[]="](e,t),a.$push(o.$get()),n.$set_config_model(a.$get(),r,!0)},L.$$arity=-3),e.defn(he,"$copy_config_part_to_extract",z=function(e,t,r){var n=this,a=i,o=i,s=i;return null==r&&(r=e),a=ge.get("Confstack").$$scope.get("Confstack").$new(!1),o=ge.get("Confstack").$$scope.get("Confstack").$new(!1),a.$push(n.$_get_config_model()),s=e.$gsub(/^extract\.\d+/,"extract."+t),o["$[]="](s,a.$get(e)),a.$push(o.$get()),n.$set_config_model(a.$get(),r,!0)},z.$$arity=-3),e.defn(he,"$neat_config_part",q=function(){var e=this;return e.$_set_config_json(e.$_get_config_json(),"neat config_part",!1)},q.$$arity=0),e.defn(he,"$patch_resources",U=function(e,t){var r=this;return null==c.resources&&(c.resources=i),r.dirty["$[]="]("zn_resources",!0),c.resources["$[]="](e,t),r.$save_to_localstorage("zn_resources"),r.on_change.$call(i)},U.$$arity=2),e.defn(he,"$patch_token",H=function(e,t,r){var n=this,a=i;return a=n.$get_selection_info().$token(),a.$type().$to_s()["$=="](e.$to_s())||n.$raise("cannot patch token if there is a name mismatch '"+a.$type()+"' - '"+e+"'"),n.$replace_range(a.$startpos(),a.$endpos(),r)},H.$$arity=3),e.defn(he,"$extend_config_part",G=function(e,t){var r=this,n=i,a=i;return n=ge.get("Confstack").$$scope.get("Confstack").$new(!1),a=ge.get("Confstack").$$scope.get("Confstack").$new(!1),n.$push(r.$_get_config_model()),a["$[]="](e,t),n.$push(a.$get()),n.$push(r.$_get_config_model()),r.$set_config_model(n.$get(),"extend "+e,!0)},G.$$arity=2),e.defn(he,"$delete_config_part",Y=function(e){var t,r=this,n=i;return null==c.resources&&(c.resources=i),(t=e["$start_with?"]("$resources"))===i||null==t||t.$$is_boolean&&1!=t?(n=ge.get("Confstack").$$scope.get("Confstack").$new(!1),n.$push(r.$_get_config_model().$deep_dup()),n["$[]="](e,ge.get("Confstack").$$scope.get("DeleteMe")),r.$set_config_model(n.$get(),"delete "+e,!0)):c.resources.$delete(e.$split(".").$last())},Y.$$arity=1),e.defn(he,"$get_config_part_value",Q=function(e){var t=this,r=i;return r=ge.get("Confstack").$$scope.get("Confstack").$new(!1),r.$push(t.$_get_config_model()),r["$[]"](e)},Q.$$arity=1),e.defn(he,"$get_lyrics",V=function(){var e,t,r,a=this,o=i;return o=a.$get_lyrics_raw(),(e=n(o.$count(),0))===i||null==e||e.$$is_boolean&&1!=e?i:(e=(t=o).$map,e.$$p=(r=function(e){r.$$s;return null==e&&(e=i),e.$first().$gsub(/\nW\:[ \t]*/,"\n")},r.$$s=a,r.$$arity=1,r),e).call(t).$join().$strip()},V.$$arity=0),e.defn(he,"$get_lyrics_raw",X=function(){var e,t=this,r=i,a=i,o=i;return null==c.log&&(c.log=i),r=/((\n((W\:)([^\n]*)\n)+)+)/,a=t.$get_abc_part(),o=a.$scan(r),(e=n(o.$count(),1))===i||null==e||e.$$is_boolean&&1!=e||c.log.$error("you have more than one lyrics section in your abc code"),o},X.$$arity=0),e.defn(he,"$to_lyrics",W=function(){var e=this,r=i,n=i,a=i;return null==c.log&&(c.log=i),c.log.$clear_errors(),r=e.$get_lyrics(),!1!==r&&r!==i&&null!=r||(n=e.$get_abc_part(),a=t(n.$strip(),"\n%\nW:\n%\n%\n"),e.$replace_text(n,a)),e.handle_from_lyrics=!1,e.lyrics_editor.getSession().setValue(e.$get_lyrics()),e.handle_from_lyrics=!0,e.controller.$call_consumers("error_alert"),i},W.$$arity=0),e.defn(he,"$from_lyrics",J=function(){var e,t,r,n=this,a=i,o=i,s=i;return(e=n.handle_from_lyrics)===i||null==e||e.$$is_boolean&&1!=e||(a=n.$get_lyrics_raw(),o=a.$first().$first(),s=n.lyrics_editor.getSession().getValue(),(e=s["$empty?"]())===i||null==e||e.$$is_boolean&&1!=e||(s=" "),s=(e=(t=s.$split("\n")).$map,e.$$p=(r=function(e){r.$$s;return null==e&&(e=i),"W:"+e},r.$$s=n,r.$$arity=1,r),e).call(t).$join("\n"),s="\n"+s+"\n",n.$replace_text(o,s)),i},J.$$arity=0),e.defn(he,"$restore_from_localstorage",K=function(){var e,t=this,r=i,n=i,a=i,o=i;return r=t.$Native(localStorage.getItem("abc_data")),(e=r["$nil?"]())===i||null==e||e.$$is_boolean&&1!=e?(localStorage.removeItem("abc_data"),((e=r["$nil?"]())===i||null==e||e.$$is_boolean&&1!=e)&&t.$set_text(r)):(n=t.$Native(localStorage.getItem("zn_abc")),!1!==n&&n!==i&&null!=n&&t.$_set_abc_to_editor(n),a=!1!==(e=t.$Native(localStorage.getItem("zn_config")))&&e!==i&&null!=e?e:l([],{}),t.config_undo.$reset(),!1!==a&&a!==i&&null!=a&&t.$_set_config_json(a,"from localstore zn_config",!0),!1!==(o=t.$Native(localStorage.getItem("zn_resources")))&&o!==i&&null!=o&&t.$_set_resources_json(o)),t.dirty=l([],{})},K.$$arity=0),e.defn(he,"$save_to_localstorage",Z=function(e){var t=this;return null==e&&(e=i),!1!==e&&e!==i&&null!=e&&t.dirty["$[]="](e,!0),t.dirty["$[]"]("zn_abc")["$=="](!0)&&localStorage.setItem("zn_abc",t.$_get_abc_from_editor()),t.dirty["$[]"]("zn_config")["$=="](!0)&&localStorage.setItem("zn_config",t.$_get_config_json()),t.dirty["$[]"]("zn_resources")["$=="](!0)&&localStorage.setItem("zn_resources",t.$_get_resources_json()),t.dirty=l([],{})},Z.$$arity=-1),e.defn(he,"$clean_localstorage",ee=function(){return localStorage.removeItem("zn_abc"),localStorage.removeItem("zn_config"),localStorage.removeItem("zn_resources"),i},ee.$$arity=0),e.defn(he,"$_split_parts",te=function(e){var r,n,a,o=this;return o.$_clean_models(),o.$clean_localstorage(),(r=(n=e.$split(o.config_separator)).$each_with_index,r.$$p=(a=function(e,r){var n,o=a.$$s||this;return null==o.config_undo&&(o.config_undo=i),null==c.log&&(c.log=i),null==e&&(e=i),null==r&&(r=i),r["$=="](0)?o.$_set_abc_to_editor(e):(n=e["$start_with?"](".config"))===i||null==n||n.$$is_boolean&&1!=n?(n=e["$start_with?"](".resources"))===i||null==n||n.$$is_boolean&&1!=n?c.log.$error(t(ge.get("I18n").$t("unsupported section found in abc file: "),e["$[]"](u(0,10,!1)))):o.$_set_resources_json(e.$split(".resources").$last()):(o.config_undo.$reset(),o.$_set_config_json(e.$split(".config").$last(),"from loaded abc",!0))},a.$$s=o,a.$$arity=2,a),r).call(n)},te.$$arity=1),e.defn(he,"$_set_abc_to_editor",re=function(e){var t=this;return t.inhibit_callbacks=!0,t.editor.getSession().setValue(e),t.inhibit_callbacks=!1,t.$save_to_localstorage("zn_abc")},re.$$arity=1),e.defn(he,"$_get_abc_from_editor",ne=function(){return this.editor.getSession().getValue()},ne.$$arity=0),e.defn(he,"$_set_config_json",ae=function(e,t,r){var n=this;return null==t&&(t="no desc"),null==r&&(r=!0),n.$set_config_model(ge.get("JSON").$parse(e),t,r)},ae.$$arity=-2),e.defn(he,"$_get_config_json",ie=function(){var e,t,r,n=this,a=i;return null==c.conf&&(c.conf=i),null==c.log&&(c.log=i),a=c.conf["$[]"]("neatjson"),(e=(t=c.log).$benchmark,e.$$p=(r=function(){var e=r.$$s||this;return ge.get("JSON").$neat_generate(e.$_get_config_model(),a)},r.$$s=n,r.$$arity=0,r),e).call(t,"neat_json",729,"text_pane")},ie.$$arity=0),e.defn(he,"$_get_config_model",oe=function(){var e;return!1!==(e=this.config_models["$[]"]("config"))&&e!==i&&null!=e?e:l([],{})},oe.$$arity=0),e.defn(he,"$_set_config_model",se=function(e){var t=this;return t.config_models["$[]="]("config",e),t.$save_to_localstorage("zn_config"),t.on_change.$call(i)},se.$$arity=1),e.defn(he,"$undo_config",le=function(){var e=this,t=i;return null==c.log&&(c.log=i),t=e.config_undo.$undo(),!1!==t&&t!==i&&null!=t?(c.log.$info("undo: "+t["$[]"]("title")+": "+t["$[]"]("state").$dig("extract","0","legend","pos")),!1!==t&&t!==i&&null!=t?e.$set_config_model(t["$[]"]("state"),t["$[]"]("title"),!1):i):i},le.$$arity=0),e.defn(he,"$redo_config",ce=function(){var e=this,t=i;return null==c.log&&(c.log=i),t=e.config_undo.$redo(),!1!==t&&t!==i&&null!=t?(c.log.$info("redo: "+t["$[]"]("title")+": "+t["$[]"]("state").$dig("extract","0","legend","pos")),!1!==t&&t!==i&&null!=t?e.$set_config_model(t["$[]"]("state"),t["$[]"]("title"),!1):i):i},ce.$$arity=0),e.defn(he,"$history_config",ue=function(){var e=this;return l(["undo","redo"],{undo:e.config_undo.$undo_history(),redo:e.config_undo.$redo_history()})},ue.$$arity=0),e.defn(he,"$_set_resources_json",$e=function(e){var t=this;return c.resources=ge.get("JSON").$parse(e),t.$save_to_localstorage("zn_resources"),t.on_change.$call(i)},$e.$$arity=1),e.defn(he,"$_get_resources_json",fe=function(){return null==c.resources&&(c.resources=i),null==c.conf&&(c.conf=i),ge.get("JSON").$neat_generate(c.resources,c.conf["$[]"]("neatjson"))},fe.$$arity=0),e.defn(he,"$_has_resources?",pe=function(){return null==c.resources&&(c.resources=i),c.resources["$empty?"]()["$!"]()},pe.$$arity=0),e.defn(he,"$_clean_models",de=function(){var e=this;return c.resources=l([],{}),e.config_models=l([],{}),e.dirty=l([],{})},de.$$arity=0)}(p.base)}(a.base)},Opal.modules["command-controller"]=function(e){var t=(e.top,e),r=e.nil,n=(e.breaker,e.slice,e.module),a=e.klass,i=e.hash2,o=e.range;return e.add_stubs(["$attr_reader","$call","$lambda","$raise","$new","$set_help","$set_default","$push","$!","$start_with?","$to_s","$each","$[]=","$name","$[]","$get_default","$get_help","$empty?","$get_clean_argument_values","$perform","$undoable?","$clear","$can_undo?","$pop","$invert","$can_redo?","$map","$first","$select","$nil?","$scan","$to_sym","$parse_string","$gsub","$each_with_index","$parameter_name","$clone","$unshift","$join","$parameters","$is_public?","$last","$to_a"]),function(t){var s,l=s=n(t,"CommandController"),c=(l.$$proto,l.$$scope);!function(t,n){function i(){}var o,s,l,c,u,$=i=a(t,null,"Parameter",i),f=$.$$proto;$.$$scope;f.default_action=f.name=f.help_action=r,$.$attr_reader("name"),e.defn($,"$initialize",o=function(e,t){var r=this;return r.name=e,r.type=t},o.$$arity=2),e.defn($,"$set_help",s=function(){var e=this,t=s.$$p,n=t||r;return s.$$p=null,e.help_action=n},s.$$arity=0),e.defn($,"$set_default",l=function(){var e=this,t=l.$$p,n=t||r;return l.$$p=null,e.default_action=n},l.$$arity=0),e.defn($,"$get_help",c=function(){var e=this,t=r;return t=e.default_action.$call(),!1!==t&&t!==r&&null!=t&&(t="["+t+"]"),"{"+e.name+"}"+t+" = "+e.help_action.$call()},c.$$arity=0),e.defn($,"$get_default",u=function(){return this.default_action.$call()},u.$$arity=0)}(c.base),function(t,n){function o(){}var s,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x=o=a(t,null,"Command",o),w=x.$$proto,A=x.$$scope;w.parameters=w.name=w.action=w.inverse_action=w.help_action=w.undoable=r,x.$attr_reader("name","parameters"),e.defn(x,"$initialize",s=function(e){var t,n,a,i,o,s,l,c=this;return c.name=e,c.help_action=(t=(n=c).$lambda,t.$$p=(a=function(){a.$$s;return"no help defined for "+e},a.$$s=c,a.$$arity=0,a),t).call(n),c.parameters=[],c.action=(t=(i=c).$lambda,t.$$p=(o=function(t){var n=o.$$s||this;return null==t&&(t=r),n.$raise("No action defined for "+e)},o.$$s=c,o.$$arity=1,o),t).call(i),c.inverse_action=(t=(s=c).$lambda,t.$$p=(l=function(t){var n=l.$$s||this;return null==t&&(t=r),n.$raise("No  undo defined fore "+e)},l.$$s=c,l.$$arity=1,l),t).call(s),c.undoable=!0},s.$$arity=1),e.defn(x,"$add_parameter",l=function(e,t,n,a){var i,o,s,c,u,$=this,f=l.$$p,p=f||r,d=r;return null==n&&(n=r),null==a&&(a=r),l.$$p=null,d=A.get("Parameter").$new(e,t),(i=(o=d).$set_help,i.$$p=(s=function(){s.$$s;return n},s.$$s=$,s.$$arity=0,s),i).call(o),(i=(c=d).$set_default,i.$$p=(u=function(){u.$$s;return a},u.$$s=$,u.$$arity=0,u),i).call(c),p!==r&&p.$call(d),$.parameters.$push(d)},l.$$arity=-3),e.defn(x,"$as_action",c=function(){var e=this,t=c.$$p,n=t||r;return c.$$p=null,e.action=n},c.$$arity=0),e.defn(x,"$as_inverse",u=function(){var e=this,t=u.$$p,n=t||r;return u.$$p=null,e.inverse_action=n},u.$$arity=0),e.defn(x,"$is_public?",$=function(){return this.name.$to_s()["$start_with?"]("_")["$!"]()},$.$$arity=0),e.defn(x,"$set_help",f=function(){var e=this,t=f.$$p,n=t||r;return f.$$p=null,e.help_action=n},f.$$arity=0),e.defn(x,"$perform",p=function(e){return this.action.$call(e)},p.$$arity=1),e.defn(x,"$invert",d=function(e){return this.inverse_action.$call(e)},d.$$arity=1),e.defn(x,"$get_clean_argument_values",h=function(e){var t,n,a,o=this,s=r;return s=i([],{}),(t=(n=o.parameters).$each,t.$$p=(a=function(t){var n;a.$$s;return null==t&&(t=r),s["$[]="](t.$name(),!1!==(n=e["$[]"](t.$name()))&&n!==r&&null!=n?n:t.$get_default())},a.$$s=o,a.$$arity=1,a),t).call(n),s},h.$$arity=1),e.defn(x,"$get_help",_=function(){return this.help_action.$call()},_.$$arity=0),e.defn(x,"$parameter_name",g=function(e){return this.parameters["$[]"](e).$name()},g.$$arity=1),e.defn(x,"$parameter_help",m=function(e){return this.parameters["$[]"](e).$get_help()},m.$$arity=1),e.defn(x,"$parameter_default",y=function(e){return this.parameters["$[]"](e).$get_default()},y.$$arity=1),e.defn(x,"$undoable?",v=function(){return this.undoable},v.$$arity=0),e.defn(x,"$undoable=",b=function(e){return this.undoable=e},b.$$arity=1)}(c.base),function(t,n){function s(){}var l,c,u,$,f,p,d,h,_,g,m,y,v,b,x=s=a(t,null,"CommandStack",s),w=x.$$proto,A=x.$$scope;w.commands=w.undo_stack=w.redo_stack=w.history_stack=r,e.defn(x,"$initialize",l=function(){var e=this;return e.commands=i([],{}),e.undo_stack=[],e.redo_stack=[],e.history_stack=[]},l.$$arity=0),e.defn(x,"$add_command",c=function(e){var t=this,n=c.$$p,a=n||r,i=r;return c.$$p=null,i=A.get("Command").$new(e),a.$call(i),t.commands["$[]="](i.$name(),i)},c.$$arity=1),e.defn(x,"$can_undo?",u=function(){return this.undo_stack["$empty?"]()["$!"]()},u.$$arity=0),e.defn(x,"$can_redo?",$=function(){return this.redo_stack["$empty?"]()["$!"]()},$.$$arity=0),e.defn(x,"$perform",f=function(e,t){var n,a=this,i=r;return i=e.$get_clean_argument_values(t),e.$perform(i),(n=e["$undoable?"]())===r||null==n||n.$$is_boolean&&1!=n||(a.undo_stack.$push([e,i]),a.redo_stack.$clear()),a.history_stack.$push(["  do",e,i])},f.$$arity=2),e.defn(x,"$undo",p=function(){var t,n,a=this,i=r,o=r;return(t=a["$can_undo?"]())===r||null==t||t.$$is_boolean&&1!=t?a.$raise("nothing to undo"):(n=a.undo_stack.$pop(),t=e.to_ary(n),i=null==t[0]?r:t[0],o=null==t[1]?r:t[1],a.redo_stack.$push([i,o]),a.history_stack.$push(["undo",i,o]),i.$invert(o))},p.$$arity=0),e.defn(x,"$redo",d=function(){var t,n,a=this,i=r,o=r;return(t=a["$can_redo?"]())===r||null==t||t.$$is_boolean&&1!=t?a.$raise("nothing to redo"):(n=a.redo_stack.$pop(),t=e.to_ary(n),i=null==t[0]?r:t[0],o=null==t[1]?r:t[1],a.$perform(i,o))},d.$$arity=0),e.cdecl(A,"STRING_COMMAND_REGEX",/([^ \\\^"{]+)|"(([^\\"]|\\["n\\])*)"|(\{.+\})/),e.defn(x,"$parse_string",h=function(e){var t,n,a,i=this;return(t=(n=e.$scan(A.get("STRING_COMMAND_REGEX"))).$map,t.$$p=(a=function(e){var t,n,i,o=a.$$s||this;return null==e&&(e=r),(t=(n=e).$select,t.$$p=(i=function(e){i.$$s;return null==e&&(e=r),e["$nil?"]()["$!"]()},i.$$s=o,i.$$arity=1,i),t).call(n).$first()},a.$$s=i,a.$$arity=1,a),t).call(n)},h.$$arity=1),e.defn(x,"$run_parsed_command",_=function(e,t){var n=this,a=r;return a=n.commands["$[]"](e.$to_sym()),n.$perform(a,t)},_.$$arity=2),e.defn(x,"$run_string",g=function(t){var n,a,s,l,c,u=this,$=r,f=r,p=r;return $=i([],{}),f=u.$parse_string(t),(n=f["$empty?"]())===r||null==n||n.$$is_boolean&&1!=n||(f=["help"]),f=(n=(a=f).$map,n.$$p=(s=function(e){s.$$s;return null==e&&(e=r),e.$gsub("\\\\","\\")},s.$$s=u,s.$$arity=1,s),n).call(a),p=u.commands["$[]"](f.$first().$to_sym()),!1!==p&&p!==r&&null!=p||u.$raise("wrong command: "+t),(n=(l=f["$[]"](o(1,-1,!1))).$each_with_index,n.$$p=(c=function(n,a){var i=c.$$s||this;null==n&&(n=r),null==a&&(a=r);try{return $["$[]="](p.$parameter_name(a),n)}catch(r){if(!e.rescue(r,[A.get("StandardError")]))throw r;try{return i.$raise("too many arguments in '"+t+"'")}finally{e.pop_exception()}}},c.$$s=u,c.$$arity=2,c),n).call(l),u.$perform(p,$)},g.$$arity=1),e.defn(x,"$history",m=function(){return this.history_stack.$clone()},m.$$arity=0),e.defn(x,"$undostack",y=function(){var e,t,n,a=this;return(e=(t=a.undo_stack).$map,e.$$p=(n=function(e){n.$$s;return null==e&&(e=r),e.$clone().$unshift("undo")},n.$$s=a,n.$$arity=1,n),e).call(t)},y.$$arity=0),e.defn(x,"$redostack",v=function(){var e,t,n,a=this;return(e=(t=a.redo_stack).$map,e.$$p=(n=function(e){n.$$s;return null==e&&(e=r),e.$clone().$unshift("redo")},n.$$s=a,n.$$arity=1,n),e).call(t)},v.$$arity=0),e.defn(x,"$help_string_style",b=function(){var e,t,n,a,i,o,s=this;return(e=(t=(a=(i=s.commands.$to_a()).$select,a.$$p=(o=function(e){o.$$s;return null==e&&(e=r),e.$last()["$is_public?"]()},o.$$s=s,o.$$arity=1,o),a).call(i)).$map,e.$$p=(n=function(e,t){var a,i,o,s=n.$$s||this,l=r;return null==e&&(e=r),null==t&&(t=r),l=(a=(i=t.$parameters()).$map,a.$$p=(o=function(e){o.$$s;return null==e&&(e=r),"{"+e.$name()+"}"},o.$$s=s,o.$$arity=1,o),a).call(i).$join(" "),t.$name()+" "+l+" : "+t.$get_help()},n.$$s=s,n.$$arity=2,n),e).call(t)},b.$$arity=0)}(c.base)}(t.base)},Opal.modules.controller=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}var a=(e.top,e),i=e.nil,o=(e.breaker,e.slice,e.klass),s=e.hash2,l=e.gvars,c=e.range;return e.add_stubs(["$nil?","$Native","$now","$load_dir","$save_dir","$[]","$warning","$update","$to_json","$[]=","$parse","$clone","$private","$attr_accessor","$downcase","$locale","$call_consumers","$new","$load_from_loacalstorage","$on_command","$save_to_localstorage","$handle_command","$info","$check_suppoerted_browser","$strict=","$push","$_init_conf","$controller=","$each","$send","$select","$=~","$methods","$setup_harpnote_preview","$get_uri","$class","$last","$cleanup_localstorage","$empty?","$get_abc_part","$load_demo_tune","$set_status","$loglevel","$load_from_uri","$==","$get_lyrics","$ok?","$render_previews","$error","$t","$setup_ui_listener","$show_message_of_the_day","$year","$lambda","$to_n","$has_errors?","$join","$get_errors","$meta_data","$get_notes","$first","$call","$get_config_form_menu_entries","$clear_errors","$timestamp_start","$timestamp","$run_string","$message","$backtrace","$run_parsed_command","$include?","$always","$fail","$alert","$then","$set_text","$body","$get","$restore_from_localstorage","$match","$draw","$layout_harpnotes","$draw_in_segments","$migrate_config_lyrics","$migrate_notes","$migrate_config_cleanup","$delete","$inject","$map","$to_i","$split","$gsub","$to_s","$+","$count","$is_a?","$resolve","$tap","$is_playing?","$stop_play_abc","$play_auto","$play_song","$play_selection","$play_from_selection","$stop","$setup_tune_preview","$start_with?","$benchmark","$get_checksum","$set_inactive","$set_annotations","$annotations","$debug","$load_song","$active_voices","$resize","$clear_annotations","$send_remote_command","$clear","$set_active","$render_harpnotepreview_callback","$render_tunepreview_callback","$file","$get_text","$output","$render_a4","$render_a3","$to_blob","$strftime","$get_config_from_editor","$reset_to","$keys","$dig","$validate_conf","$load_music_model","$placeholders=","$get_placeholder_replacers","$layout","$pop","$create_engine","$transform","$abc_model","$player_model_abc=","$checksum=","$get_config_model","$migrate_config","$set_config_model","$find","$add_class","$scroll_into_view","$has_class?","$scroll_to_element","$remove_class","$-","$select_range_by_position","$range_highlight_more","$range_unhighlight_more","$range_unhighlight","$highlight_abc_object","$between?","$!","$select_add_range_by_position","$get_selection_ranges","$to_a","$compact","$flatten","$merge!","$loglevel=","$app_name","$app_id","$set_view_box","$on_select","$select_abc_object","$origin","$on_annotation_drag_end","$zip","$patch_config_part","$refresh_form","$on_mouseover","$conf_key","$on_mouseout","$on_draggable_rightcklick","$element","$set_canvas","$on_change","$request_refresh","$on_selection_change","$get_selection_info","$unhighlight_all","$range_highlight","$on_cursor_change","$on_noteon","$highlight_abc_object_by_player_callback","$on_noteoff","$on_songoff","$on","$shift_key","$alt_key","$meta_key","$ctrl_key","$key_code","$===","$ord","$prevent","$play_abc","$toggle_console","$chr","$key","$newValue","$present_message_of_the_day","$systemstatus","$>","$render_remote","$init_conf"]),function(t,r){function n(){}var a,s,l,c=n=o(t,null,"LastRenderMonitor",n),u=(c.$$proto,c.$$scope);e.defn(c,"$ok?",a=function(){var e=this,t=i;return t=localStorage.getItem("lastrender"),e.$Native(t)["$nil?"]()},a.$$arity=0),e.defn(c,"$set_active",s=function(){return localStorage.setItem("lastrender",u.get("Time").$now()),!0},s.$$arity=0),e.defn(c,"$clear",l=function(){return localStorage.removeItem("lastrender"),!1},l.$$arity=0)}(a.base),function(t,r){function n(){}var a,c,u,$,f,p,d,h,_,g=n=o(t,null,"LocalStore",n),m=g.$$proto,y=g.$$scope;m.directory=m.name=i,e.defn(g,"$initialize",a=function(e){var t,r=this;return r.name=e,r.$load_dir(),(t=r.directory)===i||null==t||t.$$is_boolean&&1!=t?(r.directory=s([],{}),r.$save_dir()):i},a.$$arity=1),e.defn(g,"$create",c=function(e,t,r){var n,a=this;return null==l.log&&(l.log=i),null==r&&(r=i),(n=a.directory["$[]"](e))===i||null==n||n.$$is_boolean&&1!=n?a.$update(e,t,r,!0):l.log.$warning("local storage: key '"+e+"' already exists")},c.$$arity=-3),e.defn(g,"$update",u=function(e,t,r,n){var a,o,c=this,u=i;return null==l.log&&(l.log=i),null==r&&(r=i),null==n&&(n=!1),u=s(["p","title"],{p:t,title:r}).$to_json(),
(a=!1!==(o=c.directory["$[]"](e))&&o!==i&&null!=o?o:n)===i||null==a||a.$$is_boolean&&1!=a?l.log.$warning("local storage update: key '"+e+"' does not exist"):(localStorage.setItem(c.$mangle_key(e),u),c.directory["$[]="](e,r),c.$save_dir())},u.$$arity=-3),e.defn(g,"$retrieve",$=function(e){var t=this,r=i,n=i;return r=y.get("JSON").$parse(localStorage.getItem(t.$mangle_key(e))),!1!==r&&r!==i&&null!=r&&(n=r["$[]"]("p")),n},$.$$arity=1),e.defn(g,"$delete",f=function(e){var t,r=this;return null==l.log&&(l.log=i),(t=r.directory["$[]"](e))===i||null==t||t.$$is_boolean&&1!=t?(localStorage.removeItem(r.$mangle_key(e)),r.directory["$[]="](e,i),r.$save_dir()):l.log.$warning("local storage: key '"+e+"' does not exist")},f.$$arity=1),e.defn(g,"$list",p=function(){return this.directory.$clone()},p.$$arity=0),g.$private(),e.defn(g,"$mangle_key",d=function(e){return this.name+"."+e},d.$$arity=1),e.defn(g,"$load_dir",h=function(){var e=this,t=i;return t=e.name+"__dir",e.directory=y.get("JSON").$parse(localStorage.getItem(t))},h.$$arity=0),e.defn(g,"$save_dir",_=function(){var e=this,t=i,r=i;return t=e.directory.$to_json(),r=e.name+"__dir",localStorage.setItem(r,t)},_.$$arity=0)}(a.base),function(a,u){function f(){}var p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j,F,D,L,z,q,U,H,G,Y,Q,V,X,W,J,K,Z,ee,te,re,ne,ae,ie,oe,se,le,ce,ue,$e=f=o(a,null,"Controller",f),fe=$e.$$proto,pe=$e.$$scope;return fe.console=fe.editor=fe.harpnote_player=fe.systemstatus=fe.systemstatus_consumers=fe.commands=fe.music_model=fe.tune_preview_printer=fe.harpnote_preview_printer=fe.expand_selection=fe.abc_model=fe.dropboxclient=fe.dropboxpath=fe.dropboxloginstate=fe.info_url=fe.refresh_timer=i,$e.$attr_accessor("dropped_abc","dropboxclient","dropboxpath","editor","harpnote_preview_printer","info_url","tune_preview_printer","systemstatus","zupfnoter_ui"),e.defn($e,"$initialize",p=function(){var t,r,n,a,o,c,u,$,f,p,d=this,h=i,_=i,g=i,m=i,y=i,v=i,b=i;return null==l.log&&(l.log=i),null==l.conf&&(l.conf=i),h=s(["de","de-de","en","en-us"],{de:"de-de","de-de":"de-de",en:"en-US","en-us":"en-US"}),_=function(){try{return navigator.language.$downcase()}catch(t){if(e.rescue(t,[pe.get("StandardError")]))return"de-de";throw t}}(),g=!1!==(t=h["$[]"](_))&&t!==i&&null!=t?t:"de-de",d.info_url="https://www.zupfnoter.de/category/info_"+g,d.refresh_timer=[],d.version=pe.get("VERSION"),!1!==_&&_!==i&&null!=_&&(t=(r=pe.get("I18n")).$locale,t.$$p=(n=function(){return(n.$$s||this).$call_consumers("localizedtexts")},n.$$s=d,n.$$arity=0,n),t).call(r,g),d.zupfnoter_ui=new init_w2ui(d),d.console=pe.get("JqConsole").$$scope.get("JqConsole").$new("commandconsole","zupfnoter> "),d.console.$load_from_loacalstorage(),(t=(a=d.console).$on_command,t.$$p=(o=function(e){var t=o.$$s||this;return null==t.console&&(t.console=i),null==e&&(e=i),t.console.$save_to_localstorage(),t.$handle_command(e)},o.$$s=d,o.$$arity=1,o),t).call(a),d.dropped_abc="T: nothing dropped yet",l.log=pe.get("ConsoleLogger").$new(d.console),l.log.$info("Welcome to Zupfnoter"),l.log.$info("Zupfnoter "+pe.get("VERSION")),l.log.$info("Opal:     "+pe.get("RUBY_ENGINE_VERSION")),l.log.$info("Ruby:     "+pe.get("RUBY_VERSION")),l.log.$info("Abc2svg:  "+abc2svg.version),l.log.$info("Browser:  "+bowser.name+"  "+bowser.version),l.log.$info("Language: "+g),d.$check_suppoerted_browser(),l.conf=pe.get("Confstack").$new(i),t=[!1],c=l.conf,c["$strict="].apply(c,t),t[t.length-1],l.conf.$push(d.$_init_conf()),l.resources=s([],{}),l.settings=s(["autoscroll","follow"],{autoscroll:"true",follow:"true"}),d.$call_consumers("settings_menu"),d.json_validator=pe.get("Ajv").$$scope.get("JsonValidator").$new(),d.editor=pe.get("Harpnotes").$$scope.get("TextPane").$new("abcEditor"),t=[d],c=d.editor,c["$controller="].apply(c,t),t[t.length-1],d.harpnote_player=pe.get("Harpnotes").$$scope.get("Music").$$scope.get("HarpnotePlayer").$new(),t=[d],c=d.harpnote_player,c["$controller="].apply(c,t),t[t.length-1],d.songbook=pe.get("LocalStore").$new("songbook"),d.abc_transformer=pe.get("Harpnotes").$$scope.get("Input").$$scope.get("Abc2svgToHarpnotes").$new(),d.dropboxclient=pe.get("Opal").$$scope.get("DropboxJs").$$scope.get("NilClient").$new(),d.systemstatus=s(["version"],{version:pe.get("VERSION")}),d.commands=pe.get("CommandController").$$scope.get("CommandStack").$new(),(t=(c=($=(f=d.$methods()).$select,$.$$p=(p=function(e){p.$$s;return null==e&&(e=i),e["$=~"](/__ic.*/)},p.$$s=d,p.$$arity=1,p),$).call(f)).$each,t.$$p=(u=function(e){var t=u.$$s||this;return null==e&&(e=i),t.$send(e)},u.$$s=d,u.$$arity=1,u),t).call(c),d.$setup_harpnote_preview(),m=d.$class().$get_uri(),y=function(){try{return m["$[]"]("parsed_search")["$[]"]("mode").$last()}catch(t){if(e.rescue(t,[pe.get("StandardError")]))return"work";throw t}}(),d.$cleanup_localstorage(),d.$load_from_loacalstorage(),(t=d.editor.$get_abc_part()["$empty?"]())===i||null==t||t.$$is_boolean&&1!=t||d.$load_demo_tune(),((t=d.systemstatus["$[]"]("view"))===i||null==t||t.$$is_boolean&&1!=t)&&d.$set_status(s(["dropbox","music_model","loglevel","autorefresh","view","mode"],{dropbox:"not connected",music_model:"unchanged",loglevel:l.log.$loglevel(),autorefresh:"off",view:0,mode:y})),d.$set_status(s(["mode"],{mode:y})),((t=d.systemstatus["$[]"]("saveformat"))===i||null==t||t.$$is_boolean&&1!=t)&&d.$set_status(s(["saveformat"],{saveformat:"A3-A4-HTML"})),d.$handle_command("dreconnect"),v=function(){try{return m["$[]"]("parsed_search")["$[]"]("load")}catch(t){if(e.rescue(t,[pe.get("StandardError")]))return i;throw t}}(),!1!==v&&v!==i&&null!=v&&d.$load_from_uri(m["$[]"]("parsed_search")["$[]"]("load")),d.systemstatus["$[]"]("mode")["$=="]("demo")?d.$handle_command("view 0"):(d.editor.$get_lyrics(),b=pe.get("LastRenderMonitor").$new(),(t=b["$ok?"]())===i||null==t||t.$$is_boolean&&1!=t?(l.log.$error(pe.get("I18n").$t("last session failed. Did not render. Cleanup ABC, then render manually")),d.$call_consumers("error_alert")):((t=m["$[]"]("parsed_search")["$[]"]("debug"))===i||null==t||t.$$is_boolean&&1!=t)&&d.$render_previews()),d.$setup_ui_listener(),d.$show_message_of_the_day()},p.$$arity=0),e.defn($e,"$about_zupfnoter",d=function(){return"<p>"+pe.get("I18n").$t("Free software to create sheets for table harps")+"</p>\n         <table>\n          <tbody>\n          <tr><td>Zupfnoter:</td><td>"+pe.get("VERSION")+'</td></tr>\n          <tr><td><a target="_blank" href="http://opalrb.com">Opal</a>:</td><td>'+pe.get("RUBY_ENGINE_VERSION")+"</td></tr>\n          <tr><td>Ruby:</td><td>"+pe.get("RUBY_VERSION")+'</td></tr>\n          <tr><td><a target="_blank" href="http://moinejf.free.fr/js/index.html">abc2svg</a>:</td><td>'+abc2svg.version+'</td></tr>\n          <tr><td><a target="_blank" href="https://wim.vree.org/js/xml2abc-js_index.html">xml2abc.js</a>:</td><td>'+xml2abc_VERSION+"</td></tr>\n         </tbody>\n        </table>\n        <p> "+pe.get("Time").$now().$year()+' Bernhard Weichel - info@zupfnoter.de</p>\n        <p><a target="_blank" href="https://www.zupfnoter.de">Website: https://www.zupfnoter.de</a></p>\n    '},d.$$arity=0),e.defn($e,"$call_consumers",h=function(e){var t,r,n,a,o,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M,N,B,R,j=this;return j.systemstatus_consumers=s(["systemstatus","lock","unlock","localizedtexts","statusline","error_alert","play_start","play_stop","play_stopping","disable_save","enable_save","before_open","document_title","current_notes","settings_menu","extracts"],{systemstatus:[(t=(r=j).$lambda,t.$$p=(n=function(){var e=n.$$s||this;return null==e.systemstatus&&(e.systemstatus=i),update_systemstatus_w2ui(e.systemstatus.$to_n())},n.$$s=j,n.$$arity=0,n),t).call(r)],lock:[(t=(a=j).$lambda,t.$$p=(o=function(){o.$$s;return lockscreen()},o.$$s=j,o.$$arity=0,o),t).call(a)],unlock:[(t=(c=j).$lambda,t.$$p=(u=function(){u.$$s;return unlockscreen()},u.$$s=j,u.$$arity=0,u),t).call(c)],localizedtexts:[(t=($=j).$lambda,t.$$p=(f=function(){f.$$s;return update_localized_texts()},f.$$s=j,f.$$arity=0,f),t).call($)],statusline:[],error_alert:[(t=(p=j).$lambda,t.$$p=(d=function(){var e;d.$$s;return null==l.log&&(l.log=i),(e=l.log["$has_errors?"]())===i||null==e||e.$$is_boolean&&1!=e?i:window.update_error_status_w2ui(l.log.$get_errors().$join("<br/>\n"))},d.$$s=j,d.$$arity=0,d),t).call(p)],play_start:[(t=(h=j).$lambda,t.$$p=(_=function(){_.$$s;return update_play_w2ui("start")},_.$$s=j,_.$$arity=0,_),t).call(h)],play_stop:[(t=(g=j).$lambda,t.$$p=(m=function(){m.$$s;return update_play_w2ui("stop")},m.$$s=j,m.$$arity=0,m),t).call(g)],play_stopping:[(t=(y=j).$lambda,t.$$p=(v=function(){v.$$s;return update_play_w2ui("stopping")},v.$$s=j,v.$$arity=0,v),t).call(y)],disable_save:[(t=(b=j).$lambda,t.$$p=(x=function(){x.$$s;disable_save()},x.$$s=j,x.$$arity=0,x),t).call(b)],enable_save:[(t=(w=j).$lambda,t.$$p=(A=function(){A.$$s;enable_save()},A.$$s=j,A.$$arity=0,A),t).call(w)],before_open:[(t=(k=j).$lambda,t.$$p=(E=function(){E.$$s;return before_open()},E.$$s=j,E.$$arity=0,E),t).call(k)],document_title:[(t=(C=j).$lambda,t.$$p=(S=function(){var e=S.$$s||this;return null==e.music_model&&(e.music_model=i),document.title=e.music_model.$meta_data()["$[]"]("filename")},S.$$s=j,S.$$arity=0,S),t).call(C)],current_notes:[(t=(I=j).$lambda,t.$$p=(O=function(){var e=O.$$s||this;return null==e.harpnote_player&&(e.harpnote_player=i),update_current_notes_w2ui(e.harpnote_player.$get_notes().$join(", "))},O.$$s=j,O.$$arity=0,O),t).call(I)],settings_menu:[(t=(T=j).$lambda,t.$$p=(P=function(){P.$$s;return null==l.settings&&(l.settings=i),update_settings_menu(l.settings.$to_n())},P.$$s=j,P.$$arity=0,P),t).call(T)],extracts:[(t=(M=j).$lambda,t.$$p=(N=function(){var e,t,r,n=N.$$s||this;return null==n.extracts&&(n.extracts=i),(e=(t=n.extracts).$each,e.$$p=(r=function(e){var t=(r.$$s,i);return null==e&&(e=i),t=e.$first()+": "+e.$last(),set_extract_menu(e.$first(),t)},r.$$s=n,r.$$arity=1,r),e).call(t),n.$call_consumers("systemstatus")},N.$$s=j,N.$$arity=0,N),t).call(M)]}),(t=(B=j.systemstatus_consumers["$[]"](e)).$each,t.$$p=(R=function(e){R.$$s;return null==e&&(e=i),e.$call()},R.$$s=j,R.$$arity=1,R),t).call(B)},h.$$arity=1),e.defn($e,"$get_config_form_menu_entries",_=function(){return pe.get("ConfstackEditor").$get_config_form_menu_entries()},_.$$arity=0),e.defn($e,"$handle_command",g=function(t){var r=this,n=i;null==l.log&&(l.log=i),l.log.$clear_errors();try{l.log.$timestamp_start(),l.log.$timestamp(t),r.commands.$run_string(t)}catch(r){if(!e.rescue(r,[pe.get("Exception")]))throw r;n=r;try{l.log.$error(n.$message()+' in command "'+t+'"',i,i,n.$backtrace())}finally{e.pop_exception()}}return r.$call_consumers("error_alert")},g.$$arity=1),e.defn($e,"$handle_parsed_command",m=function(t,r){var n=this,a=i;null==l.log&&(l.log=i),l.log.$clear_errors();try{l.log.$timestamp_start(),l.log.$timestamp(t),n.commands.$run_parsed_command(t,n.$Native(r))}catch(r){if(!e.rescue(r,[pe.get("Exception")]))throw r;a=r;try{l.log.$error(a.$message()+' in command "'+t+'"',i,i,a.$backtrace())}finally{e.pop_exception()}}return n.$call_consumers("error_alert")},m.$$arity=2),e.defn($e,"$save_to_localstorage",y=function(){var e,t,r,n=this,a=i;return a=(e=(t=n.systemstatus).$select,e.$$p=(r=function(e,t){r.$$s;return null==e&&(e=i),null==t&&(t=i),["last_read_info_id","zndropboxlogincmd","music_model","view","autorefresh","loglevel","nwworkingdir","dropboxapp","dropboxpath","dropboxloginstate","perspective","saveformat","zoom"]["$include?"](e)},r.$$s=n,r.$$arity=2,r),e).call(t).$to_json(),n.systemstatus["$[]"]("mode")["$=="]("work")&&localStorage.setItem("systemstatus",a),n.editor.$save_to_localstorage()},y.$$arity=0),e.defn($e,"$load_from_uri",v=function(e){var t,r,n,a,o,s,l,c,u,$=this;return(t=(r=(a=(o=(l=(c=pe.get("HTTP").$get(e)).$then,l.$$p=(u=function(e){var t=u.$$s||this;return null==t.editor&&(t.editor=i),null==e&&(e=i),t.editor.$set_text(e.$body())},u.$$s=$,u.$$arity=1,u),l).call(c)).$fail,a.$$p=(s=function(t){var r=s.$$s||this;return null==t&&(t=i),r.$alert("could not load from URL: "+e)},s.$$s=$,s.$$arity=1,s),a).call(o)).$always,t.$$p=(n=function(e){n.$$s;return null==e&&(e=i),i},n.$$s=$,n.$$arity=1,n),t).call(r)},v.$$arity=1),e.defn($e,"$load_from_loacalstorage",b=function(){var e=this,t=i;return e.editor.$restore_from_localstorage(),t=pe.get("JSON").$parse(localStorage.getItem("systemstatus")),!1!==t&&t!==i&&null!=t&&e.$set_status(t),i},b.$$arity=0),e.defn($e,"$cleanup_localstorage",x=function(){var e,t,r,n=this,a=i,o=i;return a=Object.keys(localStorage),o=(e=(t=a).$select,e.$$p=(r=function(e){r.$$s;return null==e&&(e=i),e.$match(/dropbox\-auth:default:/)},r.$$s=n,r.$$arity=1,r),e).call(t),((e=o["$empty?"]())===i||null==e||e.$$is_boolean&&1!=e)&&(localStorage.removeItem(o.$first()),localStorage.removeItem("systemstatus")),localStorage.setItem("zupfnoterVersion",pe.get("VERSION")),i},x.$$arity=0),e.defn($e,"$load_demo_tune",w=function(){var e=this,t=i;return t='X:21\nF:21_Ich_steh_an_deiner_krippen_hier\nT:Ich steh an deiner Krippen hier\nC:Nr. 59 aus dem Weihnachtsoratorium\nC:Joh. Seb. Bach\nC:Kirchenchor Mattighofen\n%%score ( 1 2 ) ( 3 4 )\nL:1/4\nQ:1/4=80.00\nM:4/4\nI:linebreak $\nK:G\nV:1 treble nm="Sopran Alt"\nV:2 treble\nV:3 bass nm="Tenor Bass"\nV:4 bass\nV:1\nG | G/A/ B A G | A A !fermata!B G/A/ |\nB c d c/B/ | A/G/ A !fermata!G :| B | B A G F |\nG/A/ B !fermata!A A | G F G D | G A !fermata!B G/A/ |\nB c d c/B/ | A/G/ A !fermata!G z |]\nV:2\nD | E/F/ G G/F/ G | G F G E/F/ |\nG/ B A/4G/4 F G | G F D :| z | G3/2 F/ F/E/ E/^D/ |\nE D D D | D/C/ D D/C/ B, | B, E ^D B, |\nE E D/E/2 G | G F D z |]\nV:3\nB, | B, E E/D/ D | E/C/ A,/D/ !fermata!D E |\nD G,/A,/ B,/C/ D | D C/B,/ !fermata!B, :| D | D D/C/ B,/C/ F,/B,/ |\nB,/A,/ A,/G,/ !fermata!F, F, | G,/A,/ B,/C/ B,/A,/ G, | G, F,/E,/ !fermata!F, E,/F,/ |\nG,3/2 A,/ B,/C/ D | D C/B,/ !fermata!B, z |]\nV:4\nG,/F,/ | E,3/2 D,/ C,3/2 B,,/ | C,/A,,/ D, G,, C, |\nG,/F,/ E, B,/A,/ G, | D D, G, :| z | B,/C/ D/2-D/2 G,/A,/ B, |\nE,/F,/ G, D, D/C/ | B,3/2 A,/ G,3/2 F,/ | E,/D,/ C, B,, E,/-E,/ |\nE,/D,/ C, B,,/A,,/ G,, | D,2 G,, z |]\n\n%%%%zupfnoter.config\n\n{\n  "produce"     : [1],\n  "annotations" : {\n    "refn" : {\n      "pos"  : [20, 10],\n      "text" : "referenced note",\n      "id"   : "refn"\n    }\n  },\n  "extract"     : {\n    "0" : {\n      "voices"      : [1, 2, 3, 4],\n      "flowlines"   : [1, 3],\n      "layoutlines" : [1, 2, 3, 4],\n      "legend"      : {"pos": [310, 175], "spos": [310, 182]},\n      "notes"       : {\n        "1" : {\n          "pos"   : [340, 10],\n          "text"  : "Ich steh an deiner Krippen hier",\n          "style" : "strong"\n        }\n      },\n      "lyrics"      : {\n        "1" : {\n          "verses" : [1, 2, 3, 4, 5, 6, 7, 8],\n          "pos"    : [10, 100]\n        }\n      }\n    }\n  },\n  "$schema"     : "https://zupfnoter.weichel21.de/schema/zupfnoter-config_1.0.json",\n  "$version"    : "1.4.0 beta 2"\n}\n',e.editor.$set_text(t)},w.$$arity=0),e.defn($e,"$render_a3",A=function(e){var t=this,r=i,n=i;return null==l.settings&&(l.settings=i),null==e&&(e=t.systemstatus["$[]"]("view")),r=l.settings["$[]"]("flowconf"),l.settings["$[]="]("flowconf",!1),n=pe.get("Harpnotes").$$scope.get("PDFEngine").$new().$draw(t.$layout_harpnotes(e,"A3")),l.settings["$[]="]("flowconf",r),n},A.$$arity=-1),e.defn($e,"$render_a4",k=function(e){var t=this,r=i,n=i;return null==l.settings&&(l.settings=i),null==e&&(e=t.systemstatus["$[]"]("view")),r=l.settings["$[]"]("flowconf"),l.settings["$[]="]("flowconf",!1),n=pe.get("Harpnotes").$$scope.get("PDFEngine").$new().$draw_in_segments(t.$layout_harpnotes(e,"A4")),l.settings["$[]="]("flowconf",r),n},k.$$arity=-1),e.defn($e,"$migrate_config",E=function(e){var t,r,n=this,a=i,o=i,c=i,u=i,$=i,f=i;return null==l.version&&(l.version=i),a=pe.get("Confstack").$new(!1),t=[!1],r=a,r["$strict="].apply(r,t),t[t.length-1],o=pe.get("Confstack").$new(!1),t=[!1],r=o,r["$strict="].apply(r,t),t[t.length-1],o.$push(e.$clone()),a.$push(e),(t=e["$[]"]("extract"))===i||null==t||t.$$is_boolean&&1!=t||(c=n.$migrate_config_lyrics(a),a.$push(c),u=n.$migrate_notes(a),a.$push(u)),a["$[]="]("$schema",pe.get("SCHEMA_VERSION")),$=n.$migrate_config_cleanup(a.$get()),f=o.$get()["$=="]($)?s(["changed","message","oldversion"],{changed:!1,message:"",oldversion:o["$[]"](l.version)}):s(["changed","message","oldversion"],{changed:!0,message:pe.get("I18n").$t(pe.get("I18n").$t("Please double check the generated sheets.\n\nYour abc file was automatically migrated\nto Zupfnoter version"))+" "+pe.get("VERSION"),oldversion:o["$[]"]("$version")}),$["$[]="]("$version",pe.get("VERSION")),[$,f]},E.$$arity=1),e.defn($e,"$migrate_config_cleanup",C=function(e){var t,r,n,a=this;return(t=e["$[]"]("extract"))===i||null==t||t.$$is_boolean&&1!=t||(t=(r=e["$[]"]("extract")).$each,t.$$p=(n=function(e,t){var r=(n.$$s,i);return null==e&&(e=i),null==t&&(t=i),r=t["$[]"]("lyrics"),!1!==r&&r!==i&&null!=r?r.$delete("versepos"):i},n.$$s=a,n.$$arity=2,n),t).call(r),e},C.$$arity=1),e.defn($e,"$migrate_config_lyrics",S=function(e){var r,n,a,o=this,l=i;return l=(r=(n=e["$[]"]("extract")).$inject,r.$$p=(a=function(e,r){var n,o,l,c=a.$$s||this,u=i,$=i;return null==e&&(e=i),null==r&&(r=i),u=r.$last()["$[]"]("lyrics"),!1!==u&&u!==i&&null!=u&&(u=u["$[]"]("versepos")),!1!==u&&u!==i&&null!=u&&($=(n=(o=u).$inject,n.$$p=(l=function(e,r){var n,a,o,c=l.$$s||this,u=i;return null==e&&(e=i),null==r&&(r=i),u=(n=(a=r.$first().$gsub(","," ").$split(" ")).$map,n.$$p=(o=function(e){o.$$s;return null==e&&(e=i),e.$to_i()},o.$$s=c,o.$$arity=1,o),n).call(a),e["$[]="](t(e.$count(),1).$to_s(),s(["verses","pos"],{verses:u,pos:r.$last()})),e},l.$$s=c,l.$$arity=2,l),n).call(o,s([],{})),e["$[]="](r.$first(),s(["lyrics"],{lyrics:$}))),e},a.$$s=o,a.$$arity=2,a),r).call(n,s([],{})),s(["extract"],{extract:l})},S.$$arity=1),e.defn($e,"$migrate_notes",I=function(e){var r,n,a,o=this,l=i;return l=(r=(n=e["$[]"]("extract")).$inject,r.$$p=(a=function(e,r){var n,o,l,c=a.$$s||this,u=i,$=i;return null==e&&(e=i),null==r&&(r=i),u=r.$last()["$[]"]("notes"),(n=u["$is_a?"](pe.get("Array")))===i||null==n||n.$$is_boolean&&1!=n||($=(n=(o=u).$inject,n.$$p=(l=function(e,r){l.$$s;return null==e&&(e=i),null==r&&(r=i),e["$[]="](t(e.$count(),1).$to_s(),r),e},l.$$s=c,l.$$arity=2,l),n).call(o,s([],{})),e["$[]="](r.$first(),s(["notes"],{notes:$}))),e},a.$$s=o,a.$$arity=2,a),r).call(n,s([],{})),s(["extract"],{extract:l})},I.$$arity=1),e.defn($e,"$play_abc",O=function(e){var t,r,n,a,o,s,c=this,u=i;return null==e&&(e="music_model"),u=(t=c.systemstatus["$[]"]("harpnotes_dirty"))===i||null==t||t.$$is_boolean&&1!=t?pe.get("Promise").$new().$resolve():c.$render_previews(),(t=(r=(a=(o=u).$then,a.$$p=(s=function(){var t,r,n,a=s.$$s||this;return(t=(r=pe.get("Promise").$new()).$tap,t.$$p=(n=function(t){var r,a=n.$$s||this;return null==a.harpnote_player&&(a.harpnote_player=i),null==t&&(t=i),(r=a.harpnote_player["$is_playing?"]())===i||null==r||r.$$is_boolean&&1!=r?(a.$call_consumers("play_start"),e["$=="]("auto")&&a.harpnote_player.$play_auto(),e["$=="]("music_model")&&a.harpnote_player.$play_song(),e["$=="]("selection")&&a.harpnote_player.$play_selection(),e["$=="]("selection_ff")&&a.harpnote_player.$play_from_selection()):(a.$call_consumers("play_stopping"),a.$stop_play_abc()),t.$resolve()},n.$$s=a,n.$$arity=1,n),t).call(r)},s.$$s=c,s.$$arity=0,s),a).call(o)).$fail,t.$$p=(n=function(e){var t=n.$$s||this;return null==l.log&&(l.log=i),null==e&&(e=i),l.log.$error("bug: Error in player "+e,"controller",567),t.$call_consumers("error_alert")},n.$$s=c,n.$$arity=1,n),t).call(r)},O.$$arity=-1),e.defn($e,"$stop_play_abc",T=function(){return this.harpnote_player.$stop()},T.$$arity=0),e.defn($e,"$render_tunepreview_callback",P=function(){var t,r,n,a,o,s=this,c=i,u=i;null==l.log&&(l.log=i),s.$setup_tune_preview();try{c=s.editor.$get_abc_part(),c=(t=(r=c.$split("\n")).$map,t.$$p=(n=function(e){var t,r,a,o=n.$$s||this,s=i;return null==e&&(e=i),s=e,(t=e["$start_with?"]("W:"))===i||null==t||t.$$is_boolean&&1!=t||(s=(t=(r=s).$gsub,t.$$p=(a=function(e){a.$$s;return null==e&&(e=i),e["$[]"](0)["$=="]("\\")?e["$[]"](1):" "},a.$$s=o,a.$$arity=1,a),t).call(r,/(\\?)(~)/)),s},n.$$s=s,n.$$arity=1,n),t).call(r).$join("\n"),(t=(a=l.log).$benchmark,t.$$p=(o=function(){var e=o.$$s||this;return null==e.tune_preview_printer&&(e.tune_preview_printer=i),null==e.editor&&(e.editor=i),e.tune_preview_printer.$draw(c,e.editor.$get_checksum())},o.$$s=s,o.$$arity=0,o),t).call(a,"render tune preview")}catch(t){if(!e.rescue(t,[pe.get("Exception")]))throw t;u=t;try{l.log.$error("Bug "+u.$message(),i,i,u.$backtrace())}finally{e.pop_exception()}}return s.$set_inactive("#tunePreview"),s.editor.$set_annotations(l.log.$annotations()),i},P.$$arity=0),e.defn($e,"$render_harpnotepreview_callback",M=function(){var t,r,n,a=this;return null==l.log&&(l.log=i),(t=(r=l.log).$benchmark,t.$$p=(n=function(){var t,r=n.$$s||this,a=i;null==r.systemstatus&&(r.systemstatus=i),null==r.song_harpnotes&&(r.song_harpnotes=i),null==r.harpnote_player&&(r.harpnote_player=i),null==r.music_model&&(r.music_model=i),null==r.harpnote_preview_printer&&(r.harpnote_preview_printer=i),null==l.log&&(l.log=i);try{l.log.$debug("viewid: "+r.systemstatus["$[]"]("view")+" controller 608"),r.song_harpnotes=r.$layout_harpnotes(r.systemstatus["$[]"]("view"),"A3"),(t=r.song_harpnotes)===i||null==t||t.$$is_boolean&&1!=t||(r.harpnote_player.$load_song(r.music_model,r.song_harpnotes.$active_voices()),r.harpnote_preview_printer.$draw(r.song_harpnotes),r.$set_status(s(["harpnotes_dirty"],{harpnotes_dirty:!1})))}catch(t){if(!e.rescue(t,[pe.get("Exception")]))throw t;a=t;try{l.log.$error("Bug "+a.$message(),i,i,a.$backtrace())}finally{e.pop_exception()}}return r.$set_status(s(["refresh"],{refresh:!1}))},n.$$s=a,n.$$arity=0,n),t).call(r,"render_harpnotepreview_callback"),i},M.$$arity=0),e.defn($e,"$render_previews",N=function(){var e,t,r,n,a,o,c,u,$,f=this;return null==l.log&&(l.log=i),f.editor.$resize(),l.log.$info("rendering"),f.$set_status(s(["harpnotes_dirty"],{harpnotes_dirty:!0})),l.log.$clear_errors(),l.log.$clear_annotations(),f.systemstatus["$[]"]("autorefresh")["$=="]("remote")||(f.$save_to_localstorage(),f.$send_remote_command("render")),(e=(t=(n=(a=(c=(u=pe.get("Promise").$new()).$tap,c.$$p=($=function(e){var t=$.$$s||this;return null==e&&(e=i),pe.get("LastRenderMonitor").$new().$set_active(),t.$set_active("#tunePreview"),setTimeout(function(){t.$render_tunepreview_callback(),e.$resolve()},0)},$.$$s=f,$.$$arity=1,$),c).call(u)).$fail,n.$$p=(o=function(){return(o.$$s||this).$alert("fail")},o.$$s=f,o.$$arity=0,o),n).call(a)).$then,e.$$p=(r=function(){var e,t,n,a,o,s,c,u,$,f=r.$$s||this;return(e=(t=(a=(o=(c=(u=pe.get("Promise").$new()).$tap,c.$$p=($=function(e){var t=$.$$s||this;return null==t.harpnote_preview_printer&&(t.harpnote_preview_printer=i),null==e&&(e=i),t.$set_active("#harpPreview"),t.harpnote_preview_printer.$clear(),setTimeout(function(){t.$render_harpnotepreview_callback(),e.$resolve()},50)},$.$$s=f,$.$$arity=1,$),c).call(u)).$fail,a.$$p=(s=function(){return(s.$$s||this).$alert("fail")},s.$$s=f,s.$$arity=0,s),a).call(o)).$then,e.$$p=(n=function(){var e,t,r,a=n.$$s||this;return(e=(t=pe.get("Promise").$new()).$tap,e.$$p=(r=function(e){var t=r.$$s||this;return null==t.editor&&(t.editor=i),null==l.log&&(l.log=i),null==e&&(e=i),t.$call_consumers("error_alert"),t.$set_inactive("#harpPreview"),t.editor.$set_annotations(l.log.$annotations()),pe.get("LastRenderMonitor").$new().$clear(),e.$resolve()},r.$$s=a,r.$$arity=1,r),e).call(t)},n.$$s=f,n.$$arity=0,n),e).call(t)},r.$$s=f,r.$$arity=0,r),e).call(t)},N.$$arity=0),e.defn($e,"$render_remote",B=function(){var e=this;return e.$set_status(s(["refresh"],{refresh:!1})),e.$save_to_localstorage(),e.$render_tunepreview_callback(),e.$send_remote_command("render")},B.$$arity=0),e.defn($e,"$save_file",R=function(){var e=this,t=i,r=i,n=i;return t=pe.get("JSZip").$$scope.get("ZipFile").$new(),t.$file("song.abc",e.editor.$get_text()),t.$file("harpnotes_a4.pdf",e.$render_a4().$output("blob")),t.$file("harpnotes_a3.pdf",e.$render_a3().$output("blob")),r=t.$to_blob(),n="song"+pe.get("Time").$now().$strftime("%d%m%Y%H%M%S")+".zip",window.saveAs(r,n)},R.$$arity=0),e.defn($e,"$layout_harpnotes",j=function(t,r){var n,a,o,s,c,u,$,f,p,d=this,h=i,_=i,g=i,m=i;null==l.conf&&(l.conf=i),null==l.log&&(l.log=i),null==t&&(t=0),null==r&&(r="A4"),h=d.$get_config_from_editor(),l.conf.$reset_to(1),l.conf.$push(h),l.image_list=function(){try{return l.conf.$get()["$[]"]("resources").$keys()}catch(t){if(e.rescue(t,[pe.get("StandardError")]))return i;throw t}}(),_=l.conf["$[]"]("produce"),d.extracts=(n=(a=l.conf.$get("extract")).$inject,n.$$p=(o=function(e,t){var r,n=(o.$$s,i),a=i,s=i;return null==e&&(e=i),null==t&&(t=i),n=t.$last().$dig("filenamepart"),a=function(){return(r=_["$include?"](t.$first().$to_i()))===i||null==r||r.$$is_boolean&&1!=r?" ":"*  "}(),s=""+a+n+" "+t.$last()["$[]"]("title")+" ",e.$push([t.$first(),s])},o.$$s=d,o.$$arity=2,o),n).call(a,[]),d.$call_consumers("extracts");try{try{(n=(s=l.log).$benchmark,n.$$p=(c=function(){var e,t,r=c.$$s||this;return null==r.json_validator&&(r.json_validator=i),null==l.log&&(l.log=i),null==l.settings&&(l.settings=i),null==l.conf&&(l.conf=i),r.validation_errors=[],(e=!1!==(t=l.log.$loglevel()["$=="]("debug"))&&t!==i&&null!=t?t:l.settings["$[]"]("validate")["$=="]("true"))===i||null==e||e.$$is_boolean&&1!=e?i:r.validation_errors=r.json_validator.$validate_conf(l.conf)},c.$$s=d,c.$$arity=0,c),n).call(s,"validate default conf"),(n=(u=l.log).$benchmark,n.$$p=($=function(){return($.$$s||this).$load_music_model()},$.$$s=d,$.$$arity=0,$),n).call(u,"transforming music model"),d.$call_consumers("document_title"),g=i,(n=(f=l.log).$benchmark,n.$$p=(p=function(){var e,n,a=p.$$s||this,o=i;return null==a.music_model&&(a.music_model=i),o=pe.get("Harpnotes").$$scope.get("Layout").$$scope.get("Default").$new(),e=[a.$get_placeholder_replacers(t)],n=o,n["$placeholders="].apply(n,e),e[e.length-1],g=o.$layout(a.music_model,i,t,r)},p.$$s=d,p.$$arity=0,p),n).call(f,"computing layout"),d.editor.$set_annotations(l.log.$annotations())}catch(t){if(!e.rescue(t,[pe.get("Exception")]))throw t;m=t;try{l.log.$error(""+m.$message(),i,i,m.$backtrace())}finally{e.pop_exception()}}}finally{l.conf.$pop()}return g},j.$$arity=-1),e.defn($e,"$get_placeholder_replacers",F=function(e){var t,r,n,a,o,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C=this;return s(["composer","key","meter","number","o_key","tempo","title","extract_title","extract_filename","printed_extracts","watermark"],{composer:(t=(r=C).$lambda,t.$$p=(n=function(){var e=n.$$s||this;return null==e.music_model&&(e.music_model=i),e.music_model.$meta_data()["$[]"]("composer")},n.$$s=C,n.$$arity=0,n),t).call(r),key:(t=(a=C).$lambda,t.$$p=(o=function(){var e=o.$$s||this;return null==e.music_model&&(e.music_model=i),e.music_model.$meta_data()["$[]"]("key")},o.$$s=C,o.$$arity=0,o),t).call(a),meter:(t=(c=C).$lambda,t.$$p=(u=function(){var e=u.$$s||this;return null==e.music_model&&(e.music_model=i),e.music_model.$meta_data()["$[]"]("meter").$join(" ")},u.$$s=C,u.$$arity=0,u),t).call(c),number:(t=($=C).$lambda,t.$$p=(f=function(){var e=f.$$s||this;return null==e.music_model&&(e.music_model=i),e.music_model.$meta_data()["$[]"]("number")},f.$$s=C,f.$$arity=0,f),t).call($),o_key:(t=(p=C).$lambda,t.$$p=(d=function(){var e=d.$$s||this;return null==e.music_model&&(e.music_model=i),e.music_model.$meta_data()["$[]"]("o_key")},d.$$s=C,d.$$arity=0,d),t).call(p),tempo:(t=(h=C).$lambda,t.$$p=(_=function(){var e=_.$$s||this;return null==e.music_model&&(e.music_model=i),e.music_model.$meta_data()["$[]"]("tempo_display")},_.$$s=C,_.$$arity=0,_),t).call(h),title:(t=(g=C).$lambda,t.$$p=(m=function(){var e=m.$$s||this;return null==e.music_model&&(e.music_model=i),e.music_model.$meta_data()["$[]"]("title")},m.$$s=C,m.$$arity=0,m),t).call(g),extract_title:(t=(y=C).$lambda,t.$$p=(v=function(){v.$$s;return null==l.conf&&(l.conf=i),l.conf["$[]"]("extract."+e+".title")},v.$$s=C,v.$$arity=0,v),t).call(y),extract_filename:(t=(b=C).$lambda,t.$$p=(x=function(){x.$$s;return null==l.conf&&(l.conf=i),l.conf["$[]"]("extract."+e+".filenamepart")},x.$$s=C,x.$$arity=0,x),t).call(b),printed_extracts:(t=(w=C).$lambda,t.$$p=(A=function(){var e,t,r,n=A.$$s||this;return null==l.conf&&(l.conf=i),(e=(t=l.conf["$[]"]("produce")).$map,e.$$p=(r=function(e){r.$$s;return null==l.conf&&(l.conf=i),null==e&&(e=i),l.conf["$[]"]("extract."+e+".filenamepart")},r.$$s=n,r.$$arity=1,r),e).call(t).$join(" ")},A.$$s=C,A.$$arity=0,A),t).call(w),watermark:(t=(k=C).$lambda,t.$$p=(E=function(){var e;E.$$s;return null==l.settings&&(l.settings=i),!1!==(e=l.settings["$[]"]("watermark"))&&e!==i&&null!=e?e:""},E.$$s=C,E.$$arity=0,E),t).call(k)})},F.$$arity=1),e.defn($e,"$load_music_model",D=function(){var t,r,n=this,a=i,o=i,s=i;return null==l.conf&&(l.conf=i),a=l.conf.$get("abc_parser"),o=pe.get("Harpnotes").$$scope.get("Input").$$scope.get("ABCToHarpnotesFactory").$create_engine(a),r=o.$transform(n.editor.$get_abc_part()),t=e.to_ary(r),n.music_model=null==t[0]?i:t[0],s=null==t[1]?i:t[1],n.abc_model=o.$abc_model(),t=[s],r=n.harpnote_player,r["$player_model_abc="].apply(r,t),t[t.length-1],t=[n.editor.$get_checksum()],r=n.music_model,r["$checksum="].apply(r,t),t[t.length-1]},D.$$arity=0),e.defn($e,"$get_config_from_editor",L=function(){var t,r,n=this,a=i,o=i;return null==l.log&&(l.log=i),r=n.editor.$get_config_model(),t=e.to_ary(r),a=null==t[0]?i:t[0],o=null==t[1]?i:t[1],!1!==o&&o!==i&&null!=o&&(r=n.$migrate_config(a),t=e.to_ary(r),a=null==t[0]?i:t[0],o=null==t[1]?i:t[1],(t=o["$[]"]("changed"))===i||null==t||t.$$is_boolean&&1!=t||(l.log.$info(o["$[]"]("message")),n.editor.$set_config_model(a,"{migrated config}",!0))),a},L.$$arity=0),e.defs($e,"$get_uri",z=function(){var e=this,t=i;t=i,t=new URL(window.location.href);var r={};return t.search.substr(1).split("&").forEach(function(e){var t=e.split("="),n=t[0],a=t[1]&&decodeURIComponent(t[1]);(r[n]=r[n]||[]).push(a)}),t.parsed_search=r,e.$Native(t)},z.$$arity=0),e.defn($e,"$highlight_abc_object_by_player_callback",q=function(e,t){var r,n,a,o,s,l=this,c=i,u=i;return c=pe.get("Element").$find("._"+e+"_"),!1!==t&&t!==i&&null!=t?(c.$add_class("highlightplay"),l.tune_preview_printer.$scroll_into_view(c.$first()),!1!==(u=(r=(n=c).$select,r.$$p=(a=function(e){a.$$s;return null==e&&(e=i),e["$has_class?"]("znref")},a.$$s=l,a.$$arity=1,a),r).call(n).$last())&&u!==i&&null!=u&&l.harpnote_preview_printer.$scroll_to_element((r=(o=c).$select,r.$$p=(s=function(e){s.$$s;return null==e&&(e=i),e["$has_class?"]("znref")},s.$$s=l,s.$$arity=1,s),r).call(o).$last())):c.$remove_class("highlightplay"),i},q.$$arity=2),e.defn($e,"$highlight_abc_object",U=function(e){var t,n=this,a=i,o=i,s=i;return a=n.$Native(e),o=a["$[]"]("startChar"),s=a["$[]"]("endChar"),s["$=="](o)&&(s=r(s,5)),((t=n.harpnote_player["$is_playing?"]())===i||null==t||t.$$is_boolean&&1!=t)&&(n.editor.$select_range_by_position(o,s,n.expand_selection),n.$call_consumers("current_notes")),n.tune_preview_printer.$range_highlight_more(a["$[]"]("startChar"),a["$[]"]("endChar")),n.harpnote_preview_printer.$range_highlight_more(a["$[]"]("startChar"),a["$[]"]("endChar"))},U.$$arity=1),e.defn($e,"$unhighlight_abc_object",H=function(e){var t=this,r=i;return r=t.$Native(e),t.tune_preview_printer.$range_unhighlight_more(r["$[]"]("startChar"),r["$[]"]("endChar")),t.harpnote_preview_printer.$range_unhighlight(r["$[]"]("startChar"),r["$[]"]("endChar"))},H.$$arity=1),e.defn($e,"$select_abc_object",G=function(e){return this.$highlight_abc_object(e)},G.$$arity=1),e.defn($e,"$select_by_time_segments",Y=function(t){var r,n,a,o,s,l,c,u=this,$=i,f=i;return $=[],f=(r=(n=u.abc_model["$[]"]("voices")).$map,r.$$p=(a=function(e){a.$$s;return null==e&&(e=i),e["$[]"]("symbols")},a.$$s=u,a.$$arity=1,a),r).call(n),(r=(o=t).$each,r.$$p=(s=function(t){var r,n,a,o=s.$$s||this;return null==t&&(t=i),(r=(n=f).$each,r.$$p=(a=function(r){var n,o,s,l,c,u,f=a.$$s||this,p=i;return null==r&&(r=i),p=(n=(o=(l=(c=r).$select,l.$$p=(u=function(e){u.$$s;return null==e&&(e=i),
[5,6,12,14]["$include?"](e["$[]"]("type"))["$!"]()},u.$$s=f,u.$$arity=1,u),l).call(c)).$select,n.$$p=(s=function(r){var n;s.$$s;return null==r&&(r=i),(n=r["$[]"]("time"))["$between?"].apply(n,e.to_a(t))},s.$$s=f,s.$$arity=1,s),n).call(o),(n=p["$empty?"]())===i||null==n||n.$$is_boolean&&1!=n?$.$push([p.$first(),p.$last()]):i},a.$$s=o,a.$$arity=1,a),r).call(n)},s.$$s=u,s.$$arity=1,s),r).call(o),(r=(l=$).$each,r.$$p=(c=function(e){var t=c.$$s||this;return null==t.editor&&(t.editor=i),null==e&&(e=i),e["$=="]($.$first())?t.editor.$select_range_by_position(e.$first()["$[]"]("istart"),e.$last()["$[]"]("iend")):t.editor.$select_add_range_by_position(e.$first()["$[]"]("istart"),e.$last()["$[]"]("iend"))},c.$$s=u,c.$$arity=1,c),r).call(l)},Y.$$arity=1),e.defn($e,"$get_selected_time_segments",Q=function(){var n,a,o,s=this,c=i;return null==l.log&&(l.log=i),c=s.editor.$get_selection_ranges(),l.log.$info(c.$to_json()),(n=(a=c).$map,n.$$p=(o=function(n){var a,s,c,u=o.$$s||this,$=i,f=i,p=i,d=i;return null==u.abc_model&&(u.abc_model=i),null==l.log&&(l.log=i),null==n&&(n=i),$=n.$to_a(),$.$first()["$=="]($.$last())||($=[$.$first(),r($.$last(),1)]),f=(a=(s=u.abc_model["$[]"]("voices")).$map,a.$$p=(c=function(t){var r,n,a,o=c.$$s||this;return null==t&&(t=i),(r=(n=t["$[]"]("symbols")).$select,r.$$p=(a=function(t){var r,n,o;a.$$s;return null==t&&(t=i),!1!==(r=(n=t["$[]"]("istart"))["$between?"].apply(n,e.to_a($)))&&r!==i&&null!=r?r:(o=t["$[]"]("iend"))["$between?"].apply(o,e.to_a($))},a.$$s=o,a.$$arity=1,a),r).call(n)},c.$$s=u,c.$$arity=1,c),a).call(s),p=f.$flatten().$compact(),l.log.$info(p.$to_json()),(a=p["$empty?"]())===i||null==a||a.$$is_boolean&&1!=a?d=[p.$first()["$[]"]("time"),r(t(p.$last()["$[]"]("time"),p.$last()["$[]"]("dur")),1)]:(l.log.$error(pe.get("I18n").$t("your cursor is not within a voice")),d=[0,0]),d},o.$$s=s,o.$$arity=1,o),n).call(a)},Q.$$arity=0),e.defn($e,"$set_status",V=function(e){var t,r,n=this;return null==l.log&&(l.log=i),n.systemstatus["$merge!"](e),l.log.$debug(n.systemstatus.$to_s()+" controller 953"),n.systemstatus["$[]"]("loglevel")["$=="](l.log.$loglevel())||(t=[n.systemstatus["$[]"]("loglevel")],r=l.log,r["$loglevel="].apply(r,t),t[t.length-1]),n.$save_to_localstorage(),n.$call_consumers("systemstatus"),i},V.$$arity=1),e.defn($e,"$set_status_dropbox_status",X=function(){var e=this;return e.$set_status(s(["dropbox","dropboxapp","dropboxpath","dropboxloginstate"],{dropbox:e.dropboxclient.$app_name()+": "+e.dropboxpath,dropboxapp:e.dropboxclient.$app_id(),dropboxpath:e.dropboxpath,dropboxloginstate:e.dropboxloginstate}))},X.$$arity=0),e.defn($e,"$clear_status_dropbox_status",W=function(){var e=this;return e.$set_status(s(["dropbox","dropboxapp","dropboxpath","dropboxloginstate"],{dropbox:e.dropboxclient.$app_name()+": "+e.dropboxpath,dropboxapp:i,dropboxpath:i,dropboxloginstate:i}))},W.$$arity=0),$e.$private(),e.defn($e,"$setup_harpnote_preview",J=function(){var e,r,n,a,o,l,c,u,f,p,d,h=this;return h.harpnote_preview_printer=pe.get("Harpnotes").$$scope.get("SvgEngine").$new("harpPreview",2200,1400),h.harpnote_preview_printer.$set_view_box(0,0,420,297),(e=(r=h.harpnote_preview_printer).$on_select,e.$$p=(n=function(e){var t=n.$$s||this;return null==e&&(e=i),t.$select_abc_object(e.$origin())},n.$$s=h,n.$$arity=1,n),e).call(r),(e=(a=h.harpnote_preview_printer).$on_annotation_drag_end,e.$$p=(o=function(e){var r,n,a,s=o.$$s||this,l=i,c=i;return null==s.editor&&(s.editor=i),null==s.config_form_editor&&(s.config_form_editor=i),null==e&&(e=i),l=e["$[]"]("conf_key"),c=e["$[]"]("conf_value_new"),!1!==c&&c!==i&&null!=c||(c=(r=(n=e["$[]"]("conf_value")["$[]"]("pos").$zip(e["$[]"]("delta"))).$map,r.$$p=(a=function(e){a.$$s;return null==e&&(e=i),t(e.$first(),e.$last())},a.$$s=s,a.$$arity=1,a),r).call(n)),s.editor.$patch_config_part(l,c,"drag "+l),(r=s.config_form_editor)===i||null==r||r.$$is_boolean&&1!=r?i:s.config_form_editor.$refresh_form()},o.$$s=h,o.$$arity=1,o),e).call(a),(e=(l=h.harpnote_preview_printer).$on_mouseover,e.$$p=(c=function(e){c.$$s;return null==e&&(e=i),update_mouseover_status_w2ui(e.$conf_key())},c.$$s=h,c.$$arity=1,c),e).call(l),(e=(u=h.harpnote_preview_printer).$on_mouseout,e.$$p=(f=function(e){f.$$s;return null==e&&(e=i),update_mouseover_status_w2ui("")},f.$$s=h,f.$$arity=1,f),e).call(u),(e=(p=h.harpnote_preview_printer).$on_draggable_rightcklick,e.$$p=(d=function(e){var t,r,n,a=d.$$s||this,o=i;return null==e&&(e=i),o=[],(t=e["$[]"]("conf_key"))===i||null==t||t.$$is_boolean&&1!=t||o.$push(s(["id","text","icon"],{id:e["$[]"]("conf_key"),text:pe.get("I18n").$t("Edit Config"),icon:"fa fa-gear"})),(t=(r=e["$[]"]("more_conf_keys")).$each,t.$$p=(n=function(e){var t=(n.$$s,i),r=i,a=i;return null==e&&(e=i),t=e["$[]"]("conf_key"),r=e["$[]"]("text"),a=e["$[]"]("icon"),o.$push(s(["id","text","icon"],{id:t,text:r,icon:a}))},n.$$s=a,n.$$arity=1,n),t).call(r),$(e.$element()).w2menu({items:o.$to_n(),onSelect:function(e){w2ui.layout_left_tabs.click("configtab"),a.$handle_command("editconf "+e.item.id.$gsub(/\.[^\.]+$/,""))}}),!1},d.$$s=h,d.$$arity=1,d),e).call(p)},J.$$arity=0),e.defn($e,"$setup_tune_preview",K=function(){var e,t,r,n=this;return n.tune_preview_printer=pe.get("ABC2SVG").$$scope.get("Abc2Svg").$new(pe.get("Element").$find("#tunePreview")),(e=(t=n.tune_preview_printer).$on_select,e.$$p=(r=function(e){var t=r.$$s||this;return null==e&&(e=i),t.$Native(e),t.$select_abc_object(e)},r.$$s=n,r.$$arity=1,r),e).call(t)},K.$$arity=0),e.defn($e,"$set_harppreview_size",Z=function(e){return this.harpnote_preview_printer.$set_canvas(e)},Z.$$arity=1),e.defn($e,"$toggle_console",ee=function(){var e=this;w2ui.layout.toggle("bottom",!0),e.editor.$resize()},ee.$$arity=0),e.defn($e,"$show_console",te=function(){var e=this;w2ui.layout.show("bottom",!0),e.editor.$resize()},te.$$arity=0),e.defn($e,"$setup_ui_listener",re=function(){var e,r,n,a,o,u,$,f,p,d,h,_,g,m,y,v,b,x,w,A=this;return null==l.window&&(l.window=i),(e=(r=A.editor).$on_change,e.$$p=(n=function(e){var t=n.$$s||this;return null==e&&(e=i),t.$set_status(s(["music_model"],{music_model:"changed"})),t.$set_status(s(["harpnotes_dirty"],{harpnotes_dirty:!0})),t.$request_refresh(!0),i},n.$$s=A,n.$$arity=1,n),e).call(r),(e=(a=A.editor).$on_selection_change,e.$$p=(o=function(e){var t,r,n,a=o.$$s||this,s=i;return null==a.editor&&(a.editor=i),null==a.harpnote_preview_printer&&(a.harpnote_preview_printer=i),null==a.tune_preview_printer&&(a.tune_preview_printer=i),null==e&&(e=i),s=a.editor.$get_selection_ranges(),a.editor.$get_selection_info(),a.harpnote_preview_printer.$unhighlight_all(),a.tune_preview_printer.$unhighlight_all(),(t=(r=s).$each,t.$$p=(n=function(e){var t=n.$$s||this;return null==t.harpnote_preview_printer&&(t.harpnote_preview_printer=i),null==t.tune_preview_printer&&(t.tune_preview_printer=i),null==t.harpnote_player&&(t.harpnote_player=i),null==e&&(e=i),t.harpnote_preview_printer.$range_highlight_more(e.$first(),e.$last()),t.tune_preview_printer.$range_highlight_more(e.$first(),e.$last()),t.harpnote_player.$range_highlight(e.$first(),e.$last())},n.$$s=a,n.$$arity=1,n),t).call(r)},o.$$s=A,o.$$arity=1,o),e).call(a),(e=(u=A.editor).$on_cursor_change,e.$$p=($=function(e){var r,n=$.$$s||this,a=i,o=i,l=i,c=i,u=i,f=i;return null==n.editor&&(n.editor=i),null==e&&(e=i),n.$request_refresh(!1),a=n.editor.$get_selection_info(),o=n.editor.$get_selection_ranges(),l=a["$[]"]("selection"),c=l.$first().$first()+":"+l.$first().$last(),l.$first()["$=="](l.$last())||(c=t(c," - "+l.$last().$first()+":"+l.$last().$last())),u=(r=a["$[]"]("token"))===i||null==r||r.$$is_boolean&&1!=r?s(["type","value"],{type:"",value:""}):a["$[]"]("token"),f=s(["position","tokeninfo","token","selections"],{position:c,tokeninfo:u["$[]"]("type")+" ["+u["$[]"]("value")+"]",token:u,selections:o}),update_editor_status_w2ui(f.$to_n())},$.$$s=A,$.$$arity=1,$),e).call(u),(e=(f=A.harpnote_player).$on_noteon,e.$$p=(p=function(e){var t=p.$$s||this;return null==l.settings&&(l.settings=i),null==e&&(e=i),l.settings["$[]"]("follow")["$=="]("false")?i:t.$highlight_abc_object_by_player_callback(e["$[]"]("startChar"),!0)},p.$$s=A,p.$$arity=1,p),e).call(f),(e=(d=A.harpnote_player).$on_noteoff,e.$$p=(h=function(e){var t=h.$$s||this;return null==l.settings&&(l.settings=i),null==e&&(e=i),l.settings["$[]"]("follow")["$=="]("false")?i:t.$highlight_abc_object_by_player_callback(e["$[]"]("startChar"),!1)},h.$$s=A,h.$$arity=1,h),e).call(d),(e=(_=A.harpnote_player).$on_songoff,e.$$p=(g=function(){var e=g.$$s||this;return e.$stop_play_abc(),e.$call_consumers("play_stop")},g.$$s=A,g.$$arity=0,g),e).call(_),(e=(m=l.window).$on,e.$$p=(y=function(e){var t=y.$$s||this;return null==e&&(e=i),t.expand_selection=e.$shift_key(),!0},y.$$s=A,y.$$arity=1,y),e).call(m,"mousedown"),(e=(v=pe.get("Element").$find("body")).$on,e.$$p=(b=function(e){var t,r,n,a=b.$$s||this,o=i;return null==a.editor&&(a.editor=i),null==a.zupfnoter_ui&&(a.zupfnoter_ui=i),null==e&&(e=i),(t=e.$alt_key())===i||null==t||t.$$is_boolean&&1!=t?(t=!1!==(r=e.$meta_key())&&r!==i&&null!=r?r:e.$ctrl_key())===i||null==t||t.$$is_boolean&&1!=t?i:function(){return o=e.$key_code(),"A".$ord()["$==="](o)?a.editor.$select_range_by_position(0,1e4):"R".$ord()["$==="](o)||13["$==="](o)?(e.$prevent(),a.$render_previews()):"S".$ord()["$==="](o)?(e.$prevent(),a.$handle_command("dsave")):"P".$ord()["$==="](o)?(e.$prevent(),a.$play_abc("auto")):"K".$ord()["$==="](o)?(e.$prevent(),a.$toggle_console()):"L".$ord()["$==="](o)?(a.zupfnoter_ui.toggle_full_screen(),e.$prevent()):function(e){for(var t=0;t<e.length;t++)if(e[t]["$==="](o))return!0;return!1}((t=(r=c(0,9,!1)).$map,t.$$p=(n=function(e){n.$$s;return null==e&&(e=i),e.$to_s().$ord()},n.$$s=a,n.$$arity=1,n),t).call(r))?(e.$prevent(),a.$handle_command("view "+e.$key_code().$chr())):i}():i},b.$$s=A,b.$$arity=1,b),e).call(v,"keydown"),(e=(x=pe.get("Element").$find(window)).$on,e.$$p=(w=function(e){var t,r,n=w.$$s||this,a=i,o=i;return null==n.systemstatus&&(n.systemstatus=i),null==l.log&&(l.log=i),null==e&&(e=i),a=n.$Native(e["$[]"]("originalEvent")).$key(),o=n.$Native(e["$[]"]("originalEvent")).$newValue(),l.log.$debug("got storage event "+a+": "+o+" (controller 1203)"),r=n.systemstatus["$[]"]("autorefresh")["$=="]("remote")?a["$=="]("command"):n.systemstatus["$[]"]("autorefresh")["$=="]("remote"),(t=!1!==r&&r!==i&&null!=r?o["$=="]("render"):r)===i||null==t||t.$$is_boolean&&1!=t?i:n.$load_from_loacalstorage()},w.$$s=A,w.$$arity=1,w),e).call(x,"storage")},re.$$arity=0),e.defn($e,"$show_message_of_the_day",ne=function(){var e=this,t=i,r=i;t=[],r=e.info_url+"/feed/",$.get(r,function(r){$(r).find("item").each(function(){var e=$(this);t.push({title:e.find("title").text(),description:e.find("description").text(),link:e.find("link").text(),pubDate:e.find("pubDate").text(),postId:e.find("post-id").text()})}),e.$present_message_of_the_day(t)})},ne.$$arity=0),e.defn($e,"$present_message_of_the_day",ae=function(e){var t,r,a,o,l,c,u,$=this,f=i,p=i,d=i,h=i,_=i,g=i;if(f=$.$Native(e.$first())["$[]"]("postId").$to_i(),p=!1!==(t=$.$systemstatus()["$[]"]("last_read_info_id"))&&t!==i&&null!=t?t:0,d=(t=(r=$).$lambda,t.$$p=(a=function(){var e=a.$$s||this;return null==e.info_url&&(e.info_url=i),window.open(e.info_url),e.$set_status(s(["last_read_info_id"],{last_read_info_id:f}))},a.$$s=$,a.$$arity=0,a),t).call(r),h=(t=(o=$).$lambda,t.$$p=(l=function(){l.$$s;return i},l.$$s=$,l.$$arity=0,l),t).call(o),_=(t=(c=e).$map,t.$$p=(u=function(e){var t=u.$$s||this,r=i,n=i;return null==e&&(e=i),r=t.$Native(e),n=r["$[]"]("postId"),r["$[]"]("description"),'<div style="text-align:left;"><p>'+n+": "+r["$[]"]("title")+"</p></div>"},u.$$s=$,u.$$arity=1,u),t).call(c).$join(),g=s(["msg","title","width","height","modal","btn_yes","btn_no","callBack"],{msg:_,title:pe.get("I18n").$t("There is new unread information"),width:600,height:200,modal:!0,btn_yes:s(["text","class","style","callBack"],{text:pe.get("I18n").$t("read now"),class:"",style:"",callBack:d}),btn_no:s(["text","class","style","callBack"],{text:pe.get("I18n").$t("read later"),class:"",style:"",callBack:h}),callBack:i}),(t=n(f,p))===i||null==t||t.$$is_boolean&&1!=t)return i;w2confirm(g.$to_n())},ae.$$arity=1),e.defn($e,"$request_refresh",ie=function(e){var t,r,n,a=this,o=i;return!1!==e&&e!==i&&null!=e&&a.$set_status(s(["refresh"],{refresh:!0})),((t=a.refresh_timer["$empty?"]())===i||null==t||t.$$is_boolean&&1!=t)&&(t=(r=a.refresh_timer).$each,t.$$p=(n=function(e){var t=n.$$s||this;return null==t.refresh_timer&&(t.refresh_timer=i),null==e&&(e=i),clearTimeout(e),t.refresh_timer.$pop()},n.$$s=a,n.$$arity=1,n),t).call(r),(t=a.systemstatus["$[]"]("refresh"))===i||null==t||t.$$is_boolean&&1!=t?i:(a.$stop_play_abc(),function(){return o=a.systemstatus["$[]"]("autorefresh"),"on"["$==="](o)?a.refresh_timer.$push(setTimeout(function(){a.$render_previews()},2e3)):"off"["$==="](o)?a.refresh_timer.$push(setTimeout(function(){a.$render_remote()},300)):("remote"["$==="](o),i)}())},ie.$$arity=1),e.defn($e,"$send_remote_command",oe=function(e){return localStorage.setItem("command",""),localStorage.setItem("command",e)},oe.$$arity=1),e.defn($e,"$set_active",se=function(e){return pe.get("Element").$find(e).$add_class("spinner")},se.$$arity=1),e.defn($e,"$set_inactive",le=function(e){return pe.get("Element").$find(e).$remove_class("spinner")},le.$$arity=1),e.defn($e,"$check_suppoerted_browser",ce=function(){var e,r=i,n=i;return null==l.log&&(l.log=i),r=["Chrome","Firefox","Vivaldi","Opera"],(e=r["$include?"](bowser.name))===i||null==e||e.$$is_boolean&&1!=e?(n=t(pe.get("I18n").$t("Unsupported browser. Please use one of "),r.$to_s()),l.log.$warning(n),alert(n)):i},ce.$$arity=0),e.defn($e,"$_init_conf",ue=function(){return pe.get("InitConf").$init_conf()},ue.$$arity=0),i&&"_init_conf"}(a.base)},Opal.modules["controller-cli"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var n=(e.top,e),a=e.nil,i=(e.breaker,e.slice,e.klass),o=e.hash2,s=e.gvars,l=e.module,c=e.range;return e.add_stubs(["$new","$loglevel=","$info","$strict=","$push","$_init_conf","$set_text","$get","$create_engine","$transform","$get_abc_part","$checksum=","$get_checksum","$layout_harpnotes","$include?","$[]","$meta_data","$dig","$harpnote_options","$raise","$each","$[]=","$output","$render_a3","$t","$last","$split","$get_candidate_keys","$map","$join","$to_s","$first","$compact","$gsub","$-","$length","$+","$reverse","$lambda","$_split_parts","$_clean_models","$each_with_index","$==","$start_with?","$_set_config_json","$_set_resources_json","$error"]),function(t,r){function n(){}var a,s=n=i(t,null,"Controller",n);s.$$proto,s.$$scope;e.defs(s,"$get_uri",a=function(){return o(["hostname"],{hostname:"zupfnoter-cli"})},a.$$arity=0)}(n.base),function(t,r){function n(){}var l,c,u,$,f,p=n=i(t,r,"CliController",n),d=p.$$proto,h=p.$$scope;d.editor=d.music_model=a,e.defn(p,"$initialize",l=function(){var e,t,r=this;return null==s.log&&(s.log=a),null==s.conf&&(s.conf=a),s.log=h.get("NodeLogger").$new("x.log"),e=["warning"],t=s.log,t["$loglevel="].apply(t,e),e[e.length-1],s.log.$info("Welcome to Zupfnoter"),s.log.$info("Zupfnoter "+h.get("VERSION")),s.log.$info("Opal:     "+h.get("RUBY_ENGINE_VERSION")),s.log.$info("Ruby:     "+h.get("RUBY_VERSION")),s.log.$info("Abc2svg:  "+abc2svg.version),s.conf=h.get("Confstack").$new(a),e=[!1],t=s.conf,t["$strict="].apply(t,e),e[e.length-1],s.conf.$push(r.$_init_conf()),s.settings=o([],{}),r.editor=h.get("TextPaneEmulatorForCli").$new(),r.json_validator=h.get("Ajv").$$scope.get("JsonValidator").$new()},l.$$arity=0),e.defn(p,"$set_abc_input",c=function(e){return this.editor.$set_text(e)},c.$$arity=1),e.defn(p,"$call_consumers",u=function(e){return a},u.$$arity=1),e.defn(p,"$load_music_model",$=function(){var t,r,n=this,i=a,o=a;return null==s.conf&&(s.conf=a),i=s.conf.$get("abc_parser"),o=h.get("Harpnotes").$$scope.get("Input").$$scope.get("ABCToHarpnotesFactory").$create_engine(i),r=o.$transform(n.editor.$get_abc_part()),t=e.to_ary(r),n.music_model=null==t[0]?a:t[0],n.player_model_abc=null==t[1]?a:t[1],t=[n.editor.$get_checksum()],r=n.music_model,r["$checksum="].apply(r,t),t[t.length-1]},$.$$arity=0),e.defn(p,"$produce_pdfs",f=function(e){var t,r,n,i=this,s=a,l=a,c=a,u=a;return i.$layout_harpnotes(),(t=i.music_model.$meta_data()["$[]"]("filename")["$include?"]("{{"))===a||null==t||t.$$is_boolean&&1!=t?(l=i.music_model.$harpnote_options()["$[]"]("print"),s=i.music_model.$meta_data()["$[]"]("filename")):(!0,s=i.music_model.$harpnote_options().$dig("template","filebase"),!1!==s&&s!==a&&null!=s||i.$raise("no filebase given for template"),l=[]),c=e,u=o([],{}),(t=(r=l).$each,t.$$p=(n=function(e){var t=n.$$s||this,r=a;return null==e&&(e=a),r=e["$[]"]("view_id"),u["$[]="](c+"/"+s+"_"+e["$[]"]("filenamepart")+"_a3.pdf",t.$render_a3(r).$output("raw")),a},n.$$s=i,n.$$arity=1,n),t).call(r),u},f.$$arity=1)}(n.base,n.get("Controller")),function(n){var i,o,u,$,f,p,d,h=i=l(n,"I18n");h.$$proto,h.$$scope;e.defs(h,"$t",o=function(e){return e},o.$$arity=1),e.defs(h,"$t_key",u=function(e){return this.$t(e.$split(".").$last())},u.$$arity=1),e.defs(h,"$t_help",$=function(e){var t,r,n,i,o,l=this,c=a,u=a,$=a;return c=l.$get_candidate_keys(e),u=(t=(r=c).$map,t.$$p=(n=function(e){n.$$s;return null==s.conf_helptext&&(s.conf_helptext=a),null==e&&(e=a),s.conf_helptext["$[]"](e.$join("."))},n.$$s=l,n.$$arity=1,n),t).call(r),c=(t=(i=c).$map,t.$$p=(o=function(e){o.$$s;return null==e&&(e=a),e.$join(".")},o.$$s=l,o.$$arity=1,o),t).call(i).$to_s(),$=!1!==(t=u.$compact().$first())&&t!==a&&null!=t?t:"no help for "+c,"<h2>"+e+'</h2><div style="padding:0.5em;width:30em;">'+$+"</div>"},$.$$arity=1),e.defs(h,"$get_candidate_keys",f=function(e){var n,i,o,l,u,$,f,p,d,h,_,g,m,y=this,v=a,b=a,x=a,w=a;return v=e,v=(n=(i=v).$gsub,n.$$p=(o=function(){var e;o.$$s;return((e=s["~"])===a?a:e["$[]"](1))+"0"+((e=s["~"])===a?a:e["$[]"](3))},o.$$s=y,o.$$arity=0,o),n).call(i,/^(extract\.)(\d+)(.*)$/),v=(n=(l=v).$gsub,n.$$p=(u=function(){var e;u.$$s;return((e=s["~"])===a?a:e["$[]"](1))+"0"+((e=s["~"])===a?a:e["$[]"](3))},u.$$s=y,u.$$arity=0,u),n).call(l,/^(extract\.0\.lyrics\.)(\d+)(.*)$/),v=(n=($=v).$gsub,n.$$p=(f=function(){var e;f.$$s;return((e=s["~"])===a?a:e["$[]"](1))+"0"+((e=s["~"])===a?a:e["$[]"](3))},f.$$s=y,f.$$arity=0,f),n).call($,/^(extract\.0\.images\.)(\d+)(.*)$/),v=(n=(p=v).$gsub,n.$$p=(d=function(){var e;d.$$s;return((e=s["~"])===a?a:e["$[]"](1))+"0"+((e=s["~"])===a?a:e["$[]"](3))},d.$$s=y,d.$$arity=0,d),n).call(p,/^(extract\.0\.notes\.)([a-zA-SU-Z_0-9]+)(.*)$/),v=(n=(h=v).$gsub,n.$$p=(_=function(){var e;_.$$s;return((e=s["~"])===a?a:e["$[]"](1))+"0"+((e=s["~"])===a?a:e["$[]"](3))},_.$$s=y,_.$$arity=0,_),n).call(h,/^(extract\.0\.tuplet\.)([a-zA-SU-Z_0-9]+)(.*)$/),b=v.$split("."),x=[],w=[],(n=(g=c(0,t(b.$length(),1),!1)).$each,n.$$p=(m=function(e){m.$$s;return null==e&&(e=a),w.$push(b["$[]"](c(e,-1,!1)))},m.$$s=y,m.$$arity=1,m),n).call(g),r(w,x.$reverse())},f.$$arity=1),e.defs(h,"$locale",p=function(e){return a},p.$$arity=1),e.defs(h,"$phrases",d=function(){return a},d.$$arity=0)}(n.base),function(t,n){function o(){}var l,u,$,f,p,d,h,_,g,m,y,v=o=i(t,n,"TextPaneEmulatorForCli",o),b=v.$$proto,x=v.$$scope;return b.abc_part=b.config_separator=a,e.defn(v,"$initialize",l=function(){var e,t,r,n=this;return n.abc_text=a,n.config_separator="%%%%zupfnoter",n.on_change=(e=(t=n).$lambda,e.$$p=(r=function(){r.$$s;return a},r.$$s=n,r.$$arity=0,r),e).call(t),n.config_undo=x.get("UndoManager").$new()},l.$$arity=0),e.defn(v,"$get_abc_part",u=function(){return this.abc_part},u.$$arity=0),e.defn(v,"$set_text",$=function(e){return this.$_split_parts(e)},$.$$arity=1),e.defn(v,"$_split_parts",f=function(e){var t,n,i,o=this;return o.$_clean_models(),(t=(n=e.$split(o.config_separator)).$each_with_index,t.$$p=(i=function(e,t){var n,o=i.$$s||this;return null==s.log&&(s.log=a),null==e&&(e=a),null==t&&(t=a),t["$=="](0)?o.abc_part=e:(n=e["$start_with?"](".config"))===a||null==n||n.$$is_boolean&&1!=n?(n=e["$start_with?"](".resources"))===a||null==n||n.$$is_boolean&&1!=n?s.log.$error(r(x.get("I18n").$t("unsupported section found in abc file: "),e["$[]"](c(0,10,!1)))):o.$_set_resources_json(e.$split(".resources").$last()):o.$_set_config_json(e.$split(".config").$last(),"from loaded abc",!0)},i.$$s=o,i.$$arity=2,i),t).call(n)},f.$$arity=1),e.defn(v,"$_get_abc_from_editor",p=function(){return this.abc_part},p.$$arity=0),e.defn(v,"$set_config_part",d=function(e){return a},d.$$arity=1),e.defn(v,"$clear_markers",h=function(){return a},h.$$arity=0),e.defn(v,"$set_markers",_=function(){return a},_.$$arity=0),e.defn(v,"$set_annotations",g=function(){return a},g.$$arity=0),e.defn(v,"$save_to_localstorage",m=function(e){return null==e&&(e=a),a},m.$$arity=-1),e.defn(v,"$clean_localstorage",y=function(){return a},y.$$arity=0),a&&"clean_localstorage"}(n.base,n.get("Harpnotes").$$scope.get("TextPane"))},Opal.modules.confstack2=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}var r=e.top,n=e,a=e.nil,i=(e.breaker,e.slice,e.klass),o=e.hash2,s=e.range,l=e.hash;return e.add_stubs(["$to_n","$duplicable?","$dup","$map","$to_proc","$each_pair","$===","$[]=","$deep_dup","$delete","$deep_merge!","$[]","$is_a?","$deep_merge","$key?","$call","$inject","$respond_to?","$join","$compact","$push","$digkeys","$keys","$require","$attr_accessor","$+","$push_from_env","$first","$caller","$last","$count","$new","$get_from_env","$to_json","$push_to_env","$include?","$nil?","$parse","$pop","$get","$open","$puts","$to_yaml","$has_key?","$dig","$split","$!","$raise","$==","$_resolve_dependencies","$each","$_get_one","$each_with_index","$select","$to_i","$reverse","$private","$index","$class","$_resolve_value_dependency","$_resolve_hash_dependency","$_resolve_array_dependency"]),function(t,r){function n(){}var a,o=n=i(t,null,"Object",n);o.$$proto,o.$$scope;e.defn(o,"$duplicable?",a=function(){return!0},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"NilClass",n);o.$$proto,o.$$scope;e.defn(o,"$duplicable?",a=function(){return!1},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"FalseClass",n);o.$$proto,o.$$scope;e.defn(o,"$duplicable?",a=function(){return!1},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"TrueClass",n);o.$$proto,o.$$scope;e.defn(o,"$duplicable?",a=function(){return!1},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"Symbol",n);o.$$proto,o.$$scope;e.defn(o,"$duplicable?",a=function(){return!1},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"Numeric",n);o.$$proto,o.$$scope;e.defn(o,"$duplicable?",a=function(){return!1},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"BigDecimal",n);o.$$proto,o.$$scope;e.defn(o,"$duplicable?",a=function(){return!0},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"Method",n);o.$$proto,o.$$scope;e.defn(o,"$duplicable?",a=function(){return!1},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"String",n);o.$$proto,o.$$scope;e.defn(o,"$deep_dup",a=function(){return this.$to_n()},a.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"Numerical",n);o.$$proto,o.$$scope;e.defn(o,"$deep_dup",a=function(){return this.$to_n()},a.$$arity=0)}(n.base),function(t,r){function n(){}var o,s=n=i(t,null,"Object",n);s.$$proto,s.$$scope;e.defn(s,"$deep_dup",o=function(){var e,t=this;return(e=t["$duplicable?"]())===a||null==e||e.$$is_boolean&&1!=e?t:t.$dup()},o.$$arity=0)}(n.base),function(t,r){function n(){}var a,o=n=i(t,null,"Array",n);o.$$proto,o.$$scope;e.defn(o,"$deep_dup",a=function(){var e,t;return(e=(t=this).$map,e.$$p="deep_dup".$to_proc(),e).call(t)},a.$$arity=0)}(n.base),function(t,r){function n(){}var o,s,l,c=n=i(t,null,"Hash",n),u=(c.$$proto,c.$$scope);e.defn(c,"$deep_dup",o=function(){var t,r,n,i=this,o=a;return o=i.$dup(),(t=(r=i).$each_pair,t.$$p=(n=function(t,r){var i,s;n.$$s;return null==t&&(t=a),null==r&&(r=a),s=!1,(i=!1!==s&&s!==a&&null!=s?e.get("String")["$==="](t):s)===a||null==i||i.$$is_boolean&&1!=i?(o.$delete(t),o["$[]="](t.$deep_dup(),r.$deep_dup())):o["$[]="](t,r.$deep_dup())},n.$$s=i,n.$$arity=2,n),t).call(r),o},o.$$arity=0),e.defn(c,"$deep_merge",s=function(e){var t,r,n=this,i=s.$$p,o=i||a;return s.$$p=null,(t=(r=n.$dup())["$deep_merge!"],t.$$p=o.$to_proc(),t).call(r,e)},s.$$arity=1),e.defn(c,"$deep_merge!",l=function(e){var t,r,n,i=this,o=l.$$p,s=o||a;return l.$$p=null,(t=(r=e).$each_pair,t.$$p=(n=function(e,t){var r,i,o,l=n.$$s||this,c=a;return null==e&&(e=a),null==t&&(t=a),c=l["$[]"](e),l["$[]="](e,function(){return i=c["$is_a?"](u.get("Hash")),(r=!1!==i&&i!==a&&null!=i?t["$is_a?"](u.get("Hash")):i)===a||null==r||r.$$is_boolean&&1!=r?(r=(o=s!==a)?l["$key?"](e):s!==a)===a||null==r||r.$$is_boolean&&1!=r?t:s.$call(e,c,t):(r=(i=c).$deep_merge,r.$$p=s.$to_proc(),r).call(i,t)}())},n.$$s=i,n.$$arity=2,n),t).call(r),i},l.$$arity=1)}(n.base),function(t,r){function n(){}var o,s,l=n=i(t,null,"Hash",n);l.$$proto,l.$$scope;e.defn(l,"$dig",o=function(e){var t,r,n,i,o=this,s=arguments.length,l=s-0;l<0&&(l=0),i=new Array(l);for(var c=0;c<s;c++)i[c-0]=arguments[c];return(t=(r=i).$inject,t.$$p=(n=function(e,t){var r;n.$$s;return null==e&&(e=a),null==t&&(t=a),(r=e["$respond_to?"]("keys"))===a||null==r||r.$$is_boolean&&1!=r?a:e["$[]"](t)},n.$$s=o,n.$$arity=2,n),t).call(r,o)},o.$$arity=-1),e.defn(l,"$digkeys",s=function(e,t){var r,n,i,o=this;return null==e&&(e=[]),null==t&&(t=a),(r=(n=o.$keys()).$inject,r.$$p=(i=function(e,r){var n,o=i.$$s||this,s=a;return null==e&&(e=a),null==r&&(r=a),s=[t,r].$compact().$join("."),e.$push(s),(n=o["$[]"](r)["$respond_to?"]("keys"))===a||null==n||n.$$is_boolean&&1!=n||o["$[]"](r).$digkeys(e,s),e},i.$$s=o,i.$$arity=2,i),r).call(n,e)},s.$$arity=-1)}(n.base),r.$require("json"),function(r,n){function c(){}var u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S=c=i(r,null,"Confstack",c),I=S.$$proto,O=S.$$scope;return I.confstack_name=I.sourcestack=I.confstack=I.lookup_cache=I.strict=I.confresult_cache=I.callstack=a,function(e,t){function r(){}var n=r=i(e,null,"DeleteMe",r);n.$$proto,n.$$scope}(O.base),S.$attr_accessor("strict"),e.defn(S,"$initialize",u=function(e){var r=this;return null==e&&(e="default"),r.callstack=[],r.confstack=[o([],{})],r.lookup_cache=o([],{}),r.confresult_cache=o([],{}),r.sourcestack=[],r.strict=!0,!1!==e&&e!==a&&null!=e&&(r.confstack_name=t("confstack__",e),r.$push(o(["confstack"],{confstack:o(["env"],{env:r.confstack_name})})),r.$push_from_env()),r},u.$$arity=-1),e.defn(S,"$push",$=function(e){var t,r=this,n=a;return null==e&&(e=o([],{})),r.confresult_cache=o([],{}),r.lookup_cache=o([],{}),(t=e["$is_a?"](O.get("Hash")))===a||null==t||t.$$is_boolean&&1!=t||(r.sourcestack.$push(r.$caller().$first()),n=r.confstack.$last().$deep_dup().$deep_merge(e),r.confstack.$push(n)),r.confstack.$count()},$.$$arity=-1),e.defn(S,"$push_to_env",f=function(e){var t=this,r=a,n=a,i=a;return null==e&&(e=o([],{})),r=O.get("Confstack").$new(!1),r.$push(t.$get_from_env()),r.$push(e),n=r["$[]"](),i=n.$to_json(),O.get("ENV")["$[]="](t["$[]"]("confstack.env"),i),t.$push(e)},f.$$arity=-1),e.defn(S,"$push_from_env",p=function(){var e=this;return e.$push_to_env(e.$get_from_env())},p.$$arity=0),e.defn(S,"$get_from_env",d=function(){var e,t=this,r=a,n=a;return r=o([],{}),(e=t.$keys()["$include?"]("confstack.env"))===a||null==e||e.$$is_boolean&&1!=e||(n=O.get("ENV")["$[]"](t["$[]"]("confstack.env")),((e=n["$nil?"]())===a||null==e||e.$$is_boolean&&1!=e)&&(r=O.get("JSON").$parse(n))),r},d.$$arity=0),e.defn(S,"$pop",h=function(){var e=this;return e.lookup_cache=o([],{}),e.sourcestack.$pop(),e.confstack.$pop(),e.confstack.$count()},h.$$arity=0),e.defn(S,"$reset_to",_=function(e){var t=this;return t.lookup_cache=o([],{}),t.sourcestack=t.sourcestack["$[]"](s(0,e,!1)),t.confstack=t.confstack["$[]"](s(0,e,!1)),t.confstack.$count()},_.$$arity=1),e.defn(S,"$save",g=function(e){var t,r,n,i,o,s=this,l=a;return l=s.$get(),(t=(r=O.get("File")).$open,t.$$p=(n=function(e){n.$$s;return null==e&&(e=a),e.$puts(l.$to_yaml())},n.$$s=s,n.$$arity=1,n),t).call(r,e+".yaml","w"),(t=(i=O.get("File")).$open,t.$$p=(o=function(e){o.$$s;return null==e&&(e=a),e.$puts(l.$to_json())},o.$$s=s,o.$$arity=1,o),t).call(i,e+".json","w")},g.$$arity=1),e.defn(S,"$get",m=function(t,r){var n,i,s,l,c=this,u=a;return null==t&&(t=a),null==r&&(r=o(["resolve"],{resolve:!0})),(n=t["$nil?"]())===a||null==n||n.$$is_boolean&&1!=n?(n=c.lookup_cache["$has_key?"](t))===a||null==n||n.$$is_boolean&&1!=n?(u=(n=c.confstack.$last()).$dig.apply(n,e.to_a(t.$split("."))),c.lookup_cache["$[]="](t,u),!1!==u&&u!==a&&null!=u||(l=u["$nil?"](),s=!1!==l&&l!==a&&null!=l?c.$keys()["$include?"](t)["$!"]():l,(i=!1!==s&&s!==a&&null!=s?c.strict:s)===a||null==i||i.$$is_boolean&&1!=i||c.$raise("confstack: key not available: "+t))):u=c.lookup_cache["$[]"](t):u=c.confstack.$last(),r["$[]"]("resolve")["$=="](!0)&&(u=c.$_resolve_dependencies(t,u)),u},m.$$arity=-1),e.alias(S,"[]","get"),e.defn(S,"$each",y=function(){var e,t,r,n=this,i=y.$$p,o=i||a;return y.$$p=null,(e=(t=n.$keys()).$each,e.$$p=(r=function(e){var t=r.$$s||this;return null==e&&(e=a),o.$call(e,t["$[]"](e))},r.$$s=n,r.$$arity=1,r),e).call(t)},y.$$arity=0),e.defn(S,"$keys",v=function(){return this.confstack.$last().$digkeys()},v.$$arity=0),e.defn(S,"$get_source",b=function(e){var t,r,n,i,o,s,l,c=this,u=a,$=a;return u=(t=(r=c.confstack.$each_with_index()).$map,t.$$p=(n=function(t,r){var i=n.$$s||this;return null==t&&(t=a),null==r&&(r=a),[i.$_get_one(t,e),r]},n.$$s=c,n.$$arity=2,n),t).call(r),$=(t=(i=u).$select,t.$$p=(o=function(e){o.$$s;return null==e&&(e=a),e.$first()["$nil?"]()["$!"]()},o.$$s=c,o.$$arity=1,o),t).call(i).$last(),(t=(s=c.confstack).$map,t.$$p=(l=function(t,r){var n=l.$$s||this;return null==t&&(t=a),null==r&&(r=a),n.$_get_one(t,e)},l.$$s=c,l.$$arity=2,l),t).call(s).$compact().$last(),c.sourcestack["$[]"]($.$last().$to_i())},b.$$arity=1),e.defn(S,"$[]=",x=function(e,t){var r,n,i,o=this,s=a,c=a;return(r=t["$=="](O.get("DeleteMe")))===a||null==r||r.$$is_boolean&&1!=r?(s=e.$split(".").$reverse(),c=(r=(n=s).$inject,r.$$p=(i=function(e,t){i.$$s;return null==e&&(e=a),null==t&&(t=a),l(t,e)},i.$$s=o,i.$$arity=2,i),r).call(n,t),o.$push(c)):o.$delete(e)},x.$$arity=2),e.defn(S,"$delete",w=function(t){var r,n=this,i=a;return i=t.$split("."),(r=n.confstack.$last()).$dig.apply(r,e.to_a(i["$[]"](s(0,-2,!1)))).$delete(i.$last())},w.$$arity=1),S.$private(),e.defn(S,"$_resolve_value_dependency",A=function(e,r){var n,i,o,l=this,c=a,u=a;return(n=l.confresult_cache["$has_key?"](r))===a||null==n||n.$$is_boolean&&1!=n?((n=l.callstack["$include?"](e))===a||null==n||n.$$is_boolean&&1!=n||(u=l.callstack["$[]"](s((n=(i=l.callstack).$index,n.$$p=(o=function(t){o.$$s;return null==t&&(t=a),t["$=="](e)},o.$$s=l,o.$$arity=1,o),n).call(i),-1,!1)),l.callstack=[],l.$raise("circular conf dependency: "+t(u,[e+" ..."]))),l.callstack.$push(e),c=r.$call(),l.callstack.$pop(),l.confresult_cache["$[]="](e,c)):c=l.confresult_cache["$[]"](r),c},A.$$arity=2),e.defn(S,"$_resolve_array_dependency",k=function(e,t){var r,n,i,o=this;return(r=(n=t).$map,r.$$p=(i=function(e){var t=i.$$s||this;return null==e&&(e=a),t.$_resolve_dependencies(a,e)},i.$$s=o,i.$$arity=1,i),r).call(n)},k.$$arity=2),e.defn(S,"$_resolve_hash_dependency",E=function(e,t){var r,n,i,s=this;return(r=(n=t).$inject,r.$$p=(i=function(t,r){var n=i.$$s||this;return null==t&&(t=a),null==r&&(r=a),t["$[]="](r.$first(),n.$_resolve_dependencies([e,r.$first()],r.$last())),t},i.$$s=s,i.$$arity=2,i),r).call(n,o([],{}))},E.$$arity=2),e.defn(S,"$_resolve_dependencies",C=function(e,t){var r=this;return t.$class()["$=="](O.get("Proc"))&&(t=r.$_resolve_value_dependency(e,t)),t.$class()["$=="](O.get("Hash"))&&(t=r.$_resolve_hash_dependency(e,t)),t.$class()["$=="](O.get("Array"))&&(t=r.$_resolve_array_dependency(e,t)),t},C.$$arity=2),a&&"_resolve_dependencies"}(n.base)},Opal.modules["opal-abc2svg"]=function(e){function t(e,t){
return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}var i=(e.top,e),o=e.nil,s=(e.breaker,e.slice,e.module),l=e.klass,c=e.hash2,u=e.gvars,$=e.range;return e.add_stubs(["$attr_accessor","$lambda","$phrases","$set_callback","$error","$+","$[]","$===","$_anno_start","$_anno_stop","$push","$_callback_get_abcmodel","$to_n","$unhighlight_all","$range_highlight_more","$each","$find","$==","$scroll_into_view","$add_class","$get_elements_by_range","$remove_class","$id","$_set_on_select","$gsub","$t","$strip_js","$html","$get_svg","$join","$[]=","$sort","$map","$>","$*","$-","$first","$last","$private","$parse","$loglevel","$debug","$to_json","$split","$inject","$length","$_mk_id","$on","$stop_propagation","$call","$current_target"]),function(i){var f,p=f=s(i,"ABC2SVG"),d=(p.$$proto,p.$$scope);!function(i,s){function f(){}var p,d,h,_,g,m,y,v,b,x,w,A,k,E,C,S,I,O,T,P,M=f=l(i,null,"Abc2Svg",f),N=M.$$proto,B=M.$$scope;N.user=N.root=N.printer=N.abc_source=N.abc_model=N.player_model=N.svgbuf=N.element_to_position=o,M.$attr_accessor("abcplay"),e.defn(M,"$initialize",p=function(e,r){var n,a,i,s,l,$,f,p,d,h,_,g,m,y,v,b=this,x=o,w=o;return null==u.log&&(u.log=o),null==r&&(r=c(["mode"],{mode:"svg"})),b.on_select=(n=(a=b).$lambda,n.$$p=(i=function(e){i.$$s;return null==e&&(e=o),o},i.$$s=b,i.$$arity=1,i),n).call(a),b.printer=e,b.svgbuf=[],b.abc_source="",b.element_to_position=c([],{}),b.abc_model=o,b.player_model=[],b.object_map=c([],{}),b.abcplay=o,b.user=c(["img_out","errmsg","read_file","annotate","page_format","keep_remark","textrans"],{img_out:o,errmsg:o,read_file:o,annotate:!0,page_format:!0,keep_remark:!0,textrans:B.get("I18n").$phrases()}),(n=(s=b).$set_callback,n.$$p=(l=function(e,r,n){l.$$s;return null==u.log&&(u.log=o),null==e&&(e=o),null==r&&(r=o),null==n&&(n=o),!1!==r&&r!==o&&null!=r?u.log.$error(e,[t(r,1),t(n,1)]):u.log.$error(e)},l.$$s=b,l.$$arity=3,l),n).call(s,"errmsg"),x=r["$[]"]("mode"),"svg"["$==="](x)?((n=($=b).$set_callback,n.$$p=(f=function(e,t,r,n,a,i,s){var l=f.$$s||this;return null==e&&(e=o),null==t&&(t=o),null==r&&(r=o),null==n&&(n=o),null==a&&(a=o),null==i&&(i=o),null==s&&(s=o),l.$_anno_start(e,t,r,n,a,i,s)},f.$$s=b,f.$$arity=7,f),n).call($,"anno_start"),(n=(p=b).$set_callback,n.$$p=(d=function(e,t,r,n,a,i,s){var l=d.$$s||this;return null==e&&(e=o),null==t&&(t=o),null==r&&(r=o),null==n&&(n=o),null==a&&(a=o),null==i&&(i=o),null==s&&(s=o),l.$_anno_stop(e,t,r,n,a,i,s)},d.$$s=b,d.$$arity=7,d),n).call(p,"anno_stop"),(n=(h=b).$set_callback,n.$$p=(_=function(e){var t=_.$$s||this;return null==t.svgbuf&&(t.svgbuf=o),null==e&&(e=o),t.svgbuf.$push(e)},_.$$s=b,_.$$arity=1,_),n).call(h,"img_out"),(n=(g=b).$set_callback,n.$$p=(m=function(e,t,r,n){m.$$s;return null==e&&(e=o),null==t&&(t=o),null==r&&(r=o),null==n&&(n=o),o},m.$$s=b,m.$$arity=4,m),n).call(g,"get_abcmodel")):"model"["$==="](x)?(n=(y=b).$set_callback,n.$$p=(v=function(e,t,r,n){var a=v.$$s||this;return null==e&&(e=o),null==t&&(t=o),null==r&&(r=o),null==n&&(n=o),a.$_callback_get_abcmodel(e,t,r,n)},v.$$s=b,v.$$arity=4,v),n).call(y,"get_abcmodel"):u.log.$error("BUG: unsupported mode for abc2svg"),b.root=new abc2svg.Abc(b.user.$to_n()),w="\nI:titletrim 0\nI:measurenb 1\nI:contbarnb 1\nI:linewarn 0\nI:staffnonote 2\nI:stretchlast 1\n      ",b.root.tosvg("my_parameters",w),b.root},p.$$arity=-2),e.defn(M,"$range_highlight",d=function(e,t){var r=this;return r.$unhighlight_all(),r.$range_highlight_more(e,t),o},d.$$arity=2),e.defn(M,"$scroll_into_view",h=function(e){return e.parents(".svg_block").get(0).scrollIntoView(!0)},h.$$arity=1),e.defn(M,"$range_highlight_more",_=function(e,t){var r,n,a,i=this;return(r=(n=i.$get_elements_by_range(e,t)).$each,r.$$p=(a=function(e){var t=a.$$s||this,r=o;return null==u.settings&&(u.settings=o),null==e&&(e=o),r=B.get("Element").$find("#"+e),u.settings["$[]"]("autoscroll")["$=="]("false")||t.$scroll_into_view(r),r.$add_class("highlight")},a.$$s=i,a.$$arity=1,a),r).call(n),o},_.$$arity=2),e.defn(M,"$range_unhighlight_more",g=function(e,t){var r,n,a,i=this;return(r=(n=i.$get_elements_by_range(e,t)).$each,r.$$p=(a=function(e){var t=(a.$$s,o);return null==e&&(e=o),t=B.get("Element").$find("#"+e),t.$remove_class("highlight")},a.$$s=i,a.$$arity=1,a),r).call(n)},g.$$arity=2),e.defn(M,"$unhighlight_all",m=function(){var e=this;return B.get("Element").$find("#"+e.printer.$id()+" .highlight").$remove_class("highlight")},m.$$arity=0),e.defn(M,"$on_select",y=function(){var e=this,t=y.$$p,r=t||o;return y.$$p=null,e.on_select=r,e.$_set_on_select()},y.$$arity=0),e.defn(M,"$strip_js",v=function(e){var t=o;return null==u.log&&(u.log=o),t=e.$gsub(/(I:|%%)(beginjs|endjs)/,"% removed "),e["$=="](t)||u.log.$error(B.get("I18n").$t("CAUTION: your abc-code is vulnerable !!! removed beginjs / endjs"),[1,1]),t},v.$$arity=1),e.defn(M,"$draw",b=function(e,r){var n=this,a=o;return null==r&&(r=""),a="\n%%textoption right\n%%textfont * * 8\n%%text "+r+"\n      ",n.abc_source=n.$strip_js(e),n.element_to_position=c([],{}),n.svgbuf=[],n.root.tosvg("abc",t(n.abc_source,a)),n.printer.$html(n.$get_svg()),n.$_set_on_select(),o},b.$$arity=-2),e.defn(M,"$get_abcmodel",x=function(e){var t=this,r=o;return null==u.log&&(u.log=o),r=t.$strip_js(e),abc2svg.modules.load(r,function(){console.log("modules loaded")},function(e){u.log.$error(e)}),t.root.tosvg("abc",r),[t.abc_model,t.player_model]},x.$$arity=1),e.defn(M,"$get_svg",w=function(){var e=this,t=o;return t=e.svgbuf.$join("\n"),t=t.$gsub("<svg ",'<div class="svg_block"><svg '),t=t.$gsub("</svg>","</svg></div>")},w.$$arity=0),e.defn(M,"$get_html",A=function(){return'\n      <html>\n      <head>\n        <meta charset="utf-8"/>\n        <style type="text/css">\n           rect.abcref {fill-opacity:0.0}\n          .nobrk s\t{ white-space:nowrap; }\n          svg {display:block}\n        </style>\n      </head>\n      <body>\n         '+this.$get_svg()+"\n      </body>\n      "},A.$$arity=0),e.defn(M,"$set_callback",k=function(e){var t=this,r=k.$$p,n=r||o;return k.$$p=null,t.user["$[]="](e,n)},k.$$arity=1),e.defn(M,"$get_elements_by_range",E=function(e,t){var i,s,l,c=this,u=o,$=o;return u=[e,t].$sort(),$=[],(i=(s=c.element_to_position).$each,i.$$p=(l=function(e,t){var i,s,c,f=l.$$s||this,p=o;return null==e&&(e=o),null==t&&(t=o),p=(i=(s=["startChar","endChar"]).$map,i.$$p=(c=function(e){c.$$s;return null==e&&(e=o),t["$[]"](e)},c.$$s=f,c.$$arity=1,c),i).call(s).$sort(),(i=r(n(a(u.$first(),p.$last()),a(p.$first(),u.$last())),0))===o||null==i||i.$$is_boolean&&1!=i?o:$.$push(e)},l.$$s=c,l.$$arity=2,l),i).call(s),$},E.$$arity=2),M.$private(),e.defn(M,"$_callback_get_abcmodel",C=function(e,t,r,n){var a=this,i=o;null==u.log&&(u.log=o),i="",(new AbcMIDI).add(e,t),i=(new AbcJSON).gen_json(e,t,r,n);var s=new ToAudio;return s.add(e,t),a.player_model=s.clear(),a.abc_model=B.get("JSON").$parse(i),u.log.$loglevel()["$=="]("debug")&&u.log.$debug(a.abc_model.$to_json()),a.abc_model},C.$$arity=4),e.defn(M,"$_get_charpos",S=function(e,r,n){var a,i,s,l=this,c=o,u=o;return c=l.abc_source.$split("\n"),u=(a=(i=c["$[]"]($(0,r,!1))).$inject,a.$$p=(s=function(e,r){s.$$s;return null==e&&(e=o),null==r&&(r=o),e=t(e,r.$length())},s.$$s=l,s.$$arity=2,s),a).call(i,0),t(u,n)},S.$$arity=3),e.defn(M,"$_anno_start",I=function(e,t,r,n,a,i,s){var l=this,c=o;c=l.$_mk_id(e,t,r),l.root.out_svg('<g class="'+c+'">\n')},I.$$arity=7),e.defn(M,"$_anno_stop",O=function(e,t,r,n,a,i,s){var l=this,u=o;return u=l.$_mk_id(e,t,r),l.root.out_svg("</g>\n"),l.root.out_svg('<rect class="abcref _'+t+'_" id="'+u+'" x="'),l.root.out_sxsy(n,'" y="',a),l.root.out_svg('" width="'+i.toFixed(2)+'" height="'+s.toFixed(2)+'"/>\n'),l.element_to_position["$[]="](u,c(["startChar","endChar"],{startChar:t,endChar:r}))},O.$$arity=7),e.defn(M,"$_mk_id",T=function(e,t,r){return"_"+e+"_"+t+"_"+r+"_"},T.$$arity=3),e.defn(M,"$_set_on_select",P=function(){var e,t,r,n=this;return(e=(t=B.get("Element").$find(".abcref")).$on,e.$$p=(r=function(e){var t=r.$$s||this;return null==t.on_select&&(t.on_select=o),null==t.element_to_position&&(t.element_to_position=o),null==e&&(e=o),e.$stop_propagation(),t.on_select.$call(t.element_to_position["$[]"](e.$current_target().$id())),o},r.$$s=n,r.$$arity=1,r),e).call(t,"click")},P.$$arity=0)}(d.base)}(i.base)},Opal.modules["version-prod"]=function(e){var t=(e.top,e);e.nil,e.breaker,e.slice;return e.add_stubs(["$year","$now"]),e.cdecl(t,"VERSION","V_1.9.1-15-g7154652"),e.cdecl(t,"SCHEMA_VERSION","https://zupfnoter.weichel21.de/schema/zupfnoter-config_1.0.json"),e.cdecl(t,"COPYRIGHT"," "+t.get("Time").$now().$year()+" https://www.zupfnoter.de")},abc2svg={C:{BLEN:1536,BAR:0,CLEF:1,CUSTOS:2,GRACE:4,KEY:5,METER:6,MREST:7,NOTE:8,PART:9,REST:10,SPACE:11,STAVES:12,STBRK:13,TEMPO:14,BLOCK:16,REMARK:17,FULL:0,EMPTY:1,OVAL:2,OVALBARS:3,SQUARE:4,SL_ABOVE:1,SL_BELOW:2,SL_AUTO:3,SL_HIDDEN:4,SL_DOTTED:8},Abc:function(user){"use strict";function clone(e,t){if(!e)return e;var r=new e.constructor;for(var n in e)e.hasOwnProperty(n)&&(t&&"object"==typeof e[n]?r[n]=clone(e[n],t-1):r[n]=e[n]);return r}function errbld(e,t,r,n){var a,i,o,s,l;if(user.errbld){switch(e){case 0:e="warn";break;case 1:e="error";break;default:e="fatal"}return void user.errbld(e,t,r,n)}if(void 0!=n&&n>=0){for(a=o=0;;){if((i=parse.file.indexOf("\n",a))<0||i>n)break;o++,a=i+1}s=n-a}switch(l="",r&&(l=r,o&&(l+=":"+(o+1)+":"+(s+1)),l+=" "),e){case 0:l+="Warning: ";break;case 1:l+="Error: ";break;default:l+="Internal bug: "}user.errmsg(l+t,o,s)}function error(e,t,r,n,a,i,o){var s;user.textrans&&(s=user.textrans[r])&&(r=s),arguments.length>3&&(r=r.replace(/\$./g,function(e){switch(e){case"$1":return n;case"$2":return a;case"$3":return i;default:return o}})),t&&t.fname?errbld(e,r,t.fname,t.istart):errbld(e,r)}function scanBuf(){this.index=0,scanBuf.prototype.char=function(){return this.buffer[this.index]},scanBuf.prototype.next_char=function(){return this.buffer[++this.index]},scanBuf.prototype.get_int=function(){for(var e=0,t=this.buffer[this.index];t>="0"&&t<="9";)e=10*e+Number(t),t=this.next_char();return e}}function syntax(e,t,r,n,a,i){error(e,{fname:parse.fname,istart:parse.istart+parse.line.index},t,r,n,a,i)}function js_inject(js){/eval *\(|Function|setTimeout|setInterval/.test(js)?syntax(1,"Unsecure code"):eval('"use strict"\n'+js)}function y_get(e,t,r,n){var a,i=staff_tb[e],o=r/realwidth*YSTEP|0,s=(r+n)/realwidth*YSTEP|0;if(o<0&&(o=0),s>=YSTEP&&(s=YSTEP-1,o>s&&(o=s)),t)for(a=i.top[o++];o<=s;)a<i.top[o]&&(a=i.top[o]),o++;else for(a=i.bot[o++];o<=s;)a>i.bot[o]&&(a=i.bot[o]),o++;return a}function y_set(e,t,r,n,a){var i=staff_tb[e],o=r/realwidth*YSTEP|0,s=(r+n)/realwidth*YSTEP|0;if(o<0&&(o=0),s>=YSTEP&&(s=YSTEP-1,o>s&&(o=s)),t)for(;o<=s;)i.top[o]<a&&(i.top[o]=a),o++;else for(;o<=s;)i.bot[o]>a&&(i.bot[o]=a),o++}function up_p(e,t){switch(t){case C.SL_ABOVE:return!0;case C.SL_BELOW:return!1}return e.multi&&0!=e.multi?e.multi>0:!!e.p_v.have_ly&&e.pos.voc!=C.SL_ABOVE}function d_arp(e){var t,r,n,a=e.s,i=e.dd,o=5;if(a.type==C.NOTE)for(t=0;t<=a.nhd;t++){if(a.notes[t].acc)n=5+a.notes[t].shac;else switch(n=6-a.notes[t].shhd,a.head){case C.SQUARE:n+=3.5;break;case C.OVALBARS:case C.OVAL:n+=2}n>o&&(o=n)}r=3*(a.notes[a.nhd].pit-a.notes[0].pit)+4,t=i.h,r<t&&(r=t),e.has_val=!0,e.val=r,e.x-=o,e.y=3*(a.notes[0].pit-18)-3}function d_cresc(e){if(!e.ldst){var t,r,n,a,i,o,s,l,c,u,$=e.s,f=e.start;t=f.s,i=t.x+3,l=f.ix,l>0&&(c=a_de[l-1]),e.st=$.st,e.lden=!1,e.has_val=!0,a=up_p($,$.pos.dyn),a&&(e.up=!0),c&&c.s==t&&(e.up&&!c.up||!e.up&&c.up)&&(n=c.dd,f_staff[n.func]&&(s=c.x+c.val+4)>i&&(i=s)),e.defl.noen?(o=e.x-i)<20&&(i=e.x-20-3,o=20):(s=$.x,u=a_de[e.ix+1],u&&u.s==t&&(e.up&&!u.up||!e.up&&u.up)&&(n=u.dd,f_staff[n.func]&&(s-=5)),(o=s-i-4)<20&&(i-=.5*(20-o),o=20)),e.val=o,e.x=i,e.y=y_get(e.st,a,i,o),a||(r=e.dd,e.y-=r.h)}}function d_near(e){var t,r,n=e.s,a=e.dd;a.str||(r=n.multi?n.multi>0:n.stem<0,t=r?0|n.ymx:n.ymn-a.h|0,t>-6&&t<24&&(r&&(t+=3),t=6*((t+6)/6|0)-6),r?n.ymx=t+a.h:n.ymn=t,e.y=t,n.type==C.NOTE&&(e.x+=n.notes[n.stem>=0?0:n.nhd].shhd),"d"==a.name[0]&&n.nflags>=-1&&(r?n.stem>0&&(e.x+=3.5):n.stem<0&&(e.x-=3.5)))}function d_pf(e){var t,r,n,a,i,o=e.s,s=e.dd;e.val=s.wl+s.wr,a=up_p(o,o.pos.vol),a&&(e.up=!0),n=o.x-s.wl,e.ix>0&&(i=a_de[e.ix-1],i.s==o&&(e.up&&!i.up||!e.up&&i.up)&&(t=i.dd,f_staff[t.func]&&(r=i.x+i.val+4)>n&&(n=r))),e.x=n,e.y=y_get(o.st,a,n,e.val),a||(e.y-=s.h)}function d_slide(e){var t,r,n=e.s,a=n.notes[0].pit,i=5;for(t=0;t<=n.nhd;t++){if(n.notes[t].acc)r=4+n.notes[t].shac;else switch(r=5-n.notes[t].shhd,n.head){case C.SQUARE:r+=3.5;break;case C.OVALBARS:case C.OVAL:r+=2}n.notes[t].pit<=a+3&&r>i&&(i=r)}e.x-=i,e.y=3*(a-18)}function d_trill(e){if(!e.ldst){var t,r,n,a,i,o=e.s,s=o.st,l=e.start.s,c=l.x;if(e.prev&&(c=e.prev.x+10,n=e.prev.y),e.st=s,4!=e.dd.func)switch(e.dd.glyph){case"8va":case"15ma":r=1;break;default:r=o.multi>=0}e.defl.noen?(a=e.x-c)<20&&(c=e.x-20-3,a=20):(a=o.x-c-6,o.type==C.NOTE&&(a-=6),a<20&&(c-=.5*(20-a),a=20)),t=e.dd,n||(n=y_get(s,r,c,a)),r?(i=staff_tb[l.st].topbar+2,n<i&&(n=i)):(n-=t.h,i=staff_tb[l.st].botbar-2,n>i&&(n=i)),e.lden=!1,e.has_val=!0,e.val=a,e.x=c,e.y=n,r&&(n+=t.h),y_set(s,r,c,a,n),r?l.ymx=o.ymx=n:l.ymn=o.ymn=n}}function d_upstaff(e){if(!e.ldst){if(e.start)return void d_trill(e);var t,r,n,a=e.s,i=e.dd,o=a.x,s=i.wl+i.wr,l=staff_tb[a.st].topbar+2,c=staff_tb[a.st].botbar-2;if(a.nhd&&(o+=a.notes[a.stem>=0?0:a.nhd].shhd),r=-1,4==i.func)r=0;else if(a.pos)switch(a.pos.orn){case C.SL_ABOVE:r=1;break;case C.SL_BELOW:r=0}switch(i.glyph){case"accent":case"roll":!r||r<0&&(a.multi<0||!a.multi&&a.stem>0)?(t=y_get(a.st,!1,a.x-i.wl,s),t>c&&(t=c),t-=i.h,y_set(a.st,!1,a.x,0,t),n=!0,a.ymn=t):(t=y_get(a.st,!0,a.x,0),t<l&&(t=l),y_set(a.st,!0,a.x-i.wl,s,t+i.h),a.ymx=t+i.h);break;case"brth":case"lphr":case"mphr":case"sphr":for(t=l+1,"brth"==i.glyph&&t<a.ymx&&(t=a.ymx),a=a.ts_next;a&&!a.seqst;a=a.ts_next);o+=.45*((a?a.x:realwidth)-o);break;default:0==i.name.indexOf("invert")&&(n=!0),"invertedfermata"!=i.name&&(r>0||r<0&&a.multi>=0)?(t=y_get(a.st,!0,a.x-i.wl,s)+2,t<l&&(t=l),y_set(a.st,!0,a.x-i.wl,s,t+i.h),a.ymx=t+i.h):(t=y_get(a.st,!1,a.x-i.wl,s)-2,t>c&&(t=c),t-=i.h,y_set(a.st,!1,a.x-i.wl,s,t),"fermata"==i.name&&(n=!0),a.ymn=t)}n&&(t+=i.h,e.inv=!0),e.x=o,e.y=t}}function deco_add(e){var t=e.match(/(\S*)\s+(.*)/);decos[t[1]]=t[2]}function deco_def(e){var t,r,n,a,i,o,s=decos[e];if(!s)return void(cfmt.decoerr&&error(1,null,"Unknown decoration '$1'",e));if(!(t=s.match(/(\d+)\s+(.+?)\s+([0-9.]+)\s+([0-9.]+)\s+([0-9.]+)/)))return void error(1,null,"Invalid decoration '$1'",e);var l=Number(t[1]),c=parseFloat(t[3]),u=parseFloat(t[4]),$=parseFloat(t[5]);if(isNaN(l))return void error(1,null,"%%deco: bad C function value '$1'",t[1]);if((l<0||l>10)&&(l<32||l>41))return void error(1,null,"%%deco: bad C function index '$1'",l);if(c<0||u<0||$<0)return void error(1,null,"%%deco: cannot have a negative value '$1'",s);if(c>50||u>80||$>80)return void error(1,null,"%%deco: abnormal h/wl/wr value '$1'",s);if(r=dd_tb[e],r||(r={name:e},dd_tb[e]=r),r.func=0==r.name.indexOf("head-")?9:l,r.glyph=t[2],r.h=c,r.wl=u,r.wr=$,o=s.replace(t[0],"").trim(),o&&('"'==o[0]&&(o=o.slice(1,-1)),r.str=o),6==r.func&&void 0==r.str&&(r.str=r.name),"("==(i=r.name.slice(-1))||")"==i&&r.name.indexOf("(")<0)if(a=r.name.slice(0,-1)+("("==i?")":"("),n=dd_tb[a])"("==i?(r.dd_en=n,n.dd_st=r):(r.dd_st=n,n.dd_en=r);else if(!(n=deco_def(a)))return;return r}function deco_cnv(e,t,r){var n,a,i,o,s,l=e.length;for(n=0;n<l;n++)if(o=e[n],(i=dd_tb[o])||(i=deco_def(o))){switch(i.func){case 0:if(t.type==C.BAR&&"dot"==i.name){t.bar_dotted=!0;break}case 1:case 2:if(!t.notes){error(1,t,errs.must_note_rest,i.name);continue}break;case 8:if(t.type!=C.NOTE){error(1,t,errs.must_note,i.name);continue}s=t.notes[t.nhd],s.a_dcn||(s.a_dcn=[]),s.a_dcn.push(i.name);continue;case 9:if(!t.notes){error(1,t,errs.must_note_rest,i.name);continue}for(a=0;a<=t.nhd;a++)s=t.notes[a],s.a_dcn||(s.a_dcn=[]),s.a_dcn.push(i.name);continue;default:break;case 10:if(t.notes)for(a=0;a<=t.nhd;a++)t.notes[a].color=i.name;else t.color=i.name;continue;case 32:t.invis=!0;continue;case 33:if(t.type!=C.BAR){error(1,t,"!beamon! must be on a bar");continue}t.beam_on=!0;continue;case 34:if(t.type!=C.NOTE||!r||r.type!=C.NOTE||t.nflags!=r.nflags){error(1,t,"!$1! must be on the last of a couple of notes",i.name);continue}for(t.trem2=!0,t.beam_end=!0,r.trem2=!0,r.beam_st=!0,t.ntrem=r.ntrem=Number(i.name[4]),r.nflags=--t.nflags,r.head=++t.head,t.nflags>0?t.nflags+=t.ntrem:(t.nflags<=-2&&(t.stemless=!0,r.stemless=!0),t.nflags=t.ntrem),r.nflags=t.nflags,a=0;a<=t.nhd;a++)t.notes[a].dur*=2;for(a=0;a<=r.nhd;a++)r.notes[a].dur*=2;continue;case 35:if(t.type!=C.NOTE){error(1,t,"!xstem! must be on a note");continue}t.xstem=!0,t.nflags=0;continue;case 36:if(t.type!=C.NOTE){error(1,t,errs.must_note,i.name);continue}"1"==i.name[6]?t.beam_br1=!0:t.beam_br2=!0;continue;case 37:t.rbstop=1;continue;case 38:if(t.type!=C.NOTE){error(1,t,errs.must_note,i.name);continue}t.trem1=!0,t.ntrem=i.name.length,t.nflags>0?t.nflags+=t.ntrem:t.nflags=t.ntrem;continue;case 39:if(t.type!=C.NOTE){error(1,t,errs.must_note,i.name);continue}t.feathered_beam="a"==i.name[5]?1:-1;continue;case 40:t.stemless=!0;continue;case 41:t.rbstop=2;continue}t.a_dd||(t.a_dd=[]),t.a_dd.push(i)}}function deco_update(e,t){var r,n,a=a_de.length;for(r=0;r<a;r++)n=a_de[r],n.s==e&&(n.x+=t)}function deco_width(e){var t,r,n=0,a=e.a_dd,i=a.length;for(r=0;r<i;r++)switch(t=a[r],t.func){case 1:n<7&&(n=7);break;case 2:n<14&&(n=14);break;case 3:switch(t.glyph){case"brth":case"lphr":case"mphr":case"sphr":e.wr<20&&(e.wr=20)}}return 0!=n&&e.prev&&e.prev.type==C.BAR&&(n-=3),n}function draw_all_deco(){if(0!=a_de.length){var e,t,r,n,a,i,o,s,l,c,u,$,f,p,d=[],h=[];if(!cfmt.dynalign)for(i=nstaff,s=staff_tb[i].y;--i>=0;)l=staff_tb[i].y,h[i]=.5*(s+24+l),s=l;for(;;){if(!(e=a_de.shift()))break;t=e.dd,t&&(t.dd_en||(r=e.s,a=t.glyph,$=a.indexOf("/"),$>0&&(a=r.stem>=0?a.slice(0,$):a.slice($+1)),f_staff[t.func]?set_sscale(r.st):set_scale(r),i=e.st,staff_tb[i].topbar&&(o=e.x,s=e.y+staff_tb[i].y,void 0!=e.m?(n=r.notes[e.m],o+=n.shhd*stv_g.scale):f_staff[t.func]&&!cfmt.dynalign&&(e.up&&i>0||!e.up&&i<nstaff)&&(c=e.up?h[--i]:h[i++],c-=.5*t.h,(e.up&&s<c||!e.up&&s>c)&&(l=y_get(i,!e.up,e.x,e.val)+staff_tb[i].y,e.up&&(l-=t.h),(e.up&&l>c||!e.up&&l<c)&&(s=c))),u=user[a],u&&"function"==typeof u?u(o,s,e):(anno_start(r,"deco"),e.inv&&(g_open(o,s,0,1,-1),o=s=0),e.has_val?(2!=t.func||stv_g.st<0?out_deco_val(o,s,a,e.val/stv_g.scale,e.defl):out_deco_val(o,s,a,e.val,e.defl),e.defl.noen&&d.push(e.start)):void 0!=t.str&&"sfz"!=t.str?(f=t.str,"@"==f[0]&&(p=f.match(/^@([0-9.-]+),([0-9.-]+);?/),o+=Number(p[1]),s+=Number(p[2]),f=f.replace(p[0],"")),out_deco_str(o,s,a,f)):e.lden?out_deco_long(o,s,e):xygl(o,s,a),stv_g.g&&g_close(),anno_stop(r,"deco")))))}a_de=d}}function draw_deco_near(){function e(e){var t,r,n,a,i,o=e.a_dd.length;for(r=0;r<o;r++){switch(t=e.a_dd[r],t.func){default:n=0;break;case 3:case 4:case 5:if(ottava[t.name])if(i=t.name.slice(0,-1)+e.st.toString(),od[i]){if("("==t.name[t.name.length-1]){od[i]++;continue}if(od[i]--,e.v+1!=od[i]>>8||!od[i])continue;od[i]&=255}else"("==t.name[t.name.length-1]&&(od[i]=1+(e.v+1<<8));n=e.pos.orn;break;case 6:n=e.pos.vol;break;case 7:n=e.pos.dyn}n!=C.SL_HIDDEN&&(a={s:e,dd:t,st:e.st,ix:a_de.length,defl:{},x:e.x,y:e.y},a_de.push(a),t.dd_en?a.ldst=!0:t.dd_st&&(a.lden=!0,a.defl.nost=!0),f_near[t.func]&&func_tb[t.func](a))}}function t(e,t){var r,n,a,i,o=e.notes[t],s=o.a_dcn.length;for(n=0;n<s;n++)if(a=o.a_dcn[n],(i=dd_tb[a])||(i=deco_def(a))){switch(i.func){case 0:case 1:case 3:case 4:case 8:break;default:error(1,null,"Cannot have !$1! on a head",i.name);continue;case 9:o.invis=!0;break;case 10:o.color=i.name;continue;case 32:o.invis=!0;continue;case 40:e.stemless=!0;continue}r={s:e,dd:i,st:e.st,m:t,ix:0,defl:{},x:e.x,y:3*(o.pit-18)},a_de.push(r),i.dd_en?r.ldst=!0:i.dd_st&&(r.lden=!0,r.defl.nost=!0)}}function r(r){var n;if(r.a_dd&&e(r),r.notes)for(n=0;n<r.notes.length;n++)r.notes[n].a_dcn&&t(r,n)}var n,a;for(n=tsfirst;n;n=n.ts_next){switch(n.type){case C.CLEF:case C.KEY:case C.METER:continue}break}for(0!=a_de.length&&function(e){var t,r,n=e.x-e.wl,a=a_de.length;for(t=0;t<a;t++)r=a_de[t],r.ix=t,r.s.x=r.x=n,r.defl.nost=!0}(n);n;n=n.ts_next){switch(n.type){case C.BAR:case C.MREST:case C.NOTE:case C.REST:case C.SPACE:break;case C.GRACE:for(a=n.extra;a;a=a.next)r(a);default:continue}r(n)}!function(){var e,t,r,n,a,i,o,s,l,c=a_de.length;for(e=0;e<c;e++)if(r=a_de[e],r.ldst){for(a=r.dd,i=a.dd_en,s=r.s,o=s.v,t=e+1;t<c&&(n=a_de[t],n.start||n.dd!=i||n.s.v!=o);t++);if(t==c)for(l=s.st,t=e+1;t<c&&(n=a_de[t],n.start||n.dd!=i||n.s.st!=l);t++);t==c&&(n={s:r.s,st:r.st,dd:i,ix:a_de.length-1,x:realwidth-6,y:r.s.y,lden:!0,defl:{noen:!0}},n.x<s.x+10&&(n.x=s.x+10),void 0!=r.m&&(n.m=r.m),a_de.push(n)),n.start=r,n.defl.nost=r.defl.nost,"trill("==a.name&&e>0&&"trill"==a_de[e-1].dd.name&&(n.prev=a_de[e-1])}for(e=0;e<c;e++)n=a_de[e],n.lden&&!n.start&&(s=n.s,r={s:prev_scut(s),st:n.st,dd:n.dd.dd_st,ix:a_de.length-1,y:s.y,ldst:!0},r.x=r.s.x,void 0!=n.m&&(r.m=n.m),a_de.push(r),n.start=r)}()}function draw_deco_note(){var e,t,r,n,a=a_de.length;for(e=0;e<a;e++)t=a_de[e],r=t.dd,n=r.func,f_note[n]&&void 0==t.m&&func_tb[n](t)}function draw_deco_staff(){var e,t,r,n,a,i,o,s,l,c,u,$,f,p,d,h=new Array(nstaff),_=a_de.length;for(o=0;o<=nstaff;o++)h[o]={ymin:0,ymax:0};for(o=0;o<_;o++)l=a_de[o],(c=l.dd)&&f_staff[c.func]&&void 0==l.m&&(func_tb[c.func](l),c.dd_en||cfmt.dynalign&&(l.up?l.y>h[l.st].ymax&&(h[l.st].ymax=l.y):l.y<h[l.st].ymin&&(h[l.st].ymin=l.y)));for(o=0;o<_;o++)l=a_de[o],(c=l.dd)&&!c.dd_en&&f_staff[c.func]&&(cfmt.dynalign?(a=l.up?h[l.st].ymax:h[l.st].ymin,l.y=a):a=l.y,l.up&&(a+=c.h),y_set(l.st,l.up,l.x,l.val,a));for(o=0;o<=nstaff;o++)h[o]={ymin:0,ymax:24};for(e=tsfirst;e;e=e.ts_next)if(e.a_gch){for(t||(t=e),$=null,f=0;f<e.a_gch.length&&(u=e.a_gch[f],!("g"==u.type&&($=u,u.y<0)));f++);$&&(i=$.w,$.y>=0?(a=y_get(e.st,!0,e.x,i))>h[e.st].ymax&&(h[e.st].ymax=a):(a=y_get(e.st,!1,e.x,i))<h[e.st].ymin&&(h[e.st].ymin=a))}if(t){for(o=0;o<=nstaff;o++)d=staff_tb[o].botbar,h[o].ymin>d-4&&(h[o].ymin=d-4),p=staff_tb[o].topbar,h[o].ymax<p+4&&(h[o].ymax=p+4);for(set_dscale(-1),e=t;e;e=e.ts_next)e.a_gch&&draw_gchord(e,h[e.st].ymin,h[e.st].ymax)}for(s=0;s<voice_tb.length;s++)r=voice_tb[s],!r.second&&r.sym&&function(e){var t,r,a,i,o,s,l;for(a=staff_tb[e.st].topbar+25,t=e.sym;t;t=t.next)if(t.type==C.BAR&&t.rbstart&&!t.norepbra){if(!t.next)break;for(l||(l=t,set_font("repeat")),r=t;t.next&&(t=t.next,!t.rbstop););i=y_get(e.st,!0,r.x,t.x-r.x),a<i&&(a=i),r.text&&(s=strwh(r.text),i=y_get(e.st,!0,r.x+4,s[0]),i+=s[1],a<i&&(a=i)),t.rbstart&&(t=t.prev)}if(t=l)for(set_dscale(e.st,!0),i=a*staff_tb[e.st].staffscale;t;t=t.next)if(t.rbstart&&!t.norepbra){for(r=t;t.next&&(t=t.next,!t.rbstop););if(r==t)break;n=r.x,o=t.type!=C.BAR?t.rbstop?0:t.x-realwidth+4:t.bar_type.length>1&&"[]"!=t.bar_type||"]"==t.bar_type?r.st>0&&!(cur_sy.staves[r.st-1].flags&STOP_BAR)?t.wl:":"==t.bar_type.slice(-1)?12:":"!=t.bar_type[0]?0:8:t.rbstop?0:8,o=t.x-n-o,t.next||t.rbstop||e.bar_start||(e.bar_start=clone(t),e.bar_start.type=C.BAR,e.bar_start.bar_type="[",delete e.bar_start.text,e.bar_start.rbstart=1,delete e.bar_start.a_gch),r.text&&xy_str(n+4,i-gene.curfont.size-3,r.text),xypath(n,i),2==r.rbstart&&(output+="m0 20v-20"),output+="h"+o.toFixed(2),2==t.rbstop&&(output+="v20"),output+='"/>\n',y_set(r.st,!0,n,o,a+2),t.rbstart&&(t=t.prev)}}(r)}function draw_measnb(){var e,t,r,n,a,i,o,s,l=cur_sy;for(t=0;t<=nstaff&&!l.st_print[t];t++);if(!(t>nstaff)){if(set_dscale(t),1!=staff_tb[t].staffscale&&(s=get_font("measure").size,param_set_font("measurefont","* "+(s/staff_tb[t].staffscale).toString())),set_font("measure"),e=tsfirst,(r=gene.nbar)>1)if(0==cfmt.measurenb)o=!0,a=y_get(t,!0,0,20),a<staff_tb[t].topbar+14&&(a=staff_tb[t].topbar+14),cfmt.measurebox?xy_str_b(0,a,r.toString()):xy_str(0,a,r.toString()),y_set(t,!0,0,20,a+gene.curfont.size+2);else if(r%cfmt.measurenb==0){for(;;e=e.ts_next){switch(e.type){case C.METER:case C.CLEF:case C.KEY:case C.STBRK:continue}break}for(;e.st!=t;)e=e.ts_next;e.type==C.BAR&&e.bar_num||(e.prev&&e.prev.type!=C.CLEF&&(e=e.prev),n=e.x-e.wl,o=!0,i=cwid("0")*gene.curfont.swfac,r>=10&&(i*=r>=100?3:2),cfmt.measurebox&&(i+=4),a=y_get(t,!0,n,i),a<staff_tb[t].topbar+6&&(a=staff_tb[t].topbar+6),a+=2,cfmt.measurebox?(xy_str_b(n,a,r.toString()),a+=2,i+=3):xy_str(n,a,r.toString()),a+=gene.curfont.size,y_set(t,!0,n,i,a),e.ymx=a)}for(;e;e=e.ts_next){switch(e.type){case C.STAVES:for(l=e.sy,t=0;t<nstaff&&!l.st_print[t];t++);set_sscale(t);continue;default:continue;case C.BAR:if(!e.bar_num)continue}r=e.bar_num,0!=cfmt.measurenb&&r%cfmt.measurenb==0&&e.next&&(o||(o=!0),i=cwid("0")*gene.curfont.swfac,r>=10&&(i*=r>=100?3:2),cfmt.measurebox&&(i+=4),n=e.x-.4*i,a=y_get(t,!0,n,i),a<staff_tb[t].topbar+6&&(a=staff_tb[t].topbar+6),e.next.type==C.NOTE&&(e.next.stem>0?a<e.next.ys-gene.curfont.size&&(a=e.next.ys-gene.curfont.size):a<e.next.y&&(a=e.next.y)),a+=2,cfmt.measurebox?(xy_str_b(n,a,r.toString()),a+=2,i+=3):xy_str(n,a,r.toString()),a+=gene.curfont.size,y_set(t,!0,n,i,a),e.ymx=a)}gene.nbar=r,s&&param_set_font("measurefont","* "+s.toString())}}function draw_notempo(e,t,r,n,a){var i,o,s,l=identify_note(e,n),c=l[0],u=l[1],$=l[2];switch(out_XYAB('<g transform="translate(X,Y) scale(F)">\n',t+4,r+5,a),c){case C.OVAL:o="HD";break;case C.EMPTY:o="Hd";break;default:o="hd"}if(xygl(-posx,posy,o),i=4,u){switch(s=9,$>0&&(s+=4),c){case C.SQUARE:s+=3;break;case C.OVALBARS:case C.OVAL:s+=2;break;case C.EMPTY:s+=1}for(i=s*u,s-=posx;--u>=0;)xygl(s,posy,"dot"),s+=3.5}return n<C.BLEN&&($<=0?out_stem(-posx,posy,21):(out_stem(-posx,posy,21,!1,$),i<6&&(i=6))),output+="</g>\n",(i+15)*a}function tempo_width(e){var t=0;return set_font("tempo"),e.tempo_str1&&(t=strwh(e.tempo_str1)[0]),e.tempo_ca&&(t+=strwh(e.tempo_ca)[0]),e.tempo_notes&&(t+=10*e.tempo_notes.length+6+cwid(" ")*gene.curfont.swfac*6+10),e.tempo_str2&&(t+=strwh(e.tempo_str2)[0]),t}function write_tempo(e,t,r){var n,a,i=.6*gene.curfont.size/15;if(set_font("tempo"),e.tempo_str1&&(xy_str(t,r,e.tempo_str1),t+=strwh(e.tempo_str1)[0]+3),e.tempo_notes){for(n=0;n<e.tempo_notes.length;n++)t+=draw_notempo(e,t,r,e.tempo_notes[n],i);xy_str(t,r,"="),t+=strwh("= ")[0],e.tempo_ca&&(xy_str(t,r,e.tempo_ca),t+=strwh(e.tempo_ca)[0]),e.tempo?(xy_str(t,r,e.tempo.toString()),a=cwid("0")*gene.curfont.swfac,t+=a+5,e.tempo>=10&&(t+=a,e.tempo>=100&&(t+=a))):t+=draw_notempo(e,t,r,e.new_beat,i)}e.tempo_str2&&xy_str(t,r,e.tempo_str2),e.del=!0}function draw_partempo(e,t){var r,n,a,i,o,s,l=0,c=0,u=staff_tb[e].topbar+8,$=0,f=1,p=0;for(r=tsfirst;r;r=r.ts_next)r.type!=C.TEMPO||r.del||(a||(a=r),o=tempo_width(r),s=y_get(e,!0,r.x-16,o),s>u&&(u=s),p>=r.x-16&&!($&f>>1)&&($|=f),f<<=1,p=r.x-16+o);if(a)for(set_sscale(-1),set_font("tempo"),c=gene.curfont.size+2+2,s=2-c,i=s-c,0!=$&&(c*=2),t<u+c&&(l=u+c-t),r=a;r;r=r.ts_next)r.type!=C.TEMPO||r.del||((user.anno_start||user.anno_stop)&&(r.wl=16,r.wr=30,r.ymn=1&$?i:s,r.ymx=r.ymn+14,anno_start(r)),write_tempo(r,r.x-16,1&$?i:s),anno_stop(r),$>>=1);for(u=staff_tb[e].topbar+8,r=tsfirst;r;r=r.ts_next)r.type==C.PART&&(n||(n=r,set_font("parts"),i=gene.curfont.size+2+2),o=strwh(r.text)[0],s=y_get(e,!0,r.x-10,o+3),u<s&&(u=s));if(n)for(set_sscale(-1),t<u+i+c&&(l=u+i+c-t),r=n;r;r=r.ts_next)r.type==C.PART&&(r.x-=10,(user.anno_start||user.anno_stop)&&(o=strwh(r.text)[0],r.wl=0,r.wr=o,r.ymn=-c-i,r.ymx=r.ymn+i,anno_start(r)),cfmt.partsbox?xy_str_b(r.x,2-c-i,r.text):xy_str(r.x,2-c-i,r.text),anno_stop(r));return l}function b_pos(e,t,r,n){function a(e){return 6*Math.round((e+12)/6)-12-e}var i,o,s,l,c=e?3.5:BEAM_SHIFT,u=e?1.8:BEAM_DEPTH;if(t>0){if((o=n-(r-1)*c-u)>26)return 0;i=n}else{if((i=n+(r-1)*c+u)<-2)return 0;o=n}return s=a(i-BEAM_OFFSET),l=a(o+BEAM_OFFSET),s*s>l*l?l:s}function sym_dup(e){var t,r,n=clone(e);for(n.invis=!0,delete n.text,delete n.a_gch,delete n.a_ly,delete n.a_dd,n.notes=clone(e.notes),t=0;t<=n.nhd;t++)r=n.notes[t]=clone(e.notes[t]),delete r.a_dcn;return n}function calculate_beam(e,t){var r,n,a,i,o,s,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w;for(t.beam_st||(r=sym_dup(t),lkvsym(r,t),lktsym(r,t),r.x-=12,r.x>t.prev.x+12&&(r.x=t.prev.x+12),r.beam_st=!0,delete r.beam_end,r.tmp=!0,delete r.slur_start,delete r.slur_end,t=r),a=i=0,l=c=!1,o=t.st,s=t.v,v=t.grace?GSTEM_XOFF:3.5,n=t;n.type!=C.NOTE||(n.nflags>i&&(i=n.nflags),a++,n.st!=o&&(l=!0),n.stem!=t.stem&&(c=!0),x||n.invis||n.stemless&&!n.trem2||(x=!0),!n.beam_end);n=n.next)if(!n.next){for(;n.type!=C.NOTE;n=n.prev);r=sym_dup(n),r.next=n.next,r.next&&(r.next.prev=r),n.next=r,r.prev=n,r.ts_next=n.ts_next,r.ts_next&&(r.ts_next.ts_prev=r),n.ts_next=r,r.ts_prev=n,delete r.beam_st,r.beam_end=!0,r.tmp=!0,delete r.slur_start,delete r.slur_end,r.x+=12,r.x<realwidth-12&&(r.x=realwidth-12),n=r,a++;break}if(!x)return!1;if(e.s2=n,0==staff_tb[o].y){if(l)return!1}else if(!l)return e.s1=t,e.a=(t.ys-n.ys)/(t.xs-n.xs),e.b=t.ys-t.xs*e.a+staff_tb[o].y,e.nflags=i,!0;for(y=t,g=100,m=0,r=t;r.type!=C.NOTE||(1==(b=r.p_v.scale)&&(b=staff_tb[r.st].staffscale),r.stem>=0?(u=v+r.notes[0].shhd,r.notes[r.nhd].pit>m&&(m=r.notes[r.nhd].pit,y=r)):(u=-v+r.notes[r.nhd].shhd,r.notes[0].pit<g&&(g=r.notes[0].pit,y=r)),r.xs=r.x+u*b,r!=n);r=r.next);if(cfmt.flatbeams?p=0:!c&&a>=3&&y!=t&&y!=n&&(p=0),$=t.ys+staff_tb[o].y,void 0==p&&(p=(n.ys+staff_tb[n.st].y-$)/(n.xs-t.xs)),0!=p&&(p=p>0?BEAM_SLOPE*p/(BEAM_SLOPE+p):BEAM_SLOPE*p/(BEAM_SLOPE-p)),d=$-p*t.xs,_=0,r=t,c)f=.5*((t.grace?3.5:BEAM_SHIFT)*(i-1)+BEAM_DEPTH),t.stem!=n.stem&&t.nflags<n.nflags?f*=n.stem:f*=t.stem,d+=f;else if(t.grace)for(;f=p*r.xs+d-staff_tb[r.st].y,h=GSTEM-2,r.stem>0?h-=f-3*(r.notes[r.nhd].pit-18):h+=f-3*(r.notes[0].pit-18),h+=3*(r.nflags-1),h>_&&(_=h),r!=n;r=r.next);else{for(var A=BEAM_DEPTH+BEAM_SHIFT*(i-1);r.ts_prev&&r.ts_prev.type==C.NOTE&&r.ts_prev.time==r.time&&r.ts_prev.x>t.xs;)r=r.ts_prev;for(;r&&r.time<=n.time;r=r.ts_next)if(!(r.type!=C.NOTE||r.invis||r.st!=o&&r.v!=s)){if(u=r.v==s?r.xs:r.x,f=p*u+d-staff_tb[r.st].y,r.v==s)h=min_tb[0==r.nhd?0:1][r.nflags],r.stem>0?(r.notes[r.nhd].pit>26&&(h-=2,r.notes[r.nhd].pit>28&&(h-=2)),h-=f-3*(r.notes[r.nhd].pit-18)):(r.notes[0].pit<18&&(h-=2,r.notes[0].pit<16&&(h-=2)),h-=3*(r.notes[0].pit-18)-f),h+=BEAM_DEPTH+BEAM_SHIFT*(r.nflags-1);else{if(t.stem>0)if(r.stem>0){if(r.ymn>f+4||r.ymx<f-A-2)continue;h=r.v>s?r.ymx-f:r.ymn+8-f}else h=r.ymx-f;else if(r.stem<0){if(r.ymx<f-4||r.ymn>f-A-2)continue;h=r.v<s?f-r.ymn:f-r.ymx+8}else h=f-r.ymn;h+=2+A}h>_&&(_=h)}}if(_>0&&(d+=t.stem*_),!l&&!c)for(r=t.next;;r=r.next){var k;switch(r.type){case C.REST:if(!(k=r.ts_next)||k.st!=o||k.type!=C.NOTE&&k.type!=C.REST)break;case C.BAR:if(r.invis)break;case C.CLEF:$=p*r.x+d,t.stem>0?($=r.ymx-$+BEAM_DEPTH+BEAM_SHIFT*(i-1)+2)>0&&(d+=$):($=r.ymn-$-BEAM_DEPTH-BEAM_SHIFT*(i-1)-2)<0&&(d+=$);break;case C.GRACE:for(k=r.extra;k;k=k.next)$=p*k.x+d,t.stem>0?($=k.ymx-$+BEAM_DEPTH+BEAM_SHIFT*(i-1)+2)>0&&(d+=$):($=k.ymn-$-BEAM_DEPTH-BEAM_SHIFT*(i-1)-2)<0&&(d+=$)}if(r==n)break}for(0==p&&(d+=b_pos(t.grace,t.stem,i,d-staff_tb[o].y)),r=t;;r=r.next){switch(r.type){case C.NOTE:r.ys=p*r.xs+d-staff_tb[r.st].y,r.stem>0?(r.ymx=r.ys+2.5,r.ts_prev&&r.ts_prev.stem>0&&r.ts_prev.st==r.st&&r.ts_prev.ymn<r.ymx&&r.ts_prev.x==r.x&&0==r.notes[0].shhd&&(r.ts_prev.x-=3,r.ts_prev.xs-=3)):r.ymn=r.ys-2.5;break;case C.REST:if($=p*r.x+d-staff_tb[r.st].y,w=BEAM_DEPTH+BEAM_SHIFT*(i-1)+(r.head!=C.FULL?4:9),t.stem>0){if($-=w,0==t.multi&&$>12&&($=12),r.y<=$)break}else if($+=w,0==t.multi&&$<12&&($=12),r.y>=$)break;r.head!=C.FULL&&($=6*(($+3+12)/6|0)-12),r.y=$}if(r==n)break}return 0!=staff_tb[o].y&&(e.s1=t,e.a=p,e.b=d,e.nflags=i,!0)}function draw_beams(e){function t(e,t,r,n,a,i){var o,s,l=a.s1,c=l.nflags;l.ntrem&&(c-=l.ntrem),l.trem2&&i>c&&(l.dur>=C.BLEN/2?(e=l.x+6,t=a.s2.x-6):l.dur<C.BLEN/4&&(e+=5,t-=6)),o=a.a*e+a.b-r,t-=e,t/=stv_g.scale,s=a.a*t*stv_g.scale,xypath(e,o,!0),output+="l"+t.toFixed(2)+" "+(-s).toFixed(2)+"v"+n.toFixed(2)+"l"+(-t).toFixed(2)+" "+s.toFixed(2)+'z"/>\n'}
var r,n,a,i,o,s,l,c,u,$,f,p,d=e.s1,h=e.s2;for(anno_start(d,"beam"),d.grace?(o=3.5,s=3.2,i=.29,l=1.8):(o=BEAM_SHIFT,s=BEAM_STUB,i=.34,l=BEAM_DEPTH),a=d.stem,d.stem!=h.stem&&d.nflags<h.nflags&&(a=h.stem),a<0&&(l=-l),t(d.xs-i,h.xs+i,0,l,e,1),c=0,r=d;r.type==C.NOTE&&r.stem!=a&&(r.ys=e.a*r.xs+e.b-staff_tb[r.st].y+o*(r.nflags-1)*r.stem-l),r!=h;r=r.next);for(d.feathered_beam&&(c=o/(h.xs-d.xs),d.feathered_beam>0?(c=-c,o=c*d.xs):o=c*h.xs,c*=a),i=0,n=2;n<=e.nflags;n++)for(i+=o,0!=c&&(e.a+=c),r=d;;r=r.next)if(r.type!=C.NOTE||r.nflags<n){if(r==h)break}else if(r.trem1&&n>r.nflags-r.ntrem){if(p=r.dur>=C.BLEN/2?r.x:r.xs,t(p-5,p+5,(i+2.5)*a,l,e,n),r==h)break}else{for($=r;;){if(r==h)break;if(u=r.next,u.type==C.NOTE||u.type==C.REST)if(u.trem1){if(u.nflags-u.ntrem<n)break}else if(u.nflags<n)break;if(u.beam_br1||u.beam_br2&&n>2)break;r=u}for(f=r;f.type!=C.NOTE;)f=f.prev;if(p=$.xs,$==f)if($==d)p+=s;else if($==h)p-=s;else if($.beam_br1||$.beam_br2&&n>2)p+=s;else{for(u=$.next;u.type!=C.NOTE;)u=u.next;if(u.beam_br1||u.beam_br2&&n>2)p-=s;else{for($=$.prev;$.type!=C.NOTE;)$=$.prev;$.nflags<u.nflags||$.nflags==u.nflags&&$.dots<u.dots?p+=s:p-=s}}if(t(p,f.xs,i*a,l,e,n),r==h)break}d.tmp?unlksym(d):h.tmp&&unlksym(h),anno_stop(d,"beam")}function draw_lstaff(e){function t(e,t,r){for(var n,a,i,o;!cur_sy.st_print[t];){if(cur_sy.staves[t].flags&r)return;t++}for(n=a=t;;){if(cur_sy.st_print[n]&&(a=n),cur_sy.staves[n].flags&r)break;n++}i=staff_tb[t].y+staff_tb[t].topbar*staff_tb[t].staffscale,o=staff_tb[a].y+staff_tb[a].botbar*staff_tb[a].staffscale,r&(CLOSE_BRACE|CLOSE_BRACE2)?out_brace(e,o,i-o):out_bracket(e,i,i-o)}var r,n,a,i,o=cur_sy.nstaff,s=0;for(r=0;(cur_sy.staves[r].flags&(OPEN_BRACE|OPEN_BRACKET)&&s++,!cur_sy.st_print[r])&&(cur_sy.staves[r].flags&(CLOSE_BRACE|CLOSE_BRACKET)&&s--,r!=o);r++);for(n=o;n>r&&!cur_sy.st_print[n];n--);if(r!=n||0!=s)for(a=staff_tb[n].y+staff_tb[n].botbar*staff_tb[n].staffscale,i=staff_tb[r].y+staff_tb[r].topbar*staff_tb[r].staffscale-a,xypath(e,a),output+="v"+(-i).toFixed(2)+'"/>\n',r=0;r<=o;r++)cur_sy.staves[r].flags&OPEN_BRACE&&t(e,r,CLOSE_BRACE),cur_sy.staves[r].flags&OPEN_BRACKET&&t(e,r,CLOSE_BRACKET),cur_sy.staves[r].flags&OPEN_BRACE2&&t(e-6,r,CLOSE_BRACE2),cur_sy.staves[r].flags&OPEN_BRACKET2&&t(e-6,r,CLOSE_BRACKET2)}function draw_meter(e,t){if(t.a_meter){var r,n,a,i,o=t.st,s=staff_tb[o],l=s.y;for("|||||"!=s.stafflines&&(l+=(s.topbar+s.botbar)/2-12),r=0;r<t.a_meter.length;r++){var c,u=t.a_meter[r];if(e=t.x+t.x_meter[r],u.bot){for(a=i="",n=0;n<u.top.length;n++)a+=tgls["meter"+u.top[n]].c;for(n=0;n<u.bot.length;n++)i+=tgls["meter"+u.bot[n]].c;out_XYAB('<g transform="translate(X,Y)" text-anchor="middle">\n\t<text y="-12">A</text>\n\t<text>B</text>\n</g>\n',e,l+6,a,i)}else switch(u.top[0]){case"C":c="|"!=u.top[1]?"csig":"ctsig",e-=5,l+=12;break;case"c":c="."!=u.top[1]?"imsig":"iMsig";break;case"o":c="."!=u.top[1]?"pmsig":"pMsig";break;default:for(a="",n=0;n<u.top.length;n++)a+=tgls["meter"+u.top[n]].c;out_XYAB('<text x="X" y="Y" text-anchor="middle">A</text>\n',e,l+12,a)}c&&xygl(e,l,c)}}}function draw_acc(e,t,r,n,a){if(n)if(n==a)r=-1==r?-2:2;else if(2*n!=a)return void xygl(e,t,"acc"+r+"_"+n+"_"+a);xygl(e,t,"acc"+r)}function draw_hl(e,t,r,n,a){var i,o,s=staff_tb[n],l=s.y,c=s.stafflines,u=6*(c.length-1),$=s.botline;if(/[\[|]/.test(c)){if(t%6&&(t+=3),r%6&&(r-=3),c.indexOf("-")>=0&&(t>$&&t<u||r>$&&r<u||t<=$&&r>=u)){for(i=t,o=r;i>$&&"-"==c[i/6];)i-=6;for(;o<u&&"-"==c[o/6];)o+=6;for(;i<o;i+=6)"-"==c[i/6]&&xygl(e,l+i,a)}for(;t<$;t+=6)xygl(e,l+t,a);for(;r>u;r-=6)xygl(e,l+r,a)}}function draw_keysig(e,t,r){if(!r.k_none){var n,a,i,o=r.k_old_sf,s=e.st,l=staff_tb[s].y,c=r.k_y_clef;for(1&c&&(c+=7),c/=2;c<0;)c+=7;if(c%=7,r.k_a_acc){if(r.k_a_acc.length){var u,$=r.k_a_acc[0].acc,f=100;for(n=0;n<r.k_a_acc.length;n++)u=r.k_a_acc[n],a=3*(r.k_y_clef+u.pit-18),0!=n&&(a>f+18||a<f-18)?t-=5.5:u.acc!=$&&(t+=3),$=u.acc,draw_hl(t,a,a,s,"hl"),f=a,draw_acc(t,l+a,u.acc,u.micro_n,u.micro_d),t+=5.5}}else{if((cfmt.cancelkey||0==r.k_sf)&&(0==r.k_sf||o*r.k_sf<0)){for(a=sharp_cl[c],i=a>9?sharp1:sharp2,n=0;n<o;n++)xygl(t,l+a,"acc3"),a+=i[n],t+=5.5;for(a=flat_cl[c],i=a<18?flat1:flat2,n=0;n>o;n--)xygl(t,l+a,"acc3"),a+=i[-n],t+=5.5;0!=r.k_sf&&(t+=3)}if(r.k_sf>0){for(a=sharp_cl[c],i=a>9?sharp1:sharp2,n=0;n<r.k_sf;n++)xygl(t,l+a,"acc1"),a+=i[n],t+=5.5;if(cfmt.cancelkey&&n<o)for(t+=2;n<o;n++)xygl(t,l+a,"acc3"),a+=i[n],t+=5.5}if(r.k_sf<0){for(a=flat_cl[c],i=a<18?flat1:flat2,n=0;n>r.k_sf;n--)xygl(t,l+a,"acc-1"),a+=i[-n],t+=5.5;if(cfmt.cancelkey&&n>o)for(t+=2;n>o;n--)xygl(t,l+a,"acc3"),a+=i[-n],t+=5.5}}}}function bar_cnv(e){switch(e){case"[":case"[]":return"";case"|:":case"|::":case"|:::":return"["+e;case":|":case"::|":case":::|":return e+"]";case"::":return cfmt.dblrepbar;case"||:":return"[|:"}return e}function draw_bar(e,t,r){var n,a,i,o,s=e.st,l=staff_tb[s],c=e.x;if(o=bar_cnv(e.bar_type)){if(0!=s&&e.ts_prev&&e.ts_prev.type!=C.BAR&&(r=l.topbar*l.staffscale),e.ymx=e.ymn+r,set_sscale(-1),anno_start(e),i=l.y+12,"|||||"!=l.stafflines&&(i+=(l.topbar+l.botbar)/2-12),e.bar_mrep)if(set_sscale(s),1==e.bar_mrep){for(a=e.prev;a.type!=C.REST;a=a.prev);xygl(a.x,i,"mrep")}else xygl(c,i,"mrep2"),e.v==cur_sy.top_voice&&(set_font("annotation"),xy_str(c,i+l.topbar-9,e.bar_mrep.toString(),"c"));for(n=o.length;--n>=0;){switch(o[n]){case"|":set_sscale(-1),out_bar(c,t,r,e.bar_dotted);break;default:c-=3,set_sscale(-1),out_thbar(c,t,r);break;case":":c-=2,set_sscale(s),xygl(c+1,i-12,"rdots")}c-=3}set_sscale(-1),anno_stop(e)}}function draw_rest(e){var t,r,n,a,i,o,s=staff_tb[e.st];if(s.topbar){if(e.dur==e.p_v.meter.wmeasure||e.rep_nb&&e.rep_nb>=0){for(t=e.ts_next;t&&t.time!=e.time+e.dur;)t=t.ts_next;for(a=t?t.x:realwidth,t=e;!t.seqst;)t=t.ts_prev;t=t.ts_prev,a=(a+t.x)/2,e.a_dd&&deco_update(e,a-e.x),e.x=a}else a=e.x,e.notes[0].shhd&&(a+=e.notes[0].shhd*stv_g.scale);if(!e.invis){if(o=s.y,e.rep_nb)return set_sscale(e.st),anno_start(e),"|||||"==s.stafflines?o+=12:o+=(s.topbar+s.botbar)/2,e.rep_nb<0?xygl(a,o,"srep"):(xygl(a,o,"mrep"),e.rep_nb>2&&e.v==cur_sy.top_voice&&(set_font("annotation"),xy_str(a,o+s.topbar-9,e.rep_nb.toString(),"c"))),void anno_stop(e);if(set_scale(e),anno_start(e),i=e.y,r=5-e.nflags,7==r&&12==i&&s.stafflines.length<=2&&(i-=6),xygl(a,i+o,e.notes[0].head?e.notes[0].head:rest_tb[r]),r>=6){switch(n=i/6,r){default:switch(s.stafflines[n+1]){case"|":case"[":break;default:xygl(a,i+6+o,"hl1")}9==r&&(i-=6,n--);break;case 7:i+=6,n++;case 6:}switch(s.stafflines[n]){case"|":case"[":break;default:xygl(a,i+o,"hl1")}}for(a+=8,i+=o+3,r=0;r<e.dots;r++)xygl(a,i,"dot"),a+=3.5;anno_stop(e)}}}function draw_gracenotes(e){var t,r,n,a,i,o,s,l,c,u,$,f,p,d,h,_,g={};for(d=e.extra;d&&(d.beam_st&&!d.beam_end&&calculate_beam(g,d)&&draw_beams(g),anno_start(d),draw_note(d,!g.s2),d==g.s2&&(g.s2=null),anno_stop(d),d.next);d=d.next);if(e.sappo&&(d=e.extra,d.next?(a=.5*(d.next.x-d.x)+4,i=.5*(d.ys+d.next.ys)-d.y,d.stem>0?i-=1:i+=1):(a=9,i=d.stem>0?5:-5),_=d.notes[d.stem<0?0:d.nhd],out_acciac(x_head(d,_),y_head(d,_),a,i,d.stem>0)),!e.p_v.key.k_bagpipe&&cfmt.graceslurs&&!e.slur_start&&e.next&&e.next.type==C.NOTE){if(h=d,h.stem>=0){for(t=127,d=e.extra;d;d=d.next)d.y<t&&(t=d.y,h=d);r=h.x,n=h.y-5,e.extra!=h&&(r-=4,n+=1),e=e.next,l=e.x-1,e.stem<0&&(l-=4),c=3*(e.notes[0].pit-18)-5,f=.4*(l-r),f>3&&(f=3),p=f,u=.2,$=.8,n>c+7?(r=h.x-1,n+=.5,c+=6.5,l=e.x-5.5,f=.8*(n-c),p=.2*(n-c),u=0):c>n+4&&(c=n+4,r=h.x+2,n=h.y-4)}else{for(t=-127,d=e.extra;d;d=d.next)d.y>t&&(t=d.y,h=d);r=h.x,n=h.y+5,e.extra!=h&&(r-=4,n-=1),e=e.next,l=e.x-1,e.stem>=0&&(l-=2),c=3*(e.notes[e.nhd].pit-18)+5,f=.4*(r-l),f<-3&&(f=-3),p=f,u=.2,$=.8,n<c-7?(r=h.x-1,n-=.5,c-=6.5,l=e.x-5.5,f=.8*(n-c),p=.2*(n-c),u=0):c<n-4&&(c=n-4,r=h.x+2,n=h.y+4)}a=u*l+(1-u)*r-r,i=u*c+(1-u)*n-f-n,o=$*l+(1-$)*r-r,s=$*c+(1-$)*n-p-n,anno_start(e,"slur"),xypath(r,n+staff_tb[e.st].y),output+="c"+a.toFixed(2)+" "+(-i).toFixed(2)+" "+o.toFixed(2)+" "+(-s).toFixed(2)+" "+(l-r).toFixed(2)+" "+(-c+n).toFixed(2)+'"/>\n',anno_stop(e,"slur")}}function setdoty(e,t){var r,n,a;for(r=0;r<=e.nhd;r++)a=3*(e.notes[r].pit-18),a%6==0&&(e.dot_low?a-=3:a+=3),t[r]=a;for(r=0;r<e.nhd;r++)if(!(t[r+1]>t[r])){for(n=r;n>0&&!(t[n]>t[n-1]+6);)n--;if(3*(e.notes[n].pit-18)-t[n]<t[r+1]-3*(e.notes[r+1].pit-18))for(;n<=r;)t[n++]-=6;else t[r+1]=t[r]+6}}function x_head(e,t){return e.x+t.shhd*stv_g.scale}function y_head(e,t){return staff_tb[e.st].y+3*(t.pit-18)}function draw_basic_note(e,t,r,n){var a,i,o,s,l,c=!1,u=t.notes[r],$=staff_tb[t.st].y,f=3*(u.pit-18),p=u.shhd*stv_g.scale,d=e+p,h=f+$,_=identify_note(t,u.dur),g=_[0],m=_[1];_[2];if(f%6==0&&p!=(t.stem>0?t.notes[0].shhd:t.notes[t.nhd].shhd)&&(o=0,f>=30?(o=f)%6&&(o-=3):f<=-6&&(o=f)%6&&(o+=3),o&&xygl(d,o+$,"hl")),u.invis);else if(t.grace)i="ghd",d-=4.5*stv_g.scale;else if(u.map&&u.map[0])a=t.head,i=u.map[0][a],i||(i=u.map[0][u.map[0].length-1]),(a=i.indexOf("/"))>=0&&(i=t.stem>=0?i.slice(0,a):i.slice(a+1));else if(t.type==C.CUSTOS)i="custos";else switch(g){case C.OVAL:i="HD";break;case C.OVALBARS:if(t.head!=C.SQUARE){i="HDD";break}case C.SQUARE:i=u.dur<4*C.BLEN?"breve":"longa",tsnext||!t.next||t.next.type!=C.BAR||t.next.next||(m=0);break;case C.EMPTY:i="Hd";break;default:i="hd"}if(void 0!=u.color?c=set_color(u.color):u.map&&u.map[2]&&(c=set_color(u.map[2])),i&&xygl(d,h,i),m)for(s=e+(7.7+t.xmx)*stv_g.scale,void 0==n[r]&&(n[r]=3*(t.notes[r].pit-18),0==(1&t.notes[r].pit)&&(n[r]+=3)),l=n[r]+$;--m>=0;)xygl(s,l,"dot"),s+=3.5;u.acc&&(e-=u.shac*stv_g.scale,t.grace?(g_open(e,f+$,0,.75),draw_acc(0,0,u.acc,u.micro_n,u.micro_d),g_close()):draw_acc(e,f+$,u.acc,u.micro_n,u.micro_d)),void 0!=c&&set_color(c)}function draw_note(e,t){var r,n,a,i,o,s,l,c,a,u,$=new Array(e.nhd+1);if(e.dots&&setdoty(e,$),u=e.notes[e.stem<0?e.nhd:0],c=x_head(e,u),i=staff_tb[e.st].y,e.grace)s="ghl";else switch(e.head){default:s="hl";break;case C.OVAL:case C.OVALBARS:s="hl1";break;case C.SQUARE:s="hl2"}if(draw_hl(c,3*(e.notes[0].pit-18),3*(e.notes[e.nhd].pit-18),e.st,s),a=y_head(e,u),e.stemless?e.xstem&&(r=e.ts_prev,o=(r.stem>0?r.y:r.ys)-e.y,o+=staff_tb[r.st].y-i,o/=e.p_v.scale,out_stem(c,a,o)):(o=e.ys-e.y,l=e.nflags,e.ntrem&&(l-=e.ntrem),!t||l<=0?(e.nflags>0&&(e.stem>=0?o-=1:o+=1),out_stem(c,a,o,e.grace)):out_stem(c,a,o,e.grace,l,cfmt.straightflags)),t&&e.trem1){var f=e.ntrem||0,p=c;o=3*(e.notes[e.stem>0?e.nhd:0].pit-18),e.head==C.FULL||e.head==C.EMPTY?(p+=(e.grace?GSTEM_XOFF:3.5)*e.stem,e.stem>0?o+=6+5.4*f:o-=11.4):e.stem>0?o+=5+5.4*f:o-=10.4,o/=e.p_v.scale,out_trem(p,i+o,f)}for(c=e.x,n=0;n<=e.nhd;n++)draw_basic_note(c,e,n,$)}function next_scut(e){var t=e;for(e=e.next;e;e=e.next){if(e.rbstop)return e;t=e}return t}function prev_scut(e){for(;e.prev;)if(e=e.prev,e.rbstart)return e;for(e=e.p_v.sym;e.type!=C.CLEF;)e=e.ts_prev;return e.next&&e.next.type==C.KEY&&(e=e.next),e.next&&e.next.type==C.METER?e.next:e}function slur_direction(e,t){var r,n,a;if(e.grace&&e.stem>0)return-1;for(r=e;;r=r.next){if(r.type==C.NOTE){if(!r.stemless){if(r.stem<0)return 1;n=!0}r.notes[0].pit<22&&(a=!0)}if(r==t)break}return n||a?-1:1}function slur_out(e,t,r,n,a,i,o){var s,l,c,u=.3;l=n-t,l<0&&(l=-l),(s=r-e)>40&&l/s<.7&&(u=.3+.002*(s-40))>.7&&(u=.7);var $=.5*(e+r),f=.5*(t+n),p=$+u*(e-$),d=f+u*(t-f)+i;p=e+.45*(p-e),d=t+.45*(d-t);var h=$+u*(r-$),_=f+u*(n-f)+i;h=r+.45*(h-r),_=n+.45*(_-n),s=.03*(r-e),l=2*a,c=.2+.001*(r-e),c>.6&&(c=.6),c*=a;var g=stv_g.v?stv_g.scale:1;output+=o?'<path class="stroke" stroke-dasharray="5,5" d="M':'<path class="fill" d="M',out_sxsy(e," ",t),output+="c"+((p-e)/stv_g.scale).toFixed(2)+" "+((t-d)/g).toFixed(2)+" "+((h-e)/stv_g.scale).toFixed(2)+" "+((t-_)/g).toFixed(2)+" "+((r-e)/stv_g.scale).toFixed(2)+" "+((t-n)/g).toFixed(2),o||(output+="\n\tv"+(-c).toFixed(2)+"c"+((h-s-r)/stv_g.scale).toFixed(2)+" "+((n+c-_-l)/g).toFixed(2)+" "+((p+s-r)/stv_g.scale).toFixed(2)+" "+((n+c-d-l)/g).toFixed(2)+" "+((e-r)/stv_g.scale).toFixed(2)+" "+((n+c-t)/g).toFixed(2)),output+='"/>\n'}function slur_multi(e,t){for(;;){if(e.multi)return e.multi;if(e==t)break;e=e.next}return 0}function draw_slur(e,t,r,n,a){for(var i,o,s,l,c,u,$,f,p,d,h,_,g,m,y,v=e;v.v!=t.v;)v=v.ts_next;switch(7&a){case C.SL_ABOVE:y=1;break;case C.SL_BELOW:y=-1;break;default:y=slur_multi(v,t),y||(y=slur_direction(v,t))}var b=1,x=v.st,w=!1;if(v!=t)for(i=v.next;;){if(i.type!=C.NOTE&&i.type!=C.REST||(b++,i.st!=x&&(w=!0,i.st<x&&(x=i.st))),i==t)break;i=i.next}if(w&&error(2,v,"*** multi-staves slurs not treated yet"),s=e.x,e.notes&&e.notes[0].shhd&&(s+=e.notes[0].shhd),e!=t)c=t.x,t.notes&&(c+=t.notes[0].shhd);else{for(i=t.ts_next;i&&i.type!=C.STAVES;i=i.ts_next);c=i?i.x:realwidth}if(r>=0?l=3*(v.notes[r].pit-18)+5*y:(l=y>0?v.ymx+2:v.ymn-2,v.type==C.NOTE&&(y>0?v.stem>0&&(s+=5,v.beam_end&&v.nflags>=-1&&!v.in_tuplet&&(v.nflags>0?(s+=2,l=v.ys-3):l=v.ys-6)):v.stem<0&&(s-=1,t.grace?l=v.y-8:v.beam_end&&v.nflags>=-1&&(!v.in_tuplet||v.ys<l+3)&&(v.nflags>0?(s+=2,l=v.ys+3):l=v.ys+6)))),n>=0?u=3*(t.notes[n].pit-18)+5*y:(u=y>0?t.ymx+2:t.ymn-2,t.type==C.NOTE&&(y>0?t.stem>0&&(c+=1,t.beam_st&&t.nflags>=-1&&!t.in_tuplet&&(u=t.ys-6)):t.stem<0&&(c-=5,t.beam_st&&t.nflags>=-1&&!t.in_tuplet&&(u=t.ys+6)))),v.type!=C.NOTE&&(l=u+1.2*y,(s=v.x+.5*v.wr)>c-12&&(s=c-12)),t.type!=C.NOTE&&(u=v.type==C.NOTE?l+1.2*y:l,v!=t&&(c=t.x-.3*t.wl)),b>=3&&(v.next.type!=C.BAR&&v.next.x<s+48&&(y>0?(d=v.next.ymx-2,l<d&&(l=d)):(d=v.next.ymn+2,l>d&&(l=d))),t.prev&&t.prev.type!=C.BAR&&t.prev.x>c-48&&(y>0?(d=t.prev.ymx-2,u<d&&(u=d)):(d=t.prev.ymn+2,u>d&&(u=d)))),p=(u-l)/(c-s),(p>SLUR_SLOPE||p<-SLUR_SLOPE)&&(p=p>SLUR_SLOPE?SLUR_SLOPE:-SLUR_SLOPE,p*y>0?l=u-p*(c-s):u=l+p*(c-s)),d=u-l,d>8?d=8:d<-8&&(d=-8),h=d,h<0&&(h=-h),g=.5*h,m=.3*d,d*y>0?(c-=g,u-=m):(s+=g,l+=m),v.grace&&(s=v.x-.5*GSTEM_XOFF),t.grace&&(c=t.x+1.5*GSTEM_XOFF),_=0,p=(u-l)/(c-s),v!=t&&v.v==t.v){for(f=l-p*s,i=v.next;i!=t;i=i.next)if(i.st==x)switch(i.type){case C.NOTE:case C.REST:y>0?(d=3*(i.notes[i.nhd].pit-18)+6,d<i.ymx&&(d=i.ymx),(d-=p*i.x+f)>_&&(_=d)):(d=3*(i.notes[0].pit-18)-6,d>i.ymn&&(d=i.ymn),(d-=p*i.x+f)<_&&(_=d));break;case C.GRACE:for(o=i.extra;o;o=o.next)y>0?(d=3*(o.notes[o.nhd].pit-18)+6,d<o.ymx&&(d=o.ymx),(d-=p*o.x+f)>_&&(_=d)):(d=3*(o.notes[0].pit-18)-6,d>o.ymn&&(d=o.ymn),(d-=p*o.x+f)<_&&(_=d))}l+=.45*_,u+=.45*_,_*=.65}if($=b>3?(.08*(c-s)+12)*y:(.03*(c-s)+8)*y,y>0?($<3*_&&($=3*_),$>40&&($=40)):($>3*_&&($=3*_),$<-40&&($=-40)),d=u-l,d<0&&(d=-d),y>0?$<.8*d&&($=.8*d):$>-.8*d&&($=-.8*d),$*=cfmt.slurheight,slur_out(s,l,c,u,y,$,a&C.SL_DOTTED),g=c-s,p=(u-l)/g,f=l-p*s+.4*$,v.v==t.v)for(i=v;i!=t;i=i.next)i.st==x&&(d=p*i.x+f,i.ymx<d?i.ymx=d:i.ymn>d&&(i.ymn=d),i.next==t?(g=c,t.sl1&&(g-=5)):g=i.next.x,i!=v&&(s=i.x),g-=s,y_set(x,y>0,s,g,d));return(y>0?C.SL_ABOVE:C.SL_BELOW)|a&C.SL_DOTTED}function draw_slurs(e,t){for(var r,n,a,i,o,s,l,c,u=e;;){if(!u||u==t){if(!a||!(u=a.next)||u==t)break;a=null}if(u.type!=C.GRACE)if(u.type!=C.NOTE&&u.type!=C.REST&&u.type!=C.SPACE||!u.slur_start&&!u.sl1)u=u.next;else{n=null,r=u.next;for(var $=!1;;)if(r)if(r.type!=C.GRACE){if(r.type==C.BAR&&(":"==r.bar_type[0]||"|]"==r.bar_type||"[|"==r.bar_type||r.text&&"1"!=r.text[0])){n=r;break}if(r.type==C.NOTE||r.type==C.REST||r.type==C.SPACE){if(r.slur_end||r.sl2){n=r;break}if(r.slur_start||r.sl1){if(i){for(n=r;n.next;n=n.next);n.next=i.next,i.next&&(i.next.prev=n),n=null}draw_slurs(r,t),i&&i.next&&(i.next.prev.next=null,i.next.prev=i)}if(r==t)break;r=r.next}else r=r.next}else i=r,r=r.extra;else{if(i){r=i.next,i=null;continue}if(!a||$)break;r=a.next,$=!0}if(r){if(!n){if((u=r)==t)break;continue}}else n=next_scut(u);if(a){for(r=u;r.next;r=r.next);r.next=a.next,a.next&&(a.next.prev=r),a.slur_start=C.SL_AUTO}if(i&&(i.prev.next=i.extra,i.extra.prev=i.prev,i.slur_start=C.SL_AUTO),u.slur_start)l=15&u.slur_start,u.slur_start>>=4,o=-1;else{for(o=0;o<=u.nhd&&!u.notes[o].sl1;o++);l=15&u.notes[o].sl1,u.notes[o].sl1>>=4,u.sl1--}if(s=-1,c=0,n.type!=C.NOTE&&n.type!=C.REST&&n.type!=C.SPACE||!n.slur_end&&!n.sl2)n.type==C.BAR&&(":"==n.bar_type[0]||"|]"==n.bar_type||"[|"==n.bar_type||n.text&&"1"!=n.text[0])||(c=1);else if(n.slur_end)n.slur_end--;else{for(s=0;s<=n.nhd&&!n.notes[s].sl2;s++);n.notes[s].sl2--,n.sl2--}if(l=draw_slur(u,n,o,s,l),c&&(n.p_v.slur_start||(n.p_v.slur_start=0),n.p_v.slur_start<<=4,n.p_v.slur_start+=l),a&&a.next&&(a.next.prev.next=null,a.next.prev=a),i&&(i.prev.next=i,i.extra.prev=null),!u.slur_start&&!u.sl1){if(u==t)break;u=u.next}}else a=u,u=u.extra}}function draw_tuplet(e,t){var r,n,a,i,o,s,l,c,u,$,f,p,d,h,_,g,m,d,y,v,b,x,w;for(i=e.st,r=e;r;r=r.next)if(r.type==C.NOTE||r.type==C.REST){if((r.slur_start||r.slur_end||r.sl1||r.sl2)&&(s=!0),r.st<i&&(i=r.st),0==t){if(r.tp1&&draw_tuplet(r,1),r.te0)break}else if(r.te1)break}else if(r.type==C.GRACE)for(a=r.extra;a;a=a.next)(a.slur_start||a.sl1)&&(s=!0);if(!r)return error(1,e,"No end of tuplet in this music line"),void(0==t?e.tp0=0:e.tp1=0);if(s){if(draw_slurs(e,r),e.slur_start||e.sl1)return;for(n=e.next;n!=r;n=n.next)if(n.slur_start||n.slur_end||n.sl1||n.sl2)return;if(r.slur_end||r.sl2)return}if(0==t?(b=e.tp0,e.tp0=0,x=e.tq0):(b=e.tp1,e.tp1=0,x=e.tq1),1!=e.tf[0]){if(v=e.tf[3],v||(v=e.stem>0?C.SL_ABOVE:C.SL_BELOW),e==r)o=!0;else if(1==e.tf[1])o=!0,draw_slur(e,r,-1,-1,v);else if(2==e.tf[0]||e.type!=C.NOTE||r.type!=C.NOTE)o=!1;else{for(o=!0,n=e;;n=n.next){if(n.type!=C.NOTE&&n.type!=C.REST){if(n.type==C.GRACE||n.type==C.SPACE)continue;o=!1;break}if(n==r)break;if(n.beam_end){o=!1;break}}if(o&&!e.beam_st&&!e.beam_br1&&!e.beam_br2)for(n=e.prev;n;n=n.prev)if(n.type==C.NOTE||n.type==C.REST){n.nflags>=e.nflags&&(o=!1);break}if(o&&!r.beam_end)for(n=r.next;n;n=n.next)if(n.type==C.NOTE||n.type==C.REST){!n.beam_br1&&!n.beam_br2&&n.nflags>=r.nflags&&(o=!1);break}}if(o){if(1==e.tf[2])return;for(f=(r.x+e.x)/2,d=e==r?0:(r.ys-e.ys)/(r.x-e.x),y=e.ys-d*e.x,_=d*f+y,v==C.SL_ABOVE?(p=y_get(i,1,f-4,8),p>_&&(y+=p-_),y+=2):(p=y_get(i,0,f-4,8),p<_&&(y+=p-_),y-=10),n=e;!(n.x>=f);n=n.next);return e.stem*r.stem>0&&(e.stem>0?f+=1.5:f-=1.5),p=d*f+y,0==e.tf[2]?out_bnum(f,p,b):out_bnum(f,p,b+":"+x),void(v==C.SL_ABOVE?(p+=10,n.ymx<p&&(n.ymx=p),y_set(i,!0,f-3,6,p)):(n.ymn>p&&(n.ymn=p),y_set(i,!1,f-3,6,p)))}if(0!=e.tf[1]&&error(2,e,"'what' value of %%tuplets not yet coded"),v=e.tf[3],v||(v=e.multi>=0?C.SL_ABOVE:C.SL_BELOW),v==C.SL_ABOVE){if(e.st==r.st?u=$=staff_tb[i].topbar+4:(u=e.ymx,$=r.ymx),l=e.x-4,e.st==i){for(n=e;!n.dur;n=n.next);p=y_get(i,1,n.x-4,8),p>u&&(u=p),e.stem>0&&(l+=3)}if(r.st==i){for(n=r;!n.dur;n=n.prev);p=y_get(i,1,n.x-4,8),p>$&&($=p)}for(r.dur>r.prev.dur?c=r.next?r.next.x-r.next.wl-5:realwidth-6:(c=r.x+4,w=r.stem>=0?0:r.nhd,r.notes[w].shhd>0&&(c+=r.notes[w].shhd),r.st==i&&r.stem>0&&(c+=3.5)),f=.5*(l+c),p=.5*(u+$),d=($-u)/(c-l),h=3*(r.notes[r.nhd].pit-e.notes[e.nhd].pit)/(c-l),h>0?d<0?d=0:d>h&&(d=h):d>0?d=0:d<h&&(d=h),d*d<.1*.1&&(d=0),m=0,n=e;;n=n.next)if(n.dur&&n.st==i){if(_=p+(n.x-f)*d,g=y_get(i,1,n.x-4,8)+2,g-_>m&&(m=g-_),n==r)break}else if(n==r)break;for(p+=m,u=p+d*(l-f),$=p+d*(c-f),p+=8,n=e;;n=n.next)if(n.st==i){if(_=p+(n.x-f)*d,n.ymx<_&&(n.ymx=_),n==r)break;y_set(i,!0,n.x,n.next.x-n.x,_)}else if(n==r)break}else{if(l=e.x-7,r.dur>r.prev.dur?c=r.next?r.next.x-r.next.wl-8:realwidth-6:(c=r.x+2,r.notes[r.nhd].shhd>0&&(c+=r.notes[r.nhd].shhd)),e.stem>=0&&(l+=2,c+=2),e.st==i){for(n=e;!n.dur;n=n.next);u=y_get(i,0,n.x-4,8)}else u=0;if(r.st==i){for(n=r;!n.dur;n=n.prev);$=y_get(i,0,n.x-4,8)}else $=0;for(f=.5*(l+c),p=.5*(u+$),d=($-u)/(c-l),h=3*(r.notes[0].pit-e.notes[0].pit)/(c-l),h>0?d<0?d=0:d>h&&(d=h):d>0?d=0:d<h&&(d=h),d*d<.1*.1&&(d=0),m=0,n=e;;n=n.next)if(n.dur&&n.st==i){if(_=p+(n.x-f)*d,g=y_get(i,0,n.x-4,8),g-_<m&&(m=g-_),n==r)break}else if(n==r)break;for(p+=m-10,u=p+d*(l-f),$=p+d*(c-f),p-=2,n=e;;n=n.next){if(n.st==i){if(n==r)break;_=p+(n.x-f)*d,n.ymn>_&&(n.ymn=_),y_set(i,!1,n.x,n.next.x-n.x,_)}if(n==r)break}}if(1==e.tf[2])return void out_tubr(l,u+4,c-l,$-u,v==C.SL_ABOVE);out_tubrn(l,u,c-l,$-u,v==C.SL_ABOVE,0==e.tf[2]?b.toString():b+":"+x),_=.5*(u+$),v==C.SL_ABOVE?y_set(i,!0,f-3,6,_+9):y_set(i,!1,f-3,6,_)}}function draw_note_ties(e,t,r,n,a){var i,o,s,l,c,u,$,f,p,d,h,_,g,m;for(i=0;i<r.length;i++){switch(s=r[i],c=e.notes[s].pit,l=n[i],u=2!=a?t.notes[l].pit:c,o=(7&e.notes[s].ti1)==C.SL_ABOVE?1:-1,d=e.x,g=e.notes[s].shhd,o>0?s<e.nhd&&c+1==e.notes[s+1].pit&&e.notes[s+1].shhd>g&&(g=e.notes[s+1].shhd):s>0&&c==e.notes[s-1].pit+1&&e.notes[s-1].shhd>g&&(g=e.notes[s-1].shhd),d+=.6*g,h=t.x,2!=a&&(g=t.notes[l].shhd,o>0?l<t.nhd&&u+1==t.notes[l+1].pit&&t.notes[l+1].shhd<g&&(g=t.notes[l+1].shhd):l>0&&u==t.notes[l-1].pit+1&&t.notes[l-1].shhd<g&&(g=t.notes[l-1].shhd),h+=.6*g),f=e.st,a){case 0:c==u||1&c||(c=u);break;case 3:o=-o;case 1:d=e.x,d>h-20&&(d=h-20),c=u,f=t.st;break;default:if(e!=t)h-=t.wl,t.type==C.BAR&&(h+=5);else{for(m=e.time+e.dur,p=e.ts_next;p&&!(p.time>m);p=p.ts_next);h=p?p.x:realwidth}h<d+16&&(h=d+16)}h-d>20?(d+=3.5,h-=3.5):(d+=1.5,h-=1.5),$=3*(c-18),_=(.04*(h-d)+10)*o,slur_out(d,staff_tb[f].y+$,h,staff_tb[f].y+$,o,_,e.notes[s].ti1&C.SL_DOTTED)}}function draw_ties(e,t,r){var n,a,i,o,s,l,c=[],u=[],$=[],f=e.nhd,p=e.time+e.dur;if(2==r){for(a=0;a<=f;a++)e.notes[a].ti1&&$.push(a);return void draw_note_ties(e,t||e,$,$,r)}for(a=0;a<=f;a++)if(e.notes[a].ti1){for(l=-1,s=e.notes[a].apit,o=t.nhd;o>=0;o--){switch(t.notes[o].apit-s){case 1:case-1:e.notes[a].acc!=t.notes[o].acc&&(l=o);default:continue;case 0:l=o}break}l>=0?(c.push(a),u.push(l)):$.push(a)}if(draw_note_ties(e,t,c,u,r),$.length){for(n=e.ts_next;n&&n.time<p;)n=n.ts_next;for(;n&&n.time==p;)if(n.type==C.NOTE&&n.st==e.st){for(c.length=0,u.length=0,a=$.length;--a>=0;)for(i=$[a],s=e.notes[i].apit,o=n.nhd;o>=0;o--)if(n.notes[o].apit==s){c.push(i),u.push(o),$[a]=$.pop();break}if(c.length>0&&(draw_note_ties(e,n,c,u,1==r?1:0),0==$.length))return;n=n.ts_next}else n=n.ts_next;0!=$.length&&error(1,e,"Bad tie")}}function tie_comb(e){var t,r,n;for(r=e.time+e.dur,n=e.st,t=e.ts_next;t;t=t.ts_next)if(t.st==n)if(t.time!=r){if(t.time>r)return e}else if(t.type==C.NOTE)return t}function draw_all_ties(e){function t(e,t,r){var n;if(e.type==C.GRACE)for(n=e.extra;n;n=n.next)n.ti1&&draw_ties(n,t,r);else draw_ties(e,t,r)}var r,n,a,i,o,s,l,c,u;for(r=e.sym;r;r=r.next){switch(r.type){case C.CLEF:case C.KEY:case C.METER:continue}break}for(s=e.s_rtie,n=r;n&&(!n.dur&&n.type!=C.GRACE);n=n.next)n.type==C.BAR&&n.text&&("1"==n.text[0]?s=e.s_tie:e.s_tie=s);if(n){for(e.s_tie&&(e.s_tie.x=r.x+r.wr,r=e.s_tie,e.s_tie=null,r.st=n.st,r.ts_next=n.ts_next,r.time=n.time-r.dur,draw_ties(r,n,1));;){for(r=n;r&&!r.ti1;r=r.next)if(s&&r.type==C.BAR&&r.text)if("1"!=r.text[0]){if("|"!=r.bar_type){for(n=r.next;n&&n.type!=C.NOTE;n=n.next);if(!n){r=null;break}l=clone(s),l.x=r.x,l.next=n,l.st=n.st,l.time=n.time-l.dur,draw_ties(l,n,1)}}else s=null;if(!r)break;for(o=r.time+r.dur,n=r.next;n&&!n.dur;n=n.next)if(n.text){if("1"!=n.text[0])break;s=r}if(n){if(n.type!=C.NOTE&&n.type!=C.BAR){error(1,r,"Bad tie");continue}if(n.time!=o){if((a=tie_comb(r))==r){error(1,r,"Bad tie");continue}n=a}}else{for(n=r.ts_next;n;n=n.ts_next)if(n.st==r.st&&!(n.time<o)){if(n.time>o){n=null;break}if(n.dur)break}if(!n){t(r,null,2),e.s_tie=r;break}}for(a=r.ts_next;a;a=a.ts_next)if(a.st==r.st){if(a.time>o)break;a.type!=C.CLEF||(i=!0)}i||r.st!=n.st?(i=!1,u=.4*(n.x-r.x),c=n.x,n.x-=u,n.x>r.x+32&&(n.x=r.x+32),t(r,n,2),n.x=c,c=r.x,r.x+=u,r.x<n.x-24&&(r.x=n.x-24),draw_ties(r,n,3),r.x=c):t(r,n,n.type==C.NOTE?0:2)}e.s_rtie=s}}function draw_all_slurs(e){var t,r,n=e.sym,a=e.slur_start,i=0;if(n){if(a)for(e.slur_start=0;0!=a;)i<<=4,i|=15&a,a>>=4;for(draw_slurs(n,void 0);n;n=n.next)for(;n.slur_end||n.sl2;){if(n.slur_end)n.slur_end--,r=-1;else{for(r=0;r<=n.nhd&&!n.notes[r].sl2;r++);n.notes[r].sl2--,n.sl2--}a=15&i,t=prev_scut(n),draw_slur(t,n,-1,r,a),t.type==C.BAR&&(":"==t.bar_type[0]||"|]"==t.bar_type||"[|"==t.bar_type||t.text&&"1"!=t.text[0])||(i>>=4)}for(n=e.sym;0!=i;)a=15&i,i>>=4,t=next_scut(n),draw_slur(n,t,-1,-1,a),t.type==C.BAR&&(":"==t.bar_type[0]||"|]"==t.bar_type||"[|"==t.bar_type||t.text&&"1"!=t.text[0])||(e.slur_start||(e.slur_start=0),e.slur_start<<=4,e.slur_start+=a)}}function draw_sym_near(){var e,t,r,n,a,i,o,s,l,a,c,u,$,f;for(f=output,output="",n=0;n<voice_tb.length;n++){var p={},d=!0;for(e=voice_tb[n],r=e.sym;r;r=r.next)switch(r.type){case C.GRACE:for(o=r.extra;o;o=o.next)o.beam_st&&!o.beam_end&&calculate_beam(p,o);break;case C.NOTE:(r.beam_st&&!r.beam_end||d&&!r.beam_st)&&(d=!1,calculate_beam(p,r))}}for(a=0;a<=nstaff;a++)for(t=staff_tb[a],t.top||(t.top=new Float32Array(YSTEP),t.bot=new Float32Array(YSTEP)),l=0;l<YSTEP;l++)t.top[l]=0,t.bot[l]=24;for(set_tie_room(),draw_deco_near(),r=tsfirst;r;r=r.ts_next)if(!r.invis){switch(r.type){case C.GRACE:for(o=r.extra;o;o=o.next)y_set(r.st,!0,o.x-2,4,o.ymx+1),y_set(r.st,!1,o.x-2,4,o.ymn-1);continue;case C.MREST:y_set(r.st,!0,r.x+16,32,r.ymx+2);continue;default:y_set(r.st,!0,r.x-r.wl,r.wl+r.wr,r.ymx+2),y_set(r.st,!1,r.x-r.wl,r.wl+r.wr,r.ymn-2);continue;case C.NOTE:}r.stem>0?(r.beam_st?(c=3,s=r.beam_end?4:10):(c=-8,s=r.beam_end?11:16),y_set(r.st,!0,r.x+c,s,r.ymx),y_set(r.st,!1,r.x-r.wl,r.wl+r.wr,r.ymn)):(y_set(r.st,!0,r.x-r.wl,r.wl+r.wr,r.ymx),r.beam_st?(c=-6,s=r.beam_end?4:10):(c=-8,s=r.beam_end?5:16),c+=r.notes[0].shhd,y_set(r.st,!1,r.x+c,s,r.ymn)),r.notes[r.nhd].acc&&(i=r.y+8,r.ymx<i&&(r.ymx=i),y_set(r.st,!0,r.x,0,i)),r.notes[0].acc&&(i=r.y,1==r.notes[0].acc||3==r.notes[0].acc?i-=7:i-=5,r.ymn>i&&(r.ymn=i),y_set(r.st,!1,r.x,0,i))}for(n=0;n<voice_tb.length;n++)if(e=voice_tb[n],r=e.sym){for(set_color(r.color),a=e.st,set_dscale(a);r;r=r.next)r.tp0&&draw_tuplet(r,0);for(draw_all_slurs(e),r=e.sym;r;r=r.next)r.tp0&&draw_tuplet(r,0)}for(a=0;a<=nstaff;a++)for(t=staff_tb[a],u=t.topbar+2,$=t.botbar-2,l=0;l<YSTEP;l++)u>t.top[l]&&(t.top[l]=u),$<t.bot[l]&&(t.bot[l]=$);for(set_color(void 0),draw_deco_note(),draw_deco_staff(),set_dscale(-1),n=0;n<voice_tb.length;n++)if(e=voice_tb[n],e.have_ly){draw_all_lyrics();break}cfmt.measurenb>=0&&draw_measnb(),set_dscale(-1),output=f}function draw_vname(e){var t,r,n,a,i,o,s,l,c=[];for(n=cur_sy.nstaff;n>=0&&!cur_sy.st_print[n];n--);if(!(n<0)){for(a=0;a<voice_tb.length;a++)if(t=voice_tb[a],t.sym&&(n=cur_sy.voices[a].st,cur_sy.st_print[n])){if(t.new_name){l=2;break}t.snm&&(l=1)}if(l){for(a=0;a<voice_tb.length;a++)if(t=voice_tb[a],t.sym&&(n=cur_sy.voices[a].st,cur_sy.st_print[n]&&(t.new_name&&delete t.new_name,o=2==l?t.nm:t.snm))){if(cur_sy.staves[n].flags&CLOSE_BRACE2)for(;!(cur_sy.staves[n].flags&OPEN_BRACE2);)n--;else if(cur_sy.staves[n].flags&CLOSE_BRACE)for(;!(cur_sy.staves[n].flags&OPEN_BRACE);)n--;c[n]?c[n]+="\\n"+o:c[n]=o}if(0!=c.length)for(set_font("voice"),e=.5*-e,n=0;n<c.length;n++)if(c[n]){if(i=c[n].split("\\n"),s=staff_tb[n].y+.5*staff_tb[n].topbar*staff_tb[n].staffscale+9*(i.length-1)-.3*gene.curfont.size,r=n,cur_sy.staves[n].flags&OPEN_BRACE2)for(;!(cur_sy.staves[r].flags&CLOSE_BRACE2);)r++;else if(cur_sy.staves[n].flags&OPEN_BRACE)for(;!(cur_sy.staves[r].flags&CLOSE_BRACE);)r++;for(r!=n&&(s-=.5*(staff_tb[n].y-staff_tb[r].y)),r=0;r<i.length;r++)o=i[r],xy_str(e,s,o,"c"),s-=18}}}}function set_staff(){var e,t,r,n,a,i,o,s,l,c,u,$;for(n=0;n<voice_tb.length;n++)u=voice_tb[n],1!=u.scale&&(u.scale_str='transform="scale('+u.scale.toFixed(2)+')"');for(t=0;t<=nstaff&&!gene.st_print[t];t++);if(a=0,t>nstaff)t--,$=staff_tb[t];else for($=staff_tb[t],e=0;e<YSTEP;e++)c=$.top[e],a<c&&(a=c);if(a+=draw_partempo(t,a),!gene.st_print[t])return a;a*=$.staffscale,i=.5*cfmt.staffsep+$.topbar*$.staffscale,a<i&&(a=i),a<$.ann_top&&(a=$.ann_top),$.y=-a,r=t;var f=cur_sy.staves[r];for(t++;t<=nstaff;t++)if($=staff_tb[t],gene.st_print[t]){if(i=f.sep||cfmt.sysstaffsep,s=f.maxsep||cfmt.maxsysstaffsep,o=0,$.staffscale==staff_tb[r].staffscale){for(e=0;e<YSTEP;e++)c=$.top[e]-staff_tb[r].bot[e],o<c&&(o=c);o*=$.staffscale}else for(e=0;e<YSTEP;e++)c=$.top[e]*$.staffscale-staff_tb[r].bot[e]*staff_tb[r].staffscale,o<c&&(o=c);i+=$.topbar*$.staffscale,o<i&&(o=i),s+=$.topbar*$.staffscale,o>s&&(o=s),a+=o,$.y=-a,r=t,f=cur_sy.staves[r]}for(l=0,e=0;e<YSTEP;e++)c=staff_tb[r].bot[e],l>c&&(l=c);for(l>$.ann_bot&&(l=$.ann_bot),l*=staff_tb[r].staffscale,t=0;t<=nstaff;t++)$=staff_tb[t],o=$.y,1!=$.staffscale&&($.scale_str='transform="translate(0,'+(posy-o).toFixed(2)+") scale("+$.staffscale.toFixed(2)+')"');if(0==l){for(t=nstaff;t>=0&&!gene.st_print[t];t--);if(t<0)return a}return o=-l,i=.5*cfmt.staffsep,o<i&&(o=i),s=.5*cfmt.maxstaffsep,o>s&&(o=s),a+o}function draw_systems(e){function t(){var e,t,r,n,a=0;for(e=0;e<=cur_sy.nstaff;e++)$[e]<0?f[e]=p[e]=0:(t=staff_tb[e].staffscale,r=staff_tb[e].topbar*t,n=staff_tb[e].botbar*t,0==a&&(a=staff_tb[e].y+r),f[e]=staff_tb[e].y+n,p[e]=a-f[e],a=cur_sy.staves[e].flags&STOP_BAR?0:f[e])}function r(e,t,r){var n,a,i,o,s,l=0,c="",u=cur_sy.staves[e].stafflines,$=u.length;if(/[\[|]/.test(u)){if(n=r-t,set_sscale(e),a=n/stv_g.scale,cache&&cache.st_l==u&&cache.st_ws==a)return void xygl(t,staff_tb[e].y,"stdef"+cfmt.fullsvg);for(i=0;i<$;i++,l-=6)if("."!=u[i]){for(o=0;i<$;i++,l-=6,o-=6){switch(u[i]){case".":case"-":continue;case s:c+="m-"+a.toFixed(2)+" "+o+"h"+a.toFixed(2),o=0;continue}void 0!=s&&(c+='"/>\n'),s=u[i],c+='<path class="stroke"',"["==s&&(c+=' stroke-width="1.5"'),c+=' d="m0 '+l+"h"+a.toFixed(2),o=0}c+='"/>\n'}if(l=staff_tb[e].y,!cache&&n==get_lwidth())return cache={st_l:u,st_ws:a},i="stdef"+cfmt.fullsvg,glyphs[i]='<g id="'+i+'">\n'+c+"</g>",void xygl(t,l,i);out_XYAB('<g transform="translate(X, Y)">\n'+c+"</g>\n",t,l)}}var n,a,i,o,s,l,c,u,$=[],f=[],p=[];for(draw_vname(e),i=0;i<=nstaff;i++)$[i]=cur_sy.st_print[i]?0:-1;for(t(),draw_lstaff(0),n=tsfirst;n;n=n.ts_next){if(u&&n.time!=u){for(u=0,i=0;i<=nstaff;i++)cur_sy.st_print[i]||($[i]=-1);t()}switch(n.type){case C.STAVES:if(!(c=n.ts_prev.type==C.BAR?n.ts_prev.x:0)){for(a=n.ts_next;a&&a.time==n.time;a=a.ts_next){switch(a.type){case C.BAR:case C.CLEF:case C.KEY:case C.METER:c=a.x;continue}break}a||(c=realwidth)}for(l=n.sy,i=0;i<=nstaff;i++)o=$[i],o<0?l.st_print[i]&&($[i]=c||n.x-n.wl-2):l.st_print[i]&&l.staves[i].stafflines==cur_sy.staves[i].stafflines||(c?(s=c,u=n.time):(s=n.x-n.wl-2,$[i]=-1),r(i,o,s),l.st_print[i]&&($[i]=s));cur_sy=l,t();continue;case C.BAR:if(i=n.st,n.second||n.invis)break;draw_bar(n,f[i],p[i]);break;case C.STBRK:if(0==cur_sy.voices[n.v].range&&n.xmx>14){for(var d=0,h=0;h<voice_tb.length;h++)cur_sy.voices[h].range>0&&d++;for(a=n.ts_next;a&&a.type==C.STBRK;a=a.ts_next)d--;0==d&&draw_lstaff(n.x)}if(!(a=n.prev))break;if(s=a.x,a.type!=C.BAR&&(s+=a.wr),i=n.st,(o=$[i])>=0){if(o>=s)continue;r(i,o,s)}$[i]=n.x}}for(i=0;i<=nstaff;i++)u&&!cur_sy.st_print[i]||(o=$[i])<0||o>=realwidth||r(i,o,realwidth)}function draw_symbols(e){var t,r,n,a,i={};for(t=e.sym;t;t=t.next){if(t.invis)switch(t.type){case C.KEY:e.key=t;default:continue;case C.NOTE:}switch(r=t.x,set_color(t.color),t.type){case C.NOTE:set_scale(t),t.beam_st&&!t.beam_end&&calculate_beam(i,t)&&draw_beams(i),t.invis||(anno_start(t),draw_note(t,!i.s2),anno_stop(t)),t==i.s2&&(i.s2=null);break;case C.REST:draw_rest(t);break;case C.BAR:break;case C.CLEF:if(a=t.st,t.time>staff_tb[a].clef.time&&(staff_tb[a].clef=t),t.second)break;if(!staff_tb[t.st].topbar)break;set_color(void 0),set_sscale(a),anno_start(t),n=staff_tb[a].y,t.clef_name?xygl(r,n+t.y,t.clef_name):t.clef_small?xygl(r,n+t.y,"s"+t.clef_type+"clef"):xygl(r,n+t.y,t.clef_type+"clef"),t.clef_octave&&(t.clef_octave>0?(n+=t.ymx-10,t.clef_small&&(n-=1)):(n+=t.ymn+2,t.clef_small&&(n+=1)),xygl(r-2,n,"oct")),anno_stop(t);break;case C.METER:if(e.meter=t,t.second||!staff_tb[t.st].topbar)break;if(cfmt.alignbars&&0!=t.st)break;set_color(void 0),set_sscale(t.st),anno_start(t),draw_meter(r,t),anno_stop(t);break;case C.KEY:if(e.key=t,t.second||!staff_tb[t.st].topbar)break;set_color(void 0),set_sscale(t.st),anno_start(t),draw_keysig(e,r,t),anno_stop(t);break;case C.MREST:set_scale(t),r+=32,anno_start(t),xygl(r,staff_tb[t.st].y+12,"mrest"),out_XYAB('<text style="font-family:serif; font-weight:bold; font-size: 15px"\n\tx ="X" y="Y" text-anchor="middle">A</text>\n',r,staff_tb[t.st].y+28,t.nmes),anno_stop(t);break;case C.GRACE:set_scale(t),draw_gracenotes(t);break;case C.SPACE:case C.STBRK:break;case C.CUSTOS:set_scale(t),draw_note(t,0);break;case C.BLOCK:case C.PART:case C.REMARK:case C.STAVES:case C.TEMPO:break;default:error(2,t,"draw_symbols - Cannot draw symbol "+t.type)}}set_scale(e.sym),draw_all_ties(e),set_color(void 0)}function draw_all_sym(){var e,t,r=voice_tb.length
;for(t=0;t<r;t++)e=voice_tb[t],e.sym&&void 0!=e.sym.x&&draw_symbols(e);draw_all_deco(),set_sscale(-1)}function set_tie_dir(e){var t,r,n,a,i,o,s;for(t=e;t;t=t.next)if(t.ti1)if(0==t.multi){for(i=n=0,o=128,r=0;r<=t.nhd;r++)t.notes[r].ti1&&(n++,o<128&&t.notes[r].pit<=o+1&&i++,o=t.notes[r].pit);if(n<=1){for(a=t.stem<0?C.SL_ABOVE:C.SL_BELOW,r=0;r<=t.nhd;r++)if(s=t.notes[r].ti1){(7&s)==C.SL_AUTO&&(t.notes[r].ti1=s&C.SL_DOTTED|a);break}}else if(0!=i){for(o=128,r=0;r<=t.nhd;r++)if(t.notes[r].ti1){if(o<128&&t.notes[r].pit<=o+1){n=r;break}o=t.notes[r].pit}for(a=C.SL_BELOW,r=0;r<=t.nhd;r++)0!=(s=t.notes[r].ti1)&&(n==r&&(a=C.SL_ABOVE),(7&s)==C.SL_AUTO&&(t.notes[r].ti1=s&C.SL_DOTTED|a))}else{if(1&n){for(n=(n-1)/2,a=C.SL_BELOW,r=0;r<=t.nhd;r++)0!=(s=t.notes[r].ti1)&&(0==n&&t.notes[r].pit>=22&&(a=C.SL_ABOVE),(7&s)==C.SL_AUTO&&(t.notes[r].ti1=s&C.SL_DOTTED|a),0==n--&&(a=C.SL_ABOVE));continue}for(n/=2,a=C.SL_BELOW,r=0;r<=t.nhd;r++)0!=(s=t.notes[r].ti1)&&((7&s)==C.SL_AUTO&&(t.notes[r].ti1=s&C.SL_DOTTED|a),0==--n&&(a=C.SL_ABOVE))}}else for(a=t.multi>0?C.SL_ABOVE:C.SL_BELOW,r=0;r<=t.nhd;r++)(7&(s=t.notes[r].ti1))==C.SL_AUTO&&(t.notes[r].ti1=s&C.SL_DOTTED|a)}function set_tie_room(){var e,t,r,n,a,i,o;for(n=0;n<voice_tb.length;n++)if(e=voice_tb[n],(t=e.sym)&&(t=t.next))for(set_tie_dir(t);t;t=t.next)if(t.ti1){if(t.notes[0].pit<20&&(7&t.notes[0].ti1)==C.SL_BELOW);else if(!(t.notes[t.nhd].pit>24&&(7&t.notes[t.nhd].ti1)==C.SL_ABOVE))continue;for(r=t.next;r&&r.type!=C.NOTE;)r=r.next;if(r){if(r.st!=t.st)continue;a=r.x-t.x-10}else a=realwidth-t.x-10;o=a<100?9:a<300?12:16,t.notes[t.nhd].pit>24&&(i=3*(t.notes[t.nhd].pit-18)+o,t.ymx<i&&(t.ymx=i),r&&r.ymx<i&&(r.ymx=i),y_set(t.st,!0,t.x+5,a,i)),t.notes[0].pit<20&&(i=3*(t.notes[0].pit-18)-o,t.ymn>i&&(t.ymn=i),r&&r.ymn>i&&(r.ymn=i),y_set(t.st,!1,t.x+5,a,i))}}function get_bool(e){return!e||!/^(0|n|f)/i.test(e)}function get_font_scale(e){var t=e.split(/\s+/);if(!(t.length<=1)){var r=parseFloat(t[t.length-1]);if(isNaN(r)||t<=0)return void syntax(1,"Bad scale value in %%font");font_scale_tb[t[0]]=r;for(var n in font_tb)if(font_tb.hasOwnProperty(n)){var a=font_tb[n];a.name==t[0]&&(a.swfac=a.size*r)}}}function param_set_font(e,t){var r,n,a,i,o,s,l,c,u,$;if("-"==e[e.length-2]){if((i=e[e.length-1])<"1"||i>"9")return;e="u"+i+"font"}n=cfmt[e],n&&(r=font_tb[n])&&(a=r.name+"."+r.size,r.class&&(a+="."+r.class)),i=t.indexOf("class="),i>=0&&(i+=6,o=t.indexOf(" ",i),$=o>0?t.slice(i,o):t.slice(i),t=t.replace(new RegExp("class="+$),"").trim()),o=t.split(/\s+/),s=o[0],"*"==s&&r?s=r.name:(s=s.replace("Times-Roman","serif"),s=s.replace("Times","serif"),s=s.replace("Helvetica","sans-serif"),s=s.replace("Courier","monospace")),o.length>1?"*"==(c=o[o.length-1])&&r&&(c=r.size):r&&(c=r.size),c&&(l=s+"."+c,$&&(l+="."+$),l!=a&&(r=font_tb[l],r||(u=font_scale_tb[s],u||(u=1.1),r={name:s,size:Number(c),swfac:c*u},font_tb[l]=r),$&&(r.class=$),cfmt[e]=l))}function get_unit(e){var t=parseFloat(e);switch(e.slice(-2)){case"CM":case"cm":t*=CM;break;case"IN":case"in":t*=IN;break;case"PT":case"pt":t*=.75}return t}function set_infoname(e){for(var t=cfmt.infoname.split("\n"),r=e[0],n=0;n<t.length;n++){if(t[n][0]==r)return 1==e.length?t.splice(n,1):t[n]=e,void(cfmt.infoname=t.join("\n"))}cfmt.infoname+="\n"+e}function get_textopt(e){return textopt[e]}function set_pos(e,t){e=e.slice(0,3),"ste"==e&&(e="stm"),set_v_param("pos",e+" "+t)}function set_writefields(e){var t,r,n=e.split(/\s+/);if(get_bool(n[1]))for(r=0;r<n[0].length;r++)t=n[0][r],cfmt.writefields.indexOf(t)<0&&(cfmt.writefields+=t);else for(r=0;r<n[0].length;r++)t=n[0][r],cfmt.writefields.indexOf(t)>=0&&(cfmt.writefields=cfmt.writefields.replace(t,""))}function set_v_param(e,t){if(curvoice)return void set_vp([e+"=",t]);e=[e+"=",t];info.V||(info.V={}),info.V["*"]?Array.prototype.push.apply(info.V["*"],e):info.V["*"]=e}function set_page(){img.chg&&(img.chg=!1,img.lm=cfmt.leftmargin-cfmt.printmargin,img.lm<0&&(img.lm=0),img.rm=cfmt.rightmargin-cfmt.printmargin,img.rm<0&&(img.rm=0),img.width=cfmt.pagewidth-2*cfmt.printmargin,img.width-img.lm-img.rm<100&&(error(0,void 0,"Bad staff width"),img.width=img.lm+img.rm+150),set_posx())}function set_format(e,t,r){var n,a,i,o,s;if(r)fmt_lock[e]=!0;else if(fmt_lock[e])return;if(/.+font(-[\d])?$/.test(e))switch(" box"==t.slice(-4)&&(o=!0,t=t.slice(0,-4)),param_set_font(e,t),e){case"gchordfont":cfmt.gchordbox=o;break;case"measurefont":cfmt.measurebox=o;break;case"partsfont":cfmt.partsbox=o}else switch(e){case"aligncomposer":case"barsperstaff":case"infoline":case"measurefirst":case"measurenb":case"rbmax":case"rbmin":case"shiftunison":if(i=parseInt(t),isNaN(i)){syntax(1,"Bad integer value");break}cfmt[e]=i;break;case"microscale":if(n=parseInt(t),isNaN(n)||n<4||n>256||n%1){syntax(1,errs.bad_val,"%%"+e);break}set_v_param("uscale",n);break;case"bgcolor":case"dblrepbar":case"titleformat":cfmt[e]=t;break;case"breaklimit":case"lineskipfac":case"maxshrink":case"pagescale":case"parskipfac":case"scale":case"slurheight":case"stemheight":case"stretchlast":if(n=parseFloat(t),isNaN(n)){syntax(1,errs.bad_val,"%%"+e);break}switch(e){case"scale":n/=.75;case"pagescale":e="scale",img.chg=!0}cfmt[e]=n;break;case"bstemdown":case"breakoneoln":case"cancelkey":case"contbarnb":case"custos":case"decoerr":case"dynalign":case"flatbeams":case"gchordbox":case"graceslurs":case"graceword":case"hyphencont":case"keywarn":case"linewarn":case"measurebox":case"partsbox":case"rbdbstop":case"singleline":case"squarebreve":case"straightflags":case"stretchstaff":case"timewarn":case"titlecaps":case"titleleft":cfmt[e]=get_bool(t);break;case"chordnames":for(i=t.split(","),cfmt.chordnames={},s=0;s<i.length;s++)cfmt.chordnames["CDEFGAB"[s]]=i[s];break;case"composerspace":case"indent":case"infospace":case"maxstaffsep":case"maxsysstaffsep":case"musicspace":case"partsspace":case"staffsep":case"subtitlespace":case"sysstaffsep":case"textspace":case"titlespace":case"topspace":case"vocalspace":case"wordsspace":n=get_unit(t),isNaN(n)?syntax(1,errs.bad_val,"%%"+e):cfmt[e]=n;break;case"print-leftmargin":syntax(0,"$1 is deprecated - use %%printmargin instead","%%"+e),e="printmargin";case"printmargin":case"leftmargin":case"pagewidth":case"rightmargin":if(n=get_unit(t),isNaN(n)){syntax(1,errs.bad_val,"%%"+e);break}cfmt[e]=n,img.chg=!0;break;case"concert-score":cfmt.sound="concert";break;case"writefields":set_writefields(t);break;case"dynamic":case"gchord":case"gstemdir":case"ornament":case"stemdir":case"vocal":case"volume":set_pos(e,t);break;case"font":get_font_scale(t);break;case"fullsvg":if(0!=parse.state){syntax(1,"Cannot have %%fullsvg inside a tune");break}cfmt[e]=t;break;case"gracespace":for(i=t.split(/\s+/),s=0;s<3;s++)if(isNaN(Number(i[s]))){syntax(1,errs.bad_val,"%%gracespace");break}for(s=0;s<3;s++)cfmt[e]=Number(i[s]);break;case"tuplets":cfmt[e]=t.split(/\s+/),i=cfmt[e][3],i&&posval[i]&&(cfmt[e][3]=posval[i]);break;case"infoname":set_infoname(t);break;case"notespacingfactor":if(n=parseFloat(t),isNaN(n)||n<1||n>2){syntax(1,errs.bad_val,"%%"+e);break}for(s=5,a=space_tb[s];--s>=0;)a/=n,space_tb[s]=a;for(s=5,a=space_tb[s];++s<space_tb.length;)a*=n,space_tb[s]=a;break;case"play":cfmt.sound="play";break;case"pos":e=t.split(/\s+/),set_pos(e[0],e[1]);break;case"sounding-score":cfmt.sound="sounding";break;case"staffwidth":if(i=get_unit(t),isNaN(i)){syntax(1,errs.bad_val,"%%"+e);break}if(i<100){syntax(1,"%%staffwidth too small");break}if((i=cfmt.pagewidth-i-cfmt.leftmargin)<2){syntax(1,"%%staffwidth too big");break}cfmt.rightmargin=i,img.chg=!0;break;case"textoption":cfmt[e]=get_textopt(t);break;case"titletrim":i=Number(t),isNaN(i)?cfmt[e]=get_bool(t):cfmt[e]=i;break;case"combinevoices":syntax(1,"%%combinevoices is deprecated - use %%voicecombine instead");break;case"voicemap":set_v_param("map",t);break;case"voicescale":set_v_param("scale",t);break;default:0==parse.state&&(cfmt[e]=t)}}function font_init(){param_set_font("annotationfont","sans-serif 12"),param_set_font("composerfont","serifItalic 14"),param_set_font("footerfont","serif 16"),param_set_font("gchordfont","sans-serif 12"),param_set_font("headerfont","serif 16"),param_set_font("historyfont","serif 16"),param_set_font("infofont","serifItalic 14"),param_set_font("measurefont","serifItalic 14"),param_set_font("partsfont","serif 15"),param_set_font("repeatfont","serif 13"),param_set_font("subtitlefont","serif 16"),param_set_font("tempofont","serifBold 15"),param_set_font("textfont","serif 16"),param_set_font("titlefont","serif 20"),param_set_font("vocalfont","serifBold 13"),param_set_font("voicefont","serifBold 13"),param_set_font("wordsfont","serif 16")}function style_font(e){var t=e.split("."),r=t[1],n=e.indexOf("Italic"),a=100,i=e.indexOf("Oblique"),o=e.indexOf("Bold");return e=t[0],t="",o>0&&(t+="font-weight:bold; ",a=o),(n>0||i>0)&&(n>0&&(t+="font-style:italic; ",n<a&&(a=n)),i>0&&(t+="font-style:oblique; ",i<a&&(a=i))),100!=a&&("-"==e[a-1]&&a--,e=e.slice(0,a)),"font-family:"+e+"; "+t+"font-size:"+r+"px"}function font_class(e){return e.class?"f"+e.fid+cfmt.fullsvg+" "+e.class:"f"+e.fid+cfmt.fullsvg}function style_add_font(e){font_style+="\n.f"+e.fid+cfmt.fullsvg+" {"+style_font(e.name+"."+e.size)+"}"}function use_font(e){defined_font[e.fid]||(defined_font[e.fid]=!0,style_add_font(e))}function get_font(e){e+="font";var t=cfmt[e],r=font_tb[t];return r||(syntax(1,"Unknown font $1",e),r=gene.curfont),r.fid||(r.fid=fid++),use_font(r),r}function cnv_escape(e){for(var t,r,n,a,i="",o=0;;){if((n=e.indexOf("\\",o))<0)break;if(i+=e.slice(o,n),!(t=e[++n]))return i+"\\";switch(t){case"0":case"2":if("0"!=e[n+1])break;if(r=oct_acc[e[n+2]]){i+=r,o=n+3;continue}break;case"u":if(o=Number("0x"+e.slice(n+1,n+5)),isNaN(o)||o<32){i+=e[++n]+"",o=n+1;continue}if(a=[o],o>=55296&&o<=57343){if(o=Number("0x"+e.slice(n+7,n+11)),isNaN(o))break;a.push(o),o=n+11}else o=n+5;i+=String.fromCharCode.apply(null,a);continue;case"t":i+=" ",o=n+1;continue;default:if(r=abc_utf[e.slice(n,n+2)]){i+=r,o=n+2;continue}switch(t){case"`":i+=e[++n]+"",o=n+1;continue;case"'":i+=e[++n]+"",o=n+1;continue;case"^":i+=e[++n]+"",o=n+1;continue;case"~":i+=e[++n]+"",o=n+1;continue;case"=":i+=e[++n]+"",o=n+1;continue;case"_":i+=e[++n]+"",o=n+1;continue;case".":i+=e[++n]+"",o=n+1;continue;case'"':i+=e[++n]+"",o=n+1;continue;case"o":i+=e[++n]+"",o=n+1;continue;case"H":i+=e[++n]+"",o=n+1;continue;case"v":i+=e[++n]+"",o=n+1;continue;case"c":i+=e[++n]+"",o=n+1;continue;case";":i+=e[++n]+"",o=n+1;continue}}i+="\\"+t,o=n+1}return i+e.slice(o)}function do_include(e){var t,r;return user.read_file?include>2?void syntax(1,"Too many include levels"):(include++,(t=user.read_file(e))?(r=clone(parse),tosvg(e,t),parse=r,void include--):void syntax(1,"Cannot read file '$1'",e)):void syntax(1,"No read_file support")}function tosvg(e,t,r,n){function a(e,t){return e.indexOf("%")>=0&&(e=e.replace(/([^\\])%.*/,"$1").replace(/\\%/g,"%")),e=e.replace(/\s+$/,""),t&&e.indexOf("\\")>=0?cnv_escape(e):e}function i(){generate(),info.W&&put_words(info.W),put_history(),blk_flush(),parse.state=0,cfmt=y,info=v,char_tb=b,glovar=x,maps=w,mac=A,maci=k,init_tune(),img.chg=!0,set_page()}var o,r,s,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x,w,A,k,E,C="\n";for(abc2svg.modules&&(abc2svg.modules.hooks.length||abc2svg.modules.g_hooks.length)&&set_hooks(),parse.file=t,parse.fname=e,void 0==r&&(r=0),n||(n=t.length);r<n;r=parse.eol+1){for(s=t.indexOf("\n",r),(s<0||s>n)&&(s=n),parse.eol=s;;){switch(s--,t[s]){case" ":case"\t":continue}break}if(++s!=r){if(parse.istart=parse.bol=r,parse.iend=s,parse.line.index=0,$=t[r],f=t[r+1],"%"==$){if(parse.prefix.indexOf(f)<0)continue;"a"==t[r+2]&&"b"==t[r+3]&&"c"==t[r+4]&&" "==t[r+5]?(r+=6,$=t[r],f=t[r+1]):E=!0}else"I"==$&&":"==f&&(E=!0);if(E){for(E=!1,r+=2;;){switch(t[r]){case" ":case"\t":r++;continue}break}if(!(h=t.slice(r,s))||"%"==h[0])continue;switch(_=h.split(/\s+/,2),_[0]||_.shift(),_[0]){case"abcm2ps":case"ss-pref":parse.prefix=_[1];continue;case"abc-include":c=_[1].match(/.*\.(.*)/),c&&"abc"==c[1]&&do_include(_[1]);continue}if("begin"==_[0].slice(0,5)){if(g=_[0].substr(5),l="\n"+$+f+"end"+g,(o=t.indexOf(l,s))<0){syntax(1,"No $1 after %%$2",l.slice(1),_[0]),parse.eol=n;continue}do_begin_end(g,_[1],t.slice(s+1,o).replace(new RegExp("^"+$+f,"gm"),"")),parse.eol=t.indexOf("\n",o+6),parse.eol<0&&(parse.eol=n);continue}switch(_[0]){case"select":if(0!=parse.state){syntax(1,"%%select ignored");continue}if(u=a(h.slice(7),!1),'"'==u[0]&&(u=u.slice(1,-1)),!u){delete parse.select;continue}u=u.replace(/\(/g,"\\("),u=u.replace(/\)/g,"\\)"),parse.select=new RegExp(u,"m");continue;case"tune":syntax(1,"%%tune not treated yet");continue;case"voice":if(0!=parse.state){syntax(1,"%%voice ignored");continue}if(!(u=a(h.slice(6),!1))){parse.cur_tune_opts?parse.cur_tune_opts.voice_opts=null:parse.voice_opts=null;continue}if("end"==u)continue;for(parse.cur_tune_opts?(parse.cur_tune_opts.voice_opts||(parse.cur_tune_opts.voice_opts={}),d=parse.cur_tune_opts.voice_opts):(parse.voice_opts||(parse.voice_opts={}),d=parse.voice_opts),d[u]=[];;){if(r=++s,"%"!=t[r])break;if(s=t.indexOf("\n",s),t[r+1]==f){switch(r+=2,h=s<0?t.slice(r):t.slice(r,s),_=h.match(/\S+/),_[0]){default:d[u].push(a(h,!0));continue;case"score":case"staves":case"tune":case"voice":r-=2}break}}parse.eol=r-1;continue}do_pscom(a(h,!0))}else if(":"==f&&/[A-Za-z+]/.test($)){for(r+=2;;){switch(t[r]){case" ":case"\t":r++;continue}break}if(h=a(t.slice(r,s),!0),"+"==$){if(!p){syntax(1,"+: without previous info field");continue}C=" ",$=p}switch($){case"X":if(0!=parse.state){syntax(1,errs.ignored,$);continue}if(parse.select&&!function(){var e,a,i=t.indexOf("K:",r);return!(i<0)&&(i=t.indexOf("\n",i),!!parse.select.test(t.slice(parse.bol,i))||(e=/\n\w*\n/,e.lastIndex=i,a=e.exec(t),s=a?e.lastIndex:n,!1))}()){s=t.indexOf("\nX:",parse.eol),s<0&&(s=n),parse.eol=s;continue}y=clone(cfmt),cfmt.pos=clone(cfmt.pos),v=clone(info,1),b=clone(char_tb),x=clone(glovar),w=clone(maps,1),A=clone(mac),k=new Int8Array(maci),info.X=h,parse.state=1;continue;case"T":switch(parse.state){case 0:continue;case 1:void 0==info.T?info.T=h:info.T+="\n"+h;continue}m=new_block("title"),m.text=h;continue;case"K":switch(parse.state){case 0:continue;case 1:info.K=h}do_info($,h);continue;case"W":if(0==parse.state||cfmt.writefields.indexOf($)<0)break;void 0==info.W?info.W=h:info.W+=C+h;break;case"m":if(parse.state>=2){syntax(1,errs.ignored,$);continue}if((!cfmt.sound||"play"!=cfmt.sound)&&cfmt.writefields.indexOf($)<0)break;if(!(_=h.match(/(.*?)[= ]+(.*)/))||!_[2]){syntax(1,errs.bad_val,"m:");continue}mac[_[1]]=_[2],maci[_[1].charCodeAt(0)]=1;break;case"s":if(3!=parse.state||cfmt.writefields.indexOf($)<0)break;get_sym(h," "==C);break;case"w":if(3!=parse.state||cfmt.writefields.indexOf($)<0)break;if(get_lyrics(h," "==C),"\\"==h.slice(-1)){C=" ",p=$;continue}break;case"|":if(parse.state<2)continue;parse.line.buffer=a(t.slice(r,s),!0),parse_music_line();continue;default:if("ABCDFGHOSZ".indexOf($)>=0){if(parse.state>=2){syntax(1,errs.ignored,$);continue}info[$]?info[$]+=C+h:info[$]=h;break}do_info($,h);continue}C="\n",p=$}else{if(p=void 0,parse.state<2)continue;parse.line.buffer=a(t.slice(r,s),!0),parse_music_line()}}else 1==parse.state?(parse.istart=r,syntax(1,"Empty line in tune header - ignored")):parse.state>=2&&(i(),parse.select&&(s=t.indexOf("\nX:",parse.eol),s<0&&(s=n),parse.eol=s))}include||(parse.state>=2&&i(),parse.state=0)}function set_head_shift(e){var t,r,n,a,i,o,s=dx_tb[e.head],l=e.stem,c=e.nhd;if(0!=c){o=.78*s,e.grace&&(o*=.5),l>=0?(r=1,n=c+1,i=e.notes[0].pit):(o=-o,r=c-1,n=-1,i=e.notes[c].pit);var u=!1,$=0;for(t=r;t!=n;t+=l){if(a=e.notes[t].pit-i,i=e.notes[t].pit,0==a){if(u){var f=e.notes[t].shhd=e.notes[t-l].shhd+o;$<f&&($=f);continue}if(t+l!=n&&i+l==e.notes[t+l].pit){e.notes[t].shhd=-o,$<-o&&($=-o);continue}}a<0&&(a=-a),a>3||a>=2&&e.head!=C.SQUARE?u=!1:(u=!u)&&(e.notes[t].shhd=o,$<o&&($=o))}e.xmx=$}}function acc_shift(e,t){var r,n,a,i,o,s,l,c=e.length;for(r=c-1;--r>=0;)if((a=e[r].shhd)&&!(a>0))for(a=t-a,o=e[r].pit,n=c;--n>=0;)if(e[n].acc){if((s=e[n].pit)<o-3)break;s>o+3||e[n].shac<a&&(e[n].shac=a)}for(r=c;--r>=0;)if(l=e[r].acc){for(a=e[r].shac,a||(a=e[r].shhd,a=a<0?t-a:t),o=e[r].pit,n=c;--n>r;)e[n].acc&&((s=e[n].pit)>=o+4&&(s>o+4||l<0||e[n].acc<0)||a>e[n].shac-6&&(i=e[n].shac+7)>a&&(a=i));e[r].shac=a}}function set_acc_shft(){var e,t,r,n,a,r,i,o;for(e=tsfirst;e;)if(e.type!=C.NOTE||e.invis)e=e.ts_next;else{for(r=e.st,i=e.time,a=!1,t=e;t&&(t.time==i&&t.type==C.NOTE&&t.st==r);t=t.ts_next)if(!a)for(n=0;n<=t.nhd;n++)if(t.notes[n].acc){a=!0;break}if(a){for(o=dx_tb[e.head],r={notes:[]};e!=t;e=e.ts_next)r.notes=r.notes.concat(e.notes);sort_pitch(r),acc_shift(r.notes,o)}else e=t}}function lkvsym(e,t){e.next=t,e.prev=t.prev,e.prev?e.prev.next=e:e.p_v.sym=e,t.prev=e}function lktsym(e,t){t?(e.ts_next=t,e.ts_prev=t.ts_prev,e.ts_prev&&(e.ts_prev.ts_next=e),t.ts_prev=e):e.ts_next=e.ts_prev=null}function unlksym(e){e.next&&(e.next.prev=e.prev),e.prev?e.prev.next=e.next:e.p_v.sym=e.next,e.ts_next&&(e.seqst&&!e.ts_next.seqst&&(e.ts_next.seqst=!0,e.ts_next.shrink=e.shrink,e.ts_next.space=e.space),e.ts_next.ts_prev=e.ts_prev),e.ts_prev&&(e.ts_prev.ts_next=e.ts_next),tsfirst==e&&(tsfirst=e.ts_next),tsnext==e&&(tsnext=e.ts_next)}function insert_clef(e,t,r){var n,a=e.p_v,i=e.st;for(e.type==C.BAR&&e.prev&&e.prev.type==C.BAR&&(e=e.prev),a.last_sym=e.prev,a.last_sym||(a.sym=null),a.time=e.time,n=sym_add(a,C.CLEF),n.next=e,e.prev=n,n.clef_type=t,n.clef_line=r,n.st=i,n.clef_small=!0,delete n.second,n.notes=[],n.notes[0]={pit:e.notes[0].pit},n.nhd=0;!e.seqst;)e=e.ts_prev;return lktsym(n,e),n.ts_prev.type!=C.CLEF&&(n.seqst=!0),n}function set_float(){var e,t,r,n,a,i,o,s;for(n=0;n<voice_tb.length;n++)for(e=voice_tb[n],r=!1,t=e.st,a=e.sym;a;a=a.next){if(!a.floating){for(;a&&!a.floating;)a=a.next;if(!a)break;r=!1}if(a.dur)if(a.notes[0].pit>=19)r=!1;else if(a.notes[a.nhd].pit<=12)r=!0,a.st++;else{for(o=127,i=a.ts_prev;i&&(i.st==t&&i.v!=a.v);i=i.ts_prev)i.type==C.NOTE&&i.notes[0].pit<o&&(o=i.notes[0].pit);if(127!=o)if(a.notes[a.nhd].pit>o-3)r=!1;else{for(s=-127,i=a.ts_next;i&&(i.st==t+1&&i.v!=a.v);i=i.ts_next)i.type==C.NOTE&&i.notes[i.nhd].pit>s&&(s=i.notes[i.nhd].pit);if(-127!=s)if(a.notes[0].pit<s+3)r=!0,a.st++;else{if(o-=a.notes[a.nhd].pit,s=a.notes[0].pit-s,r){if(o<s-3){r=!1;continue}}else{if(o<s+3)continue;r=!0}a.st++}else r&&a.st++}else r&&a.st++}else r&&a.st++}}function set_graceoffs(e){var t,r,n,a,i=cfmt.gracespace[0],o=cfmt.gracespace[1],s=cfmt.gracespace[2],l=e.extra;for(e.prev&&e.prev.type==C.BAR&&(i-=3),a=i,l.beam_st=!0;;l=l.next){for(set_head_shift(l),acc_shift(l.notes,7),n=0,r=l.nhd;r>=0;r--)l.notes[r].shac>n&&(n=l.notes[r].shac);if(a+=n,l.x=a,l.nflags<=0&&(l.beam_st=!0,l.beam_end=!0),!(t=l.next)){l.beam_end=!0;break}t.nflags<=0&&(l.beam_end=!0),l.beam_end&&(t.beam_st=!0,a+=o/4),l.nflags<=0&&(a+=o/4),l.y>t.y+8&&(a-=1.5),a+=o}return t=e.next,t&&t.type==C.NOTE&&(l.y>=3*(t.notes[t.nhd].pit-18)?s-=1:l.beam_st&&l.y<3*(t.notes[t.nhd].pit-18)-4&&(s+=2)),a+=s}function gchord_width(e,t,r){var n,a,i,o,s,l=0,c=0,u=0,$=0;for(s=0;s<e.a_gch.length;s++)switch(a=e.a_gch[s],a.type){default:o=-a.x,o>l&&(l=o),i=a.w+2-o,i>c&&(c=i);break;case"<":i=a.w+t,i>u&&(u=i);break;case">":i=a.w+e.wr,i>$&&($=i)}if(n=e.prev){if(n.a_gch)for(n=e.ts_prev;;n=n.ts_prev){if(n==e.prev){r<l&&(r=l);break}n.seqst&&(l-=n.shrink)}0!=u&&r<u&&(r=u)}if(n=e.next){if(n.a_gch)for(n=e.ts_next;;n=n.ts_next){if(n==e.next){e.wr<c&&(e.wr=c);break}n.seqst&&(c-=8)}0!=$&&e.wr<$&&(e.wr=u)}return r}function set_width(e){var t,r,n,a,i,o,s,l;switch(e.type){case C.NOTE:case C.REST:for(e.wr=o=hw_tb[e.head],e.xmx>0&&(e.wr+=e.xmx+4),t=e.prev;t&&0==w_tb[t.type];t=t.prev);if(t)switch(t.type){case C.BAR:case C.CLEF:case C.KEY:case C.METER:o+=3}for(n=0;n<=e.nhd;n++)if(a=e.notes[n].shhd,a<0&&o<5-a&&(o=5-a),e.notes[n].acc){var c=e.notes[n].shac+(e.notes[n].micro?5.5:3.5);o<c&&(o=c)}if(t)switch(t.type){case C.BAR:case C.CLEF:case C.KEY:case C.METER:o-=3}if(e.a_dd&&(o+=deco_width(e)),e.beam_st&&e.beam_end&&e.stem>0&&e.nflags>0&&e.wr<e.xmx+9&&(e.wr=e.xmx+9),e.dots>0){if(void 0==e.wl)switch(e.head){case C.SQUARE:e.xmx+=4;break;case C.OVALBARS:case C.OVAL:e.xmx+=2;break;case C.EMPTY:e.xmx+=1}e.wr<e.xmx+8&&(e.wr=e.xmx+8),e.dots>=2&&(e.wr+=3.5*(e.dots-1))}if(e.trem2&&e.beam_end&&o<20&&(o=20),s=o,t)switch(t.type){case C.NOTE:t.stem>0&&e.stem<0&&s<7&&(s=7),(e.y>27&&t.y>27||e.y<-3&&t.y<-3)&&s<6&&(s=6),t.ti1&&s<14&&(s=14);break;case C.CLEF:if(t.second||t.clef_small)break;s+=8;break;case C.KEY:s+=4}return e.a_gch&&(s=gchord_width(e,o,s)),e.a_ly&&(s=ly_width(e,s)),void(t&&t.type==C.GRACE?e.wl=o-4.5:e.wl=s);case C.SPACE:return a=e.width/2,e.wr=a,e.a_gch&&(a=gchord_width(e,a,a)),e.a_dd&&(a+=deco_width(e)),void(e.wl=a);case C.BAR:if(e.norepbra)break;if(e.invis)e.wl=e.wr=0;else{var u=e.bar_type;switch(u){case"|":i=7;break;case"|:":case":|":i=15;break;case"::":i=26;break;default:if(!u)break;for(i=4+3*u.length,r=0;r<u.length;r++)switch(u[r]){case"[":case"]":i+=3;break;case":":i+=2}}for(e.wl=i,e.next&&e.next.type!=C.METER?e.wr=7:e.wr=5,t=e.prev;t;t=t.prev)if(0!=w_tb[t.type]){t.type==C.GRACE&&(e.wl-=8);break}}return e.a_dd&&(e.wl+=deco_width(e)),void(e.text&&e.text.length<4&&e.next&&e.next.a_gch&&(set_font("repeat"),e.wr+=strwh(e.text)[0]+2));case C.CLEF:return e.invis?void(e.wl=e.wr=1):void(e.wl=e.wr=e.clef_small?8:12);case C.KEY:var $,f,p;if(e.wl=3,p=4,e.k_a_acc){if($=f=e.k_a_acc.length,f)var d=e.k_a_acc[0].acc;for(r=1;r<f;r++)l=e.k_a_acc[r],l.pit>e.k_a_acc[r-1].pit+6||l.pit<e.k_a_acc[r-1].pit-6?$--:l.acc!=d&&(p+=3),d=l.acc}else $=e.k_sf,f=e.k_old_sf&&(cfmt.cancelkey||0==$)?e.k_old_sf:0,$*f>=0?($<0&&($=-$),f<0&&(f=-f),f>$&&($=f)):($-=f,$<0&&($=-$),p+=3);return void(e.wr=5.5*$+p);case C.METER:for(s=0,e.x_meter=[],r=0;r<e.a_meter.length;r++){var h=e.a_meter[r];if("C"==h.top[0])e.x_meter[r]=s+6,s+=12;else{for(i=0,h=!h.bot||h.top.length>h.bot.length?h.top:h.bot,n=0;n<h.length;n++)switch(h[n]){case"(":s+=4;case")":case"1":i+=4;break;default:i+=12}e.x_meter[r]=s+i/2,s+=i}}return e.wl=0,void(e.wr=s+6);case C.MREST:return e.wl=6,void(e.wr=66);case C.GRACE:return e.wl=set_graceoffs(e),e.wr=0,void(e.a_ly&&ly_width(e,s));case C.STBRK:return e.wl=e.xmx,void(e.next&&e.next.type==C.CLEF?(e.wr=2,delete e.next.clef_small):e.wr=8);case C.CUSTOS:return void(e.wl=e.wr=4);case C.BLOCK:case C.PART:case C.REMARK:case C.STAVES:case C.TEMPO:break;default:error(2,e,"set_width - Cannot set width for symbol $1",e.type)}e.wl=e.wr=0}function time2space(e,t){var r,n,a;return smallest_duration>=C.BLEN/2?smallest_duration>=C.BLEN?t/=4:t/=2:!e.next&&t>=C.BLEN&&(t/=2),r=t>=C.BLEN/4?t<C.BLEN/2?5:t<C.BLEN?6:t<2*C.BLEN?7:t<4*C.BLEN?8:9:t>=C.BLEN/8?4:t>=C.BLEN/16?3:t>=C.BLEN/32?2:t>=C.BLEN/64?1:0,n=t-(C.BLEN/16/8<<r),a=space_tb[r],0!=n&&(n<0?a=space_tb[0]*t/(C.BLEN/16/8):(r>=9&&(r=8),a+=(space_tb[r+1]-space_tb[r])*n/t)),a}function set_space(e){var t,r,n=e.ts_prev.time,a=e.time-n;if(0==a){switch(e.type){case C.MREST:return e.wl}return 0}if(e.ts_prev.type==C.MREST)return 71;for(r=time2space(e,a);!e.dur;){switch(e.type){case C.BAR:return.9*r-7;case C.CLEF:return r-e.wl-e.wr;case C.BLOCK:case C.PART:case C.REMARK:case C.STAVES:case C.TEMPO:if(!(e=e.ts_next))return r;continue}break}if(e.beam_st||(r*=.9),e.type==C.NOTE&&e.nflags>=-1&&e.stem>0){var i=!0;for(t=e.ts_prev;t&&t.time==n;t=t.ts_prev)if(t.type==C.NOTE&&(t.nflags<-1||t.stem>0)){i=!1;break}if(i){for(t=e.ts_next;t&&t.time==e.time;t=t.ts_next)if(t.type==C.NOTE&&(t.nflags<-1||t.stem<0)){i=!1;break}i&&(r*=.9)}}return r}function set_sp_tup(e,t){var r=e.time,n=t.time-r,a=time2space(e,n/e.tq0)*e.tq0;for(e=e.ts_next;;){if(e.seqst&&(e.space=(e.time-r)/n*a),r=e.time,e==t)break;e=e.ts_next}}function add_end_bar(e){return{type:C.BAR,bar_type:"|",fname:e.fname,istart:e.istart,iend:e.iend,v:e.v,p_v:e.p_v,st:e.st,dur:0,seqst:!0,invis:!0,time:e.time+e.dur,nhd:0,notes:[{pit:e.notes[0].pit}],wl:0,wr:0}}function set_allsymwidth(e){for(var t,r,n,a=tsfirst,i=0,o=[],s=0,l=0;;){var c=i,u=a;do{set_width(a),t=(o[a.st]||0)+a.wl,t>c&&(c=t),a.tp0?1==++l&&(n=a,s|=1):a.te0&&0==--l&&(s=4),a=a.ts_next}while(a!=e&&!a.seqst);if(u.shrink=c-i,14&s||(u.ts_prev?u.space=set_space(u):u.space=0),s&&(8&s&&(set_sp_tup(r,u),s&=-9),1&s&&(r=n,s++),4&s&&(s+=4)),0==u.shrink&&0==u.space&&u.type==C.CLEF&&(delete u.seqst,u.time=u.ts_prev.time),a==e)break;i=c,a=u;do{(!o[a.st]||o[a.st]<i+a.wr)&&(o[a.st]=i+a.wr),a=a.ts_next}while(!a.seqst)}}function to_rest(e){e.type=C.REST,delete e.in_tuplet,delete e.sl1,delete e.sl2,delete e.a_dd,delete e.a_gch,e.slur_start=e.slur_end=0}function set_repeat(e){var t,r,n,a,i,o=e.repeat_n,s=e.repeat_k,l=e.st,c=e.v;if(e.repeat_n=0,o<0){for(o=-o,n=o,r=e.prev;r;r=r.prev)if(r.dur){if(--n<=0)break}else if(r.type==C.BAR)return void error(1,r,"Bar in repeat sequence");if(!r)return void error(1,e,errs.not_enough_n);for(i=e.time-r.time,n=s*o,t=e;t;t=t.next)if(t.dur){if(--n<=0)break}else if(t.type==C.BAR)return void error(1,t,"Bar in repeat sequence");if(!t||!t.next)return void error(1,e,errs.not_enough_n);for(t=e.prev;t!=r;t=t.prev)if(t.type==C.NOTE){t.beam_end=!0;break}for(a=s;--a>=0;){for(n=o,e.dur&&n--,t=e.ts_next;n>0;)t.st==l&&(unlksym(t),t.v==c&&t.dur&&n--),t=t.ts_next;for(to_rest(e),e.dur=e.notes[0].dur=i,e.rep_nb=-1,e.beam_st=!0,set_width(e),e.seqst&&(e.space=set_space(e)),e.head=C.SQUARE,e=t;e&&(e.st!=l||e.v!=c||!e.dur);e=e.ts_next);}}else{for(n=o,t=e.prev.prev;t&&(t.type!=C.BAR&&t.time!=tsfirst.time||!(--n<=0));t=t.prev);if(!t)return void error(1,e,errs.not_enough_m);for(i=e.time-t.time,n=1==o?s:o,t=e;t&&!(t.type==C.BAR&&--n<=0);t=t.next);if(!t)return void error(1,e,errs.not_enough_m);if(n=s,2==o&&n>1){if(!(t=t.next))return void error(1,e,errs.not_enough_m);t.repeat_n=o,t.repeat_k=--n}if(i/=o,2==o){for(r=e,t=e.ts_next;;t=t.ts_next)if(t.st==l){if(t.v==c&&t.type==C.BAR)break;unlksym(t)}for(to_rest(r),r.dur=r.notes[0].dur=i,r.invis=!0,r.seqst&&(r.space=set_space(r)),t.bar_mrep=2,t.seqst&&(t.space=set_space(t)),r=t.next,t=r.ts_next;;t=t.ts_next)if(t.st==l){if(t.v==c&&t.type==C.BAR)break;unlksym(t)}return to_rest(r),r.dur=r.notes[0].dur=i,r.invis=!0,set_width(r),r.seqst&&(r.space=set_space(r)),void(t.seqst&&(t.space=set_space(t)))}for(r=e,a=s;--a>=0;){for(t=r.ts_next;;t=t.ts_next)if(t.st==l){if(t.v==c&&t.type==C.BAR)break;unlksym(t)}if(to_rest(r),r.dur=r.notes[0].dur=i,r.beam_st=!0,r.seqst&&(r.space=set_space(r)),t.seqst&&(t.space=set_space(t)),1==s){r.rep_nb=1;break}r.rep_nb=s-a+1,r=t.next}}}function custos_add(e){for(var t,r,n,a=e;;){if(a.type==C.NOTE)break;if(!(a=a.next))return}for(t=e.p_v,t.last_sym=e.prev,t.time=e.time,r=sym_add(t,C.CUSTOS),r.next=e,e.prev=r,lktsym(r,e),r.seqst=!0,r.shrink=e.shrink,r.shrink<12&&(r.shrink=12),r.space=a.space,r.wl=0,r.wr=4,r.nhd=a.nhd,r.notes=[],n=0;n<e.notes.length;n++)r.notes[n]={pit:a.notes[n].pit,shhd:0,dur:C.BLEN/4};r.stemless=!0}function set_nl(e){function t(e){cfmt.custos&&1==voice_tb.length&&custos_add(e);for(var t=e.ts_next;t;t=t.ts_next)if(t.seqst){e.nl=!0;break}}function r(e){if(!e.next)return t(e),e;for(e=e.ts_next;e;e=e.ts_next)if(e.seqst){t(e);break}return e}var n;if(e.eoln&&!cfmt.keywarn&&!cfmt.timewarn)return r(e);switch(e.type){case C.CLEF:case C.BAR:case C.STAVES:break;case C.KEY:if(cfmt.keywarn&&!e.k_none)break;return r(e);case C.METER:if(cfmt.timewarn)break;return r(e);case C.GRACE:if(!(e=e.next))return e;default:return r(e)}for(;e;e=e.ts_prev)if(e.seqst){switch(e.type){case C.KEY:case C.CLEF:case C.METER:continue}break}for(n=0;;e=e.ts_next){if(!e)return e;if(e.seqst){if(n<0)break;switch(e.type){case C.STAVES:if(e.ts_prev&&e.ts_prev.type==C.BAR)break;for(;e.ts_next&&(0==w_tb[e.ts_next.type]||e.ts_next.type==C.CLEF);)e=e.ts_next;if(!e.ts_next||e.ts_next.type!=C.BAR)continue;e=e.ts_next;case C.BAR:if(n)break;n=1;continue;case C.STBRK:e.stbrk_forced?n=-1:unlksym(e);continue;case C.METER:if(!cfmt.timewarn)break;continue;case C.CLEF:if(n)break;continue;case C.KEY:if(!cfmt.keywarn||e.k_none)break;continue;default:if(!n||e.prev&&e.prev.type==C.GRACE)continue}break}}return t(e),e}function get_ck_width(){var e=voice_tb[0];return set_width(e.clef),set_width(e.key),set_width(e.meter),[e.clef.wl+e.clef.wr+e.key.wl+e.key.wr,e.meter.wl+e.meter.wr]}function get_width(e,t){var r,n,a=0,i=1-cfmt.maxshrink;do{if(e.seqst&&(r=e.shrink,(n=e.space)<r?a+=r:a+=r*cfmt.maxshrink+n*i,e.x=a),e==t)break;e=e.ts_next}while(e);return a}function set_lines(e,t,r,n){for(var a,i,o,s,l,c,u,$,f,p;t&&!t.eoln;t=t.ts_next);for($=get_width(e,t)+n;;){if((f=Math.ceil($/r))<=1)return t&&(t=set_nl(t)),t;for(i=a=e,l=e.x-e.shrink-n,u=l+r,c=l+$/f,l+=$/f*cfmt.breaklimit,e=e.ts_next;e!=t&&!(e.x&&(e.type==C.BAR&&(i=e),e.x>=l));e=e.ts_next);if(e==t)return t&&(t=set_nl(t)),t;for(p=!1,o=null;e!=t;e=e.ts_next)if(s=e.x){if(s>u)break;if(e.type==C.BAR)if(s<c)o=e;else{if(o&&!(e.x<c)){if(o>c)break;if(c-o.x<e.x-c)break;o=e;break}o=e}}if(o&&(e=o,p=!0),!p){var d=0,h=i.time;for(u-=8,e=i,o=null;e!=t;e=e.ts_next)if(e.beam_st&&d++,e.beam_end&&d>0&&d--,s=e.x){if(s+e.wr>=u)break;if(!d&&!e.in_tuplet)if((e.time-h)%(C.BLEN/4)!=0){if(o&&!(e.x<c)){if(o>c)break;if(c-o.x<e.x-c)break;o=e;break}o=e}else o=e}o&&(e=o,p=!0)}if(!p){for(o=e=i;e!=t;e=e.ts_next)if(s=e.x){if(!(e.x<c)){if(o>c)break;if(c-o.x<e.x-c)break;o=e;break}o=e}e=o}if(e.nl)for(error(0,e,"Line split problem - adjust maxshrink and/or breaklimit"),f=2,e=e.ts_next;e!=t&&!(e.x&&--f<=0);e=e.ts_next);if(!(e=set_nl(e))||t&&e.time>=t.time)break;$-=e.x-a.x,n=0}return e}function cut_tune(e,t){var r,n,a,i,o,r=tsfirst;if(0!=t&&(i=set_indent(),e-=i,t-=i),i=get_ck_width(),e-=i[0],t+=i[1],cfmt.custos&&1==voice_tb.length&&(e-=12),cfmt.barsperstaff)for(i=cfmt.barsperstaff,n=r;n;n=n.ts_next)n.type!=C.BAR||!n.bar_num||--i>0||(n.eoln=!0,i=cfmt.barsperstaff);for(o=t,n=r;r;r=r.ts_next)if(r.seqst||r.eoln){if((o+=r.shrink)>e)n=set_lines(n,r,e,t);else{if(!r.eoln)continue;if(delete r.eoln,r.dur){for(a=r.ts_next;a&&!(a.seqst||a.dur<r.dur);a=a.ts_next);n=a&&!a.seqst?set_lines(n,r,e,t):set_nl(r)}else n=set_nl(r)}if(!n)break;n.ts_prev?(o=n.shrink,r=n.ts_prev,t=0):delete n.nl}}function set_yval(e){switch(e.type){case C.CLEF:if(e.second||e.invis){e.ymx=e.ymn=12;break}switch(e.y=6*(e.clef_line-1),e.clef_type){default:e.ymx=e.y+28,e.ymn=e.y-14;break;case"c":e.ymx=e.y+13,e.ymn=e.y-11;break;case"b":e.ymx=e.y+7,e.ymn=e.y-12}e.clef_small&&(e.ymx-=2,e.ymn+=2),e.ymx<26&&(e.ymx=26),e.ymn>-1&&(e.ymn=-1),e.clef_octave&&(e.clef_octave>0?e.ymx+=12:e.ymn-=12);break;case C.KEY:e.k_sf>2?e.ymx=34:e.k_sf>0?e.ymx=30:e.ymx=26,e.ymn=-2;break;default:e.ymx=26,e.ymn=-2}}function set_auto_clef(e,t,r){var n,a,i,o,s,l;for(i=12,a=20,n=t;n&&(n.type!=C.STAVES||n==t);n=n.ts_next)if(n.st==e)if(n.type==C.NOTE)n.notes[0].pit<a?a=n.notes[0].pit:n.notes[n.nhd].pit>i&&(i=n.notes[n.nhd].pit);else if(n.type==C.CLEF){if("a"!=n.clef_type)break;unlksym(n)}if(a>=19||a>=13&&"b"!=r)return"t";if(i<=13||i<=19&&"t"!=r)return"b";"a"==r&&(r=(i+a)/2>=16?"t":"b");var c=r,u=n,$=null;for(n=t;n!=u&&(n.type!=C.STAVES||n==t);n=n.ts_next)if(n.st==e&&n.type==C.NOTE){if(o=n.time,"t"==c){if(n.notes[0].pit>12||n.notes[n.nhd].pit>20){n.notes[0].pit>20&&($=n);continue}if((s=n.ts_prev)&&s.time==o&&s.st==e&&s.type==C.NOTE&&s.notes[0].pit>=19)continue;if((s=n.ts_next)&&s.st==e&&s.time==o&&s.type==C.NOTE&&s.notes[0].pit>=19)continue}else{if(n.notes[0].pit<12||n.notes[n.nhd].pit<20){n.notes[n.nhd].pit<12&&($=n);continue}if((s=n.ts_prev)&&s.time==o&&s.st==e&&s.type==C.NOTE&&s.notes[0].pit<=13)continue;if((s=n.ts_next)&&s.st==e&&s.time==o&&s.type==C.NOTE&&s.notes[0].pit<=13)continue}if($){for(l=n,s=n.ts_prev;s!=$;s=s.ts_prev)if(s.st==e){if(s.type==C.BAR&&s.v==n.v){l=s;break}s.type==C.NOTE&&s.beam_st&&!s.p_v.second&&(l=s)}l.time!=$.time?($=n,c="t"==c?"b":"t",s=insert_clef(l,c,"t"==c?2:4),s.clef_auto=!0):$=n}else c=r="t"==c?"b":"t",$=n}return r}function set_clefs(){var e,t,r,n,a,i,o,s,l,c=new Array(nstaff),u=cur_sy,$=[];for(staff_tb=new Array(nstaff),r=0;r<=nstaff;r++)c[r]={autoclef:!0},staff_tb[r]={output:"",sc_out:""};for(n=0;n<voice_tb.length;n++)a=voice_tb[n],u.voices[n].range<0||(r=u.voices[n].st,u.voices[n].second||(void 0!=a.staffnonote&&(u.staves[r].staffnonote=a.staffnonote),a.staffscale&&(u.staves[r].staffscale=a.staffscale),
u.voices[n].sep&&(u.staves[r].sep=u.voices[n].sep),u.voices[n].maxsep&&(u.staves[r].maxsep=u.voices[n].maxsep)),u.voices[n].second||a.clef.clef_auto||(c[r].autoclef=!1));for(n=0;n<voice_tb.length;n++)a=voice_tb[n],u.voices[n].range<0||u.voices[n].second||(r=u.voices[n].st,e=a.clef,c[r].autoclef&&(e.clef_type=set_auto_clef(r,tsfirst,e.clef_type),e.clef_line="t"==e.clef_type?2:4),c[r].clef=staff_tb[r].clef=e);for(r=0;r<=u.nstaff;r++)$[r]=3*(u.staves[r].stafflines.length-1);for(e=tsfirst;e;e=e.ts_next){switch(e.repeat_n&&set_repeat(e),e.type){case C.STAVES:for(u=e.sy,r=0;r<=nstaff;r++)c[r].autoclef=!0;for(n=0;n<voice_tb.length;n++)u.voices[n].range<0||(a=voice_tb[n],r=u.voices[n].st,u.voices[n].second||(void 0!=a.staffnonote&&(u.staves[r].staffnonote=a.staffnonote),a.staffscale&&(u.staves[r].staffscale=a.staffscale),u.voices[n].sep&&(u.staves[r].sep=u.voices[n].sep),u.voices[n].maxsep&&(u.staves[r].maxsep=u.voices[n].maxsep)),t=a.clef,t.clef_auto||(c[r].autoclef=!1));for(r=0;r<=u.nstaff;r++)$[r]=3*(u.staves[r].stafflines.length-1);for(n=0;n<voice_tb.length;n++)if(!(u.voices[n].range<0||u.voices[n].second))if(a=voice_tb[n],r=u.voices[n].st,t=a.clef,t.clef_auto?(o=set_auto_clef(r,e,c[r].clef?c[r].clef.clef_type:"a"),s="t"==o?2:4):(o=t.clef_type,s=t.clef_line),c[r].clef){if(o!=c[r].clef.clef_type||s!=c[r].clef.clef_line){for(i=e.ts_next;i&&(i.v!=n||i.st!=r);)i=i.ts_next;i&&(i.type!=C.CLEF&&(i=insert_clef(i,o,s),t.clef_auto&&(i.clef_auto=!0)),c[r].clef=a.clef=i)}}else t.clef_auto&&("a"!=t.type&&(a.clef=clone(a.clef)),a.clef.clef_type=o,a.clef.clef_line=s),staff_tb[r].clef=c[r].clef=a.clef;continue;default:e.mid=$[e.st];continue;case C.CLEF:}if("a"==e.clef_type&&(e.clef_type=set_auto_clef(e.st,e.ts_next,c[e.st].clef.clef_type),e.clef_line="t"==e.clef_type?2:4),a=e.p_v,a.clef=e,e.second)unlksym(e);else{if(r=e.st,c[r].clef){if(e.clef_type==c[r].clef.clef_type&&e.clef_line==c[r].clef.clef_line)continue}else staff_tb[r].clef=e;c[r].clef=e}}for(u=cur_sy,n=0;n<voice_tb.length;n++)if(!(u.voices[n].range<0)&&(t=voice_tb[n].sym)&&127==t.notes[0].pit){switch(r=u.voices[n].st,staff_tb[r].clef.clef_type){default:l=22;break;case"c":l=16;break;case"b":l=10}for(e=t;e;e=e.next)e.notes[0].pit=l}}function set_pitch(e){var t,r,n,a,i,o,s=C.BLEN,l=new Array(nstaff);for(n=0;n<=nstaff;n++)t=staff_tb[n].clef,l[n]=delta_tb[t.clef_type]+2*t.clef_line,t.clefpit&&(l[n]+=t.clefpit),cfmt.sound?t.clef_octave&&!t.clef_oct_transp&&(l[n]+=t.clef_octave):t.clef_oct_transp&&(l[n]-=t.clef_octave);for(t=tsfirst;t!=e;t=t.ts_next)switch(n=t.st,t.type){case C.CLEF:l[n]=delta_tb[t.clef_type]+2*t.clef_line,t.clefpit&&(l[n]+=t.clefpit),cfmt.sound?t.clef_octave&&!t.clef_oct_transp&&(l[n]+=t.clef_octave):t.clef_oct_transp&&(l[n]-=t.clef_octave),set_yval(t);break;case C.GRACE:for(r=t.extra;r;r=r.next){if(0!=(a=l[r.st])&&!t.p_v.key.k_drum)for(i=0;i<=r.nhd;i++)o=r.notes[i],o.pit+=a;r.ymn=3*(r.notes[0].pit-18)-2,r.ymx=3*(r.notes[r.nhd].pit-18)+2}set_yval(t);break;case C.KEY:t.k_y_clef=l[n];default:set_yval(t);break;case C.MREST:if(t.invis)break;t.y=12,t.ymx=39,t.ymn=-2;break;case C.REST:if(1==voice_tb.length){t.y=12,t.ymx=24,t.ymn=0;break}case C.NOTE:if(0!=(a=l[n])&&!t.p_v.key.k_drum)for(i=t.nhd;i>=0;i--)t.notes[i].pit+=a;t.type==C.NOTE?(t.ymx=3*(t.notes[t.nhd].pit-18)+4,t.ymn=3*(t.notes[0].pit-18)-4):(t.y=6*((t.notes[0].pit-18)/2|0),t.ymx=t.y+rest_sp[5-t.nflags][0],t.ymn=t.y-rest_sp[5-t.nflags][1]),t.dur<s&&(s=t.dur)}e||(smallest_duration=s)}function set_stem_dir(){for(var e,t,r,n,a,i,o,s,l,c,u=[],$=tsfirst,f=cur_sy,p=f.nstaff;$;){for(n=0;n<=p;n++)u[n]=[];for(c=[],t=$;t&&t.type!=C.BAR;t=t.ts_next)if(t.type!=C.STAVES){if(!(t.type!=C.NOTE&&t.type!=C.REST||t.invis)){if((n=t.st)>p){var d="*** fatal set_stem_dir(): bad staff number "+n+" max "+p;throw error(2,null,d),new Error(d)}for(i=t.v,o=c[i],o||(o={st1:-1,st2:-1},c[i]=o),o.st1<0?o.st1=n:o.st1!=n&&(n>o.st1?n>o.st2&&(o.st2=n):(o.st1>o.st2&&(o.st2=o.st1),o.st1=n)),s=u[n],a=f.voices[i].range,r=s.length;--r>=0&&(l=s[r],l.v!=a););if(r<0){for(l={v:a,ymx:0,ymn:24},r=0;r<s.length;r++)if(a<s[r].v){s.splice(r,0,l);break}r==s.length&&s.push(l)}t.type==C.NOTE&&(t.ymx>l.ymx&&(l.ymx=t.ymx),t.ymn<l.ymn&&(l.ymn=t.ymn),t.xstem&&(t.ts_prev.st!=n-1||t.ts_prev.type!=C.NOTE?(error(1,$,"Bad !xstem!"),t.xstem=!1):(t.ts_prev.multi=1,t.multi=1,t.stemless=!0)))}}else{if(t!=$)break;for(f=$.sy,n=p;n<=f.nstaff;n++)u[n]=[];p=f.nstaff}for(;$!=t;$=$.ts_next)if(!$.multi){switch($.type){default:continue;case C.REST:if(void 0!=$.combine&&$.combine<0||!$.ts_next||$.ts_next.type!=C.REST||$.ts_next.st!=$.st||$.time!=$.ts_next.time||$.dur!=$.ts_next.dur||$.invis)break;unlksym($.ts_next);break;case C.NOTE:case C.GRACE:}if(n=$.st,i=$.v,o=c[i],s=u[n],o&&o.st2>=0)n==o.st1?$.multi=-1:n==o.st2&&($.multi=1);else if(s.length<=1)$.floating&&($.multi=n==voice_tb[i].st?-1:1);else{for(a=f.voices[i].range,r=s.length;--r>=0&&s[r].v!=a;);r<0||(r==s.length-1?$.multi=-1:($.multi=1,0!=r&&r+2==s.length&&(s[r].ymn-cfmt.stemheight>s[r+1].ymx&&($.multi=-1),e=$.ts_next,$.ts_prev&&$.ts_prev.time==$.time&&$.ts_prev.st==$.st&&$.notes[$.nhd].pit==$.ts_prev.notes[0].pit&&$.beam_st&&$.beam_end&&(!e||e.st!=$.st||e.time!=$.time)&&($.multi=-1))))}}for(;$&&$.type==C.BAR;)$=$.ts_next}}function set_rest_offset(){var e,t,r,n,a,i,o,s,l,c,u,$=[],f=cur_sy;for(e=tsfirst;e;e=e.ts_next)if(!e.invis&&(e.type==C.STAVES&&(f=e.sy),e.dur&&(i=$[e.v],i||(i={},$[e.v]=i),i.s=e,i.st=e.st,i.end_time=e.time+e.dur,e.type==C.REST))){for(s=-127,o=127,a=c=!1,r=0;r<=$.length;r++)(i=$[r])&&i.s&&i.st==e.st&&r!=e.v&&(i.end_time<=e.time||(a=!0,t=i.s,f.voices[r].range<f.voices[e.v].range?t.time==e.time?t.ymn<o&&(o=t.ymn,t.dots&&(c=!0)):t.y<o&&(o=t.y):t.time==e.time?t.ymx>s&&(s=t.ymx,t.dots&&(c=!0)):t.y>s&&(s=t.y)));for(n=e.time+e.dur,t=e.ts_next;t&&!(t.time>=n);t=t.ts_next)t.st==e.st&&t.dur&&!t.invis&&(a=!0,f.voices[t.v].range<f.voices[e.v].range?t.time==e.time?t.ymn<o&&(o=t.ymn,t.dots&&(c=!0)):t.y<o&&(o=t.y):t.time==e.time?t.ymx>s&&(s=t.ymx,t.dots&&(c=!0)):t.y>s&&(s=t.y));if(a)if(127==o&&e.y<12&&(l=12-e.y,e.y+=l,e.ymx+=l,e.ymn+=l),-127==s&&e.y>12&&(l=e.y-12,e.y-=l,e.ymx-=l,e.ymn-=l),(l=o-e.ymx)<0){if(l=6*Math.ceil(-l/6),e.ymn-l>=s){e.y-=l,e.ymx-=l,e.ymn-=l;continue}u=c?15:10,e.notes[0].shhd=u,e.xmx=u}else if((l=s-e.ymn)>0){if(l=6*Math.ceil(l/6),e.ymx+l<=o){e.y+=l,e.ymx+=l,e.ymn+=l;continue}u=c?15:10,e.notes[0].shhd=u,e.xmx=u}else;else e.y=12,e.ymx=24,e.ymn=0}}function new_sym(e,t,r){var n={type:e,fname:r.fname,v:t.v,p_v:t,st:t.st,time:r.time,next:t.last_sym.next};return n.next&&(n.next.prev=n),t.last_sym.next=n,n.prev=t.last_sym,t.last_sym=n,lktsym(n,r),n.ts_prev.type!=e&&(n.seqst=!0),r.type==e&&n.v!=r.v&&(delete r.seqst,r.shrink=0),n}function init_music_line(){var e,t,r,n,a,i,o=voice_tb.length;for(a=0;a<o;a++)if(!(cur_sy.voices[a].range<0)){for(e=voice_tb[a],e.second=cur_sy.voices[a].second,e.last_sym=e.sym,i=cur_sy.voices[a].st;i<nstaff&&!cur_sy.st_print[i];)i++;e.st=i}for(n=tsfirst;n.type==C.CLEF;)a=n.v,cur_sy.voices[a].range>=0&&!cur_sy.voices[a].second&&(delete n.clef_small,e=n.p_v,e.last_sym=e.sym=n),n=n.ts_next;for(a=0;a<o;a++)e=voice_tb[a],e.sym&&e.sym.type==C.CLEF||cur_sy.voices[a].range<0||cur_sy.voices[a].second&&!e.bar_start||(i=cur_sy.voices[a].st,staff_tb[i]&&staff_tb[i].clef&&(t=clone(staff_tb[i].clef),t.v=a,t.p_v=e,t.st=i,t.time=tsfirst.time,t.prev=null,t.next=e.sym,t.next&&(t.next.prev=t),e.sym=t,e.last_sym=t,t.ts_next=n,t.ts_prev=n?n.ts_prev:null,t.ts_prev?(t.ts_prev.ts_next=t,delete t.seqst):(tsfirst=t,t.seqst=!0),n&&(n.ts_prev=t,n.type==C.CLEF&&delete n.seqst),delete t.clef_small,t.second=cur_sy.voices[a].second,cur_sy.st_print[i]||(t.invis=!0)));for(a=0;a<o;a++)cur_sy.voices[a].range<0||cur_sy.voices[a].second||!cur_sy.st_print[cur_sy.voices[a].st]||(e=voice_tb[a],n&&n.v==a&&n.type==C.KEY?(e.last_sym=n,n.k_old_sf=n.k_sf,n=n.ts_next):(r=e.key,(r.k_sf||r.k_a_acc)&&(t=new_sym(C.KEY,e,n),t.k_sf=r.k_sf,t.k_old_sf=r.k_sf,t.k_none=r.k_none,t.k_a_acc=r.k_a_acc,t.istart=r.istart,t.iend=r.iend,r.k_bagpipe&&(t.k_bagpipe=r.k_bagpipe,"p"==t.k_bagpipe&&(t.k_old_sf=3)))));if(1&insert_meter){for(a=0;a<o;a++)e=voice_tb[a],r=e.meter,cur_sy.voices[a].range<0||cur_sy.voices[a].second||!cur_sy.st_print[cur_sy.voices[a].st]||0==r.a_meter.length||(n&&n.v==a&&n.type==C.METER?(e.last_sym=n,n=n.ts_next):(t=new_sym(C.METER,e,n),t.istart=r.istart,t.iend=r.iend,t.wmeasure=r.wmeasure,t.a_meter=r.a_meter));insert_meter&=-2}for(a=0;a<o;a++)e=voice_tb[a],n&&n.v==a&&n.type==C.BAR?(e.last_sym=n,n=n.ts_next):(r=e.bar_start)&&(e.bar_start=null,cur_sy.voices[a].range<0||!cur_sy.st_print[cur_sy.voices[a].st]||(r.next=e.last_sym.next,r.next&&(r.next.prev=r),e.last_sym.next=r,r.prev=e.last_sym,e.last_sym=r,lktsym(r,n),r.time=tsfirst.time,r.ts_prev.type!=r.type&&(r.seqst=!0),n&&n.type==r.type&&r.v!=n.v&&(delete n.seqst,n.shrink=0)));for(set_pitch(n),t=n;t;t=t.ts_next)if(t.seqst){for(t=t.ts_next;t&&!t.seqst;t=t.ts_next);break}set_allsymwidth(t)}function set_words(e){var t,r,n,a,i=!0,o=127;for(t=e.sym;t;t=t.next)if(t.type==C.NOTE){o=t.notes[0].pit;break}for(t=e.sym;t;t=t.next){switch(t.type){case C.MREST:i=!0;break;case C.BAR:t.beam_on||(i=!0),!t.next&&t.prev&&t.prev.head==C.OVALBARS&&(t.prev.head=C.SQUARE);break;case C.NOTE:case C.REST:if(t.trem2)break;n=t.nflags,t.ntrem&&(n+=t.ntrem),t.type==C.REST&&t.beam_end&&(t.beam_end=!1,i=!0),(i||n<=0)&&(a&&(a.beam_end=!0,a=null),n<=0?(t.beam_st=!0,t.beam_end=!0):t.type==C.NOTE&&(t.beam_st=!0,i=!1)),t.beam_end&&(i=!0),t.type==C.NOTE&&(a=t)}if(t.type==C.NOTE)for(0!=t.nhd&&sort_pitch(t),o=t.notes[0].pit,r=t.prev;r&&r.type==C.REST;r=r.prev)r.notes[0].pit=o;else t.notes||(t.notes=[],t.notes[0]={},t.nhd=0),t.notes[0].pit=o}a&&(a.beam_end=!0)}function set_rb(e){for(var t,r,n,a=e.sym;a;)if(a.type==C.BAR&&a.rbstart&&!a.norepbra){if(r=cfmt.rbmax,a.text&&"1"==a.text[0]){for(n=0,t=null,a=a.next;a;a=a.next)if(a.type==C.BAR){if(n++,a.rbstop){n<=cfmt.rbmax&&(r=n,t=null);break}n==cfmt.rbmin&&(t=a)}t&&(t.rbstop=1,r=cfmt.rbmin)}for(;a;){if(2!=a.rbstart){if(!(a=a.next))break;if(2!=a.rbstart){if(!(a=a.next))break;if(2!=a.rbstart)break}}for(n=0,t=null,a=a.next;a;a=a.next)if(a.type==C.BAR){if(n++,a.rbstop)break;a.next?n==r&&(a.rbstop=1):a.rbstop=2}}}else a=a.next}function set_global(){var e,t,r,n,a;for(a=cur_sy,t=a.nstaff;;){if(!(a=a.next))break;a.nstaff>t&&(t=a.nstaff)}for(nstaff=t,n=voice_tb.length,r=0;r<n;r++)e=voice_tb[r],set_words(e),set_rb(e);set_float(),set_clefs(),set_pitch(null)}function set_indent(e){var t,r,n,a,i,o,s,l,c=voice_tb.length,u=0;for(r=0;r<c;r++)if(a=voice_tb[r],!(cur_sy.voices[r].range<0)&&(t=cur_sy.voices[r].st,i=(e||a.new_name)&&a.nm?a.nm:a.snm))for(l||(l=get_font("voice"),set_font(l)),o=0;;){if(s=i.indexOf("\\n",o),n=strwh(s<0?i.slice(o):i.slice(o,s)),n=n[0],n>u&&(u=n),s<0)break;o=s+1}for(l&&(u+=4*cwid(" ")*l.swfac),n=.5,t=0;t<=cur_sy.nstaff;t++){if(cur_sy.staves[t].flags&(OPEN_BRACE2|OPEN_BRACKET2)){n=12;break}cur_sy.staves[t].flags&(OPEN_BRACE|OPEN_BRACKET)&&(n=6)}return u+=n,e&&(u+=cfmt.indent),u}function set_beams(e){var t,r,n,a,i,o,s,l,c,u=-1;for(t=e;t;t=t.next)if(t.type==C.NOTE){if(t.stem||0!=(t.stem=t.multi))t.beam_st&&!t.beam_end&&(n=!0);else if(s=t.mid/3+18,n)t.stem=u;else if(t.beam_st&&!t.beam_end){for(n=!0,l=t.notes[t.nhd].pit,c=t.notes[0].pit,r=t.next;r;r=r.next)if(r.type==C.NOTE){if(r.stem||r.multi){t.stem=r.stem||r.multi;break}if(r.notes[r.nhd].pit>l&&(l=r.notes[r.nhd].pit),r.notes[0].pit<c&&(c=r.notes[0].pit),r.beam_end)break}r.beam_end&&((l+c)/2<s?t.stem=1:(l+c)/2>s?t.stem=-1:cfmt.bstemdown&&(t.stem=-1)),t.stem||(t.stem=u)}else{if((i=(t.notes[t.nhd].pit+t.notes[0].pit)/2)==s){for(i=0,o=0;o<=t.nhd;o++)i+=t.notes[o].pit;i/=t.nhd+1}i<s?t.stem=1:i>s?t.stem=-1:cfmt.bstemdown?t.stem=-1:t.stem=u}if(t.beam_end&&(n=!1),u=t.stem,a){for(r=a.extra;r;r=r.next)r.stem=-u;a.stem=-u,a=null}}else{if(t.type!=C.GRACE)continue;if(r=t.extra,2==r.stem){a=t;continue}for(t.stem||0!=(t.stem=t.multi)||(t.stem=1);r;r=r.next)r.stem=t.stem,r.multi=t.multi}}function same_head(e,t){var r,n,a,i,o,s,l,c,u,$,f;if(e.shiftunison&&e.shiftunison>=3)return!1;if((a=e.dur)>=C.BLEN)return!1;if((i=t.dur)>=C.BLEN)return!1;if(e.stemless&&t.stemless)return!1;if(e.dots!=t.dots&&(e.shiftunison&&1&e.shiftunison||e.dots*t.dots!=0))return!1;if(e.stem*t.stem>0)return!1;if(r=n=0,e.notes[0].pit>t.notes[0].pit){if(e.stem<0)return!1;for(;t.notes[n].pit!=e.notes[0].pit;)if(++n>t.nhd)return!1}else if(e.notes[0].pit<t.notes[0].pit){if(t.stem<0)return!1;for(;t.notes[0].pit!=e.notes[r].pit;)if(++r>e.nhd)return!1}if(t.notes[n].acc!=e.notes[r].acc)return!1;s=r,c=n,$=e.notes[r].shhd,f=t.notes[n].shhd;do{if(r++,n++,r>e.nhd)break;if(n>t.nhd)break;if(t.notes[n].acc!=e.notes[r].acc)return!1;$<e.notes[r].shhd&&($=e.notes[r].shhd),f<t.notes[n].shhd&&(f=t.notes[n].shhd)}while(t.notes[n].pit==e.notes[r].pit);if(r<=e.nhd){if(n<=t.nhd)return!1;if(t.stem>0)return!1}else if(n<=t.nhd&&e.stem>0)return!1;if(l=r,u=n,o=0,a!=i)if(a<i&&(a=i,i=e.dur),a<C.BLEN/2)t.dots>0?o=2:e.dots>0&&(o=1);else{if(!(i<C.BLEN/4))return!1;if(e.shiftunison&&2&e.shiftunison)return!1;o=t.dur>=C.BLEN/2?2:1}if(0==o&&(o=e.p_v.scale<t.p_v.scale?2:1),1==o){for(n=c;n<u;n++)t.notes[n].invis=!0,delete t.notes[n].acc;for(n=0;n<=t.nhd;n++)t.notes[n].shhd+=$}else{for(r=s;r<l;r++)e.notes[r].invis=!0,delete e.notes[r].acc;for(r=0;r<=e.nhd;r++)e.notes[r].shhd+=f}return!0}function unison_acc(e,t,r,n){var a,i;if(t.notes[n].acc){for(i=2*w_note[e.head]+e.xmx+t.notes[n].shac+2,t.notes[n].micro&&(i+=2),e.dots&&(i+=6),a=0;a<=t.nhd;a++)t.notes[a].shhd+=i,t.notes[a].shac-=i;t.xmx+=i}else{for(i=2*w_note[t.head]+t.xmx+e.notes[r].shac+2,e.notes[r].micro&&(i+=2),t.dots&&(i+=6),a=0;a<=e.nhd;a++)e.notes[a].shhd+=i,e.notes[a].shac-=i;e.xmx+=i}}function set_left(e){var t,r,n,a,i=w_note[e.head],o=i,s=[];for(r=0;r<MAXPIT;r++)s.push(-100);if(e.nflags>-2)for(e.stem>0?(o=-o,r=2*e.notes[0].pit,n=2*(Math.ceil((e.ymx-2)/3)+18)):(r=2*(Math.ceil((e.ymn+2)/3)+18),n=2*e.notes[e.nhd].pit),r<0&&(r=0),n>=MAXPIT&&(n=MAXPIT-1);r<=n;)s[r++]=o;for(a=e.notes[e.stem>0?0:e.nhd].shhd,t=0;t<=e.nhd;t++)o=-e.notes[t].shhd+i+a,r=2*e.notes[t].pit,r<0?r=0:r>=MAXPIT-1&&(r=MAXPIT-2),o>s[r]&&(s[r]=o),e.head!=C.SQUARE&&(o-=1),o>s[r-1]&&(s[r-1]=o),o>s[r+1]&&(s[r+1]=o);return s}function set_right(e){var t,r,n,a,i,o=w_note[e.head],s=o,l=e.nflags>0&&e.beam_st&&e.beam_end,c=[];for(r=0;r<MAXPIT;r++)c.push(-100);if(e.nflags>-2)for(e.stem<0?(s=-s,r=2*(Math.ceil((e.ymn+2)/3)+18),n=2*e.notes[e.nhd].pit,a=r+4):(r=2*e.notes[0].pit,n=2*(Math.ceil((e.ymx-2)/3)+18)),r<0&&(r=0),n>MAXPIT&&(n=MAXPIT);r<n;)c[r++]=s;if(l)if(e.stem>0)for(r=0==e.xmx?2*e.notes[e.nhd].pit:2*e.notes[0].pit,r+=4,r<0&&(r=0);r<MAXPIT&&r<=n-4;r++)c[r]=11;else for(r=a,r<0&&(r=0);r<MAXPIT&&r<=2*e.notes[0].pit-4;r++)c[r]=3.5;for(i=e.notes[e.stem>0?0:e.nhd].shhd,t=0;t<=e.nhd;t++)s=e.notes[t].shhd+o-i,r=2*e.notes[t].pit,r<0?r=0:r>=MAXPIT-1&&(r=MAXPIT-2),s>c[r]&&(c[r]=s),e.head!=C.SQUARE&&(s-=1),s>c[r-1]&&(c[r-1]=s),s>c[r+1]&&(c[r+1]=s);return c}function set_overlap(){var e,t,r,n,a,i,o,s,l,c,u,$,f,p,d,h,_,g,m,y,v,b,x;for(e=tsfirst;e;e=e.ts_next)if(e.type==C.NOTE&&!e.invis){if(e.xstem&&e.ts_prev.stem<0)for(s=0;s<=e.nhd;s++)e.notes[s].shhd-=7,e.notes[s].shac+=16;for(r=e;;){if(!(r=r.ts_next))break;if(r.time!=e.time){r=null;break}if(r.type==C.NOTE&&!r.invis&&r.st==e.st)break}if(r&&(t=e,cur_sy.voices[t.v].range<cur_sy.voices[r.v].range?r.dot_low=!0:t.dot_low=!0,!(t.ymn>r.ymx||t.ymx<r.ymn||same_head(t,r)))){if(g=set_right(t),m=set_left(r),(n=t.ts_prev)&&n.time==t.time&&n.st==t.st&&n.type==C.NOTE&&!n.invis)for(v=set_right(n),a=0;a<MAXPIT;a++)v[a]>g[a]&&(g[a]=v[a]);else n=null;for($=-10,a=0;a<MAXPIT;a++)m[a]+g[a]>$&&($=m[a]+g[a]);if(!($<-3&&(!t.dots||!r.dots||!r.dot_low||t.stem>0||r.stem<0||t.notes[t.nhd].pit+2!=r.notes[0].pit||1&r.notes[0].pit))){if(y=set_right(r),_=set_left(t),n)for(v=set_left(n),a=0;a<MAXPIT;a++)v[a]>_[a]&&(_[a]=v[a]);for(f=p=d=-100,a=0;a<MAXPIT;a++)_[a]+y[a]>f&&(f=_[a]+y[a]),y[a]>d&&(d=y[a]),g[a]>p&&(p=g[a]);for(c=0,i=t.nhd,o=r.nhd;;){switch(u=t.notes[i].pit-r.notes[o].pit){case 0:if(t.notes[i].acc!=r.notes[o].acc){c=-1;break}r.notes[o].acc&&(r.notes[o].acc=0),t.dots&&r.dots&&1&t.notes[i].pit&&(c=1);break;case-1:t.dots&&r.dots&&(1&t.notes[i].pit?(t.dot_low=!1,r.dot_low=!1):(t.dot_low=!0,r.dot_low=!0));break;case-2:if(t.dots&&r.dots&&!(1&t.notes[i].pit)){t.dot_low=!1,r.dot_low=!1;break}}if(c<0)break;if(u>=0&&--i<0)break;if(u<=0&&--o<0)break}if(c<0)unison_acc(t,r,i,o);else{if(l=0,t.dots?r.dots&&(c||(l=1)):r.dots&&f+p<$+d&&(l=1),b=m,x=y,!n&&f+p<$+d&&function(){t=r,r=e,$=f,b=_,x=g,d=p}(),$+=3,$<0&&($=0),s=t.stem>=0?0:t.nhd,$+=t.notes[s].shhd,s=r.stem>=0?0:r.nhd,$-=r.notes[s].shhd,t.dots)if(h=7.7+t.xmx+3.5*t.dots-3.5+3,l){if(h<$+d+r.xmx){for(f=0,i=0;i<=t.nhd;i++)a=t.notes[i].pit,1&a||(t.dot_low?a--:a++),a*=2,a<1?a=1:a>=MAXPIT-1&&(a=MAXPIT-2),x[a]>f&&(f=x[a]),x[a-1]+1>f&&(f=x[a-1]=1),x[a+1]+1>f&&(f=x[a+1]+1);f>4.5&&7.7+t.xmx+2<$+f+r.xmx&&(r.xmx=f+3-7.7)}}else{for(f=-100,i=0;i<=t.nhd;i++)a=t.notes[i].pit,1&a||(t.dot_low?a--:a++),a*=2,a<1?a=1:a>=MAXPIT-1&&(a=MAXPIT-2),b[a]>f&&(f=b[a]),b[a-1]+1>f&&(f=b[a-1]+1),b[a+1]+1>f&&(f=b[a+1]+1);h+f+2>$&&($=h+f+2)}for(s=r.nhd;s>=0;s--)r.notes[s].shhd+=$;r.xmx+=$,l&&(t.xmx=r.xmx)}}}}}function set_stems(){var e,t,r,n,a,i,o,s,l,c;for(e=tsfirst;e;e=e.ts_next)if(e.type==C.NOTE){if(set_head_shift(e),s=e.nflags,e.beam_st&&!e.beam_end){for(e.feathered_beam&&(s=++e.nflags),t=e.next;t.type!=C.NOTE||(e.feathered_beam&&t.nflags++,!t.beam_end);t=t.next);t.nflags>s&&(s=t.nflags)}else if(!e.beam_st&&e.beam_end){for(t=e.prev;!t.beam_st;t=t.prev);t.nflags>s&&(s=t.nflags)}switch(n=cfmt.stemheight,s){case 2:n+=2;break;case 3:n+=5;break;case 4:n+=10;break;case 5:n+=16}1!=(a=e.p_v.scale)&&(n*=.5*(a+1)),i=3*(e.notes[0].pit-18),e.nhd>0?(n-=2,o=3*(e.notes[e.nhd].pit-18)):o=i,e.ntrem&&(n+=2*e.ntrem),e.stemless?(e.stem>=0?(e.y=i,e.ys=o):(e.ys=i,e.y=o),-4==s&&(i-=6),e.ymx=o+4,e.ymn=i-4):e.stem>=0?(s>=2&&(n-=1),e.notes[e.nhd].pit>26&&(s<=0||!e.beam_st||!e.beam_end)&&(n-=2,e.notes[e.nhd].pit>28&&(n-=2)),e.y=i,e.notes[0].ti1&&(i-=3),e.ymn=i-4,e.ys=o+n,e.ys<e.mid&&(e.ys=e.mid),e.ymx=e.ys+2.5|0):(e.notes[0].pit<18&&(s<=0||!e.beam_st||!e.beam_end)&&(n-=2,e.notes[0].pit<16&&(n-=2)),e.ys=i-n,e.ys>e.mid&&(e.ys=e.mid),e.ymn=e.ys-2.5|0,e.y=o,e.notes[e.nhd].ti1&&(o+=3),e.ymx=o+4)}else{if(e.type!=C.GRACE)continue;for(l=c=e.mid,r=e.extra;r;r=r.next)n=GSTEM,r.nflags>1&&(n+=1.2*(r.nflags-1)),i=3*(r.notes[0].pit-18),o=3*(r.notes[r.nhd].pit-18),e.stem>=0?(r.y=i,r.ys=o+n,o=Math.round(r.ys)):(r.y=o,r.ys=i-n,i=Math.round(r.ys)),o+=2,i-=2,i<l?l=i:o>c&&(c=o),r.ymx=o,r.ymn=i;e.ymx=c,e.ymn=l}}function check_bar(e){for(var t,r,n=e.p_v;e.type==C.CLEF||e.type==C.KEY||e.type==C.METER;)if(e.type==C.METER&&e.time>n.sym.time&&(insert_meter|=1),!(e=e.prev))return;if(e.type==C.BAR&&(void 0!=e.text&&(n.bar_start=clone(e),n.bar_start.bar_type="[",delete e.text,delete e.a_gch),":"!=(t=e.bar_type)&&":"==t.slice(-1))){if(n.bar_start||(n.bar_start=clone(e)),":"!=t[0])return"||:"==t?(n.bar_start.bar_type="|:",void(e.bar_type="||")):(n.bar_start.bar_type=t,void(e.prev&&e.prev.type==C.BAR?unlksym(e):e.bar_type="|"));if("::"==t)return n.bar_start.bar_type="|:",void(e.bar_type=":|");if("||:"==t)return n.bar_start.bar_type="|:",void(e.bar_type="||");for(r=0;":"==t[r];)r++;if(r<t.length){for(e.bar_type=t.slice(0,r)+"|",r=t.length-1;":"==t[r];)r--;n.bar_start.bar_type="|"+t.slice(r+1)}else r=t.length/2|0,e.bar_type=t.slice(0,r)+"|",n.bar_start.bar_type="|"+t.slice(r)}}function sym_staff_move(e){for(var t=tsfirst;t&&!t.nl;t=t.ts_next)t.st==e&&t.type!=C.CLEF&&(t.st++,t.invis=!0)}function block_gen(e){switch(e.subtype){case"leftmargin":case"rightmargin":case"pagescale":case"pagewidth":case"scale":case"staffwidth":svg_flush(),set_format(e.subtype,e.param);break;case"ml":svg_flush(),user.img_out(e.text);break;case"newpage":blk_flush(),block.newpage=!0,blk_out();break;case"sep":set_page(),vskip(e.sk1),output+='<path class="stroke"\n\td="M',out_sxsy(e.x," ",0),output+="h"+e.l.toFixed(2)+'"/>\n',vskip(e.sk2);break;case"text":write_text(e.text,e.opt);break;case"title":write_title(e.text,!0);break;case"vskip":vskip(e.sk);break;default:error(2,e,"Block $1 not treated",e.subtype)}}function set_piece(){function e(e){var t=staff_tb[e],r=$.staves[e];t||(t=staff_tb[e]={}),t.y=0,t.stafflines=r.stafflines,t.staffscale=r.staffscale,t.ann_top=t.ann_bot=0}function t(){var e,t,r,n=$.staves.length;for(e=0;e<n;e++)if($.staves[e].flags&(OPEN_BRACE|OPEN_BRACE2)){for(r=0,t=e;e<n&&(r|=c[e]?1:2,!($.staves[e].flags&(CLOSE_BRACE|CLOSE_BRACE2)));)e++;if(3==r)for(;t<=e;)c[t]=!0,u[t++]=!0}}var r,n,a,i,o,s,l,c=[],u=[],$=cur_sy;for(nstaff=s=$.nstaff,i=0;i<=s;i++)e(i);for(r=tsfirst;r&&!r.nl;r=r.ts_next){switch(r.ts_next||(n=r),r.type){case C.STAVES:if(t(),$.st_print=new Uint8Array(c),$=r.sy,s=$.nstaff,nstaff<s){for(i=nstaff+1;i<=s;i++)e(i);nstaff=s}c=[];continue;case C.BLOCK:blocks.push(r),unlksym(r),n&&(n=r.ts_prev);continue}if(i=r.st,!c[i])switch(r.type){case C.CLEF:i>nstaff&&(staff_tb[i].clef=r,unlksym(r));break;case C.BAR:if(!$.staves[i].staffnonote||$.staves[i].staffnonote<=1)break;case C.GRACE:u[i]=c[i]=!0;break;case C.NOTE:case C.REST:case C.SPACE:case C.MREST:$.staves[i].staffnonote>1?u[i]=c[i]=!0:r.invis||0==$.staves[i].staffnonote&&r.type!=C.NOTE||(u[i]=c[i]=!0)}}for(tsnext=r,t(),$.st_print=new Uint8Array(c),function(){var e,t,r,n;for(e=0;e<=nstaff;e++)if(t=staff_tb[e],u[e]){for(n=t.stafflines.length,t.topbar=6*(n-1),r=0;r<n-1&&"."==t.stafflines[r];r++);t.botline=t.botbar=6*r,r>=n-2&&("."!=t.stafflines[r]?(t.botbar-=6,t.topbar+=6):(t.botbar-=12,t.topbar+=12))}else t.botbar=t.topbar=0}(),i=0;i<nstaff;i++)u[i]||sym_staff_move(i);if(u[nstaff]||(staff_tb[nstaff].topbar=0),init_music_line(),gene.st_print=new Uint8Array(u),tsnext)for(r=tsnext,delete r.nl,n=r.ts_prev,n.ts_next=null,l=voice_tb.length,o=0;o<l;o++){if(a=voice_tb[o],a.sym&&a.sym.time<=tsnext.time){for(r=tsnext.ts_prev;r;r=r.ts_prev)if(r.v==o){a.s_next=r.next,r.next=null,check_bar(r);break}if(r)continue}a.s_next=a.sym,a.sym=null}n.type!=C.BAR&&(r=add_end_bar(n),r.prev=r.ts_prev=n,n.ts_next=n.next=r,r.shrink=n.wr+2,r.space=set_space(r),r.space<r.shrink&&n.type!=C.KEY&&(r.space=r.shrink))}function set_sym_glue(e){var t,r,n,a,i=0,o=0,s=0,l=0,c=0;for(t=tsfirst;t;t=t.ts_next)t.type!=C.GRACE||n||(n=t),t.seqst&&(i+=t.shrink,t.space?t.space<t.shrink?(c+=t.shrink,o+=t.shrink):o+=t.space:l+=t.shrink);if(0==o)return void(realwidth=0);if(i>=e||o==c){for(i>e&&error(1,t,"Line too much shrunk $1 $2 $3",i.toFixed(2),o.toFixed(2),e.toFixed(2)),s=0,t=tsfirst;t;t=t.ts_next)t.seqst&&(s+=t.shrink),t.x=s;spf_last=0}else if(o+l>e*(1-cfmt.stretchlast)||tsnext&&0==blocks.length&&tsnext.type!=C.BLOCK&&cfmt.stretchstaff){for(var u=4;--u>=0;){for(a=(e-l-c)/(o-c),o=0,c=0,s=0,t=tsfirst;t;t=t.ts_next)t.seqst&&(t.space?t.space*a<=t.shrink?(c+=t.shrink,o+=t.shrink,s+=t.shrink):(o+=t.space,s+=t.space*a):s+=t.shrink),t.x=s;if(Math.abs(s-e)<.1)break}spf_last=a}else for(a=(e-l-c)/o,spf_last<a&&(a=spf_last),t=tsfirst;t;t=t.ts_next)t.seqst&&(s+=t.space*a<=t.shrink?t.shrink:t.space*a),t.x=s;for(realwidth=s,t=n;t;t=t.ts_next)if(t.type==C.GRACE)for(s=t.gr_shift?t.prev.x+t.prev.wr:t.x-t.wl,r=t.extra;r;r=r.next)r.x+=s}function set_sym_line(){var e,t,r,n=voice_tb.length;for(r=0;r<n;r++)e=voice_tb[r],t=e.s_next,e.sym=t,t&&(t.prev=null)}function set_posx(){posx=img.lm/cfmt.scale}function gen_init(){for(var e=tsfirst,t=e.time;e;e=e.ts_next){if(e.time!=t)return void set_page();switch(e.type){case C.NOTE:case C.REST:case C.MREST:return void set_page();default:continue;case C.STAVES:cur_sy=e.sy;break;case C.BLOCK:block_gen(e)}unlksym(e),e.p_v.s_next==e&&(e.p_v.s_next=e.next)}tsfirst=null}function output_music(){var e,t,r,n;if(gen_init(),tsfirst){for(set_global(),voice_tb.length>1&&set_stem_dir(),e=0;e<voice_tb.length;e++)set_beams(voice_tb[e].sym);for(set_stems(),voice_tb.length>1&&(set_rest_offset(),set_overlap()),set_acc_shft(),set_allsymwidth(null),r=set_indent(!0),cfmt.singleline?(e=get_ck_width(),t=r+e[0]+e[1]+get_width(tsfirst,null),img.width=t*cfmt.scale+img.lm+img.rm+2):(t=get_lwidth(),cut_tune(t,r)),spf_last=1.2;;){if(set_piece(),set_sym_glue(t-r),0!=realwidth)for(0!=r&&(posx+=r),draw_sym_near(),n=set_staff(),delayed_update(),draw_systems(r),draw_all_sym(),vskip(n),0!=r&&(posx-=r,insert_meter&=-3);0!=blocks.length;)block_gen(blocks.shift());if(tsfirst=tsnext,svg_flush(),!tsnext)break;if(gen_init(),!tsfirst)break;tsfirst.ts_prev=null,set_sym_line(),t=get_lwidth(),r=set_indent()}}}function reset_gen(){insert_meter=cfmt.writefields.indexOf("M")>=0?3:2}function set_ref(e){e.fname=parse.fname,e.istart=parse.istart,e.iend=parse.iend}function new_clef(e){var t={type:C.CLEF,clef_line:2,clef_type:"t",v:curvoice.v,p_v:curvoice,time:curvoice.time,dur:0},r=1;switch(set_ref(t),e[0]){case'"':r=e.indexOf('"',1),t.clef_name=e.slice(1,r),r++;break;case"a":if("u"==e[1]){t.clef_type="a",t.clef_auto=!0,r=4;break}r=4;case"C":t.clef_type="c",t.clef_line=3;break;case"b":r=4;case"F":t.clef_type="b",t.clef_line=4;break;case"n":r=4,t.invis=!0;break;case"t":if("e"==e[1]){t.clef_type="c",t.clef_line=4;break}r=6;case"G":break;case"p":r=4;case"P":t.clef_type="p",t.clef_line=3,curvoice.key.k_sf=0;break;default:return void syntax(1,"Unknown clef '$1'",e)}if(e[r]>="1"&&e[r]<="9"&&(t.clef_line=Number(e[r]),r++),"8"!=e[r+1])return t;switch(e[r]){case"^":t.clef_oct_transp=!0;case"+":t.clef_octave=7;break;case"_":t.clef_oct_transp=!0;case"-":t.clef_octave=-7}return t}function get_transp(e,t){var r,n,a,i,o=[];if("0"==e[0])return 0;if("123456789-+".indexOf(e[0])>=0){if(n=3*parseInt(e),isNaN(n)||n<-108||n>108)return void syntax(1,"Bad transpose value");switch(e.slice(-1)){default:return n;case"#":n++;break;case"b":n+=2}return n>0?n:n-3}if("instr"==t)if(a=e.indexOf("/"),cfmt.sound)e=a<0?"c"+e:e.replace(/.*\//,"c");else{if(a<0)return 0;e=e.replace("/","")}for(a=new scanBuf,a.buffer=e,r=0;r<2;r++){if(!(i=parse_acc_pit(a)))return void syntax(1,"Bad transpose value");i.pit+=124,n=12*(i.pit/7|0)+note_pit[i.pit%7],i.acc&&3!=i.acc&&(n+=i.acc),o[r]=n}if(cfmt.sound&&(o[0]=252),n=3*(o[1]-o[0]),i)switch(i.acc){default:return n;case 2:case 1:n++;break;case-1:case-2:n+=2}return n>0?n:n-3}function set_linebreak(e){var t,r;for(t=0;t<128;t++)"\n"==char_tb[t]&&(char_tb[t]=nil);for(e=e.split(/\s+/),t=0;t<e.length;t++){switch(r=e[t]){case"!":case"$":case"*":case";":case"?":case"@":break;case"<none>":continue;case"<EOL>":r="\n";break;default:syntax(1,"Bad value '$1' in %%linebreak - ignored",r);continue}char_tb[r.charCodeAt(0)]="\n"}}function set_user(e){var t,r,n,a=e.match(/(.*?)[= ]*([!"].*[!"])/);if(!a)return void syntax(1,'Lack of starting ! or " in U: / %%user');if(r=a[1],n=a[2],n.slice(-1)!=n[0])return void syntax(1,"Lack of ending $1 in U:/%%user",n[0]);if("\\"==r[0]&&("t"==r[1]?r="\t":r[1]||(r=" ")),(t=r.charCodeAt(0))>=128)return void syntax(1,errs.not_ascii);switch(char_tb[t][0]){case"0":case"d":case"i":case" ":break;case'"':case"!":if(char_tb[t].length>1)break;default:return void syntax(1,"Bad user character '$1'",r)}switch(n){case"!beambreak!":n=" ";break;case"!ignore!":n="i";break;case"!nil!":case"!none!":n="d"}char_tb[t]=n}function get_st_lines(e){var t,r;if(e){if(/^[\]\[|.-]+$/.test(e))return e.replace(/\]/g,"[");switch(t=parseInt(e)){case 0:return"...";case 1:return"..|";case 2:return".||";case 3:return".|||"}if(!(isNaN(t)||t<0||t>16)){for(r="|";--t>0;)r+="|";return r}}}function new_block(e){var t={type:C.BLOCK,subtype:e,dur:0};2==parse.state&&goto_tune();var r=curvoice;return curvoice=voice_tb[par_sy.top_voice],sym_link(t),curvoice=r,t}function set_vp(e){for(var t,r,n,a,i;;){if(!(r=e.shift()))break;if("="==r[r.length-1]&&0==e.length){syntax(1,errs.bad_val,r);break}switch(r){case"clef=":t=e.shift();break;case"clefpitch=":if((r=e.shift())&&(a=ntb.indexOf(r[0]))>=0){switch(r[1]){case"'":a+=7;break;case",":a-=7,","==r[2]&&(a-=7)}i=4-a;break}syntax(1,errs.bad_val,r);break;case"octave=":case"uscale=":a=parseInt(e.shift()),isNaN(a)?syntax(1,errs.bad_val,r):curvoice[r.slice(0,-1)]=a;break;case"cue=":curvoice.scale="on"==e.shift()?.7:1;break;case"instrument=":curvoice.transp=get_transp(e.shift(),"instr");break;case"map=":"play"!=cfmt.sound&&(curvoice.map=e.shift());break;case"name=":case"nm=":curvoice.nm=e.shift(),'"'==curvoice.nm[0]&&(curvoice.nm=curvoice.nm.slice(1,-1)),curvoice.new_name=!0;break;case"stem=":case"pos=":if(r="pos="==r?e.shift().split(" "):["stm",e.shift()],void 0==(a=posval[r[1]])){syntax(1,errs.bad_val,r[0]);break}n||(n={}),n[r[0]]=a;break;case"scale=":a=parseFloat(e.shift()),isNaN(a)||a<.6||a>1.5?syntax(1,errs.bad_val,"%%voicescale"):curvoice.scale=a;break;case"score=":if(cfmt.sound)break;r=e.shift(),r.indexOf("/")<0&&(r+="/c"),curvoice.transp=get_transp(r);break;case"shift=":curvoice.shift=get_transp(e.shift());break;case"sound=":case"transpose=":if(!cfmt.sound)break;curvoice.transp=get_transp(e.shift());break;case"subname=":case"sname=":case"snm=":curvoice.snm=e.shift(),'"'==curvoice.snm[0]&&(curvoice.snm=curvoice.snm.slice(1,-1));break;case"stafflines=":a=get_st_lines(e.shift()),void 0==a?syntax(1,"Bad %%stafflines value"):void 0!=curvoice.st?par_sy.staves[curvoice.st].stafflines=a:curvoice.stafflines=a;break;case"staffnonote=":a=parseInt(e.shift()),isNaN(a)?syntax(1,"Bad %%staffnonote value"):curvoice.staffnonote=a;break;case"staffscale=":a=parseFloat(e.shift()),isNaN(a)||a<.3||a>2?syntax(1,"Bad %%staffscale value"):curvoice.staffscale=a;break;default:switch(r.slice(0,4)){case"treb":case"bass":case"alto":case"teno":case"perc":t=r;break;default:"GFC".indexOf(r[0])>=0?t=r:"="==r.slice(-1)&&e.shift()}}}if(n){curvoice.pos=clone(curvoice.pos);for(r in n)n.hasOwnProperty(r)&&(curvoice.pos[r]=n[r])}t&&(t=new_clef(t))&&(i&&(t.clefpit=i),get_clef(t))}function set_kv_parm(e){curvoice.init||(curvoice.init=!0,info.V&&(info.V["*"]&&(e=info.V["*"].concat(e)),info.V[curvoice.id]&&(e=info.V[curvoice.id].concat(e)))),0!=e.length&&set_vp(e)}function memo_kv_parm(e,t){0!=t.length&&(info.V||(info.V={}),info.V[e]?Array.prototype.push.apply(info.V[e],t):info.V[e]=t)}function new_key(e){var t,r,n,a,i=0,o={type:C.KEY,k_delta:0,dur:0};switch(set_ref(o),t=1,e[0]){case"A":o.k_sf=3;break;case"B":o.k_sf=5;break;case"C":o.k_sf=0;break;case"D":o.k_sf=2;break;case"E":o.k_sf=4;break;case"F":o.k_sf=-1;break;case"G":o.k_sf=1;break;case"H":switch(e[1]){case"P":case"p":o.k_bagpipe=e[1],o.k_sf="P"==e[1]?0:2,t++;break;default:syntax(1,"Unknown bagpipe-like key")}break;case"P":o.k_drum=!0,r=!0;break;case"n":0==e.indexOf("none")&&(o.k_sf=0,o.k_none=!0,t=4);default:r=!0}if(!r){switch(e[t]){case"#":o.k_sf+=7,t++;break;case"b":o.k_sf-=7,t++}switch(e=e.slice(t).trim(),e.slice(0,3).toLowerCase()){default:if("m"!=e[0]||" "!=e[1]&&"\t"!=e[1]&&"\n"!=e[1]){r=!0;break}case"aeo":case"m":case"min":o.k_sf-=3,i=5;break;case"dor":o.k_sf-=2,i=1;break;case"ion":case"maj":break;case"loc":o.k_sf-=5,i=6;break;case"lyd":o.k_sf+=1,i=3;break;case"mix":o.k_sf-=1,i=4;break;case"phr":o.k_sf-=4,i=2}if(r||(e=e.replace(/\w+\s*/,"")),0==e.indexOf("exp ")&&(e=e.replace(/\w+\s*/,""),e||syntax(1,"No accidental after 'exp'"),o.k_exp=!0),"^"==(n=e[0])||"_"==n||"="==n){o.k_a_acc=[],a=new scanBuf,a.buffer=e;do{var s=parse_acc_pit(a);if(!s)return[o,null];for(o.k_a_acc.push(s),n=e[a.index];" "==n;)n=e[++a.index]}while("^"==n||"_"==n||"="==n);e=e.slice(a.index)}else o.k_exp&&0==e.indexOf("none")&&(o.k_sf=0,e=e.replace(/\w+\s*/,""))}return o.k_delta=cgd2cde[(o.k_sf+7)%7],o.k_mode=i,[o,info_split(e,0)]}function new_meter(e){var t,r,n,a,i,o,s={type:C.METER,dur:0,a_meter:[]},l={},c=0,u=0,$=e;if(set_ref(s),0==$.indexOf("none"))u=4,i=1;else for(i=0;u<e.length&&"="!=$[u];){switch($[u]){case"C":l.top=$[u++],"|"==$[u]&&(l.top+=$[u++]),c=4,n=4;break;case"c":case"o":c="c"==$[u]?4:3,n=4,l.top=$[u++],"."==$[u]&&(l.top+=$[u++]);break;case"(":for("("==$[u+1]&&(o=!0,l.top=$[u++],s.a_meter.push(l),l={}),a=u+1;a<e.length&&")"!=$[a]&&"/"!=$[a];)a++;if(")"==$[a]&&"/"==$[a+1]){u++;continue}case")":o="("==$[u],l.top=$[u++],s.a_meter.push(l),l={};continue;default:if($[u]<="0"||$[u]>"9")return void syntax(1,"Bad char '$1' in M:",$[u]);for(n=2,l.top=$[u++];;){for(;$[u]>="0"&&$[u]<="9";)l.top+=$[u++];if(")"==$[u]){if("/"!=$[u+1])break;u++}
if("/"==$[u]){if(u++,$[u]<="0"||$[u]>"9")return void syntax(1,"Bad char '$1' in M:",$[u]);for(l.bot=$[u++];$[u]>="0"&&$[u]<="9";)l.bot+=$[u++];break}if(" "!=$[u]&&"+"!=$[u])break;if(u>=e.length||"("==$[u+1])break;l.top+=$[u++]}c=parseInt(l.top)}for(o||(l.bot&&(n=parseInt(l.bot)),i+=c*C.BLEN/n),s.a_meter.push(l),l={};" "==$[u];)u++;"+"==$[u]&&(l.top=$[u++],s.a_meter.push(l),l={})}if("="==$[u]){if(!(t=$.substring(++u).match(/^(\d+)\/(\d+)$/)))return void syntax(1,"Bad duration '$1' in M:",$.substring(u));i=C.BLEN*t[1]/t[2]}if(s.wmeasure=i,3!=parse.state){if(info.M=e,glovar.meter=s,parse.state>=1)for(glovar.ulen||(i<=1||i>=3*C.BLEN/4?glovar.ulen=C.BLEN/8:glovar.ulen=C.BLEN/16),r=0;r<voice_tb.length;r++)voice_tb[r].meter=s,voice_tb[r].wmeasure=i}else curvoice.wmeasure=i,is_voice_sig()?(curvoice.meter=s,reset_gen()):sym_link(s)}function new_tempo(e){var t,r,n,a=0,i={type:C.TEMPO,dur:0};if(set_ref(i),cfmt.writefields.indexOf("Q")<0&&(i.del=!0),'"'==e[0]){if((a=e.indexOf('"',1))<0)return void syntax(1,"Unterminated string in Q:");for(i.tempo_str1=e.slice(1,a),a++;" "==e[a];)a++}for(n=new scanBuf,n.buffer=e,n.index=a;;){if(void 0==(t=e[n.index])||t<="0"||t>"9")break;for(r=parse_dur(n),i.tempo_notes||(i.tempo_notes=[]),i.tempo_notes.push(C.BLEN*r[0]/r[1]);;){if(" "!=(t=e[n.index]))break;n.index++}}if("="==t){for(t=e[++n.index];" "==t;)t=e[++n.index];for(a=n.index,"c"==t&&"a"==e[a+1]&&"."==e[a+2]&&" "==e[a+3]&&(i.tempo_ca="ca. ",n.index+=4),"/"!=e[n.index+1]?i.tempo=n.get_int():(r=parse_dur(n),i.new_beat=C.BLEN*r[0]/r[1]),t=e[n.index];" "==t;)t=e[++n.index]}if('"'==t){if(n.index++,(a=e.indexOf('"',n.index+1))<0)return void syntax(1,"Unterminated string in Q:");i.tempo_str2=e.slice(n.index,a)}if(3!=parse.state){if(1==parse.state)return info.Q=e,void(glovar.tempo=i);goto_tune()}curvoice.v==par_sy.top_voice&&(sym_link(i),glovar.tempo&&0==curvoice.time&&(glovar.tempo.del=!0))}function do_info(e,t){var r,n,a,i;switch(e){case"I":do_pscom(t);break;case"L":if(2==parse.state&&goto_tune(),i=t.match(/^1\/(\d+)(=(\d+)\/(\d+))?$/)){if(!(n=Number(i[1]))||0!=(n&n-1))break;if(n=C.BLEN/n,i[2]){if(!(a=Number(i[4]))||0!=(a&a-1)){a=0;break}a=Number(i[3])/a*C.BLEN}else a=n}else"auto"==t&&(n=a=-1);if(!a){syntax(1,"Bad L: value");break}parse.state<2?glovar.ulen=n:(curvoice.ulen=n,curvoice.dur_fact=a/n);break;case"M":new_meter(t);break;case"U":set_user(t);break;case"P":if(0==parse.state)break;if(1==parse.state){info.P=t;break}if(2==parse.state&&goto_tune(),cfmt.writefields.indexOf(e)<0)break;r={type:C.PART,text:t,dur:0};var o=voice_tb[par_sy.top_voice];if(curvoice.v!=o.v){if(curvoice.time!=o.time)break;if(o.last_sym&&o.last_sym.type==C.PART)break;var s=curvoice;curvoice=o,sym_link(r),curvoice=s}else sym_link(r);break;case"Q":if(0==parse.state)break;new_tempo(t);break;case"V":get_voice(t);break;case"K":if(0==parse.state)break;get_key(t);break;case"N":case"R":info[e]?info[e]+="\n"+t:info[e]=t;break;case"r":if(!user.keep_remark||3!=parse.state)break;r={type:C.REMARK,text:t,dur:0},sym_link(r);break;default:syntax(0,"'$1:' line ignored",e)}}function adjust_dur(e){var t,r,n,a,i;if((t=curvoice.last_sym)&&t.type!=C.MREST&&t.type!=C.BAR){for(;t.type!=C.BAR&&t.prev;)t=t.prev;if(r=t.time,n=curvoice.time-r,0==r){for(;t&&!t.dur;)t=t.next;t&&t.type==C.REST&&t.invis&&(r+=t.dur*curvoice.wmeasure/n,t.prev?t.prev.next=t.next:curvoice.sym=t.next,t.next&&(t.next.prev=t.prev),t=t.next)}if(curvoice.wmeasure!=n){for(;t;t=t.next)if(t.time=r,t.dur&&!t.grace&&(t.dur=t.dur*curvoice.wmeasure/n,t.dur_orig=t.dur_orig*curvoice.wmeasure/n,r+=t.dur,t.type==C.NOTE||t.type==C.REST)){for(a=0;a<=t.nhd;a++)t.notes[a].dur=t.notes[a].dur*curvoice.wmeasure/n;i=identify_note(t,t.dur_orig),t.head=i[0],t.dots=i[1],t.nflags=i[2],t.nflags<=-2?t.stemless=!0:delete t.stemless}curvoice.time=e.time=r}}}function new_bar(){var e,t,r,n=parse.line,a={type:C.BAR,fname:parse.fname,istart:parse.bol+n.index,dur:0,multi:0};for(vover&&vover.bar&&get_vover("|"),glovar.new_nbar&&(a.bar_num=glovar.new_nbar,glovar.new_nbar=0),r=n.char();;){switch(t=n.next_char()){case"|":case"[":case"]":case":":r+=t;continue}break}switch(":"==r[0]&&(1==r.length?(r="|",a.bar_dotted=!0):a.rbstop=2),a_gch&&gch_build(a),a_dcn&&(deco_cnv(a_dcn,a),a_dcn=null),r.slice(-1)){case"[":if(/[0-9" ]/.test(t))break;r=r.slice(0,-1),n.index--,t="[";break;case":":a.rbstop=2}if(t>"0"&&t<="9"){for("["==r.slice(-1)&&(r=r.slice(0,-1)),a.text=t;;){if(t=n.next_char(),"0123456789,.-".indexOf(t)<0)break;a.text+=t}a.rbstop=2,a.rbstart=2}else if('"'==t&&"["==r.slice(-1)){for(r=r.slice(0,-1),a.text="";;){if(!(t=n.next_char()))return void syntax(1,"No end of repeat string");if('"'==t){n.index++;break}"\\"==t&&(a.text+=t,t=n.next_char()),a.text+=t}a.text=cnv_escape(a.text),a.rbstop=2,a.rbstart=2}if("]"==r[0]&&(a.rbstop=2,1!=r.length?r=r.slice(1):a.invis=!0),a.iend=parse.bol+n.index,a.rbstart&&curvoice.norepbra&&!curvoice.second&&(a.norepbra=!0),curvoice.ulen<0&&adjust_dur(a),(e=curvoice.last_sym)&&e.type==C.SPACE)e.time--;else if(e&&e.type==C.BAR){if("["==r&&!e.text&&(0==curvoice.st||par_sy.staves[curvoice.st-1].flags&STOP_BAR||a.norepbra))return a.text&&(e.text=a.text),a.a_gch&&(e.a_gch=a.a_gch),a.norepbra&&(e.norepbra=a.norepbra),a.rbstart&&(e.rbstart=a.rbstart),void(a.rbstop&&(e.rbstop=a.rbstop));if("|:"==r){if(":|"==e.bar_type)return e.bar_type="::",void(e.rbstop=2);if("||"==e.bar_type)return e.bar_type="||:",void(e.rbstop=2)}}switch(r){case"[":a.rbstop=2;case"[]":case"[|]":a.invis=!0,r="[]";break;case":|:":case":||:":r="::";break;case"||":if(!cfmt.rbdbstop)break;case"[|":case"|]":a.rbstop=2}a.bar_type=r,curvoice.lyric_restart||(curvoice.lyric_restart=a),curvoice.sym_restart||(curvoice.sym_restart=a),!e||e.type!=C.KEY||e.prev&&e.prev.type==C.BAR?sym_link(a):(curvoice.last_sym=e.prev,e.prev||(curvoice.sym=e.prev),sym_link(a),a.next=e,e.prev=a,curvoice.last_sym=e),a.st=curvoice.st,a.rbstart&&!curvoice.norepbra&&curvoice.st>0&&!(par_sy.staves[curvoice.st-1].flags&STOP_BAR)&&(e={type:C.BAR,fname:a.fname,istart:a.istart,iend:a.iend,bar_type:"[",multi:0,invis:!0,text:a.text,rbstart:2},sym_link(e),e.st=curvoice.st,delete a.text,a.rbstart=0)}function parse_staves(e){for(var t,r=[],n=!1,a=0,i=0,o=0,s=0,l=0,c=0;c<e.length;){switch(e[c]){case" ":case"\t":break;case"[":if(s||i+o>=2){syntax(1,errs.misplaced,"["),n=!0;break}a|=i+o==0?OPEN_BRACKET:OPEN_BRACKET2,o++,l<<=8,l|=OPEN_BRACKET;break;case"{":if(s||i||o>=2){syntax(1,errs.misplaced,"{"),n=!0;break}a|=o?OPEN_BRACE2:OPEN_BRACE,i++,l<<=8,l|=OPEN_BRACE;break;case"(":if(s){syntax(1,errs.misplaced,"("),n=!0;break}a|=OPEN_PARENTH,s++,l<<=8,l|=OPEN_PARENTH;break;case"*":!i||s||a&(OPEN_BRACE|OPEN_BRACE2)||(a|=FL_VOICE);break;case"+":a|=MASTER_VOICE;break;default:if(!/\w/.test(e[c])){syntax(1,"Bad voice ID in %%staves"),n=!0;break}for(t="";c<e.length&&!(" \t()[]{}|*".indexOf(e[c])>=0);)t+=e[c++];for(;c<e.length;c++){switch(e[c]){case" ":case"\t":continue;case"]":if(!(l&OPEN_BRACKET)){syntax(1,errs.misplaced,"]"),n=!0;break}o--,a|=i+o==0?CLOSE_BRACKET:CLOSE_BRACKET2,l>>=8;continue;case"}":if(!(l&OPEN_BRACE)){syntax(1,errs.misplaced,"}"),n=!0;break}i--,a|=o?CLOSE_BRACE2:CLOSE_BRACE,a&=~FL_VOICE,l>>=8;continue;case")":if(!(l&OPEN_PARENTH)){syntax(1,errs.misplaced,")"),n=!0;break}s--,a|=CLOSE_PARENTH,l>>=8;continue;case"|":a|=STOP_BAR;continue}break}r.push([t,a]),a=0;continue}c++}if(0!=l&&(syntax(1,"'}', ')' or ']' missing in %%staves"),n=!0),!n&&0!=r.length)return r}function info_split(e){if(!e)return[];var t=e.match(/(".+?"|.+?)(\s+|=|$)/g);if(!t)return syntax(1,"Unterminated string"),[];for(var r=0;r<t.length;r++)t[r]=t[r].trim();return t}function identify_note(e,t){var r,n,a;for(t%12!=0&&syntax(1,"Invalid note duration $1",t),t/=12,0==t&&syntax(1,"Note too short"),a=5;0!=t&&!(1&t);t>>=1,a--);switch(t>>=1){case 0:n=0;break;case 1:n=1;break;case 3:n=2;break;default:n=3}if((a-=n)>=0)r=C.FULL;else switch(a){default:syntax(1,"Note too long"),a=-4;case-4:r=C.SQUARE;break;case-3:r=cfmt.squarebreve?C.SQUARE:C.OVALBARS;break;case-2:r=C.OVAL;break;case-1:r=C.EMPTY}return[r,n,a]}function parse_dur(e){var t,r,n;return reg_dur.lastIndex=e.index,t=reg_dur.exec(e.buffer),t[0]?(r=t[1]||1,n=t[3]||1,t[3]||(n*=1<<t[2].length),e.index=reg_dur.lastIndex,[r,n]):[1,1]}function parse_acc_pit(e){var t,r,n,a,i,o,s=e.char();switch(s){case"^":s=e.next_char(),"^"==s?(r=2,s=e.next_char()):r=1;break;case"=":r=3,s=e.next_char();break;case"_":s=e.next_char(),"_"==s?(r=-2,s=e.next_char()):r=-1}if((r&&3!=r&&s>="1"&&s<="9"||"/"==s)&&(o=parse_dur(e),n=o[0],a=o[1],1==a?a=curvoice?curvoice.uscale:1:a*=2,s=e.char()),i=ntb.indexOf(s)+16,s=e.next_char(),i<16)return void syntax(1,"'$1' is not a note",e.buffer[e.index-1]);for(;"'"==s;)i+=7,s=e.next_char();for(;","==s;)i-=7,s=e.next_char();return t={pit:i,apit:i,shhd:0,shac:0,ti1:0},r&&(t.acc=r,n&&(t.micro_n=n,t.micro_d=a)),t}function set_map(e){var t,r,n,a,i=maps[curvoice.map];for(t="abcdefg"[(e.pit+77)%7],r=e.acc?["__","_","","^","^^","="][e.acc+2]:"",n=r+t,a=e.pit;a>=28;a-=7)n+="'";for(a=e.pit;a<21;a+=7)n+=",";(i[n]||(n="octave,"+r+t,i[n]||(n="key,"+"abcdefg"[(e.pit+77-curvoice.ckey.k_delta)%7],i[n]||(n="all",i[n]))))&&(e.map=i[n],e.map[1]&&(e.apit=e.pit=e.map[1].pit,e.acc=e.map[1].acc))}function parse_basic_note(e,t){var r,n=parse_acc_pit(e);if(n)return"0"==e.char()&&(parse.stemless=!0,e.index++),r=parse_dur(e),n.dur=t*r[0]/r[1],n}function parse_vpos(){var e=parse.line,t=0;switch("."!=e.buffer[e.index-1]||a_dcn||(t=C.SL_DOTTED),e.next_char()){case"'":return e.index++,t+C.SL_ABOVE;case",":return e.index++,t+C.SL_BELOW}return t+C.SL_AUTO}function note_transp(e){var t,r,n,a,i,o,s,l,c,u,$=e.nhd,f=curvoice.okey.k_sf,p=curvoice.ckey.k_sf-f,d=cgd2cde[(p+28)%7],h=curvoice.vtransp;for(h<0&&0!=d&&(d-=7),d+=7*(h/3/12|0),t=0;t<=$;t++){if(u=e.notes[t],n=u.pit,u.pit+=d,u.apit=u.pit,s=cde2fcg[(n+5+112)%7],!(i=u.acc))if(curvoice.okey.a_acc){for(r=0;r<curvoice.okey.a_acc.length;r++)if(o=curvoice.okey.a_acc[r],(n+112-o.pit)%7==0){i=o.acc;break}}else f>0?s<f-1&&(i=1):f<0&&s>=f+6&&(i=-1);if(l=s+p,i&&3!=i&&(l+=7*i),s=(2+((l+1+21)/7|0)-3+160)%5,i=acc2[s],u.acc);else if(curvoice.ckey.k_none){if(3==i||acc_same_pitch(u.pit))continue}else{if(!curvoice.ckey.a_acc)continue;for(c=cgd2cde[(l+112)%7],r=0;r<curvoice.ckey.a_acc.length&&(c+112-curvoice.ckey.a_acc[r].pits)%7!=0;r++);if(r<curvoice.ckey.a_acc.length)continue}if(s=u.acc,(a=u.micro_d)&&s!=i)switch(n=u.micro_n,i){case 3:n>a/2?(n-=a/2,u.micro_n=n,i=s):i=-s;break;case 2:n>a/2?(u.pit+=1,u.apit=u.pit,n-=a/2):n+=a/2,i=s,u.micro_n=n;break;case-2:n>=a/2?(u.pit-=1,u.apit=u.pit,n-=a/2):n+=a/2,i=s,u.micro_n=n}u.acc=i}}function sort_pitch(e){e.notes=e.notes.sort(function(e,t){return e.pit-t.pit})}function new_note(e,t){var r,n,a,i,o,s,l,c,u,$,f,p,d,h=0,_=parse.line,g=a_dcn;switch(a_dcn=null,parse.stemless=!1,n={type:C.NOTE,fname:parse.fname,stem:0,multi:0,nhd:0,xmx:0},n.istart=parse.bol+_.index,curvoice.color&&(n.color=curvoice.color),e?n.grace=!0:(a_gch&&gch_build(n),parse.repeat_n&&(n.repeat_n=parse.repeat_n,n.repeat_k=parse.repeat_k,parse.repeat_n=0)),i=_.char()){case"X":n.invis=!0;case"Z":if(n.type=C.MREST,i=_.next_char(),n.nmes=i>"0"&&i<="9"?_.get_int():1,n.dur=curvoice.wmeasure*n.nmes,curvoice.second)return void(curvoice.time+=n.dur);break;case"y":n.type=C.SPACE,n.invis=!0,n.dur=0,i=_.next_char(),n.width=i>="0"&&i<="9"?_.get_int():10;break;case"x":n.invis=!0;case"z":n.type=C.REST,_.index++,$=parse_dur(_),n.dur_orig=(curvoice.ulen<0?15120:curvoice.ulen)*$[0]/$[1],n.dur=n.dur_orig*curvoice.dur_fact,n.notes=[{pit:18,dur:n.dur_orig}];break;case"[":a=!0,i=_.next_char();default:for(curvoice.uscale&&(n.uscale=curvoice.uscale),n.notes=[];;){if(a)for(;;){if(!i)break;if((l=i.charCodeAt(0))>=128)return void syntax(1,errs.not_ascii);switch(s=char_tb[l],s[0]){case"(":h<<=4,h+=parse_vpos(),i=_.char();continue;case"!":if(a_dcn||(a_dcn=[]),s.length>1)a_dcn.push(s.slice(1,-1));else{for(o="";;){if(!(i=_.next_char()))return void syntax(1,"No end of decoration");if("!"==i)break;o+=i}a_dcn.push(o)}i=_.next_char();continue}break}if(!(r=parse_basic_note(_,n.grace?C.BLEN/4:curvoice.ulen<0?15120:curvoice.ulen)))return;if(curvoice.octave&&(r.apit=r.pit+=7*curvoice.octave),curvoice.ottava&&(r.pit+=curvoice.ottava),h&&(r.sl1=h,n.sl1?n.sl1++:n.sl1=1,h=0),a_dcn&&(r.a_dcn=a_dcn,a_dcn=null),n.notes.push(r),!a)break;for(i=_.char();;){switch(i){case")":r.sl2?r.sl2++:r.sl2=1,n.sl2?n.sl2++:n.sl2=1,i=_.next_char();continue;case"-":r.ti1=parse_vpos(),n.ti1=!0,i=_.char();continue;case".":if("-"!=(i=_.next_char())){syntax(1,"Misplaced dot");break}continue}break}if("]"==i){for(_.index++,$=parse_dur(_),n.nhd=n.notes.length-1,l=0;l<=n.nhd;l++)r=n.notes[l],r.dur=r.dur*$[0]/$[1];break}}n.dur_orig=n.notes[0].dur,n.dur=n.notes[0].dur*curvoice.dur_fact}if(n.grace&&n.type!=C.NOTE)return void syntax(1,"Not a note in grace note sequence");if(n.notes){if(n.grace){var m=curvoice.key.k_bagpipe?8:4;for(l=0;l<=n.nhd;l++)n.notes[l].dur/=m;n.dur/=m,n.dur_orig/=m,e.stem&&(n.stem=e.stem)}else{switch(curvoice.pos.stm){case C.SL_ABOVE:n.stem=1;break;case C.SL_BELOW:n.stem=-1;break;case C.SL_HIDDEN:n.stemless=!0}if(n.dur*=t,p=curvoice.brk_rhythm){if(curvoice.brk_rhythm=0,u=curvoice.last_note,p>0){for(c=2*p-1,n.dur=n.dur*c/p,n.dur_orig=n.dur_orig*c/p,l=0;l<=n.nhd;l++)n.notes[l].dur=n.notes[l].dur*c/p;for(u.dur/=p,u.dur_orig/=p,l=0;l<=u.nhd;l++)u.notes[l].dur/=p}else{for(p=-p,c=2*p-1,n.dur/=p,n.dur_orig/=p,l=0;l<=n.nhd;l++)n.notes[l].dur/=p;for(u.dur=u.dur*c/p,u.dur_orig=u.dur_orig*c/p,l=0;l<=u.nhd;l++)u.notes[l].dur=u.notes[l].dur*c/p}for(curvoice.time=u.time+u.dur,f=identify_note(u,u.dur_orig),u.head=f[0],u.dots=f[1],u.nflags=f[2],u.nflags<=-2?u.stemless=!0:delete u.stemless,u=u.next;u;u=u.next)u.time=curvoice.time}}n.type==C.NOTE?(f=identify_note(n,n.dur_orig),n.head=f[0],n.dots=f[1],n.nflags=f[2],n.nflags<=-2&&(n.stemless=!0)):(d=n.dur_orig,d==curvoice.wmeasure&&(d=d<2*C.BLEN?C.BLEN:d<4*C.BLEN?2*C.BLEN:4*C.BLEN),f=identify_note(n,d),n.head=f[0],n.dots=f[1],n.nflags=f[2]),curvoice.last_note=n}if(sym_link(n),n.type==C.NOTE&&(curvoice.vtransp&&note_transp(n),curvoice.map&&maps[curvoice.map]))for(l=0;l<=n.nhd;l++)set_map(n.notes[l]);return cfmt.shiftunison&&(n.shiftunison=cfmt.shiftunison),e||(curvoice.lyric_restart||(curvoice.lyric_restart=n),curvoice.sym_restart||(curvoice.sym_restart=n)),g&&deco_cnv(g,n,n.prev),parse.stemless&&(n.stemless=!0),n.iend=parse.bol+_.index,n}function parse_music_line(){function e(e){var t,r,n;for(t=1,r=h.index+1;t<e.length;t++,r++)if(e[t]!=h.buffer[r]){if("n"!=e[t])return;if((n=ntb.indexOf(h.buffer[r]))<0)return;for(;"'"==h.buffer[r+1];)n+=7,r++;for(;","==h.buffer[r+1];)n-=7,r++}return h.index=r,n}function t(e,t){var r,n,a="",o=e.length;for(i=0;i<o;i++)if((r=e[i])>="h"&&r<="z"){for(n=t+r.charCodeAt(0)-"n".charCodeAt(0),r="";n<0;)n+=7,r+=",";for(;n>14;)n-=7,r+="'";a+=ntb[n]+r}else a+=r;return a}function r(e,r){var a=h,i=parse.istart;parse.line=h=new scanBuf,parse.istart+=a.index,h.buffer=r?t(e,r):e,n(!0),parse.line=h=a,parse.istart=i}function n(t){for(var n,i,c,_,g,m,y,v,b;;){if(!(n=h.char()))break;if("."==n)switch(h.buffer[h.index+1]){case"(":case"-":case"|":n=h.next_char()}if((i=n.charCodeAt(0))>=128){syntax(1,errs.not_ascii),h.index++;break}if(!t&&maci[i]){v=0;for(_ in mac)if(mac.hasOwnProperty(_)&&_[0]==n){if(_.indexOf("n")<0){if(h.buffer.indexOf(_,h.index)!=h.index)continue;h.index+=_.length}else if(!(v=e(_)))continue;r(mac[_],v),v=1;break}if(v)continue}switch(c=char_tb[i],c[0]){case" ":g=curvoice.last_note,g&&(g.beam_end=!0,a&&(a.gr_shift=!0));break;case"\n":if(cfmt.barsperstaff)break;0==par_sy.voices[curvoice.v].range&&curvoice.last_sym&&(curvoice.last_sym.eoln=!0);break;case"&":if(a){syntax(1,errs.bad_char,n);break}if(")"==(n=h.next_char())){get_vover(")");break}get_vover("&");continue;case"(":if((n=h.next_char())>"0"&&n<="9"){var x=h.get_int(),w=qplet_tb[x],A=x,n=h.char();if(":"==n&&(n=h.next_char(),n>"0"&&n<="9"&&(w=h.get_int(),n=h.char()),":"==n)){if(!((n=h.next_char())>"0"&&n<="9")){syntax(1,"Invalid 'r' in tuplet");continue}A=h.get_int(),n=h.char()}0!=w&&void 0!=w||(w=curvoice.wmeasure%9==0?3:2),u=$[++f],u||($[f]=u={}),u.p=x,u.q=w,u.r=A,u.f=cfmt.tuplets,u.fact=p*w/x,p=u.fact;continue}if("&"==n){if(a){syntax(1,errs.bad_char,n);break}get_vover("(");break}d<<=4,h.index--,d+=parse_vpos();continue;case")":if(curvoice.ignore)break;if(g=curvoice.last_sym)switch(g.type){case C.NOTE:case C.REST:case C.SPACE:break;default:g=null}if(!g){syntax(1,errs.bad_char,n);break}g.slur_end?g.slur_end++:g.slur_end=1;break;case"!":if(a_dcn||(a_dcn=[]),c.length>1)m=c.slice(1,-1);else{for(m="",y=h.index;;){if(!(n=h.next_char()))break;if("!"==n)break;m+=n}if(!n){h.index=y,syntax(1,"No end of decoration");break}}ottava[m]&&set_ottava(m),a_dcn.push(m);break;case'"':parse_gchord(c);break;case"-":var k=0;if(!curvoice.last_note||curvoice.last_note.type!=C.NOTE){syntax(1,"No note before '-'");break}for(k=parse_vpos(),g=curvoice.last_note,y=0;y<=g.nhd;y++)g.notes[y].ti1?0==g.nhd&&syntax(1,"Too many ties"):g.notes[y].ti1=k;g.ti1=!0,a&&(a.ti1=!0);continue;case"[":var E=h.buffer[h.index+1];if('|[]: "'.indexOf(E)>=0||E>="1"&&E<="9"){if(a){syntax(1,errs.bar_grace);break}new_bar();continue}if(":"==h.buffer[h.index+2]){if((y=h.buffer.indexOf("]",h.index+1))<0){syntax(1,"Lack of ']'");break}b=h.buffer.slice(h.index+3,y).trim(),parse.istart=parse.bol+h.index,parse.iend=parse.bol+ ++y,h.index=0,do_info(E,b),h.index=y;continue}case"n":if(!(g=new_note(a,p)))continue;if(g.type==C.NOTE&&d&&(g.slur_start=d,d=0),a){f>=0&&(g.in_tuplet=!0);continue}f>=0&&g.notes&&(g.in_tuplet=!0,f>0?($[0].p&&(g.tp0=$[0].p,g.tq0=$[0].q,g.tf=$[0].f,$[0].p=0),$[0].r--,u.p&&(g.tp1=u.p,g.tq1=u.q,g.tf=u.f,u.p=0)):u.p&&(g.tp0=u.p,g.tq0=u.q,g.tf=u.f,u.p=0),0==--u.r&&(0==f--?(g.te0=!0,p=1,curvoice.time=Math.round(curvoice.time),g.dur=curvoice.time-g.time):(g.te1=!0,u=$[0],0==u.r?(f--,g.te0=!0,p=1,curvoice.time=Math.round(curvoice.time),g.dur=curvoice.time-g.time):p=u.fact)));continue;case"<":if(!curvoice.last_note){syntax(1,"No note before '<'");break}if(a){syntax(1,"Cannot have a broken rhythm in grace notes");break}for(v="<"==n?1:-1;"<"==n||">"==n;)v*=2,n=h.next_char();curvoice.brk_rhythm=v;continue;case"i":break;case"{":if(a){syntax(1,"'{' in grace note");break}switch(o=curvoice.last_note,curvoice.last_note=null,s=a_dcn,a_dcn=void 0,a={type:C.GRACE,fname:parse.fname,istart:parse.bol+h.index,dur:0,multi:0},curvoice.pos.gst){case C.SL_ABOVE:a.stem=1;break;case C.SL_BELOW:a.stem=-1;break;case C.SL_HIDDEN:a.stem=2}if(sym_link(a),"/"==(n=h.next_char())){a.sappo=!0;break}continue;case"|":if(a){syntax(1,errs.bar_grace);break}n=h.buffer[h.index-1],new_bar(),"."==n&&(curvoice.last_sym.bar_dotted=!0);continue;case"}":if(g=curvoice.last_note,!a||!g){syntax(1,errs.bad_char,n);break}if(a_dcn&&syntax(1,"Decoration ignored"),g.gr_end=!0,a.extra=a.next,a.extra.prev=null,a.next=null,curvoice.last_sym=a,a=null,!g.prev&&!curvoice.key.k_bagpipe){for(y=0;y<=g.nhd;y++)g.notes[y].dur*=2;g.dur*=2,g.dur_orig*=2;var S=identify_note(g,g.dur_orig);g.head=S[0],g.dots=S[1],g.nflags=S[2]}curvoice.last_note=o,a_dcn=s;break;case"\\":if(!(n=h.buffer[h.index+1])){l=!0;break}default:syntax(1,errs.bad_char,n)}h.index++}}var a,o,s,l,c,u,$=[],f=-1,p=1,d=0,h=parse.line;if(3!=parse.state){if(2!=parse.state)return;goto_tune()}if(n(),f>=0)for(syntax(1,"No end of tuplet"),c=curvoice.last_note;c;c=c.prev)if(c.tp1&&(c.tp1=0),c.tp0){c.tp0=0;break}a&&(syntax(1,"No end of grace note sequence"),curvoice.last_sym=a.prev,curvoice.last_note=o,a.prev&&(a.prev.next=null)),cfmt.breakoneoln&&curvoice.last_note&&(curvoice.last_note.beam_end=!0),l||cfmt.barsperstaff||"\n"==char_tb["\n".charCodeAt(0)]&&0==par_sy.voices[curvoice.v].range&&curvoice.last_sym&&(curvoice.last_sym.eoln=!0)}function cwid(e){var t=e.charCodeAt(0);if(t>=128){if(t>=768&&t<880)return 0;t=97}return cw_tb[t]}function strwh(e){var t,r,n,a=gene.curfont,i=a.swfac,o=a.size,s=0,l=e.length;for(t=0;t<l;t++){switch(n=e[t]){case"$":if("0"==(n=e[t+1]))a=gene.deffont;else{if(!(n>="1"&&n<="9")){n="$";break}a=get_font("u"+n)}t++,i=a.swfac,a.size>o&&(o=a.size);continue;case"&":r=e.indexOf(";",t),r>0&&r-t<10&&(t=r,n="a")}s+=cwid(n)*i}return gene.curfont=a,[s,o]}function set_font(e){"string"==typeof e&&(e=get_font(e)),gene.curfont=gene.deffont=e}function out_str(e){var t,r=gene.curfont,n=r;output+=e.replace(/<|>|&.*?;|&|  |\$./g,function(e){switch(e[0]){case"<":return"&lt;";case">":return"&gt;";case"&":return"&"==e?"&amp;":e;case" ":return" ";case"$":if("0"==e[1])t=gene.deffont,use_font(t);else{if(!(e[1]>="1"&&e[1]<="9"))return e;t=get_font("u"+e[1])}return e="",t==n?e:(n!=r&&(e="</tspan>"),n=t,n==r?e:e+'<tspan\n\tclass="'+font_class(t)+'">')}}),n!=r&&(output+="</tspan>",gene.curfont=n)}function xy_str(e,t,r,n,a){switch(t+=.2*strwh(r)[1],output+='<text class="'+font_class(gene.curfont)+'" x="',out_sxsy(e,'" y="',t),n){case"c":output+='" text-anchor="middle">';break;case"j":output+='" textLength="'+a.toFixed(2)+'">';break;case"r":output+='" text-anchor="end">';break;default:output+='">'}out_str(r),output+="</text>\n"}function xy_str_b(e,t,r){var n=strwh(r);output+='<rect class="stroke" x="',out_sxsy(e-2,'" y="',t+n[1]+1),output+='" width="'+(n[0]+4).toFixed(2)+'" height="'+(n[1]+3).toFixed(2)+'"/>\n',xy_str(e,t,r)}function trim_title(e,t){var r;return cfmt.titletrim&&(r=e.lastIndexOf(", "),r<0||e[r+2]<"A"||e[r+2]>"Z"?r=0:1==cfmt.titletrim?(r<e.length-7||e.indexOf(" ",r+3)>=0)&&(r=0):r<e.length-cfmt.titletrim-2&&(r=0)),!t&&cfmt.writefields.indexOf("X")>=0&&(e=info.X+".  "+e),r&&(e=e.slice(r+2).trim()+" "+e.slice(0,r)),cfmt.titlecaps?e.toUpperCase():e}function get_lwidth(){return(img.width-img.lm-img.rm-2)/cfmt.scale}function write_title(e,t){var r;e&&(set_page(),e=trim_title(e,t),t?(set_font("subtitle"),r=cfmt.subtitlespace):(set_font("title"),r=cfmt.titlespace),vskip(strwh(e)[1]+r),cfmt.titleleft?xy_str(0,0,e):xy_str(get_lwidth()/2,0,e,"c"))}function put_inf2r(e,t,r,n,a){if(!r){if(!n)return;r=n,n=null}n?xy_str(e,t,r+" ("+n+")",a):xy_str(e,t,r,a)}function str_skip(e){vskip(strwh(e)[1]*cfmt.lineskipfac)}function write_text(e,t){if("s"!=t){set_font("text"),set_page();var r,n,a,i,o,s,l,c,u=get_lwidth(),$=gene.curfont.size,f=$*cfmt.lineskipfac,p=$*cfmt.parskipfac,d=block.started?function(){}:blk_out,h=block.started?svg_flush:blk_flush;switch(d(),t){default:switch(t){case"c":a=u/2;break;case"r":a=u;break;default:a=0}for(n=0;;){if((r=e.indexOf("\n",n))<0){c=e.slice(n),str_skip(c),xy_str(a,0,c,t);break}if(r==n){for(vskip(p),h(),use_font(gene.curfont);"\n"==e[r+1];)vskip(f),r++;if(r==e.length)break;d()}else c=e.slice(n,r),str_skip(c),xy_str(a,0,c,t);n=r+1}vskip(p),h();break;case"f":case"j":for(n=0;;){for(r=e.indexOf("\n\n",n),i=r<0?e.slice(n):e.slice(n,r),i=i.split(/\s+/),o=s=0,n=0;n<i.length;n++)l=strwh(i[n]+" ")[0],(o+=l)>=u&&(c=i.slice(s,n).join(" "),str_skip(c),xy_str(0,0,c,t,u),s=n,o=l);if(0!=o&&(c=i.slice(s).join(" "),str_skip(c),xy_str(0,0,c)),vskip(p),h(),r<0)break;for(;"\n"==e[r+2];)vskip(f),r++;if(r==e.length)break;d(),use_font(gene.curfont),n=r+2}}}}function put_words(e){function t(e,t,r){var n,a,i=0;if("$"==e[i]&&e[i+1]>="0"&&e[i+1]<="9"&&(i+=2),a=0,n=i,e[i]>="0"&&e[i]<="9"||"."==e[i+1]){for(;i<e.length&&(i++," "!=e[i]&&":"!=e[i-1]&&"."!=e[i-1]););for(a=i;" "==e[i];)i++}return 0!=a&&xy_str(t,0,e.slice(n,a),"r"),i<e.length&&xy_str(t+5,0,e.slice(i),"l"),i>=e.length&&0==a}var r,n,a,i,o,s,l,c;blk_out(),set_font("words");var u=get_lwidth()/2,$=(u-45)/(cwid("a")*gene.curfont.swfac);for(i=0,e=e.split("\n"),o=e.length,n=0;n<o;n++){if(r=e[n],r.length>$){i=0;break}r?c=!0:c&&(i++,c=!1)}if(i>0){for(n=i=(i+1)/2|0,c=!1,l=0;l<o;l++){for(r=e[l],a=0;" "==r[a];)a++;if(a==r.length){if(c&&--n<=0)break;c=!1}else c=!0}s=l+1}else s=l=o;for(vskip(cfmt.wordsspace),n=0;n<l||s<o;n++)n<l&&0==e[n].length&&(blk_out(),use_font(gene.curfont)),vskip(cfmt.lineskipfac*gene.curfont.size),n<l&&t(e[n],45,0),s<o&&(t(e[s],20+u,1)&&0==--i&&(n<l?i++:s<e.length-1&&(u*=.6)),s++)}function put_history(){var e,t,r,n,a,i,o,s,l=cfmt.infoname.split("\n"),c=l.length;for(e=0;e<c;e++)if(r=l[e][0],!(cfmt.writefields.indexOf(r)<0)&&(n=info[r])){for(a||(a=!0,set_font("history"),vskip(cfmt.textspace),i=gene.curfont.size*cfmt.lineskipfac),s=l[e].slice(2),'"'==s[0]&&(s=s.slice(1,-1)),vskip(i),xy_str(0,0,s),o=strwh(s)[0],n=n.split("\n"),xy_str(o,0,n[0]),t=1;t<n.length;t++)vskip(i),xy_str(o,0,n[t]);vskip(.3*i),blk_out(),use_font(gene.curfont)}}function write_headform(e){for(var t,r,n,a,i,o,s,l={},c=clone(info_font_init),u={A:cfmt.infospace,C:cfmt.composerspace,O:cfmt.composerspace,R:cfmt.infospace},$={},f="",p=cfmt.titleformat,d=0,h=0;;){for(;" "==p[h];)h++;if(h>=p.length)break;if((t=p[h++])<"A"||t>"Z")if("+"==t){if(0==f.length||"+"==f.slice(-1))continue;f=f.slice(0,-1)+"+"}else","==t&&("+"==f.slice(-1)&&(f=f.slice(0,-1)+"l"),f+="\n");else{if(l[t])$[t]++;else{if(!info[t])continue;l[t]=info[t].split("\n"),$[t]=1}switch(f+=t,p[h]){case"-":f+="l",h++;break;case"0":f+="c",h++;break;case"1":f+="r",h++;break;default:f+="c"}}}"+"==f.slice(-1)&&(f=f.slice(0,-1)+"l"),f+="\n";var _,g={l:cfmt.titlespace,c:cfmt.titlespace,r:cfmt.titlespace},m={l:0,c:.5*e,r:e},y={};for(p=f,h=0;;){for(y.l=y.c=y.r=o=0,d=h;;){if("\n"==(t=p[d++]))break;if("+"==(a=p[d++]))a=p[d+1];else if(0!=y[a])continue;_=l[t],_&&(n=c[t],n||(n="history"),r=get_font(n),s=1.1*r.size,u[t]&&(s+=u[t]),o<s&&(o=s),y[a]=s)}for(g.l+=o-y.l,g.c+=o-y.c,g.r+=o-y.r;;){if("\n"==(t=p[h++]))break;if(a=p[h++],0!=l[t].length){if(_=l[t].shift(),"+"==a&&($[t]--,t=p[h++],a=p[h++],l[t].length>0&&(_?_+=" "+l[t].shift():_=" "+l[t].shift())),n=c[t],n||(n="history"),r=get_font(n),s=1.1*r.size,u[t]&&(s+=u[t]),set_font(r),i=m[a],o=g[a]+s,"Q"==t){if(!glovar.tempo.del){if("l"!=a){var v=tempo_width(glovar.tempo);"c"==a&&(v*=.5),i-=v}write_tempo(glovar.tempo,i,-o)}}else _&&xy_str(i,-o,_,a);if("T"==t&&(n=c.T="subtitle",u.T=cfmt.subtitlespace),$[t]<=1)for("T"==t&&(r=get_font(n),s=1.1*r.size,u[t]&&(s+=u[t]),set_font(r));l[t].length>0;)o+=s,_=l[t].shift(),xy_str(i,-o,_,a);$[t]--,g[a]=o}}if(g.c>g.l&&(g.l=g.c),g.r>g.l&&(g.l=g.r),h>=f.length)break;g.c=g.r=g.l}vskip(g.l)}function write_heading(){var e,t,r,n,a,i,o,s,l=get_lwidth();if(blk_out(),vskip(cfmt.topspace),cfmt.titleformat)return write_headform(l),void vskip(cfmt.musicspace);if(info.T&&cfmt.writefields.indexOf("T")>=0)for(e=0;;){if((t=info.T.indexOf("\n",e))<0){write_title(info.T.substring(e),0!=e);break}write_title(info.T.slice(e,t),0!=e),e=t+1}if(set_font("composer"),o=s=0,parse.ckey.k_bagpipe&&!cfmt.infoline&&cfmt.writefields.indexOf("R")>=0&&(i=info.R),i&&(xy_str(0,-cfmt.composerspace,i),o=cfmt.composerspace),r=info.A,cfmt.writefields.indexOf("C")>=0&&(n=info.C),cfmt.writefields.indexOf("O")>=0&&(a=info.O),n||a||cfmt.infoline){var c,u;if(vskip(cfmt.composerspace),cfmt.aligncomposer<0?(c=0,u=" "):0==cfmt.aligncomposer?(c=.5*l,u="c"):(c=l,u="r"),s=o,n||a){for(cfmt.aligncomposer>=0&&o!=s&&vskip(o-s),e=0;;){if(vskip(gene.curfont.size),(t=n?n.indexOf("\n",e):-1)<0){put_inf2r(c,0,n?n.substring(e):null,a,u);break}xy_str(c,0,n.slice(e,t),u),o+=gene.curfont.size,e=t+1}s>o&&vskip(s-o)}i=i?null:info.R,(i||r)&&cfmt.infoline&&(set_font("info"),vskip(gene.curfont.size+cfmt.infospace),put_inf2r(l,0,i,r,"r"),o+=gene.curfont.size+cfmt.infospace)}else s=cfmt.composerspace;info.P&&cfmt.writefields.indexOf("P")>=0&&(set_font("parts"),o=cfmt.partsspace+gene.curfont.size-o,o>0&&(s+=o),s>.01&&vskip(s),xy_str(0,0,info.P),s=0),vskip(s+cfmt.musicspace)}function def_use(e){var t,r,n;if(!defined_glyph[e]){if(defined_glyph[e]=!0,!(n=glyphs[e]))return void error(1,null,"Unknown glyph: '$1'",e);for(r=0;;){if((t=n.indexOf('xlink:href="#',r))<0)break;t+=13,r=n.indexOf('"',t),def_use(n.slice(t,r))}defs+="\n"+n}}function defs_add(e){var t,r,n,a,i,o=0;for(e=e.replace(/<!--.*?-->/g,"");;){if((i=e.indexOf("<",o))<0)break;if((t=e.indexOf('id="',i))<0)break;if(t+=4,(r=e.indexOf('"',t))<0)break;if(n=e.slice(t,r),(o=e.indexOf(">",r))<0)break;if("/"==e[o-1])o++;else{if((t=e.indexOf(" ",i))<0)break;if(a=e.slice(i+1,t),(o=e.indexOf("</"+a+">",o))<0)break;o+=3+a.length}"<filter"==e.substr(i,7)?fulldefs+="\n"+e.slice(i,o):glyphs[n]=e.slice(i,o)}}function set_g(){stv_g.started&&(stv_g.started=!1,output+="</g>\n"),(1!=stv_g.scale||stv_g.color)&&(output+="<g ",1!=stv_g.scale&&(stv_g.st>=0?output+=staff_tb[stv_g.st].scale_str:output+=voice_tb[stv_g.v].scale_str),stv_g.color&&(1!=stv_g.scale&&(output+=" "),output+='style="color:'+stv_g.color+'"'),output+=">\n",stv_g.started=!0)}function set_color(e){if(e!=stv_g.color){var t=stv_g.color;return stv_g.color=e,set_g(),t}}function set_sscale(e){var t,r;e!=stv_g.st&&1!=stv_g.scale&&(stv_g.scale=0),t=e>=0?staff_tb[e].staffscale:1,r=e>=0&&1!=t?staff_tb[e].y:posy,t==stv_g.scale&&r==stv_g.dy||(stv_g.scale=t,stv_g.dy=r,stv_g.st=e,set_g())}function set_scale(e){var t=e.p_v.scale;if(1==t)return void set_sscale(e.st);t==stv_g.scale&&stv_g.dy==posy||(stv_g.scale=t,stv_g.dy=posy,stv_g.st=-1,stv_g.v=e.v,set_g())}function set_dscale(e,t){output&&(stv_g.st<0?staff_tb[0].output+=output:1==stv_g.scale?staff_tb[stv_g.st].output+=output:staff_tb[stv_g.st].sc_out+=output,output=""),stv_g.scale=e<0?1:t?1:staff_tb[e].staffscale,stv_g.st=e,stv_g.dy=0}function delayed_update(){var e;for(e=0;e<=nstaff;e++)staff_tb[e].sc_out&&(output+='<g transform="translate(0,'+(posy-staff_tb[e].y).toFixed(2)+") scale("+staff_tb[e].staffscale.toFixed(2)+')">\n'+staff_tb[e].sc_out+"</g>\n",staff_tb[e].sc_out=""),staff_tb[e].output&&(output+='<g transform="translate(0,'+(-staff_tb[e].y).toFixed(2)+')">\n'+staff_tb[e].output+"</g>\n",staff_tb[e].output="")}function anno_out(e,t,r){if(void 0!=e.istart){var n=e.type,a=e.ymx-e.ymn+4,i=e.wl||2,o=e.wr||2;e.grace&&(n=C.GRACE),r(t||anno_type[n],e.istart,e.iend,e.x-i-2,staff_tb[e.st].y+e.ymn+a-2,i+o+4,a,e)}}function a_start(e,t){anno_out(e,t,user.anno_start)}function a_stop(e,t){anno_out(e,t,user.anno_stop)}function empty_function(){}function out_XYAB(e,t,r,n,a){t=sx(t),r=sy(r),output+=e.replace(/X|Y|A|B|F|G/g,function(e){switch(e){case"X":return t.toFixed(2);case"Y":return r.toFixed(2);case"A":return n;case"B":return a;case"F":return n.toFixed(2);default:return a.toFixed(2)}})}function g_open(e,t,r,n,a){out_XYAB('<g transform="translate(X,Y',e,t),r&&(output+=") rotate("+r.toFixed(2)),n&&(output+=a?") scale("+n.toFixed(2)+", "+a.toFixed(2):") scale("+n.toFixed(2)),output+=')">\n',stv_g.g++}function g_close(){stv_g.g--,output+="</g>\n"}function sx(e){return stv_g.g?e:(e+posx)/stv_g.scale}function sy(e){return stv_g.g?e:1==stv_g.scale?posy-e:stv_g.st<0?(posy-e)/stv_g.scale:stv_g.dy-e}function out_sxsy(e,t,r){e=sx(e),r=sy(r),output+=e.toFixed(2)+t+r.toFixed(2)}function xypath(e,t,r){out_XYAB('<path class="A" d="mX Y\n',e,t,r?"fill":"stroke")}function xygl(e,t,r){var n=tgls[r];return n&&!glyphs[r]?(e+=n.x*stv_g.scale,t+=n.y,void(n.sc?out_XYAB('<text transform="translate(X,Y) scale(F)">B</text>\n',e,t,n.sc,n.c):out_XYAB('<text x="X" y="Y">A</text>\n',e,t,n.c))):glyphs[r]?(def_use(r),void out_XYAB('<use x="X" y="Y" xlink:href="#A"/>\n',e,t,r)):void error(1,null,"no definition of $1",r)}function out_acciac(e,t,r,n,a){a?(e-=1,t+=4):(e-=5,t-=4),out_XYAB('<path class="stroke" d="mX YlF G"/>\n',e,t,r,-n)}function out_bar(e,t,r,n){output+='<path class="stroke" stroke-width="1" '+(n?'stroke-dasharray="5,5" ':"")+'d="m'+(e+posx).toFixed(2)+" "+(posy-t).toFixed(2)+"v"+(-r).toFixed(2)+'"/>\n'}function out_bnum(e,t,r){out_XYAB('<text style="font-family:serif; font-style:italic; font-size:12px"\n\tx="X" y="Y" text-anchor="middle">A</text>\n',e,t,r.toString())}function out_brace(e,t,r){e+=posx-6,t=posy-t,r/=24,output+='<text transform="translate('+e.toFixed(2)+","+t.toFixed(2)+") scale(2.5,"+r.toFixed(2)+')">'+tgls.brace.c+"</text>\n"}function out_bracket(e,t,r){e+=posx-5,t=posy-t-3,r+=2,output+='<path class="fill"\n\td="m'+e.toFixed(2)+" "+t.toFixed(2)+"\n\tc10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n\tv"+r.toFixed(2)+'\n\tc5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n'}function out_hyph(e,t,r){var n,a=25+3*(r/20|0);n=r>15?(r-15)/a|0:0,e+=(r-a*n-5)/2,
out_XYAB('<path class="stroke" stroke-width="1.2"\n\tstroke-dasharray="5,A"\n\td="mX YhB"/>\n',e,t+6,Math.round((a-5)/stv_g.scale),a*n+5)}function out_stem(e,t,r,n,a,i){var o=n?GSTEM_XOFF:3.5,s=-r;if(r<0&&(o=-o),e+=o*stv_g.scale,stv_g.st<0&&(s/=stv_g.scale),out_XYAB('<path class="stroke" d="mX YvF"/>\n',e,t,s),a){if(output+='<path class="fill"\n\td="',t+=r,r>0)if(i)if(n)for(;--a>=0;)out_XYAB("MX Yl3 1.5 0 2 -3 -1.5z\n",e,t),t-=3;else for(t+=1;--a>=0;)out_XYAB("MX Yl7 3.2 0 3.2 -7 -3.2z\n",e,t),t-=5.4;else if(n)if(1==a)out_XYAB("MX Yc0.6 3.4 5.6 3.8 3 10\n\t1.2 -4.4 -1.4 -7 -3 -7\n",e,t);else for(;--a>=0;)out_XYAB("MX Yc1 3.2 5.6 2.8 3.2 8\n\t1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n",e,t),t-=3.5;else if(1==a)out_XYAB("MX Yc0.6 5.6 9.6 9 5.6 18.4\n\t1.6 -6 -1.3 -11.6 -5.6 -12.8\n",e,t);else for(;--a>=0;)out_XYAB("MX Yc0.9 3.7 9.1 6.4 6 12.4\n\t1 -5.4 -4.2 -8.4 -6 -8.4\n",e,t),t-=5.4;else if(i){if(!n)for(t+=1;--a>=0;)out_XYAB("MX Yl7 -3.2 0 -3.2 -7 3.2z\n",e,t),t+=5.4}else if(n)if(1==a)out_XYAB("MX Yc0.6 -3.4 5.6 -3.8 3 -10\n\t1.2 4.4 -1.4 7 -3 7\n",e,t);else for(;--a>=0;)out_XYAB("MX Yc1 -3.2 5.6 -2.8 3.2 -8\n\t1.4 4.8 -2.4 5.4 -3.2 5.2\n",e,t),t+=3.5;else if(1==a)out_XYAB("MX Yc0.6 -5.6 9.6 -9 5.6 -18.4\n\t1.6 6 -1.3 11.6 -5.6 12.8\n",e,t);else for(;--a>=0;)out_XYAB("MX Yc0.9 -3.7 9.1 -6.4 6 -12.4\n\t1 5.4 -4.2 8.4 -6 8.4\n",e,t),t+=5.4;output+='"/>\n'}}function out_thbar(e,t,r){e+=posx+1.5,t=posy-t,output+='<path class="stroke" stroke-width="3" d="m'+e.toFixed(2)+" "+t.toFixed(2)+"v"+(-r).toFixed(2)+'"/>\n'}function out_trem(e,t,r){for(out_XYAB('<path class="fill" d="mX Y\n\t',e-4.5,t);;){if(output+="l9 -3v3l-9 3z",--r<=0)break;output+="m0 5.4"}output+='"/>\n'}function out_tubr(e,t,r,n,a){var i=a?-3:3;t+=i,r/=stv_g.scale,output+='<path class="stroke" d="m',out_sxsy(e," ",t),output+="v"+i.toFixed(2)+"l"+r.toFixed(2)+" "+(-n).toFixed(2)+"v"+(-i).toFixed(2)+'"/>\n'}function out_tubrn(e,t,r,n,a,i){var o=10*i.length,s=a?-3:3;out_XYAB('<text style="font-family:serif; font-style:italic; font-size:12px"\n\tx="X" y="Y" text-anchor="middle">A</text>\n',e+r/2,t+n/2,i),r/=stv_g.scale,a||(t+=6),output+='<path class="stroke" d="m',out_sxsy(e," ",t),output+="v"+s.toFixed(2)+"m"+r.toFixed(2)+" "+(-n).toFixed(2)+"v"+(-s).toFixed(2)+'"/>\n<path class="stroke" stroke-dasharray="'+((r-o)/2).toFixed(2)+" "+o.toFixed(2)+'" d="m',out_sxsy(e," ",t-s),output+="l"+r.toFixed(2)+" "+(-n).toFixed(2)+'"/>\n'}function out_wln(e,t,r){out_XYAB('<path class="stroke" stroke-width="0.8" d="mX YhF"/>\n',e,t+3,r)}function out_deco_str(e,t,r,n){var a=deco_str_style[r];if(!a)return void xygl(e,t,r);e+=a.dx,t+=a.dy,a.def||(style+="\n."+r+" {"+a.style+"}",a.def=!0),out_XYAB('<text x="X" y="Y" class="A"B>',e,t,r,a.anchor||""),set_font("annotation"),out_str(n),output+="</text>\n"}function out_arp(e,t,r){for(g_open(e,t,270),e=0,t=-4,r=Math.ceil(r/6);--r>=0;)xygl(e,t,"ltr"),e+=6;g_close()}function out_cresc(e,t,r,n){e+=r,r=-r,out_XYAB('<path class="stroke"\n\td="mX YlA ',e,t+5,r),n.nost?output+="-2.2m0 -3.6l"+(-r).toFixed(2)+' -2.2"/>\n':output+="-4l"+(-r).toFixed(2)+' -4"/>\n'}function out_dim(e,t,r,n){out_XYAB('<path class="stroke"\n\td="mX YlA ',e,t+5,r),n.noen?output+="-2.2m0 -3.6l"+(-r).toFixed(2)+' -2.2"/>\n':output+="-4l"+(-r).toFixed(2)+' -4"/>\n'}function out_ltr(e,t,r){for(t+=4,r=Math.ceil(r/6);--r>=0;)xygl(e,t,"ltr"),e+=6}function out_8va(e,t,r,n){n.nost?r-=5:(out_XYAB('<text x="X" y="Y" style="font-family:serif; font-weight:bold; font-style:italic; font-size:12px">8<tspan dy="-4" style="font-size:10px">va</tspan></text>\n',e-8,t),e+=12,r-=12),t+=6,out_XYAB('<path class="stroke" stroke-dasharray="6,6" d="mX YhA"/>\n',e,t,r),n.noen||out_XYAB('<path class="stroke" d="mX Yv6"/>\n',e+r,t)}function out_8vb(e,t,r,n){n.nost?r-=5:(out_XYAB('<text x="X" y="Y" style="font-family:serif; font-weight:bold; font-style:italic; font-size:12px">8<tspan dy="-4" style="font-size:10px">vb</tspan></text>\n',e-8,t),e+=4,r-=4),out_XYAB('<path class="stroke" stroke-dasharray="6,6" d="mX YhA"/>\n',e,t,r),n.noen||out_XYAB('<path class="stroke" d="mX Yv-6"/>\n',e+r,t)}function out_15ma(e,t,r,n){n.nost?r-=5:(out_XYAB('<text x="X" y="Y" style="font-family:serif; font-weight:bold; font-style:italic; font-size:12px">15<tspan dy="-4" style="font-size:10px">ma</tspan></text>\n',e-10,t),e+=20,r-=20),t+=6,out_XYAB('<path class="stroke" stroke-dasharray="6,6" d="mX YhA"/>\n',e,t,r),n.noen||out_XYAB('<path class="stroke" d="mX Yv6"/>\n',e+r,t)}function out_15mb(e,t,r,n){n.nost?r-=5:(out_XYAB('<text x="X" y="Y" style="font-family:serif; font-weight:bold; font-style:italic; font-size:12px">15<tspan dy="-4" style="font-size:10px">mb</tspan></text>\n',e-10,t),e+=7,r-=7),out_XYAB('<path class="stroke" stroke-dasharray="6,6" d="mX YhA"/>\n',e,t,r),n.noen||out_XYAB('<path class="stroke" d="mX Yv-6"/>\n',e+r,t)}function out_deco_val(e,t,r,n,a){deco_val_tb[r]?deco_val_tb[r](e,t,n,a):error(1,null,"No function for decoration '$1'",r)}function out_glisq(e,t,r){var n=r.start,a=n.x,i=n.y+staff_tb[n.st].y,o=-Math.atan2(t-i,e-a),s=o/Math.PI*180,l=(e-a)/Math.cos(o);for(g_open(a,i,s),a=n.s.dots?13+n.s.xmx:8,l=(l-a-6)/6|0,l<1&&(l=1);--l>=0;)xygl(a,0,"ltr"),a+=6;g_close()}function out_gliss(e,t,r){var n=r.start,a=n.x,i=n.y+staff_tb[n.st].y,o=-Math.atan2(t-i,e-a),s=o/Math.PI*180,l=(e-a)/Math.cos(o);g_open(a,i,s),a=n.s.dots?13+n.s.xmx:8,l-=a+8,xypath(a,0),output+="l"+l.toFixed(2)+' 0" stroke-width="1"/>\n',g_close()}function out_deco_long(e,t,r){var n=r.dd.glyph;deco_l_tb[n]?deco_l_tb[n](e,t,r):error(1,null,"No function for decoration '$1'",n)}function vskip(e){posy+=e}function svg_flush(){if(!multicol&&output&&user.img_out&&0!=posy){var e='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tcolor="black" class="music" stroke-width=".7"',t="";cfmt.bgcolor&&(e+=' style="background-color: '+cfmt.bgcolor+'"'),posy*=cfmt.scale,user.imagesize?e+="\n"+user.imagesize+' viewBox="0 0 '+img.width.toFixed(0)+" "+posy.toFixed(0)+'">\n':e+='\n\twidth="'+img.width.toFixed(0)+'px" height="'+posy.toFixed(0)+'px">\n',(style||font_style||musicfont)&&(e+='<style type="text/css">'+style+font_style,musicfont&&(musicfont.indexOf("(")>0?e+="\n.music {font-family: music; font-size: 24px; fill: currentColor}\n@font-face {\n  font-family: music;\n  src: "+musicfont+"}":e+="\n.music {font-family: "+musicfont+"; font-size: 24px; fill: currentColor}"),e+="\n</style>\n"),defs+=fulldefs,defs&&(e+="<defs>"+defs+"\n</defs>\n"),1!=cfmt.scale&&(e+='<g class="g" transform="scale('+cfmt.scale.toFixed(2)+')">\n',t="</g>\n"),psvg&&psvg.ps_flush(!0),user.img_out(e+output+t+"</svg>"),output="",font_style="",cfmt.fullsvg?(defined_glyph={},defined_font={}):(musicfont="",style="",fulldefs=""),defs="",posy=0}}function blk_out(){!multicol&&user.img_out&&(blk_flush(),user.page_format&&!block.started&&(block.started=!0,block.newpage?(block.newpage=!1,user.img_out('<div class="nobrk newpage">')):user.img_out('<div class="nobrk">')))}function blk_flush(){svg_flush(),block.started&&(block.started=!1,user.img_out("</div>"))}function voice_filter(){var e,t,r;for(e in parse.voice_opts)if(parse.voice_opts.hasOwnProperty(e)&&(t=new RegExp(e),t.test(curvoice.id)||t.test(curvoice.nm)))for(r in parse.voice_opts[e])parse.voice_opts[e].hasOwnProperty(r)&&do_pscom(parse.voice_opts[e][r])}function sym_link(e){e.fname||set_ref(e),curvoice.ignore||(parse.last_sym=e,e.prev=curvoice.last_sym,curvoice.last_sym?curvoice.last_sym.next=e:curvoice.sym=e,curvoice.last_sym=e),e.v=curvoice.v,e.p_v=curvoice,e.st=curvoice.cst,e.time=curvoice.time,e.dur&&!e.grace&&(curvoice.time+=e.dur),e.pos=curvoice.pos,curvoice.second&&(e.second=!0),curvoice.floating&&(e.floating=!0)}function sym_add(e,t){var r,n={type:t,dur:0},a=curvoice;return curvoice=e,sym_link(n),curvoice=a,r=n.prev,r||(r=n.next),r&&(n.fname=r.fname,n.istart=r.istart,n.iend=r.iend),n}function mrest_expand(e){var t,r,n,a=e.nmes,i=e.dur/a,o=e.a_dd;for(e.type=C.REST,e.dur=i,e.head=C.FULL,e.nflags=-2,n=e.next,t=e.p_v,t.last_sym=e,t.time=e.time+i,t.cst=e.st,r=e;--a>0;)r=sym_add(t,C.BAR),r.bar_type="|",r=sym_add(t,C.REST),e.invis&&(r.invis=!0),r.dur=i,r.head=C.FULL,r.nflags=-2,t.time+=i;r.next=n,n&&(n.prev=r),r.a_dd=o}function sort_all(){var e,t,r,n,a,i,o,s,l,c,u,$,f=voice_tb.length,p=[],d=[],h=-1;for(t=0;t<f;t++)p.push(voice_tb[t].sym);for(var _=1,g=cur_sy;;){if(g&&_)for($=g,g=null,o=-1,d=[],t=0;t<f;t++)$.voices[t]?(i=$.voices[t].range)<0||(d[i]=t,o++):$.voices[t]={range:-1};for(a=r=1e6,i=0;i<f&&void 0!=(t=d[i]);i++)!(e=p[t])||e.time>r||(n=w_tb[e.type],e.time<r?(r=e.time,a=n):n<a&&(a=n),e.type==C.MREST&&(1==e.nmes?mrest_expand(e):o>0&&(h=r)));if(a>127)break;if(r==h){for(l=0,i=0;i<f&&void 0!=(t=d[i]);i++)if((e=p[t])&&e.time==r&&w_tb[e.type]==a){if(e.type!=C.MREST){h=-1;break}if(0==l)l=e.nmes;else if(l!=e.nmes){h=-1;break}}if(h<0)for(i=0;i<f&&void 0!=(t=d[i]);i++)(e=p[t])&&e.type==C.MREST&&mrest_expand(e)}for(i=0;i<f&&void 0!=(t=d[i]);i++)if((e=p[t])&&e.time==r&&w_tb[e.type]==a){if(e.type==C.STAVES){for(g=e.sy,c=0;c<f&&void 0!=d[c];c++);for(u=0;u<f;u++)g.voices[u]&&((i=g.voices[u].range)<0||$.voices[u].range>=0||(d[c++]=u))}_&&(_=0,e.seqst=!0),e.ts_prev=s,s?s.ts_next=e:tsfirst=e,s=e,p[t]=e.next}_=a}}function voice_adj(){var e,t,r,n;for(t=glovar.tempo,t&&staves_found<=0&&(n=par_sy.top_voice,e=voice_tb[n],e.sym&&e.sym.type!=C.TEMPO&&(t=clone(t),t.v=n,t.p_v=e,t.st=e.st,t.time=0,t.next=e.sym,t.next&&(t.next.prev=t),e.sym=t)),n=0;n<voice_tb.length;n++){for(e=voice_tb[n],e.ignore&&(e.ignore=!1),t=e.sym;t&&!(t.time>=staves_found);t=t.next);for(;t;t=t.next){switch(t.type){case C.GRACE:if(t.next&&t.next.type==C.BAR&&t.time--,!cfmt.graceword)continue;for(r=t.next;r;r=r.next){switch(r.type){case C.SPACE:continue;case C.NOTE:if(!r.a_ly)break;t.a_ly=r.a_ly,r.a_ly=null}break}continue}t.feathered_beam&&function(e){var t,r,n,a,i,o,s,a=e.dur,l=1;for(t=e;t&&!t.beam_end&&t.next;t=t.next)l++;if(l<=1)return void delete e.feathered_beam;if(r=t,i=a/2,s=a/(l-1),n=e.time,e.feathered_beam>0)for(t=e,o=l-1;t!=r;t=t.next,o--)a=(s*o|0)+i,t.dur=a,t.time=n,n+=a;else for(t=e,o=0;t!=r;t=t.next,o++)a=(s*o|0)+i,t.dur=a,t.time=n,n+=a;t.dur=t.time+t.dur-n,t.time=n}(t)}}}function dupl_voice(){var e,t,r,n,a,i,o,s,l=voice_tb.length;for(o=0;o<l;o++)if(e=voice_tb[o],t=e.clone){for(e.clone=null,r=e.sym;r&&!(r.time>=staves_found);r=r.next);for(t.clef=clone(e.clef),curvoice=t;r;r=r.next)if(r.type!=C.STAVES){if(n=clone(r),r.notes)for(n.notes=[],s=0;s<=r.nhd;s++)n.notes.push(clone(r.notes[s]));if(sym_link(n),t.second?n.second=!0:delete n.second,t.floating?n.floating=!0:delete n.floating,delete n.a_ly,a=n.extra)for(i=clone(a),n.extra=i,n=i,n.v=t.v,n.p_v=t,n.st=t.st,a=a.next;a;a=a.next){if(i=clone(a),a.notes)for(i.notes=[],s=0;s<=a.nhd;s++)i.notes.push(clone(a.notes[s]));n.next=i,i.prev=n,n=i,n.v=t.v,n.p_v=t,n.st=t.st}}}}function new_syst(e){var t,r,n={voices:[],staves:[],top_voice:0};if(e)return void(cur_sy=par_sy=n);for(r=0;r<voice_tb.length;r++){t=par_sy.voices[r].st;var a=par_sy.staves[t],i=voice_tb[r];void 0!=i.staffnonote&&(a.staffnonote=i.staffnonote),i.staffscale&&(a.staffscale=i.staffscale),n.voices[r]=clone(par_sy.voices[r]),n.voices[r].range=-1,delete n.voices[r].second}for(t=0;t<par_sy.staves.length;t++)n.staves[t]=clone(par_sy.staves[t]),n.staves[t].flags=0;par_sy.next=n,par_sy=n}function set_bar_num(){var e,t,r,n,a,i,o=cur_sy.top_voice,s=voice_tb[o].meter.wmeasure,l=gene.nbar;for(e=tsfirst;;e=e.ts_next){if(!e)return;switch(e.type){case C.METER:s=e.wmeasure;case C.CLEF:case C.KEY:case C.STBRK:continue;case C.BAR:if(e.bar_num){gene.nbar=e.bar_num;break}e.text&&!cfmt.contbarnb&&("1"==e.text[0]?l=gene.nbar:(gene.nbar=l,e.bar_num=gene.nbar))}break}if(n=e.time+s,0==e.time)for(t=e.ts_next;t;t=t.ts_next)if(t.type==C.BAR&&t.time){t.time<n&&(e=t,n=e.time+s);break}for(a=gene.nbar;e;e=e.ts_next)switch(e.type){case C.METER:s=e.wmeasure,e.time<n&&(n=e.time+s);break;case C.MREST:for(a+=e.nmes-1;e.ts_next&&e.ts_next.type!=C.BAR;)e=e.ts_next;break;case C.BAR:if(e.bar_num&&(a=e.bar_num),e.time<n){e.text&&"1"==e.text[0]&&(l=a,i=n-e.time);break}r=e.time,t=e;do{if(t.dur)break;if(t.type==C.BAR&&t.text)break;t=t.next}while(t&&t.time==r);if(a++,t&&t.type==C.BAR&&t.text)if("1"==t.text[0])i=0,l=a;else if(cfmt.contbarnb||(a=l),i){cfmt.contbarnb&&a--,n=r+i;break}for(e.bar_num=a,n=r+s;e.ts_next&&!e.ts_next.seqst;)e=e.ts_next}cfmt.measurenb<0&&(gene.nbar=a)}function get_map(e){if(e){var t,r,n,a,i,o,s=info_split(e,2);if(s.length<3)return void syntax(1,"Not enough parameters in %%map");if(o=s[1],0==o.indexOf("octave,")||0==o.indexOf("key,"))o=o.replace(/[,']+$/m,"").toLowerCase(),"k"==o[0]&&(o=o.replace(/[_=^]+/,""));else if("*"==o[0]||0==o.indexOf("all"))o="all";else{if(i=new scanBuf,i.buffer=s[1],!(r=parse_acc_pit(i)))return void syntax(1,"Bad note in %%map");for(o="abcdefg"[(r.pit+77)%7],r.acc&&(o=["__","_","","^","^^","="][r.acc+2]+o),t=r.pit;t>=28;t-=7)o+="'";for(t=r.pit;t<21;t+=7)o+=","}if(n=maps[s[0]],n||(maps[s[0]]=n={}),a=n[o],a||(n[o]=a=[]),s[2]){if(t=2,s[2].indexOf("=")<0){if("*"!=s[2][0]&&(i=new scanBuf,i.buffer=s[2],a[1]=parse_acc_pit(i)),!s[3])return;t++,s[3].indexOf("=")<0&&(a[0]=s[3].split(","),t++)}for(;t<s.length;t++)switch(s[t]){case"heads=":a[0]=s[++t].split(",");break;case"print=":i=new scanBuf,i.buffer=s[++t],a[1]=parse_acc_pit(i);break;case"color=":a[2]=s[++t]}}}}function set_transp(){var e,t,r;if(!curvoice.ckey.k_bagpipe&&!curvoice.ckey.k_drum&&(cfmt.transp&&curvoice.transp&&syntax(0,"Mix of old and new transposition syntaxes"),t=(cfmt.transp||0)+(curvoice.transp||0)+(curvoice.shift||0),r=curvoice.vtransp||0,t!=r)){if(curvoice.vtransp=t,!(e=curvoice.last_sym))return curvoice.key=clone(curvoice.okey),key_transp(curvoice.key),curvoice.ckey=clone(curvoice.key),void(curvoice.key.k_none&&(curvoice.key.k_sf=0));for(;;){if(e.type==C.KEY)break;if(!e.prev){e=curvoice.key;break}e=e.prev}key_transp(e),curvoice.ckey=clone(e),curvoice.key.k_none&&(e.k_sf=0)}}function set_ottava(e){if(!cfmt.sound)switch(e){case"15ma(":curvoice.ottava=-14;break;case"8va(":curvoice.ottava=-7;break;case"8vb(":curvoice.ottava=7;break;case"15mb(":curvoice.ottava=14;break;case"15ma)":case"8va)":case"8vb)":case"15mb)":curvoice.ottava=0}}function do_pscom(e){var t,r,n,a,i,o,s,l,c=!1;if(" lock"==e.slice(-5)&&(c=!0,e=e.slice(0,-5).trim()),a=e.match(/(\w|-)+/)){switch(a=a[0],i=e.replace(a,"").trim(),a){case"center":return parse.state>=2?(n=new_block("text"),n.text=cnv_escape(i),void(n.opt="c")):void write_text(cnv_escape(i),"c");case"clef":return void(parse.state>=2&&(2==parse.state&&goto_tune(),(n=new_clef(i))&&get_clef(n)));case"deco":return void deco_add(i);case"linebreak":return void set_linebreak(i);case"map":return void get_map(i);case"maxsysstaffsep":if(3==parse.state)return void(par_sy.voices[curvoice.v].maxsep=get_unit(i));break;case"multicol":switch(generate(),i){case"start":blk_out(),multicol={posy:posy,maxy:posy,lmarg:cfmt.leftmargin,rmarg:cfmt.rightmargin,state:parse.state};break;case"new":if(!multicol){syntax(1,"%%multicol new without start");break}posy>multicol.maxy&&(multicol.maxy=posy),cfmt.leftmargin=multicol.lmarg,cfmt.rightmargin=multicol.rmarg,img.chg=!0,set_page(),posy=multicol.posy;break;case"end":if(!multicol){syntax(1,"%%multicol end without start");break}posy<multicol.maxy&&(posy=multicol.maxy),cfmt.leftmargin=multicol.lmarg,cfmt.rightmargin=multicol.rmarg,multicol=void 0,blk_flush(),img.chg=!0,set_page();break;default:syntax(1,"Unknown keyword '$1' in %%multicol",i)}return;case"musicfont":return void(musicfont=i);case"ottava":if(3!=parse.state){if(2!=parse.state)return;goto_tune()}if(o=parseInt(i),isNaN(o)||o<-2||o>2)return void syntax(1,errs.bad_val,"%%ottava");switch(curvoice.ottava){case 14:l="15mb)";break;case 7:l="8vb)";break;case-7:l="8va)";break;case-14:l="15ma)"}switch(l&&(a_dcn||(a_dcn=[]),a_dcn.push(l),set_ottava(l)),o){case-2:l="15mb(";break;case-1:l="8vb(";break;case 0:return;case 1:l="8va(";break;case 2:l="15ma("}return a_dcn||(a_dcn=[]),a_dcn.push(l),void set_ottava(l);case"repbra":return void(parse.state>=2&&(2==parse.state&&goto_tune(),curvoice.norepbra=!get_bool(i)));case"repeat":if(3!=parse.state)return;if(!curvoice.last_sym)return void syntax(1,"%%repeat cannot start a tune");if(i.length){if(l=i.split(/\s+/),o=parseInt(l[0]),s=parseInt(l[1]),isNaN(o)||o<1||curvoice.last_sym.type==C.BAR&&o>2)return void syntax(1,"Incorrect 1st value in %%repeat");if(isNaN(s))s=1;else if(s<1)return void syntax(1,"Incorrect 2nd value in %%repeat")}else o=1,s=1;return parse.repeat_n=curvoice.last_sym.type==C.BAR?o:-o,void(parse.repeat_k=s);case"sep":var u,$,f,p;return set_page(),(p=img.width-img.lm-img.rm,t=u=$=0,i&&(f=i.split(/\s+/),t=get_unit(f[0]),f[1]&&(u=get_unit(f[1]),f[2]&&($=get_unit(f[2])))),t<1&&(t=14),u<1&&(u=t),$<1&&($=90),parse.state>=2)?(n=new_block(a),n.x=(p-$)/2/cfmt.scale,n.l=$/cfmt.scale,n.sk1=t,void(n.sk2=u)):(blk_out(),vskip(t),output+='<path class="stroke"\n\td="M',out_sxsy((p-$)/2/cfmt.scale," ",0),output+="h"+($/cfmt.scale).toFixed(2)+'"/>\n',vskip(u),void blk_flush());case"setbarnb":return r=parseInt(i),void(isNaN(r)?syntax(1,"Bad %%setbarnb value"):parse.state>=2?glovar.new_nbar=r:cfmt.measurefirst=r);case"staff":if(3!=parse.state){if(2!=parse.state)return;goto_tune()}if(r=parseInt(i),isNaN(r))return void syntax(1,"Bad %%staff value '$1'",i);var d;return(d="+"==i[0]||"-"==i[0]?curvoice.cst+r:r-1)<0||d>nstaff?void syntax(1,"Bad %%staff number $1 (cur $2, max $3)",d,curvoice.cst,nstaff):(delete curvoice.floating,void(curvoice.cst=d));case"staffbreak":if(3!=parse.state){if(2!=parse.state)return;goto_tune()}return n={type:C.STBRK,dur:0},i[0]>="0"&&i[0]<="9"?(n.xmx=get_unit(i),"f"==i.slice(-1)&&(n.stbrk_forced=!0)):(n.xmx=14,"f"==i[0]&&(n.stbrk_forced=!0)),void sym_link(n);case"stafflines":case"staffscale":case"staffnonote":return void set_v_param(a,i);case"staves":case"score":if(0==parse.state)return;return void get_staves(a,i);case"sysstaffsep":if(3==parse.state)return void(par_sy.voices[curvoice.v].sep=get_unit(i));break;case"text":return parse.state>=2?(n=new_block(a),n.text=cnv_escape(i),void(n.opt=cfmt.textoption)):void write_text(cnv_escape(i),cfmt.textoption);case"transpose":if(cfmt.sound)return;switch(parse.state){case 0:cfmt.transp=0;case 1:case 2:return void(cfmt.transp=(cfmt.transp||0)+get_transp(i))}for(n=curvoice.last_sym;n;n=n.prev){switch(n.type){case C.NOTE:n=clone(curvoice.okey),n.k_old_sf=curvoice.ckey.k_sf,sym_link(n);break;case C.KEY:break;default:continue}break}return void do_info("V",curvoice.id+" shift="+i);case"tune":return;case"user":return void set_user(i);case"voicecolor":if(3!=parse.state){if(2!=parse.state)return;goto_tune()}return void(curvoice.color=i);case"vskip":return(r=get_unit(i))<0?void syntax(1,"%%vskip cannot be negative"):parse.state>=2?(n=new_block(a),void(n.sk=r)):void vskip(r);case"newpage":case"leftmargin":case"rightmargin":case"pagescale":case"pagewidth":case"printmargin":case"scale":case"staffwidth":if(3==parse.state)return n=new_block(a),void(n.param=i);if("newpage"==a)return blk_flush(),void(block.newpage=!0)}set_format(a,i,c)}}function do_begin_end(e,t,r){var n,a,i,o;switch(e){case"js":js_inject(r);break;case"ml":parse.state>=2?(o=new_block(e),o.text=r):(svg_flush(),user.img_out(r));break;case"svg":for(a=0;;){if((n=r.indexOf('<style type="text/css">\n',a))<0)break;if((a=r.indexOf("</style>",n))<0){syntax(1,"No </style> in %%beginsvg sequence");break}style+=r.slice(n+23,a).replace(/\s+$/,"")}for(a=0;;){if((n=r.indexOf("<defs>\n",a))<0)break;if((a=r.indexOf("</defs>",n))<0){syntax(1,"No </defs> in %%beginsvg sequence");break}defs_add(r.slice(n+6,a))}break;case"text":if(i=get_textopt(t),i||(i=cfmt.textoption),parse.state>=2){o=new_block(e),o.text=cnv_escape(r),o.opt=i;break}write_text(cnv_escape(r),i)}}function generate(){var e,t;if(vover&&(syntax(1,"No end of voice overlay"),get_vover(vover.bar?"|":")")),0!=voice_tb.length&&(voice_adj(),dupl_voice(),sort_all(),tsfirst&&(set_bar_num(),tsfirst))){for(user.get_abcmodel&&user.get_abcmodel(tsfirst,voice_tb,anno_type,info),user.img_out&&output_music(),e=0;e<voice_tb.length;e++)t=voice_tb[e],t.time=0,t.sym=t.last_sym=null,t.st=cur_sy.voices[e].st,t.second=cur_sy.voices[e].second,delete t.have_ly,t.hy_st=0,delete t.bar_start,delete t.slur_st,delete t.s_tie,delete t.s_rtie;staves_found=0}}function key_transp(e){var t=curvoice.vtransp/3|0,r=(-2&t)+7*(1&t)+e.k_sf;switch((curvoice.vtransp+210)%3){case 1:r=(r+4+48)%12-4;break;case 2:r=(r+7+48)%12-7;break;default:r=(r+5+48)%12-5}e.k_sf=r,e.k_delta=cgd2cde[(r+7)%7]}function set_k_acc(e){var t,r,n,a,i,o=[],s=[],l=[],c=[];if(e.k_sf>0)for(a=0;a<e.k_sf;a++)o[a]=1,s[a]=[26,23,27,24,21,25,22][a];else for(a=0;a<-e.k_sf;a++)o[a]=-1,s[a]=[22,25,21,24,20,23,26][a];for(n=e.k_a_acc.length,t=0;t<n;t++){for(i=e.k_a_acc[t],r=0;r<a;r++)if(s[r]==i.pit){o[r]=i.acc,i.micro_n&&(l[r]=i.micro_n,c[r]=i.micro_d);break}r==a&&(o[r]=i.acc,s[r]=i.pit,i.micro_n&&(l[r]=i.micro_n,c[r]=i.micro_d),a++)}for(t=0;t<a;t++)i=e.k_a_acc[t],i||(i=e.k_a_acc[t]={}),i.acc=o[t],i.pit=s[t],l[t]?(i.micro_n=l[t],i.micro_d=c[t]):(delete i.micro_n,delete i.micro_d)}function acc_same_pitch(e){var t,r,n=curvoice.last_sym.prev;if(n)for(r=n.time;n;n=n.prev)switch(n.type){case C.BAR:if(n.time<r)return;for(;;){if(!(n=n.prev))return;if(n.type==C.NOTE){if(n.time+n.dur==r)break;return}if(n.time<r)return}for(t=0;t<=n.nhd;t++)if(n.notes[t].pit==e&&n.notes[t].ti1)return n.notes[t].acc;return;case C.NOTE:for(t=0;t<=n.nhd;t++)if(n.notes[t].pit==e)return n.notes[t].acc}}function get_staves(e,t){var r,n,a,i,o,s,l,c,u,$=parse_staves(t);if($){0!=voice_tb.length&&(voice_adj(),dupl_voice());var f=0,p=!0;for(s=0;s<voice_tb.length;s++)n=voice_tb[s],n.time>f&&(f=n.time),n.sym&&(p=!1);if(p||0==f&&staves_found<0)for(s=0;s<par_sy.voices.length;s++)par_sy.voices[s].range=-1;else{for(s=0;s<par_sy.voices.length;s++)if(par_sy.voices[s].range>=0){curvoice=voice_tb[s];break}curvoice.time=f,r={type:C.STAVES,dur:0},sym_link(r),par_sy.nstaff=nstaff,new_syst(),r.sy=par_sy}for(staves_found=f,s=0;s<voice_tb.length;s++)n=voice_tb[s],delete n.second,delete n.ignore,delete n.floating;for(u=0,i=0;i<$.length;i++){if(l=$[i][0],n=new_voice(l),n.time=f,s=n.v,0==i&&(par_sy.top_voice=n.v),par_sy.voices[s].range>=0){for(a=clone(n),par_sy.voices[voice_tb.length]=clone(par_sy.voices[s]),s=voice_tb.length,a.v=s,a.sym=a.last_sym=null,a.time=f,voice_tb.push(a),delete a.clone;n.clone;)n=n.clone;n.clone=a,n=a}$[i][0]=n,par_sy.voices[s].range=u++}if("t"==e[1])for(i=0;i<$.length;i++)(o=$[i][1])&(OPEN_BRACE|OPEN_BRACE2)&&(o&(OPEN_BRACE|CLOSE_BRACE))!=(OPEN_BRACE|CLOSE_BRACE)&&(o&(OPEN_BRACE2|CLOSE_BRACE2))!=(OPEN_BRACE2|CLOSE_BRACE2)&&0==$[i+1][1]&&(o&OPEN_PARENTH||$[i+2][1]&OPEN_PARENTH||($[i+2][1]&(CLOSE_BRACE|CLOSE_BRACE2)?$[i+1][1]|=FL_VOICE:0==$[i+2][1]&&$[i+3][1]&(CLOSE_BRACE|CLOSE_BRACE2)&&($[i][1]|=OPEN_PARENTH,$[i+1][1]|=CLOSE_PARENTH,$[i+2][1]|=OPEN_PARENTH,$[i+3][1]|=CLOSE_PARENTH)));for(c=-1,i=0;i<$.length;i++)if(o=$[i][1],(o&(OPEN_PARENTH|CLOSE_PARENTH))==(OPEN_PARENTH|CLOSE_PARENTH)&&(o&=~(OPEN_PARENTH|CLOSE_PARENTH),$[i][1]=o),n=$[i][0],o&FL_VOICE?(n.floating=!0,n.second=!0):(c++,par_sy.staves[c]||(par_sy.staves[c]={stafflines:"|||||",staffscale:1}),par_sy.staves[c].flags=0),s=n.v,n.st=n.cst=par_sy.voices[s].st=c,par_sy.staves[c].flags|=o,o&OPEN_PARENTH){for(a=n;i<$.length-1&&(n=$[++i][0],s=n.v,$[i][1]&MASTER_VOICE?(a.second=!0,a=n):n.second=!0,n.st=n.cst=par_sy.voices[s].st=c,!($[i][1]&CLOSE_PARENTH)););par_sy.staves[c].flags|=$[i][1]}if(c<0&&(c=0),par_sy.nstaff=nstaff=c,"c"==e[1])for(c=0;c<nstaff;c++)par_sy.staves[c].flags^=STOP_BAR;for(s=0;s<voice_tb.length;s++)n=voice_tb[s],par_sy.voices[s].range<0?n.ignore=!0:(par_sy.voices[s].second=n.second,!((c=n.st)>0)||n.norepbra||par_sy.staves[c-1].flags&STOP_BAR||(n.norepbra=!0));curvoice=parse.state>=2?voice_tb[par_sy.top_voice]:null}}function get_vover(e){function t(e){var t,r;for(t=0;t<voice_tb.length;t++)if(r=voice_tb[t],r.id==e)return r;return r=clone(curvoice),r.v=voice_tb.length,r.id=e,r.sym=r.last_sym=null,delete r.nm,delete r.snm,delete r.new_name,delete r.lyric_restart,delete r.lyric_cont,delete r.ly_a_h,delete r.sym_restart,delete r.sym_cont,voice_tb.push(r),r}var r,n,a,i,o,s,l,c;parse.line;if(!curvoice.ignore){if("|"==e||")"==e)return curvoice.last_note?(curvoice.last_note.beam_end=!0,vover?(curvoice.time!=vover.p_voice.time&&(syntax(1,"Wrong duration in voice overlay"),curvoice.time>vover.p_voice.time&&(vover.p_voice.time=curvoice.time)),curvoice=vover.p_voice,void(vover=null)):void syntax(1,"Erroneous end of voice overlay")):void syntax(1,errs.nonote_vo);if("("==e)return vover?void syntax(1,"Voice overlay already started"):void(vover={p_voice:curvoice,time:curvoice.time});if(!curvoice.last_note)return void syntax(1,errs.nonote_vo);if(curvoice.last_note.beam_end=!0,!(r=curvoice.voice_down)){r=t(curvoice.id+"o"),curvoice.voice_down=r,r.time=0,r.second=!0,l=r.v,par_sy.voices[l]={st:curvoice.st,second:!0};var u=void 0!=curvoice.clone?1:0;for(a=par_sy.voices[curvoice.v].range,s=0;s<par_sy.voices.length;s++)par_sy.voices[s].range>a&&(par_sy.voices[s].range+=u+1);par_sy.voices[l].range=a+1,u&&(n=t(r.id+"c"),n.second=!0,c=n.v,par_sy.voices[c]={second:!0,range:a+2},r.clone=n)}if(r.ulen=curvoice.ulen,r.dur_fact=curvoice.dur_fact,curvoice.uscale&&(r.uscale=curvoice.uscale),vover)curvoice!=vover.p_voice&&curvoice.time!=vover.p_voice.time&&(syntax(1,"Wrong duration in voice overlay"),curvoice.time>vover.p_voice.time&&(vover.p_voice.time=curvoice.time));else{for(vover={bar:!0,p_voice:curvoice},o=r.time,i=curvoice.last_sym;!(i.type==C.BAR||i.time<=o);i=i.prev);vover.time=i.time}r.time=vover.time,curvoice=r}}function is_voice_sig(){var e;if(!curvoice.sym)return!0;if(0!=curvoice.time)return!1;for(e=curvoice.last_sym;e;e=e.prev)if(0!=w_tb[e.type])return!1;return!0}function get_clef(e){var t,r;if(is_voice_sig())return void(curvoice.clef=e);for(t=curvoice.last_sym;t&&t.prev&&t.time==curvoice.time&&0==w_tb[t.type];t=t.prev);if(t&&t.prev&&t.time==curvoice.time&&(t.type==C.KEY&&!t.k_none||t.type==C.BAR)){for(r=t;r.prev;r=r.prev){switch(r.prev.type){case C.KEY:case C.BAR:continue}break}t=curvoice.last_sym,curvoice.last_sym=r.prev,sym_link(e),e.next=r,r.prev=e,curvoice.last_sym=t}else sym_link(e);e.clef_small=!0}function get_key(e){var t,r,n,a,i=new_key(e),o=i[0];switch(i=i[1],o.k_sf&&!o.k_exp&&o.k_a_acc&&set_k_acc(o),parse.state){case 1:for(void 0!=o.k_sf||o.k_a_acc||(o.k_sf=0,o.k_none=!0),t=0;t<voice_tb.length;t++)r=voice_tb[t],r.key=clone(o),r.okey=clone(o),r.ckey=clone(o);return parse.okey=clone(o),parse.ckey=o,0!=i.length&&memo_kv_parm("*",i),glovar.ulen||(glovar.ulen=C.BLEN/8),parse.state=2,set_page(),write_heading(),reset_gen(),void(gene.nbar=cfmt.measurefirst);case 2:goto_tune(!0)}if(0!=i.length&&set_kv_parm(i),a=(cfmt.transp||0)+(curvoice.transp||0)+(curvoice.shift||0),void 0==o.k_sf){if(!o.k_a_acc&&!a)return;o.k_sf=curvoice.okey.k_sf}if(curvoice.okey=clone(o),a&&(curvoice.vtransp=a,key_transp(o)),o.k_old_sf=curvoice.ckey.k_sf,curvoice.ckey=o,is_voice_sig())return curvoice.key=clone(o),void(o.k_none&&(curvoice.key.k_sf=0));n=curvoice.last_sym,n&&n.type==C.METER?(curvoice.last_sym=n.prev,curvoice.last_sym||(curvoice.sym=null),sym_link(o),o.next=n,n.prev=o,curvoice.last_sym=n):sym_link(o)}function new_voice(e){var t,r,n,a=voice_tb.length;if(1==a&&voice_tb[0].default&&(delete voice_tb[0].default,0==voice_tb[0].time))return t=voice_tb[0],t.id=e,cfmt.transp&&parse.state>=2&&(n=curvoice,curvoice=t,set_transp(),curvoice=n),t;for(r=0;r<a;r++)if(t=voice_tb[r],t.id==e)return t;return t={v:r,id:e,time:0,new:!0,pos:{dyn:0,gch:0,gst:0,orn:0,stm:0,voc:0,vol:0},scale:1,ulen:glovar.ulen,dur_fact:1,key:clone(parse.ckey),ckey:clone(parse.ckey),okey:clone(parse.okey),meter:clone(glovar.meter),wmeasure:glovar.meter.wmeasure,clef:{type:C.CLEF,clef_auto:!0,clef_type:"a",time:0},hy_st:0},voice_tb.push(t),par_sy.voices[r]={range:-1},t}function init_tune(){nstaff=-1,voice_tb=[],curvoice=null,new_syst(!0),staves_found=-1,gene={},a_de=[],od={}}function do_cloning(e){for(var t,r,n=parse.file,a=parse.eol+1,i=a;;){if((r=n.indexOf("\n",i))<0){r=0;break}if(/%.*|\n.*|.:.|\[.:/.test(n.slice(r+1,r+4)))break;i=r+1}for(include++,tosvg(parse.fname,n,a,r),t=0;t<e.length;t++)get_voice(e[t]),tosvg(parse.fname,n,a,r);include--}function get_voice(e){var t,r,n=info_split(e,1),a=n.shift();if(a){if(a.indexOf(",")>0&&(r=a.split(","),a=r.shift()),parse.state<2)return 0!=n.length&&memo_kv_parm(a,n),void("*"!=a&&1==parse.state&&new_voice(a));if("*"==a)return void syntax(1,"Cannot have V:* in tune body");curvoice=new_voice(a),set_kv_parm(n),2==parse.state&&goto_tune(),set_transp(),t=curvoice.v,curvoice.new&&(delete curvoice.new,staves_found<0&&(curvoice.st=curvoice.cst=++nstaff,par_sy.nstaff=nstaff,par_sy.voices[t].st=nstaff,par_sy.voices[t].range=t,par_sy.staves[nstaff]={stafflines:"|||||",staffscale:1}),par_sy.voices[t].range<0&&staves_found>=0&&(curvoice.ignore=!0)),curvoice.stafflines&&(par_sy.staves[curvoice.st].stafflines=curvoice.stafflines,curvoice.stafflines=""),curvoice.filtered||curvoice.ignore||!parse.voice_opts||(curvoice.filtered=!0,voice_filter()),r&&do_cloning(r)}}function goto_tune(e){var t,r,n={type:C.STAVES,dur:0,sy:par_sy};for(parse.state=3,0==voice_tb.length?(curvoice=new_voice("1"),curvoice.clef.istart=curvoice.key.istart,curvoice.clef.iend=curvoice.key.iend,curvoice.default=!0):curvoice||(curvoice=voice_tb[staves_found<0?0:par_sy.top_voice]),curvoice.init||e||(set_kv_parm([]),set_transp()),t=0;t<voice_tb.length;t++)r=voice_tb[t],r.ulen=glovar.ulen,r.key.k_bagpipe&&!r.pos.stm&&(r.pos=clone(r.pos),r.pos.stm=C.SL_BELOW);if(staves_found<0){for(nstaff=voice_tb.length-1,t=0;t<=nstaff;t++)r=voice_tb[t],delete r.new,r.st=r.cst=par_sy.voices[t].st=par_sy.voices[t].range=t,par_sy.staves[t]={stafflines:"|||||",staffscale:1};par_sy.nstaff=nstaff}r=curvoice,curvoice=voice_tb[par_sy.top_voice],sym_link(n),staves_found<0&&(n.default=!0),curvoice=r}function get_sym(e,t){var r,n,a,i,o;if(!curvoice.ignore){if(t){if(!(r=curvoice.sym_cont))return void syntax(1,"+: symbol line without music")}else if(curvoice.sym_restart?(curvoice.sym_start=r=curvoice.sym_restart,curvoice.sym_restart=null):r=curvoice.sym_start,r||(r=curvoice.sym),!r)return void syntax(1,"s: without music");for(a=0;;){for(;" "==e[a]||"\t"==e[a];)a++;if(!(n=e[a]))break;switch(n){case"|":for(;r&&r.type!=C.BAR;)r=r.next;if(!r)return void syntax(1,"Not enough measure bars for symbol line");r=r.next,a++;continue;case"!":case'"':if(i=++a,(a=e.indexOf(n,i))<0){syntax(1,"!"==n?"No end of decoration":"No end of guitar chord"),a=e.length;continue}o=e.slice(i-1,a+1);break;case"*":break;default:if((o=n.charCodeAt(0))<128&&(o=char_tb[o],o.length>1&&("!"==o[0]||'"'==o[0]))){n=o[0];break}syntax(1,errs.bad_char,n)}for(;r&&(r.type!=C.NOTE||r.grace);)r=r.next;if(!r)return void syntax(1,"Too many elements in symbol line");switch(n){default:break;case"!":deco_cnv([o.slice(1,-1)],r,r.prev);break;case'"':a_gch=r.a_gch,parse_gchord(o),a_gch&&gch_build(r)}r=r.next,a++}curvoice.lyric_cont=r}}function get_lyrics(e,t){var r,n,a,i,o,s;if(!curvoice.ignore){if(curvoice.pos.voc!=C.SL_HIDDEN&&(curvoice.have_ly=!0),t){if(!(r=curvoice.lyric_cont))return void syntax(1,"+: lyric without music")}else if(set_font("vocal"),curvoice.lyric_restart?(curvoice.lyric_start=r=curvoice.lyric_restart,curvoice.lyric_restart=null,curvoice.lyric_line=0):(curvoice.lyric_line++,r=curvoice.lyric_start),r||(r=curvoice.sym),!r)return void syntax(1,"w: without music");for(a=e,i=0;;){for(;" "==a[i]||"\t"==a[i];)i++;if(!a[i])break;switch(o=parse.istart+i+2,a[i]){case"|":for(;r&&r.type!=C.BAR;)r=r.next;if(!r)return void syntax(1,"Not enough measure bars for lyric line");r=r.next,i++;continue;case"-":n="-\n";break;case"_":n="_\n";break;case"*":n="";break;default:if("\\"==a[i]&&i==a.length-1)return void(curvoice.lyric_cont=r);for(n="";;){if(!a[i])break;switch(a[i]){case"_":case"*":case"|":i--;case" ":case"\t":break;case"~":n+=" ",i++;continue;case"-":n+="\n";break;case"\\":n+=a[++i],i++;continue;default:n+=a[i++];continue}break}}
for(;r&&(r.type!=C.NOTE||r.grace);)r=r.next;if(!r)return void syntax(1,"Too many words in lyric line");n&&r.pos.voc!=C.SL_HIDDEN&&(n.match(/^\$\d/)&&(set_font("0"==n[1]?"vocal":"u"+n[1]),n=n.slice(2)),s={t:n,font:gene.curfont,w:strwh(n)[0],istart:o,iend:o+n.length},r.a_ly||(r.a_ly=[]),r.a_ly[curvoice.lyric_line]=s),r=r.next,i++}curvoice.lyric_cont=r}}function ly_width(e,t){var r,n,a,i,o,s,l,c,u,$,f,p=e.a_ly;for(i=0,l=0;l<p.length;l++)if(r=p[l])if("-\n"!=(f=r.t)&&"_\n"!=f){for(s=r.w,a=r.font.swfac,o=s+2*cwid(" ")*a,e.type==C.GRACE?$=e.wl:f[0]>="0"&&f[0]<="9"&&f.length>2||":"==f[1]||"("==f[0]||")"==f[0]?("("==f[0]?n=cwid("(")*a:(c=f.indexOf(" "),set_font(r.font),n=c>0?strwh(f.slice(0,c))[0]:s),$=.4*(s-n+2*cwid(" ")*a),$>20&&($=20),$+=n,r.t[0]>="0"&&r.t[0]<="9"&&$>i&&(i=$)):($=.4*o)>20&&($=20),r.shift=$,t<$&&(t=$),o-=$,$=2*cwid(" ")*a,u=e.next;u;u=u.next){switch(u.type){case C.NOTE:case C.REST:if(u.a_ly&&u.a_ly[l]&&0!=u.a_ly[l].w){if("-\n"!=u.a_ly[l].t&&"_\n"!=u.a_ly[l].t)break;o-=$}else o-=9;if(o<=0)break;continue;case C.CLEF:case C.METER:case C.KEY:o-=10;continue;default:o-=5}break}o>e.wr&&(e.wr=o)}else r.shift=0;if(i>0)for(l=0;l<p.length;l++)(r=p[l])&&r.t[0]>="0"&&r.t[0]<="9"&&(r.shift=i);return t}function draw_lyric_line(e,t,r){var n,a,i,o,s,l,c,u,$,f;for(e.hy_st&1<<t&&(c=!0,e.hy_st&=~(1<<t)),o=e.sym;o.type==C.CLEF||o.type==C.KEY||o.type==C.METER;o=o.next);for(a=o.prev?o.prev.x:tsfirst.x,$=0;o;o=o.next)if(l=o.a_ly?o.a_ly[t]:null)l.font!=gene.curfont&&(gene.curfont=l.font),n=l.t,i=l.w,f=l.shift,c&&("_\n"==n?n="-\n":"-\n"!=n&&(out_hyph(a,r,o.x-f-a),c=!1,a=o.x+o.wr)),u&&"_\n"!=n&&(out_wln(a+3,r,$-a+3),u=!1,a=o.x+o.wr),"-\n"!=n&&"_\n"!=n?($=o.x-f,"\n"==n.slice(-1)&&(n=n.slice(0,-1),c=!0),(user.anno_start||user.anno_stop)&&(s={st:o.st,istart:l.istart,iend:l.iend,x:$,y:r,ymn:r,ymx:r+gene.curfont.size,wl:0,wr:i},anno_start(s,"lyrics")),xy_str($,r,n),anno_stop(s,"lyrics"),a=$+i):(0==$&&a>o.x-18&&(a=o.x-18),"-"==n[0]?c=!0:u=!0,$=o.x-f);else switch(o.type){case C.REST:case C.MREST:u&&(out_wln(a+3,r,$-a),u=!1,a=o.x+o.wr)}for(c&&(c=!1,$=realwidth-10,$<a+10&&($=a+10),out_hyph(a,r,$-a),cfmt.hyphencont&&(e.hy_st|=1<<t)),e.s_next;o;o=o.next)if(o.type==C.NOTE){if(!o.a_ly)break;l=o.a_ly[t],l&&"_\n"==l.t&&(u=!0,($=realwidth-15)<a+12&&($=a+12));break}u&&(out_wln(a+3,r,$-a+3),u=!1)}function draw_lyrics(e,t,r,n,a){var i,o,s=staff_tb[e.st].staffscale;if(set_font("vocal"),a>0){for(n>-cfmt.vocalspace&&(n=-cfmt.vocalspace),n*=s,i=0;i<t;i++)n-=1.1*r[i],draw_lyric_line(e,i,n);return(n-r[i-1]/6)/s}for(o=staff_tb[e.st].topbar+cfmt.vocalspace,n<o&&(n=o),n*=s,i=t;--i>=0;)draw_lyric_line(e,i,n),n+=1.1*r[i];return n/s}function draw_all_lyrics(){var e,t,r,n,a,i,o,s,l,c,u=new Array(nstaff),$=voice_tb.length,f=new Array($),p=new Array($),d=new Array($),h=new Array($),_=0,g=0,m=-1;for(r=0;r<$;r++)if(e=voice_tb[r],e.sym){if(e.st!=m&&(_=0,g=0,m=e.st),n=0,e.have_ly){for(f[r]||(f[r]=[]),t=e.sym;t;t=t.next)if(l=t.a_ly){for(i=t.x,s=10,a=0;a<l.length;a++)if((c=l[a])&&0!=c.w){i-=c.shift,s=c.w;break}for(o=y_get(e.st,1,i,s),_<o&&(_=o),o=y_get(e.st,0,i,s),g>o&&(g=o);n<l.length;)f[r][n++]=0;for(a=0;a<l.length;a++)(c=l[a])&&(!f[r][a]||c.font.size>f[r][a])&&(f[r][a]=c.font.size)}}else o=y_get(e.st,1,0,realwidth),_<o&&(_=o),o=y_get(e.st,0,0,realwidth),g>o&&(g=o);u[m]||(u[m]={}),u[m].top=_,u[m].bot=g,p[r]=n,0!=n&&(e.pos.voc?d[r]=e.pos.voc==C.SL_ABOVE:voice_tb[r+1]&&voice_tb[r+1].st==m&&voice_tb[r+1].have_ly?d[r]=!0:d[r]=!1,d[r]?u[m].a=!0:u[m].b=!0)}for(a=0,r=0;r<$;r++)e=voice_tb[r],e.sym&&e.have_ly&&(d[r]?h[a++]=r:(m=e.st,set_dscale(m,!0),p[r]>0&&(u[m].bot=draw_lyrics(e,p[r],f[r],u[m].bot,1))));for(;--a>=0;)r=h[a],e=voice_tb[r],m=e.st,set_dscale(m,!0),u[m].top=draw_lyrics(e,p[r],f[r],u[m].top,-1);for(r=0;r<$;r++)if(e=voice_tb[r],e.sym){if(m=e.st,u[m].a)for(_=u[m].top+2,t=e.sym.next;t;t=t.next)t.a_ly&&y_set(m,1,t.x-2,10,_);if(u[m].b)if(g=u[m].bot-2,p[e.v]>0)for(t=e.sym.next;t;t=t.next)t.a_ly&&y_set(m,0,t.x-2,10,g);else y_set(m,0,0,realwidth,g)}}function parse_gchord(e){function t(){for(var e="";;){if(r=n[s++],"1234567890.-".indexOf(r)<0)return parseFloat(e);e+=r}}var r,n,a,i,o,e,s,l,c,u=get_font("annotation"),$=u.size,f=parse.line;if(l=parse.bol+f.index,e.length>1)n=e.slice(1,-1),c=l+1;else{for(n="";;){if(!(r=f.next_char()))return void syntax(1,"No end of guitar chord");if('"'==r)break;"\\"==r&&(n+=r,r=f.next_char()),n+=r}c=parse.bol+f.index+1}if(curvoice.pos.gch!=C.SL_HIDDEN)for(s=0,e="g";;){if(!(r=n[s]))break;switch(a={text:"",istart:l,iend:c,font:u},r){case"@":e=r,s++,i=t(),","!=r?(syntax(1,"',' lacking in annotation '@x,y'"),o=0):(o=t()," "!=r&&s--),a.x=i,a.y=o-$/2;break;case"^":case"_":case"<":case">":s++,e=r;break;default:switch(e){case"g":a.font=get_font("gchord");break;case"@":a.x=i,o-=$,a.y=o-$/2}}for(a.type=e;;){if(!(r=n[s]))break;switch(r){case"\\":if(!(r=n[++s])||"n"==r)break;a.text+="\\";default:a.text+=r,s++;continue;case"&":for(;;){switch(a.text+=r,r=n[++s]){default:continue;case";":case void 0:case"\\":}break}if(";"==r){a.text+=r;continue}break;case";":}s++;break}a_gch||(a_gch=[]),a_gch.push(a)}}function gch_tr1(e,t){var r,n,a,i,o,s,l,c,u=0;switch(e[0]){case"A":n=5;break;case"B":n=6;break;case"C":n=0;break;case"D":if("o"==e[1]){u++,n=0;break}n=1;break;case"E":n=2;break;case"F":"a"==e[1]&&u++,n=3;break;case"G":n=4;break;case"L":u++,n=5;break;case"M":u++,n=2;break;case"R":u++,n=1;break;case"S":u++,"o"==e[1]?(u++,n=4):n=6;break;case"/":u--;break;default:return e}if(s=0,l=u+1,u>=0){for(;"#"==e[l];)s++,l++;for(;"b"==e[l];)s--,l++;i=cde2fcg[n]+t+7*s,o=cgd2cde[(i+112)%7],a=(159+((i+22)/7|0))%5,r=(u?latin_names[o]:note_names[o])+acc_name[a]}else r="";return(c=e.indexOf("/",l))<0?r+e.slice(l):(n=note_names.indexOf(e[++c]))<0?r+e.slice(l):(r+=e.slice(l,c),s=0,"#"==e[++c]?(s++,"#"==e[++c]&&(s++,c++)):"b"==e[c]&&(s--,"b"==e[++c]&&(s--,c++)),i=cde2fcg[n]+t+7*s,o=cgd2cde[(i+112)%7],a=(159+((i+22)/7|0))%5,r+note_names[o]+acc_name[a]+e.slice(c))}function gch_transp(e){for(var t,r,n,a=0,i=curvoice.ckey.k_sf-curvoice.okey.k_sf;;){if(!(t=e.a_gch[a++]))return;"g"==t.type&&(r=t.text,n=r.indexOf("\t"),n>=0&&(n++,r=r.slice(0,n)+gch_tr1(r.slice(n),i)),t.text=gch_tr1(r,i))}}function gch_build(e){var t,r,n,a,i=curvoice.pos.gch==C.SL_BELOW?-1:1,o=0,s=0,l=0,c=0,u=cfmt.gchordbox;for(e.a_gch=a_gch,a_gch=null,curvoice.vtransp&&gch_transp(e),a=0;a<e.a_gch.length;a++){if(t=e.a_gch[a],"g"==t.type)cfmt.chordnames&&(t.otext=t.text,t.text=t.text.replace(/A|B|C|D|E|F|G/g,function(e){return cfmt.chordnames[e]}),"H"==cfmt.chordnames.B&&(t.text=t.text.replace(/Hb/g,"Bb"))),t.text=t.text.replace(/##|#|=|bb|b/g,function(e){switch(e){case"##":return"&#x1d12a;";case"#":return"";case"=":return"";case"b":return""}return"&#x1d12b;"});else if(t.text=cnv_escape(t.text),"@"==t.type&&!user.anno_start&&!user.anno_stop)continue;switch(gene.curfont=t.font,r=strwh(t.text),t.w=r[0],t.type){case"@":break;case"^":n=.4*r[0],n>8&&(n=8),t.x=-n,o-=r[1],t.y=o;break;case"_":n=.4*r[0],n>8&&(n=8),t.x=-n,s-=r[1],t.y=s;break;case"<":t.x=-(r[0]+6),l-=r[1],t.y=l+r[1]/2;break;case">":t.x=6,c-=r[1],t.y=c+r[1]/2;break;default:t.box=u,n=.4*r[0],n>8&&(n=8),t.x=-n,i<0?(s-=r[1],t.y=s,u&&(s-=2,t.y-=1)):(o-=r[1],t.y=o,u&&(o-=2,t.y-=1))}}for(l/=2,c/=2,a=0;a<e.a_gch.length;a++)switch(t=e.a_gch[a],t.type){case"^":t.y-=o;break;case"<":t.y-=l;break;case">":t.y-=c;break;case"g":i>0&&(t.y-=o)}}function draw_gchord(e,t,r){var n,a,i,o,s,l,c,u,$,f,p,d=e.a_gch[0].w,h=y_get(e.st,1,e.x-2,d),_=y_get(e.st,0,e.x-2,d),g=3*((e.notes[e.nhd].pit+e.notes[0].pit>>1)-18);for(o=0;o<e.a_gch.length&&(n=e.a_gch[o],!("g"==n.type&&(a=n,n.y<0)));o++);for(a&&(a.y>=0?h<r&&(h=r):_>t&&(_=t)),set_dscale(e.st),o=0;o<e.a_gch.length;o++){switch(n=e.a_gch[o],use_font(n.font),set_font(n.font),p=n.font.size,d=n.w,s=e.x+n.x,i=n.text,n.type){case"_":l=n.y+_,y_set(e.st,0,s,d,l-.2*p-2);break;case"^":l=n.y+h,y_set(e.st,1,s,d,l+.8*p+2);break;case"<":e.notes[0].acc&&(s-=e.notes[0].shac),l=n.y+g-p/2;break;case">":s+=e.xmx,e.dots>0&&(s+=1.5+3.5*e.dots),l=n.y+g-p/2;break;default:if(f=n.box?3:2,n.y>=0?(l=n.y+h,y_set(e.st,!0,s,d,l+p+f)):(l=n.y+_,y_set(e.st,!1,s,d,l-f)),(u=i.indexOf("\t"))>=0){s=realwidth;for(var m=e.next;m;m=m.next){switch(m.type){default:continue;case C.NOTE:case C.REST:case C.BAR:s=m.x}break}for($=2;!((u=i.indexOf("\t",u+1))<0);)$++;var y=(s-e.x)/$;for(s=e.x,l*=staff_tb[e.st].staffscale,user.anno_start&&user.anno_start("gchord",n.istart,n.iend,s-2,l+p+2,d+4,p+4,e),u=0,$=u;!((u=i.indexOf("\t",$))<0);)xy_str(s,l,i.slice($,u),"c"),s+=y,$=u+1;xy_str(s,l,i.slice($),"c"),user.anno_stop&&user.anno_stop("gchord",n.istart,n.iend,e.x-2,l+p+2,d+4,p+4,e);continue}break;case"@":l=n.y+g,l>0?(c=l+p)>staff_tb[e.st].ann_top&&(staff_tb[e.st].ann_top=c):l<staff_tb[e.st].ann_bot&&(staff_tb[e.st].ann_bot=l)}user.anno_start&&user.anno_start("annot",n.istart,n.iend,s-2,l+p+2,d+4,p+4,e),n.box?xy_str_b(s,l,i):xy_str(s,l,i),user.anno_stop&&user.anno_stop("annot",n.istart,n.iend,s-2,l+p+2,d+4,p+4,e)}}function psdeco(){return!1}function psxygl(){return!1}function set_hooks(){function set_hs(hs){for(var of,h,k=0;k<hs.length;k++)h=hs[k],"string"==typeof h?self[h]||eval("self."+h+"="+h):eval("of="+h[0]+";"+h[0]+"="+h[1]+".bind(self,of)")}var h=abc2svg.modules.hooks,gh=abc2svg.modules.g_hooks;hook_init?h.length&&(set_hs(h),gh.push.apply(gh,h),abc2svg.modules.hooks=[]):(h.length&&(gh.push.apply(gh,h),abc2svg.modules.hooks=[]),set_hs(gh),hook_init=!0)}var C=abc2svg.C,require=empty_function,system=empty_function,write=empty_function,XMLHttpRequest=empty_function;this.user=user;var OPEN_BRACE=1,CLOSE_BRACE=2,OPEN_BRACKET=4,CLOSE_BRACKET=8,OPEN_PARENTH=16,CLOSE_PARENTH=32,STOP_BAR=64,FL_VOICE=128,OPEN_BRACE2=256,CLOSE_BRACE2=512,OPEN_BRACKET2=1024,CLOSE_BRACKET2=2048,MASTER_VOICE=4096,IN=96,CM=37.8,YSTEP=256,errs={bad_char:"Bad character '$1'",bad_val:"Bad value in $1",bar_grace:"Cannot have a bar in grace notes",ignored:"$1: inside tune - ignored",misplaced:"Misplaced '$1' in %%staves",must_note:"!$1! must be on a note",must_note_rest:"!$1! must be on a note or a rest",nonote_vo:"No note in voice overlay",not_enough_n:"Not enough notes/rests for %%repeat",not_enough_m:"Not enough measures for %%repeat",not_ascii:"Not an ASCII character"},glovar={meter:{type:C.METER,wmeasure:1,a_meter:[]}},info={},mac={},maci=new Int8Array(128),parse={ctx:{},prefix:"%",state:0,line:new scanBuf},psvg,dd_tb={},a_de,od,decos={dot:"0 stc 5 1 1",tenuto:"0 emb 5 3 3",slide:"1 sld 3 7 0",arpeggio:"2 arp 12 10 0",roll:"3 roll 7 6 6",fermata:"3 hld 12 7 7",emphasis:"3 accent 7 4 4",lowermordent:"3 lmrd 10 5 5",coda:"3 coda 24 10 10",uppermordent:"3 umrd 10 5 5",segno:"3 sgno 22 8 8",trill:"3 trl 14 5 5",upbow:"3 upb 10 5 5",downbow:"3 dnb 9 5 5",gmark:"3 grm 6 5 5",wedge:"3 wedge 8 3 3",turnx:"3 turnx 10 0 5",breath:"3 brth 0 1 20",longphrase:"3 lphr 0 1 1",mediumphrase:"3 mphr 0 1 1",shortphrase:"3 sphr 0 1 1",invertedfermata:"3 hld 12 7 7",invertedturn:"3 turn 10 0 5",invertedturnx:"3 turnx 10 0 5",0:"3 fng 8 3 3 0",1:"3 fng 8 3 3 1",2:"3 fng 8 3 3 2",3:"3 fng 8 3 3 3",4:"3 fng 8 3 3 4",5:"3 fng 8 3 3 5",plus:"3 dplus 7 3 3","+":"3 dplus 7 3 3",accent:"3 accent 6 4 4",">":"3 accent 6 4 4",marcato:"3 marcato 9 3 3","^":"3 marcato 9 3 3",mordent:"3 lmrd 10 5 5",open:"3 opend 10 3 3",snap:"3 snap 14 3 3",thumb:"3 thumb 14 3 3",dacapo:"3 dacs 16 20 20 Da Capo",dacoda:"3 dacs 16 20 20 Da Coda","D.C.":"3 dacs 16 10 10 D.C.","D.S.":"3 dacs 16 10 10 D.S.","D.C.alcoda":"3 dacs 16 38 38 D.C. al Coda","D.S.alcoda":"3 dacs 16 38 38 D.S. al Coda","D.C.alfine":"3 dacs 16 38 38 D.C. al Fine","D.S.alfine":"3 dacs 16 38 38 D.S. al Fine",fine:"3 dacs 16 10 10 Fine",turn:"3 turn 10 0 5","trill(":"3 ltr 8 0 0","trill)":"3 ltr 8 0 0",f:"6 pf 18 1 7",ff:"6 pf 18 2 10",fff:"6 pf 18 4 13",ffff:"6 pf 18 6 16",mf:"6 pf 18 6 13",mp:"6 pf 18 6 16",p:"6 pf 18 2 8",pp:"6 pf 18 5 14",ppp:"6 pf 18 8 20",pppp:"6 pf 18 10 25",pralltriller:"3 umrd 10 5 5",sfz:'6 sfz 18 4 10 ""',ped:"4 ped 20 0 0","ped-up":"4 pedoff 20 0 0","crescendo(":"7 cresc 18 0 0","crescendo)":"7 cresc 18 0 0","<(":"7 cresc 18 0 0","<)":"7 cresc 18 0 0","diminuendo(":"7 dim 18 0 0","diminuendo)":"7 dim 18 0 0",">(":"7 dim 18 0 0",">)":"7 dim 18 0 0","-(":"8 gliss 0 0 0","-)":"8 gliss 0 0 0","~(":"8 glisq 0 0 0","~)":"8 glisq 0 0 0","8va(":"3 8va 10 0 0","8va)":"3 8va 10 0 0","8vb(":"4 8vb 10 0 0","8vb)":"4 8vb 10 0 0","15ma(":"3 15ma 10 0 0","15ma)":"3 15ma 10 0 0","15mb(":"4 15mb 10 0 0","15mb)":"4 15mb 10 0 0",invisible:"32 0 0 0 0",beamon:"33 0 0 0 0",trem1:"34 0 0 0 0",trem2:"34 0 0 0 0",trem3:"34 0 0 0 0",trem4:"34 0 0 0 0",xstem:"35 0 0 0 0",beambr1:"36 0 0 0 0",beambr2:"36 0 0 0 0",rbstop:"37 0 0 0 0","/":"38 0 0 6 6","//":"38 0 0 6 6","///":"38 0 0 6 6","beam-accel":"39 0 0 0 0","beam-rall":"39 0 0 0 0",stemless:"40 0 0 0 0",rbend:"41 0 0 0 0"},f_near=[!0,!0,!0],f_note=[!1,!1,!1,!0,!0,!0,!1,!1,!0],f_staff=[!1,!1,!1,!1,!1,!1,!0,!0],func_tb=[d_near,d_slide,d_arp,d_upstaff,d_upstaff,d_trill,d_pf,d_cresc],ottava={"8va(":1,"8va)":1,"15ma(":1,"15ma)":1,"8vb(":1,"8vb)":1,"15mb(":1,"15mb)":1},STEM_MIN=16,STEM_MIN2=14,STEM_MIN3=12,STEM_MIN4=10,STEM_CH_MIN=14,STEM_CH_MIN2=10,STEM_CH_MIN3=9,STEM_CH_MIN4=9,BEAM_DEPTH=3.2,BEAM_OFFSET=.25,BEAM_SHIFT=5,BEAM_SLOPE=.4,BEAM_STUB=8,SLUR_SLOPE=.5,GSTEM=15,GSTEM_XOFF=2.3,cache,min_tb=[[STEM_MIN,STEM_MIN,STEM_MIN2,STEM_MIN3,STEM_MIN4,STEM_MIN4],[STEM_CH_MIN,STEM_CH_MIN,STEM_CH_MIN2,STEM_CH_MIN3,STEM_CH_MIN4,STEM_CH_MIN4]],sharp_cl=new Int8Array([24,9,15,21,6,12,18]),flat_cl=new Int8Array([12,18,24,9,15,21,6]),sharp1=new Int8Array([-9,12,-9,-9,12,-9]),sharp2=new Int8Array([12,-9,12,-9,12,-9]),flat1=new Int8Array([9,-12,9,-12,9,-12]),flat2=new Int8Array([-12,9,-12,9,-12,9]),rest_tb=["r128","r64","r32","r16","r8","r4","r2","r1","r0","r00"],musicfont='url("data:application/font-ttf;base64,AAEAAAANAIAAAwBQRkZUTX30pOoAACfYAAAAHE9TLzJYnlnxAAABWAAAAFZjbWFwN+qJgQAAAsAAAAIqY3Z0IAAiAogAAATsAAAABGdhc3D//wADAAAn0AAAAAhnbHlmirg/swAABXwAAB4caGVhZAsOgeEAAADcAAAANmhoZWEIoQEcAAABFAAAACRobXR4cVoAlAAAAbAAAAEObG9jYQpbAnAAAATwAAAAim1heHAAiwDcAAABOAAAACBuYW1lNpjajAAAI5gAAAGDcG9zdA9CdgsAACUcAAACsQABAAAAAQAAtjNVVF8PPPUACwQAAAAAANGXIhcAAAAA1qodLf+6/QwD9ASUAAAACAACAAAAAAAAAAEAAASU/QwAXAQN/7r/vwP0AAEAAAAAAAAAAAAAAAAAAABDAAEAAABEAKsABQAAAAAAAgAAAAEAAQAAAEAALgAAAAAAAQG7AZAABQAIApkCzAAAAI8CmQLMAAAB6wAzAQkAAAIABQMAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUGZFZABAAADpXAMz/zMAXASUAvQAAAABAAAAAAAAAXYAIgAAAAABVQAAAZAAAABXAAAB4P/cA14AegMLAAAC0gAAAr//ugHWAAADCwAAAw4AAAMn/8gBrgAAASIAAAGQAAABfAAAAZAAAAGQAAABgQAAAZAAAAGQAAABgQAAAZkACQGYAAkB9AAAAQQAFAEEAAoCEQAAAhwAAAHAAAABSQAAAUoAAAFK//4BLAAAAjAAAAHgAAABDQAyAMgAAAENAAABCwAUAW4AAAENADIBQP/9ARgAAAJYAAAAtgAAAIIAAACCAAABLAAAASwAAADuAAAA/wAAAUkAAAGPAAAB2AAAAdgAAANTAAACM//wAyD/4QG1AAABtQAAAkQADQJEAA0EDQAAAhwADAAAAAAAAAADAAAAAwAAABwAAQAAAAABJAADAAEAAAAcAAQBCAAAAD4AIAAEAB4AAOAA4EjgUOBc4GLgaeB84IzgleCk4Kngs+EB4efiZOKA5KDkrOTA5M7k6uTu5QHlZ+Vp5W3mUOZV6Vz//wAAAADgAOBH4FDgXOBi4GngeuCA4JTgoOCp4LPhAeHn4mDigOSg5KzkwOTO5OHk7uUA5WflaeVs5lDmVelc//8AAyAEH74ftx+sH6cfoR+RH44fhx99H3kfcB8jHj4dxh2rG4wbgRtuG2EbTxtMGzsa1hrVGtMZ8RntFucAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBgAAAwAAAAAAAAABAgAAAAIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACICiAAAACoAKgAqADYAZgDOARABpgI4ApICpgNCA9QELAROBGIEtAUEBSQFagWqBeQGMAZwBrYHEAckB0oHcAesB8gH9ggiCDwIVgiMCJoIrAjSCOwJHAlGCaIJyAnwCgAKKApOCloKZgpyCn4KoArGCvwLSguqDB4MNAxaDIgMzA0WDTANVA40DvAPDgAAAAIAIgAAATICqgADAAcALrEBAC88sgcEAO0ysQYF3DyyAwIA7TIAsQMALzyyBQQA7TKyBwYB/DyyAQIA7TIzESERJzMRIyIBEO7MzAKq/VYiAmYAAAEAAAAAAZEBkAADAAAxESERAZEBkP5wAAEAAAAAAFcEAwAgAAARNTY1NCcmNTQ3BhUUFxYVFAcWFRQHBhUUFyY1NDc2NTQ1IxJXPxUlTU0lFT9XEiMCAwIYQzZgOTRmOjJLIjlhTWEYGGZMYDklSjI6ZjQ5YDZIAAP/3AACAd4CswAHAA8ARwAAACImNDYyFhQEIiY0NjIWFBc0NjMyFhUUBxYzMjY1NCcmJwMnEyY1NDc2MhYVFAYjIiY1NDcmIyIGFRQXFhcTFwMWFRQHBiImAZ4gGBggGP5+IBgYIBhbGxQTHiwYKCdBMDxBzyvTmDgoYDgbFBMeLBgoJ0EwQTvUK9eYOChgOAFSGCAYGCBUGCAYGCDYEhwaER0OGC8lKDAtOP7eIAEmj2A1LxQzIRIcGhEdDhgvJSgwMTQBJh/+1pBgNS8UMwAFAHr/NANeAlQAFwAbAB8AIwAnAAABMxUeARczFSMOAQcVIzUuAScjNTM+ATcRIxYXNxU2NyczJicHNQYHAdgoVXgHiooHeFUoVXgHiooHeFVwBWsoawVwcAVrKGsFAlSJCItgKGCLCImJCItgKGKJCP7lug7IyA66KLoOyMkOuwAAAAAEAAD9gQKnBJQAPwBGAFoAZwAAATYzMhYXFhUUBwYHFxYVFAYjIiY1NDYzMhYVFAYHFjMyNTQvAQYjIiY1NDc+ATc+AjcuAjU0NjceARUUBgcbATY1NCYjCwEOARUUFy4BNTQ2NycOAQcSITIDBhUUFz4BNTQmJw4BAY8SCzVnID98QisQAkVPUWBAMi5CPjAbKmUBEQscr8E5El4mBi0wFwMKBW9ROx5beR8fq25OFSA3Ry8yM2BJEY9sAQUBLwQpBAdJcBgaO0UBCgIqJkR7lDwiBLsgDlBNWEEsQEQtKzIBD4ASCr4Bt6yEZiNkHgUoKBEhdUgdip4YQHlyiahf/rX+nieRQGr+ngFeCkAwLToMWjpGYhS9cpdn/tYEDiEuUiMxj0gpTw8HdwACAAD9/ALSAgAAZABoAAABMjY1NCcmIyIHDgIHJicmJxEjETMRNjc2Nx4DFxYzMjY1NCcmIyIHFhcUFhUUBisBJjU0NzY3NjMyFxYXFRQGBwYjIicHFzYzMhYXFh0BBgcGIyImNTQ3MzIWFRQGFQYHFgEzESMB3j5KDRpJRjwCBgoEIhoeLhwcLh4aIgYUDBkPJyUxPRIkUi8xMg0CMyEFRAUaVScjXlU3CFpIHy00PyIiPzRCZh4oCDdWXUxyRAUhMwIPMDX+TXt7/iB4Si0tbEkFDhsKYicrH/4EBAD+ER8rJ2ILKhcdCRt7QjE2YhoQKAMNBB4rGTIUC0QZDU80UxJObxwNF0tKFz4sOUMSUzRQTjwyGSseBA4EJhAcA978AAAAA/+6/aUCwwD/ACYAMQA9AAA3NDYzMhcWFRQHDgEHNjc2NzY1NCcuASMiBgc+ATMyFhUUBwYjIiYFIiY1NDYyFhUUBiciJjU0NjMyFhUUBhOMZqNLLJdU9oTwdVskCzgeOSg8Zg0XGxwuRychLThGAoIWHRkqHhoaFxsaFxQcGylgdm1Bb/aISm4HQH1erj0xfkEhGFJEHRBLLzIgHmeSHBcWHB0VFh3yHhkWGRsUGR4AAAAAAgAA/wYBcgD6AAMABwAANzMTIwMzEyPclAKW3JQClvr+DAH0/gwAAAQAAP4KAh8DqgAJACAAYgBtAAAlFhc+ATU0JiMiAwInDgEVFBcuATU0NjcmJw4BBx4BMzIXHgEfAR0BFCMiJjU0NjMyFhUUBgcWMzI2NTQvAQYjIiY1NDc+ATc+AjcmNTQ2Nx4BFRQGBx4BFzYzMhcWFRQHBgMGFRQXPgE1NCcGAUkTBk1HVkIODRgBLDkfICpMOwUJcVUBBW2CAyIDBgICejZTMyglNTEnFSIjLAENCRWNmS4OTB4FIycSDllALxlJYQIIBBIIXDkyYzZkAwY3XilfdcRbEk8zNlb+4AELEAk0JykmEkEpOE4QPlpaeVNxfhogQBcXGwd/SDEkMzckIigBDDM1DwmNAZKKalEcUBgEICENwgdufxMzYltth0wRbiQCQzZidzAbA1YeIjkkJXszRiYmAAIAAP5jAkIBmgBjAGcAAAEyNjU0JyYjIgcOAQcmJyYnESMRMxE2NzY3HgMXFjMyNjU0JyYjIgcWFxQWFRQGKwEmNTQ3Njc2MzIXFhcVFAYHBiMiJwcXNjMyFhcWHQEGBwYjIiY1NDczMhYVFAYVBgcWATMRIwF+MjsKFTo4MAIMBB0TGCUWFiUYEx0EEQoTDCAdJzEOHEMlJygKAioaBDYEFUQjGElGLQZIOhglKzEbGzQoNVIYIAYtRkk9WzYEGioCDCYr/qNiYv6AYDskJFc7BR0LUhwiGf5qAzP+dBkiHFIIIhIXCBZiNSsoThUNIAILAxgiFCgQCTUVC0ArQQ4+WhYKEjw7EzIjLjUPQStAPzAoFCMYAwsDHw0WAxj8zQAAAAAD/8j+HgI2AMwAJgAvADsAADc0NjMyFxYVFAcOAQc2NzY3NjU0Jy4BIyIGBz4BMzIWFRQHBiMiJgUiJjQ2MhYUBiciJjU0NjMyFhUUBg9wUoI8I3hDxmnAXkceCS0YLSAwUgoSFhYlOSAZJSw5AgISFxQiGBUVEhYVEhEWFSFNXlczWsZsO1cGM2RKjC8pZjMaFEI2Fw08JigaGFN1FyQWFyIYwhgUERQVEBMZAAAAAAIAAP8GAa4A+gALABQAADMUFjMyNjU0JiMiBgc0NjIWFAYiJooqIyIrJyYlKIp9tH19tH1ieHlhZXV2YWeQkdKRkgAAAQAA/wYBIgD6AAkAADE3MxEXFSM1NxFkfUHwQfr+Ph4UFB4BLAAAAAEAAP8GAY8A+gA8AAA3MhUUBw4DBzYzMhYzMjc+AjMOAgcGBwYjIiYjIgYjIjU0Jz4FNTQnIgcyFhUUBiMiNTQ+AcfIBQ02QG82EyAbZBwYHgUQDAEBBQUBBxAaKRp0FR9WAgcBAiw+RzwoU04aHCk3Hkw8WPp+Gg4hLh1ELQwjDgMNCwUWFgMpDhgnJhABAiFFODwyOBhiATUlHh8pZyg5GQAAAQAA/wYBdQD6ADkAADcyFhUUBiMiJjU0NzYzMhcWFRQGBx4BFRQHBiMiJicmNDYzMhYVFAYjFjMyNjU0JicmNDc+ATQmIyJmGyInIRsyHzNZRiZERj0+UUskTSdXGCMyICIqJRsMPyQrSC4WFi9LKSQ8qhwXGyMrIy8aKhMiSC5ECwtFLUMnExYUHUwuIRsZHikxJyY6CAQiBAk3UDAAAAEAAP8GAZAA+gARAAAFFyM3NSM1NjUzATM/AREzFSMBRTLIMuGTo/77sAFjS0vRKSkxKPKA/o6Wkf7ZKAAAAAABAAD/BwF+APoALwAAFzYzMhYVFAYjFjMyNz4BNTQnJiMiBxMhDgErAQc2MzIXHgEVFAcOAiMiJy4BNTQSHCEbKiAcGiQxHBMJHhwoTkgKAWILNSXVBjlCUzEhK0MWQCslPCsQHl8gIBccICEeFB8gORwaNQEiJDp5Hh8VQSVPLxAQAhQJMhIjAAAAAAIAAP8GAYEA+gAJACwAABcyNjU0JiMiBxYTFhUUBiMiJjU0NjMmIyIGFT4CMzIWFRQGIyImJz4BMzIWyCktKigsMAfdGyMYHiIbEBY3NS8VGC0eTE9xSGFmAQFsWzA/0kUsIjAlngGfGiYZKB4bDB4jeF8LCglANkRZgnhpkRIAAQAA/wYBkAD7ACgAADciDgMHNz4IMzIWMzI2Nw4EFSM2NzY3NjcGIyImYRQaFAkRBQoBDAILBQsJDRAJL3UjGjsRG0UaHgiCAQgRaB4tER4lYKEFDgkbBnQBCwIJAQYBAwEmFw5Dp0FcQitFGzaHJzkKKAADAAD/BgGEAPoADgAcADQAABcOARUUFjMyNjU0LgM3PgE1NCYiBhUUHgMHLgE1NDY3MhYVFAYHHgEVFAYjIiY1NDaaNixYLCo/DyAdMT4zI0RSMwocEjFwMSlmSktlKjA6MnVNTHY5KhkkGx0wKR8OFxINE1oaIhwdMCggDxcTChU/GDw1M00BRjInNBcaOjU3SkgwJDUAAAIAAP8GAYEA+gAJACwAADciBhUUFjMyNyYDJjU0NjMyFhUUBiMWMzI2NQ4CIyImNTQ2MzIWFw4BIyImuSktKigsMAfdGyMYHiIbEBY3NS8VGC0eTE9xSGFmAQFsWzA/0kUsIjAlnv5hGiYZKB4bDB4jeF8LCglANkRZgnhpkRIAAQAJ/woBmQD5ADAAACUwFzY1NCYjDgEVFBcWMzI3NjcUHgEVDgEHIicmJzQmNTQ3MhYXFhUUBiMiJjU+ATMBLxIEPB8yQSchMCsoHCoJCBtVVk87OwQB2yRAESIkHCApAiAapAMFCBQiAmVrjjMqIhhYAQQDAVVQATk5ZgIrAuYCHhQnJCU5LhwWJgACAAn+ogGZAV4AOAA/AAAlMBc2NTQmIyIHERYzMjc2NxQeARUOAQcjFSM1JicmJzQmNTQ3NTMVMjYzMhYXFhUUBiMiJjU+ATMDEQYVFBcWAS8SBDwfAxAMDCsoHCoJCBtRVQEjPS47BAGrIwMHAyRAESIkHCApAiAaej0nCqQDBQgUIgT+SwQiGFgBBAMBVFEBaGsJLTlmAisCyxlpZgEeFCckJTkuHBYm/pcBli6RjjMNAAABAAD/BgH0APoACwAANTM1MxUzFSMVIzUj10bX10bXI9fXRtfXAAAAAQAU/gYA4wIAABMAABMWBwYnJgI1NBI3NhcWBwYCFRQS3AcNCQVJa2tJCQsGBjxGR/4WCAUDBlcBIH18ASJWCwcGCEn+54iG/uUAAAEACv4CANwB/QATAAATNhI1NAInJjc2FxYSFRQCBwYnJhQ7R0Y8CQwKB0lra0kICwb+FkkBG4aIARlJCwQECVb+3nx9/uBXCQkEAAAEAAD/TAIRAKoAAwAHABsAJQAAJTMRIwEzESM3BhUUFx4BFzMyNzY0Jy4BJzAjIgQUBiMiJjU0NjIB6Sgo/hcnJ5cFAwpVLg0zEwUDCVYuDTYBQXlnZnp5zqr+ogFe/qLzDA4LCyJHBCMJHAsiRwQmeEVEOD9HAAACAAD/JAIcANwAAwAPAAA3FSE1JTMVITUzESM1IRUjGQHq/f0ZAeoZGf4WGUaMjJYyMv5IMjIAAAIAAP9/AcAAgQATAB0AADcGFRQXHgEXMzI3NjQnLgEnMCMiBBQGIyImNTQ2Mm8FAwpVLg0zEwUDCVYuDTYBQXlnZnp5zj8MDgsLIkcEIwkcCyJHBCZ4RUQ4P0cAAgAA/2wBSACUAA0AGwAAJSYjIgYVFBcWMzI2NTQ3FhUUBiMiJyY1NDYzMgEkDSU8lwYLJjyXEA9+SE8kD35IT0QXYSsKCRdhKwkXHh1DZ0MeHUNnAAAAAAEAAP90AUoAiwAOAAAVNDY3NjMyFhUUBwYjIiZdSB4RM0OlGBsxQSE+VBMHODJ1MAg5AAAB//7/bwFMAJEACwAAJzcXNxcHFwcnByc3AhuMjBuGhhyLixyGcSB2dSBwcCF1dSFwAAAABQAA/2oBLACWAAUACwARABcAHwAAFwcWMzI3LwEGFRQXPwEmIyIHHwE2NTQnBjQ2MhYUBiKWRx0qKR9dRx0dXEgfKSodXEcdHfJYfFhYfBJIHR1aSR8pKh1YSB0dWkgfKSodhXxYWHxYAAAAAQAA/wYCMAD6AAMAABUBMwEBuHj+R/oB9P4MAAEAAP/OAGQAMgAHAAAWIiY0NjIWFEcqHR0qHTIdKh0dKgAAAAIAMv9kAQ0BsAAKABYAADciBh0BNjc2NTQmNzIWFRQHBiMRMxE2lBUqHCwuIAciOU9SOiMjeh4SywNCPzYbJiYyI0VQUgJM/rw0AAACAAD+hgDFAXoAAwAMAAAXNzUHERU3ESM1BxE3HJCQqRmsAWUtli0BSeg0/cDiMwJDAQAAAgAA/o8BDAF1AAMAHwAANxU3NQMjNQc1NzUHNTc1MxU3NTMVNxUHFTcVBxUjNQdSZmYZOTk5ORlmGDw8PDwYZk20HLX+Ja8RVQ63EFcOsqoat68PUxK0D1MPsaodAAAAAQAU/4QBCwB6AB4AABc1JicHMBUjNTM3JzAjNTMVFhc3MDUzFSMGBxcwMxXDKAwzSDkzMzlIIRI0SDkhEzQ5fDsmDTM7SjIySDkiETM5RyIRNEgABAAA/2oBbAGwABAAHgAtADwAADcOAR0BMjc2NzY3NjU0JyYjNzIWFRQHBgcGIxEzETYXDgEdATI3Njc2NTQnJiM3MhYVFAcGBw4BIxEzETZOER4LGwQCHwwEChARGR0rCRgrNS8fGdERHQ0hHQsGCxAPFh8qCxkoFjcWHht9AR4QyyYFAys0DRkeFBUmOSESIDk0QAJG/sEyJgEdEcsuLzATExwWFSY2JBYcPi8bJQJG/sEyAAAAAAIAMv9kAQ0BsAAKABYAADciBhUUFxYXNTQmJzIXETMRIicmNTQ2qxcgLi4aKjM6IyM6Uk85eiYbMEVCA8sSHiY0AUT9tFJQRSMyAAAB//0AAAE/APQAGAAANwYjIiY1ND8BNi8BJjU0NjMyMRcFFhUUBxICAwcJBs8ODs0ICwcBAgEfDg4BARAICgNJBwZPAwsKEgFrBg4NBQAAAAEAAAAAARgBNQAFAAAxGwEjJweMjEFYWgE1/svGxgAAAgAAAAACWAFKAA4AGQAAMTQ2MzIeAhUjLgEiBgchIiY0NjMyFhUUBrN5OWtVMwoLpuKmCwEhFyUlFxkjI5iyLFGATW6Ghm4kMCQkGBkjAAABAAAAAAC2AS0AFwAAEzIWFxYVFAcOASMnJjU0NjU0Iy4BNTQ2VhsbEBoyGUQQBgFHFBsoLQEtDBEdMD08HS0DAQIIaxMPASYcHjEAAQAA/wYAggD6AAMAADUzEyOAAoL6/gwAAQAAAAAAggD6AAMAADUzFSOCgvr6AAAAAQAA/4MBLAAAAAMAADEhFSEBLP7UfQAAAQAAAAABLAB9AAMAADUhFSEBLP7UfX0AAQAA/n4A6wGHABMAABMXBxcmIyIGFRQXJjU0NjMyFyc3Kb1nbDI0HyY4eDQlIiKHZAGH5dnPLiQdNTRLTSMtFby0AAABAAD/DQEAAMAAFgAANw4CIyImNTQ2MhYVFAcyNjc2MhcDJ6sDGRoTKzcmOCkXIjMhAhUDljA8AQcEKSgfIB4ZHRshLAIC/m8QAAAAAQAA/gwBSADAACQAABcGIyImNTQ2MzIWFRQHMj8BBiMiJjU0NjMyFhUUBzI3NjIXAyerKCErNycbHCkXQQs8NhgrNycbHCkXSC4CFQPFLcQMKCggIB8ZHRsiygwpKB8gHhkdG00CAv1uDAAAAQAA/gwBjwHAADYAADcGIyImNTQ2MzIWFRQHMj8BIg4BIyImNTQ2MzIWFRQHMjc2MhcBJxMGIyImNTQ2MzIWFRQHMjf2KB8rNycbHCkXPws6ASAcEys3JxscKRdILgEWA/70LVUoISs3JxscKRdBCzwMKCggIB8ZHRsiywkEKSgfIB4ZHRtNAgL8bgwBJAwoKCAgHxkdGyIAAAAAAQAA/QwB2gHAAEUAABMGIyImNTQ2MzIWFRQHMj8BBiMiJjU0NjMyFhUUBzI/AQYjIiY1NDYzMhYVFAcyPwEiDgEjIiY1NDYyFhUUBzI3NjIXASerKCErNycbHCkXQQs6KCErNycbHCkXQQs6KB8rNycbHCkXPws6ASAcEys3JjgpF0guAhUD/qkt/jwMKCggIB8ZHRsiygwoKCAgHxkdGyLKDCgoICAfGR0bIssJBCkoHyAeGR0bTQIC+24MAAAAAQAA/QwCGQKuAFYAACUGIyImNTQ2MzIWFRQHMj8BBiMiJjU0NjMyFhUUBzI/ASIOASMiJjU0NjMyFhUUBzI3NjIXAScTBiMiJjU0NjMyFhUUBzI/AQYjIiY1NDYzMhYVFAcyNwE/KCErNycbHCkXQQs2KB8rNycbHCkXPws0ASAcEys3JxscKRdILgEWA/5qLVUoISs3JxscKRdBCzooISs3JxscKRdBCzQMKCggIB8ZHRsixAwoKCAgHxkdGyLHCQQpKB8gHhkdG00CAvqADAEkDCgoICAfGR0bIsgMKCggIB8ZHRsiAAEAAP8aA1IA5gALAAA1MxUhNTMRIzUhFSMZAyAZGfzgGeZ9ff40fX0AAAAAA//w/wYCJgD6AAcADwATAAA2IiY0NjIWFAAiJjQ2MhYUBQEzAVAyIyMyIwGIMiMjMiP90gG4fv5HSyMyIyMy/s8jMiMjMloB9P4MAAT/4f8GAwcA+gAHAA8AEwAXAAA2IiY0NjIWFAAiJjQ2MhYUBQEzATMBMwFBMiMjMiMCdzIjIzIj/OMBuHv+R3kBuHv+R0sjMiMjMv7PIzIjIzJaAfT+DAH0/gwAAQAA//0BtQDUAC8AACUyNjU0JwYjIjU+ATMyFhUUBwYjIi8BJiMiBhUUFzYzMhUUByInJjU0NzYzFh8BFgF2FRwWFBIcAQ8JIC0pFxwkHqggDxYcFRQTHBkZGBwoFiAoF6giJSkcJxAMGw8VQiYzJBUVghYoHicPDB0gAxoiLTMkEwIQghcAAAEAAP/NAbUBAwA2AAAXIiY1NDc2MxYfATUzFRcWMzI2NTQnBiMiNT4BMzIWFRQHBiMiLwEVIzUnJiMiBhUUFzYzMhUUTSAtKBYgKBcuHlwiDxUcFhQSHAEPCSAtKRccJB4uHlwgDxYcFRQTHANDJjMkEwIQJGmARxcpHCcQDBsPFUImMyQVFSRsg0cWKB4nDwwdIAABAA0AAAJFAOAACwAANyc3FzcXNxcHJwcnIhWOZXhqTRaSaXRpLhmZfHx8VBehfHx8AAAAAQAN/8sCRQERABMAACUHJwcnNxc3NTMXNxc3FwcnBxUjARZAaUsVjmUWGwFGak8UkmkZG0ZGfE4ZmXwXlntKfFUYoXwblgAABAAA//wD9AJ/AAkAlACgAKoAAAUiJjQ2MzIWFAYlJjU0NzYzMhYVFAcOBwcWMzI2NTQ2Ny4CPQEeARUUBiMiJwYjIiYnDgEiJicmIyIGBwYjIjU0Njc+CTc2NTQmNTQ/AQ4BFDMyNxcOASMiJjU0PgIzMhYVFAYjIiYnNxYzMjY1NCYnBwYVFBYVFA8BHgEzMj4GNz4BNTQnJiMiBhUUBTY1NCYnDgEVFAPWCxMTCwwSEf3pIxwgThsjCgQMCxAKEgcSASosFTJDXSCBXrq0UUJBIyQ8IkETMCYgGxwaEg0tA1csCjohDhsPEQYKAwcDCQMCQgI0WnIgNRwQKTYwFBcfPXFIfntCJR05EQ0aNCEsXF8mAkYBJhE7DwQHBwkHDAgSLDUiBAQWHC8BPFoXEj8zAhIYEhIYEl84JTUlKykfIRMJEQ4QCg8GDgEzMBpSXxksWTQGATyxa0ZfOTooGCkbFiAtIwE6BwszFAgRBgwCEAMZDCkOCAIWQR4HDNcHWFAwCEUsIRofSEcvXDwlPispDC0dGyNJBaAIBhlEGggEowxYAgIHBAsHDyAwLyAHDhI5KyJwBYEiSRUdWUM+AAIADAAKAdMBzwAKAI8AACU0JiMiBhQWMzI2Jw4BIyImNDYzMhYXNjU0JyYjIiY0NjMyFx4BFxYzMjU0Jy4BNTQ2MzIWFRQGBxQzMjc+ATc2MzIWFRQGIyIGBwYVFDMyNjMyFhQGIyImIyIGFRQXHgEXFhUUBiMiJy4BJyYjIhUUFhUUBiMiJjQ2NTQjIgcOAQcGIyImNTQ3NjMyNzY1NAEWGA8QFRYPEBeJGSYOGRsaGQ0qGCUMFBgdHBkXEhALAxQLEhQBAiceFBIbIwEWEA0RAQ0MGhMeGxIbFQ0QIRsrDhwbHRkPJxQXEgsUOA0OGRcTFAwBExEKEiogExIdJhcNDhIDERIMFBoNDBYjEg3uEBQTIhYVCgElGSobJQIDFg4KExwoHQwLPhYNGA0IFycPFxobFhEjGSoQEzgPDhsUESMGCw4PFicdKBomCAoWChIDCw0ZExsOCzkVDx8eMBMUGBokMRckDhI9DAcWFBgODRINDBoAAAACAAD95AIdANwAAwAPAAA3FSE1JTMVITUzEyMDIRUjGQHq/f0ZAeoZARkB/hYZRoyMljIy/QgBcjIAAAAAAAwAlgABAAAAAAABAAcAEAABAAAAAAACAAcAKAABAAAAAAADACIAdgABAAAAAAAEAAcAqQABAAAAAAAFAAsAyQABAAAAAAAGAAcA5QADAAEECQABAA4AAAADAAEECQACAA4AGAADAAEECQADAEQAMAADAAEECQAEAA4AmQADAAEECQAFABYAsQADAAEECQAGAA4A1QBhAGIAYwAyAHMAdgBnAABhYmMyc3ZnAABSAGUAZwB1AGwAYQByAABSZWd1bGFyAABGAG8AbgB0AEYAbwByAGcAZQAgADIALgAwACAAOgAgAGEAYgBjADIAcwB2AGcAIAA6ACAAOQAtADMALQAyADAAMQA4AABGb250Rm9yZ2UgMi4wIDogYWJjMnN2ZyA6IDktMy0yMDE4AABhAGIAYwAyAHMAdgBnAABhYmMyc3ZnAABWAGUAcgBzAGkAbwBuACAAMQAuADAAAFZlcnNpb24gMS4wAABhAGIAYwAyAHMAdgBnAABhYmMyc3ZnAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEAAAAAQACAQIBAwEEAQUBBgEHAQgBCQEKAQsBDAENAQ4BDwEQAREBEgETARQBFQEWARcBGAEZARoBGwEcAR0BHgEfASABIQEiASMBJAElASYBJwEoASkBKgErASwBLQEuAS8BMAExATIBMwE0ATUBNgE3ATgBOQE6ATsBPAE9AT4BPwFAAUEBQgYubm9kZWYHdW5pRTAwMAd1bmlFMDQ3B3VuaUUwNDgHdW5pRTA1MAd1bmlFMDVDB3VuaUUwNjIHdW5pRTA2OQd1bmlFMDdBB3VuaUUwN0IHdW5pRTA3Qwd1bmlFMDgwB3VuaUUwODEHdW5pRTA4Mgd1bmlFMDgzB3VuaUUwODQHdW5pRTA4NQd1bmlFMDg2B3VuaUUwODcHdW5pRTA4OAd1bmlFMDg5B3VuaUUwOEEHdW5pRTA4Qgd1bmlFMDhDB3VuaUUwOTQHdW5pRTA5NQd1bmlFMEEwB3VuaUUwQTEHdW5pRTBBMgd1bmlFMEEzB3VuaUUwQTQHdW5pRTBBOQd1bmlFMEIzB3VuaUUxMDEHdW5pRTFFNwd1bmlFMjYwB3VuaUUyNjEHdW5pRTI2Mgd1bmlFMjYzB3VuaUUyNjQHdW5pRTI4MAd1bmlFNEEwB3VuaUU0QUMHdW5pRTRDMAd1bmlFNENFB3VuaUU0RTEHdW5pRTRFMgd1bmlFNEUzB3VuaUU0RTQHdW5pRTRFNQd1bmlFNEU2B3VuaUU0RTcHdW5pRTRFOAd1bmlFNEU5B3VuaUU0RUEHdW5pRTRFRQd1bmlFNTAwB3VuaUU1MDEHdW5pRTU2Nwd1bmlFNTY5B3VuaUU1NkMHdW5pRTU2RAd1bmlFNjUwB3VuaUU2NTUHdW5pRTk1QwAAAAAAAAH//wACAAAAAQAAAADVs2WlAAAAANGXIhcAAAAA1qodLQ==")',defined_font={},font_tb={},fid=1,font_scale_tb={serif:1.05,serifBold:1.05,"sans-serif":1.1,"sans-serifBold":1.1,Palatino:1.1,Mono:1.35},fmt_lock={},cfmt={aligncomposer:1,breaklimit:.7,breakoneoln:!0,cancelkey:!0,composerspace:6,dblrepbar:":][:",decoerr:!0,dynalign:!0,fullsvg:"",gracespace:new Float32Array([4,8,11]),graceslurs:!0,hyphencont:!0,indent:0,infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',infospace:0,keywarn:!0,leftmargin:1.4*CM,lineskipfac:1.1,linewarn:!0,maxshrink:.65,maxstaffsep:2e3,maxsysstaffsep:2e3,measurefirst:1,measurenb:-1,musicspace:6,parskipfac:.4,partsspace:8,pagewidth:21*CM,printmargin:0,rightmargin:1.4*CM,rbdbstop:!0,rbmax:4,rbmin:2,scale:1,slurheight:1,staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlespace:3,sysstaffsep:34,textspace:14,titlespace:6,titletrim:!0,topspace:22,tuplets:[0,0,0,0],vocalspace:10,writefields:"CMOPQsTWw",wordsspace:5},textopt={align:"j",center:"c",fill:"f",justify:"j",ragged:"f",right:"r",skip:"s"},posval={above:C.SL_ABOVE,auto:0,below:C.SL_BELOW,down:C.SL_BELOW,hidden:C.SL_HIDDEN,opposite:C.SL_HIDDEN,under:C.SL_BELOW,up:C.SL_ABOVE};Abc.prototype.style_font=style_font;var abc_utf={"=D":"","=H":"","=T":"","=d":"","=h":"","=t":"","/O":"","/o":"","/L":"","/l":"",vL:"",vl:"",vd:"",".i":"",AA:"",aa:"",AE:"",ae:"",DH:"",dh:"",OE:"",oe:"",ss:"",TH:"",th:""},oct_acc={1:"",2:"",3:"",4:"&#x1d12a;",5:"&#x1d12b;"},include=0;Abc.prototype.tosvg=tosvg;var gene,staff_tb,nstaff,tsnext,realwidth,insert_meter,spf_last,space_tb=new Float32Array([7,10,14.15,20,28.3,40,56.6,80,100,120]),smallest_duration,dx_tb=new Float32Array([10,10,11,13,13]),hw_tb=new Float32Array([4.5,5,6,7,8]),w_note=new Float32Array([3.5,3.7,5,6,7]),delta_tb={t:-4,c:0,b:4,p:-6},rest_sp=[[18,18],[12,18],[12,12],[0,12],[6,8],[10,10],[6,4],[10,0],[10,4],[10,10]],delpit=[0,-7,-14,0],MAXPIT=96,blocks=[],a_gch,a_dcn,multicol,maps={},qplet_tb=new Int8Array([0,1,3,2,3,0,2,0,3,0]),ntb="CDEFGABcdefgab",note_pit=new Int8Array([0,2,4,5,7,9,11]),reg_dur=/(\d*)(\/*)(\d*)/g,cde2fcg=new Int8Array([0,2,4,-1,1,3,5]),cgd2cde=new Int8Array([0,4,1,5,2,6,3]),acc2=new Int8Array([-2,-1,3,1,2]),nil=["0"],char_tb=[nil,nil,nil,nil,nil,nil,nil,nil,nil," ","\n",nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil," ","!",'"',"i","\n",nil,"&",nil,"(",")","i",nil,nil,"-","!dot!",nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,"|","i","<","n","<","i","i","n","n","n","n","n","n","n","!fermata!","d","d","d","!emphasis!","!lowermordent!","d","!coda!","!uppermordent!","d","d","!segno!","!trill!","d","d","d","n","d","n","[","\\","|","n","n","i","n","n","n","n","n","n","n","d","d","d","d","d","d","d","d","d","d","d","d","d","!upbow!","!downbow!","d","n","n","n","{","|","}","!gmark!",nil],cw_tb=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.333,.408,.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5]),info_font_init={A:"info",C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},output="",style="\n.fill {fill: currentColor}\n.stroke {stroke: currentColor; fill: none}\n.music text, .music tspan {fill:currentColor}",font_style="",posx=cfmt.leftmargin/cfmt.scale,posy=0,img={width:cfmt.pagewidth,lm:cfmt.leftmargin,rm:cfmt.rightmargin},defined_glyph={},defs="",fulldefs="",stv_g={scale:1,dy:0,st:-1,v:0,g:0},block={},tgls={brace:{x:0,y:0,c:""},sgno:{x:-6,y:0,c:""},coda:{x:-12,y:6,c:""},tclef:{x:-8,y:0,c:""},cclef:{x:-8,y:0,c:""},bclef:{x:-8,y:0,c:""},pclef:{x:-6,y:0,c:""},stclef:{x:-8,y:0,c:""},scclef:{x:-8,y:0,c:""},sbclef:{x:-7,y:0,c:""},spclef:{x:-6,y:0,c:""},meter0:{c:""},meter1:{c:""},meter2:{c:""},meter3:{c:""},meter4:{c:""},meter5:{c:""},meter6:{c:""},meter7:{c:""},meter8:{c:""},meter9:{c:""},"meter+":{c:""},"meter(":{c:""},"meter)":{c:""},csig:{x:0,y:0,c:""},ctsig:{x:0,y:0,c:""},HDD:{x:-7,y:0,c:""},breve:{x:-6,y:0,c:""},HD:{x:-5.2,y:0,c:""},Hd:{x:-3.8,y:0,c:""},hd:{x:-3.7,y:0,c:""},ghd:{x:2,y:0,c:"",sc:.66},pshhd:{x:-3.7,y:0,c:""},pfthd:{x:-3.7,y:0,c:""},x:{x:-3.7,y:0,c:""},"circle-x":{x:-3.7,y:0,c:""},srep:{x:-5,y:0,c:""},dot:{x:-2,y:0,c:""},"acc-1":{x:-3,y:0,c:""},acc3:{x:-2,y:0,c:""},acc1:{x:-3,y:0,
c:""},acc2:{x:-3,y:0,c:""},"acc-2":{x:-3,y:0,c:""},"acc-1_1_4":{x:-3,y:0,c:""},accent:{x:-3,y:2,c:""},marcato:{x:-3,y:0,c:""},hld:{x:-7,y:0,c:""},brth:{x:0,y:0,c:""},r00:{x:-1.5,y:0,c:""},r0:{x:-1.5,y:0,c:""},r1:{x:-3.5,y:6,c:""},r2:{x:-3.2,y:0,c:""},r4:{x:-3,y:0,c:""},r8:{x:-3,y:0,c:""},r16:{x:-4,y:0,c:""},r32:{x:-4,y:0,c:""},r64:{x:-4,y:0,c:""},r128:{x:-4,y:0,c:""},mrest:{x:-10,y:0,c:""},mrep:{x:-6,y:0,c:""},mrep2:{x:-9,y:0,c:""},turn:{x:-5,y:4,c:""},turnx:{x:-5,y:4,c:""},umrd:{x:-7,y:2,c:""},lmrd:{x:-7,y:2,c:""},ped:{x:-10,y:0,c:""},pedoff:{x:-5,y:0,c:""},longa:{x:-6,y:0,c:""}},glyphs={acc1_1_4:'<g id="acc1_1_4">\n\t<path d="m0 7.8v-15.4" class="stroke"/>\n\t<path class="fill" d="M-1.8 2.7l3.6 -1.1v2.2l-3.6 1.1v-2.2z\n\t\tM-1.8 -3.7l3.6 -1.1v2.2l-3.6 1.1v-2.2"/>\n</g>',acc1_3_4:'<g id="acc1_3_4">\n\t<path d="m-2.5 8.7v-15.4M0 7.8v-15.4M2.5 6.9v-15.4" class="stroke"/>\n\t<path class="fill" d="m-3.7 3.1l7.4 -2.2v2.2l-7.4 2.2v-2.2z\n\t\tM-3.7 -3.2l7.4 -2.2v2.2l-7.4 2.2v-2.2"/>\n</g>',"acc-1_3_4":'<g id="acc-1_3_4">\n    <path class="fill" d="m0.6 -2.7\n\tc-5.7 -3.1 -5.7 3.6 0 6.7c-3.9 -4 -4 -7.6 0 -5.8\n\tM1 -2.7c5.7 -3.1 5.7 3.6 0 6.7c3.9 -4 4 -7.6 0 -5.8"/>\n    <path d="m1.6 3.5v-13M0 3.5v-13" class="stroke" stroke-width=".6"/>\n</g>',pmsig:'<path id="pmsig" class="stroke" stroke-width="0.8"\n\td="m0 -7a5 5 0 0 1 0 -10a5 5 0 0 1 0 10"/>',pMsig:'<g id="pMsig">\n\t<use xlink:href="#pmsig"/>\n\t<path class="fill" d="m0 -10a2 2 0 0 1 0 -4a2 2 0 0 1 0 4"/>\n</g>',imsig:'<path id="imsig" class="stroke" stroke-width="0.8"\n\td="m3 -8a5 5 0 1 1 0 -8"/>',iMsig:'<g id="iMsig">\n\t<use xlink:href="#imsig"/>\n\t<path class="fill" d="m0 -10a2 2 0 0 1 0 -4a2 2 0 0 1 0 4"/>\n</g>',hl:'<path id="hl" class="stroke" stroke-width="1" d="m-6 0h12"/>',hl1:'<path id="hl1" class="stroke" stroke-width="1" d="m-7 0h14"/>',hl2:'<path id="hl2" class="stroke" stroke-width="1" d="m-9 0h18"/>',ghl:'<path id="ghl" class="stroke" d="m-3.5 0h7"/>',rdots:'<g id="rdots" class="fill">\n\t<circle cx="0" cy="-9" r="1.2"/>\n\t<circle cx="0" cy="-15" r="1.2"/>\n</g>',grm:'<path id="grm" class="fill" d="m-5 -2.5\n\tc5 -8.5 5.5 4.5 10 -2 -5 8.5 -5.5 -4.5 -10 2"/>',stc:'<circle id="stc" class="fill" cx="0" cy="-3" r="1.2"/>',sld:'<path id="sld" class="fill" d="m-7.2 4.8\n\tc1.8 .7 4.5 -.2 7.2 -4.8 -2.1 5 -5.4 6.8 -7.6 6"/>',emb:'<path id="emb" class="stroke" stroke-width="1.2" stroke-linecap="round"\n\td="m-2.5 -3h5"/>',roll:'<path id="roll" class="fill" d="m-6 0\n\tc0.4 -7.3 11.3 -7.3 11.7 0 -1.3 -6 -10.4 -6 -11.7 0"/>',upb:'<path id="upb" class="stroke" d="m-2.6 -9.4\n\tl2.6 8.8 2.6 -8.8"/>',dnb:'<g id="dnb">\n\t<path d="M-3.2 -2v-7.2m6.4 0v7.2" class="stroke"/>\n\t<path d="M-3.2 -6.8v-2.4l6.4 0v2.4" class="fill"/>\n</g>',dplus:'<path id="dplus" class="stroke" stroke-width="1.7"\n\td="m0 -.5v-6m-3 3h6"/>',lphr:'<path id="lphr" class="stroke" stroke-width="1.2"\n\td="m0 0v18"/>',mphr:'<path id="mphr" class="stroke" stroke-width="1.2"\n\td="m0 0v12"/>',sphr:'<path id="sphr" class="stroke" stroke-width="1.2"\n\td="m0 0v6"/>',sfz:'<text id="sfz" x="-5" y="-7" style="font-family:serif; font-style:italic; font-size:14px">\n\ts<tspan font-size="16" font-weight="bold">f</tspan>z</text>',trl:'<text id="trl" x="-2" y="-4"\n\tstyle="font-family:serif; font-weight:bold; font-style:italic; font-size:16px">tr</text>',opend:'<circle id="opend" class="stroke"\n\tcx="0" cy="-3" r="2.5"/>',snap:'<path id="snap" class="stroke" d="m-3 -6\n\tc0 -5 6 -5 6 0 0 5 -6 5 -6 0\n\tM0 -5v6"/>',thumb:'<path id="thumb" class="stroke" d="m-2.5 -7\n\tc0 -6 5 -6 5 0 0 6 -5 6 -5 0\n\tM-2.5 -9v4"/>',wedge:'<path id="wedge" class="fill" d="m0 -1l-1.5 -5h3l-1.5 5"/>',ltr:'<path id="ltr" class="fill"\n\td="m0 -.4c2 -1.5 3.4 -1.9 3.9 .4 0.2 .8 .7 .7 2.1 -.4\n\tv0.8c-2 1.5 -3.4 1.9 -3.9 -.4 -.2 -.8 -.7 -.7 -2.1 .4z"/>',custos:'<g id="custos">\n\t<path class="fill" d="m-4 0l2 2.5 2 -2.5 2 2.5 2 -2.5\n\t\t-2 -2.5 -2 2.5 -2 -2.5 -2 2.5"/>\n\t<path class="stroke" d="m3.5 0l5 -7"/>\n</g>',triangle:'<path id="triangle" class="fill" d="m-3.7 -3.2l7.4 0 -3.7 6.4 -3.7 -6.4"/>',diamond:'<path id="diamond" class="fill" d="m0 3.5l-3.7 -3.5 3.7 -3.5 3.7 3.5z"/>',oct:'<text id="oct" style="font-family:serif; font-size:12px">8</text>'},anno_type=["bar","clef","custos","","grace","key","meter","Zrest","note","part","rest","yspace","staves","Break","tempo","","block","remark"],anno_start=user.anno_start?a_start:empty_function,anno_stop=user.anno_stop?a_stop:empty_function;Abc.prototype.out_svg=function(e){output+=e},Abc.prototype.sx=sx,Abc.prototype.sy=sy,Abc.prototype.sh=function(e){return stv_g.st<0?e/stv_g.scale:e},Abc.prototype.ax=function(e){return e+posx},Abc.prototype.ay=function(e){return stv_g.st<0?posy-e:posy+(stv_g.dy-e)*stv_g.scale-stv_g.dy},Abc.prototype.ah=function(e){return stv_g.st<0?e:e*stv_g.scale},Abc.prototype.out_sxsy=out_sxsy,Abc.prototype.xypath=xypath;var deco_str_style={crdc:{dx:0,dy:5,style:"font-family:serif; font-style:italic; font-size:14px"},dacs:{dx:0,dy:3,style:"font-family:serif; font-size:16px",anchor:' text-anchor="middle"'},fng:{dx:0,dy:1,style:"font-family:Bookman; font-size:8px",anchor:' text-anchor="middle"'},pf:{dx:0,dy:5,style:"font-family:serif; font-weight:bold; font-style:italic; font-size:16px"},"@":{dx:0,dy:5,style:"font-family:sans-serif; font-size:12px"}},deco_val_tb={arp:out_arp,cresc:out_cresc,dim:out_dim,ltr:out_ltr,"8va":out_8va,"8vb":out_8vb,"15ma":out_15ma,"15mb":out_15mb},deco_l_tb={glisq:out_glisq,gliss:out_gliss};Abc.prototype.blk_out=blk_out,Abc.prototype.blk_flush=blk_flush;var par_sy,cur_sy,voice_tb,curvoice,staves_found,vover,tsfirst,w_tb=new Uint8Array([2,1,8,0,3,5,6,9,9,0,9,3,0,7,0,0,0,0]),note_names="CDEFGAB",latin_names=["Do","Re","Mi","Fa","Sol","La","Si"],acc_name=["bb","b","","#","##"];font_init(),init_tune(),Abc.prototype.add_style=function(e){style+=e},Abc.prototype.cfmt=function(){return cfmt},Abc.prototype.get_a_gch=function(){return a_gch},Abc.prototype.get_cur_sy=function(){return cur_sy},Abc.prototype.get_curvoice=function(){return curvoice},Abc.prototype.get_delta_tb=function(){return delta_tb},Abc.prototype.get_decos=function(){return decos},Abc.prototype.get_fname=function(){return parse.fname},Abc.prototype.get_font=get_font,Abc.prototype.get_font_style=function(){return font_style},Abc.prototype.get_glyphs=function(){return glyphs},Abc.prototype.get_img=function(){return img},Abc.prototype.get_maps=function(){return maps},Abc.prototype.get_multi=function(){return multicol},Abc.prototype.get_newpage=function(){if(block.newpage)return block.newpage=!1,!0},Abc.prototype.get_posy=function(){var e=posy;return posy=0,e},Abc.prototype.get_staff_tb=function(){return staff_tb},Abc.prototype.get_top_v=function(){return par_sy.top_voice},Abc.prototype.get_tsfirst=function(){return tsfirst},Abc.prototype.get_voice_tb=function(){return voice_tb},Abc.prototype.info=function(){return info},Abc.prototype.set_cur_sy=function(e){cur_sy=e},Abc.prototype.set_tsfirst=function(e){tsfirst=e},Abc.prototype.set_xhtml=function(e){var t=write_text;return write_text=e,t},Abc.prototype.sort_pitch=sort_pitch,Abc.prototype.stv_g=function(){return stv_g},Abc.prototype.svg_flush=svg_flush;var hook_init,self=this}};var Abc=abc2svg.Abc;"object"==typeof module&&"object"==typeof exports&&(exports.abc2svg=abc2svg,exports.Abc=Abc),abc2svg.loadjs=function(e,t,r){r&&r()},abc2svg.modules={ambitus:{fn:"ambitus-1.js"},beginps:{fn:"psvg-1.js"},break:{fn:"break-1.js"},capo:{fn:"capo-1.js"},clip:{fn:"clip-1.js"},voicecombine:{fn:"combine-1.js"},diagram:{fn:"diag-1.js"},equalbars:{fn:"equalbars-1.js"},grid:{fn:"grid-1.js"},grid2:{fn:"grid2-1.js"},MIDI:{fn:"MIDI-1.js"},percmap:{fn:"perc-1.js"},sth:{fn:"sth-1.js"},temperament:{fn:"temper-1.js"},nreq:0,hooks:[],g_hooks:[],load:function(e,t,r){var n,a=this.nreq,i=e.match(/(^|\n)(%%|I:).+?\b/g);if(!i)return!0;this.cbf=t||function(){},this.errmsg=r||function(){return"object"==typeof user&&user.errmsg?user.errmsg:"function"==typeof printErr?printErr:"function"==typeof alert?function(e){alert(e)}:"object"==typeof console?console.log:function(){}}();for(var o=0;o<i.length;o++)(n=abc2svg.modules[i[o].replace(/\n?(%%|I:)/,"")])&&!n.loaded&&(n.loaded=!0,this.nreq++,abc2svg.loadjs(n.fn,function(){0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()},function(){abc2svg.modules.errmsg("error loading "+n.fn),0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()}));return this.nreq==a}},abc2svg.version="1.17.8-4f07d34b4d",abc2svg.vdate="2018-08-24","object"==typeof module&&"object"==typeof exports&&(exports.ToAudio=ToAudio);var abcsf2=[];!function(e,t){"object"==typeof exports?(e.sf2=exports,t(exports)):"function"==typeof define&&define.amd?define(["exports"],function(r){return e.sf2=r,e.sf2,t(r)}):(e.sf2={},t(e.sf2))}(this,function(e){"use strict";var t=e;return t.Parser=function(e,t){t=t||{},this.input=e,this.parserOptions=t.parserOptions},t.Parser.prototype.parse=function(){var e,r=new t.Riff.Parser(this.input,this.parserOptions);if(r.parse(),1!==r.chunkList.length)throw new Error("wrong chunk length");if(null===(e=r.getChunk(0)))throw new Error("chunk not found");this.parseRiffChunk(e),this.input=null},t.Parser.prototype.parseRiffChunk=function(e){var r,n,a=this.input,i=e.offset;if("RIFF"!==e.type)throw new Error("invalid chunk type:"+e.type);if("sfbk"!==(n=String.fromCharCode(a[i++],a[i++],a[i++],a[i++])))throw new Error("invalid signature:"+n);if(r=new t.Riff.Parser(a,{index:i,length:e.size-4}),r.parse(),3!==r.getNumberOfChunks())throw new Error("invalid sfbk structure");this.parseInfoList(r.getChunk(0)),this.parseSdtaList(r.getChunk(1)),this.parsePdtaList(r.getChunk(2))},t.Parser.prototype.parseInfoList=function(e){var r,n,a=this.input,i=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);if("INFO"!==(n=String.fromCharCode(a[i++],a[i++],a[i++],a[i++])))throw new Error("invalid signature:"+n);r=new t.Riff.Parser(a,{index:i,length:e.size-4}),r.parse()},t.Parser.prototype.parseSdtaList=function(e){var r,n,a=this.input,i=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);if("sdta"!==(n=String.fromCharCode(a[i++],a[i++],a[i++],a[i++])))throw new Error("invalid signature:"+n);if(r=new t.Riff.Parser(a,{index:i,length:e.size-4}),r.parse(),1!==r.chunkList.length)throw new Error("TODO");this.samplingData=r.getChunk(0)},t.Parser.prototype.parsePdtaList=function(e){var r,n,a=this.input,i=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);if("pdta"!==(n=String.fromCharCode(a[i++],a[i++],a[i++],a[i++])))throw new Error("invalid signature:"+n);if(r=new t.Riff.Parser(a,{index:i,length:e.size-4}),r.parse(),9!==r.getNumberOfChunks())throw new Error("invalid pdta chunk");this.parsePhdr(r.getChunk(0)),this.parsePbag(r.getChunk(1)),this.parsePmod(r.getChunk(2)),this.parsePgen(r.getChunk(3)),this.parseInst(r.getChunk(4)),this.parseIbag(r.getChunk(5)),this.parseImod(r.getChunk(6)),this.parseIgen(r.getChunk(7)),this.parseShdr(r.getChunk(8))},t.Parser.prototype.parsePhdr=function(e){var t=this.input,r=e.offset,n=this.presetHeader=[],a=e.offset+e.size;if("phdr"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;r<a;)n.push({presetName:String.fromCharCode.apply(null,t.subarray(r,r+=20)),preset:t[r++]|t[r++]<<8,bank:t[r++]|t[r++]<<8,presetBagIndex:t[r++]|t[r++]<<8,library:(t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24)>>>0,genre:(t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24)>>>0,morphology:(t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24)>>>0})},t.Parser.prototype.parsePbag=function(e){var t=this.input,r=e.offset,n=this.presetZone=[],a=e.offset+e.size;if("pbag"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;r<a;)n.push({presetGeneratorIndex:t[r++]|t[r++]<<8,presetModulatorIndex:t[r++]|t[r++]<<8})},t.Parser.prototype.parsePmod=function(e){if("pmod"!==e.type)throw new Error("invalid chunk type:"+e.type);this.presetZoneModulator=this.parseModulator(e)},t.Parser.prototype.parsePgen=function(e){if("pgen"!==e.type)throw new Error("invalid chunk type:"+e.type);this.presetZoneGenerator=this.parseGenerator(e)},t.Parser.prototype.parseInst=function(e){var t=this.input,r=e.offset,n=this.instrument=[],a=e.offset+e.size;if("inst"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;r<a;)n.push({instrumentName:String.fromCharCode.apply(null,t.subarray(r,r+=20)),instrumentBagIndex:t[r++]|t[r++]<<8})},t.Parser.prototype.parseIbag=function(e){var t=this.input,r=e.offset,n=this.instrumentZone=[],a=e.offset+e.size;if("ibag"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;r<a;)n.push({instrumentGeneratorIndex:t[r++]|t[r++]<<8,instrumentModulatorIndex:t[r++]|t[r++]<<8})},t.Parser.prototype.parseImod=function(e){if("imod"!==e.type)throw new Error("invalid chunk type:"+e.type);this.instrumentZoneModulator=this.parseModulator(e)},t.Parser.prototype.parseIgen=function(e){if("igen"!==e.type)throw new Error("invalid chunk type:"+e.type);this.instrumentZoneGenerator=this.parseGenerator(e)},t.Parser.prototype.parseShdr=function(e){var t,r,n,a,i,o,s,l,c,u,$=this.input,f=e.offset,p=this.sample=[],d=this.sampleHeader=[],h=e.offset+e.size;if("shdr"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;f<h;){t=String.fromCharCode.apply(null,$.subarray(f,f+=20)),r=$[f++]<<0|$[f++]<<8|$[f++]<<16|$[f++]<<24,n=$[f++]<<0|$[f++]<<8|$[f++]<<16|$[f++]<<24,a=$[f++]<<0|$[f++]<<8|$[f++]<<16|$[f++]<<24,i=$[f++]<<0|$[f++]<<8|$[f++]<<16|$[f++]<<24,o=$[f++]<<0|$[f++]<<8|$[f++]<<16|$[f++]<<24,s=$[f++],l=$[f++]<<24>>24,c=$[f++]|$[f++]<<8,u=$[f++]|$[f++]<<8;var _=new Int16Array(new Uint8Array($.subarray(this.samplingData.offset+2*r,this.samplingData.offset+2*n)).buffer);if(a-=r,i-=r,o>0){var g=this.adjustSampleData(_,o);_=g.sample,o*=g.multiply,a*=g.multiply,i*=g.multiply}p.push(_),d.push({sampleName:t,startLoop:a,endLoop:i,sampleRate:o,originalPitch:s,pitchCorrection:l,sampleLink:c,sampleType:u})}},t.Parser.prototype.adjustSampleData=function(e,t){for(var r,n,a,i,o=1;t<22050;){for(r=new Int16Array(2*e.length),n=i=0,a=e.length;n<a;++n)r[i++]=e[n],r[i++]=e[n];e=r,o*=2,t*=2}return{sample:e,multiply:o}},t.Parser.prototype.parseModulator=function(e){for(var r,n,a=this.input,i=e.offset,o=e.offset+e.size,s=[];i<o;){if(i+=2,r=a[i++]|a[i++]<<8,void 0===(n=t.Parser.GeneratorEnumeratorTable[r]))s.push({type:n,value:{code:r,amount:a[i]|a[i+1]<<8<<16>>16,lo:a[i++],hi:a[i++]}});else switch(n){case"keyRange":case"velRange":case"keynum":case"velocity":s.push({type:n,value:{lo:a[i++],hi:a[i++]}});break;default:s.push({type:n,value:{amount:a[i++]|a[i++]<<8<<16>>16}})}i+=2,i+=2}return s},t.Parser.prototype.parseGenerator=function(e){for(var r,n,a=this.input,i=e.offset,o=e.offset+e.size,s=[];i<o;)if(r=a[i++]|a[i++]<<8,void 0!==(n=t.Parser.GeneratorEnumeratorTable[r]))switch(n){case"keynum":case"keyRange":case"velRange":case"velocity":s.push({type:n,value:{lo:a[i++],hi:a[i++]}});break;default:s.push({type:n,value:{amount:a[i++]|a[i++]<<8<<16>>16}})}else s.push({type:n,value:{code:r,amount:a[i]|a[i+1]<<8<<16>>16,lo:a[i++],hi:a[i++]}});return s},t.Parser.prototype.getInstruments=function(){var e,t,r,n,a,i,o,s,l,c=this.instrument,u=this.instrumentZone,$=[];for(i=0,o=c.length;i<o;++i){for(e=c[i].instrumentBagIndex,t=c[i+1]?c[i+1].instrumentBagIndex:u.length,r=[],s=e,l=t;s<l;++s)n=this.createInstrumentGenerator_(u,s),a=this.createInstrumentModulator_(u,s),r.push({generator:n.generator,modulator:a.modulator});$.push({name:c[i].instrumentName,info:r})}return $},t.Parser.prototype.createInstrumentGenerator_=function(e,t){return{generator:this.createBagModGen_(e,e[t].instrumentGeneratorIndex,e[t+1]?e[t+1].instrumentGeneratorIndex:this.instrumentZoneGenerator.length,this.instrumentZoneGenerator).modgen}},t.Parser.prototype.createInstrumentModulator_=function(e,t){return{modulator:this.createBagModGen_(e,e[t].presetModulatorIndex,e[t+1]?e[t+1].instrumentModulatorIndex:this.instrumentZoneModulator.length,this.instrumentZoneModulator).modgen}},t.Parser.prototype.createBagModGen_=function(e,t,r,n){var a,i,o,s={unknown:[],keyRange:{hi:127,lo:0}};for(i=t,o=r;i<o;++i)a=n[i],"unknown"===a.type?s.unknown.push(a.value):s[a.type]=a.value;return{modgen:s}},t.Parser.GeneratorEnumeratorTable=["startAddrsOffset","endAddrsOffset","startloopAddrsOffset","endloopAddrsOffset","startAddrsCoarseOffset","modLfoToPitch","vibLfoToPitch","modEnvToPitch","initialFilterFc","initialFilterQ","modLfoToFilterFc","modEnvToFilterFc","endAddrsCoarseOffset","modLfoToVolume",void 0,"chorusEffectsSend","reverbEffectsSend","pan",void 0,void 0,void 0,"delayModLFO","freqModLFO","delayVibLFO","freqVibLFO","delayModEnv","attackModEnv","holdModEnv","decayModEnv","sustainModEnv","releaseModEnv","keynumToModEnvHold","keynumToModEnvDecay","delayVolEnv","attackVolEnv","holdVolEnv","decayVolEnv","sustainVolEnv","releaseVolEnv","keynumToVolEnvHold","keynumToVolEnvDecay","instrument",void 0,"keyRange","velRange","startloopAddrsCoarseOffset","keynum","velocity","initialAttenuation",void 0,"endloopAddrsCoarseOffset","coarseTune","fineTune","sampleID","sampleModes",void 0,"scaleTuning","exclusiveClass","overridingRootKey"],t.Riff={},t.Riff.Parser=function(e,t){t=t||{},this.input=e,this.ip=t.index||0,this.length=t.length||e.length-this.ip,this.offset=this.ip,this.padding=void 0===t.padding||t.padding,this.bigEndian=void 0!==t.bigEndian&&t.bigEndian},t.Riff.Chunk=function(e,t,r){this.type=e,this.size=t,this.offset=r},t.Riff.Parser.prototype.parse=function(){var e=this.length+this.offset;for(this.chunkList=[];this.ip<e;)this.parseChunk()},t.Riff.Parser.prototype.parseChunk=function(){var e,r=this.input,n=this.ip;this.chunkList.push(new t.Riff.Chunk(String.fromCharCode(r[n++],r[n++],r[n++],r[n++]),e=this.bigEndian?r[n++]<<24|r[n++]<<16|r[n++]<<8|r[n++]:r[n++]|r[n++]<<8|r[n++]<<16|r[n++]<<24,n)),n+=e,1===(this.padding&&n-this.offset&1)&&n++,this.ip=n},t.Riff.Parser.prototype.getChunk=function(e){var t=this.chunkList[e];return void 0===t?null:t},t.Riff.Parser.prototype.getNumberOfChunks=function(){return this.chunkList.length},t}),navigator.requestMIDIAccess&&navigator.requestMIDIAccess({sysex:!0}).then(onMIDISuccess,onMIDIFailure1),abc2svg.ambitus={do_ambitus:function(){var e,t,r,n,a,i=abc2svg.C,o=this.get_voice_tb();for(t=0;t<o.length;t++)if(r=o[t],!r.second){for(n=100,a=-100,e=r.sym;e;e=e.next)e.type==i.NOTE&&(e.notes[e.nhd].pit>a&&(a=e.notes[e.nhd].pit),e.notes[0].pit<n&&(n=e.notes[0].pit));100!=n&&(e=r.clef,e.stem=1,e.head=i.FULL,e.stemless=!0,e.nhd=1,e.notes=[{dur:i.BLEN/4,pit:n,shhd:0},{dur:i.BLEN/4,pit:a,shhd:0}])}},draw_symbols:function(e,t){var r=this.get_staff_tb(),n=t.sym;void 0!=n.clef_type&&n.nhd>0&&(n.x-=26,this.set_scale(n),this.draw_note(n),n.notes[1].pit-n.notes[0].pit>4&&(this.xypath(n.x,3*(n.notes[1].pit-18)+r[n.st].y),this.out_svg("v"+(3*(n.notes[1].pit-n.notes[0].pit)).toFixed(2)+'" stroke-width=".6"/>\n')),n.x+=26,t.clef.nhd=0),e(t)},set_pitch:function(e,t){e(t),!t&&this.cfmt().ambitus&&abc2svg.ambitus.do_ambitus.call(this)},set_fmt:function(e,t,r,n){if("ambitus"==t)return void(this.cfmt().ambitus=r);e(t,r,n)},set_width:function(e,t){void 0!=t.clef_type&&t.nhd>0?(t.wl=40,t.wr=12):e(t)}},abc2svg.modules.hooks.push("draw_note","set_scale",["draw_symbols","abc2svg.ambitus.draw_symbols"],["set_pitch","abc2svg.ambitus.set_pitch"],["set_format","abc2svg.ambitus.set_fmt"],["set_width","abc2svg.ambitus.set_width"]),abc2svg.modules.ambitus.loaded=!0,abc2svg.break={get_break:function(e){var t,r,a,i,o=abc2svg.C,s=e.split(/[ ,]/),l=this.cfmt();for(l.break||(l.break=[]),n=1;n<s.length;n++)t=s[n],r=t.match(/(\d+)([a-z]?)(:\d+\/\d+)?/),r?(r[2]&&(i=r[2].charCodeAt(0)-97),r[3]?(a=r[3].match(/:(\d+)\/(\d+)/),!a||a[2]<1?this.syntax(1,"Bad denominator in %%break"):l.break.push({m:r[1],t:a[1]*o.BLEN/a[2],sq:i})):l.break.push({m:r[1],t:0,sq:i})):this.syntax(1,errs.bad_val,"%%break")},do_break:function(){var e,t,r,n,a,i=this.get_voice_tb();for(v=this.get_cur_sy().top_voice,s1=i[v].sym,cfmt=this.cfmt(),e=0;e<cfmt.break.length;e++){for(n=cfmt.break[e],t=n.m,s=s1;s&&s.bar_num!=t;s=s.next);if(s){if(n.sq){for(a=n.sq,s=s.ts_next;s&&(s.bar_num!=t||0!=--a);s=s.ts_next);if(!s)continue}if(r=n.t){for(r=s.time+r;s&&!(s.time>=r);s=s.next);if(!s)continue;s=s.prev}s.eoln=!0}}},do_pscom:function(e,t){"break "==t.slice(0,6)?abc2svg.break.get_break.call(this,t):e(t)},set_bar_num:function(e){e(),this.cfmt().break&&abc2svg.break.do_break.call(this)}},abc2svg.modules.hooks.push("errs","syntax",["do_pscom","abc2svg.break.do_pscom"],["set_bar_num","abc2svg.break.set_bar_num"]),abc2svg.modules.break.loaded=!0,abc2svg.capo={gch_capo:function(e){for(var t,r,n=this.cfmt(),a=n.capo,i=0;;){if(!(t=e[i++]))return;if("g"==t.type)break}r=Object.create(t),r.capo=!1,r.text=this.gch_tr1(r.text,[0,5,-2,3,-4,1,-6,-1,4,-3,2,-5][a%12]),this.capo_first||(this.capo_first=!0,r.text+="  (capo: "+a.toString()+")"),r.font=this.get_font(n.capofont?"capo":"annotation"),e.splice(i,0,r),t.capo=!0},gch_build:function(e,t){var r=this.get_a_gch();this.cfmt().capo&&r&&abc2svg.capo.gch_capo.call(this,r),e(t)},output_music:function(e){this.capo_first=!1,e()},set_fmt:function(e,t,r,n){if("capo"==t)return void(this.cfmt().capo=r);e(t,r,n)}},abc2svg.modules.hooks.push("gch_tr1","get_font",["set_format","abc2svg.capo.set_fmt"],["gch_build","abc2svg.capo.gch_build"],["output_music","abc2svg.capo.output_music"]),abc2svg.modules.capo.loaded=!0,abc2svg.clip={get_clip:function(e){function t(e){var t,r=e.match(/(\d+)([a-z]?)(:\d+\/\d+)?/);if(r){if(r[2]&&(t=r[2].charCodeAt(0)-97),!r[3])return{m:r[1],t:0,sq:t};if((e=r[3].match(/:(\d+)\/(\d+)/))&&!(e[2]<1))return{m:r[1],t:e[1]*a.BLEN/e[2],sq:t}}}var r,n,a=abc2svg.C,i=e.split(/[ -]/);return 3!=i.length?void this.syntax(1,this.errs.bad_val,"%%clip"):(r=i[1]?t(i[1]):{m:0,t:0},n=t(i[2]),r&&n?void(this.cfmt().clip=[r,n]):void this.syntax(1,this.errs.bad_val,"%%clip"))},do_clip:function(){function e(e,r){var n,a,i;if(r.m<=1){if(1==r.m){for(n=e;n&&(n.type!=t.BAR||0==n.time);n=n.ts_next);n.time<voice_tb[this.get_cur_sy().top_voice].meter.wmeasure&&(e=n)}}else{for(;e&&!(e.type==t.BAR&&e.bar_num>=r.m);e=e.ts_next);if(!e)return;if(r.sq){for(i=r.sq,e=e.ts_next;e&&(e.type!=t.BAR||e.bar_num!=r.m||0!=--i);e=e.ts_next);if(!e)return}}if(0==r.t)return e;for(a=e.time+r.t;e.time<a;)if(!(e=e.ts_next))return e;do{e=e.ts_prev}while(!e.seqst);return e}var t=abc2svg.C;voice_tb=this.get_voice_tb(),cfmt=this.cfmt();var r,n,a,i,o;if(r=this.get_tsfirst(),cfmt.clip[0].m>0||cfmt.clip[0].t>0){if(!(r=e(r,cfmt.clip[0])))return void this.set_tsfirst(null);for(a=this.get_cur_sy(),n=this.get_tsfirst();n!=r;n=n.ts_next)switch(n.type){case t.CLEF:n.p_v.clef=n;break;case t.KEY:n.p_v.key=this.clone(n.as.u.key);break;case t.METER:n.p_v.meter=this.clone(n.as.u.meter);break;case t.STAVES:a=n.sy,this.set_cur_sy(a)}for(o=0;o<voice_tb.length;o++){for(i=voice_tb[o],n=r;n;n=n.ts_next)if(n.v==o){delete n.prev;break}i.sym=n}this.set_tsfirst(r),delete r.ts_prev}if(r=e(r,cfmt.clip[1])){do{if(!(r=r.ts_next))return}while(!r.seqst);for(o=0;o<voice_tb.length;o++){for(i=voice_tb[o],n=r.ts_prev;n;n=n.ts_prev)if(n.v==o){delete n.next;break}n||(i.sym=null)}delete r.ts_prev.ts_next}},do_pscom:function(e,t){"clip "==t.slice(0,5)?abc2svg.clip.get_clip.call(this,t):e(t)},set_bar_num:function(e){e(),this.cfmt().clip&&abc2svg.clip.do_clip.call(this)}},abc2svg.modules.hooks.push("clone","errs","syntax",["do_pscom","abc2svg.clip.do_pscom"],["set_bar_num","abc2svg.clip.set_bar_num"]),abc2svg.modules.clip.loaded=!0,abc2svg.combine={comb_v:function(){function e(e){var t,r=e.ts_next;return!(!r||r.type!=i.NOTE&&r.type!=i.REST)&&(r.v!=e.v&&r.st==e.st&&r.time==e.time&&r.dur==e.dur&&(!(e.combine<=0&&r.type!=e.type)&&((!e.a_gch||!r.a_gch)&&(e.type==i.REST?!(e.type==r.type&&e.invis&&!r.invis):!(r.a_ly||r.sl1||r.sl2||r.slur_start||r.slur_end)&&(r.beam_st==e.beam_st&&r.beam_end==e.beam_end&&(t=r.nhd,!(e.combine<=1&&e.notes[0].pit<=r.notes[t].pit+1)))))))}function t(e,t){var r,n,a;if(e.notes=e.notes.concat(t.notes),e.nhd=r=e.notes.length-1,this.sort_pitch(e),e.combine>=3){for(a=r;a>0;a--)e.notes[a].pit==e.notes[a-1].pit&&e.notes[a].acc==e.notes[a-1].acc&&e.notes.splice(a,1);e.nhd=r=e.notes.length-1}e.ymx=3*(e.notes[r].pit-18)+4,e.ymn=3*(e.notes[0].pit-18)-4,n=e.notes[0].ti1,(15&n)==i.SL_AUTO&&(e.notes[0].ti1=i.SL_BELOW|n&~i.SL_DOTTED),(15&(n=e.notes[r].ti1))==i.SL_AUTO&&(e.notes[r].ti1=i.SL_ABOVE|n&~i.SL_DOTTED)}function r(r){for(var n;;)if(r.nhd,n=r.ts_next,n.nhd,r.type!=n.type?n.type!=i.REST&&(n=r,r=n.ts_next):r.type==i.REST?r.invis&&!n.invis&&delete r.invis:t.call(this,r,n),n.a_gch&&(r.a_gch=n.a_gch),n.a_dd&&(r.a_dd?r.a_dd=r.a_dd.concat(n.a_dd):r.a_dd=n.a_dd),this.unlksym(n),r.in_tuplet||!e.call(this,r))break}var n,a,i=abc2svg.C;for(n=this.get_tsfirst();n;n=n.ts_next){switch(n.type){case i.REST:if(void 0==n.combine||n.combine<0)continue;e.call(this,n)&&r.call(this,n);continue;default:continue;case i.NOTE:if(void 0==n.combine||n.combine<=0)continue}if(n.beam_st)if(n.beam_end)e.call(this,n)&&r.call(this,n);else{for(a=n;;){if(!e.call(this,a)){a=null;break}if(a.beam_end)break;do{a=a.next}while(a.type!=i.NOTE&&a.type!=i.REST)}if(a)for(a=n;;){if(r.call(this,a),a.beam_end)break;do{a=a.next}while(a.type!=i.NOTE&&a.type!=i.REST)}}}},do_pscom:function(e,t){"voicecombine "==t.slice(0,13)?this.set_v_param("combine",t.split(/[ \t]/)[1]):e(t)},new_note:function(e,t,r){var n=this.get_curvoice(),a=e(t,r);return a&&a.notes&&void 0!=n.combine&&(a.combine=n.combine),a},set_stem_dir:function(e){e(),abc2svg.combine.comb_v.call(this)},set_vp:function(e,t){var r,n=this.get_curvoice();for(r=0;r<t.length;r++)if("combine="==t[r]){n.combine=t[r+1];break}e(t)}},abc2svg.modules.hooks.push("set_v_param","sort_pitch","unlksym",["do_pscom","abc2svg.combine.do_pscom"],["new_note","abc2svg.combine.new_note"],["set_stem_dir","abc2svg.combine.set_stem_dir"],["set_vp","abc2svg.combine.set_vp"]),abc2svg.modules.voicecombine.loaded=!0,abc2svg.diag={do_diag:function(){var e=this.get_glyphs(),t=this.get_voice_tb();if(!e.fb){var r,n,a,i=this.get_decos();for(ns="CDEFGAB",ms=["","m","7","m7","maj7","sus4"],this.add_style("\n.diag {font:6px sans-serif}\n.frn {font:italic 7px sans-serif}"),r=0;r<ns.length;r++)for(n=0;n<ms.length;n++)a=ns[r]+ms[n],i[a]="3 "+a+" 40 0 0";for(n=0;n<ms.length;n++)a="F"+ms[n],i[a]="3 F#"+ms[n]+" 40 0 0";e.fb='<g id="fb">\n<path class="stroke" stroke-width="0.4" d="M-10 -34h20m0 6h-20m0 6h20m0 6h-20m0 6h20"/>\n<path class="stroke" stroke-width="0.5" d="M-10 -34v24m4 0v-24m4 0v24m4 0v-24m4 0v24m4 0v-24"/>\n</g>',e.nut='<path id="nut" class="stroke" stroke-width="1.6" d="M-10.2 -34.5h20.4"/>',e.barre='<path id="barre" class="stroke" stroke-width=".9" d="M-10.2 -31h20.4"/>',e.fr1='<text id="fr1" x="-20" y="-29" class="frn">fr1</text>',e.fr2='<text id="fr2" x="-20" y="-29" class="frn">fr2</text>',e.fr3='<text id="fr3" x="-20" y="-29" class="frn">fr3</text>',e.ddot='<circle id="ddot" class="fill" r="1.5"/>',e.C='<g id="C">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-8,-3,4" y="-36" class="diag">321</text>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n<use x="6" y="-31" xlink:href="#ddot"/>\n</g>',e.Cm='<g id="Cm">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr3"/>\n<use xlink:href="#fb"/>\n<text x="-4,0,4" y="-36" class="diag">342</text>\n<use x="2" y="-19" xlink:href="#ddot"/>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n<use x="6" y="-25" xlink:href="#ddot"/>\n</g>',e.C7='<g id="C7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4,0,4" y="-36" class="diag">3241</text>\n<use x="2" y="-19" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n<use x="6" y="-31" xlink:href="#ddot"/>\n</g>',e.Cm7='<g id="Cm7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr3"/>\n<use xlink:href="#fb"/>\n<text x="-12,-4,4" y="-36" class="diag">x32</text>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n<use x="6" y="-25" xlink:href="#ddot"/>\n</g>',e.Cmaj7='<g id="Cmaj7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-8,-4" y="-36" class="diag">x21</text>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e.Csus4='<g id="Csus4">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr3"/>\n<use xlink:href="#fb"/>\n<text x="-12,0,4" y="-36" class="diag">x34</text>\n<use x="6" y="-13" xlink:href="#ddot"/>\n<use x="2" y="-19" xlink:href="#ddot"/>\n</g>',e.D='<g id="D">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,0,4,8" y="-36" class="diag">x132</text>\n<use x="6" y="-19" xlink:href="#ddot"/>\n<use x="10" y="-25" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n</g>',e.Dm='<g id="Dm">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,0,4,8" y="-36" class="diag">x231</text>\n<use x="6" y="-19" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="10" y="-31" xlink:href="#ddot"/>\n</g>',e.D7='<g id="D7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,0,4,8" y="-36" class="diag">x312</text>\n<use x="10" y="-25" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="6" y="-31" xlink:href="#ddot"/>\n</g>',e.Dm7='<g id="Dm7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-8,0,4,8" y="-36" class="diag">xx211</text>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="10" y="-31" xlink:href="#ddot"/>\n<use x="6" y="-31" xlink:href="#ddot"/>\n</g>',e.Dmaj7='<g id="Dmaj7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-8,0,4,8" y="-36" class="diag">xx123</text>\n<use x="10" y="-25" xlink:href="#ddot"/>\n<use x="6" y="-25" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n</g>',e.Dsus4='<g id="Dsus4">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-8,0,4,8" y="-36" class="diag">xx123</text>\n<use x="10" y="-19" xlink:href="#ddot"/>\n<use x="6" y="-19" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n</g>',e.E='<g id="E">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4,0" y="-36" class="diag">231</text>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n<use x="2" y="-31" xlink:href="#ddot"/>\n</g>',e.Em='<g id="Em">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4" y="-36" class="diag">23</text>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n</g>',e.E7='<g id="E7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-8,0" y="-36" class="diag">21</text>\n<use x="2" y="-31" xlink:href="#ddot"/>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n</g>',e.Em7='<g id="Em7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-8" y="-36" class="diag">1</text>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n</g>',e.Emaj7='<g id="Emaj7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4,0" y="-36" class="diag">312</text>\n<use x="2" y="-31" xlink:href="#ddot"/>\n<use x="-2" y="-31" xlink:href="#ddot"/>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n</g>',e.Esus4='<g id="Esus4">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-4,0" y="-36" class="diag">12</text>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n</g>',e.F='<g id="F">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr1"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4,0" y="-36" class="diag">342</text>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n</g>',e.Fm='<g id="Fm">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr1"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4" y="-36" class="diag">34</text>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e.F7='<g id="F7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr1"/>\n<use xlink:href="#fb"/>\n<text x="-8,0" y="-36" class="diag">32</text>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',
e.Fm7='<g id="Fm7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr1"/>\n<use xlink:href="#fb"/>\n<text x="-8" y="-36" class="diag">3</text>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e.Fmaj7='<g id="Fmaj7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr1"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4,0" y="-36" class="diag">423</text>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e.Fsus4='<g id="Fsus4">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr1"/>\n<use xlink:href="#fb"/>\n<text x="-4,0" y="-36" class="diag">34</text>\n<use x="2" y="-19" xlink:href="#ddot"/>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n</g>',e["F#"]='<g id="F#">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4,0" y="-36" class="diag">342</text>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n</g>',e["F#m"]='<g id="F#m">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4" y="-36" class="diag">34</text>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e["F#7"]='<g id="F#7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-8,0" y="-36" class="diag">32</text>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e["F#m7"]='<g id="F#m7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-8" y="-36" class="diag">3</text>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e["F#maj7"]='<g id="F#maj7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4,0" y="-36" class="diag">423</text>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e["F#sus4"]='<g id="F#sus4">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-4,0" y="-36" class="diag">34</text>\n<use x="2" y="-19" xlink:href="#ddot"/>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n</g>',e.G='<g id="G">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-8,8" y="-36" class="diag">234</text>\n<use x="10" y="-19" xlink:href="#ddot"/>\n<use x="-10" y="-19" xlink:href="#ddot"/>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n</g>',e.Gm='<g id="Gm">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr3"/>\n<use xlink:href="#fb"/>\n<text x="-8,-4" y="-36" class="diag">34</text>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e.G7='<g id="G7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-8,8" y="-36" class="diag">321</text>\n<use x="-10" y="-19" xlink:href="#ddot"/>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n<use x="10" y="-31" xlink:href="#ddot"/>\n</g>',e.Gm7='<g id="Gm7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr3"/>\n<use xlink:href="#fb"/>\n<text x="-8" y="-36" class="diag">3</text>\n<use x="-6" y="-19" xlink:href="#ddot"/>\n</g>',e.Gmaj7='<g id="Gmaj7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-8,8" y="-36" class="diag">312</text>\n<use x="10" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n<use x="-10" y="-19" xlink:href="#ddot"/>\n</g>',e.Gsus4='<g id="Gsus4">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr3"/>\n<use xlink:href="#fb"/>\n<text x="-4,0" y="-36" class="diag">34</text>\n<use x="2" y="-19" xlink:href="#ddot"/>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n</g>',e.A='<g id="A">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-4,0,4" y="-36" class="diag">234</text>\n<use x="6" y="-25" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n</g>',e.Am='<g id="Am">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-4,0,4" y="-36" class="diag">231</text>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n<use x="6" y="-31" xlink:href="#ddot"/>\n</g>',e.A7='<g id="A7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-4,4" y="-36" class="diag">23</text>\n<use x="6" y="-25" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n</g>',e.Am7='<g id="Am7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-4,4" y="-36" class="diag">21</text>\n<use x="6" y="-31" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n</g>',e.Amaj7='<g id="Amaj7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-4,0,4" y="-36" class="diag">x213</text>\n<use x="6" y="-25" xlink:href="#ddot"/>\n<use x="2" y="-31" xlink:href="#ddot"/>\n<use x="-2" y="-25" xlink:href="#ddot"/>\n</g>',e.Asus4='<g id="Asus4">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,0,4" y="-36" class="diag">x12</text>\n<use x="6" y="-19" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n</g>',e.B='<g id="B">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-4,0,4" y="-36" class="diag">234</text>\n<use x="6" y="-19" xlink:href="#ddot"/>\n<use x="2" y="-19" xlink:href="#ddot"/>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n</g>',e.Bm='<g id="Bm">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-4,0,4" y="-36" class="diag">341</text>\n<use x="6" y="-25" xlink:href="#ddot"/>\n<use x="2" y="-19" xlink:href="#ddot"/>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n</g>',e.B7='<g id="B7">\n<use xlink:href="#nut"/>\n<use xlink:href="#fb"/>\n<text x="-12,-8,-4,0,8" y="-36" class="diag">x2134</text>\n<use x="10" y="-25" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-6" y="-25" xlink:href="#ddot"/>\n<use x="-2" y="-31" xlink:href="#ddot"/>\n</g>',e.Bm7='<g id="Bm7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-12,0,8" y="-36" class="diag">x32</text>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n<use x="6" y="-25" xlink:href="#ddot"/>\n</g>',e.Bmaj7='<g id="Bmaj7">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-12,-4,0,4" y="-36" class="diag">x324</text>\n<use x="6" y="-19" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n<use x="-2" y="-19" xlink:href="#ddot"/>\n</g>',e.Bsus4='<g id="Bsus4">\n<use xlink:href="#barre"/>\n<use xlink:href="#fr2"/>\n<use xlink:href="#fb"/>\n<text x="-12,0,4" y="-36" class="diag">x34</text>\n<use x="6" y="-19" xlink:href="#ddot"/>\n<use x="2" y="-25" xlink:href="#ddot"/>\n</g>'}var o,r,s,l;for(o=t[0].sym;o;o=o.next)if(o.a_gch)for(r=0;r<o.a_gch.length;r++)(s=o.a_gch[r])&&"g"==s.type&&!s.capo&&(l=s.otext||s.text,this.deco_cnv(l.split(/[ \t\/]/,1),o,null))},output_music:function(e){this.cfmt().diag&&abc2svg.diag.do_diag.call(this),e()},set_fmt:function(e,t,r,n){if("diagram"==t)return void(this.cfmt().diag=r);e(t,r,n)}},abc2svg.modules.hooks.push("deco_cnv",["output_music","abc2svg.diag.output_music"],["set_format","abc2svg.diag.set_fmt"]),abc2svg.modules.diagram.loaded=!0,abc2svg.equalbars={output_music:function(e){this.equalbars_d=0,e()},set_fmt:function(e,t,r,n){"equalbars"==t?this.cfmt().equalbars=this.get_bool(r):e(t,r,n)},set_sym_glue:function(e,t){var r,n,a,i,o,s,l,c,u,$=abc2svg.C,p=[],h=this.get_tsfirst();if(e(t),this.cfmt().equalbars){for(n=h;n;n=n.ts_next)if(n.seqst){switch(n.type){default:continue;case $.BAR:case $.GRACE:case $.MREST:case $.NOTE:case $.REST:case $.SPACE:}break}if(n){for(r=n.ts_next,u=c=r.time;;){if(!r.ts_next){p.push([r,r.time-c]),c=r.time,r.dur&&(c+=r.dur);break}r.type==$.BAR&&r.seqst&&(p.push([r,r.time-c]),c=r.time),r=r.ts_next}if(0!=(o=p.length))for(s=n.type==$.GRACE?n.extra.x:n.x,d=this.equalbars_d,d||(d=this.equalbars_d=s),a=(t-d)/(c-u),i=0;i<o;i++){for(r=p[i][0],f=a*p[i][1]/(r.x-s);n!=r;n=n.ts_next)if(n.type==$.GRACE)for(l=n.extra;l;l=l.next)l.x=d+(l.x-s)*f;else n.x&&(n.x=d+(n.x-s)*f);for(d+=a*p[i][1],s=n.x;;)if(n.x=d,!(n=n.ts_next)||n.seqst)break;if(!n)break}}}}},abc2svg.modules.hooks.push("get_bool",["output_music","abc2svg.equalbars.output_music"],["set_format","abc2svg.equalbars.set_fmt"],["set_sym_glue","abc2svg.equalbars.set_sym_glue"]),abc2svg.modules.equalbars.loaded=!0,abc2svg.grid={do_grid:function(){function e(e){var t=p.BLEN/4;return e.a_meter[0]&&"C"!=e.a_meter[0].top[0]&&e.a_meter[0].bot?(t=p.BLEN/e.a_meter[0].bot[0]|0,8==e.a_meter[0].bot[0]&&e.a_meter[0].top[0]%3==0&&(t=p.BLEN/8*3),t):t}function t(e,t,i){var o,s,l,c,u,$,f,p,d,h,g,m,y,v=0,b=[],x=e.length%6==0?6:8;for(x>e.length&&(x=e.length),l=0,o=0;o<e.length;o++){if(o%x==0&&l++,f=e[o],0==f.length)p="%";else for(p="",s=0;s<f.length;s++)f[s]?(0!=s&&(p+=" / "),p+=f[s]):0==s&&(p+="%");u=t[o],":"==u[u.length-1]&&(p="  "+p),$=t[o+1],$&&":"==$[0]&&(p+="  "),b.push(p),":"==u[u.length-1]&&(p+="  "),$&&":"==$[0]&&(p+="  "),d=this.strwh(p)[0],d>v&&(v=d)}for(v<20&&(v=20),d=v*x,d>r.width&&(x/=2,l*=2,d/=2),h=i.size+8,c='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tcolor="black" width="'+r.width.toFixed(0)+'px" height="'+(h*l+6).toFixed(0)+'px"',o=_.bgcolor,o&&(c+=' style="background-color: '+o+'"'),c+='>\n<style type="text/css">\n.mid {text-anchor:middle}\n',_.fullsvg&&(c+=".stroke {stroke: currentColor; fill: none}\n."+n+" {"+this.style_font(i.name+"."+i.size)+"}\n"),c+="</style>\n",c+='<path class="stroke" d="\n',g=(r.width-d)/2,y=1,s=0;s<=l;s++)c+="M"+g.toFixed(2)+" "+y.toFixed(2)+"h"+d.toFixed(2)+"\n",y+=h;for(m=g,o=0;o<=x;o++)c+="M"+m.toFixed(2)+" 1v"+(h*l).toFixed(2)+"\n",m+=v;for(c+='"/>\n',y=-1-.2*h,o=0;o<b.length;o++)o%x==0&&(y+=h,m=g+v/2),c+='<text class="'+a+'" x="'+m.toFixed(2)+'" y="'+y.toFixed(2)+'">'+b[o]+"</text>\n",m+=v;for(y=-1-.2*h,m=g,o=0;o<t.length;o++)u=t[o],":"==u[0]&&(c+='<text class="'+a+'" x="'+(m-5).toFixed(2)+'" y="'+y.toFixed(2)+'" style="font-weight:bold;font-size:'+(i.size+2).toFixed(2)+'">:|</text>\n'),o%x==0&&(y+=h,m=g),":"==u[u.length-1]&&(c+='<text class="'+a+'" x="'+(m+5).toFixed(2)+'" y="'+y.toFixed(2)+'" style="font-weight:bold;font-size:'+(i.size+2).toFixed(2)+'">|:</text>\n'),m+=v;return c+"</svg>"}var r,n,a,i,o,s,l,c,u,$,f,p=abc2svg.C,d=this.get_tsfirst(),h=this.get_voice_tb(),_=this.cfmt(),g=[],m=[],y=[];for(r=this.get_img(),o=e(h[0].meter),s=c=$=0,g.push("|"),i=h[0].sym;i;i=i.next){for(;i.time>s;)c++,s+=o;switch(i.type){case p.NOTE:case p.REST:if(i.a_gch)for(l=0;l<i.a_gch.length;l++)if("g"==i.a_gch[l].type){y[c]||(y[c]=i.a_gch[l].text,$++);break}break;case p.BAR:if(i.time<o){g[0]=i.bar_type,c=0,s=i.time;break}if(i.time!=s)break;m.push(y),g.push(i.bar_type),y=[],c=0;break;case p.METER:o=e(i)}}if(0!=$)if(0!=y.length&&(g.push(""),m.push(y)),this.cfmt().gridfont||this.param_set_font("gridfont","serif 16"),f=this.get_font("grid"),n=this.font_class(f),a=n+" mid",this.set_font("grid"),u=h[this.get_top_v()],i={type:p.BLOCK,subtype:"ml",dur:0,time:0,p_v:u,v:u.v,text:t.call(this,m,g,f)},_.grid<0){for(var v=d;v.ts_next;v=v.ts_next);i.time=v.time,i.prev=u.last_sym,i.ts_prev=v,u.last_sym.next=i,v.ts_next=i}else i.time=0,i.next=u.sym,i.ts_next=d,d.ts_prev=i,d=i,this.set_tsfirst(i),u.sym.prev=i,u.sym=i},output_music:function(e){this.cfmt().grid&&abc2svg.grid.do_grid.call(this),e()},set_fmt:function(e,t,r,n){if("grid"==t)return void(this.cfmt().grid=r);e(t,r,n)}},abc2svg.modules.hooks.push("font_class","get_font","param_set_font","set_font","strwh",["output_music","abc2svg.grid.output_music"],["set_format","abc2svg.grid.set_fmt"]),abc2svg.modules.grid.loaded=!0,abc2svg.grid2={do_grid:function(){var e,t,r,n=this.get_voice_tb();for(t=0;t<n.length;t++)if(r=n[t],r.grid2)for(r.stafflines="...",r.clef.invis=!0,r.key.k_sf=r.key.k_a_acc=0,r.staffnonote=2,e=r.sym;e;e=e.next)e.dur&&(e.invis=!0,delete e.sl1,e.ti1=0)},draw_chosym:function(e){var t,r;for(this.set_dscale(e.st),t=0;t<e.a_gch.length;t++)r=e.a_gch[t],"g"==r.type&&(this.use_font(r.font),this.set_font(r.font),this.xy_str(e.x+r.x,r.y+6,r.text))},draw_gchord:function(e,t,r,n){t.p_v.grid2?abc2svg.grid2.draw_chosym.call(this,t):e(t,r,n)},output_music:function(e){abc2svg.grid2.do_grid.call(this),e()},set_format:function(e,t,r,n){if("grid2"==t){var a=this.get_curvoice();return void(a&&(a.grid2=r))}e(t,r,n)}},abc2svg.modules.hooks.push("set_dscale","set_font","use_font","xy_str",["draw_gchord","abc2svg.grid2.draw_gchord"],["output_music","abc2svg.grid2.output_music"],["set_format","abc2svg.grid2.set_format"]),abc2svg.modules.grid2.loaded=!0,abc2svg.MIDI={do_midi:function(e){var t,r,n=new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]),a=new Int8Array([0,1,0,-1,0,0,1,0,-1,0,-1,0]),i=this.get_maps(),o=e.split(/\s+/);switch(o[1]){case"channel":if("10"!=o[2])break;this.set_v_param("midictl","0 1");break;case"drummap":if("play"!=this.cfmt().sound)break;if(t=function(e){if(e.match(/^([_^]*)([A-Ga-g])([,']*)$/))return e.match(/[A-Z]/)&&(e=e.toLowerCase(),e.indexOf("'")>0?e=e.replace("'",""):e+=","),e}(o[2]),r=function(e){var t=Number(e);if(!isNaN(t))return e=7*(t/12|0)-19,t%=12,e+=n[t],note={pit:e,apit:e},a[t]&&(note.acc=a[t]),note}(o[3]),!t||!r){this.syntax(1,abc.errs.bad_val,"%%MIDI drummap");break}i.MIDIdrum||(i.MIDIdrum={}),i.MIDIdrum[t]=[null,r],this.set_v_param("mididrum","MIDIdrum");break;case"program":if(r=void 0!=o[3]?o[3]:o[2],r=parseInt(r),isNaN(r)||r<0||r>127)return void this.syntax(1,"Bad program in %%MIDI");this.set_v_param("instr",r);break;case"control":if(t=parseInt(o[2]),isNaN(t)||t<0||t>127)return void this.syntax(1,"Bad controller number in %%MIDI");if(r=parseInt(o[3]),isNaN(r)||r<0||r>127)return void this.syntax(1,"Bad controller value in %%MIDI");this.set_v_param("midictl",o[2]+" "+o[3])}},set_midi:function(e){var t,r,n=this.get_curvoice();for(t=0;t<e.length;t++)switch(e[t]){case"instr=":n.instr=e[t+1];break;case"midictl=":n.midictl||(n.midictl={}),r=e[t+1].split(" "),n.midictl[r[0]]=Number(r[1]);break;case"mididrum=":n.map||(n.map={}),n.map=e[t+1]}},do_pscom:function(e,t){"MIDI "==t.slice(0,5)?abc2svg.MIDI.do_midi.call(this,t):e(t)},set_vp:function(e,t){abc2svg.MIDI.set_midi.call(this,t),e(t)}},abc2svg.modules.hooks.push("errs","set_v_param","syntax",["do_pscom","abc2svg.MIDI.do_pscom"],["set_vp","abc2svg.MIDI.set_vp"]),abc2svg.modules.MIDI.loaded=!0,abc2svg.modules.psvg={do_begin_end:function(e,t,r,n){if("ps"!=t)return void e(t,r,n);"nosvg"!=r&&(this.psvg||(this.psvg=new Psvg(this)),this.psvg.ps_eval.call(this.psvg,n))},psdeco:function(e,t,r,n,a){return!!this.psvg&&this.psvg.psdeco.call(this.psvg,t,r,n,a)},psxygl:function(e,t,r,n){return!!this.psvg&&this.psvg.psxygl.call(this.psvg,t,r,n)}},abc2svg.modules.hooks.push("out_arp","out_deco_str","out_deco_val","out_ltr","xygl",["do_begin_end","abc2svg.modules.psvg.do_begin_end"],["psdeco","abc2svg.modules.psvg.psdeco"],["psxygl","abc2svg.modules.psvg.psxygl"]),abc2svg.modules.beginps.loaded=!0,abc2svg.sth={recal_beam:function(e,t){var r=this.get_staff_tb(),n=t.st,a=e.s2;for(t.sth&&(t.ys=t.sth),a.sth&&(a.ys=a.sth),e.a=(t.ys-a.ys)/(t.xs-a.xs),e.b=t.ys-t.xs*e.a+r[n].y;;)if(t.ys=e.a*t.xs+e.b-r[n].y,t.stem>0?t.ymx=t.ys+2.5:t.ymn=t.ys-2.5,(t=t.next)==a)break},set_sth:function(){var e,t,r,n,a,i=this.get_voice_tb();for(r=0;r<i.length;r++)if(a=i[r],null==a.sth)for(n=[],e=a.sym;e;e=e.next)if(e.sth&&(n=e.sth,e.sth=null),!(0==n.length||e.nflags<=-2||e.stemless||!e.beam_st&&!e.beam_end)&&"*"!=(t=n.shift()))if("|"!=t)t=Number(t),!isNaN(t)&&t&&(e.stem>=0?(e.ys=e.y+t,e.ymx=e.ys+2.5|0):(e.ys=e.y-t,e.ymn=e.ys-2.5|0),e.sth=e.ys);else for(e=e.next;e&&!e.bar_type;e=e.next);},calculate_beam:function(e,t,r){var n=e(t,r);return n&&t.s2&&r.sth&&abc2svg.sth.recal_beam.call(this,t,r),n},new_note:function(e,t,r){var n=abc2svg.C,a=e(t,r),i=this.get_curvoice();return i.sth&&a&&a.type==n.NOTE&&(a.sth=i.sth,i.sth=null),a},set_format:function(e,t,r,n){if("sth"==t){var a=this.get_curvoice();return 2==this.parse.state&&this.goto_tune(),void(a&&(a.sth=r.split(/[ \t;-]+/)))}e(t,r,n)},set_stems:function(e){e(),abc2svg.sth.set_sth.call(this)}},abc2svg.modules.hooks.push("goto_tune","parse",["calculate_beam","abc2svg.sth.calculate_beam"],["new_note","abc2svg.sth.new_note"],["set_format","abc2svg.sth.set_format"],["set_stems","abc2svg.sth.set_stems"]),abc2svg.modules.sth.loaded=!0,abc2svg.temper={set_bar_num:function(e){if(e(),this.cfmt().temper){var t=this.get_voice_tb()[0];t.temper=new Float32Array(12);for(var r=0;r<12;r++)t.temper[r]=this.cfmt().temper[r]/100}},set_fmt:function(e,t,r,n){if("temperament"==t){var a=new Float32Array(r.split(/ +/)),i=a.length;if(12==i){for(;--i>=0&&!isNaN(parseInt(a[i])););if(i<0)return void(this.cfmt().temper=a)}return void this.syntax(1,errs.bad_val,"%%temperament")}e(t,r,n)}},abc2svg.modules.hooks.push("syntax",["set_bar_num","abc2svg.temper.set_bar_num"],["set_format","abc2svg.temper.set_fmt"]),abc2svg.modules.temperament.loaded=!0,Opal.loaded(["abc2svg-1"]),function(e){var t,r,n,a=e.top,i=e,o=e.nil,s=(e.breaker,e.slice,e.gvars),l=o,c=o,u=o,$=o;e.add_stubs(["$require","$[]","$==","$length","$puts","$exit","$mkdir_p","$first","$new","$sort","$each","$clear_errors","$read","$message","$set_abc_input","$load_music_model","$produce_pdfs","$write","$basename","$join","$get_errors"]),global.window={document:{createElementNS:function(){return{}}}},global.navigator={},global.btoa=function(e){return new Buffer(e).toString("base64")},global.atob=function(e){return new Buffer(e,"base64").toString("binary")},jsPDF=require("jspdf"),Ajv=require("ajv"),neatJSON=require("./neatjson_js"),fs=require("fs"),glob=require("glob"),a.$require("opal"),a.$require("opal-platform"),a.$require("nodejs"),a.$require("nodejs/fileutils"),a.$require("vector2d"),a.$require("opal-neatjson"),a.$require("opal-ajv"),a.$require("consolelogger"),a.$require("harpnotes"),a.$require("abc_to_harpnotes_factory"),a.$require("abc2svg_to_harpnotes"),a.$require("opal-jspdf"),a.$require("opal-jszip"),a.$require("pdf_engine"),a.$require("init_conf"),a.$require("text_pane"),a.$require("command-controller"),a.$require("controller"),a.$require("controller-cli"),a.$require("confstack2"),a.$require("opal-abc2svg"),a.$require("version-prod"),a.$require("abc2svg-1.js"),l=!1!==(t=i.get("ARGV")["$[]"](0))&&t!==o&&null!=t?t:"*.abc",c=!1!==(t=i.get("ARGV")["$[]"](1))&&t!==o&&null!=t?t:".",i.get("ARGV")["$[]"](2),i.get("ARGV").$length()["$=="](2)||(a.$puts('usage: node --max_old_space_size=4096 zupfnoter-cli.js "/tmp/zntest/*.abc" /tmp/xxx'),a.$exit(0)),i.get("FileUtils").$mkdir_p(c),a.$puts("processing "+i.get("ARGV").$first()+" to "+c),u=i.get("CliController").$new(),$=i.get("Dir")["$[]"](l).$sort(),(t=(r=$).$each,t.$$p=(n=function(t){var r,a,l,$=n.$$s||this,f=o,p=o,d=o;null==s.log&&(s.log=o),null==t&&(t=o),s.log.$clear_errors();try{f=i.get("File").$read(t)}catch(t){if(!e.rescue(t,[i.get("Exception")]))throw t;p=t;try{$.$puts(p)}finally{e.pop_exception()}}return s.log.$message("processing: "+t),u=i.get("CliController").$new(),u.$set_abc_input(f),u.$load_music_model(),d=u.$produce_pdfs("."),(r=(a=d).$each,r.$$p=(l=function(e,t){var r=l.$$s||this,n=o;null==e&&(e=o),null==t&&(t=o),n=c+"/"+e,r.$puts(e);var a=require("encoding"),i=a.convert(t,"Latin-1");fs.writeFileSync(n,i)},l.$$s=$,l.$$arity=2,l),r).call(a),i.get("File").$write(c+"/"+i.get("File").$basename(t)+".err.log",s.log.$get_errors().$join("\n"))},n.$$s=a,n.$$arity=1,n),t).call(r)}(Opal)},{"./neatjson_js":1,ajv:2,encoding:47,fs:void 0,glob:52,jspdf:82}]},{},[87]);